# v0.4.0 UX Enhancements Implementation Plan

**Date:** 2026-01-06
**Status:** Planning
**Estimated Duration:** 3-4 weeks (as per roadmap)

---

## Executive Summary

This plan covers v0.4.0 - User Experience Enhancements for SmartMoney. After codebase analysis, we identified significant existing implementations that reduce scope. Key findings:

**Already Implemented:**
- Dark mode core: System preference, manual toggle, localStorage persistence
- Chart dark mode: All Recharts components have dark mode colors (Catppuccin Mocha palette)
- Bottom navigation: Full implementation with "More" menu sheet
- Swipe-to-delete: Implemented in `SwipeableTransactionCard.tsx`
- Category creation: Basic modal with emoji picker exists
- Bulk operations: Bulk delete and recategorize work
- Category rules: Pattern-based categorization via `CategoryRule` model

**Needs Completion:**
- Dark mode: Full color palette audit (some components may have gaps)
- Mobile: Gesture controls beyond swipe-delete, pinch zoom on charts
- Keyboard shortcuts: Not implemented
- Category UI: Edit/delete for custom categories, color picker
- Bulk operations: Pattern-based recategorize, undo

---

## Phase Breakdown (Recommended 3 Phases)

### Phase 1: Core UX (Week 1) - HIGH IMPACT / LOW EFFORT
Priority features that provide immediate value with minimal complexity.

| Feature | Effort | Impact | Files |
|---------|--------|--------|-------|
| Keyboard shortcuts (basic) | 2 days | High | New hook, Layout.tsx |
| Dark mode audit & fixes | 1 day | Medium | Various components |
| Esc to close modals | 0.5 day | High | All modal components |
| Command palette (`Ctrl+K`) | 2 days | High | New component |

### Phase 2: Mobile Polish (Week 2) - MEDIUM IMPACT / MEDIUM EFFORT
Mobile-specific enhancements.

| Feature | Effort | Impact | Files |
|---------|--------|--------|-------|
| Touch-optimized charts | 2 days | Medium | ZoomableChart.tsx enhancement |
| Mobile dashboard simplification | 1 day | Medium | Dashboard.tsx |
| Navigation drawer (optional) | 1 day | Low | Consider deferring |

### Phase 3: Category & Bulk (Week 3-4) - MEDIUM IMPACT / HIGH EFFORT
Category customization and advanced bulk operations.

| Feature | Effort | Impact | Files |
|---------|--------|--------|-------|
| Category edit UI | 2 days | Medium | New modal, Settings.tsx |
| Category color picker | 1 day | Low | CreateCategoryModal.tsx |
| Bulk recategorize by pattern | 2 days | Medium | New modal, backend |
| Undo bulk operations | 3 days | Low | New service, backend |

---

## Feature Analysis & Recommendations

### 1. Dark Mode Completion

**Status:** 90% complete

**Existing Implementation:**
- `ThemeContext.tsx` - System preference detection, manual toggle, localStorage
- `ThemeToggle.tsx` - Sun/Moon toggle in header
- All Recharts components have dark mode colors (Catppuccin Mocha):
  - `TrendLineChart.tsx` - Grid, axis, tooltip colors
  - `CategoryPieChart.tsx` - Tooltip, legend colors
  - `IncomeExpenseBarChart.tsx` - Full dark theme
  - `ZoomableChart.tsx` - Dark mode support

**Remaining Work:**
1. **Color Palette Audit** - Quick scan of all components for hardcoded light colors
2. **Chart Line/Bar Colors** - Currently using fixed colors (#4CAF50, #F44336, #2196F3)
   - Consider: Slightly adjust for better dark mode contrast (lighter green/red)
   - OR: Keep as-is since Material colors work well in both themes

**Recommendation:** DEFER chart color adjustments (they work fine). Focus on palette audit only.

**Files to Review:**
```
frontend/src/components/ui/*.tsx
frontend/src/components/charts/*.tsx (verify label colors)
frontend/src/pages/*.tsx (inline styles)
```

**Estimated Effort:** 1 day

---

### 2. Mobile Responsive Improvements

**Status:** 70% complete

**Existing Implementation:**
- `BottomNavigation.tsx` - Full bottom nav with "More" menu
- `SwipeableTransactionCard.tsx` - Swipe-to-delete working
- Responsive design throughout (Tailwind breakpoints)

**Remaining Work:**

#### 2a. Touch-Optimized Charts (Pinch Zoom)
`ZoomableChart.tsx` exists but may need enhancement.

**Approach:**
- Use existing Recharts `ReferenceArea` for zoom selection
- Add touch event handlers for pinch-zoom gesture
- Consider using `use-gesture` library (lightweight, 8KB gzipped)

**Files:**
```
frontend/src/components/charts/ZoomableChart.tsx
```

**Estimated Effort:** 2 days

#### 2b. Simplified Mobile Dashboard Layout
Current dashboard works but can be optimized.

**Recommendations (KISS):**
- Collapse less-used cards by default on mobile
- Use existing `CollapsibleCard` component
- Prioritize: Net Worth, Monthly Summary, Quick Actions

**Files:**
```
frontend/src/pages/Dashboard.tsx
frontend/src/components/dashboard/*.tsx
```

**Estimated Effort:** 1 day

#### 2c. Mobile Navigation Drawer
**Recommendation:** DEFER - Bottom navigation with "More" sheet works well

---

### 3. Keyboard Shortcuts

**Status:** Not implemented

**Recommended Shortcuts:**
| Shortcut | Action | Priority |
|----------|--------|----------|
| `Esc` | Close modal/drawer | P0 |
| `Ctrl+K` | Command palette | P0 |
| `Ctrl+F` | Focus search | P1 |
| `Ctrl+N` | New transaction | P1 |
| `Ctrl+U` | Upload CSV | P2 |
| `?` | Show shortcuts help | P2 |

**Implementation Approach:**

Create reusable `useKeyboardShortcuts` hook:

```typescript
// frontend/src/hooks/useKeyboardShortcuts.ts
interface Shortcut {
  key: string
  ctrlKey?: boolean
  metaKey?: boolean
  callback: () => void
  description: string
}

export function useKeyboardShortcuts(shortcuts: Shortcut[]) {
  useEffect(() => {
    const handler = (e: KeyboardEvent) => {
      // Skip if user is typing in input
      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {
        return
      }
      // Match shortcuts...
    }
    window.addEventListener('keydown', handler)
    return () => window.removeEventListener('keydown', handler)
  }, [shortcuts])
}
```

**Command Palette Component:**
- Inspired by VS Code/Linear command palette
- Use `cmdk` library (https://cmdk.paco.me/) - 8KB gzipped
- Actions: Navigate to pages, create transaction, upload, search

**Files to Create:**
```
frontend/src/hooks/useKeyboardShortcuts.ts
frontend/src/components/ui/CommandPalette.tsx
frontend/src/components/ui/ShortcutsHelpModal.tsx
```

**Files to Modify:**
```
frontend/src/components/layout/Layout.tsx (add hook)
frontend/src/main.tsx or App.tsx (command palette)
```

**Estimated Effort:** 2.5 days

---

### 4. Category Customization UI

**Status:** 60% complete

**Existing Implementation:**
- `Category` model - Hierarchical with parent/child, icon, type, user_id
- `UserCategory` model - Separate table for user-defined categories
- `CreateCategoryModal.tsx` - Create with name, emoji, type
- `category-service.ts` - CRUD operations
- Settings page has category list (display only)

**Remaining Work:**

#### 4a. Edit Category Modal
- Reuse `CreateCategoryModal` structure
- Add edit mode with pre-filled values
- Handle updates via `updateCategory` API (need to add)

**Backend Needed:**
```python
# backend/app/routes/categories.py
@router.patch("/{category_id}")
async def update_category(category_id: int, payload: CategoryUpdate, ...):
    ...
```

#### 4b. Delete Category
- Already have `deleteCategory` in service
- Add confirmation dialog
- Handle transactions with deleted category (reassign to "Other")

#### 4c. Category Color Picker
**Recommendation:** DEFER - Emoji icons work well, color adds complexity

#### 4d. Category Icons Selection
- Already implemented with 30 emoji options
- Could expand selection but YAGNI

#### 4e. Category Hierarchy
**Recommendation:** DEFER to v0.5.0 - Already have parent_id in model but UI complexity is high

**Files to Create:**
```
frontend/src/components/transactions/EditCategoryModal.tsx
```

**Files to Modify:**
```
frontend/src/pages/Settings.tsx (wire up edit/delete)
backend/app/routes/categories.py (add PATCH endpoint)
```

**Estimated Effort:** 2 days

---

### 5. Bulk Transaction Operations

**Status:** 70% complete

**Existing Implementation:**
- `bulkDeleteTransactions` - Working
- `bulkUpdateCategory` - Working (select category from dropdown)
- Bulk selection UI in Transactions page

**Remaining Work:**

#### 5a. Bulk Recategorize by Pattern

**Use Case:** "Amazon" -> "Shopping", "Starbucks" -> "Food"

**Approach 1 (Recommended - KISS):**
Leverage existing `CategoryRule` system:
1. When user selects transactions matching a pattern
2. Auto-suggest creating a rule
3. Apply rule to selected + future transactions

**UI Flow:**
1. User searches "Amazon" in transactions
2. Selects matching transactions
3. Clicks "Recategorize" -> "Create Rule"
4. Modal: "Apply 'Shopping' to all transactions containing 'Amazon'?"
5. Creates rule + updates selected transactions

**Backend Already Exists:**
- `CategoryRule` model with `keyword`, `category`, `match_type`
- `applyRulesToTransactions` endpoint

**Files to Modify:**
```
frontend/src/components/transactions/BulkRecategorizeModal.tsx
  - Add "Create Rule" option
  - Show pattern input when user has search filter
```

**Estimated Effort:** 2 days

#### 5b. Undo Bulk Operations

**Recommendation:** DEFER to v0.5.0

**Complexity Analysis:**
- Requires storing operation history
- Need to track previous category values
- Database changes for audit log
- Conflict handling if transaction edited after bulk op

**Simpler Alternative (for v0.4.0):**
- Show preview before applying bulk operations
- Confirmation with count and category change preview
- Already have `dry_run` in `applyRulesToTransactions`

**Estimated Effort if Implemented:** 3 days

---

## Implementation Priority Matrix

```
                    HIGH IMPACT
                        |
   DEFER            P0 - DO FIRST
   (v0.5.0)         |
                    |  - Command Palette
   - Undo bulk      |  - Esc to close
   - Category       |  - Keyboard shortcuts
     hierarchy      |  - Dark mode audit
   - Color picker   |
                    |
LOW EFFORT ---------|--------- HIGH EFFORT
                    |
   NICE TO HAVE     |  P1 - PLAN CAREFULLY
                    |
   - Chart colors   |  - Touch-optimized charts
   - Nav drawer     |  - Category edit UI
                    |  - Pattern recategorize
                    |
                    LOW IMPACT
```

---

## Recommended Scope for v0.4.0

### MUST HAVE (P0)
1. Keyboard shortcuts hook + basic shortcuts (Esc, Ctrl+F, Ctrl+N)
2. Command palette (Ctrl+K) with navigation + actions
3. Dark mode audit (fix any hardcoded light colors)
4. Shortcuts help modal (?)

### SHOULD HAVE (P1)
5. Touch-optimized charts (pinch zoom)
6. Category edit modal
7. Bulk recategorize with rule creation

### DEFER to v0.5.0
- Undo bulk operations (high complexity, low urgency)
- Category hierarchy UI (model exists, UI complex)
- Category color picker (emoji icons sufficient)
- Mobile navigation drawer (bottom nav works well)

---

## Technical Dependencies

### New npm packages
```json
{
  "cmdk": "^0.2.0"  // Command palette (8KB gzip)
}
```

Note: `use-gesture` for pinch zoom could be avoided by using native touch events

### Backend Changes
1. **PATCH /api/categories/{id}** - Update category name/icon
2. **POST /api/category-rules/apply-and-create** - Combined endpoint (optional)

### Frontend New Files
```
frontend/src/
  hooks/
    useKeyboardShortcuts.ts
  components/
    ui/
      CommandPalette.tsx
      ShortcutsHelpModal.tsx
    transactions/
      EditCategoryModal.tsx
```

---

## Success Criteria (from Roadmap)

| Metric | Target | Approach |
|--------|--------|----------|
| Dark mode toggle | <100ms | Already met |
| Mobile dashboard load (4G) | <1s | Optimize with lazy loading |
| Keyboard shortcuts | 100% functional | Comprehensive test coverage |
| Bulk recategorize 1000 txns | <2s | Backend already optimized |
| Custom category saved | Persistent | Already works |

---

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Command palette UX not intuitive | Medium | Medium | Copy proven patterns (Linear, VS Code) |
| Touch zoom conflicts with scroll | Medium | Low | Test on real devices, add toggle |
| Category edit breaks existing data | Low | High | Backend validation, cascade rules |

---

## Testing Strategy

### Unit Tests
- `useKeyboardShortcuts` hook
- Category CRUD operations

### E2E Tests (Recommended)
- Command palette navigation
- Keyboard shortcuts work on all pages
- Bulk recategorize with rule creation

### Manual Testing
- Dark mode on all pages (visual audit)
- Touch gestures on iOS Safari + Android Chrome

---

## File Change Summary

### New Files (8)
```
frontend/src/hooks/useKeyboardShortcuts.ts
frontend/src/components/ui/CommandPalette.tsx
frontend/src/components/ui/ShortcutsHelpModal.tsx
frontend/src/components/transactions/EditCategoryModal.tsx
docs/plans/260106-v0.4.0-ux-enhancements-plan.md (this file)
```

### Modified Files (10-15)
```
frontend/src/components/layout/Layout.tsx
frontend/src/components/charts/ZoomableChart.tsx
frontend/src/components/transactions/BulkRecategorizeModal.tsx
frontend/src/pages/Settings.tsx
frontend/src/pages/Dashboard.tsx (mobile optimization)
frontend/package.json (add cmdk)
backend/app/routes/categories.py
public/locales/*/common.json (translations)
```

---

## Decisions Made

1. **Chart Zoom UX:** ✅ Enabled by default (no toggle needed)
2. **Command Palette Scope:** ✅ Include transaction search results (all-in-one search)
3. **Category Edit:** ✅ Cascade update to all existing transactions

---

## Next Steps

1. Review and approve this plan
2. Create tracking issues/tasks for Phase 1
3. Start with keyboard shortcuts hook (foundation for other features)
4. Parallel: Dark mode audit can be done independently

---

**Document Version:** 1.0
**Author:** Claude Code Assistant
**Review Date:** TBD
