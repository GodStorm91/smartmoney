import{k as Fe,u as Z,Z as oe,r as v,j as e,C as Q,B as W,I as Je,X as Ie,aK as gt,l as w,P as Ae,aL as st,M as de,N as ie,a7 as ue,au as Pe,aM as aa,av as Ce,af as ce,S as ra,g as xt,p as sa,ah as ye,ag as F,q as Rt,o as be,aN as Ft,an as na,aO as oa,n as ia,x as It,aw as bt,L as lt,ae as He,Q as Kt,z as ke,H as xe,T as la,F as ca,ax as da,J as Vt,a2 as Oe,aP as ua,aQ as ma,aj as ga,aR as xa,E as yt,i as ha}from"./index-BadmHgZg.js";import{d as Xe,e as pa}from"./useCategories-D0myzyAT.js";import{C as qt}from"./chevron-down-CTA-3p6f.js";import{F as fa,D as ba,T as ya}from"./TransactionEditModal-CDXtBbYs.js";import{R as va,E as vt}from"./HierarchicalCategoryPicker-DsVud-2u.js";import{f as ee,_ as zt,a as ja,b as Ut,c as Na,i as we,T as ht,p as pe,L as ge,g as Jt,d as pt,e as Wt,D as ka,C as wa,h as $e,j as Te,S as Sa,A as Aa,k as Pa,l as jt,m as Ca,n as Me,o as _a,u as Ta,G as Oa,q as We,r as Ma,s as Gt,t as Da,v as ze,w as Nt,x as Ea,y as $a,R as La,z as Ba}from"./generateCategoricalChart-COiIpkhd.js";import{P as Ra}from"./pencil-HHbBz3-Q.js";import{u as Fa}from"./useXPGain-DfuAoNz5.js";import"./Select-CPZb2nKz.js";import"./zoom-out-u9fW-Zgd.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Ka=Fe("arrow-down",Ia);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],qa=Fe("arrow-up",Va);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],kt=Fe("copy",za);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Ja=Fe("history",Ua);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],ft=Fe("layout-grid",Wa);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Ha=Fe("list",Ga);function Ue(t,a=0){if(!t&&t!==0)return"";const s=typeof t=="string"?parseFloat(t):t;return isNaN(s)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:a,maximumFractionDigits:a}).format(s)}function Ya(t){if(!t)return 0;const a=t.replace(/,/g,""),s=parseFloat(a);return isNaN(s)?0:s}function Qa(t){return{JPY:"Â¥",USD:"$",VND:"â‚«",EUR:"â‚¬",GBP:"Â£"}[t]||t}function Za(t){return["VND"].includes(t)?"suffix":"prefix"}function Xa(t){return{JPY:0,VND:0,KRW:0,USD:2,EUR:2,GBP:2}[t]??0}function er({onGenerate:t,isLoading:a,error:s,suggestions:r}){const{t:n}=Z("common"),{currency:i}=oe(),[o,c]=v.useState(""),[l,d]=v.useState(!1),u=Qa(i),h=Za(i),f=Xa(i);v.useEffect(()=>{if(r!=null&&r.previous_income&&!l&&!o){const j=r.previous_income/Math.pow(10,f);c(Ue(j,f)),d(!0)}},[r,l,o,f]);const p=j=>{const b=j.target.value.replace(/[^\d.]/g,"");if(b){const P=parseFloat(b);isNaN(P)||c(Ue(P,f))}else c("")},m=j=>{j.preventDefault();const x=Ya(o),b=Math.round(x*Math.pow(10,f));b>0&&(t(b),c(""))},g=()=>{r!=null&&r.previous_income&&t(r.previous_income)},y=j=>{const[x,b]=j.split("-");return new Date(parseInt(x),parseInt(b)-1).toLocaleDateString(void 0,{month:"long",year:"numeric"})};return e.jsxs("div",{className:"space-y-4",children:[(r==null?void 0:r.has_previous)&&r.previous_month&&e.jsx(Q,{className:"p-6 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("budget.previousBudgetFound",{month:y(r.previous_month)})}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:n("budget.cloneDescription")}),e.jsx(W,{onClick:g,loading:a,className:"w-full sm:w-auto",children:n("budget.clonePreviousMonth")})]})]})}),(r==null?void 0:r.has_previous)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:n("budget.orCreateNew")})})]}),e.jsxs(Q,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("budget.generateTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:n("budget.generateDescription")}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("budget.monthlyIncome")}),e.jsxs("div",{className:"relative",children:[h==="prefix"&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:u})}),e.jsx(Je,{type:"text",inputMode:"decimal",value:o,onChange:p,placeholder:Ue(5e5,f),required:!0,disabled:a,className:h==="prefix"?"pl-8":"pr-10"}),h==="suffix"&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:u})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[n("budget.incomeHint"),(r==null?void 0:r.previous_income)&&e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400",children:["(",n("budget.previousIncome"),": ",u,Ue(r.previous_income/Math.pow(10,f),f),")"]})]})]}),e.jsx(W,{type:"submit",loading:a,disabled:!o,className:"w-full",children:n("budget.generateButton")}),s&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:n("budget.generateError")})]})]})]})}function tr({onSubmit:t,onCancel:a,isLoading:s}){const{t:r}=Z("common"),[n,i]=v.useState(""),o=c=>{c.preventDefault(),n.trim()&&(t(n.trim()),i(""))};return e.jsxs(Q,{className:"p-6 border-blue-200 bg-blue-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:r("budget.feedbackTitle")}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx("textarea",{value:n,onChange:c=>i(c.target.value),placeholder:r("budget.feedbackPlaceholder"),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 min-h-[100px]",disabled:s,required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{type:"submit",disabled:s||!n.trim(),children:r(s?"budget.regenerating":"budget.submitFeedback")}),e.jsx(W,{type:"button",variant:"outline",onClick:a,children:r("cancel")})]})]})]})}function ar({budget:t,onClose:a,onAdd:s}){const{t:r}=Z("common"),{data:n}=Xe(),i=pa(),[o,c]=v.useState(null),[l,d]=v.useState(""),[u,h]=v.useState(""),[f,p]=v.useState(!1),[m,g]=v.useState(""),[y,j]=v.useState("ðŸ“"),x=v.useMemo(()=>new Set(t.allocations.map(k=>k.category)),[t.allocations]),b=v.useMemo(()=>{const k=t.allocations.reduce((N,_)=>N+_.amount,0);return t.monthly_income-(t.savings_target||0)-k},[t]),P=(n==null?void 0:n.expense)||[],S=k=>{k.children.filter(_=>!x.has(_.name)).length===0&&!x.has(k.name)?d(k.name):c(k),p(!1)},B=k=>{d(k.name)},z=()=>{c(null),d(""),p(!1)},L=async()=>{!o||!m.trim()||(await i.mutateAsync({name:m.trim(),icon:y,parent_id:o.id,type:"expense"}),d(m.trim()),g(""),p(!1))},V=k=>{k.preventDefault(),!(!l||parseInt(u)<=0)&&s(l,parseInt(u))},E=Math.floor(b/3);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(Q,{className:"w-full max-w-md animate-in fade-in zoom-in duration-200 max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r("budget.addCategory")}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:V,className:"p-4 space-y-4 overflow-y-auto flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("budget.category")}),l?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[e.jsx("span",{className:"flex-1 font-medium text-blue-700 dark:text-blue-300",children:l}),e.jsx("button",{type:"button",onClick:()=>{d(""),c(null)},className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",children:r("change","Change")})]}):o?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:z,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(gt,{className:"w-4 h-4"}),o.icon," ",o.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.children.map(k=>{const N=x.has(k.name);return e.jsxs("button",{type:"button",onClick:()=>!N&&B(k),disabled:N,className:w("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",N?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:k.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:k.name}),N&&e.jsx("span",{className:"text-[10px] text-gray-400",children:r("budget.alreadyAdded","Added")})]},k.id)}),e.jsxs("button",{type:"button",onClick:()=>p(!0),className:w("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(Ae,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("category.addCustom","Add")})]})]}),f&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Je,{value:y,onChange:k=>j(k.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(Je,{value:m,onChange:k=>g(k.target.value),placeholder:r("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(W,{type:"button",variant:"outline",size:"sm",onClick:()=>p(!1),children:r("cancel","Cancel")}),e.jsx(W,{type:"button",size:"sm",onClick:L,disabled:!m.trim()||i.isPending,children:r("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:P.map(k=>{const N=k.children.filter(A=>!x.has(A.name)),_=N.length===0&&x.has(k.name);return e.jsxs("button",{type:"button",onClick:()=>!_&&S(k),disabled:_,className:w("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",_?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:k.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:k.name}),N.length>0&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:[N.length," ",r("budget.available","available")]})]},k.id)})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("budget.amount")}),e.jsx(Je,{type:"number",value:u,onChange:k=>h(k.target.value),placeholder:st(0),min:1,autoFocus:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[r("budget.remainingBudget"),": ",st(b)]})]}),E>0&&e.jsx("button",{type:"button",onClick:()=>h(String(E)),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:r("budget.suggestAmount",{amount:st(E)})})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(W,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:r("cancel")}),e.jsxs(W,{type:"submit",disabled:!l||parseInt(u)<=0,className:"flex-1",children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),r("budget.add")]})]})]})]})})}function rr({isOpen:t,onConfirm:a,onCancel:s,monthlyIncome:r,totalAllocated:n,savingsTarget:i,categoryCount:o,isLoading:c=!1}){const{t:l}=Z("common"),{currency:d}=oe(),{isPrivacyMode:u}=de(),{data:h}=ie(),f=g=>ue(g,d,(h==null?void 0:h.rates)||{},!1,u);if(!t)return null;const p=r-n-i,m=p<0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:w("fixed z-50 bg-white dark:bg-gray-800 shadow-xl","inset-x-0 bottom-0 rounded-t-2xl","lg:inset-auto lg:left-1/2 lg:top-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2","lg:rounded-xl lg:max-w-md lg:w-full"),role:"dialog","aria-modal":"true","aria-labelledby":"confirm-dialog-title",children:[e.jsx("div",{className:"lg:hidden flex justify-center pt-3 pb-1",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("h2",{id:"confirm-dialog-title",className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:l("budget.confirmDialog.title")}),e.jsx("button",{onClick:s,className:"p-2 -mr-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":l("button.close"),children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:l("budget.monthlyIncome")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:f(r)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:l("budget.totalAllocated")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:f(n)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:l("budget.savingsTarget")}),e.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400",children:f(i)})]}),e.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:l(m?"budget.overAllocated":"budget.confirmDialog.unallocated")}),e.jsx("span",{className:w("font-semibold",m?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"),children:m?`-${f(Math.abs(p))}`:f(p)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(Pe,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:l("budget.confirmDialog.categoriesConfigured",{count:o})})]}),m&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-400",children:l("budget.confirmDialog.overAllocatedWarning")})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(W,{variant:"outline",onClick:s,className:"flex-1",disabled:c,children:l("button.cancel")}),e.jsx(W,{onClick:a,className:"flex-1",disabled:c,children:l(c?"budget.saving":"budget.save")})]})]})]})}const ve=[{id:"overview",labelKey:"budget.tabs.overview",icon:ft},{id:"categories",labelKey:"budget.tabs.categories",icon:Ha},{id:"transactions",labelKey:"budget.tabs.transactions",icon:aa},{id:"forecast",labelKey:"budget.tabs.forecast",icon:Ce}];function sr({activeTab:t,onTabChange:a,children:s,className:r}){const{t:n}=Z("common"),i=(l,d)=>{let u=d;l.key==="ArrowLeft"?(l.preventDefault(),u=d>0?d-1:ve.length-1):l.key==="ArrowRight"?(l.preventDefault(),u=d<ve.length-1?d+1:0):l.key==="Home"?(l.preventDefault(),u=0):l.key==="End"&&(l.preventDefault(),u=ve.length-1),u!==d&&a(ve[u].id)},o=ve.find(l=>l.id===t),c=(o==null?void 0:o.icon)||ft;return e.jsxs("div",{className:w("flex flex-col",r),children:[e.jsx("div",{className:"hidden md:flex items-center gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg mb-4",role:"tablist","aria-label":n("budget.tabs.navigation"),children:ve.map((l,d)=>{const u=l.icon,h=t===l.id;return e.jsxs("button",{role:"tab","aria-selected":h,"aria-controls":`tabpanel-${l.id}`,tabIndex:h?0:-1,onClick:()=>a(l.id),onKeyDown:f=>i(f,d),className:w("flex items-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-all","focus:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2",h?"bg-white dark:bg-gray-900 text-green-600 dark:text-green-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"),children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:n(l.labelKey)})]},l.id)})}),e.jsx("div",{className:"md:hidden mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:t,onChange:l=>a(l.target.value),className:w("w-full appearance-none pl-10 pr-10 py-3 rounded-lg","bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white","border border-gray-200 dark:border-gray-700","font-medium text-sm","focus:outline-none focus:ring-2 focus:ring-green-500"),"aria-label":n("budget.tabs.selectTab"),children:ve.map(l=>e.jsx("option",{value:l.id,children:n(l.labelKey)},l.id))}),e.jsx(c,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 pointer-events-none"}),e.jsx(qt,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 pointer-events-none"})]})}),e.jsx("div",{id:`tabpanel-${t}`,role:"tabpanel","aria-labelledby":`tab-${t}`,tabIndex:0,children:s})]})}function nr({preview:t,formatCurrency:a,formatMonth:s,onCopy:r,onGenerateAI:n,onStartEmpty:i,isLoading:o}){const{t:c}=Z("common"),l=t.spending_summary.reduce((h,f)=>h+f.budgeted,0),d=t.spending_summary.reduce((h,f)=>h+f.spent,0),u=t.spending_summary.filter(h=>h.over_budget).length;return e.jsxs(Q,{className:"p-6 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx(kt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:c("budget.createForMonth",{month:s(t.target_month)})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:c("budget.copyFromPrevious",{month:s(t.source_budget.month)})})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:c("budget.totalBudgeted")}),e.jsx("span",{className:"font-medium",children:a(l)})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:c("budget.totalSpent")}),e.jsx("span",{className:"font-medium",children:a(d)})]}),u>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600 dark:text-orange-400",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:c("budget.categoriesOverBudget",{count:u})})]})]}),e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:c("budget.categoryPreview")}),t.spending_summary.slice(0,5).map(h=>e.jsxs("div",{className:w("flex items-center justify-between text-sm p-2 rounded",h.over_budget&&"bg-red-50 dark:bg-red-900/20"),children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:h.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[a(h.spent)," / ",a(h.budgeted)]}),h.over_budget&&e.jsx(ce,{className:"w-3.5 h-3.5 text-red-500"})]})]},h.category)),t.spending_summary.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["+",t.spending_summary.length-5," ",c("budget.moreCategories")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{onClick:r,disabled:o,className:"w-full",children:[e.jsx(kt,{className:"w-4 h-4 mr-2"}),c("budget.copyAndEdit")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{variant:"outline",onClick:n,disabled:o,className:"flex-1",children:[e.jsx(ra,{className:"w-4 h-4 mr-2"}),c("budget.generateWithAI")]}),e.jsxs(W,{variant:"ghost",onClick:i,disabled:o,className:"flex-1",children:[e.jsx(fa,{className:"w-4 h-4 mr-2"}),c("budget.startEmpty")]})]})]})]})}function or({versions:t,currentVersion:a,formatCurrency:s,onRestore:r,isRestoring:n}){const{t:i}=Z("common"),[o,c]=v.useState(!1);if(t.length<=1)return null;const l=d=>new Date(d).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>c(!o),className:w("flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-colors","text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800",o&&"bg-gray-100 dark:bg-gray-800"),children:[e.jsx(Ja,{className:"w-4 h-4"}),e.jsxs("span",{children:["v",a]}),e.jsx(qt,{className:w("w-3.5 h-3.5 transition-transform",o&&"rotate-180")})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:i("budget.versionHistory")})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.map(d=>e.jsxs("div",{className:w("px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700/50",d.is_active&&"bg-blue-50 dark:bg-blue-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-sm",children:["v",d.version]}),d.is_active&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(xt,{className:"w-3 h-3"}),i("budget.current")]}),d.copied_from_id&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i("budget.copied"),")"]})]}),!d.is_active&&e.jsxs("button",{onClick:()=>{r(d.id),c(!1)},disabled:n,className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",children:[e.jsx(va,{className:"w-3 h-3"}),i("budget.restore")]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:l(d.created_at)}),e.jsx("span",{className:"mx-1",children:"Â·"}),e.jsx("span",{children:s(d.total_allocated)})]})]},d.id))})]})]})]})}function ir({spent:t,projected:a,budget:s,className:r}){const n=Math.min(100,t/s*100),i=Math.min(100,a/s*100),o=Math.max(0,i-n),c=()=>i>100?"bg-red-500":i>90?"bg-amber-500":"bg-green-500";return e.jsxs("div",{className:w("relative h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",r),children:[e.jsx("div",{className:"absolute left-0 top-0 h-full bg-blue-500 transition-all duration-500",style:{width:`${n}%`}}),o>0&&e.jsx("div",{className:w("absolute top-0 h-full border-l-2 border-white/50",c(),"transition-all duration-500"),style:{width:`${o}%`}}),e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-gray-400 dark:bg-gray-500",style:{left:"100%"}})]})}function lr({totalBudget:t,totalSpent:a,month:s,className:r}){const{t:n}=Z("common"),{currency:i}=oe(),{isPrivacyMode:o}=de(),{data:c}=ie(),l=P=>ue(P,i,(c==null?void 0:c.rates)||{},!1,o),{daysRemaining:d,daysElapsed:u,dailyRate:h,safeDaily:f,projectedTotal:p,projectedPercent:m,overUnderAmount:g,status:y}=v.useMemo(()=>{const[P,S]=s.split("-").map(Number),B=new Date(P,S,0).getDate(),L=new Date().getDate(),V=Math.max(1,L),E=Math.max(0,B-L),k=a/V,N=t-a,_=E>0?N/E:0,A=a+k*E,R=t>0?A/t*100:0,G=A-t;let q;return R>100?q="danger":R>90?q="warning":q="good",{daysRemaining:E,daysElapsed:V,dailyRate:k,safeDaily:_,projectedTotal:A,projectedPercent:R,overUnderAmount:G,status:q}},[s,a,t]),x=(()=>{switch(y){case"danger":return{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-400",icon:ce,label:n("budget.projection.status.overBudget"),message:n("budget.projection.overBy",{amount:l(p-t)})};case"warning":return{bg:"bg-amber-100 dark:bg-amber-900/30",text:"text-amber-700 dark:text-amber-400",icon:ce,label:n("budget.projection.status.atRisk"),message:n("budget.projection.atPace",{amount:l(p)})};default:return{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-400",icon:Pe,label:n("budget.projection.status.onTrack"),message:n("budget.projection.underBy",{amount:l(t-p)})}}})(),b=x.icon;return t<=0?null:e.jsxs(Q,{className:w("overflow-hidden",r),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("budget.projection.title")})]}),e.jsxs("div",{className:w("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",x.bg,x.text),children:[e.jsx(b,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:x.label})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(sa,{className:"w-4 h-4"}),e.jsx("span",{children:n("budget.projection.daysLeft",{count:d})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:w("p-3 rounded-lg",h>f&&f>0?"bg-amber-50 dark:bg-amber-900/20":"bg-gray-50 dark:bg-gray-800/50"),children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:n("budget.projection.currentPace")}),e.jsxs("p",{className:w("text-xl font-bold",h>f&&f>0?"text-amber-700 dark:text-amber-400":"text-gray-900 dark:text-gray-100"),children:[l(h),e.jsxs("span",{className:"text-xs font-normal text-gray-500",children:["/",n("day")]})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:n("budget.projection.safePace")}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-400",children:[f>0?l(f):"â€”",f>0&&e.jsxs("span",{className:"text-xs font-normal text-gray-500",children:["/",n("day")]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm px-1",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[n("budget.projection.spent"),": ",l(a)]}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[n("budget.projection.ofBudget"),": ",l(t)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:n("budget.projection.percentOfBudget",{percent:Math.round(m)})}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[l(t)," ",n("budget.projection.ofBudget")]})]}),e.jsx(ir,{spent:a,projected:p,budget:t}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 dark:text-gray-500 mt-1",children:[e.jsx("span",{children:l(a)}),e.jsx("span",{children:l(t)})]})]}),e.jsxs("div",{className:w("flex items-start gap-2 p-3 rounded-lg text-sm",x.bg),role:"alert","aria-live":"polite",children:[e.jsx(b,{className:w("w-4 h-4 mt-0.5 flex-shrink-0",x.text),"aria-hidden":"true"}),e.jsxs("div",{className:x.text,children:[e.jsx("p",{className:"font-medium",children:x.label}),e.jsx("p",{className:"mt-0.5 opacity-90",children:x.message})]})]})]})]})}var cr=["points","className","baseLinePoints","connectNulls"];function De(){return De=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},De.apply(this,arguments)}function dr(t,a){if(t==null)return{};var s=ur(t,a),r,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function ur(t,a){if(t==null)return{};var s={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(a.indexOf(r)>=0)continue;s[r]=t[r]}return s}function wt(t){return hr(t)||xr(t)||gr(t)||mr()}function mr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gr(t,a){if(t){if(typeof t=="string")return ct(t,a);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ct(t,a)}}function xr(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function hr(t){if(Array.isArray(t))return ct(t)}function ct(t,a){(a==null||a>t.length)&&(a=t.length);for(var s=0,r=new Array(a);s<a;s++)r[s]=t[s];return r}var St=function(a){return a&&a.x===+a.x&&a.y===+a.y},pr=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=[[]];return a.forEach(function(r){St(r)?s[s.length-1].push(r):s[s.length-1].length>0&&s.push([])}),St(a[0])&&s[s.length-1].push(a[0]),s[s.length-1].length<=0&&(s=s.slice(0,-1)),s},Ke=function(a,s){var r=pr(a);s&&(r=[r.reduce(function(i,o){return[].concat(wt(i),wt(o))},[])]);var n=r.map(function(i){return i.reduce(function(o,c,l){return"".concat(o).concat(l===0?"M":"L").concat(c.x,",").concat(c.y)},"")}).join("");return r.length===1?"".concat(n,"Z"):n},fr=function(a,s,r){var n=Ke(a,r);return"".concat(n.slice(-1)==="Z"?n.slice(0,-1):n,"L").concat(Ke(s.reverse(),r).slice(1))},br=function(a){var s=a.points,r=a.className,n=a.baseLinePoints,i=a.connectNulls,o=dr(a,cr);if(!s||!s.length)return null;var c=ye("recharts-polygon",r);if(n&&n.length){var l=o.stroke&&o.stroke!=="none",d=fr(s,n,i);return F.createElement("g",{className:c},F.createElement("path",De({},ee(o,!0),{fill:d.slice(-1)==="Z"?o.fill:"none",stroke:"none",d})),l?F.createElement("path",De({},ee(o,!0),{fill:"none",d:Ke(s,i)})):null,l?F.createElement("path",De({},ee(o,!0),{fill:"none",d:Ke(n,i)})):null)}var u=Ke(s,i);return F.createElement("path",De({},ee(o,!0),{fill:u.slice(-1)==="Z"?o.fill:"none",className:c,d:u}))},yr=zt,vr=ja,jr=Ut;function Nr(t,a){return t&&t.length?yr(t,jr(a),vr):void 0}var kr=Nr;const wr=Rt(kr);var Sr=zt,Ar=Ut,Pr=Na;function Cr(t,a){return t&&t.length?Sr(t,Ar(a),Pr):void 0}var _r=Cr;const Tr=Rt(_r);var Or=["cx","cy","angle","ticks","axisLine"],Mr=["ticks","tick","angle","tickFormatter","stroke"];function Le(t){"@babel/helpers - typeof";return Le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Le(t)}function Ve(){return Ve=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Ve.apply(this,arguments)}function At(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,r)}return s}function je(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?At(Object(s),!0).forEach(function(r){et(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):At(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function Pt(t,a){if(t==null)return{};var s=Dr(t,a),r,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function Dr(t,a){if(t==null)return{};var s={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(a.indexOf(r)>=0)continue;s[r]=t[r]}return s}function Er(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function Ct(t,a){for(var s=0;s<a.length;s++){var r=a[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yt(r.key),r)}}function $r(t,a,s){return a&&Ct(t.prototype,a),s&&Ct(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lr(t,a,s){return a=Ye(a),Br(t,Ht()?Reflect.construct(a,s||[],Ye(t).constructor):a.apply(t,s))}function Br(t,a){if(a&&(Le(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Rr(t)}function Rr(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ht=function(){return!!t})()}function Ye(t){return Ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Ye(t)}function Fr(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),a&&dt(t,a)}function dt(t,a){return dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},dt(t,a)}function et(t,a,s){return a=Yt(a),a in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function Yt(t){var a=Ir(t,"string");return Le(a)=="symbol"?a:a+""}function Ir(t,a){if(Le(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,a);if(Le(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var tt=function(t){function a(){return Er(this,a),Lr(this,a,arguments)}return Fr(a,t),$r(a,[{key:"getTickValueCoord",value:function(r){var n=r.coordinate,i=this.props,o=i.angle,c=i.cx,l=i.cy;return pe(c,l,n,o)}},{key:"getTickTextAnchor",value:function(){var r=this.props.orientation,n;switch(r){case"left":n="end";break;case"right":n="start";break;default:n="middle";break}return n}},{key:"getViewBox",value:function(){var r=this.props,n=r.cx,i=r.cy,o=r.angle,c=r.ticks,l=wr(c,function(u){return u.coordinate||0}),d=Tr(c,function(u){return u.coordinate||0});return{cx:n,cy:i,startAngle:o,endAngle:o,innerRadius:d.coordinate||0,outerRadius:l.coordinate||0}}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.cx,i=r.cy,o=r.angle,c=r.ticks,l=r.axisLine,d=Pt(r,Or),u=c.reduce(function(m,g){return[Math.min(m[0],g.coordinate),Math.max(m[1],g.coordinate)]},[1/0,-1/0]),h=pe(n,i,u[0],o),f=pe(n,i,u[1],o),p=je(je(je({},ee(d,!1)),{},{fill:"none"},ee(l,!1)),{},{x1:h.x,y1:h.y,x2:f.x,y2:f.y});return F.createElement("line",Ve({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var r=this,n=this.props,i=n.ticks,o=n.tick,c=n.angle,l=n.tickFormatter,d=n.stroke,u=Pt(n,Mr),h=this.getTickTextAnchor(),f=ee(u,!1),p=ee(o,!1),m=i.map(function(g,y){var j=r.getTickValueCoord(g),x=je(je(je(je({textAnchor:h,transform:"rotate(".concat(90-c,", ").concat(j.x,", ").concat(j.y,")")},f),{},{stroke:"none",fill:d},p),{},{index:y},j),{},{payload:g});return F.createElement(ge,Ve({className:ye("recharts-polar-radius-axis-tick",Jt(o)),key:"tick-".concat(g.coordinate)},pt(r.props,g,y)),a.renderTickItem(o,x,l?l(g.value,y):g.value))});return F.createElement(ge,{className:"recharts-polar-radius-axis-ticks"},m)}},{key:"render",value:function(){var r=this.props,n=r.ticks,i=r.axisLine,o=r.tick;return!n||!n.length?null:F.createElement(ge,{className:ye("recharts-polar-radius-axis",this.props.className)},i&&this.renderAxisLine(),o&&this.renderTicks(),Wt.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(r,n,i){var o;return F.isValidElement(r)?o=F.cloneElement(r,n):we(r)?o=r(n):o=F.createElement(ht,Ve({},n,{className:"recharts-polar-radius-axis-tick-value"}),i),o}}])}(v.PureComponent);et(tt,"displayName","PolarRadiusAxis");et(tt,"axisType","radiusAxis");et(tt,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Be(t){"@babel/helpers - typeof";return Be=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Be(t)}function Se(){return Se=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Se.apply(this,arguments)}function _t(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,r)}return s}function Ne(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?_t(Object(s),!0).forEach(function(r){at(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_t(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function Kr(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function Tt(t,a){for(var s=0;s<a.length;s++){var r=a[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zt(r.key),r)}}function Vr(t,a,s){return a&&Tt(t.prototype,a),s&&Tt(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function qr(t,a,s){return a=Qe(a),zr(t,Qt()?Reflect.construct(a,s||[],Qe(t).constructor):a.apply(t,s))}function zr(t,a){if(a&&(Be(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ur(t)}function Ur(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Qt=function(){return!!t})()}function Qe(t){return Qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Qe(t)}function Jr(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),a&&ut(t,a)}function ut(t,a){return ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},ut(t,a)}function at(t,a,s){return a=Zt(a),a in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function Zt(t){var a=Wr(t,"string");return Be(a)=="symbol"?a:a+""}function Wr(t,a){if(Be(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,a);if(Be(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Gr=Math.PI/180,Ot=1e-5,rt=function(t){function a(){return Kr(this,a),qr(this,a,arguments)}return Jr(a,t),Vr(a,[{key:"getTickLineCoord",value:function(r){var n=this.props,i=n.cx,o=n.cy,c=n.radius,l=n.orientation,d=n.tickSize,u=d||8,h=pe(i,o,c,r.coordinate),f=pe(i,o,c+(l==="inner"?-1:1)*u,r.coordinate);return{x1:h.x,y1:h.y,x2:f.x,y2:f.y}}},{key:"getTickTextAnchor",value:function(r){var n=this.props.orientation,i=Math.cos(-r.coordinate*Gr),o;return i>Ot?o=n==="outer"?"start":"end":i<-Ot?o=n==="outer"?"end":"start":o="middle",o}},{key:"renderAxisLine",value:function(){var r=this.props,n=r.cx,i=r.cy,o=r.radius,c=r.axisLine,l=r.axisLineType,d=Ne(Ne({},ee(this.props,!1)),{},{fill:"none"},ee(c,!1));if(l==="circle")return F.createElement(ka,Se({className:"recharts-polar-angle-axis-line"},d,{cx:n,cy:i,r:o}));var u=this.props.ticks,h=u.map(function(f){return pe(n,i,o,f.coordinate)});return F.createElement(br,Se({className:"recharts-polar-angle-axis-line"},d,{points:h}))}},{key:"renderTicks",value:function(){var r=this,n=this.props,i=n.ticks,o=n.tick,c=n.tickLine,l=n.tickFormatter,d=n.stroke,u=ee(this.props,!1),h=ee(o,!1),f=Ne(Ne({},u),{},{fill:"none"},ee(c,!1)),p=i.map(function(m,g){var y=r.getTickLineCoord(m),j=r.getTickTextAnchor(m),x=Ne(Ne(Ne({textAnchor:j},u),{},{stroke:"none",fill:d},h),{},{index:g,payload:m,x:y.x2,y:y.y2});return F.createElement(ge,Se({className:ye("recharts-polar-angle-axis-tick",Jt(o)),key:"tick-".concat(m.coordinate)},pt(r.props,m,g)),c&&F.createElement("line",Se({className:"recharts-polar-angle-axis-tick-line"},f,y)),o&&a.renderTickItem(o,x,l?l(m.value,g):m.value))});return F.createElement(ge,{className:"recharts-polar-angle-axis-ticks"},p)}},{key:"render",value:function(){var r=this.props,n=r.ticks,i=r.radius,o=r.axisLine;return i<=0||!n||!n.length?null:F.createElement(ge,{className:ye("recharts-polar-angle-axis",this.props.className)},o&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(r,n,i){var o;return F.isValidElement(r)?o=F.cloneElement(r,n):we(r)?o=r(n):o=F.createElement(ht,Se({},n,{className:"recharts-polar-angle-axis-tick-value"}),i),o}}])}(v.PureComponent);at(rt,"displayName","PolarAngleAxis");at(rt,"axisType","angleAxis");at(rt,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var Ge;function Re(t){"@babel/helpers - typeof";return Re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Re(t)}function Ee(){return Ee=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Ee.apply(this,arguments)}function Mt(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,r)}return s}function J(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?Mt(Object(s),!0).forEach(function(r){le(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Mt(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function Hr(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function Dt(t,a){for(var s=0;s<a.length;s++){var r=a[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ea(r.key),r)}}function Yr(t,a,s){return a&&Dt(t.prototype,a),s&&Dt(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Qr(t,a,s){return a=Ze(a),Zr(t,Xt()?Reflect.construct(a,s||[],Ze(t).constructor):a.apply(t,s))}function Zr(t,a){if(a&&(Re(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xr(t)}function Xr(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xt=function(){return!!t})()}function Ze(t){return Ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Ze(t)}function es(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),a&&mt(t,a)}function mt(t,a){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},mt(t,a)}function le(t,a,s){return a=ea(a),a in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function ea(t){var a=ts(t,"string");return Re(a)=="symbol"?a:a+""}function ts(t,a){if(Re(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,a);if(Re(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var fe=function(t){function a(s){var r;return Hr(this,a),r=Qr(this,a,[s]),le(r,"pieRef",null),le(r,"sectorRefs",[]),le(r,"id",Ta("recharts-pie-")),le(r,"handleAnimationEnd",function(){var n=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),we(n)&&n()}),le(r,"handleAnimationStart",function(){var n=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),we(n)&&n()}),r.state={isAnimationFinished:!s.isAnimationActive,prevIsAnimationActive:s.isAnimationActive,prevAnimationId:s.animationId,sectorToFocus:0},r}return es(a,t),Yr(a,[{key:"isActiveIndex",value:function(r){var n=this.props.activeIndex;return Array.isArray(n)?n.indexOf(r)!==-1:r===n}},{key:"hasActiveIndex",value:function(){var r=this.props.activeIndex;return Array.isArray(r)?r.length!==0:r||r===0}},{key:"renderLabels",value:function(r){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.label,c=i.labelLine,l=i.dataKey,d=i.valueKey,u=ee(this.props,!1),h=ee(o,!1),f=ee(c,!1),p=o&&o.offsetRadius||20,m=r.map(function(g,y){var j=(g.startAngle+g.endAngle)/2,x=pe(g.cx,g.cy,g.outerRadius+p,j),b=J(J(J(J({},u),g),{},{stroke:"none"},h),{},{index:y,textAnchor:a.getTextAnchor(x.x,g.cx)},x),P=J(J(J(J({},u),g),{},{fill:"none",stroke:g.fill},f),{},{index:y,points:[pe(g.cx,g.cy,g.outerRadius,j),x]}),S=l;return $e(l)&&$e(d)?S="value":$e(l)&&(S=d),F.createElement(ge,{key:"label-".concat(g.startAngle,"-").concat(g.endAngle,"-").concat(g.midAngle,"-").concat(y)},c&&a.renderLabelLineItem(c,P,"line"),a.renderLabelItem(o,b,Te(g,S)))});return F.createElement(ge,{className:"recharts-pie-labels"},m)}},{key:"renderSectorsStatically",value:function(r){var n=this,i=this.props,o=i.activeShape,c=i.blendStroke,l=i.inactiveShape;return r.map(function(d,u){if((d==null?void 0:d.startAngle)===0&&(d==null?void 0:d.endAngle)===0&&r.length!==1)return null;var h=n.isActiveIndex(u),f=l&&n.hasActiveIndex()?l:null,p=h?o:f,m=J(J({},d),{},{stroke:c?d.fill:d.stroke,tabIndex:-1});return F.createElement(ge,Ee({ref:function(y){y&&!n.sectorRefs.includes(y)&&n.sectorRefs.push(y)},tabIndex:-1,className:"recharts-pie-sector"},pt(n.props,d,u),{key:"sector-".concat(d==null?void 0:d.startAngle,"-").concat(d==null?void 0:d.endAngle,"-").concat(d.midAngle,"-").concat(u)}),F.createElement(Sa,Ee({option:p,isActive:h,shapeType:"sector"},m)))})}},{key:"renderSectorsWithAnimation",value:function(){var r=this,n=this.props,i=n.sectors,o=n.isAnimationActive,c=n.animationBegin,l=n.animationDuration,d=n.animationEasing,u=n.animationId,h=this.state,f=h.prevSectors,p=h.prevIsAnimationActive;return F.createElement(Aa,{begin:c,duration:l,isActive:o,easing:d,from:{t:0},to:{t:1},key:"pie-".concat(u,"-").concat(p),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(m){var g=m.t,y=[],j=i&&i[0],x=j.startAngle;return i.forEach(function(b,P){var S=f&&f[P],B=P>0?Pa(b,"paddingAngle",0):0;if(S){var z=jt(S.endAngle-S.startAngle,b.endAngle-b.startAngle),L=J(J({},b),{},{startAngle:x+B,endAngle:x+z(g)+B});y.push(L),x=L.endAngle}else{var V=b.endAngle,E=b.startAngle,k=jt(0,V-E),N=k(g),_=J(J({},b),{},{startAngle:x+B,endAngle:x+N+B});y.push(_),x=_.endAngle}}),F.createElement(ge,null,r.renderSectorsStatically(y))})}},{key:"attachKeyboardHandlers",value:function(r){var n=this;r.onkeydown=function(i){if(!i.altKey)switch(i.key){case"ArrowLeft":{var o=++n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[o].focus(),n.setState({sectorToFocus:o});break}case"ArrowRight":{var c=--n.state.sectorToFocus<0?n.sectorRefs.length-1:n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[c].focus(),n.setState({sectorToFocus:c});break}case"Escape":{n.sectorRefs[n.state.sectorToFocus].blur(),n.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var r=this.props,n=r.sectors,i=r.isAnimationActive,o=this.state.prevSectors;return i&&n&&n.length&&(!o||!Ca(o,n))?this.renderSectorsWithAnimation():this.renderSectorsStatically(n)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var r=this,n=this.props,i=n.hide,o=n.sectors,c=n.className,l=n.label,d=n.cx,u=n.cy,h=n.innerRadius,f=n.outerRadius,p=n.isAnimationActive,m=this.state.isAnimationFinished;if(i||!o||!o.length||!Me(d)||!Me(u)||!Me(h)||!Me(f))return null;var g=ye("recharts-pie",c);return F.createElement(ge,{tabIndex:this.props.rootTabIndex,className:g,ref:function(j){r.pieRef=j}},this.renderSectors(),l&&this.renderLabels(o),Wt.renderCallByParent(this.props,null,!1),(!p||m)&&_a.renderCallByParent(this.props,o,!1))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return n.prevIsAnimationActive!==r.isAnimationActive?{prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:[],isAnimationFinished:!0}:r.isAnimationActive&&r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:n.curSectors,isAnimationFinished:!0}:r.sectors!==n.curSectors?{curSectors:r.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(r,n){return r>n?"start":r<n?"end":"middle"}},{key:"renderLabelLineItem",value:function(r,n,i){if(F.isValidElement(r))return F.cloneElement(r,n);if(we(r))return r(n);var o=ye("recharts-pie-label-line",typeof r!="boolean"?r.className:"");return F.createElement(wa,Ee({},n,{key:i,type:"linear",className:o}))}},{key:"renderLabelItem",value:function(r,n,i){if(F.isValidElement(r))return F.cloneElement(r,n);var o=i;if(we(r)&&(o=r(n),F.isValidElement(o)))return o;var c=ye("recharts-pie-label-text",typeof r!="boolean"&&!we(r)?r.className:"");return F.createElement(ht,Ee({},n,{alignmentBaseline:"middle",className:c}),o)}}])}(v.PureComponent);Ge=fe;le(fe,"displayName","Pie");le(fe,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Oa.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});le(fe,"parseDeltaAngle",function(t,a){var s=We(a-t),r=Math.min(Math.abs(a-t),360);return s*r});le(fe,"getRealPieData",function(t){var a=t.data,s=t.children,r=ee(t,!1),n=Ma(s,Gt);return a&&a.length?a.map(function(i,o){return J(J(J({payload:i},r),i),n&&n[o]&&n[o].props)}):n&&n.length?n.map(function(i){return J(J({},r),i.props)}):[]});le(fe,"parseCoordinateOfPie",function(t,a){var s=a.top,r=a.left,n=a.width,i=a.height,o=Da(n,i),c=r+ze(t.cx,n,n/2),l=s+ze(t.cy,i,i/2),d=ze(t.innerRadius,o,0),u=ze(t.outerRadius,o,o*.8),h=t.maxRadius||Math.sqrt(n*n+i*i)/2;return{cx:c,cy:l,innerRadius:d,outerRadius:u,maxRadius:h}});le(fe,"getComposedData",function(t){var a=t.item,s=t.offset,r=a.type.defaultProps!==void 0?J(J({},a.type.defaultProps),a.props):a.props,n=Ge.getRealPieData(r);if(!n||!n.length)return null;var i=r.cornerRadius,o=r.startAngle,c=r.endAngle,l=r.paddingAngle,d=r.dataKey,u=r.nameKey,h=r.valueKey,f=r.tooltipType,p=Math.abs(r.minAngle),m=Ge.parseCoordinateOfPie(r,s),g=Ge.parseDeltaAngle(o,c),y=Math.abs(g),j=d;$e(d)&&$e(h)?(Nt(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),j="value"):$e(d)&&(Nt(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),j=h);var x=n.filter(function(L){return Te(L,j,0)!==0}).length,b=(y>=360?x:x-1)*l,P=y-x*p-b,S=n.reduce(function(L,V){var E=Te(V,j,0);return L+(Me(E)?E:0)},0),B;if(S>0){var z;B=n.map(function(L,V){var E=Te(L,j,0),k=Te(L,u,V),N=(Me(E)?E:0)/S,_;V?_=z.endAngle+We(g)*l*(E!==0?1:0):_=o;var A=_+We(g)*((E!==0?p:0)+N*P),R=(_+A)/2,G=(m.innerRadius+m.outerRadius)/2,q=[{name:k,value:E,payload:L,dataKey:j,type:f}],Y=pe(m.cx,m.cy,G,R);return z=J(J(J({percent:N,cornerRadius:i,name:k,tooltipPayload:q,midAngle:R,middleRadius:G,tooltipPosition:Y},L),m),{},{value:Te(L,j),startAngle:_,endAngle:A,payload:L,paddingAngle:We(g)*l}),z})}return J(J({},m),{},{sectors:B,data:n})});var as=Ea({chartName:"PieChart",GraphicalChild:fe,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:rt},{axisType:"radiusAxis",AxisComp:tt}],formatAxisMap:$a,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const nt=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#6b7280"];function rs({allocations:t,totalBudget:a,totalAllocated:s,className:r}){const{t:n}=Z("common"),{currency:i}=oe(),{isPrivacyMode:o}=de(),{data:c}=ie(),[l,d]=v.useState(null),u=m=>ue(m,i,(c==null?void 0:c.rates)||{},!1,o),h=v.useMemo(()=>{if(!t.length)return[];const m=[...t].sort((b,P)=>P.amount-b.amount),g=m.slice(0,5),j=m.slice(5).reduce((b,P)=>b+P.amount,0),x=g.map((b,P)=>({name:b.category,value:b.amount,percentage:s>0?b.amount/s*100:0,color:nt[P%nt.length]}));return j>0&&x.push({name:n("budget.donutChart.other"),value:j,percentage:s>0?j/s*100:0,color:nt[7]}),x},[t,s,n]),f=a-s,p=m=>{const{cx:g,cy:y,innerRadius:j,outerRadius:x,startAngle:b,endAngle:P,fill:S,payload:B}=m;return e.jsxs("g",{children:[e.jsx(Ba,{cx:g,cy:y,innerRadius:j-2,outerRadius:x+6,startAngle:b,endAngle:P,fill:S}),e.jsx("text",{x:g,y:y-8,textAnchor:"middle",className:"fill-gray-500 dark:fill-gray-400 text-xs",children:B.name}),e.jsx("text",{x:g,y:y+12,textAnchor:"middle",className:"fill-gray-900 dark:fill-gray-100 text-sm font-bold",children:u(B.value)})]})};return t.length?e.jsxs(Q,{className:w("p-4",r),children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("budget.donutChart.title")}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-[200px] h-[200px]",children:[e.jsx(La,{width:"100%",height:"100%",children:e.jsx(as,{children:e.jsx(fe,{data:h,cx:"50%",cy:"50%",innerRadius:55,outerRadius:80,paddingAngle:2,dataKey:"value",activeIndex:l??void 0,activeShape:l!==null?p:void 0,onMouseEnter:(m,g)=>d(g),onMouseLeave:()=>d(null),children:h.map((m,g)=>e.jsx(Gt,{fill:m.color,className:"cursor-pointer transition-opacity hover:opacity-80"},`cell-${g}`))})})}),l===null&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:f>=0?n("budget.donutChart.remaining"):n("budget.overAllocated")}),e.jsx("span",{className:w("text-lg font-bold",f>=0?"text-gray-900 dark:text-gray-100":"text-red-600 dark:text-red-400"),children:f>=0?u(f):`-${u(Math.abs(f))}`})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2 mt-4 w-full max-w-xs",children:h.map((m,g)=>e.jsxs("button",{className:w("flex items-center gap-2 text-left p-1 rounded transition-colors",l===g&&"bg-gray-100 dark:bg-gray-800"),onMouseEnter:()=>d(g),onMouseLeave:()=>d(null),onFocus:()=>d(g),onBlur:()=>d(null),children:[e.jsx("div",{className:"w-3 h-3 rounded-sm flex-shrink-0",style:{backgroundColor:m.color},"aria-hidden":"true"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:m.name}),e.jsxs("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 ml-auto",children:[Math.round(m.percentage),"%"]})]},g))})]})]}):null}function ss({categories:t,daysRemaining:a,onViewCategory:s,className:r}){const{t:n}=Z("common"),{currency:i}=oe(),{isPrivacyMode:o}=de(),{data:c}=ie(),[l,d]=v.useState(new Set),u=y=>ue(y,i,(c==null?void 0:c.rates)||{},!1,o),p=(()=>{const y=[],j=t.filter(S=>S.status==="red"),x=t.filter(S=>S.status==="orange"),b=t.filter(S=>S.status==="green"||S.status==="yellow");j.slice(0,2).forEach(S=>{y.push({type:"exceeded",category:S.category,message:n("budget.alerts.exceededBy",{category:S.category,amount:u(Math.abs(S.remaining))})})});const P=j.length>0?1:2;return x.slice(0,P).forEach(S=>{y.push({type:"warning",category:S.category,message:n("budget.alerts.approaching",{category:S.category,amount:u(S.remaining),days:a})})}),j.length===0&&x.length===0&&b.length>0&&y.push({type:"onTrack",count:b.length,message:n("budget.alerts.allOnTrack",{count:b.length})}),y})().filter(y=>{const j=y.category||"onTrack";return!l.has(j)}),m=y=>{const j=y.category||"onTrack";d(x=>new Set([...x,j]))};if(p.length===0)return null;const g=y=>{switch(y){case"exceeded":return{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-400",icon:Ft};case"warning":return{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",text:"text-amber-700 dark:text-amber-400",icon:ce};case"onTrack":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-400",icon:Pe}}};return e.jsx("div",{className:w("space-y-2",r),children:p.slice(0,2).map((y,j)=>{const x=g(y.type),b=x.icon;return e.jsxs("div",{className:w("flex items-start gap-3 p-3 rounded-lg border",x.bg,x.border),role:"alert",children:[e.jsx(b,{className:w("w-5 h-5 flex-shrink-0 mt-0.5",x.text),"aria-hidden":"true"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:w("text-sm font-medium",x.text),children:y.message})}),e.jsxs("div",{className:"flex items-center gap-1",children:[y.category&&s&&e.jsx("button",{onClick:()=>s(y.category),className:w("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors",x.text),"aria-label":n("viewDetails"),children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>m(y),className:w("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors",x.text),"aria-label":n("button.close"),children:e.jsx(Ie,{className:"w-4 h-4"})})]})]},y.category||`alert-${j}`)})})}function ns({budget:t,tracking:a,previousMonthData:s,selectedMonth:r,onViewCategory:n}){const{t:i}=Z("common"),{currency:o}=oe(),{isPrivacyMode:c}=de(),{data:l}=ie(),d=b=>ue(b,o,(l==null?void 0:l.rates)||{},!0,c),u=t.allocations.reduce((b,P)=>b+P.amount,0),h=t.monthly_income-(t.savings_target||0),f=h-u,p=(a==null?void 0:a.total_spent)||0,m=u>0?p/u*100:0,g=h-p,y=h>0?Math.max(0,g/h*100):0,x=p>u?{status:"danger",label:i("budget.health.overBudgetStatus"),color:"text-red-600 dark:text-red-400",bg:"bg-red-100 dark:bg-red-900/30"}:m>95?{status:"warning",label:i("budget.health.almostFull"),color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-100 dark:bg-amber-900/30"}:m>85?{status:"caution",label:i("budget.health.warningNearLimit"),color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-100 dark:bg-yellow-900/30"}:{status:"good",label:i("budget.health.onTrack"),color:"text-green-600 dark:text-green-400",bg:"bg-green-100 dark:bg-green-900/30"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:w("p-4 rounded-xl border",x.bg,x.color,"border-current/20"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium opacity-70 uppercase tracking-wider mb-1",children:i("budget.availableToSpend")}),e.jsxs("p",{className:w("text-3xl font-bold",g<0?"text-red-600 dark:text-red-400":""),children:[g<0&&"-",d(Math.abs(g))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:w("w-8 h-8 rounded-full flex items-center justify-center",x.status==="danger"?"bg-red-500":x.status==="warning"?"bg-amber-500":x.status==="caution"?"bg-yellow-500":"bg-green-500"),children:x.status==="danger"?e.jsx(ce,{className:"w-4 h-4 text-white"}):e.jsx(Ce,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:x.label})]})]}),e.jsx("div",{className:"h-2 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500",g<0?"bg-red-500":y<20?"bg-amber-500":y<40?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,Math.max(0,y))}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs opacity-80",children:[e.jsxs("span",{children:[d(p)," ",i("budget.spent")]}),e.jsx("span",{children:i("budget.ofTotalBudget",{total:d(h)})})]})]}),e.jsx(lr,{totalBudget:h,totalSpent:p,month:r}),t.allocations.length>0&&e.jsx(rs,{allocations:t.allocations,totalBudget:h,totalAllocated:u}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(na,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:i("budget.monthlyIncome")})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:d(t.monthly_income)}),s&&t.monthly_income-s.monthly_income!==0&&e.jsxs("p",{className:w("text-xs mt-1",t.monthly_income>s.monthly_income?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[t.monthly_income>s.monthly_income?"+":"",d(t.monthly_income-s.monthly_income)]})]}),e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-pink-100 dark:bg-pink-900/30 rounded-lg",children:e.jsx(oa,{className:"w-4 h-4 text-pink-600 dark:text-pink-400"})}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:i("budget.savingsTarget")})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:d(t.savings_target||0)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("budget.percentOfIncome",{percent:Math.round((t.savings_target||0)/t.monthly_income*100)})})]}),e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ia,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:i("budget.remainingBudget")})]}),e.jsxs("p",{className:w("text-xl font-bold",f>=0?"text-blue-600 dark:text-blue-400":"text-red-600 dark:text-red-400"),children:[d(Math.abs(f)),f<0&&"!"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:f>=0?i("budget.availableToSpend"):i("budget.overAllocated")})]})]}),a&&e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("budget.spendingProgress")}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[d(p)," / ",d(u)]})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500",p>u?"bg-red-500":p>u*.9?"bg-amber-500":p>u*.8?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,p/u*100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[Math.round(p/u*100),"%"]}),e.jsxs("span",{children:[a.days_remaining," ",i("budget.daysLeft")]})]})]}),a&&a.categories&&a.categories.length>0&&e.jsx(ss,{categories:a.categories,daysRemaining:a.days_remaining,onViewCategory:n})]})}function os(t){return t>=95?"exceeded":t>=80?"warning":"on_track"}const is={on_track:{icon:Pe,bgColor:"bg-green-100 dark:bg-green-900/30",iconColor:"text-green-600 dark:text-green-400",label:"On Track",ariaLabel:"Budget on track"},warning:{icon:ce,bgColor:"bg-yellow-100 dark:bg-yellow-900/30",iconColor:"text-yellow-600 dark:text-yellow-400",label:"Warning",ariaLabel:"Budget warning - approaching limit"},exceeded:{icon:Ft,bgColor:"bg-red-100 dark:bg-red-900/30",iconColor:"text-red-600 dark:text-red-400",label:"Exceeded",ariaLabel:"Budget exceeded"}};function ls({status:t,className:a}){const s=is[t],r=s.icon;return e.jsx("div",{className:w("flex-shrink-0",a),role:"status","aria-label":s.ariaLabel,children:e.jsx(r,{className:w("w-3.5 h-3.5",s.iconColor),"aria-hidden":"true"})})}function cs({allocations:t,trackingItems:a,selectedCategory:s,onSelectCategory:r,isDraft:n,onAddCategory:i,className:o}){const{t:c}=Z("common"),{currency:l}=oe(),{isPrivacyMode:d}=de(),{data:u}=ie(),h=v.useRef(null),f=v.useRef([]),[p,m]=v.useState(()=>{const x=t.findIndex(b=>b.category===s);return x>=0?x:0});v.useEffect(()=>{const x=t.findIndex(b=>b.category===s);x>=0&&m(x)},[s,t]),v.useEffect(()=>{const x=f.current[p];x==null||x.scrollIntoView({block:"nearest",behavior:"smooth"})},[p]);const g=x=>ue(x,l,(u==null?void 0:u.rates)||{},!0,d),y=x=>a==null?void 0:a.find(b=>b.category===x),j=x=>{if(t.length!==0)switch(x.key){case"ArrowDown":x.preventDefault(),m(b=>b<t.length-1?b+1:0);break;case"ArrowUp":x.preventDefault(),m(b=>b>0?b-1:t.length-1);break;case"Home":x.preventDefault(),m(0);break;case"End":x.preventDefault(),m(t.length-1);break;case"Enter":case" ":x.preventDefault(),r(t[p].category);break}};return e.jsxs("div",{className:w("flex flex-col h-full",o),children:[n&&i&&e.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs(W,{variant:"outline",size:"sm",onClick:i,className:"w-full",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),c("budget.addCategory")]})}),e.jsxs("div",{ref:h,className:"flex-1 overflow-y-auto scrollbar-hide focus:outline-none",role:"listbox",tabIndex:0,"aria-label":c("budget.allocations"),"aria-activedescendant":t.length>0?`category-${p}`:void 0,onKeyDown:j,children:[t.map((x,b)=>{const P=y(x.category),S=(P==null?void 0:P.percentage)||0,B=(P==null?void 0:P.spent)||0,z=os(S),L=s===x.category,V=p===b;return e.jsxs("button",{ref:E=>{f.current[b]=E},id:`category-${b}`,role:"option","aria-selected":L,tabIndex:-1,onClick:()=>{m(b),r(x.category)},className:w("w-full flex items-center justify-between px-4 py-3","text-left transition-all","hover:bg-gray-50 dark:hover:bg-gray-800",V&&"ring-2 ring-inset ring-green-500",L&&"bg-green-50 dark:bg-green-900/20 border-l-3 border-green-500"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:x.category}),e.jsx(ls,{status:z})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g(B)," / ",g(x.amount)]}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:[Math.round(S),"%"]})]})]}),e.jsx(be,{className:w("w-4 h-4 text-gray-400 flex-shrink-0 transition-transform",L&&"text-green-500")})]},x.category)}),t.length===0&&e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:c("budget.noAllocations")})]})]})}function Et(t,a,s){if(a==="JPY")return t;const r=s[a];return!r||r===0?t:Math.round(t/r)}function $t({category:t,month:a,trackingItem:s,isOpen:r,onClose:n,mode:i="overlay",className:o}){const{t:c}=Z("common"),l=It(),{currency:d}=oe(),{isPrivacyMode:u}=de(),{data:h}=ie(),{data:f}=Xe(),[p,m]=v.useState([]),[g,y]=v.useState(!1),[j,x]=v.useState(null),[b,P]=v.useState(null),S=A=>ue(A,d,(h==null?void 0:h.rates)||{},!0,u),B=v.useMemo(()=>{const A=new Map;return f&&(f.expense.forEach(R=>{const G=R.children.map(q=>q.name);A.set(R.name,G)}),f.income.forEach(R=>{const G=R.children.map(q=>q.name);A.set(R.name,G)})),A},[f]),z=v.useMemo(()=>{const A=B.get(t)||[];return[t,...A]},[t,B]),L=v.useMemo(()=>{if(!f)return null;for(const A of[...f.expense,...f.income])if(A.children.some(R=>R.name===t))return A.name;return null},[t,f]);v.useEffect(()=>{if(!r)return;let A=!0;async function R(){y(!0),x(null);try{const[G,q]=a.split("-").map(Number),Y=new Date(G,q,0).getDate(),re=`${G}-${String(q).padStart(2,"0")}-01`,te=`${G}-${String(q).padStart(2,"0")}-${String(Y).padStart(2,"0")}`,X=await He({categories:z,start_date:re,end_date:te,type:"expense"});if(A){const C=(h==null?void 0:h.rates)||{},$=X.filter(I=>!I.is_transfer).map(I=>({...I,amountJpy:Et(Math.abs(I.amount),I.currency||"JPY",C)})).sort((I,K)=>K.amountJpy-I.amountJpy);m($.slice(0,10).map(({amountJpy:I,...K})=>K))}}catch{A&&x("Failed to load transactions")}finally{A&&y(!1)}}return R(),()=>{A=!1}},[t,a,r,z]),v.useEffect(()=>{if(!r)return;let A=!0;async function R(){try{const[G,q]=a.split("-").map(Number);let Y=G,re=q-1;re<1&&(re=12,Y-=1);const[te,X]=[Y,re],C=new Date(te,X,0).getDate(),M=`${te}-${String(X).padStart(2,"0")}-01`,$=`${te}-${String(X).padStart(2,"0")}-${String(C).padStart(2,"0")}`,I=await He({categories:z,start_date:M,end_date:$,type:"expense"});if(A){const K=(h==null?void 0:h.rates)||{},ae=I.filter(D=>!D.is_transfer).reduce((D,me)=>{const _e=Et(Math.abs(me.amount),me.currency||"JPY",K);return D+_e},0);P(ae)}}catch{}}return R(),()=>{A=!1}},[t,a,r,z]),v.useEffect(()=>{if(i!=="overlay"||!r)return;const A=R=>{R.key==="Escape"&&n()};return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[r,i,n]);const V=A=>Kt(A,"MMM d"),E=()=>{n(),l({to:"/transactions",search:{categories:t,month:a}})},k=()=>{n()},N=(s==null?void 0:s.spent)||0,_=b?Math.round((N-b)/b*100):null;return r?i==="inline"?e.jsxs("div",{className:w("flex flex-col h-full",o),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("nav",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:c("budget.title","Budget")}),e.jsx(be,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:c("budget.categories","Categories")}),L&&e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:L})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S((s==null?void 0:s.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S(N)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500",(s==null?void 0:s.status)==="red"?"bg-red-500":(s==null?void 0:s.status)==="orange"?"bg-orange-500":(s==null?void 0:s.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(s==null?void 0:s.percentage)||0)}%`}})}),_!==null&&e.jsxs("div",{className:w("flex items-center gap-2 text-sm",_>0?"text-red-600 dark:text-red-400":_<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[_>0?e.jsx(Ce,{className:"w-4 h-4"}):_<0?e.jsx(bt,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[_>0?"+":"",_,"% vs last month (",S(b||0),")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:c("dashboard.recentTransactions")}),g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(lt,{className:"w-6 h-6 animate-spin text-gray-400"})}):j?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:j})]}):p.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:c("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[p.map(A=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:A.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:V(A.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:S(A.amount)})]},A.id)),p.length>=10&&e.jsxs(W,{variant:"ghost",size:"sm",onClick:E,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:c("dashboard.viewAllCategories")}),e.jsx(vt,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(W,{onClick:k,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:c("transaction.addTransaction")})]}),e.jsx(W,{variant:"outline",onClick:E,className:"w-full",children:e.jsx("span",{children:c("transactions.viewAll")})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 dark:bg-black/50 z-40 lg:hidden",onClick:n}),e.jsxs("div",{className:w("fixed right-0 top-0 h-full w-full sm:w-96 bg-white dark:bg-gray-900 shadow-xl z-50","flex flex-col transform transition-transform duration-300 ease-out",r?"translate-x-0":"translate-x-full",o),children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("nav",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:c("budget.title","Budget")}),e.jsx(be,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:c("budget.categories","Categories")}),L&&e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3 mx-1"}),e.jsx("span",{className:"truncate",children:L})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:t})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors flex-shrink-0 ml-2",children:e.jsx(Ie,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S((s==null?void 0:s.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S(N)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500",(s==null?void 0:s.status)==="red"?"bg-red-500":(s==null?void 0:s.status)==="orange"?"bg-orange-500":(s==null?void 0:s.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(s==null?void 0:s.percentage)||0)}%`}})}),_!==null&&e.jsxs("div",{className:w("flex items-center gap-2 text-sm",_>0?"text-red-600 dark:text-red-400":_<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[_>0?e.jsx(Ce,{className:"w-4 h-4"}):_<0?e.jsx(bt,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[_>0?"+":"",_,"% vs last month (",S(b||0),")"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:c("dashboard.recentTransactions")}),g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(lt,{className:"w-6 h-6 animate-spin text-gray-400"})}):j?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:j})]}):p.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:c("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[p.map(A=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:A.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:V(A.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:S(A.amount)})]},A.id)),p.length>=10&&e.jsxs(W,{variant:"ghost",size:"sm",onClick:E,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:c("dashboard.viewAllCategories")}),e.jsx(vt,{className:"w-3 h-3"})]})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(W,{onClick:k,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:c("transaction.addTransaction")})]}),e.jsx(W,{variant:"outline",onClick:E,className:"w-full",children:e.jsx("span",{children:c("transactions.viewAll")})})]})]})]}):null}function ds(t,a,s){if(a==="JPY")return t;const r=s[a];return!r||r===0?t:Math.round(t/r)}function us(t,a,s,r=3){const{data:n}=ie(),{data:i}=Xe(),o=(n==null?void 0:n.rates)||{},c=v.useMemo(()=>{const u=new Map;return i&&(i.expense.forEach(h=>{const f=h.children.map(p=>p.name);u.set(h.name,f)}),i.income.forEach(h=>{const f=h.children.map(p=>p.name);u.set(h.name,f)})),u},[i]),l=v.useMemo(()=>{const u=new Set;return t.forEach(h=>{u.add(h),(c.get(h)||[]).forEach(p=>u.add(p))}),Array.from(u)},[t,c]);return ke({queryKey:["top-transactions-by-category",a,t.sort().join(",")],queryFn:async()=>{if(t.length===0||!a)return new Map;const[u,h]=a.split("-").map(Number),f=new Date(u,h,0).getDate(),p=`${u}-${String(h).padStart(2,"0")}-01`,m=`${u}-${String(h).padStart(2,"0")}-${String(f).padStart(2,"0")}`,y=(await He({categories:l,start_date:p,end_date:m,type:"expense"})).filter(b=>!b.is_transfer&&!b.is_adjustment),j=new Map;y.forEach(b=>{let P=b.category;for(const[S,B]of c)if(B.includes(b.category)||S===b.category){P=S;break}t.includes(P)&&(j.has(P)||j.set(P,[]),j.get(P).push(b))});const x=new Map;return t.forEach(b=>{const P=j.get(b)||[],S=s.get(b)||0,B=P.map(k=>({id:k.id,description:k.description,amount:k.amount,currency:k.currency,date:k.date,amountJpy:ds(Math.abs(k.amount),k.currency||"JPY",o),isBig:!1}));B.sort((k,N)=>N.amountJpy-k.amountJpy);const z=B.reduce((k,N)=>k+N.amountJpy,0),L=B.length>0?z/B.length:0,V=Math.max(S*.25,L*2),E=B.slice(0,r).map(k=>({...k,isBig:k.amountJpy>V&&k.amountJpy>5e3}));x.set(b,{category:b,transactions:E,totalSpent:z})}),x},enabled:t.length>0&&!!a,staleTime:3e4})}async function ms(t){return(await xe.post("/api/budgets/generate",t)).data}async function gs(t,a){return(await xe.post(`/api/budgets/${t}/regenerate`,a)).data}async function Lt(t){return(await xe.get(`/api/budgets/${t}`)).data}async function xs(){return(await xe.get("/api/budgets/tracking/current")).data}async function hs(){return(await xe.get("/api/budgets/suggestions")).data}async function ps(t,a,s){return(await xe.patch(`/api/budgets/${t}/allocations/${encodeURIComponent(a)}`,{amount:s})).data}async function fs(t,a){return(await xe.delete(`/api/budgets/${t}/allocations/${encodeURIComponent(a)}`)).data}async function bs(t){return(await xe.post("/api/budgets/copy",t)).data}async function ys(t,a){return(await xe.get("/api/budgets/copy/preview",{params:{source_month:t,target_month:a}})).data}async function vs(t){return(await xe.get(`/api/budgets/${t}/versions`)).data}async function js(t){return(await xe.post(`/api/budgets/${t}/restore`)).data}function Ns(t){return t>=100?"over-budget":t>=80?"caution":"on-track"}function ks({status:t}){const{t:a}=Z("common"),s={"on-track":{icon:Pe,label:a("budget.status.onTrack","On Track"),className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},caution:{icon:da,label:a("budget.status.caution","Caution"),className:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400"},"over-budget":{icon:ce,label:a("budget.status.overBudget","Over Budget"),className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}},{icon:r,label:n,className:i}=s[t];return e.jsxs("span",{className:w("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",i),children:[e.jsx(r,{className:"w-3 h-3"}),n]})}function ws({allocation:t,totalBudget:a,trackingItem:s,topTransactions:r=[],daysRemaining:n,parentCategory:i,isDraft:o,isUpdating:c,isDeleting:l,formatCurrency:d,onAmountChange:u,onDelete:h,onCategoryClick:f,onQuickAdjust:p}){const{t:m}=Z("common"),[g,y]=v.useState(!1),[j,x]=v.useState(""),[b,P]=v.useState(!1),S=v.useRef(null),B=O=>{const ae=O.replace(/[^\d]/g,"");return ae?parseInt(ae,10).toLocaleString():""},z=O=>parseInt(O.replace(/[^\d]/g,""),10)||0,L=O=>{O.stopPropagation(),x(t.amount.toLocaleString()),y(!0),setTimeout(()=>{var ae,D;(ae=S.current)==null||ae.focus(),(D=S.current)==null||D.select()},0)},V=()=>{const O=z(j);O!==t.amount&&u(O),y(!1)},E=O=>{O==null||O.stopPropagation(),y(!1)},k=O=>{const ae=B(O.target.value);x(ae)},N=O=>{O.key==="Enter"?V():O.key==="Escape"&&E()},_=O=>{O.stopPropagation(),P(!0)},A=O=>{O.stopPropagation(),h(),P(!1)},R=O=>{O.stopPropagation(),P(!1)},G=a>0?t.amount/a*100:0,q=(s==null?void 0:s.spent)||0,Y=(s==null?void 0:s.budgeted)||t.amount,re=Y-q,te=Y>0?q/Y*100:0,X=q>Y,C=q-Y,M=Ns(te),$=n&&n>0&&re>0?Math.round(re/n):0,I=()=>X?"bg-red-500":te>=80?"bg-orange-500":te>=60?"bg-yellow-500":"bg-green-500",K=()=>{!o&&!b&&f()};return e.jsxs(Q,{className:w("p-4 transition-all",o?"border-dashed border-blue-300 dark:border-blue-700":"cursor-pointer hover:shadow-md hover:border-blue-300 dark:hover:border-blue-600",(c||l)&&"opacity-50 pointer-events-none"),onClick:K,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-semibold dark:text-gray-100 truncate",children:t.category}),s&&e.jsx(ks,{status:M})]}),i&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[m("budget.parentGroup","Group"),": ",i]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[g?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{ref:S,type:"text",inputMode:"numeric",value:j,onChange:k,onKeyDown:N,onClick:O=>O.stopPropagation(),className:"w-28 text-right text-lg font-bold border-2 border-blue-400 rounded px-2 py-1 dark:bg-gray-700 dark:border-blue-500 dark:text-gray-100 focus:outline-none focus:border-blue-500 dark:focus:border-blue-400","aria-label":m("budget.editAmount","Edit amount")}),e.jsx("button",{onClick:O=>{O.stopPropagation(),V()},className:"p-1.5 bg-green-100 dark:bg-green-900/40 hover:bg-green-200 dark:hover:bg-green-900/60 rounded-lg transition-colors","aria-label":m("save","Save"),children:e.jsx(xt,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("button",{onClick:E,className:"p-1.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors","aria-label":m("cancel","Cancel"),children:e.jsx(Ie,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})})]}):e.jsx("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap",children:d(t.amount)}),o&&!g&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:O=>{O.stopPropagation(),p(-5e3)},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors","aria-label":"Decrease by 5000",children:e.jsx(Ka,{className:"w-3 h-3 text-gray-500"})}),e.jsx("button",{onClick:O=>{O.stopPropagation(),p(5e3)},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors","aria-label":"Increase by 5000",children:e.jsx(qa,{className:"w-3 h-3 text-gray-500"})}),e.jsx("button",{onClick:O=>{O.stopPropagation(),p("percent")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors","aria-label":"Increase by 10%",children:e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"+10%"})})]}),!g&&e.jsx("button",{onClick:L,className:"p-2 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50 rounded-lg transition-colors","aria-label":m("budget.editAmount","Edit amount"),children:e.jsx(Ra,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsx("button",{onClick:_,className:"p-2 bg-red-50 dark:bg-red-900/30 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-lg transition-colors","aria-label":m("budget.deleteAllocation","Delete"),children:e.jsx(la,{className:"w-5 h-5 text-red-500 dark:text-red-400"})})]})]}),b&&e.jsxs("div",{className:"mb-3 p-2 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mb-2",children:m("budget.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:R,className:"flex-1 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:m("cancel")}),e.jsx("button",{onClick:A,className:"flex-1 py-1.5 text-sm text-white bg-red-600 hover:bg-red-700 rounded transition-colors",children:m("delete")})]})]}),t.reasoning&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:t.reasoning}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-500 ease-out",style:{width:`${Math.min(G,100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[G.toFixed(1),"% ",m("budget.ofTotal")]})]}),s&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[d(q)," / ",d(Y)]}),e.jsx("span",{className:w("font-medium",X?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:X?e.jsx(e.Fragment,{children:m("budget.overBy",{amount:d(C)})}):e.jsxs(e.Fragment,{children:[d(re)," ",m("budget.remaining")]})})]}),n!==void 0&&n>0&&!X&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[m("budget.pacing","{{days}} days left",{days:n})," â€¢ ",d($),"/",m("budget.perDay","day")]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:w("h-full transition-all",I()),style:{width:`${Math.min(te,100)}%`}})}),X&&e.jsx("div",{className:"h-1 bg-red-200 dark:bg-red-900/50 rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500",style:{width:`${Math.min((q-Y)/Y*100,100)}%`}})})]}),!o&&r.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:m("budget.topSpending","Top Spending")}),e.jsx("div",{className:"space-y-1.5",children:r.slice(0,3).map(O=>e.jsxs("div",{className:w("flex items-center justify-between text-sm py-1 px-2 rounded",O.isBig&&"bg-red-50 dark:bg-red-900/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[O.isBig&&e.jsx(ca,{className:"w-3.5 h-3.5 text-orange-500 flex-shrink-0"}),e.jsx("span",{className:"truncate text-gray-700 dark:text-gray-300",children:O.description})]}),e.jsx("span",{className:w("font-medium ml-2 whitespace-nowrap",O.isBig?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"),children:d(O.amount)})]},O.id))})]})]})}function Ss({budgetId:t,allocations:a,totalBudget:s,tracking:r,month:n,daysRemaining:i,isDraft:o,onAddCategory:c,onAllocationChange:l}){const{t:d}=Z("common"),u=It(),h=Vt(),{data:f}=Xe(),{currency:p}=oe(),{isPrivacyMode:m}=de(),{data:g}=ie(),[y,j]=v.useState("priority"),[x,b]=v.useState("none"),[P,S]=v.useState("desc"),B=C=>ue(C,p,(g==null?void 0:g.rates)||{},!0,m),z=v.useMemo(()=>{const C=new Map;return a.forEach(M=>C.set(M.category,M.amount)),C},[a]),L=v.useMemo(()=>a.map(C=>C.category),[a]),{data:V}=us(L,n||"",z,3),E=C=>{var M;return V?V instanceof Map?((M=V.get(C))==null?void 0:M.transactions)||[]:[]:[]},k=v.useMemo(()=>{const C=new Map;return f&&(f.expense.forEach(M=>{const $=M.children.map(I=>I.name);C.set(M.name,$)}),f.income.forEach(M=>{const $=M.children.map(I=>I.name);C.set(M.name,$)})),C},[f]),N=v.useMemo(()=>{const C=new Map;return f&&(f.expense.forEach(M=>{M.children.forEach($=>{C.set($.name,M.name)})}),f.income.forEach(M=>{M.children.forEach($=>{C.set($.name,M.name)})})),C},[f]),_=new Map;r!=null&&r.categories&&r.categories.forEach(C=>{_.set(C.category,C)});const A=Oe({mutationFn:({category:C,amount:M})=>ps(t,C,M),onSuccess:()=>{h.invalidateQueries({queryKey:["budget"]})}}),R=Oe({mutationFn:C=>fs(t,C),onSuccess:()=>{h.invalidateQueries({queryKey:["budget"]})}}),G=C=>{const M=k.get(C)||[],$=[C,...M].join(",");u({to:"/transactions",search:{categories:$,month:n||void 0}})},q=C=>{const M=C.category.toLowerCase(),$=["housing","rent","utilities","electric","gas","water","internet","phone","insurance","groceries","transportation","medical","health"];return["savings","investment","retirement","emergency","fund"].some(K=>M.includes(K))?"savings":$.some(K=>M.includes(K))?"need":"want"},Y=v.useMemo(()=>{let C=[...a];return C.sort((M,$)=>{const I=_.get(M.category),K=_.get($.category),O=(I==null?void 0:I.spent)||0,ae=(K==null?void 0:K.spent)||0,D=(I==null?void 0:I.budgeted)||M.amount,me=(K==null?void 0:K.budgeted)||$.amount,_e=D>0?O/D:0,qe=me>0?ae/me:0,T=O-D,U=ae-me;let H=0;switch(y){case"priority":H=U-T,H===0&&(H=qe-_e);break;case"amount":H=$.amount-M.amount;break;case"category":H=M.category.localeCompare($.category);break;case"percentage":H=qe-_e;break}return P==="asc"?-H:H}),C},[a,y,P,_]),re=v.useMemo(()=>{if(x==="none")return{default:Y};const C={need:[],want:[],savings:[]};return Y.forEach(M=>{const $=q(M);C[$].push(M)}),C},[Y,x]),te=(C,M)=>{if(!o||!l)return;const $=a[C];let I=$.amount;M==="percent"?I=Math.floor($.amount*1.1):I=Math.max(0,$.amount+M);const K=[...a];K[C]={...$,amount:I},l(K)},X=C=>{y===C?S(M=>M==="asc"?"desc":"asc"):(j(C),S("desc"))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:d("budget.allocations")}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsxs(W,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),d("budget.addCategory")]}),e.jsx("div",{className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:e.jsxs("select",{value:x,onChange:C=>b(C.target.value),className:"text-sm bg-transparent border-none px-2 py-1",children:[e.jsx("option",{value:"none",children:d("budget.groupNone")}),e.jsx("option",{value:"needs-wants",children:d("budget.groupNeedsWants")})]})}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>X("priority"),className:w("px-2 py-1 text-xs rounded",y==="priority"?"bg-white dark:bg-gray-700 shadow":""),children:d("budget.sortPriority")}),e.jsx("button",{onClick:()=>X("amount"),className:w("px-2 py-1 text-xs rounded",y==="amount"?"bg-white dark:bg-gray-700 shadow":""),children:d("budget.sortAmount")})]})]})]}),o&&l&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:d("budget.tapToEdit","Tap amount to edit or use quick buttons")}),Object.entries(re).map(([C,M])=>M.length>0&&e.jsxs("div",{className:"mb-6",children:[x==="needs-wants"&&e.jsxs("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4"}),d(C==="need"?"budget.needs":C==="want"?"budget.wants":"budget.savings"),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",M.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map($=>{const I=a.findIndex(K=>K.category===$.category);return e.jsx(ws,{allocation:$,totalBudget:s,trackingItem:_.get($.category),topTransactions:E($.category),daysRemaining:i,parentCategory:N.get($.category),isDraft:o,isUpdating:A.isPending,isDeleting:R.isPending,formatCurrency:B,onAmountChange:K=>{if(o&&l){const O=[...a];O[I]={...$,amount:K},l(O)}else A.mutate({category:$.category,amount:K})},onDelete:()=>{if(o&&l){const K=a.filter((O,ae)=>ae!==I);l(K)}else R.mutate($.category)},onCategoryClick:()=>G($.category),onQuickAdjust:K=>te(I,K)},$.category)})})]},C))]})}function As({budget:t,tracking:a,isDraft:s,selectedMonth:r,onAddCategory:n,onAllocationChange:i}){const{t:o}=Z("common"),[c,l]=v.useState(null),[d,u]=v.useState(null),h=t.monthly_income-(t.savings_target||0),f=v.useCallback(p=>{var m;return(m=a==null?void 0:a.categories)==null?void 0:m.find(g=>g.category===p)},[a]);return v.useCallback(p=>{u(m=>m===p?null:p)},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"hidden lg:grid lg:grid-cols-[280px_1fr] lg:gap-4 lg:min-h-[500px]",children:[e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:e.jsx(cs,{allocations:t.allocations,trackingItems:a==null?void 0:a.categories,selectedCategory:c,onSelectCategory:l,isDraft:s,onAddCategory:n})}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:c?e.jsx($t,{category:c,month:r,trackingItem:f(c),isOpen:!0,onClose:()=>l(null),mode:"inline"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400 p-8",children:o("budget.selectCategoryHint")})})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx(Ss,{budgetId:t.id,allocations:t.allocations,totalBudget:h,tracking:a,month:r,daysRemaining:a==null?void 0:a.days_remaining,isDraft:s,onAddCategory:n,onAllocationChange:i})}),e.jsx("div",{className:"lg:hidden",children:e.jsx($t,{category:c||"",month:r,trackingItem:c?f(c):void 0,isOpen:!!c,onClose:()=>l(null),mode:"overlay"})})]})}const ot=20;function Ps({allocations:t,month:a,onEditTransaction:s}){const{t:r}=Z("common"),{currency:n}=oe(),{isPrivacyMode:i}=de(),{data:o}=ie(),[c,l]=v.useState([]),[d,u]=v.useState(!0),[h,f]=v.useState(null),[p,m]=v.useState("all"),[g,y]=v.useState(""),[j,x]=v.useState("date"),[b,P]=v.useState("desc"),[S,B]=v.useState(1),z=N=>ue(N,n,(o==null?void 0:o.rates)||{},!0,i),L=v.useMemo(()=>["all",...t.map(N=>N.category)],[t]);v.useEffect(()=>{let N=!0;async function _(){u(!0);try{const[A,R]=a.split("-").map(Number),G=new Date(A,R,0).getDate(),q=await He({start_date:`${A}-${String(R).padStart(2,"0")}-01`,end_date:`${A}-${String(R).padStart(2,"0")}-${String(G).padStart(2,"0")}`,type:"expense"});N&&l(q.filter(Y=>!Y.is_transfer))}catch{N&&f("Failed to load")}finally{N&&u(!1)}}return _(),()=>{N=!1}},[a]);const V=v.useMemo(()=>{let N=[...c];if(p!=="all"&&(N=N.filter(_=>_.category===p)),g.trim()){const _=g.toLowerCase();N=N.filter(A=>{var R;return A.description.toLowerCase().includes(_)||((R=A.category)==null?void 0:R.toLowerCase().includes(_))})}return N.sort((_,A)=>{const R=j==="date"?new Date(_.date).getTime()-new Date(A.date).getTime():Math.abs(_.amount)-Math.abs(A.amount);return b==="desc"?-R:R}),N},[c,p,g,j,b]),E=Math.ceil(V.length/ot),k=V.slice((S-1)*ot,S*ot);return v.useEffect(()=>{B(1)},[p,g,j,b]),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(lt,{className:"w-6 h-6 animate-spin text-gray-400"})}):h?e.jsx(Q,{className:"p-6 text-center text-red-500",children:h}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("select",{value:p,onChange:N=>m(N.target.value),className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:L.map(N=>e.jsx("option",{value:N,children:N==="all"?r("transactions.allCategories"):N},N))}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ua,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:N=>y(N.target.value),placeholder:r("transactions.search"),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm"})]}),e.jsxs("select",{value:`${j}-${b}`,onChange:N=>{const[_,A]=N.target.value.split("-");x(_),P(A)},className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"date-desc",children:r("transactions.sortDateDesc")}),e.jsx("option",{value:"date-asc",children:r("transactions.sortDateAsc")}),e.jsx("option",{value:"amount-desc",children:r("transactions.sortAmountDesc")}),e.jsx("option",{value:"amount-asc",children:r("transactions.sortAmountAsc")})]})]}),e.jsx(Q,{className:"divide-y divide-gray-100 dark:divide-gray-800 overflow-hidden",children:k.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:r("transactions.noData")}):k.map(N=>e.jsxs("button",{onClick:()=>s==null?void 0:s(N),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:N.description}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Kt(N.date,"MMM d")," â€¢ ",N.category||r("category.other")]})]}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white ml-4",children:z(N.amount)})]},N.id))}),E>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500",children:r("transactions.showingCount",{shown:k.length,total:V.length})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(N=>Math.max(1,N-1)),disabled:S===1,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(gt,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm",children:[S," / ",E]}),e.jsx("button",{onClick:()=>B(N=>Math.min(E,N+1)),disabled:S===E,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(be,{className:"w-5 h-5"})})]})]})]})}function Cs({predictions:t,onViewCategory:a,onAdjustBudget:s,onDismiss:r,maxAlerts:n=3,className:i}){const{t:o}=Z("common"),{currency:c}=oe(),{isPrivacyMode:l}=de(),{data:d}=ie(),u=m=>ue(m,c,(d==null?void 0:d.rates)||{},!0,l),h=t.slice(0,n);if(h.length===0)return null;const f=m=>m.anomalyDetected?{icon:xa,bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200 dark:border-purple-800",iconBg:"bg-purple-100 dark:bg-purple-900/50",iconColor:"text-purple-600 dark:text-purple-400",textColor:"text-purple-800 dark:text-purple-200"}:m.status==="danger"?{icon:ce,bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",iconBg:"bg-red-100 dark:bg-red-900/50",iconColor:"text-red-600 dark:text-red-400",textColor:"text-red-800 dark:text-red-200"}:{icon:Ce,bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",iconBg:"bg-amber-100 dark:bg-amber-900/50",iconColor:"text-amber-600 dark:text-amber-400",textColor:"text-amber-800 dark:text-amber-200"},p=m=>o(`budget.forecast.confidence.${m}`);return e.jsxs("div",{className:w("space-y-3",i),children:[h.map(m=>{const g=f(m),y=g.icon;return e.jsx(Q,{className:w("p-4 border",g.bg,g.border),role:"alert",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:w("p-2 rounded-lg flex-shrink-0",g.iconBg),children:e.jsx(y,{className:w("w-5 h-5",g.iconColor)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:w("font-semibold",g.textColor),children:m.anomalyDetected?o("budget.forecast.anomalyDetected"):m.status==="danger"?o("budget.forecast.predictedOverspend"):o("budget.forecast.approachingLimit")}),e.jsx("p",{className:w("text-sm mt-0.5",g.textColor,"opacity-90"),children:m.anomalyDetected?`${m.category}: ${m.anomalyDescription}`:`${m.category} ${o("budget.forecast.willExceedBy")} ${u(m.exceededBy)}`})]}),r&&e.jsx("button",{onClick:()=>r(m.category),className:w("p-1 rounded hover:bg-black/5 dark:hover:bg-white/5",g.textColor),"aria-label":o("button.close"),children:e.jsx(Ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:w("flex items-center gap-4 mt-2 text-xs",g.textColor,"opacity-80"),children:[e.jsxs("span",{children:[o("budget.forecast.currentPace"),": ",u(m.dailyPace),"/day"]}),e.jsxs("span",{children:[o("budget.forecast.safePace"),": ",u(m.safeDailyPace),"/day"]}),e.jsxs("span",{children:[m.daysRemaining," ",o("budget.daysLeft")]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:w("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",m.confidence==="high"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":m.confidence==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:[o("budget.forecast.confidenceLabel"),": ",p(m.confidence)]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>a(m.category),className:g.textColor,children:[e.jsx(ma,{className:"w-4 h-4 mr-1"}),o("viewDetails")]}),s&&e.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>s(m.category),className:g.textColor,children:[e.jsx(ga,{className:"w-4 h-4 mr-1"}),o("budget.forecast.adjustBudget")]})]})]})]})},m.category)}),t.length>n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:o("budget.forecast.moreAlerts",{count:t.length-n})})]})}function _s(t,a,s,r){const{category:n,budgeted:i,spent:o}=t,c=Math.max(1,s),l=o/c,d=i-o,u=a>0?d/a:0,h=o+l*a,f=Math.max(0,h-i);let p;s>=15?p="high":s>=7?p="medium":p="low";const m=i>0?h/i*100:0;let g;return m>100?g="danger":m>85?g="warning":g="safe",{category:n,predictedTotal:h,budgetAmount:i,exceededBy:f,confidence:p,status:g,dailyPace:l,safeDailyPace:u,anomalyDetected:!1,anomalyDescription:void 0,daysRemaining:a,daysElapsed:s}}function Ts(t,a,s){const{days_remaining:r}=a,i=30-r;return a.categories.map(o=>_s(o,r,i)).filter(o=>o.status!=="safe"||o.anomalyDetected).sort((o,c)=>{const l={danger:0,warning:1,safe:2};return l[o.status]!==l[c.status]?l[o.status]-l[c.status]:c.exceededBy-o.exceededBy})}function Os(t){const a=t.total_spent,s=t.total_budgeted,r=t.days_remaining,i=Math.max(1,30-r),o=a/i,c=a+o*r,l=s>0?c/s*100:0;let d;return l>100?d="danger":l>85?d="warning":d="safe",{totalPredicted:c,totalBudget:s,overallStatus:d,overallPercent:l}}function Ms({budget:t,tracking:a,selectedMonth:s,onViewCategory:r,onAdjustBudget:n}){const{t:i,i18n:o}=Z("common"),{currency:c}=oe(),{isPrivacyMode:l}=de(),{data:d}=ie(),u=g=>ue(g,c,(d==null?void 0:d.rates)||{},!0,l),h=g=>{const[y,j]=g.split("-");return new Date(parseInt(y),parseInt(j)-1).toLocaleDateString(o.language,{month:"long",year:"numeric"})},f=v.useMemo(()=>a?Ts(t.allocations,a):[],[t.allocations,a]),p=v.useMemo(()=>a?Os(a):null,[a]);if(!a)return e.jsx(Q,{className:"p-8 text-center text-gray-500",children:i("budget.forecast.noData")});const m=f.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[i("budget.forecast.title")," - ",h(s)]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:i("budget.forecast.subtitle")})]}),p&&e.jsx(Q,{className:w("p-6 border-2",p.overallStatus==="danger"?"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/20":p.overallStatus==="warning"?"border-amber-300 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20":"border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-900/20"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:w("w-14 h-14 rounded-full flex items-center justify-center",p.overallStatus==="danger"?"bg-red-500":p.overallStatus==="warning"?"bg-amber-500":"bg-green-500"),children:p.overallStatus==="danger"?e.jsx(ce,{className:"w-7 h-7 text-white"}):p.overallStatus==="warning"?e.jsx(Ce,{className:"w-7 h-7 text-white"}):e.jsx(Pe,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:w("text-lg font-bold",p.overallStatus==="danger"?"text-red-800 dark:text-red-200":p.overallStatus==="warning"?"text-amber-800 dark:text-amber-200":"text-green-800 dark:text-green-200"),children:p.overallStatus==="danger"?i("budget.forecast.overBudgetProjected"):p.overallStatus==="warning"?i("budget.forecast.approachingLimit"):i("budget.forecast.onTrack")}),e.jsx("p",{className:w("text-sm mt-0.5",p.overallStatus==="danger"?"text-red-700 dark:text-red-300":p.overallStatus==="warning"?"text-amber-700 dark:text-amber-300":"text-green-700 dark:text-green-300"),children:i("budget.forecast.projectedSpending",{amount:u(p.totalPredicted),budget:u(p.totalBudget)})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:w("text-3xl font-bold",p.overallStatus==="danger"?"text-red-600 dark:text-red-400":p.overallStatus==="warning"?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400"),children:[Math.round(p.overallPercent),"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:i("budget.forecast.ofBudget")})]})]})}),m?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:i("budget.forecast.predictedWarnings")}),e.jsx(Cs,{predictions:f,onViewCategory:r,onAdjustBudget:n,maxAlerts:5})]}):e.jsxs(Q,{className:"p-6 text-center bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsx(Pe,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:i("budget.forecast.allClear")}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:i("budget.forecast.allClearDescription")})]}),e.jsxs(Q,{className:"overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:i("budget.forecast.categoryForecasts")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:a.categories.map(g=>{const y=f.find(b=>b.category===g.category),j=(y==null?void 0:y.predictedTotal)||g.spent,x=g.budgeted>0?j/g.budgeted*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:g.category}),e.jsxs("p",{className:"text-sm text-gray-500",children:[u(g.spent)," â†’ ",u(j)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:w("font-semibold",x>100?"text-red-600":x>85?"text-amber-600":"text-green-600"),children:[Math.round(x),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/ ",u(g.budgeted)]})]})]},g.category)})})]})]})}const Bt="budget-active-tab",Ds=["overview","categories","transactions","forecast"];function it(t){return t!==null&&Ds.includes(t)}function Es(t="overview"){const[a,s]=v.useState(()=>{if(typeof window<"u"){const i=new URLSearchParams(window.location.search).get("tab");if(it(i))return i;const o=localStorage.getItem(Bt);if(it(o))return o}return t}),r=v.useCallback(n=>{if(s(n),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set("tab",n),window.history.replaceState({},"",i.toString()),localStorage.setItem(Bt,n)}},[]);return v.useEffect(()=>{const n=()=>{const o=new URLSearchParams(window.location.search).get("tab");it(o)&&s(o)};return window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]),{activeTab:a,setActiveTab:r}}function $s(){const{t,i18n:a}=Z("common"),s=Vt(),{currency:r}=oe(),{isPrivacyMode:n}=de(),{data:i}=ie(),[o,c]=v.useState(!1),[l,d]=v.useState(null),[u,h]=v.useState(()=>{const T=new Date;return`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}`}),[f,p]=v.useState([]),[m,g]=v.useState(!1),[y,j]=v.useState(!1),[x,b]=v.useState(null),{activeTab:P,setActiveTab:S}=Es("overview"),{showBudgetCreatedXP:B}=Fa(),z=T=>ue(T,r,(i==null?void 0:i.rates)||{},!0,n),L=T=>{const[U,H]=T.split("-");return new Date(parseInt(U),parseInt(H)-1).toLocaleDateString(a.language,{month:"long",year:"numeric"})},V=v.useCallback(T=>{h(U=>{const[H,se]=U.split("-").map(Number);let ne=H,he=se;return T==="prev"?(he-=1,he<1&&(he=12,ne-=1)):(he+=1,he>12&&(he=1,ne+=1)),`${ne}-${String(he).padStart(2,"0")}`})},[]),{data:E,isLoading:k,error:N}=ke({queryKey:["budget","month",u],queryFn:async()=>{var T;try{return await Lt(u)}catch(U){if(((T=U==null?void 0:U.response)==null?void 0:T.status)===404)return null;throw U}},retry:!1}),{data:_}=ke({queryKey:["budget","previous-month",u],queryFn:async()=>{const[T,U]=u.split("-").map(Number);let H=T,se=U-1;se<1&&(se=12,H-=1);const ne=`${H}-${String(se).padStart(2,"0")}`;try{return await Lt(ne)}catch{return null}},enabled:!!E,staleTime:5*60*1e3}),{data:A}=ke({queryKey:["budget","tracking",u],queryFn:async()=>{var T;try{return await xs()}catch(U){if(((T=U==null?void 0:U.response)==null?void 0:T.status)===404)return null;throw U}},retry:!1,enabled:!!E}),{data:R}=ke({queryKey:["budget","suggestions"],queryFn:hs,enabled:!E&&!k}),G=T=>{const[U,H]=T.split("-").map(Number);let se=U,ne=H-1;return ne<1&&(ne=12,se-=1),`${se}-${String(ne).padStart(2,"0")}`},{data:q,isLoading:Y}=ke({queryKey:["budget","copy-preview",u],queryFn:()=>ys(G(u),u),enabled:!E&&!k&&!l,retry:!1}),{data:re}=ke({queryKey:["budget","versions",u],queryFn:()=>vs(u),enabled:!!E}),te=Oe({mutationFn:T=>ms({monthly_income:T,language:a.language}),onSuccess:T=>{d(T),K("generate",T),B()}}),X=Oe({mutationFn:T=>gs((l||E).id,{feedback:T,language:a.language}),onSuccess:T=>{d(T),c(!1),K("regenerate",T)}}),C=Oe({mutationFn:()=>bs({source_month:G(u),target_month:u}),onSuccess:T=>{d(T),s.invalidateQueries({queryKey:["budget"]})}}),M=Oe({mutationFn:T=>js(T),onSuccess:()=>{s.invalidateQueries({queryKey:["budget"]})}}),[$,I]=v.useState(!1),K=v.useCallback((T,U)=>{p(H=>[...H.slice(-9),{action:T,data:U}])},[]);v.useCallback(()=>{if(f.length===0)return;const T=f[f.length-1];d(T.data),p(U=>U.slice(0,-1))},[f]);const O=()=>{j(!0)},ae=async()=>{await s.refetchQueries({queryKey:["budget"]}),d(null),j(!1)},D=l||E,me=!!l,_e=(D==null?void 0:D.allocations.reduce((T,U)=>T+U.amount,0))||0,qe=v.useCallback(()=>{if(!D)return;const T=`${t("budget.title")} - ${D.month}
${t("budget.monthlyIncome")}: ${z(D.monthly_income)}
${t("budget.savingsTarget")}: ${z(D.savings_target||0)}

${t("budget.allocations")}:
${D.allocations.map(ne=>`- ${ne.category}: ${z(ne.amount)}`).join(`
`)}

${t("budget.aiAdvice")}: ${D.advice||"-"}
`,U=new Blob([T],{type:"text/plain"}),H=URL.createObjectURL(U),se=document.createElement("a");se.href=H,se.download=`budget-${D.month}.txt`,se.click(),URL.revokeObjectURL(H)},[D,t]);return k?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(yt,{})}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:()=>V("prev"),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(gt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:L(u)}),e.jsx("button",{onClick:()=>V("next"),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",disabled:u>=new Date().toISOString().slice(0,7),children:e.jsx(be,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:t("budget.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("budget.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[re&&re.length>1&&D&&e.jsx(or,{versions:re,currentVersion:D.version||1,formatCurrency:z,onRestore:T=>M.mutate(T),isRestoring:M.isPending}),D&&e.jsx("button",{onClick:qe,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",title:t("export"),children:e.jsx(ba,{className:"w-5 h-5"})})]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 space-y-4",children:[!D&&!N&&e.jsxs(e.Fragment,{children:[q&&!$&&e.jsx(nr,{preview:q,formatCurrency:z,formatMonth:L,onCopy:()=>C.mutate(),onGenerateAI:()=>I(!0),onStartEmpty:()=>{d({id:0,month:u,monthly_income:q.source_budget.monthly_income,allocations:[],created_at:new Date().toISOString()})},isLoading:C.isPending}),(!q||$)&&!Y&&e.jsx(er,{onGenerate:T=>te.mutate(T),isLoading:te.isPending,error:te.isError,suggestions:R}),Y&&e.jsx(Q,{className:"p-6 flex items-center justify-center",children:e.jsx(yt,{})})]}),D&&e.jsxs(sr,{activeTab:P,onTabChange:S,children:[P==="overview"&&e.jsx(ns,{budget:D,tracking:A||void 0,previousMonthData:_,selectedMonth:u,onViewCategory:T=>{S("categories")}}),P==="categories"&&e.jsx(As,{budget:D,tracking:A||void 0,isDraft:me,selectedMonth:u,onAddCategory:()=>g(!0),onAllocationChange:T=>{me&&d({...D,allocations:T})}}),P==="transactions"&&e.jsx(Ps,{allocations:D.allocations,month:u,onEditTransaction:b}),P==="forecast"&&e.jsx(Ms,{budget:D,tracking:A||void 0,selectedMonth:u,onViewCategory:T=>{S("categories")}}),me&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(W,{variant:"outline",onClick:()=>c(!o),className:"flex-1",children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),t("budget.regenerate")]}),e.jsxs(W,{onClick:O,className:"flex-1",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),t("budget.save")]})]}),o&&e.jsx(tr,{onSubmit:T=>X.mutate(T),onCancel:()=>c(!1),isLoading:X.isPending})]}),N&&e.jsx(Q,{className:"p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:N instanceof Error?N.message:t("budget.generateError")})}),m&&D&&e.jsx(ar,{budget:D,onClose:()=>g(!1),onAdd:(T,U)=>{const H=[...D.allocations,{category:T,amount:U}],se=H.reduce((he,ta)=>he+ta.amount,0),ne=Math.max(0,D.monthly_income-se);d({...D,allocations:H,savings_target:ne}),g(!1),K("add-category",D)}})]}),D&&me&&e.jsx("div",{className:"fixed bottom-20 right-4 sm:hidden",children:e.jsx(W,{size:"lg",className:"rounded-full shadow-lg",onClick:()=>g(!0),children:e.jsx(Ae,{className:"w-6 h-6"})})}),x&&e.jsx(ya,{transaction:x,isOpen:!!x,onClose:()=>{b(null),s.invalidateQueries({queryKey:["budget","tracking"]})}}),e.jsx(rr,{isOpen:y,onConfirm:ae,onCancel:()=>j(!1),monthlyIncome:(D==null?void 0:D.monthly_income)||0,totalAllocated:_e,savingsTarget:(D==null?void 0:D.savings_target)||0,categoryCount:(D==null?void 0:D.allocations.length)||0})]})}function Ls({className:t}){return e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}const Ws=ha("/budget")({component:$s});export{Ws as Route};
