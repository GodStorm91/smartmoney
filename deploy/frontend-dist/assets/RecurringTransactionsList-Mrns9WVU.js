import{l as e,u as r,m as a,j as s}from"./vendor-tanstack-CcawFp1G.js";import{r as t}from"./vendor-react-Bx4JnVfy.js";import{C as n,L as i,c}from"./index-CIhtH7MY.js";import{u as d,a as l,b as o}from"./recurring-service-CNbMNh4x.js";import{u as g}from"./vendor-i18n-BrrOrGm_.js";import{D as u,Y as m,ab as x,a5 as y,a0 as h}from"./vendor-icons-DfKjTcwJ.js";const j="¥",v=["recurring.days.monday","recurring.days.tuesday","recurring.days.wednesday","recurring.days.thursday","recurring.days.friday","recurring.days.saturday","recurring.days.sunday"];function b(){const{t:b}=g("common"),p=e(),[f,N]=t.useState(null),{data:k,isLoading:_}=r({queryKey:["recurring-transactions"],queryFn:()=>o()}),w=a({mutationFn:l,onSuccess:()=>{p.invalidateQueries({queryKey:["recurring-transactions"]}),N(null)}}),q=a({mutationFn:({id:e,is_active:r})=>d(e,{is_active:r}),onSuccess:()=>{p.invalidateQueries({queryKey:["recurring-transactions"]})}}),D=e=>{switch(e.frequency){case"weekly":const r=v[e.day_of_week??0];return`${b("recurring.weekly")} - ${b(r)}`;case"monthly":return`${b("recurring.monthly")} - ${e.day_of_month??1}日`;case"yearly":return b("recurring.yearly");case"custom":return b("recurring.everyNDays",{n:e.interval_days??7});default:return e.frequency}},S=e=>e?new Date(e).toLocaleDateString():"-";return _?s.jsxs(n,{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6",children:b("recurring.title")}),s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(i,{size:"md"})})]}):s.jsxs(n,{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[s.jsx(u,{className:"w-5 h-5 text-blue-500"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:b("recurring.title")})]}),k&&k.length>0?s.jsx("div",{className:"space-y-3",children:k.map(e=>s.jsx("div",{className:c("p-4 rounded-lg border transition-colors",e.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.description}),s.jsx("span",{className:c("px-2 py-0.5 text-xs rounded-full",e.is_active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400"),children:e.is_active?b("recurring.active"):b("recurring.inactive")})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[s.jsxs("span",{className:"font-numbers",children:[e.is_income?"+":"-",j,Math.abs(e.amount).toLocaleString()]}),s.jsx("span",{children:e.category}),s.jsx("span",{children:D(e)})]}),s.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-gray-400 dark:text-gray-500",children:[s.jsx(m,{className:"w-3 h-3"}),s.jsxs("span",{children:[b("recurring.nextRun"),": ",S(e.next_run_date)]}),e.last_run_date&&s.jsxs("span",{className:"ml-3",children:[b("recurring.lastRun"),": ",S(e.last_run_date)]})]})]}),s.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[s.jsx("button",{onClick:()=>(e=>{q.mutate({id:e.id,is_active:!e.is_active})})(e),disabled:q.isPending,className:c("p-2 rounded-lg transition-colors",e.is_active?"hover:bg-yellow-100 dark:hover:bg-yellow-900/30 text-yellow-600":"hover:bg-green-100 dark:hover:bg-green-900/30 text-green-600"),title:e.is_active?b("recurring.inactive"):b("recurring.active"),children:e.is_active?s.jsx(x,{className:"w-4 h-4"}):s.jsx(y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>{return r=e.id,void(confirm(b("common.confirmDelete","Are you sure you want to delete this?"))&&(N(r),w.mutate(r)));var r},disabled:f===e.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",title:b("button.delete"),children:f===e.id?s.jsx(i,{size:"sm"}):s.jsx(h,{className:"w-4 h-4"})})]})]})},e.id))}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(u,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:b("recurring.noRecurring")}),s.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:b("recurring.addFirst")})]})]})}export{b as R};
