var Je=t=>{throw TypeError(t)};var Le=(t,s,r)=>s.has(t)||Je("Cannot "+r);var O=(t,s,r)=>(Le(t,s,"read from private field"),r?r.call(t):s.get(t)),G=(t,s,r)=>s.has(t)?Je("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,r),U=(t,s,r,a)=>(Le(t,s,"write to private field"),a?a.call(t,r):s.set(t,r),r),X=(t,s,r)=>(Le(t,s,"access private method"),r);import{bt as Ct,bu as $e,bv as St,bw as Ft,bx as ct,J as ae,by as Rt,bz as Mt,r as m,bA as At,bB as Pt,bC as Dt,bD as Tt,bE as Ye,bF as Ge,bG as Lt,bH as qt,l as ne,u as Z,z as Et,N as He,M as we,j as e,C as ie,m as I,a9 as se,bI as $t,bJ as It,bK as Ot,Y as Me,y as Ae,a0 as xt,D as H,a4 as W,F as pe,at as Ce,p as mt,R as re,T as Bt,I as Xe,B as be,P as fe,am as zt,s as xe,g as je,aB as Pe,q as Ue,aU as Ie,L as Se,X as le,H as De,aF as ut,aI as Qt,K as Kt,aX as Ht,aT as _e,aA as Ut,a2 as gt,az as Vt,af as ue,ah as Wt,a$ as Ze,b0 as Jt,bL as Yt,ad as Gt,k as Xt}from"./index-DwQJXgIW.js";import{f as qe,p as Ee,u as Zt,T as es,R as ts}from"./useDebouncedValue-jpQLaGXw.js";import{c as ss,d as rs,s as as,C as Fe,e as Re,f as ht,h as ns,i as ls,j as yt,k as pt,l as bt,m as ft,n as is,o as os,p as ds,q as cs,r as xs,t as ms,u as jt,v as vt}from"./crypto-DMc7FtI3.js";import{E as Ve}from"./BudgetInsightWidget-BPMRjv03.js";import{C as Te}from"./chevron-down-B84FTVMr.js";import{R as us,B as gs}from"./generateCategoricalChart-CK7Gt-lS.js";import{a as hs,C as ys,L as ps}from"./LineChart-sPWVyk35.js";import{X as bs,Y as fs}from"./YAxis-BwYJehVl.js";import{C as kt}from"./chevron-up-Rv9x_1V2.js";import{C as js}from"./clock-DEkbxTO7.js";import{T as vs}from"./triangle-alert-CSWpjmae.js";import{a as et,S as tt}from"./square-CEkw9mBr.js";import"./recurring-service-Dt1R-JAR.js";import"./RecurringOptions-XPMidfZy.js";import"./useXPGain-DrE1Sqxj.js";import"./useCategories-C_U8he5C.js";function st(t,s){const r=new Set(s);return t.filter(a=>!r.has(a))}function ks(t,s,r){const a=t.slice(0);return a[s]=r,a}var oe,V,de,ce,Y,te,ve,ke,Ne,K,Oe,Be,ze,Qe,Ke,dt,Ns=(dt=class extends Ct{constructor(s,r,a){super();G(this,K);G(this,oe);G(this,V);G(this,de);G(this,ce);G(this,Y);G(this,te);G(this,ve);G(this,ke);G(this,Ne,[]);U(this,oe,s),U(this,ce,a),U(this,de,[]),U(this,Y,[]),U(this,V,[]),this.setQueries(r)}onSubscribe(){this.listeners.size===1&&O(this,Y).forEach(s=>{s.subscribe(r=>{X(this,K,Qe).call(this,s,r)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,O(this,Y).forEach(s=>{s.destroy()})}setQueries(s,r){U(this,de,s),U(this,ce,r),$e.batch(()=>{const a=O(this,Y),c=X(this,K,ze).call(this,O(this,de));U(this,Ne,c),c.forEach(b=>b.observer.setOptions(b.defaultedQueryOptions));const l=c.map(b=>b.observer),n=l.map(b=>b.getCurrentResult()),g=a.length!==l.length,v=l.some((b,w)=>b!==a[w]),k=g||v,R=k?!0:n.some((b,w)=>{const u=O(this,V)[w];return!u||!St(b,u)});!k&&!R||(k&&U(this,Y,l),U(this,V,n),this.hasListeners()&&(k&&(st(a,l).forEach(b=>{b.destroy()}),st(l,a).forEach(b=>{b.subscribe(w=>{X(this,K,Qe).call(this,b,w)})})),X(this,K,Ke).call(this)))})}getCurrentResult(){return O(this,V)}getQueries(){return O(this,Y).map(s=>s.getCurrentQuery())}getObservers(){return O(this,Y)}getOptimisticResult(s,r){const a=X(this,K,ze).call(this,s),c=a.map(l=>l.observer.getOptimisticResult(l.defaultedQueryOptions));return[c,l=>X(this,K,Be).call(this,l??c,r),()=>X(this,K,Oe).call(this,c,a)]}},oe=new WeakMap,V=new WeakMap,de=new WeakMap,ce=new WeakMap,Y=new WeakMap,te=new WeakMap,ve=new WeakMap,ke=new WeakMap,Ne=new WeakMap,K=new WeakSet,Oe=function(s,r){return r.map((a,c)=>{const l=s[c];return a.defaultedQueryOptions.notifyOnChangeProps?l:a.observer.trackResult(l,n=>{r.forEach(g=>{g.observer.trackProp(n)})})})},Be=function(s,r){return r?((!O(this,te)||O(this,V)!==O(this,ke)||r!==O(this,ve))&&(U(this,ve,r),U(this,ke,O(this,V)),U(this,te,Ft(O(this,te),r(s)))),O(this,te)):s},ze=function(s){const r=new Map;O(this,Y).forEach(c=>{const l=c.options.queryHash;if(!l)return;const n=r.get(l);n?n.push(c):r.set(l,[c])});const a=[];return s.forEach(c=>{var v;const l=O(this,oe).defaultQueryOptions(c),g=((v=r.get(l.queryHash))==null?void 0:v.shift())??new ct(O(this,oe),l);a.push({defaultedQueryOptions:l,observer:g})}),a},Qe=function(s,r){const a=O(this,Y).indexOf(s);a!==-1&&(U(this,V,ks(O(this,V),a,r)),X(this,K,Ke).call(this))},Ke=function(){var s;if(this.hasListeners()){const r=O(this,te),a=X(this,K,Oe).call(this,O(this,V),O(this,Ne)),c=X(this,K,Be).call(this,a,(s=O(this,ce))==null?void 0:s.combine);r!==c&&$e.batch(()=>{this.listeners.forEach(l=>{l(O(this,V))})})}},dt);function rt({queries:t,...s},r){const a=ae(),c=Rt(),l=Mt(),n=m.useMemo(()=>t.map(C=>{const T=a.defaultQueryOptions(C);return T._optimisticResults=c?"isRestoring":"optimistic",T}),[t,a,c]);n.forEach(C=>{At(C),Pt(C,l)}),Dt(l);const[g]=m.useState(()=>new Ns(a,n,s)),[v,k,R]=g.getOptimisticResult(n,s.combine),b=!c&&s.subscribed!==!1;m.useSyncExternalStore(m.useCallback(C=>b?g.subscribe($e.batchCalls(C)):Tt,[g,b]),()=>g.getCurrentResult(),()=>g.getCurrentResult()),m.useEffect(()=>{g.setQueries(n,s)},[n,s,g]);const u=v.some((C,T)=>Ye(n[T],C))?v.flatMap((C,T)=>{const M=n[T];if(M){const j=new ct(a,M);if(Ye(M,C))return Ge(M,j,l);Lt(C,c)&&Ge(M,j,l)}return[]}):[];if(u.length>0)throw Promise.all(u);const P=v.find((C,T)=>{const M=n[T];return M&&qt({result:C,errorResetBoundary:l,throwOnError:M.throwOnError,query:a.getQueryCache().get(M.queryHash),suspense:M.suspense})});if(P!=null&&P.error)throw P.error;return k(R())}/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],_s=ne("archive",ws);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],Ss=ne("arrow-down-right",Cs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],Rs=ne("arrow-right-left",Fs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],As=ne("arrow-up-right",Ms);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],We=ne("gift",Ps);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ts=ne("layers",Ds);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],qs=ne("percent",Ls),Es={bank:{icon:"ðŸ¦",color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/30"},cash:{icon:"ðŸ’µ",color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/30"},credit_card:{icon:"ðŸ’³",color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/30"},investment:{icon:"ðŸ“ˆ",color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/30"},receivable:{icon:"ðŸ’°",color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/30"},savings:{icon:"ðŸ·",color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/30"},crypto:{icon:"â‚¿",color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/30"},other:{icon:"ðŸ“",color:"text-gray-600",bgColor:"bg-gray-50 dark:bg-gray-700"}};function $s({account:t,onEdit:s,onAddTransaction:r}){const{t:a}=Z("common"),c=Et(),{data:l}=He(),{isPrivacyMode:n}=we(),g=Es[t.type],v=t.current_balance>=0,k=()=>{const b=new Date,w=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;c({to:"/transactions",search:{accountId:t.id,month:w,fromAccounts:!0}})},R=b=>{b.stopPropagation(),r==null||r(t.id)};return e.jsxs(ie,{className:"relative hover:shadow-md transition-shadow cursor-pointer",onClick:k,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:I("p-3 rounded-lg",g.bgColor),children:e.jsx("span",{className:"text-2xl",children:g.icon})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:I("text-sm",g.color),children:a(`account.type.${t.type}`)})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("transaction.addTransaction"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-green-600 dark:text-green-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),s&&e.jsx("button",{onClick:b=>{b.stopPropagation(),s(t.id)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("account.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),!t.is_active&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:a("account.inactive")})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:a("account.currentBalance")}),e.jsx("p",{className:I("text-3xl font-bold font-mono",v?"text-green-600":"text-red-600"),children:se(t.current_balance,t.currency,(l==null?void 0:l.rates)||{},!0,n)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("account.initialBalance")}),e.jsx("p",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:se(t.initial_balance,t.currency,(l==null?void 0:l.rates)||{},!0,n)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("account.transactions")}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:t.transaction_count})]})]}),t.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:a("account.notes")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.notes})]})]})}const ge=t=>t==="USD"?100:1;function Is({isOpen:t,onClose:s,editingAccountId:r}){const{t:a}=Z("common"),c=$t(),l=It(),{data:n}=Ot(r||void 0),g=Me(),{isPrivacyMode:v}=we(),[k,R]=m.useState(""),[b,w]=m.useState("bank"),[u,P]=m.useState(""),[C,T]=m.useState(""),[M,j]=m.useState("JPY"),[S,p]=m.useState(""),[N,_]=m.useState({}),[q,E]=m.useState(""),[i,y]=m.useState(!1),x=["bank","cash","credit_card","investment","receivable","savings","other"],L=n&&n.transaction_count>0,$=(()=>{if(!n||!q)return null;const D=ge(n.currency),h=parseFloat(q)*D,o=n.current_balance;return h-o})();m.useEffect(()=>{if(t){if(r&&n)if(R(n.name),w(n.type),p(n.notes||""),j(n.currency),L)E(""),y(!1);else{const D=ge(n.currency);P((n.initial_balance/D).toString()),T(n.initial_balance_date)}else R(""),w("bank"),P("0"),T(new Date().toISOString().split("T")[0]),j("JPY"),p(""),E(""),y(!1);_({})}},[t,r,n,L]);const d=()=>{const D={};return k.trim()||(D.name=a("account.errors.nameRequired")),r?r&&!L&&(C||(D.initialBalanceDate=a("account.errors.dateRequired"))):C||(D.initialBalanceDate=a("account.errors.dateRequired")),_(D),Object.keys(D).length===0},F=async D=>{if(D.preventDefault(),!!d()){if(r&&L&&q&&!i){y(!0);return}try{if(r){const h={name:k.trim(),type:b,notes:S.trim()||void 0};if(!L&&n){const o=ge(n.currency);h.initial_balance=Math.round(parseFloat(u||"0")*o),h.initial_balance_date=C}if(L&&q&&n){const o=ge(n.currency);h.desired_current_balance=Math.round(parseFloat(q)*o)}await l.mutateAsync({id:r,data:h})}else{const h=ge(M),o={name:k.trim(),type:b,initial_balance:Math.round(parseFloat(u||"0")*h),initial_balance_date:C,currency:M,notes:S.trim()||void 0};await c.mutateAsync(o)}s()}catch(h){_({submit:h.message||a("account.errors.submitFailed")})}}};if(!t)return null;const ee=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:a(r?"account.editAccount":"account.createAccount")}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.name")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",value:k,onChange:D=>R(D.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",N.name?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:a("account.namePlaceholder")}),N.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N.name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.accountType")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"type",value:b,onChange:D=>w(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:x.map(D=>e.jsx("option",{value:D,children:a(`account.type.${D}`)},D))})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:qe(u),onChange:D=>P(Ee(D.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:C,onChange:D=>T(D.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",N.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),N.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N.initialBalanceDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.currency")}),e.jsxs("select",{id:"currency",value:M,onChange:D=>j(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"VND",children:"VND (â‚«)"})]})]})]}),r&&!L&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:qe(u),onChange:D=>P(Ee(D.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:C,onChange:D=>T(D.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",N.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),N.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N.initialBalanceDate})]})]}),r&&L&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:a("account.currentBalance")}),e.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-200",children:se(n.current_balance,n.currency,g,!0,v)})]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:a("account.hasTransactionsInfo",{count:n.transaction_count})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"desiredBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.desiredCurrentBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"desiredBalance",value:qe(q),onChange:D=>{E(Ee(D.target.value)),y(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:a("account.desiredBalancePlaceholder")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a("account.reconcileHint")})]}),$!==null&&$!==0&&e.jsx("div",{className:I("border rounded-lg p-4",$>0?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:I("text-sm font-medium",$>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:a("account.adjustmentAmount")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:I("text-lg font-bold",$>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:$>0?"â†‘":"â†“"}),e.jsx("span",{className:I("text-lg font-bold",$>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:se(Math.abs($),n.currency,g,!0,v)})]})]})}),i&&$!==null&&$!==0&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-200",children:a("account.adjustmentConfirmTitle")}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:a("account.adjustmentConfirmMessage",{amount:se(Math.abs($),n.currency,g,!0,v)})})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.notes")}),e.jsx("textarea",{id:"notes",value:S,onChange:D=>p(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:a("account.notesPlaceholder")})]}),N.submit&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:N.submit})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[i&&e.jsx("button",{type:"button",onClick:()=>{y(!1),E("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("account.cancelAdjustment")}),!i&&e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("cancel")}),e.jsx("button",{type:"submit",disabled:c.isPending||l.isPending,className:I("flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",i?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:c.isPending||l.isPending?a("saving"):a(i?"account.confirmAdjustment":r?"update":"create")})]})]})]})]});return typeof document>"u"?null:Ae.createPortal(ee,document.body)}const Os=["eth","bsc","polygon"];function at({token:t,isPrivacyMode:s}){return e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.logo_url?e.jsx("img",{src:t.logo_url,alt:t.symbol,className:"w-5 h-5 rounded-full",onError:r=>{r.target.style.display="none"}}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-[10px] font-medium",children:t.symbol.slice(0,2)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate",children:t.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:s?"***":Number(t.balance)<1e-4?"<0.0001":Number(t.balance).toFixed(4)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s?"$***":`$${Number(t.balance_usd).toFixed(2)}`})]})]})}function nt(){const{t}=Z("common"),s=ae(),{currency:r}=xt(),{isPrivacyMode:a}=we(),c=Me(),[l,n]=m.useState(!1),[g,v]=m.useState(""),[k,R]=m.useState(""),[b,w]=m.useState(["eth","bsc","polygon"]),[u,P]=m.useState(null),[C,T]=m.useState(null),{data:M,isLoading:j}=H({queryKey:["crypto-wallets"],queryFn:ht}),{data:S}=H({queryKey:["crypto-wallets-balance",M==null?void 0:M.map(h=>h.id)],queryFn:async()=>!M||M.length===0?[]:Promise.all(M.map(h=>ns(h.id))),enabled:!!M&&M.length>0}),{data:p,isLoading:N}=H({queryKey:["crypto-portfolio",C],queryFn:()=>ls(C),enabled:!!C}),_=W({mutationFn:ss,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),n(!1),v(""),R(""),w(["eth","bsc","polygon"])}}),q=W({mutationFn:rs,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]})}}),E=W({mutationFn:as,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]}),s.invalidateQueries({queryKey:["dashboard-summary"]}),P(null)},onError:()=>{P(null)}}),i=()=>{g.trim()&&_.mutate({wallet_address:g.trim(),label:k.trim()||void 0,chains:b})},y=h=>{confirm(t("confirmDelete"))&&q.mutate(h)},x=h=>{P(h),E.mutate(h)},L=h=>{w(o=>o.includes(h)?o.filter(Q=>Q!==h):[...o,h])},z=h=>{T(o=>o===h?null:h)},$=h=>`${h.slice(0,6)}...${h.slice(-4)}`,d=(h,o)=>{const Q={eth:`https://etherscan.io/address/${h}`,bsc:`https://bscscan.com/address/${h}`,polygon:`https://polygonscan.com/address/${h}`,arbitrum:`https://arbiscan.io/address/${h}`,optimism:`https://optimistic.etherscan.io/address/${h}`};return Q[o]||Q.eth},F=(S==null?void 0:S.reduce((h,o)=>h+Number(o.total_balance_usd||0),0))||0,ee=1/((c==null?void 0:c.USD)||.00667),D=Math.round(F*ee);return j?e.jsx(Fe,{title:t("crypto.wallets"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(pe,{size:"md"})})}):e.jsxs(Fe,{title:t("crypto.wallets"),badge:(M==null?void 0:M.length)||0,defaultOpen:M&&M.length>0,children:[S&&S.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalBalance")}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:se(D,r,c,!1,a)})]}),S&&S.length>0?e.jsx("div",{className:"space-y-3 mb-4",children:S.map(h=>{var o,Q;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(Ce,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:h.label||$(h.wallet_address)}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("code",{className:"text-xs",children:$(h.wallet_address)}),e.jsx("a",{href:d(h.wallet_address,"eth"),target:"_blank",rel:"noopener noreferrer",className:"hover:text-purple-500",children:e.jsx(Ve,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a?"$***":`$${Number(h.total_balance_usd||0).toFixed(2)}`}),e.jsx("div",{className:"flex gap-1 mt-1",children:(o=h.chains)==null?void 0:o.map(f=>{var A;return e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",title:(A=Re[f])==null?void 0:A.name,children:f.toUpperCase()},f)})})]})]}),e.jsxs("button",{onClick:()=>z(h.id),className:"flex items-center gap-2 mt-3 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors",children:[C===h.id?e.jsx(Te,{className:"w-4 h-4"}):e.jsx(mt,{className:"w-4 h-4"}),t("crypto.tokens")]}),C===h.id&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:N?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(pe,{size:"sm"})}):p!=null&&p.chains&&p.chains.length>0?e.jsx("div",{className:"space-y-4",children:p.chains.filter(f=>f.tokens.length>0||f.native_balance).sort((f,A)=>Number(A.total_usd)-Number(f.total_usd)).map(f=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:f.chain_name}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:a?"$***":`$${Number(f.total_usd).toFixed(2)}`})]}),e.jsxs("div",{className:"space-y-1",children:[f.native_balance&&Number(f.native_balance.balance)>0&&e.jsx(at,{token:f.native_balance,isPrivacyMode:a}),f.tokens.filter(A=>Number(A.balance_usd)>=1).sort((A,B)=>Number(B.balance_usd)-Number(A.balance_usd)).map(A=>e.jsx(at,{token:A,isPrivacyMode:a},A.token_address))]})]},f.chain_id))}):e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-2",children:t("crypto.noTokens")})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:(Q=h.sync_statuses)!=null&&Q.some(f=>f.last_sync_at)?t("crypto.lastSync",{time:new Date(Math.max(...h.sync_statuses.filter(f=>f.last_sync_at).map(f=>new Date(f.last_sync_at).getTime()))).toLocaleString()}):t("crypto.neverSynced")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x(h.id),disabled:u===h.id,className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg transition-colors",title:t("crypto.sync"),children:u===h.id?e.jsx(pe,{size:"sm"}):e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(h.id),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:t("delete"),children:e.jsx(Bt,{className:"w-4 h-4"})})]})]})]},h.id)})}):l?null:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Ce,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:t("crypto.noWallets")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:t("crypto.addWalletDescription")})]}),l?e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(Xe,{label:t("crypto.walletAddress"),placeholder:"0x...",value:g,onChange:h=>v(h.target.value)}),e.jsx(Xe,{label:t("crypto.walletLabel"),placeholder:t("crypto.walletLabelPlaceholder"),value:k,onChange:h=>R(h.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.selectChains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Os.map(h=>{var o;return e.jsx("button",{type:"button",onClick:()=>L(h),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${b.includes(h)?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:((o=Re[h])==null?void 0:o.name)||h.toUpperCase()},h)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(be,{variant:"outline",onClick:()=>n(!1),children:t("cancel")}),e.jsx(be,{onClick:i,disabled:!g.trim()||b.length===0||_.isPending,children:_.isPending?t("saving"):t("crypto.addWallet")})]})]}):e.jsxs(be,{variant:"outline",onClick:()=>n(!0),className:"w-full",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),t("crypto.addWallet")]})]})}function Bs({snapshots:t}){const{resolvedTheme:s}=zt(),r=s==="dark",a=r?"#374151":"#E5E7EB",c=r?"#9CA3AF":"#6B7280",l=r?"#1F2937":"#FFFFFF",n=r?"#374151":"#E5E7EB",g="#6366F1",v=m.useMemo(()=>[...t].sort((b,w)=>new Date(b.snapshot_date).getTime()-new Date(w.snapshot_date).getTime()).map(b=>({date:b.snapshot_date,value:Number(b.balance_usd),formattedDate:new Date(b.snapshot_date).toLocaleDateString(xe(),{month:"short",day:"numeric"})})),[t]),[k,R]=m.useMemo(()=>{const b=v.map(C=>C.value),w=Math.min(...b),u=Math.max(...b),P=(u-w)*.1||10;return[Math.max(0,w-P),u+P]},[v]);return v.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No historical data available"}):e.jsx(us,{width:"100%",height:"100%",children:e.jsxs(hs,{data:v,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(ys,{strokeDasharray:"3 3",stroke:a,vertical:!1}),e.jsx(bs,{dataKey:"formattedDate",tick:{fill:c,fontSize:11},tickLine:!1,axisLine:{stroke:a},interval:"preserveStartEnd"}),e.jsx(fs,{domain:[k,R],tick:{fill:c,fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:b=>`$${b.toFixed(0)}`,width:50}),e.jsx(gs,{contentStyle:{backgroundColor:l,border:`1px solid ${n}`,borderRadius:"8px",fontSize:"12px"},labelStyle:{color:c,fontWeight:"bold"},formatter:b=>[`$${b.toFixed(2)}`,"Value"]}),e.jsx(ps,{type:"monotone",dataKey:"value",stroke:g,strokeWidth:2,dot:v.length<=10,activeDot:{r:6,fill:g}})]})})}function zs({positionId:t}){var z,$;const{t:s}=Z(),r=ae(),[a,c]=m.useState(null),[l,n]=m.useState(!1),[g,v]=m.useState(null),[k,R]=m.useState(null),[b,w]=m.useState(null),{data:u,isLoading:P}=H({queryKey:["position-roi",t],queryFn:()=>ft(t)}),{data:C=[]}=H({queryKey:["position-rewards-list",t],queryFn:()=>is(t)}),T=W({mutationFn:()=>yt(90),onSuccess:d=>{c({scanned:d.scanned_claims,new:d.new_claims}),r.invalidateQueries({queryKey:["position-roi"]}),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["unattributed-rewards"]}),setTimeout(()=>c(null),5e3)}}),M=W({mutationFn:d=>pt(d),onSuccess:d=>{R(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:d.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),v(null),setTimeout(()=>R(null),5e3)},onError:d=>{w(d.message||s("crypto.transactionCreateError","Failed to create transaction")),v(null),setTimeout(()=>w(null),5e3)}}),j=W({mutationFn:d=>bt(d),onSuccess:d=>{const F=s("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:d.created,total:d.total_usd.toFixed(2),skipped:d.skipped});R(F),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>R(null),8e3)},onError:d=>{w(d.message||s("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>w(null),5e3)}}),S=C.filter(d=>!d.transaction_id),p=1,N=((z=u==null?void 0:u.rewards_by_token)==null?void 0:z.filter(d=>Number(d.amount_usd)>=p))||[],_=(($=u==null?void 0:u.rewards_by_month)==null?void 0:$.filter(d=>Number(d.amount_usd)>=p))||[],q=C.filter(d=>Number(d.reward_usd||0)>=p),E=N.reduce((d,F)=>d+Number(F.amount_usd||0),0);if(P)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const i=d=>{if(d==null)return null;const F=Number(d);return isNaN(F)?null:`$${F.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},y=d=>{if(d===null)return"-";const F=Number(d);return`${F>=0?"+":""}${F.toFixed(2)}%`},x=d=>{const[F,ee]=d.split("-");return new Date(Number(F),Number(ee)-1).toLocaleDateString(xe(),{month:"short",year:"numeric"})},L=d=>Number(d).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanRewardsHint","Scan blockchain for claimed rewards")}),e.jsx("button",{onClick:()=>T.mutate(),disabled:T.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:T.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(je,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),u&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),s("crypto.roiSummary","ROI Summary")]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),N.length>0?e.jsx("div",{className:"space-y-1",children:N.map(d=>{const F=i(d.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[L(d.amount)," ",d.symbol]}),F&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",F]})]},d.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:i(E)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[q.length," ",s("crypto.claims","claims")]})]}),u.cost_basis_usd!==null&&u.simple_roi_pct!==null&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-green-200 dark:border-green-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.costBasis","Cost Basis")}),e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:i(u.cost_basis_usd)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.roi","ROI")}),e.jsx("div",{className:`text-lg font-semibold ${u.simple_roi_pct>=0?"text-green-800 dark:text-green-200":"text-red-600 dark:text-red-400"}`,children:y(u.simple_roi_pct)}),u.days_held&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[u.days_held," ",s("crypto.daysHeld","days")]})]})]})]})]}),u&&_.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:_.map(d=>{const F=i(d.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:x(d.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[d.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[L(d.amount)," ",d.symbol]}),F&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",F]})]})]},`${d.month}-${d.symbol}`)})})]}),q.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>n(!l),className:"flex items-center gap-2 font-medium text-gray-900 dark:text-gray-100 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[e.jsx(Ie,{className:"h-4 w-4"}),s("crypto.allRewards","All Rewards")," (",q.length,")",l?e.jsx(kt,{className:"h-4 w-4"}):e.jsx(Te,{className:"h-4 w-4"})]}),S.length>0&&e.jsxs("button",{type:"button",onClick:()=>j.mutate(S.map(d=>d.id)),disabled:j.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 rounded-lg transition-colors",children:[j.isPending?e.jsx(Se,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(fe,{className:"h-3.5 w-3.5"}),s("crypto.createAllTransactions","Create All Txns")," (",S.length,")"]})]}),l&&e.jsxs(e.Fragment,{children:[k&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(je,{className:"h-4 w-4"}),k]}),b&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(le,{className:"h-4 w-4"}),b]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Number(d.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})," ",d.reward_token_symbol||"tokens"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[new Date(d.claimed_at).toLocaleDateString(xe())," via ",d.source,d.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(d.reward_usd).toFixed(2)]})]})]}),d.reward_usd&&Number(d.reward_usd)>0&&e.jsx("div",{className:"flex-shrink-0 ml-3",children:d.transaction_id?e.jsxs("a",{href:`/transactions?id=${d.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(Ve,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{v(d.id),M.mutate(d.id)},disabled:g===d.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[g===d.id?e.jsx(Se,{className:"h-3 w-3 animate-spin"}):e.jsx(Ie,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},d.id))})]})]}),u&&q.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(We,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),E<p?s("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:p}):s("crypto.noRewards","No rewards claimed for this position yet.")]})]})}function Qs({source:t="symbiotic"}){var q,E;const{t:s}=Z(),r=ae(),[a,c]=m.useState(null),[l,n]=m.useState(null),[g,v]=m.useState(null),{data:k,isLoading:R}=H({queryKey:["staking-rewards",t],queryFn:()=>os(t)}),{data:b=[]}=H({queryKey:["all-rewards"],queryFn:ds}),w=b.filter(i=>!i.transaction_id&&i.reward_usd&&Number(i.reward_usd)>0),u=W({mutationFn:()=>yt(90),onSuccess:i=>{c({scanned:i.scanned_claims,new:i.new_claims}),r.invalidateQueries({queryKey:["staking-rewards"]}),r.invalidateQueries({queryKey:["all-rewards"]}),setTimeout(()=>c(null),5e3)}}),P=W({mutationFn:i=>bt(i),onSuccess:i=>{const y=s("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:i.created,total:i.total_usd.toFixed(2),skipped:i.skipped});n(y),r.invalidateQueries({queryKey:["all-rewards"]}),r.invalidateQueries({queryKey:["staking-rewards"]}),r.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>n(null),8e3)},onError:i=>{v(i.message||s("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>v(null),5e3)}});if(R)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const C=i=>{if(i==null)return null;const y=Number(i);return isNaN(y)?null:`$${y.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},T=i=>{const[y,x]=i.split("-");return new Date(Number(y),Number(x)-1).toLocaleDateString(xe(),{month:"short",year:"numeric"})},M=i=>Number(i).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4}),j=t==="symbiotic"?"Symbiotic":t,S=1,p=((q=k==null?void 0:k.rewards_by_token)==null?void 0:q.filter(i=>Number(i.amount_usd)>=S))||[],N=((E=k==null?void 0:k.rewards_by_month)==null?void 0:E.filter(i=>Number(i.amount_usd)>=S))||[],_=p.reduce((i,y)=>i+Number(y.amount_usd||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanStakingRewardsHint","Scan blockchain for claimed staking rewards")}),e.jsx("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(je,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),l&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(je,{className:"h-4 w-4"}),l]}),g&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(le,{className:"h-4 w-4"}),g]}),w.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:s("crypto.unlinkedRewardsHint","{{count}} rewards ready to convert to transactions",{count:w.length})}),e.jsx("button",{onClick:()=>P.mutate(w.map(i=>i.id)),disabled:P.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-amber-600 hover:bg-amber-700 disabled:bg-amber-400 text-white text-sm font-medium rounded-lg transition-colors",children:P.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4 animate-spin"}),s("crypto.creating","Creating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"}),s("crypto.createAllTransactions","Create All Txns")," (",w.length,")"]})})]}),k&&p.length>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),s("crypto.stakingRewardsSummary","{{source}} Rewards Summary",{source:j})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),p.length>0?e.jsx("div",{className:"space-y-1",children:p.map(i=>{const y=C(i.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[M(i.amount)," ",i.symbol]}),y&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",y]})]},i.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:C(_)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[N.reduce((i,y)=>i+y.count,0)," ",s("crypto.claims","claims")]})]})})]}),k&&N.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:N.map(i=>{const y=C(i.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:T(i.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[M(i.amount)," ",i.symbol]}),y&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",y]})]})]},`${i.month}-${i.symbol}`)})})]}),k&&p.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(We,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:_<S?s("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:S}):s("crypto.noStakingRewards","No staking rewards found")}),e.jsx("p",{className:"text-sm",children:s("crypto.noStakingRewardsHint",'Click "Scan Rewards" to search for claimed rewards on the blockchain.')})]})]})}async function Ks(t,s){return(await De.post(`/api/crypto/positions/${encodeURIComponent(t)}/close`,s)).data}async function Hs(){return(await De.get("/api/crypto/positions/closed")).data}function Us({group:t,lastSnapshotValueUsd:s,costBasisUsd:r,totalRewardsUsd:a,onClose:c,onSuccess:l}){var d;const{t:n}=Z("common"),{data:g}=He(),v=((d=g==null?void 0:g.rates)==null?void 0:d.USD)||150,k=ae(),[R,b]=m.useState(new Date().toISOString().slice(0,16)),[w,u]=m.useState(s),[P,C]=m.useState(Math.round(s*v)),[T,M]=m.useState(null),[j,S]=m.useState(`LP Exit: ${t.protocol} ${t.name}`),[p,N]=m.useState("");m.useEffect(()=>{C(Math.round(w*v))},[w,v]);const{data:_}=H({queryKey:["accounts"],queryFn:()=>Kt()}),q=(_==null?void 0:_.filter(F=>F.is_active&&(F.type==="bank"||F.type==="savings")))||[],E=r!==null?w-r+(a||0):null,i=r&&E!==null?E/r*100:null,y=t.tokens[0],x=(y==null?void 0:y.id)||"",L=(y==null?void 0:y.wallet_address)||"",z=W({mutationFn:()=>{if(!T)throw new Error(n("crypto.selectAccount","Select destination account"));const F={exit_date:new Date(R).toISOString(),exit_value_usd:w,exit_value_jpy:P,destination_account_id:T,note:j||void 0,tx_hash:p||void 0,wallet_address:L,chain_id:t.chain_id,protocol:t.protocol,symbol:t.name};return Ks(x,F)},onSuccess:()=>{k.invalidateQueries({queryKey:["closed-positions"]}),k.invalidateQueries({queryKey:["defi-positions"]}),k.invalidateQueries({queryKey:["accounts"]}),l(),c()}}),$=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-hidden",style:{touchAction:"pan-y"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:c}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:n("crypto.closePosition","Close Position")}),e.jsx("button",{onClick:c,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.protocol," - ",t.name]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.chain_id.toUpperCase()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Ue,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitDate","Exit Date")]}),e.jsx("input",{type:"datetime-local",value:R,onChange:F=>b(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ut,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitValue","Exit Value")," (USD)"]}),e.jsx("input",{type:"number",step:"0.01",value:w,onChange:F=>u(parseFloat(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("crypto.exitValue","Exit Value")," (JPY)"]}),e.jsx("input",{type:"number",value:P,onChange:F=>C(parseInt(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Ce,{className:"w-4 h-4 inline mr-1"}),n("crypto.destinationAccount","Destination Account")]}),e.jsxs("select",{value:T||"",onChange:F=>M(parseInt(F.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:n("select","Select...")}),q.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("note","Note")}),e.jsx("input",{type:"text",value:j,onChange:F=>S(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["TX Hash (",n("optional","optional"),")"]}),e.jsx("input",{type:"text",value:p,onChange:F=>N(F.target.value),placeholder:"0x...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-sm"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("crypto.pnlPreview","P&L Preview")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.costBasis","Cost Basis")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r!==null?`$${r.toFixed(2)}`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.totalRewards","Total Rewards")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a?`$${a.toFixed(2)}`:"$0.00"})]}),e.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.realizedPnl","Realized P&L")}),e.jsx("p",{className:`text-lg font-bold ${E!==null?E>=0?"text-green-600":"text-red-600":"text-gray-400"}`,children:E!==null?`${E>=0?"+":""}$${E.toFixed(2)} (${i==null?void 0:i.toFixed(1)}%)`:"N/A"})]})]})]}),z.error&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qt,{className:"w-4 h-4"}),z.error.message]})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",children:n("cancel","Cancel")}),e.jsx("button",{onClick:()=>z.mutate(),disabled:!T||z.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:z.isPending?n("loading","Loading..."):n("crypto.confirmClose","Confirm Close")})]})]})]});return typeof document>"u"?null:Ae.createPortal($,document.body)}function Vs({group:t,onClose:s}){const[r,a]=m.useState("overview"),[c,l]=m.useState(!1),n=t.tokens[0],g=rt({queries:t.tokens.map(j=>({queryKey:["position-history",j.id],queryFn:()=>cs(j.id,30),retry:!1}))}),v=g.some(j=>j.isLoading),k=m.useMemo(()=>{const j=g.filter(N=>{var _;return(_=N.data)==null?void 0:_.snapshots}).flatMap(N=>N.data.snapshots);if(j.length===0)return null;const S=new Map;for(const N of j){const _=S.get(N.snapshot_date)||0;S.set(N.snapshot_date,_+Number(N.balance_usd))}return{snapshots:Array.from(S.entries()).map(([N,_])=>({snapshot_date:N,balance_usd:_}))}},[g]),R=rt({queries:t.tokens.map(j=>({queryKey:["position-performance",j.id],queryFn:()=>xs(j.id),retry:!1}))}),b=R.some(j=>j.isLoading),w=R.every(j=>!j.isLoading),u=m.useMemo(()=>{if(!w)return null;const j=R.filter($=>$.data);if(j.length===0)return null;const S=j[0].data;if(j.length===1)return S;let p=0,N=0,_=0,q=0,E=0,i=!1,y=0,x=0;for(const $ of j){const d=$.data;p+=Number(d.start_value_usd),N+=Number(d.current_value_usd),_+=Number(d.total_return_usd),q=Math.max(q,d.days_held),E+=d.snapshot_count,d.il_usd!=null&&(i=!0,y+=Number(d.il_usd)),d.hodl_value_usd!=null&&(x+=Number(d.hodl_value_usd))}const L=p>0?_/p*100:0;let z=null;if(q>=7&&p>0){const $=((N/p)**(365/q)-1)*100;Math.abs($)<=500&&(z=$)}return{position_id:S.position_id,protocol:S.protocol,symbol:t.name,days_held:q,start_value_usd:p,current_value_usd:N,total_return_usd:_,total_return_pct:L,annualized_return_pct:z,current_apy:S.current_apy,snapshot_count:E,il_percentage:i&&p>0?y/p*100:null,il_usd:i?y:null,hodl_value_usd:i?x:null,lp_vs_hodl_usd:i?N-x:null,lp_outperformed_hodl:i?N>x:void 0}},[R,t.name,w]),{data:P}=H({queryKey:["position-roi",n.id],queryFn:()=>ft(n.id),retry:!1}),C=v||b,T=j=>{const S=Number(j.balance);return S<1e-4?"<0.0001":S<1?S.toFixed(4):S.toFixed(2)},M=e.jsxs("div",{className:"fixed inset-0 z-[100001]",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsx("div",{className:"fixed inset-0 z-[100002] flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90dvh] my-auto overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 dark:from-gray-800 dark:to-gray-900 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex -space-x-2",children:t.tokens.slice(0,3).map((j,S)=>j.logo_url?e.jsx("img",{src:j.logo_url,alt:j.symbol,className:"w-10 h-10 rounded-full border-2 border-white/20",style:{zIndex:t.tokens.length-S}},j.id):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",style:{zIndex:t.tokens.length-S},children:j.symbol.slice(0,2)},j.id))}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:t.protocol}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.name})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Current Value"}),e.jsxs("p",{className:"text-4xl font-bold",children:["$",t.total_usd.toFixed(2)]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-2 text-sm",children:e.jsx("span",{className:"text-gray-400",children:t.tokens.map((j,S)=>e.jsxs("span",{children:[S>0&&" + ",T(j)," ",j.symbol]},j.id))})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>a("overview"),className:I("flex-1 px-4 py-3 text-sm font-medium transition-colors",r==="overview"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:"Gain/Loss"}),e.jsxs("button",{onClick:()=>a("rewards"),className:I("flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2",r==="rewards"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:[e.jsx(We,{className:"w-4 h-4"}),"Rewards"]})]}),e.jsx("div",{className:"p-4 space-y-4 max-h-[50vh] overflow-y-auto",children:C?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(pe,{size:"lg"})}):e.jsxs(e.Fragment,{children:[r==="overview"&&e.jsxs(e.Fragment,{children:[u&&e.jsxs(ie,{className:"overflow-hidden",children:[e.jsxs("div",{className:I("p-4 text-center",Number(u.total_return_pct)>=0?"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20":"bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[Number(u.total_return_pct)>=0?e.jsx(As,{className:"w-5 h-5 text-green-600"}):e.jsx(Ss,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:I("text-sm font-medium",Number(u.total_return_pct)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:"Total Return"})]}),e.jsxs("p",{className:I("text-3xl font-bold",Number(u.total_return_pct)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[Number(u.total_return_pct)>=0?"+":"",u.total_return_pct.toFixed(2),"%"]}),e.jsxs("p",{className:I("text-lg font-semibold mt-1",Number(u.total_return_usd)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:[Number(u.total_return_usd)>=0?"+":"","$",Math.abs(Number(u.total_return_usd)).toFixed(2)]})]}),e.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(ut,{className:"w-3.5 h-3.5"}),"Invested"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",Number(u.start_value_usd).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(js,{className:"w-3.5 h-3.5"}),"Duration"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[u.days_held," days"]})]})]})]}),u&&u.annualized_return_pct!==null&&e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qs,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Annualized Return"})]}),e.jsxs("span",{className:I("font-bold text-lg",Number(u.annualized_return_pct)>=0?"text-green-600":"text-red-600"),children:[Number(u.annualized_return_pct)>=0?"+":"",u.annualized_return_pct.toFixed(2),"%"]})]})}),u&&u.current_apy!=null&&e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current APY"})]}),e.jsxs("span",{className:"font-bold text-lg text-purple-600 dark:text-purple-400",children:[Number(u.current_apy).toFixed(2),"%"]})]})}),k&&k.snapshots.length>0&&e.jsxs(ie,{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-3",children:"30-Day Performance"}),e.jsx("div",{className:"h-40",children:e.jsx(Bs,{snapshots:k.snapshots})})]}),e.jsx("button",{onClick:()=>l(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Close Position"})]}),r==="rewards"&&e.jsx(e.Fragment,{children:t.protocol_module==="staked"?e.jsx(Qs,{source:"symbiotic"}):e.jsx(zs,{positionId:n.id})})]})}),c&&e.jsx(Us,{group:t,lastSnapshotValueUsd:t.total_usd,costBasisUsd:(P==null?void 0:P.cost_basis_usd)??null,totalRewardsUsd:(P==null?void 0:P.total_rewards_usd)??null,onClose:()=>l(!1),onSuccess:()=>{l(!1),s()}})]})})]});return typeof document>"u"?null:Ae.createPortal(M,document.body)}function Ws({walletId:t}){const{t:s}=Z(),r=ae(),[a,c]=m.useState(new Set),[l,n]=m.useState(""),{data:g=[]}=H({queryKey:["unattributed-rewards"],queryFn:jt}),{data:v}=H({queryKey:["defi-positions",t],queryFn:()=>vt(t),enabled:!!t}),k=W({mutationFn:({rewardIds:x,positionId:L})=>ms(x,L),onSuccess:()=>{r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["position-rewards"]}),c(new Set),n("")}}),[R,b]=m.useState(null),[w,u]=m.useState(null),[P,C]=m.useState(null),T=W({mutationFn:x=>pt(x),onSuccess:x=>{u(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:x.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["transactions"]}),b(null),setTimeout(()=>u(null),5e3)},onError:x=>{C(x.message||s("crypto.transactionCreateError","Failed to create transaction")),b(null),setTimeout(()=>C(null),5e3)}});if(g.length===0)return null;const M=1,j=g.filter(x=>Number(x.reward_usd||0)>=M);if(j.length===0)return null;const S=(v==null?void 0:v.positions)||[],p=x=>`${Number(x.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})} ${x.reward_token_symbol||"tokens"}`,N=x=>new Date(x).toLocaleDateString(xe(),{month:"short",day:"numeric",year:"numeric"}),_=x=>{const L=new Set(a);L.has(x)?L.delete(x):L.add(x),c(L)},q=()=>{a.size===j.length?c(new Set):c(new Set(j.map(x=>x.id)))},E=j.length>0&&a.size===j.length,i=a.size>0,y=()=>{a.size===0||!l||k.mutate({rewardIds:Array.from(a),positionId:l})};return e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(vs,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),e.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:s("crypto.unattributedRewards",{count:j.length})})]}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:s("crypto.unattributedRewardsDesc","These rewards need to be assigned to a position for ROI tracking.")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-yellow-100 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:q,className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[E?e.jsx(et,{className:"h-4 w-4 text-primary-600"}):e.jsx(tt,{className:"h-4 w-4"}),E?s("deselectAll","Deselect All"):s("selectAll","Select All")]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs("select",{value:l,onChange:x=>n(x.target.value),disabled:!i,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:s("crypto.selectPosition","Select position...")}),S.map(x=>e.jsxs("option",{value:x.id,children:[x.protocol," - ",x.symbol]},x.id))]}),e.jsxs("button",{type:"button",onClick:y,disabled:!i||!l||k.isPending,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-md transition-colors disabled:cursor-not-allowed",children:[e.jsx(Ht,{className:"h-4 w-4"}),k.isPending?s("assigning","Assigning..."):s("crypto.assignSelected","Assign {{count}} Selected",{count:a.size})]})]})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(je,{className:"h-4 w-4"}),w]}),P&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(le,{className:"h-4 w-4"}),P]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:j.map(x=>e.jsxs("div",{onClick:()=>_(x.id),className:`flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-colors ${a.has(x.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700":"bg-white dark:bg-gray-800 border-yellow-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:a.has(x.id)?e.jsx(et,{className:"h-5 w-5 text-primary-600"}):e.jsx(tt,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:p(x)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[N(x.claimed_at)," via ",x.source,x.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(x.reward_usd).toFixed(2)]})]})]}),x.reward_usd&&x.reward_usd>0&&e.jsx("div",{className:"flex-shrink-0",onClick:L=>L.stopPropagation(),children:x.transaction_id?e.jsxs("a",{href:`/transactions?id=${x.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(Ve,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{b(x.id),T.mutate(x.id)},disabled:R===x.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[R===x.id?e.jsx(Se,{className:"h-3 w-3 animate-spin"}):e.jsx(Ie,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},x.id))}),i&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200 dark:border-gray-700 text-sm text-yellow-700 dark:text-yellow-300",children:s("crypto.selectedRewards","{{count}} reward(s) selected",{count:a.size})})]})}const Js={deposit:"ðŸ’°",stake:"ðŸ”’",borrow:"ðŸ’¸",reward:"ðŸŽ",liquidity:"ðŸ’§"},Ys={liquidity_pool:"LP",staking:"Staking",lending:"Lending",farming:"Farming",vault:"Vault"};function Gs(t){const s={};for(const r of t){const a=`${r.protocol}-${r.chain_id}-${r.name||r.token_name}-${r.position_type}`;s[a]||(s[a]={key:a,name:r.name||r.token_name,protocol:r.protocol,protocol_module:r.protocol_module,position_type:r.position_type,chain_id:r.chain_id,tokens:[],total_usd:0}),s[a].tokens.push(r),s[a].total_usd+=Number(r.balance_usd)}return Object.values(s)}function Xs({group:t,onClick:s,isPrivacyMode:r}){const a=t.chain_id,c=Re[a],l=t.tokens[0],n=r?t.tokens.map(g=>`*** ${g.symbol}`).join(" + "):t.tokens.map(g=>{const v=Number(g.balance);return`${v<1e-4?"<0.0001":v<1?v.toFixed(4):v.toFixed(2)} ${g.symbol}`}).join(" + ");return e.jsxs("button",{onClick:()=>s(t),className:"w-full flex items-center justify-between py-3 px-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors text-left group",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:t.tokens.length>1?e.jsxs("div",{className:"flex -space-x-2",children:[t.tokens.slice(0,3).map((g,v)=>g.logo_url?e.jsx("img",{src:g.logo_url,alt:g.symbol,className:"w-7 h-7 rounded-full border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-v},onError:k=>{k.target.style.display="none"}},g.id):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-v},children:g.symbol.slice(0,2)},g.id)),t.tokens.length>3&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",t.tokens.length-3]})]}):l.logo_url?e.jsx("img",{src:l.logo_url,alt:l.symbol,className:"w-8 h-8 rounded-full",onError:g=>{g.target.style.display="none"}}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:Js[t.position_type]||"ðŸ“ˆ"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.protocol}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:Ys[t.protocol_module]||t.protocol_module})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"truncate",children:t.name}),c&&e.jsxs("span",{className:"text-xs px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:[c.icon," ",a.toUpperCase()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:r?"$***":`$${t.total_usd.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[180px] truncate",children:n})]}),e.jsx(mt,{className:"w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors"})]})]})}function lt(){const{t}=Z("common"),{currency:s}=xt(),{isPrivacyMode:r}=we(),[a,c]=m.useState(null),l=Me(),{data:n,isLoading:g}=H({queryKey:["crypto-wallets"],queryFn:ht}),{data:v=[]}=H({queryKey:["unattributed-rewards"],queryFn:jt}),{data:k,isLoading:R,refetch:b}=H({queryKey:["crypto-defi-positions",n==null?void 0:n.map(p=>p.id)],queryFn:async()=>!n||n.length===0?[]:await Promise.all(n.map(N=>vt(N.id).catch(()=>({wallet_address:N.wallet_address,total_value_usd:0,positions:[],last_sync_at:null})))),enabled:!!n&&n.length>0}),w=(k==null?void 0:k.flatMap(p=>p.positions))||[],u=Gs(w),P=(k==null?void 0:k.reduce((p,N)=>p+Number(N.total_value_usd||0),0))||0,C=1/((l==null?void 0:l.USD)||.00667),T=Math.round(P*C),M=u.reduce((p,N)=>{const _=N.protocol;return p[_]||(p[_]=[]),p[_].push(N),p},{});if(g||R)return e.jsx(Fe,{title:t("crypto.defiPositions"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(pe,{size:"md"})})});if(!n||n.length===0)return null;const S=v.length>0?`${u.length} Â· ${v.length} âš `:u.length;return e.jsxs(Fe,{title:t("crypto.defiPositions"),badge:S,defaultOpen:u.length>0,children:[w.length>0&&e.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalDefiValue")}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:se(T,s,l,!1,r)})]}),e.jsx("button",{onClick:()=>b(),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors",title:t("crypto.refresh"),children:e.jsx(re,{className:"w-5 h-5"})})]})}),n[0]&&e.jsx("div",{className:"mb-4",children:e.jsx(Ws,{walletId:n[0].id})}),u.length>0?e.jsx("div",{className:"space-y-4",children:Object.entries(M).sort(([,p],[,N])=>{const _=p.reduce((E,i)=>E+i.total_usd,0);return N.reduce((E,i)=>E+i.total_usd,0)-_}).map(([p,N])=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:p}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r?"$***":`$${N.reduce((_,q)=>_+q.total_usd,0).toFixed(2)}`})]})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:N.sort((_,q)=>q.total_usd-_.total_usd).map(_=>e.jsx(Xs,{group:_,onClick:c,isPrivacyMode:r},_.key))})]},p))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ts,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("crypto.noDefiPositions")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("crypto.noDefiPositionsDescription")})]}),a&&e.jsx(Vs,{group:a,onClose:()=>c(null)})]})}function it(){const{t}=Z("common"),[s,r]=m.useState(!1),{data:a,isLoading:c}=H({queryKey:["closed-positions"],queryFn:Hs});return c||!a||a.total_closed===0?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!s),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_s,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t("crypto.closedPositions","Closed Positions")}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.total_closed," ",t("crypto.positions","positions")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[a.total_realized_pnl_jpy!==null&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:t("crypto.totalPnl","Total P&L")}),e.jsxs("p",{className:`font-medium ${a.total_realized_pnl_jpy>=0?"text-green-600":"text-red-600"}`,children:[a.total_realized_pnl_jpy>=0?"+":"",_e(a.total_realized_pnl_jpy,"JPY")]})]}),s?e.jsx(kt,{className:"w-5 h-5 text-gray-500"}):e.jsx(Te,{className:"w-5 h-5 text-gray-500"})]})]}),s&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 space-y-3",children:a.positions.map(l=>{const n=Re[l.chain_id],g=l.realized_pnl_jpy!==null&&l.realized_pnl_jpy>=0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[l.protocol," - ",l.symbol]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[n&&e.jsx("span",{children:n.icon}),e.jsx("span",{children:new Date(l.exit_date).toLocaleDateString(xe())})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:_e(l.exit_value_jpy,"JPY")}),l.realized_pnl_jpy!==null&&e.jsxs("div",{className:`flex items-center justify-end gap-1 text-sm ${g?"text-green-600":"text-red-600"}`,children:[g?e.jsx(Pe,{className:"w-3 h-3"}):e.jsx(Ut,{className:"w-3 h-3"}),g?"+":"",_e(l.realized_pnl_jpy,"JPY"),l.realized_pnl_pct!==null&&e.jsxs("span",{className:"text-xs",children:["(",l.realized_pnl_pct.toFixed(1),"%)"]})]})]})]},l.id)})})]})}async function Zs(t){return(await De.post("/api/transfers/",t)).data}async function er(t){return(await De.post("/api/transfers/exchange",t)).data}const he={JPY:"Â¥",USD:"$",VND:"â‚«"};function ye(t){const s=t.replace(/[^\d]/g,"");return s?parseInt(s).toLocaleString("en-US"):""}function J(t){return parseInt(t.replace(/[,.\s]/g,""),10)||0}function tr({isOpen:t,onClose:s}){const{t:r}=Z("common"),a=ae(),{data:c}=gt(),l=Me(),[n,g]=m.useState(null),[v,k]=m.useState(null),[R,b]=m.useState(""),[w,u]=m.useState(""),[P,C]=m.useState(""),[T,M]=m.useState(new Date().toISOString().split("T")[0]),[j,S]=m.useState(""),[p,N]=m.useState({}),[_,q]=m.useState(!1),[E,i]=m.useState(null),y=m.useMemo(()=>c==null?void 0:c.find(o=>o.id===n),[c,n]),x=m.useMemo(()=>c==null?void 0:c.find(o=>o.id===v),[c,v]),L=m.useMemo(()=>(c==null?void 0:c.filter(o=>o.id!==n))||[],[c,n]),{data:z}=H({queryKey:["transactions","income",y==null?void 0:y.currency],queryFn:()=>Wt({type:"income"}),enabled:_&&!!y,select:o=>o.filter(Q=>Q.currency===(y==null?void 0:y.currency))});m.useEffect(()=>{if(!y||!x||!R||!l)return;const o=J(R);if(o<=0)return;if(y.currency===x.currency){u(ye(o.toString()));return}const Q=l[y.currency]||1,f=l[x.currency]||1,A=o/Q,B=Math.round(A*f);u(ye(B.toString()))},[y,x,R,l]),m.useEffect(()=>{var o;t&&(g(((o=c==null?void 0:c[0])==null?void 0:o.id)||null),k(null),b(""),u(""),C(""),M(new Date().toISOString().split("T")[0]),S(""),N({}),q(!1),i(null))},[t,c]);const $=W({mutationFn:Zs,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["transfers"]}),a.invalidateQueries({queryKey:["analytics"]}),s()}}),d=W({mutationFn:er,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["transfers"]}),a.invalidateQueries({queryKey:["analytics"]}),s()}}),F=_?d:$,ee=()=>{const o={};return n||(o.fromAccount=r("transfer.errors.fromRequired")),v||(o.toAccount=r("transfer.errors.toRequired")),n&&v&&n===v&&(o.toAccount=r("transfer.errors.sameAccount")),(!R||J(R)<=0)&&(o.fromAmount=r("transfer.errors.amountRequired")),(!w||J(w)<=0)&&(o.toAmount=r("transfer.errors.amountRequired")),N(o),Object.keys(o).length===0},D=o=>{if(o.preventDefault(),!ee())return;const Q=(y==null?void 0:y.currency)||"JPY",f=(x==null?void 0:x.currency)||"JPY";if(_){const A={date:T,from_account_id:n,from_amount:ue(J(R),Q),to_account_id:v,to_amount:ue(J(w),f),link_to_transaction_id:E||void 0,notes:j.trim()||void 0};d.mutate(A)}else{const A={from_account_id:n,to_account_id:v,from_amount:ue(J(R),Q),to_amount:ue(J(w),f),fee_amount:ue(J(P)||0,Q),date:T,description:j.trim()||void 0};y&&x&&y.currency!==x.currency&&(A.exchange_rate=J(w)/J(R)),$.mutate(A)}};if(!t)return null;const h=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 animate-modal-backdrop",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:_?r("transfer.exchangeTitle","Currency Exchange"):r("transfer.title")}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:D,className:"p-6 space-y-5",children:[e.jsx("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:o=>q(o.target.checked),className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx(re,{className:"w-4 h-4"}),r("transfer.exchangeMode","Currency Exchange")]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.fromAccount")}),e.jsxs("select",{value:n||"",onChange:o=>g(o.target.value?parseInt(o.target.value):null),className:I("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.fromAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),c==null?void 0:c.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",he[o.currency]||o.currency,")"]},o.id))]}),p.fromAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.fromAccount})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Vt,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.toAccount")}),e.jsxs("select",{value:v||"",onChange:o=>k(o.target.value?parseInt(o.target.value):null),className:I("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.toAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),L.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",he[o.currency]||o.currency,")"]},o.id))]}),p.toAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.toAccount})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:y?he[y.currency]||y.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:R,onChange:o=>b(ye(o.target.value)),className:I("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.fromAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),p.fromAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.fromAmount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.convertedAmount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:x?he[x.currency]||x.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:w,onChange:o=>u(ye(o.target.value)),className:I("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.toAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),p.toAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.toAmount})]})]}),y&&x&&y.currency!==x.currency&&R&&w&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["1 ",y.currency," â‰ˆ ",(J(w)/J(R)).toFixed(4)," ",x.currency]}),_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.linkToIncome","Link to Income")," (",r("optional"),")"]}),e.jsxs("select",{value:E||"",onChange:o=>i(o.target.value?parseInt(o.target.value):null),className:"w-full h-12 px-4 border border-gray-300 rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",children:[e.jsx("option",{value:"",children:r("transfer.noLink","None")}),z==null?void 0:z.map(o=>e.jsxs("option",{value:o.id,children:[o.date," - ",o.description," (",_e(o.amount,o.currency),")"]},o.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:r("transfer.linkToIncomeHelp","Link this exchange to an income transaction for tracking")})]}),!_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.fee")," (",r("optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:y?he[y.currency]||y.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:P,onChange:o=>C(ye(o.target.value)),className:"w-full h-12 pl-10 pr-4 border border-gray-300 rounded-lg text-right dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.date")}),e.jsx("input",{type:"date",value:T,onChange:o=>M(o.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.description")," (",r("optional"),")"]}),e.jsx("input",{type:"text",value:j,onChange:o=>S(o.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:r("transfer.descriptionPlaceholder")})]}),F.isError&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:r("transfer.error")}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(be,{type:"button",variant:"outline",onClick:s,className:"flex-1 h-12",children:r("cancel")}),e.jsx(be,{type:"submit",loading:F.isPending,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700",children:r("transfer.create")})]})]})]})]});return typeof document>"u"?null:Ae.createPortal(h,document.body)}const Nt="accounts_collapsed_sections";function sr(){try{const t=localStorage.getItem(Nt);if(t)return new Set(JSON.parse(t))}catch{}return new Set}function rr(t){localStorage.setItem(Nt,JSON.stringify([...t]))}const ot=["bank","savings","cash","credit_card","investment","crypto","receivable","other"];function ar(){const{t}=Z("common"),[s,r]=m.useState(!1),[a,c]=m.useState(""),l=Zt(a,200),[n,g]=m.useState(null),[v,k]=m.useState(!1),[R,b]=m.useState(!1),[w,u]=m.useState(!1),[P,C]=m.useState(!1),[T,M]=m.useState(null),[j,S]=m.useState(null),[p,N]=m.useState(()=>sr()),{data:_}=He(),{isPrivacyMode:q}=we();m.useEffect(()=>{rr(p)},[p]),m.useEffect(()=>{const f=()=>u(!0),A=()=>C(!0);return window.addEventListener("open-add-transaction-modal",f),window.addEventListener("open-receipt-scanner",A),()=>{window.removeEventListener("open-add-transaction-modal",f),window.removeEventListener("open-receipt-scanner",A)}},[]);const E=m.useCallback(f=>{N(A=>{const B=new Set(A);return B.has(f)?B.delete(f):B.add(f),B})},[]),{data:i,isLoading:y,error:x}=gt(s),L=m.useMemo(()=>{if(!i)return[];let f=i;if(l.trim()){const A=l.toLowerCase();f=f.filter(B=>{var me;return B.name.toLowerCase().includes(A)||t(`account.type.${B.type}`).toLowerCase().includes(A)||((me=B.notes)==null?void 0:me.toLowerCase().includes(A))})}return n&&(f=f.filter(A=>A.type===n)),f},[i,l,n,t]),z=m.useMemo(()=>L.reduce((f,A)=>{const B=A.type;return f[B]||(f[B]=[]),f[B].push(A),f},{}),[L]),$=m.useMemo(()=>{if(!i)return[];const f=new Set(i.map(A=>A.type));return ot.filter(A=>f.has(A))},[i]),d=m.useMemo(()=>L.length?L.reduce((f,A)=>f+A.current_balance,0):0,[L]),F=()=>{M(null),k(!0)},ee=f=>{M(f),k(!0)},D=()=>{k(!1),M(null)},h=i&&i.length>0,o=L.length>0,Q=l.trim()!==""||n!==null;return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 pb-32",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("account.accounts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:t("account.subtitle")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b(!0),className:"inline-flex items-center gap-2 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("transfer.title")})]}),e.jsxs("button",{onClick:F,className:"inline-flex items-center gap-2 px-3 py-2 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),t("account.createAccount")]})]})]})}),h&&e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:a,onChange:f=>c(f.target.value),placeholder:t("account.searchPlaceholder","Search accounts..."),className:"w-full pl-10 pr-10 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all text-sm"}),a&&e.jsx("button",{onClick:()=>c(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(le,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide pb-1",children:[e.jsxs("button",{onClick:()=>g(null),className:I("px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",n?"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800":"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400"),children:[t("account.allTypes","All")," (",(i==null?void 0:i.length)||0,")"]}),$.map(f=>{const A=(i==null?void 0:i.filter(B=>B.type===f).length)||0;return e.jsxs("button",{onClick:()=>g(n===f?null:f),className:I("px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",n===f?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[t(`account.type.${f}`)," (",A,")"]},f)}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>r(!s),className:I("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",s?"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300":"text-gray-500 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[s?e.jsx(Jt,{className:"w-3.5 h-3.5"}):e.jsx(Yt,{className:"w-3.5 h-3.5"}),t("account.showInactive")]})]})]}),h&&o&&e.jsx("div",{className:"mb-6",children:e.jsx(ie,{variant:"glass",className:"!p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:Q?t("account.filteredBalance","Filtered Balance"):t("account.totalBalance","Total Balance")}),e.jsx("p",{className:I("text-2xl sm:text-3xl font-bold font-mono mt-1",d>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:se(d,"JPY",(_==null?void 0:_.rates)||{},!0,q)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[L.length," ",t("account.accountCount","accounts")]})})]})})}),y&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}),x&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 dark:text-red-400 text-sm",children:t("account.errors.loadFailed")})}),!y&&!x&&!h&&e.jsx(Gt,{icon:e.jsx(Ce,{}),title:t("emptyState.accounts.title"),description:t("emptyState.accounts.description"),action:e.jsxs("button",{onClick:F,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm",children:[e.jsx(fe,{className:"w-4 h-4"}),t("emptyState.accounts.cta")]})}),!y&&!x&&h&&!o&&Q&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ze,{className:"w-10 h-10 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:t("account.noSearchResults","No accounts match your search")}),e.jsx("button",{onClick:()=>{c(""),g(null)},className:"mt-2 text-sm text-primary-600 dark:text-primary-400 hover:underline",children:t("account.clearFilters","Clear filters")})]}),!y&&!x&&o&&e.jsxs("div",{className:"space-y-6",children:[ot.map(f=>{const A=z[f];if(!A||A.length===0)return null;const B=p.has(f);return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>E(f),className:"w-full flex items-center justify-between mb-3 group cursor-pointer",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[t(`account.type.${f}`),e.jsx("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full",children:A.length})]}),e.jsx(Te,{className:I("w-4 h-4 text-gray-400 transition-transform duration-200",B&&"-rotate-90")})]}),e.jsx("div",{className:I("grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 transition-all duration-200 ease-in-out",B?"max-h-0 opacity-0 overflow-hidden":"max-h-[2000px] opacity-100"),children:A.map((me,wt)=>e.jsx("div",{className:"animate-stagger-in",style:{"--stagger-index":Math.min(wt,9)},children:e.jsx($s,{account:me,onEdit:ee,onAddTransaction:_t=>{S(_t),u(!0)}})},me.id))})]},f)}),e.jsx(nt,{}),e.jsx(lt,{}),e.jsx(it,{})]}),!y&&!x&&!h&&e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx(nt,{}),e.jsx(lt,{}),e.jsx(it,{})]}),e.jsx(Is,{isOpen:v,onClose:D,editingAccountId:T}),e.jsx(tr,{isOpen:R,onClose:()=>b(!1)}),e.jsx(es,{isOpen:w,onClose:()=>{u(!1),S(null)},defaultAccountId:j}),e.jsx(ts,{isOpen:P,onClose:()=>C(!1),onScanComplete:()=>C(!1)})]})}const kr=Xt("/accounts")({component:ar});export{kr as Route};
