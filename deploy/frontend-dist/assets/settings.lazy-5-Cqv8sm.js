import{k as $,H as P,u as M,J as z,r as d,z as I,a2 as E,j as e,C as D,E as K,B as S,P as pe,l as f,T as se,g as re,X as ne,v as B,af as Y,I as T,ag as be,ah as X,ai as fe,aj as H,ak as je,al as ie,R as ve,am as ke,an as le,V as Ne,ao as we,ap as Ce,i as _e}from"./index-BadmHgZg.js";import{C as G,c as Se,d as Pe,s as qe,a as Re,b as Ee,e as A,f as Te,g as De}from"./crypto-BJneVhYS.js";import{S as ce}from"./Select-CPZb2nKz.js";import{P as Fe,R as Me}from"./RecurringTransactionsList-BXnGrCIg.js";import{T as J}from"./tag-BhEr-Pf9.js";import{u as Ae,a as Ke,b as Le,c as Ie}from"./useCategories-D0myzyAT.js";import{P as ze}from"./pencil-HHbBz3-Q.js";import"./chevron-down-CTA-3p6f.js";import"./recurring-service-C8eYQ5ws.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Oe=$("mail",We);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],He=$("repeat",Qe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ue=$("save",$e);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Je=$("smartphone",Ve);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Ye=$("wand-sparkles",Be);async function Ge(){return(await P.get("/api/category-rules/")).data.rules}async function Xe(t){return(await P.post("/api/category-rules/",t)).data}async function Ze(t){await P.delete(`/api/category-rules/${t}`)}async function et(t=!0){return(await P.post("/api/category-rules/apply",{dry_run:t})).data}async function tt(){return(await P.get("/api/category-rules/suggest")).data.suggestions}async function at(){return(await P.post("/api/category-rules/seed-defaults")).data}const st={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},rt=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function nt(){const{t}=M("common"),n=z(),[a,i]=d.useState(null),[u,b]=d.useState(!1),[s,m]=d.useState(!1),[g,v]=d.useState(null),[p,N]=d.useState(""),[l,c]=d.useState("Other"),[r,x]=d.useState("contains"),{data:y,isLoading:C}=I({queryKey:["category-rules"],queryFn:Ge}),{data:j,isLoading:q}=I({queryKey:["category-rules-suggestions"],queryFn:tt,enabled:s}),w=E({mutationFn:Ze,onSuccess:()=>{n.invalidateQueries({queryKey:["category-rules"]}),i(null)}}),_=E({mutationFn:Xe,onSuccess:()=>{n.invalidateQueries({queryKey:["category-rules"]}),N(""),c("Other"),x("contains"),b(!1)}}),R=E({mutationFn:at,onSuccess:()=>{n.invalidateQueries({queryKey:["category-rules"]})}}),k=E({mutationFn:h=>et(h),onSuccess:(h,Q)=>{Q?v({count:h.affected_count,applied:!1}):(n.invalidateQueries({queryKey:["transactions"]}),n.invalidateQueries({queryKey:["analytics"]}),v({count:h.affected_count,applied:!0}))}}),F=h=>{confirm(t("confirmDelete"))&&(i(h),w.mutate(h))},W=()=>{p.trim()&&_.mutate({keyword:p.trim(),category:l,match_type:r,priority:10})},O=h=>{_.mutate({keyword:h.keyword,category:h.suggested_category,match_type:"contains",priority:10})};return C?e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("categoryRules.title")})]}),e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{size:"md"})})]}):e.jsxs(G,{title:t("categoryRules.title"),badge:(y==null?void 0:y.length)||0,children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!y||y.length===0)&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>R.mutate(),disabled:R.isPending,children:[e.jsx(Ye,{className:"w-4 h-4 mr-1"}),R.isPending?t("loading"):t("categoryRules.seedDefaults")]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>b(!u),children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),t("categoryRules.addRule")]})]}),u&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:t("categoryRules.keyword"),value:p,onChange:h=>N(h.target.value),className:f("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),e.jsx("select",{value:l,onChange:h=>c(h.target.value),className:f("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:rt.map(h=>e.jsx("option",{value:h,children:h},h))}),e.jsxs("select",{value:r,onChange:h=>x(h.target.value),className:f("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[e.jsx("option",{value:"contains",children:t("categoryRules.contains")}),e.jsx("option",{value:"starts_with",children:t("categoryRules.startsWith")}),e.jsx("option",{value:"exact",children:t("categoryRules.exact")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>b(!1),children:t("cancel")}),e.jsx(S,{size:"sm",onClick:W,disabled:!p.trim()||_.isPending,children:_.isPending?t("saving"):t("save")})]})]}),y&&y.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-6",children:y.map(h=>e.jsxs("div",{className:f("flex items-center justify-between p-3 rounded-lg border",h.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:h.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:h.category}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",t(st[h.match_type]),")"]})]}),e.jsx("button",{onClick:()=>F(h.id),disabled:a===h.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:a===h.id?e.jsx(K,{size:"sm"}):e.jsx(se,{className:"w-4 h-4"})})]},h.id))}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("categoryRules.applyDescription")}),g&&e.jsx("p",{className:f("text-sm mt-1",g.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:g.applied?t("categoryRules.appliedCount",{count:g.count}):t("categoryRules.previewCount",{count:g.count})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>k.mutate(!0),disabled:k.isPending,children:k.isPending?t("loading"):t("categoryRules.preview")}),e.jsxs(S,{size:"sm",onClick:()=>k.mutate(!1),disabled:k.isPending||(g==null?void 0:g.count)===0,children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),t("categoryRules.applyNow")]})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("categoryRules.noRules")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("categoryRules.noRulesDescription")})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[e.jsx("button",{onClick:()=>m(!s),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:t(s?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),s&&e.jsx("div",{className:"mt-4 space-y-2",children:q?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(K,{size:"sm"})}):j&&j.length>0?j.map((h,Q)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:h.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:h.suggested_category}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",h.count,"x)"]})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>O(h),disabled:_.isPending,children:e.jsx(re,{className:"w-4 h-4"})})]},Q)):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:t("categoryRules.noSuggestions")})})]})]})}const it=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function lt({isOpen:t,onClose:n,defaultType:a="expense",onCreated:i}){const{t:u}=M("common"),b=Ae(),[s,m]=d.useState(""),[g,v]=d.useState("ðŸ“"),[p,N]=d.useState(a),[l,c]=d.useState(""),r=async C=>{var q,w;C.preventDefault(),c("");const j=s.trim();if(!j){c(u("category.errors.nameRequired","Name is required"));return}try{const R=`custom_${(await b.mutateAsync({name:j,icon:g,type:p})).id}`;i==null||i(R),x()}catch(_){c(((w=(q=_.response)==null?void 0:q.data)==null?void 0:w.detail)||u("category.errors.createFailed","Failed to create category"))}},x=()=>{m(""),v("ðŸ“"),N(a),c(""),n()};if(!t)return null;const y=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:x}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:u("category.createTitle","Create Category")}),e.jsx("button",{onClick:x,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ne,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("category.name","Category Name")}),e.jsx("input",{type:"text",value:s,onChange:C=>m(C.target.value),placeholder:u("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:it.map(C=>e.jsx("button",{type:"button",onClick:()=>v(C),className:f("w-8 h-8 text-lg rounded flex items-center justify-center",g===C?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:C},C))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("category.type","Type")}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>N("expense"),className:f("flex-1 py-2 rounded-md text-sm font-medium transition-colors",p==="expense"?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:u("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>N("income"),className:f("flex-1 py-2 rounded-md text-sm font-medium transition-colors",p==="income"?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:u("transaction.income","Income")})]})]}),l&&e.jsx("p",{className:"text-sm text-red-500",children:l}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:u("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:b.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:b.isPending?"...":u("create","Create")})]})]})]})]});return typeof document>"u"?null:B.createPortal(y,document.body)}const ct=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function ot({isOpen:t,onClose:n,category:a}){const{t:i}=M("common"),u=z(),[b,s]=d.useState(""),[m,g]=d.useState("ðŸ“"),[v,p]=d.useState(""),[N,l]=d.useState(null);d.useEffect(()=>{a&&(s(a.name),g(a.icon),p(""),l(null))},[a]);const c=E({mutationFn:j=>Ke(a.id,j),onSuccess:j=>{l(j.affected_transactions),u.invalidateQueries({queryKey:["categories"]}),u.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{x()},1500)},onError:j=>{var w,_;p(((_=(w=j.response)==null?void 0:w.data)==null?void 0:_.detail)||i("category.errors.updateFailed","Failed to update category"))}}),r=async j=>{j.preventDefault(),p("");const q=b.trim();if(!q){p(i("category.errors.nameRequired","Name is required"));return}const w={};if(q!==(a==null?void 0:a.name)&&(w.name=q),m!==(a==null?void 0:a.icon)&&(w.icon=m),Object.keys(w).length===0){x();return}c.mutate(w)},x=()=>{s(""),g("ðŸ“"),p(""),l(null),n()};if(!t||!a)return null;const y=b.trim()!==a.name,C=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:x}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i("category.editTitle","Edit Category")}),e.jsx("button",{onClick:x,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ne,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),N!==null&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[i("category.updateSuccess","Category updated!"),N>0&&e.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:i("category.transactionsUpdated","{{count}} transactions updated",{count:N})})]})}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.name","Category Name")}),e.jsx("input",{type:"text",value:b,onChange:j=>s(j.target.value),placeholder:i("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),y&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[e.jsx(Y,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:i("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:ct.map(j=>e.jsx("button",{type:"button",onClick:()=>g(j),className:f("w-8 h-8 text-lg rounded flex items-center justify-center",m===j?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:j},j))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.type","Type")}),e.jsx("div",{className:f("h-10 px-3 flex items-center rounded-lg text-sm font-medium",a.type==="expense"?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:a.type==="expense"?i("transaction.expense","Expense"):i("transaction.income","Income")})]}),v&&e.jsx("p",{className:"text-sm text-red-500",children:v}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:i("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:c.isPending||N!==null,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:c.isPending?"...":i("save","Save")})]})]})]})]});return typeof document>"u"?null:B.createPortal(C,document.body)}function dt(){const{t}=M("common"),{data:n=[],isLoading:a}=Le(),i=Ie(),[u,b]=d.useState(!1),[s,m]=d.useState(null),[g,v]=d.useState(null),p=async c=>{try{await i.mutateAsync(c),v(null)}catch(r){console.error("Failed to delete category:",r)}},N=n.filter(c=>c.type==="expense"),l=n.filter(c=>c.type==="income");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{title:t("settings.categoryManagement"),badge:n.length,children:[a?e.jsx("div",{className:"py-4 text-center text-gray-400",children:t("loading")}):n.length===0?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noCategories")}):e.jsxs("div",{className:"space-y-4",children:[N.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.expense","Expense")}),e.jsx("div",{className:"space-y-2",children:N.map(c=>e.jsx(Z,{category:c,onEdit:()=>m(c),onDelete:()=>v(c.id),isDeleting:i.isPending&&g===c.id,showDeleteConfirm:g===c.id,onConfirmDelete:()=>p(c.id),onCancelDelete:()=>v(null)},c.id))})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.income","Income")}),e.jsx("div",{className:"space-y-2",children:l.map(c=>e.jsx(Z,{category:c,onEdit:()=>m(c),onDelete:()=>v(c.id),isDeleting:i.isPending&&g===c.id,showDeleteConfirm:g===c.id,onConfirmDelete:()=>p(c.id),onCancelDelete:()=>v(null)},c.id))})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",onClick:()=>b(!0),children:t("settings.addCategory")})})]}),e.jsx(lt,{isOpen:u,onClose:()=>b(!1)}),e.jsx(ot,{isOpen:!!s,onClose:()=>m(null),category:s})]})}function Z({category:t,onEdit:n,onDelete:a,isDeleting:i,showDeleteConfirm:u,onConfirmDelete:b,onCancelDelete:s}){const{t:m}=M("common");return u?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:m("category.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:m("cancel")}),e.jsx("button",{onClick:b,disabled:i,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:i?"...":m("delete")})]})]}):e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:m("edit"),children:e.jsx(ze,{size:16})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:m("delete"),children:e.jsx(se,{size:16})})]})]})}const ee=["eth","bsc","polygon"];function gt(){const{t}=M("common"),n=z(),[a,i]=d.useState(!1),[u,b]=d.useState(""),[s,m]=d.useState(""),[g,v]=d.useState(["eth","bsc","polygon"]),[p,N]=d.useState(!1),[l,c]=d.useState("polygon"),[r,x]=d.useState(""),[y,C]=d.useState(""),[j,q]=d.useState(""),[w,_]=d.useState(null),{data:R,isLoading:k}=I({queryKey:["crypto-wallets"],queryFn:Te}),{data:F,isLoading:W}=I({queryKey:["reward-contracts"],queryFn:De}),O=E({mutationFn:Se,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),i(!1),de()}}),h=E({mutationFn:Pe,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]})}}),Q=E({mutationFn:qe,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),n.invalidateQueries({queryKey:["dashboard-summary"]}),_(null)},onError:()=>{_(null)}}),U=E({mutationFn:Re,onSuccess:()=>{n.invalidateQueries({queryKey:["reward-contracts"]}),N(!1),ge()}}),oe=E({mutationFn:Ee,onSuccess:()=>{n.invalidateQueries({queryKey:["reward-contracts"]})}}),de=()=>{b(""),m(""),v(["eth","bsc","polygon"])},ge=()=>{c("polygon"),x(""),C(""),q("")},ue=()=>{if(!u||!u.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}O.mutate({wallet_address:u,label:s||void 0,chains:g})},me=o=>{_(o),Q.mutate(o)},xe=()=>{if(!r||!r.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}U.mutate({chain_id:l,contract_address:r,label:y||void 0,token_symbol:j||void 0})},ye=o=>{v(L=>L.includes(o)?L.filter(he=>he!==o):[...L,o])};return k||W?e.jsx(D,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.wallets")}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>i(!a),children:t(a?"cancel":"crypto.addWallet")})]}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(T,{label:t("crypto.walletAddress"),placeholder:"0x...",value:u,onChange:o=>b(o.target.value)}),e.jsx(T,{label:t("crypto.walletLabel"),placeholder:t("crypto.labelPlaceholder"),value:s,onChange:o=>m(o.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map(o=>e.jsxs("button",{type:"button",onClick:()=>ye(o),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${g.includes(o)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[o].icon," ",A[o].name]},o))})]}),e.jsx(S,{onClick:ue,disabled:O.isPending,className:"w-full",children:O.isPending?t("loading"):t("crypto.addWallet")})]}),e.jsx("div",{className:"space-y-3",children:R&&R.length>0?R.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:o.label||t("crypto.unnamedWallet")}),e.jsx("div",{className:"flex gap-1",children:o.chains.map(L=>e.jsx("span",{title:A[L].name,children:A[L].icon},L))})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:o.wallet_address})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>me(o.id),disabled:w===o.id,children:w===o.id?e.jsx(K,{size:"sm"}):t("crypto.sync")}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteWallet"))&&h.mutate(o.id)},className:"text-red-600 hover:text-red-700 text-sm",children:t("delete")})]})]},o.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noWallets")})})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.rewardContracts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("crypto.rewardContractsDescription")})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>N(!p),children:t(p?"cancel":"crypto.addContract")})]}),p&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chain")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map(o=>e.jsxs("button",{type:"button",onClick:()=>c(o),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${l===o?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[o].icon," ",A[o].name]},o))})]}),e.jsx(T,{label:t("crypto.contractAddress"),placeholder:"0x...",value:r,onChange:o=>x(o.target.value)}),e.jsx(T,{label:t("crypto.contractLabel"),placeholder:t("crypto.contractLabelPlaceholder"),value:y,onChange:o=>C(o.target.value)}),e.jsx(T,{label:t("crypto.tokenSymbol"),placeholder:"STEER",value:j,onChange:o=>q(o.target.value)}),e.jsx(S,{onClick:xe,disabled:U.isPending,className:"w-full",children:U.isPending?t("loading"):t("crypto.addContract")})]}),e.jsx("div",{className:"space-y-3",children:F&&F.length>0?F.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{title:A[o.chain_id].name,children:A[o.chain_id].icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:o.label||t("crypto.unnamedContract")}),o.token_symbol&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:o.token_symbol})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:o.contract_address})]}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteContract"))&&oe.mutate(o.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:t("delete")})]},o.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noContracts")})})]})]})}const ut=({checked:t,defaultChecked:n=!1,onChange:a,disabled:i=!1,className:u})=>{const[b,s]=be.useState(n),m=t!==void 0,g=m?t:b,v=()=>{if(i)return;const p=!g;m||s(p),a==null||a(p)};return e.jsx("button",{type:"button",role:"switch","aria-checked":g,disabled:i,onClick:v,className:X("relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",g?"bg-blue-600":"bg-gray-200 dark:bg-gray-700",i&&"opacity-50 cursor-not-allowed",u),children:e.jsx("span",{className:X("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-sm",g?"translate-x-6":"translate-x-1")})})};function mt(){const{t}=M("common"),n=z(),{data:a,isLoading:i,error:u}=I({queryKey:["anomalyConfig"],queryFn:je}),b=E({mutationFn:l=>fe(l),onSuccess:()=>{n.invalidateQueries({queryKey:["anomalyConfig"]})}}),[s,m]=d.useState({sensitivity:"medium",large_transaction_threshold:1e4,unusual_spending_percent:50,recurring_change_percent:20,duplicate_charge_hours:24,enabled_types:["large_transaction","category_shift","duplicate"]});d.useEffect(()=>{a&&m({sensitivity:a.sensitivity,large_transaction_threshold:a.large_transaction_threshold,unusual_spending_percent:a.unusual_spending_percent,recurring_change_percent:a.recurring_change_percent,duplicate_charge_hours:a.duplicate_charge_hours,enabled_types:a.enabled_types||["large_transaction","category_shift","duplicate"]})},[a]);const g=()=>{b.mutate(s)},v=l=>{m(c=>{const r=c.enabled_types||[],x=r.includes(l)?r.filter(y=>y!==l):[...r,l];return{...c,enabled_types:x}})},p=[{key:"large_transaction",label:t("anomaly.type.large_transaction")},{key:"category_shift",label:t("anomaly.type.category_shift")},{key:"duplicate",label:t("anomaly.type.duplicate")},{key:"recurring_change",label:t("anomaly.type.recurring_change")},{key:"ml_detected",label:t("anomaly.type.ml_detected")}],N=[{value:"low",label:t("anomaly.config.sensitivityOptions.low")},{value:"medium",label:t("anomaly.config.sensitivityOptions.medium")},{value:"high",label:t("anomaly.config.sensitivityOptions.high")}];return i?e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"})]})}):u?e.jsxs(D,{className:"p-6 text-center text-gray-500",children:[e.jsx(Y,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:t("common.noData")})]}):e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(H,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:t("anomaly.config.title")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{label:t("anomaly.config.sensitivity"),value:s.sensitivity,onChange:l=>m({...s,sensitivity:l.target.value}),options:N}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(T,{type:"number",label:t("anomaly.config.largeTransactionThreshold"),value:s.large_transaction_threshold,onChange:l=>m({...s,large_transaction_threshold:parseInt(l.target.value)||0})}),e.jsx(T,{type:"number",label:t("anomaly.config.unusualSpendingPercent"),value:s.unusual_spending_percent,onChange:l=>m({...s,unusual_spending_percent:parseInt(l.target.value)||0})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(T,{type:"number",label:t("anomaly.config.recurringChangePercent"),value:s.recurring_change_percent,onChange:l=>m({...s,recurring_change_percent:parseInt(l.target.value)||0})}),e.jsx(T,{type:"number",label:t("anomaly.config.duplicateChargeHours"),value:s.duplicate_charge_hours,onChange:l=>m({...s,duplicate_charge_hours:parseInt(l.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:t("anomaly.config.enabledTypes")}),e.jsx("div",{className:"space-y-3",children:p.map(l=>{const c=(s.enabled_types||[]).includes(l.key);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l.label}),e.jsx(ut,{checked:c,onChange:()=>v(l.key)})]},l.key)})})]}),e.jsx(S,{onClick:g,disabled:b.isPending,className:"w-full",children:b.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"â³"}),t("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),t("anomaly.config.save")]})}),b.isSuccess&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 text-center",children:t("anomaly.config.saved")})]})]})}const V={async getNotifications(t){const n=new URLSearchParams;return t!=null&&t.unreadOnly&&n.append("unread_only","true"),t!=null&&t.limit&&n.append("limit",String(t.limit)),t!=null&&t.offset&&n.append("offset",String(t.offset)),t!=null&&t.type&&n.append("type",t.type),(await P.get(`/api/notifications?${n}`)).data},async getUnreadCount(){return(await P.get("/api/notifications/unread/count")).data},async markAsRead(t){return(await P.put(`/api/notifications/${t}/read`,{})).data},async markAllAsRead(){return(await P.put("/api/notifications/read-all",{})).data},async deleteNotification(t){return(await P.delete(`/api/notifications/${t}`)).data},async cleanupOldNotifications(t=30){return(await P.post("/api/notifications/cleanup",{days_old:t})).data},async getPreferences(){return(await P.get("/api/notifications/preferences")).data},async updatePreference(t,n,a){return(await P.put(`/api/notifications/preferences/${t}`,{enabled:n,settings:a})).data},async subscribePush(t){return(await P.post("/api/notifications/push/subscribe",t)).data},async unsubscribePush(){return(await P.post("/api/notifications/push/unsubscribe",{})).data}};function xt(){return typeof window>"u"?!1:"serviceWorker"in navigator&&"PushManager"in window}async function yt(){return typeof window>"u"?"denied":await Notification.requestPermission()}function ht(){return""}function pt(){const{t}=M("common"),n=z(),[a,i]=d.useState(!1),[u,b]=d.useState(!1),{data:s,isLoading:m}=I({queryKey:["notification-preferences"],queryFn:V.getPreferences}),g=E({mutationFn:({channel:r,enabled:x,settings:y})=>V.updatePreference(r,x,y),onSuccess:()=>{n.invalidateQueries({queryKey:["notification-preferences"]})}}),v=(s==null?void 0:s.preferences)||[];d.useEffect(()=>{(async()=>{if(xt()){const x=await Notification.permission;i(x==="granted")}})()},[]);const p=(r,x)=>{g.mutate({channel:r,enabled:!x})},N=async()=>{b(!0);try{if(await yt()==="granted"&&(i(!0),"serviceWorker"in navigator&&"PushManager"in window)){const y=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ht()});await V.subscribePush(y.toJSON())}}catch(r){console.error("Failed to enable push notifications:",r)}finally{b(!1)}},l=r=>v.find(x=>x.channel===r),c=[{id:"push",icon:Je,label:t("notifications.channels.push"),description:t("notifications.channels.pushDescription"),getEnabled:()=>a,onToggle:N},{id:"email",icon:Oe,label:t("notifications.channels.email"),description:t("notifications.channels.emailDescription"),getEnabled:()=>{var r;return((r=l("email"))==null?void 0:r.enabled)??!0},onToggle:()=>{var r;return p("email",((r=l("email"))==null?void 0:r.enabled)??!0)}},{id:"in_app",icon:ie,label:t("notifications.channels.inApp"),description:t("notifications.channels.inAppDescription"),getEnabled:()=>{var r;return((r=l("in_app"))==null?void 0:r.enabled)??!0},onToggle:()=>{var r;return p("in_app",((r=l("in_app"))==null?void 0:r.enabled)??!0)}}];return m?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{size:"lg"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(H,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t("notifications.channels.title")})]}),e.jsx("div",{className:"space-y-4",children:c.map(r=>{const x=r.icon,y=r.getEnabled();return e.jsxs("div",{className:f("flex items-center justify-between p-3 rounded-lg border transition-colors",y?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",y?"bg-green-100 dark:bg-green-900/50":"bg-gray-200 dark:bg-gray-600"),children:e.jsx(x,{className:f("w-5 h-5",y?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r.label}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.description})]})]}),e.jsx("button",{onClick:r.onToggle,disabled:r.id==="push"&&u,className:f("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",y?"bg-green-500":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:f("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",y?"translate-x-6":"translate-x-1")})})]},r.id)})})]}),e.jsxs(D,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.types.title")}),e.jsx("div",{className:"space-y-3",children:[{key:"budget_alert",label:t("notifications.types.budget")},{key:"bill_reminder",label:t("notifications.types.bills")},{key:"anomaly_detected",label:t("notifications.types.anomalies")},{key:"goal_milestone",label:t("notifications.types.goals")},{key:"savings_tip",label:t("notifications.types.savings")},{key:"burn_rate_warning",label:t("notifications.types.burnRate")}].map(r=>{const x=l(r.key),y=(x==null?void 0:x.enabled)??!0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r.label}),e.jsx("button",{onClick:()=>p(r.key,!y),className:f("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",y?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:f("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",y?"translate-x-6":"translate-x-1")})})]},r.key)})})]}),e.jsxs(D,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.quietHours.title")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("notifications.quietHours.description")})}),e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),t("notifications.quietHours.configure")]})]})]})]})}const bt=[{id:"general",labelKey:"settings.sections.general",icon:H},{id:"budget",labelKey:"settings.sections.budget",icon:le},{id:"categories",labelKey:"settings.sections.categories",icon:J},{id:"sources",labelKey:"settings.sections.sources",icon:Ne},{id:"recurring",labelKey:"settings.sections.recurring",icon:He},{id:"notifications",labelKey:"settings.sections.notifications",icon:ie},{id:"crypto",labelKey:"settings.sections.crypto",icon:we},{id:"anomaly",labelKey:"anomaly.title",icon:Y}];function ft(){var _,R;const{t}=M("common"),n=z(),[a,i]=d.useState("general"),[u,b]=d.useState(!1),{data:s,isLoading:m}=I({queryKey:["settings"],queryFn:Ce}),[g,v]=d.useState("JPY"),[p,N]=d.useState(25),[l,c]=d.useState(!1),[r,x]=d.useState(!0),[y,C]=d.useState(1e6);d.useEffect(()=>{s&&(v(s.currency),N(s.base_date),c(s.budget_carry_over),x(s.budget_email_alerts),C(s.large_transaction_threshold))},[s]),d.useEffect(()=>{if(s){const k=g!==s.currency||p!==s.base_date||l!==s.budget_carry_over||r!==s.budget_email_alerts||y!==s.large_transaction_threshold;b(k)}},[g,p,l,r,y,s]);const j=E({mutationFn:ke,onSuccess:()=>{n.invalidateQueries({queryKey:["settings"]}),n.invalidateQueries({queryKey:["dashboard-summary"]}),n.invalidateQueries({queryKey:["transactions"]}),n.invalidateQueries({queryKey:["analytics"]}),b(!1)},onError:k=>{console.error("Failed to save settings:",k)}}),q=()=>{j.mutate({currency:g,base_date:p,budget_carry_over:l,budget_email_alerts:r,large_transaction_threshold:y})};if(m)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(K,{size:"lg"})});const w={JPY:t("settings.currencyJPY"),USD:t("settings.currencyUSD"),VND:t("settings.currencyVND")};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-primary-600"}),t("settings.title")]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:t("settings.subtitle")})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto py-2 scrollbar-hide -mb-2",children:bt.map(k=>{const F=k.icon,W=a===k.id;return e.jsxs("button",{onClick:()=>i(k.id),className:f("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",W?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(F,{className:"w-3.5 h-3.5"}),t(k.labelKey)]},k.id)})})})})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx("div",{className:f("space-y-4",a!=="general"&&"hidden"),children:e.jsx(te,{icon:H,title:t("settings.general"),description:"Currency and basic preferences",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{label:t("settings.currency"),value:g,onChange:k=>v(k.target.value),options:[{value:"JPY",label:w.JPY},{value:"USD",label:w.USD},{value:"VND",label:w.VND}]}),e.jsx(T,{type:"number",label:t("settings.payday"),value:p,onChange:k=>N(parseInt(k.target.value,10)),min:1,max:31}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 -mt-2",children:t("settings.paydayDescription")})]})})}),e.jsx("div",{className:f("space-y-4",a!=="budget"&&"hidden"),children:e.jsx(te,{icon:le,title:t("settings.budgetSettings"),description:"Budget behavior and alerts",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{label:t("settings.budgetCarryOver"),description:t("settings.budgetCarryOverDescription"),checked:l,onChange:c}),e.jsx(ae,{label:t("settings.budgetEmailAlerts"),description:t("settings.budgetEmailAlertsDescription"),checked:r,onChange:x}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block mb-2",children:t("settings.largeTransactionThreshold")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t("settings.largeTransactionThresholdDescription")}),e.jsx(T,{type:"number",value:y,onChange:k=>C(parseInt(k.target.value,10)||0),min:0,step:1e5}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:t("settings.largeTransactionThresholdHint")})]})]})})}),e.jsx("div",{className:f("space-y-4",a!=="categories"&&"hidden"),children:e.jsx(dt,{})}),e.jsx("div",{className:f("space-y-4",a!=="sources"&&"hidden"),children:e.jsxs(G,{title:t("settings.paymentSourceManagement"),badge:((_=s==null?void 0:s.sources)==null?void 0:_.length)||0,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:((R=s==null?void 0:s.sources)==null?void 0:R.map((k,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:k}),e.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:t("settings.delete")})]},F)))||e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noSources")})}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",children:t("settings.addSource")})})]})}),e.jsx("div",{className:f("space-y-4",a!=="recurring"&&"hidden"),children:e.jsx(Me,{})}),e.jsx("div",{className:f("space-y-4",a!=="notifications"&&"hidden"),children:e.jsx(pt,{})}),e.jsx("div",{className:f("space-y-4",a!=="crypto"&&"hidden"),children:e.jsx(gt,{})}),e.jsx("div",{className:f("space-y-4",a!=="anomaly"&&"hidden"),children:e.jsx(mt,{})}),e.jsx(nt,{})]}),u&&typeof document<"u"&&B.createPortal(e.jsx("div",{className:"fixed bottom-20 left-0 right-0 p-4 bg-white/90 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-gray-700 z-40",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(S,{onClick:q,disabled:j.isPending,className:"w-full",size:"lg",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:"sm",className:"mr-2"}),t("saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),t("settings.saveSettings")]})})})}),document.body)]})}function te({icon:t,title:n,description:a,children:i,className:u}){return e.jsxs(D,{className:f("",u),children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:e.jsx(t,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n}),a&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]})]}),i]})}function ae({label:t,description:n,checked:a,onChange:i}){return e.jsxs("div",{className:"flex items-start justify-between py-1",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block",children:t}),n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:n})]}),e.jsx("button",{onClick:()=>i(!a),className:f("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",a?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:f("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",a?"translate-x-6":"translate-x-1")})})]})}const qt=_e("/settings")({component:ft});export{qt as Route};
