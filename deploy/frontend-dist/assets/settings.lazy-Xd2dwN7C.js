import{l as W,H as P,u as F,J as H,r as d,D as I,a4 as M,j as e,C as D,F as z,B as S,P as je,m as x,T as ie,g as G,X as ce,y as Z,I as q,ai as ve,aj as U,ak as ke,al as oe,R as Ne,am as de,an as Ce,ao as we,ap as Se,aq as _e,ar as X,as as ee,t as se,at as Pe,W as Ee,au as Te,av as Me,k as Fe}from"./index-DMuUCLme.js";import{C as ae,c as qe,d as De,s as Re,a as Ae,b as Ke,e as L,f as Le,g as ze}from"./crypto-ByFGobhM.js";import{S as $}from"./Select-ByaTSnEt.js";import{P as Ie,R as Oe}from"./RecurringTransactionsList-DqQ5kC3o.js";import{T as Y}from"./tag-BH3Gmnq-.js";import{u as We,a as He,b as Qe,c as $e}from"./useCategories-DhencE7b.js";import{T as te}from"./triangle-alert-Dv6aHvCw.js";import{P as Ue}from"./pencil-DP_9QTAZ.js";import{S as Be}from"./Switch-C0exKRSw.js";import{M as Je}from"./mail-CQ7MPji2.js";import{C as Ve}from"./crown-C1YJ73Fc.js";import{Z as Ye}from"./zap-BjFeZuLC.js";import{M as Ge}from"./map-pin-D9FLTioQ.js";import{u as Ze,g as Xe}from"./benchmark-service-BIhdPtbW.js";import"./chevron-down-Dux-iNvI.js";import"./recurring-service-DNw-Jmxc.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],aa=W("monitor",ea);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],ue=W("palette",ta);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],ra=W("repeat",sa);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],la=W("save",na);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ca=W("smartphone",ia);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],da=W("wand-sparkles",oa);async function ua(){return(await P.get("/api/category-rules/")).data.rules}async function ga(a){return(await P.post("/api/category-rules/",a)).data}async function ma(a){await P.delete(`/api/category-rules/${a}`)}async function xa(a=!0){return(await P.post("/api/category-rules/apply",{dry_run:a})).data}async function ya(){return(await P.get("/api/category-rules/suggest")).data.suggestions}async function pa(){return(await P.post("/api/category-rules/seed-defaults")).data}const ha={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},ba=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function fa(){const{t:a}=F("common"),r=H(),[t,n]=d.useState(null),[g,y]=d.useState(!1),[s,m]=d.useState(!1),[p,v]=d.useState(null),[c,j]=d.useState(""),[l,o]=d.useState("Other"),[i,b]=d.useState("contains"),{data:f,isLoading:w}=I({queryKey:["category-rules"],queryFn:ua}),{data:k,isLoading:E}=I({queryKey:["category-rules-suggestions"],queryFn:ya,enabled:s}),C=M({mutationFn:ma,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]}),n(null)}}),_=M({mutationFn:ga,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]}),j(""),o("Other"),b("contains"),y(!1)}}),T=M({mutationFn:pa,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]})}}),R=M({mutationFn:h=>xa(h),onSuccess:(h,Q)=>{Q?v({count:h.affected_count,applied:!1}):(r.invalidateQueries({queryKey:["transactions"]}),r.invalidateQueries({queryKey:["analytics"]}),v({count:h.affected_count,applied:!0}))}}),K=h=>{confirm(a("confirmDelete"))&&(n(h),C.mutate(h))},N=()=>{c.trim()&&_.mutate({keyword:c.trim(),category:l,match_type:i,priority:10})},A=h=>{_.mutate({keyword:h.keyword,category:h.suggested_category,match_type:"contains",priority:10})};return w?e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("categoryRules.title")})]}),e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(z,{size:"md"})})]}):e.jsxs(ae,{title:a("categoryRules.title"),badge:(f==null?void 0:f.length)||0,children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!f||f.length===0)&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>T.mutate(),disabled:T.isPending,children:[e.jsx(da,{className:"w-4 h-4 mr-1"}),T.isPending?a("loading"):a("categoryRules.seedDefaults")]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>y(!g),children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),a("categoryRules.addRule")]})]}),g&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:a("categoryRules.keyword"),value:c,onChange:h=>j(h.target.value),className:x("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),e.jsx("select",{value:l,onChange:h=>o(h.target.value),className:x("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:ba.map(h=>e.jsx("option",{value:h,children:h},h))}),e.jsxs("select",{value:i,onChange:h=>b(h.target.value),className:x("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[e.jsx("option",{value:"contains",children:a("categoryRules.contains")}),e.jsx("option",{value:"starts_with",children:a("categoryRules.startsWith")}),e.jsx("option",{value:"exact",children:a("categoryRules.exact")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>y(!1),children:a("cancel")}),e.jsx(S,{size:"sm",onClick:N,disabled:!c.trim()||_.isPending,children:_.isPending?a("saving"):a("save")})]})]}),f&&f.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-6",children:f.map(h=>e.jsxs("div",{className:x("flex items-center justify-between p-3 rounded-lg border",h.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:h.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:h.category}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",a(ha[h.match_type]),")"]})]}),e.jsx("button",{onClick:()=>K(h.id),disabled:t===h.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:t===h.id?e.jsx(z,{size:"sm"}):e.jsx(ie,{className:"w-4 h-4"})})]},h.id))}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("categoryRules.applyDescription")}),p&&e.jsx("p",{className:x("text-sm mt-1",p.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:p.applied?a("categoryRules.appliedCount",{count:p.count}):a("categoryRules.previewCount",{count:p.count})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>R.mutate(!0),disabled:R.isPending,children:R.isPending?a("loading"):a("categoryRules.preview")}),e.jsxs(S,{size:"sm",onClick:()=>R.mutate(!1),disabled:R.isPending||(p==null?void 0:p.count)===0,children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),a("categoryRules.applyNow")]})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a("categoryRules.noRules")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:a("categoryRules.noRulesDescription")})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[e.jsx("button",{onClick:()=>m(!s),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:a(s?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),s&&e.jsx("div",{className:"mt-4 space-y-2",children:E?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(z,{size:"sm"})}):k&&k.length>0?k.map((h,Q)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:h.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:h.suggested_category}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",h.count,"x)"]})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>A(h),disabled:_.isPending,children:e.jsx(G,{className:"w-4 h-4"})})]},Q)):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:a("categoryRules.noSuggestions")})})]})]})}const ja=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function va({isOpen:a,onClose:r,defaultType:t="expense",onCreated:n}){const{t:g}=F("common"),y=We(),[s,m]=d.useState(""),[p,v]=d.useState("ðŸ“"),[c,j]=d.useState(t),[l,o]=d.useState(""),i=async w=>{var E,C;w.preventDefault(),o("");const k=s.trim();if(!k){o(g("category.errors.nameRequired","Name is required"));return}try{const T=`custom_${(await y.mutateAsync({name:k,icon:p,type:c})).id}`;n==null||n(T),b()}catch(_){o(((C=(E=_.response)==null?void 0:E.data)==null?void 0:C.detail)||g("category.errors.createFailed","Failed to create category"))}},b=()=>{m(""),v("ðŸ“"),j(t),o(""),r()};if(!a)return null;const f=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:b}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:g("category.createTitle","Create Category")}),e.jsx("button",{onClick:b,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ce,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:g("category.name","Category Name")}),e.jsx("input",{type:"text",value:s,onChange:w=>m(w.target.value),placeholder:g("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:g("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:ja.map(w=>e.jsx("button",{type:"button",onClick:()=>v(w),className:x("w-8 h-8 text-lg rounded flex items-center justify-center",p===w?"bg-primary-100 dark:bg-primary-900 border-2 border-primary-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:g("category.type","Type")}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>j("expense"),className:x("flex-1 py-2 rounded-md text-sm font-medium transition-colors",c==="expense"?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:g("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>j("income"),className:x("flex-1 py-2 rounded-md text-sm font-medium transition-colors",c==="income"?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:g("transaction.income","Income")})]})]}),l&&e.jsx("p",{className:"text-sm text-red-500",children:l}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:b,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:g("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:y.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:y.isPending?"...":g("create","Create")})]})]})]})]});return typeof document>"u"?null:Z.createPortal(f,document.body)}const ka=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function Na({isOpen:a,onClose:r,category:t}){const{t:n}=F("common"),g=H(),[y,s]=d.useState(""),[m,p]=d.useState("ðŸ“"),[v,c]=d.useState(""),[j,l]=d.useState(null);d.useEffect(()=>{t&&(s(t.name),p(t.icon),c(""),l(null))},[t]);const o=M({mutationFn:k=>He(t.id,k),onSuccess:k=>{l(k.affected_transactions),g.invalidateQueries({queryKey:["categories"]}),g.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{b()},1500)},onError:k=>{var C,_;c(((_=(C=k.response)==null?void 0:C.data)==null?void 0:_.detail)||n("category.errors.updateFailed","Failed to update category"))}}),i=async k=>{k.preventDefault(),c("");const E=y.trim();if(!E){c(n("category.errors.nameRequired","Name is required"));return}const C={};if(E!==(t==null?void 0:t.name)&&(C.name=E),m!==(t==null?void 0:t.icon)&&(C.icon=m),Object.keys(C).length===0){b();return}o.mutate(C)},b=()=>{s(""),p("ðŸ“"),c(""),l(null),r()};if(!a||!t)return null;const f=y.trim()!==t.name,w=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:b}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:n("category.editTitle","Edit Category")}),e.jsx("button",{onClick:b,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ce,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),j!==null&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[n("category.updateSuccess","Category updated!"),j>0&&e.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:n("category.transactionsUpdated","{{count}} transactions updated",{count:j})})]})}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("category.name","Category Name")}),e.jsx("input",{type:"text",value:y,onChange:k=>s(k.target.value),placeholder:n("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),f&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[e.jsx(te,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:n("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:ka.map(k=>e.jsx("button",{type:"button",onClick:()=>p(k),className:x("w-8 h-8 text-lg rounded flex items-center justify-center",m===k?"bg-primary-100 dark:bg-primary-900 border-2 border-primary-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:k},k))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("category.type","Type")}),e.jsx("div",{className:x("h-10 px-3 flex items-center rounded-lg text-sm font-medium",t.type==="expense"?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:t.type==="expense"?n("transaction.expense","Expense"):n("transaction.income","Income")})]}),v&&e.jsx("p",{className:"text-sm text-red-500",children:v}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:b,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:n("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:o.isPending||j!==null,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:o.isPending?"...":n("save","Save")})]})]})]})]});return typeof document>"u"?null:Z.createPortal(w,document.body)}function Ca(){const{t:a}=F("common"),{data:r=[],isLoading:t}=Qe(),n=$e(),[g,y]=d.useState(!1),[s,m]=d.useState(null),[p,v]=d.useState(null),c=async o=>{try{await n.mutateAsync(o),v(null)}catch(i){console.error("Failed to delete category:",i)}},j=r.filter(o=>o.type==="expense"),l=r.filter(o=>o.type==="income");return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{title:a("settings.categoryManagement"),badge:r.length,children:[t?e.jsx("div",{className:"py-4 text-center text-gray-400",children:a("loading")}):r.length===0?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:a("settings.noCategories")}):e.jsxs("div",{className:"space-y-4",children:[j.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:a("transaction.expense","Expense")}),e.jsx("div",{className:"space-y-2",children:j.map(o=>e.jsx(re,{category:o,onEdit:()=>m(o),onDelete:()=>v(o.id),isDeleting:n.isPending&&p===o.id,showDeleteConfirm:p===o.id,onConfirmDelete:()=>c(o.id),onCancelDelete:()=>v(null)},o.id))})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:a("transaction.income","Income")}),e.jsx("div",{className:"space-y-2",children:l.map(o=>e.jsx(re,{category:o,onEdit:()=>m(o),onDelete:()=>v(o.id),isDeleting:n.isPending&&p===o.id,showDeleteConfirm:p===o.id,onConfirmDelete:()=>c(o.id),onCancelDelete:()=>v(null)},o.id))})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",onClick:()=>y(!0),children:a("settings.addCategory")})})]}),e.jsx(va,{isOpen:g,onClose:()=>y(!1)}),e.jsx(Na,{isOpen:!!s,onClose:()=>m(null),category:s})]})}function re({category:a,onEdit:r,onDelete:t,isDeleting:n,showDeleteConfirm:g,onConfirmDelete:y,onCancelDelete:s}){const{t:m}=F("common");return g?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:m("category.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:m("cancel")}),e.jsx("button",{onClick:y,disabled:n,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:n?"...":m("delete")})]})]}):e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:a.icon}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:m("edit"),children:e.jsx(Ue,{size:16})}),e.jsx("button",{onClick:t,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:m("delete"),children:e.jsx(ie,{size:16})})]})]})}const ne=["eth","bsc","polygon"];function wa(){const{t:a}=F("common"),r=H(),[t,n]=d.useState(!1),[g,y]=d.useState(""),[s,m]=d.useState(""),[p,v]=d.useState(["eth","bsc","polygon"]),[c,j]=d.useState(!1),[l,o]=d.useState("polygon"),[i,b]=d.useState(""),[f,w]=d.useState(""),[k,E]=d.useState(""),[C,_]=d.useState(null),{data:T,isLoading:R}=I({queryKey:["crypto-wallets"],queryFn:Le}),{data:K,isLoading:N}=I({queryKey:["reward-contracts"],queryFn:ze}),A=M({mutationFn:qe,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),n(!1),me()}}),h=M({mutationFn:De,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]})}}),Q=M({mutationFn:Re,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),r.invalidateQueries({queryKey:["dashboard-summary"]}),_(null)},onError:()=>{_(null)}}),J=M({mutationFn:Ae,onSuccess:()=>{r.invalidateQueries({queryKey:["reward-contracts"]}),j(!1),xe()}}),ge=M({mutationFn:Ke,onSuccess:()=>{r.invalidateQueries({queryKey:["reward-contracts"]})}}),me=()=>{y(""),m(""),v(["eth","bsc","polygon"])},xe=()=>{o("polygon"),b(""),w(""),E("")},ye=()=>{if(!g||!g.match(/^0x[a-fA-F0-9]{40}$/)){alert(a("crypto.invalidAddress"));return}A.mutate({wallet_address:g,label:s||void 0,chains:p})},pe=u=>{_(u),Q.mutate(u)},he=()=>{if(!i||!i.match(/^0x[a-fA-F0-9]{40}$/)){alert(a("crypto.invalidAddress"));return}J.mutate({chain_id:l,contract_address:i,label:f||void 0,token_symbol:k||void 0})},be=u=>{v(O=>O.includes(u)?O.filter(fe=>fe!==u):[...O,u])};return R||N?e.jsx(D,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("crypto.wallets")}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>n(!t),children:a(t?"cancel":"crypto.addWallet")})]}),t&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(q,{label:a("crypto.walletAddress"),placeholder:"0x...",value:g,onChange:u=>y(u.target.value)}),e.jsx(q,{label:a("crypto.walletLabel"),placeholder:a("crypto.labelPlaceholder"),value:s,onChange:u=>m(u.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("crypto.chains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(u=>e.jsxs("button",{type:"button",onClick:()=>be(u),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${p.includes(u)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[L[u].icon," ",L[u].name]},u))})]}),e.jsx(S,{onClick:ye,disabled:A.isPending,className:"w-full",children:A.isPending?a("loading"):a("crypto.addWallet")})]}),e.jsx("div",{className:"space-y-3",children:T&&T.length>0?T.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:u.label||a("crypto.unnamedWallet")}),e.jsx("div",{className:"flex gap-1",children:u.chains.map(O=>e.jsx("span",{title:L[O].name,children:L[O].icon},O))})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:u.wallet_address})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>pe(u.id),disabled:C===u.id,children:C===u.id?e.jsx(z,{size:"sm"}):a("crypto.sync")}),e.jsx("button",{onClick:()=>{confirm(a("crypto.confirmDeleteWallet"))&&h.mutate(u.id)},className:"text-red-600 hover:text-red-700 text-sm",children:a("delete")})]})]},u.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:a("crypto.noWallets")})})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("crypto.rewardContracts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("crypto.rewardContractsDescription")})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>j(!c),children:a(c?"cancel":"crypto.addContract")})]}),c&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("crypto.chain")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(u=>e.jsxs("button",{type:"button",onClick:()=>o(u),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${l===u?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[L[u].icon," ",L[u].name]},u))})]}),e.jsx(q,{label:a("crypto.contractAddress"),placeholder:"0x...",value:i,onChange:u=>b(u.target.value)}),e.jsx(q,{label:a("crypto.contractLabel"),placeholder:a("crypto.contractLabelPlaceholder"),value:f,onChange:u=>w(u.target.value)}),e.jsx(q,{label:a("crypto.tokenSymbol"),placeholder:"STEER",value:k,onChange:u=>E(u.target.value)}),e.jsx(S,{onClick:he,disabled:J.isPending,className:"w-full",children:J.isPending?a("loading"):a("crypto.addContract")})]}),e.jsx("div",{className:"space-y-3",children:K&&K.length>0?K.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{title:L[u.chain_id].name,children:L[u.chain_id].icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:u.label||a("crypto.unnamedContract")}),u.token_symbol&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:u.token_symbol})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:u.contract_address})]}),e.jsx("button",{onClick:()=>{confirm(a("crypto.confirmDeleteContract"))&&ge.mutate(u.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:a("delete")})]},u.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:a("crypto.noContracts")})})]})]})}function Sa(){const{t:a}=F("common"),r=H(),{data:t,isLoading:n,error:g}=I({queryKey:["anomalyConfig"],queryFn:ke}),y=M({mutationFn:l=>ve(l),onSuccess:()=>{r.invalidateQueries({queryKey:["anomalyConfig"]})}}),[s,m]=d.useState({sensitivity:"medium",large_transaction_threshold:1e4,unusual_spending_percent:50,recurring_change_percent:20,duplicate_charge_hours:24,enabled_types:["large_transaction","category_shift","duplicate"]});d.useEffect(()=>{t&&m({sensitivity:t.sensitivity,large_transaction_threshold:t.large_transaction_threshold,unusual_spending_percent:t.unusual_spending_percent,recurring_change_percent:t.recurring_change_percent,duplicate_charge_hours:t.duplicate_charge_hours,enabled_types:t.enabled_types||["large_transaction","category_shift","duplicate"]})},[t]);const p=()=>{y.mutate(s)},v=l=>{m(o=>{const i=o.enabled_types||[],b=i.includes(l)?i.filter(f=>f!==l):[...i,l];return{...o,enabled_types:b}})},c=[{key:"large_transaction",label:a("anomaly.type.large_transaction")},{key:"category_shift",label:a("anomaly.type.category_shift")},{key:"duplicate",label:a("anomaly.type.duplicate")},{key:"recurring_change",label:a("anomaly.type.recurring_change")},{key:"ml_detected",label:a("anomaly.type.ml_detected")}],j=[{value:"low",label:a("anomaly.config.sensitivityOptions.low")},{value:"medium",label:a("anomaly.config.sensitivityOptions.medium")},{value:"high",label:a("anomaly.config.sensitivityOptions.high")}];return n?e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"})]})}):g?e.jsxs(D,{className:"p-6 text-center text-gray-500",children:[e.jsx(te,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:a("common.noData")})]}):e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(U,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:a("anomaly.config.title")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{label:a("anomaly.config.sensitivity"),value:s.sensitivity,onChange:l=>m({...s,sensitivity:l.target.value}),options:j}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(q,{type:"number",label:a("anomaly.config.largeTransactionThreshold"),value:s.large_transaction_threshold,onChange:l=>m({...s,large_transaction_threshold:parseInt(l.target.value)||0})}),e.jsx(q,{type:"number",label:a("anomaly.config.unusualSpendingPercent"),value:s.unusual_spending_percent,onChange:l=>m({...s,unusual_spending_percent:parseInt(l.target.value)||0})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(q,{type:"number",label:a("anomaly.config.recurringChangePercent"),value:s.recurring_change_percent,onChange:l=>m({...s,recurring_change_percent:parseInt(l.target.value)||0})}),e.jsx(q,{type:"number",label:a("anomaly.config.duplicateChargeHours"),value:s.duplicate_charge_hours,onChange:l=>m({...s,duplicate_charge_hours:parseInt(l.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:a("anomaly.config.enabledTypes")}),e.jsx("div",{className:"space-y-3",children:c.map(l=>{const o=(s.enabled_types||[]).includes(l.key);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l.label}),e.jsx(Be,{checked:o,onChange:()=>v(l.key)})]},l.key)})})]}),e.jsx(S,{onClick:p,disabled:y.isPending,className:"w-full",children:y.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"â³"}),a("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(la,{className:"w-4 h-4"}),a("anomaly.config.save")]})}),y.isSuccess&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 text-center",children:a("anomaly.config.saved")})]})]})}const V={async getNotifications(a){const r=new URLSearchParams;return a!=null&&a.unreadOnly&&r.append("unread_only","true"),a!=null&&a.limit&&r.append("limit",String(a.limit)),a!=null&&a.offset&&r.append("offset",String(a.offset)),a!=null&&a.type&&r.append("type",a.type),(await P.get(`/api/notifications?${r}`)).data},async getUnreadCount(){return(await P.get("/api/notifications/unread/count")).data},async markAsRead(a){return(await P.put(`/api/notifications/${a}/read`,{})).data},async markAllAsRead(){return(await P.put("/api/notifications/read-all",{})).data},async deleteNotification(a){return(await P.delete(`/api/notifications/${a}`)).data},async cleanupOldNotifications(a=30){return(await P.post("/api/notifications/cleanup",{days_old:a})).data},async getPreferences(){return(await P.get("/api/notifications/preferences")).data},async updatePreference(a,r,t){return(await P.put(`/api/notifications/preferences/${a}`,{enabled:r,settings:t})).data},async subscribePush(a){return(await P.post("/api/notifications/push/subscribe",a)).data},async unsubscribePush(){return(await P.post("/api/notifications/push/unsubscribe",{})).data}};function _a(){return typeof window>"u"?!1:"serviceWorker"in navigator&&"PushManager"in window}async function Pa(){return typeof window>"u"?"denied":await Notification.requestPermission()}function Ea(){return""}function Ta(){const{t:a}=F("common"),r=H(),[t,n]=d.useState(!1),[g,y]=d.useState(!1),{data:s,isLoading:m}=I({queryKey:["notification-preferences"],queryFn:V.getPreferences}),p=M({mutationFn:({channel:i,enabled:b,settings:f})=>V.updatePreference(i,b,f),onSuccess:()=>{r.invalidateQueries({queryKey:["notification-preferences"]})}}),v=(s==null?void 0:s.preferences)||[];d.useEffect(()=>{(async()=>{if(_a()){const b=await Notification.permission;n(b==="granted")}})()},[]);const c=(i,b)=>{p.mutate({channel:i,enabled:!b})},j=async()=>{y(!0);try{if(await Pa()==="granted"&&(n(!0),"serviceWorker"in navigator&&"PushManager"in window)){const f=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ea()});await V.subscribePush(f.toJSON())}}catch(i){console.error("Failed to enable push notifications:",i)}finally{y(!1)}},l=i=>v.find(b=>b.channel===i),o=[{id:"push",icon:ca,label:a("notifications.channels.push"),description:a("notifications.channels.pushDescription"),getEnabled:()=>t,onToggle:j},{id:"email",icon:Je,label:a("notifications.channels.email"),description:a("notifications.channels.emailDescription"),getEnabled:()=>{var i;return((i=l("email"))==null?void 0:i.enabled)??!0},onToggle:()=>{var i;return c("email",((i=l("email"))==null?void 0:i.enabled)??!0)}},{id:"in_app",icon:oe,label:a("notifications.channels.inApp"),description:a("notifications.channels.inAppDescription"),getEnabled:()=>{var i;return((i=l("in_app"))==null?void 0:i.enabled)??!0},onToggle:()=>{var i;return c("in_app",((i=l("in_app"))==null?void 0:i.enabled)??!0)}}];return m?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(z,{size:"lg"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:a("notifications.channels.title")})]}),e.jsx("div",{className:"space-y-4",children:o.map(i=>{const b=i.icon,f=i.getEnabled();return e.jsxs("div",{className:x("flex items-center justify-between p-3 rounded-lg border transition-colors",f?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:x("p-2 rounded-lg",f?"bg-green-100 dark:bg-green-900/50":"bg-gray-200 dark:bg-gray-600"),children:e.jsx(b,{className:x("w-5 h-5",f?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:i.label}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i.description})]})]}),e.jsx("button",{onClick:i.onToggle,disabled:i.id==="push"&&g,className:x("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",f?"bg-green-500":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:x("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",f?"translate-x-6":"translate-x-1")})})]},i.id)})})]}),e.jsxs(D,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:a("notifications.types.title")}),e.jsx("div",{className:"space-y-3",children:[{key:"budget_alert",label:a("notifications.types.budget")},{key:"bill_reminder",label:a("notifications.types.bills")},{key:"anomaly_detected",label:a("notifications.types.anomalies")},{key:"goal_milestone",label:a("notifications.types.goals")},{key:"savings_tip",label:a("notifications.types.savings")},{key:"burn_rate_warning",label:a("notifications.types.burnRate")}].map(i=>{const b=l(i.key),f=(b==null?void 0:b.enabled)??!0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:i.label}),e.jsx("button",{onClick:()=>c(i.key,!f),className:x("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",f?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:x("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",f?"translate-x-6":"translate-x-1")})})]},i.key)})})]}),e.jsxs(D,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:a("notifications.quietHours.title")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("notifications.quietHours.description")})}),e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),a("notifications.quietHours.configure")]})]})]})]})}const Ma={default:"appearance.themes.default","catppuccin-latte":"appearance.themes.catppuccinLatte","catppuccin-frappe":"appearance.themes.catppuccinFrappe","catppuccin-macchiato":"appearance.themes.catppuccinMacchiato","catppuccin-mocha":"appearance.themes.catppuccinMocha",dracula:"appearance.themes.dracula","dracula-light":"appearance.themes.draculaLight"},Fa={default:"Default","catppuccin-latte":"Catppuccin Latte","catppuccin-frappe":"Catppuccin Frappe","catppuccin-macchiato":"Catppuccin Macchiato","catppuccin-mocha":"Catppuccin Mocha",dracula:"Dracula","dracula-light":"Dracula Light"};function qa(){const{t:a}=F("common"),{colorTheme:r,setColorTheme:t}=de();return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Ce.map(n=>{const g=r===n.id,{base:y,surface:s,text:m,primary:p}=n.preview;return e.jsxs("button",{onClick:()=>t(n.id),className:x("relative flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all",g?"border-primary-500 ring-2 ring-primary-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsx("div",{className:"w-full aspect-[4/3] rounded-lg overflow-hidden border border-black/10",style:{backgroundColor:y},children:e.jsxs("div",{className:"p-2 h-full flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:p}}),e.jsx("div",{className:"h-1.5 rounded-full flex-1",style:{backgroundColor:m,opacity:.3}})]}),e.jsx("div",{className:"flex-1 rounded",style:{backgroundColor:s},children:e.jsxs("div",{className:"p-1.5 flex flex-col gap-1",children:[e.jsx("div",{className:"h-1 rounded-full w-3/4",style:{backgroundColor:m,opacity:.5}}),e.jsx("div",{className:"h-1 rounded-full w-1/2",style:{backgroundColor:m,opacity:.3}}),e.jsx("div",{className:"h-1.5 rounded-full w-2/5 mt-0.5",style:{backgroundColor:p}})]})})]})}),e.jsx("span",{className:x("text-xs font-medium truncate w-full text-center",g?"text-primary-700 dark:text-primary-300":"text-gray-600 dark:text-gray-400"),children:a(Ma[n.id],Fa[n.id])}),g&&e.jsx("div",{className:"absolute top-1.5 right-1.5 w-5 h-5 rounded-full bg-primary-500 flex items-center justify-center",children:e.jsx(G,{className:"w-3 h-3 text-white"})})]},n.id)})})}function Da(){const{t:a}=F("common"),{theme:r,setTheme:t,accentColor:n,setAccentColor:g,colorTheme:y,tier:s,setTier:m}=de(),p=[{id:"light",icon:we,label:a("appearance.light","Light")},{id:"dark",icon:Se,label:a("appearance.dark","Dark")},{id:"system",icon:aa,label:a("appearance.system","System")}],v=[{id:"pro",icon:Ve,label:a("appearance.pro","Pro"),desc:a("appearance.proDesc","Full access, all items visible")},{id:"lite",icon:Ye,label:a("appearance.lite","Lite"),desc:a("appearance.liteDesc","Simplified view, fewer items per page")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:a("appearance.themeMode","Theme Mode")}),y!=="default"?e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:a("appearance.themeControlled","Controlled by theme")}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map(({id:c,icon:j,label:l})=>e.jsxs("button",{onClick:()=>t(c),className:x("flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all",r===c?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsx(j,{className:x("w-5 h-5",r===c?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400")}),e.jsx("span",{className:x("text-xs font-medium",r===c?"text-primary-700 dark:text-primary-300":"text-gray-600 dark:text-gray-400"),children:l})]},c))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:a("appearance.colorTheme","Color Theme")}),e.jsx(qa,{})]}),y==="default"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:a("appearance.accentColor","Accent Color")}),e.jsx("div",{className:"flex flex-wrap gap-3",children:_e.map(c=>e.jsxs("button",{onClick:()=>g(c.id),className:"group flex flex-col items-center gap-1.5",title:c.label,children:[e.jsx("div",{className:x("w-10 h-10 rounded-full transition-all ring-offset-2 ring-offset-white dark:ring-offset-gray-900",n===c.id?"ring-2 ring-gray-900 dark:ring-white scale-110":"ring-1 ring-gray-200 dark:ring-gray-700 group-hover:scale-105"),style:{backgroundColor:c.preview}}),e.jsx("span",{className:x("text-[10px] font-medium",n===c.id?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-500"),children:c.label})]},c.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:a("appearance.displayMode","Display Mode")}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:v.map(({id:c,icon:j,label:l,desc:o})=>e.jsxs("button",{onClick:()=>m(c),className:x("flex flex-col items-start gap-2 p-4 rounded-xl border-2 transition-all text-left",s===c?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:x("w-4 h-4",s===c?"text-primary-600 dark:text-primary-400":"text-gray-500")}),e.jsx("span",{className:x("text-sm font-semibold",s===c?"text-primary-700 dark:text-primary-300":"text-gray-700 dark:text-gray-300"),children:l})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:o})]},c))})]})]})}const Ra=[{value:"01",label:"åŒ—æµ·é“"},{value:"02",label:"é’æ£®çœŒ"},{value:"03",label:"å²©æ‰‹çœŒ"},{value:"04",label:"å®®åŸŽçœŒ"},{value:"05",label:"ç§‹ç”°çœŒ"},{value:"06",label:"å±±å½¢çœŒ"},{value:"07",label:"ç¦å³¶çœŒ"},{value:"08",label:"èŒ¨åŸŽçœŒ"},{value:"09",label:"æ ƒæœ¨çœŒ"},{value:"10",label:"ç¾¤é¦¬çœŒ"},{value:"11",label:"åŸ¼çŽ‰çœŒ"},{value:"12",label:"åƒè‘‰çœŒ"},{value:"13",label:"æ±äº¬éƒ½"},{value:"14",label:"ç¥žå¥ˆå·çœŒ"},{value:"15",label:"æ–°æ½ŸçœŒ"},{value:"16",label:"å¯Œå±±çœŒ"},{value:"17",label:"çŸ³å·çœŒ"},{value:"18",label:"ç¦äº•çœŒ"},{value:"19",label:"å±±æ¢¨çœŒ"},{value:"20",label:"é•·é‡ŽçœŒ"},{value:"21",label:"å²é˜œçœŒ"},{value:"22",label:"é™å²¡çœŒ"},{value:"23",label:"æ„›çŸ¥çœŒ"},{value:"24",label:"ä¸‰é‡çœŒ"},{value:"25",label:"æ»‹è³€çœŒ"},{value:"26",label:"äº¬éƒ½åºœ"},{value:"27",label:"å¤§é˜ªåºœ"},{value:"28",label:"å…µåº«çœŒ"},{value:"29",label:"å¥ˆè‰¯çœŒ"},{value:"30",label:"å’Œæ­Œå±±çœŒ"},{value:"31",label:"é³¥å–çœŒ"},{value:"32",label:"å³¶æ ¹çœŒ"},{value:"33",label:"å²¡å±±çœŒ"},{value:"34",label:"åºƒå³¶çœŒ"},{value:"35",label:"å±±å£çœŒ"},{value:"36",label:"å¾³å³¶çœŒ"},{value:"37",label:"é¦™å·çœŒ"},{value:"38",label:"æ„›åª›çœŒ"},{value:"39",label:"é«˜çŸ¥çœŒ"},{value:"40",label:"ç¦å²¡çœŒ"},{value:"41",label:"ä½è³€çœŒ"},{value:"42",label:"é•·å´ŽçœŒ"},{value:"43",label:"ç†Šæœ¬çœŒ"},{value:"44",label:"å¤§åˆ†çœŒ"},{value:"45",label:"å®®å´ŽçœŒ"},{value:"46",label:"é¹¿å…å³¶çœŒ"},{value:"47",label:"æ²–ç¸„çœŒ"}],Aa=[{value:"1",label:"~300ä¸‡å††"},{value:"2",label:"300~500ä¸‡å††"},{value:"3",label:"500~700ä¸‡å††"},{value:"4",label:"700~1000ä¸‡å††"},{value:"5",label:"1000ä¸‡å††~"}],Ka=[{value:"1",label:"1äºº"},{value:"2",label:"2äºº"},{value:"3",label:"3äºº"},{value:"4",label:"4äºº"},{value:"5",label:"5äººä»¥ä¸Š"}];function La({profile:a,onSave:r,isLoading:t}){const{t:n}=F("common"),[g,y]=d.useState("2"),[s,m]=d.useState("13"),[p,v]=d.useState("3");d.useEffect(()=>{a&&(y(String(a.family_size)),m(a.prefecture),v(a.annual_income_bracket))},[a]);const c=l=>{l.preventDefault(),r({family_size:parseInt(g),prefecture:s,annual_income_bracket:p})},j=a?g!==String(a.family_size)||s!==a.prefecture||p!==a.annual_income_bracket:!0;return e.jsxs("form",{onSubmit:c,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(X,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"}),n("benchmark.familySize","Family size")]}),e.jsx($,{value:g,onChange:l=>y(l.target.value),options:Ka,disabled:t})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"}),n("benchmark.prefecture","Prefecture")]}),e.jsx($,{value:s,onChange:l=>m(l.target.value),options:Ra,disabled:t})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"}),n("benchmark.annualIncome","Annual income bracket")]}),e.jsx($,{value:p,onChange:l=>v(l.target.value),options:Aa,disabled:t})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(S,{type:"submit",disabled:!j||t,className:x("min-w-[120px]",!j&&"opacity-50 cursor-not-allowed"),children:t?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),n("common.saving","Saving...")]}):n("common.save","Save")})})]})}const za=[{id:"appearance",labelKey:"settings.sections.appearance",icon:ue},{id:"general",labelKey:"settings.sections.general",icon:U},{id:"household",labelKey:"settings.sections.household",icon:X},{id:"budget",labelKey:"settings.sections.budget",icon:ee},{id:"categories",labelKey:"settings.sections.categories",icon:Y},{id:"sources",labelKey:"settings.sections.sources",icon:Ee},{id:"recurring",labelKey:"settings.sections.recurring",icon:ra},{id:"notifications",labelKey:"settings.sections.notifications",icon:oe},{id:"crypto",labelKey:"settings.sections.crypto",icon:Te},{id:"anomaly",labelKey:"anomaly.title",icon:te}];function Ia(){var R,K;const{t:a}=F("common"),r=H(),[t,n]=d.useState("appearance"),[g,y]=d.useState(!1),{data:s,isLoading:m}=I({queryKey:["settings"],queryFn:Me}),{data:p}=I({queryKey:["household-profile"],queryFn:Xe}),v=M({mutationFn:Ze,onSuccess:()=>{r.invalidateQueries({queryKey:["household-profile"]}),r.invalidateQueries({queryKey:["benchmark-comparison"]}),se.success(a("settings.profileSaved","Household profile saved successfully"))},onError:N=>{console.error("Failed to save household profile:",N),se.error(a("settings.profileSaveError","Failed to save household profile"))}}),[c,j]=d.useState("JPY"),[l,o]=d.useState(25),[i,b]=d.useState(!1),[f,w]=d.useState(!0),[k,E]=d.useState(1e6);d.useEffect(()=>{s&&(j(s.currency),o(s.base_date),b(s.budget_carry_over),w(s.budget_email_alerts),E(s.large_transaction_threshold))},[s]),d.useEffect(()=>{if(s){const N=c!==s.currency||l!==s.base_date||i!==s.budget_carry_over||f!==s.budget_email_alerts||k!==s.large_transaction_threshold;y(N)}},[c,l,i,f,k,s]);const C=M({mutationFn:Pe,onSuccess:()=>{r.invalidateQueries({queryKey:["settings"]}),r.invalidateQueries({queryKey:["dashboard-summary"]}),r.invalidateQueries({queryKey:["transactions"]}),r.invalidateQueries({queryKey:["analytics"]}),y(!1)},onError:N=>{console.error("Failed to save settings:",N)}}),_=()=>{C.mutate({currency:c,base_date:l,budget_carry_over:i,budget_email_alerts:f,large_transaction_threshold:k})};if(m)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(z,{size:"lg"})});const T={JPY:a("settings.currencyJPY"),USD:a("settings.currencyUSD"),VND:a("settings.currencyVND")};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-primary-600"}),a("settings.title")]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:a("settings.subtitle")})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto py-2 scrollbar-hide -mb-2",children:za.map(N=>{const A=N.icon,h=t===N.id;return e.jsxs("button",{onClick:()=>n(N.id),className:x("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",h?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(A,{className:"w-3.5 h-3.5"}),a(N.labelKey)]},N.id)})})})})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx("div",{className:x("space-y-4",t!=="appearance"&&"hidden"),children:e.jsx(B,{icon:ue,title:a("appearance.title","Appearance"),description:a("appearance.subtitle","Theme, colors, and display preferences"),children:e.jsx(Da,{})})}),e.jsx("div",{className:x("space-y-4",t!=="general"&&"hidden"),children:e.jsx(B,{icon:U,title:a("settings.general"),description:"Currency and basic preferences",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx($,{label:a("settings.currency"),value:c,onChange:N=>j(N.target.value),options:[{value:"JPY",label:T.JPY},{value:"USD",label:T.USD},{value:"VND",label:T.VND}]}),e.jsx(q,{type:"number",label:a("settings.payday"),value:l,onChange:N=>o(parseInt(N.target.value,10)),min:1,max:31}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 -mt-2",children:a("settings.paydayDescription")})]})})}),e.jsx("div",{className:x("space-y-4",t!=="household"&&"hidden"),children:e.jsx(B,{icon:X,title:a("settings.householdProfile","Household Profile"),description:a("settings.householdProfileDescription","Family size, prefecture, and income bracket for spending benchmarks"),children:e.jsx(La,{profile:p||null,onSave:N=>v.mutate(N),isLoading:v.isPending})})}),e.jsx("div",{className:x("space-y-4",t!=="budget"&&"hidden"),children:e.jsx(B,{icon:ee,title:a("settings.budgetSettings"),description:"Budget behavior and alerts",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(le,{label:a("settings.budgetCarryOver"),description:a("settings.budgetCarryOverDescription"),checked:i,onChange:b}),e.jsx(le,{label:a("settings.budgetEmailAlerts"),description:a("settings.budgetEmailAlertsDescription"),checked:f,onChange:w}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block mb-2",children:a("settings.largeTransactionThreshold")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:a("settings.largeTransactionThresholdDescription")}),e.jsx(q,{type:"number",value:k,onChange:N=>E(parseInt(N.target.value,10)||0),min:0,step:1e5}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:a("settings.largeTransactionThresholdHint")})]})]})})}),e.jsx("div",{className:x("space-y-4",t!=="categories"&&"hidden"),children:e.jsx(Ca,{})}),e.jsx("div",{className:x("space-y-4",t!=="sources"&&"hidden"),children:e.jsxs(ae,{title:a("settings.paymentSourceManagement"),badge:((R=s==null?void 0:s.sources)==null?void 0:R.length)||0,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:((K=s==null?void 0:s.sources)==null?void 0:K.map((N,A)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:N}),e.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:a("settings.delete")})]},A)))||e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:a("settings.noSources")})}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",children:a("settings.addSource")})})]})}),e.jsx("div",{className:x("space-y-4",t!=="recurring"&&"hidden"),children:e.jsx(Oe,{})}),e.jsx("div",{className:x("space-y-4",t!=="notifications"&&"hidden"),children:e.jsx(Ta,{})}),e.jsx("div",{className:x("space-y-4",t!=="crypto"&&"hidden"),children:e.jsx(wa,{})}),e.jsx("div",{className:x("space-y-4",t!=="anomaly"&&"hidden"),children:e.jsx(Sa,{})}),e.jsx(fa,{})]}),g&&typeof document<"u"&&Z.createPortal(e.jsx("div",{className:"fixed bottom-20 left-0 right-0 p-4 bg-white/90 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-gray-700 z-40",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(S,{onClick:_,disabled:C.isPending,className:"w-full",size:"lg",children:C.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z,{size:"sm",className:"mr-2"}),a("saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),a("settings.saveSettings")]})})})}),document.body)]})}function B({icon:a,title:r,description:t,children:n,className:g}){return e.jsxs(D,{className:x("",g),children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:e.jsx(a,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r}),t&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t})]})]}),n]})}function le({label:a,description:r,checked:t,onChange:n}){return e.jsxs("div",{className:"flex items-start justify-between py-1",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block",children:a}),r&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:r})]}),e.jsx("button",{onClick:()=>n(!t),className:x("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",t?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:x("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",t?"translate-x-6":"translate-x-1")})})]})}const st=Fe("/settings")({component:Ia});export{st as Route};
