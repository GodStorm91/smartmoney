import{k as P,G as S,u as p,r as x,A as v,j as e,C as j,I as K,av as E,B as q,l as C,h as M,aw as I,ax as T,n as D,ay as $,az as G,a3 as A,t as Y,aA as B,i as J}from"./index-D8m8Ptfn.js";import{S as g}from"./Select-Bh-S36z0.js";import{M as Q}from"./minus-CUfDqMgI.js";import"./chevron-down-OcvE-Ig6.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],V=P("map-pin",U);async function Z(){return(await S.get("/api/relocation/cities")).data}async function H(a){return(await S.post("/api/relocation/compare",a)).data}const W=["single","couple","couple_1","couple_2","couple_3"],X=["1K","1LDK","2LDK","3LDK"];function ee({onSubmit:a,isLoading:n}){const{t,i18n:r}=p("common"),i=r.language==="ja",[o,l]=x.useState(""),[m,b]=x.useState("single"),[u,h]=x.useState("1K"),[c,d]=x.useState(""),[y,L]=x.useState(""),{data:N,isLoading:_}=v({queryKey:["relocation-cities"],queryFn:Z,staleTime:1e3*60*30}),w=[{value:"",label:t("relocation.selectCity")},...(N==null?void 0:N.map(s=>({value:String(s.id),label:i?`${s.prefecture_name} ${s.city_name}`:`${s.city_name_en}, ${s.prefecture_name_en}`})))??[]],F=W.map(s=>({value:s,label:t(`relocation.familySize.${s}`)})),z=X.map(s=>({value:s,label:s})),R=s=>{s.preventDefault(),!(!o||!c||!y)&&a({nenshu:Number(o),family_size:m,room_type:u,current_city_id:Number(c),target_city_id:Number(y)})},O=o&&Number(o)>0&&c&&y&&c!==y;return e.jsx(j,{children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsx(K,{id:"nenshu",label:t("relocation.nenshu"),type:"number",placeholder:t("relocation.nenshuPlaceholder"),value:o,onChange:s=>l(s.target.value),min:1}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(g,{id:"familySize",label:t("relocation.familySizeLabel"),options:F,value:m,onChange:s=>b(s.target.value)}),e.jsx(g,{id:"roomType",label:t("relocation.roomTypeLabel"),options:z,value:u,onChange:s=>h(s.target.value)})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx(V,{className:"w-4 h-4"}),t("relocation.citySelection")]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr] gap-3 items-end",children:[e.jsx(g,{id:"currentCity",label:t("relocation.currentCity"),options:w,value:c,onChange:s=>d(s.target.value),disabled:_}),e.jsx(E,{className:"hidden sm:block w-5 h-5 text-gray-400 mb-3"}),e.jsx(g,{id:"targetCity",label:t("relocation.targetCity"),options:w,value:y,onChange:s=>L(s.target.value),disabled:_})]})]}),e.jsx(q,{type:"submit",loading:n,disabled:!O,className:"w-full",children:t("relocation.compare")})]})})}const te=["rent","estimated_food","estimated_utilities","estimated_transport","social_insurance","resident_tax","income_tax"];function f(a){return`Â¥${a.toLocaleString()}`}function k({breakdown:a,label:n}){const{t}=p("common");return e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1 truncate",children:n}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3 truncate",children:a.prefecture_name}),e.jsx("div",{className:"space-y-2",children:te.map(r=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 truncate mr-2",children:t(`relocation.cost.${r}`)}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white whitespace-nowrap",children:f(a[r])})]},r))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:t("relocation.totalMonthly")}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:f(a.total_monthly)})]})})]})}function ae({data:a}){const{t:n}=p("common"),t=a.monthly_difference,r=t<0,i=t>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{variant:"gradient",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n("relocation.monthlyDiff")}),e.jsxs("p",{className:C("text-2xl font-bold",r?"text-emerald-600 dark:text-emerald-400":i?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:[r?"":i?"+":"",f(t)]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[n("relocation.annualDiff"),": ",r?"":i?"+":"",f(a.annual_difference)]})]}),e.jsx(M,{variant:r?"success":i?"error":"default",children:e.jsxs("span",{className:"flex items-center gap-1",children:[r?e.jsx(I,{className:"w-3 h-3"}):i?e.jsx(T,{className:"w-3 h-3"}):e.jsx(Q,{className:"w-3 h-3"}),n(r?"relocation.saving":i?"relocation.moreExpensive":"relocation.same")]})})]})}),e.jsxs(j,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:n("relocation.breakdown")}),e.jsxs("div",{className:"flex gap-4 sm:gap-6",children:[e.jsx(k,{breakdown:a.current,label:a.current.city_name}),e.jsx("div",{className:"w-px bg-gray-200 dark:bg-gray-700 shrink-0"}),e.jsx(k,{breakdown:a.target,label:a.target.city_name})]})]})]})}function se({monthlyDifference:a}){const{t:n}=p("common"),{data:t}=v({queryKey:["goals"],queryFn:$}),{data:r}=v({queryKey:["goals-progress-relocation",t==null?void 0:t.map(l=>l.id)],queryFn:async()=>t!=null&&t.length?Promise.all(t.map(l=>G(l.id,!0,3))):[],enabled:!!(t!=null&&t.length)});if(!(r!=null&&r.length)||a===0)return null;const i=a<0,o=Math.abs(a);return e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(D,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("relocation.goalImpact")})]}),e.jsx("div",{className:"space-y-3",children:r.map(l=>{if(!l.achievability)return null;const m=l.target_amount-l.total_saved;if(m<=0)return null;const b=l.achievability.current_monthly_net>0?Math.ceil(m/l.achievability.current_monthly_net):1/0,u=i?l.achievability.current_monthly_net+o:l.achievability.current_monthly_net-o,h=u>0?Math.ceil(m/u):1/0,c=b-h,d=c>0;return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:l.name||n("goals.yearGoal",{years:l.years})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c!==0&&isFinite(c)?e.jsx("span",{className:C(d?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:d?n("relocation.goalFaster",{months:Math.abs(c)}):n("relocation.goalSlower",{months:Math.abs(c)})}):n("relocation.goalNoChange")})]}),e.jsx(M,{variant:d?"success":c<0?"error":"default",children:e.jsxs("span",{className:"flex items-center gap-1",children:[d?e.jsx(T,{className:"w-3 h-3"}):c<0?e.jsx(I,{className:"w-3 h-3"}):null,isFinite(h)?n("relocation.monthsRemaining",{months:h}):"-"]})})]},l.goal_id)})})]})}function ne(){const{t:a}=p("common"),[n,t]=x.useState(null),r=A({mutationFn:i=>H(i),onSuccess:i=>{t(i)},onError:()=>{Y.error(a("relocation.compareError"))}});return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary-600"}),a("relocation.title")]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a("relocation.subtitle")})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx(ee,{onSubmit:i=>r.mutate(i),isLoading:r.isPending}),n&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{data:n}),e.jsx(se,{monthlyDifference:n.monthly_difference})]})]})]})}const oe=J("/relocation")({component:ne});export{oe as Route};
