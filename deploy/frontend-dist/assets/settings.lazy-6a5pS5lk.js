import{k as O,G as P,u as R,H as z,r as g,A as I,a3 as M,j as e,C as D,E as L,B as S,P as be,l as u,T as se,g as Y,X as re,x as G,I as q,ah as fe,ai as $,aj as je,ak as ne,R as ke,al as ie,am as ve,an as Ne,ao as Ce,ap as we,aq as _e,ar as le,V as Se,as as Pe,at as Te,i as Ee}from"./index-CMujLMxZ.js";import{C as Z,c as Me,d as qe,s as De,a as Re,b as Fe,e as A,f as Ae,g as Le}from"./crypto-CaAY8oLe.js";import{S as ce}from"./Select-Dx4srjAw.js";import{P as Ke,R as Ie}from"./RecurringTransactionsList-CocT8Vzf.js";import{T as J}from"./tag-DrGWmrVK.js";import{u as Oe,a as ze,b as We,c as Qe}from"./useCategories-B7Ern5MY.js";import{T as X}from"./triangle-alert-ttKO4DPO.js";import{P as He}from"./pencil-CexU-crJ.js";import{S as $e,Z as Ue}from"./Switch-B2_wE8lD.js";import{M as Be}from"./mail-CJFjhtMW.js";import{C as Ve}from"./crown-bonXKd4F.js";import"./chevron-down-BxGI7ueC.js";import"./recurring-service-CMRFaJfR.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Ye=O("monitor",Je);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],oe=O("palette",Ge);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],Xe=O("repeat",Ze);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],tt=O("save",et);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],st=O("smartphone",at);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],nt=O("wand-sparkles",rt);async function it(){return(await P.get("/api/category-rules/")).data.rules}async function lt(t){return(await P.post("/api/category-rules/",t)).data}async function ct(t){await P.delete(`/api/category-rules/${t}`)}async function ot(t=!0){return(await P.post("/api/category-rules/apply",{dry_run:t})).data}async function dt(){return(await P.get("/api/category-rules/suggest")).data.suggestions}async function gt(){return(await P.post("/api/category-rules/seed-defaults")).data}const mt={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},ut=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function xt(){const{t}=R("common"),r=z(),[a,i]=g.useState(null),[m,f]=g.useState(!1),[s,x]=g.useState(!1),[y,v]=g.useState(null),[l,j]=g.useState(""),[c,o]=g.useState("Other"),[n,p]=g.useState("contains"),{data:h,isLoading:w}=I({queryKey:["category-rules"],queryFn:it}),{data:k,isLoading:T}=I({queryKey:["category-rules-suggestions"],queryFn:dt,enabled:s}),C=M({mutationFn:ct,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]}),i(null)}}),_=M({mutationFn:lt,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]}),j(""),o("Other"),p("contains"),f(!1)}}),E=M({mutationFn:gt,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]})}}),N=M({mutationFn:b=>ot(b),onSuccess:(b,H)=>{H?v({count:b.affected_count,applied:!1}):(r.invalidateQueries({queryKey:["transactions"]}),r.invalidateQueries({queryKey:["analytics"]}),v({count:b.affected_count,applied:!0}))}}),F=b=>{confirm(t("confirmDelete"))&&(i(b),C.mutate(b))},W=()=>{l.trim()&&_.mutate({keyword:l.trim(),category:c,match_type:n,priority:10})},Q=b=>{_.mutate({keyword:b.keyword,category:b.suggested_category,match_type:"contains",priority:10})};return w?e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("categoryRules.title")})]}),e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(L,{size:"md"})})]}):e.jsxs(Z,{title:t("categoryRules.title"),badge:(h==null?void 0:h.length)||0,children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!h||h.length===0)&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>E.mutate(),disabled:E.isPending,children:[e.jsx(nt,{className:"w-4 h-4 mr-1"}),E.isPending?t("loading"):t("categoryRules.seedDefaults")]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>f(!m),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),t("categoryRules.addRule")]})]}),m&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:t("categoryRules.keyword"),value:l,onChange:b=>j(b.target.value),className:u("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),e.jsx("select",{value:c,onChange:b=>o(b.target.value),className:u("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:ut.map(b=>e.jsx("option",{value:b,children:b},b))}),e.jsxs("select",{value:n,onChange:b=>p(b.target.value),className:u("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[e.jsx("option",{value:"contains",children:t("categoryRules.contains")}),e.jsx("option",{value:"starts_with",children:t("categoryRules.startsWith")}),e.jsx("option",{value:"exact",children:t("categoryRules.exact")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>f(!1),children:t("cancel")}),e.jsx(S,{size:"sm",onClick:W,disabled:!l.trim()||_.isPending,children:_.isPending?t("saving"):t("save")})]})]}),h&&h.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-6",children:h.map(b=>e.jsxs("div",{className:u("flex items-center justify-between p-3 rounded-lg border",b.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:b.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:b.category}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",t(mt[b.match_type]),")"]})]}),e.jsx("button",{onClick:()=>F(b.id),disabled:a===b.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:a===b.id?e.jsx(L,{size:"sm"}):e.jsx(se,{className:"w-4 h-4"})})]},b.id))}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("categoryRules.applyDescription")}),y&&e.jsx("p",{className:u("text-sm mt-1",y.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:y.applied?t("categoryRules.appliedCount",{count:y.count}):t("categoryRules.previewCount",{count:y.count})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>N.mutate(!0),disabled:N.isPending,children:N.isPending?t("loading"):t("categoryRules.preview")}),e.jsxs(S,{size:"sm",onClick:()=>N.mutate(!1),disabled:N.isPending||(y==null?void 0:y.count)===0,children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),t("categoryRules.applyNow")]})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("categoryRules.noRules")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("categoryRules.noRulesDescription")})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[e.jsx("button",{onClick:()=>x(!s),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:t(s?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),s&&e.jsx("div",{className:"mt-4 space-y-2",children:T?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(L,{size:"sm"})}):k&&k.length>0?k.map((b,H)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:b.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:b.suggested_category}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",b.count,"x)"]})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>Q(b),disabled:_.isPending,children:e.jsx(Y,{className:"w-4 h-4"})})]},H)):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:t("categoryRules.noSuggestions")})})]})]})}const yt=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function pt({isOpen:t,onClose:r,defaultType:a="expense",onCreated:i}){const{t:m}=R("common"),f=Oe(),[s,x]=g.useState(""),[y,v]=g.useState("ðŸ“"),[l,j]=g.useState(a),[c,o]=g.useState(""),n=async w=>{var T,C;w.preventDefault(),o("");const k=s.trim();if(!k){o(m("category.errors.nameRequired","Name is required"));return}try{const E=`custom_${(await f.mutateAsync({name:k,icon:y,type:l})).id}`;i==null||i(E),p()}catch(_){o(((C=(T=_.response)==null?void 0:T.data)==null?void 0:C.detail)||m("category.errors.createFailed","Failed to create category"))}},p=()=>{x(""),v("ðŸ“"),j(a),o(""),r()};if(!t)return null;const h=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:p}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:m("category.createTitle","Create Category")}),e.jsx("button",{onClick:p,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(re,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("category.name","Category Name")}),e.jsx("input",{type:"text",value:s,onChange:w=>x(w.target.value),placeholder:m("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:yt.map(w=>e.jsx("button",{type:"button",onClick:()=>v(w),className:u("w-8 h-8 text-lg rounded flex items-center justify-center",y===w?"bg-primary-100 dark:bg-primary-900 border-2 border-primary-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("category.type","Type")}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>j("expense"),className:u("flex-1 py-2 rounded-md text-sm font-medium transition-colors",l==="expense"?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:m("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>j("income"),className:u("flex-1 py-2 rounded-md text-sm font-medium transition-colors",l==="income"?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:m("transaction.income","Income")})]})]}),c&&e.jsx("p",{className:"text-sm text-red-500",children:c}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:p,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:m("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:f.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:f.isPending?"...":m("create","Create")})]})]})]})]});return typeof document>"u"?null:G.createPortal(h,document.body)}const ht=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function bt({isOpen:t,onClose:r,category:a}){const{t:i}=R("common"),m=z(),[f,s]=g.useState(""),[x,y]=g.useState("ðŸ“"),[v,l]=g.useState(""),[j,c]=g.useState(null);g.useEffect(()=>{a&&(s(a.name),y(a.icon),l(""),c(null))},[a]);const o=M({mutationFn:k=>ze(a.id,k),onSuccess:k=>{c(k.affected_transactions),m.invalidateQueries({queryKey:["categories"]}),m.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{p()},1500)},onError:k=>{var C,_;l(((_=(C=k.response)==null?void 0:C.data)==null?void 0:_.detail)||i("category.errors.updateFailed","Failed to update category"))}}),n=async k=>{k.preventDefault(),l("");const T=f.trim();if(!T){l(i("category.errors.nameRequired","Name is required"));return}const C={};if(T!==(a==null?void 0:a.name)&&(C.name=T),x!==(a==null?void 0:a.icon)&&(C.icon=x),Object.keys(C).length===0){p();return}o.mutate(C)},p=()=>{s(""),y("ðŸ“"),l(""),c(null),r()};if(!t||!a)return null;const h=f.trim()!==a.name,w=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:p}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i("category.editTitle","Edit Category")}),e.jsx("button",{onClick:p,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(re,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),j!==null&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[i("category.updateSuccess","Category updated!"),j>0&&e.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:i("category.transactionsUpdated","{{count}} transactions updated",{count:j})})]})}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.name","Category Name")}),e.jsx("input",{type:"text",value:f,onChange:k=>s(k.target.value),placeholder:i("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),h&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[e.jsx(X,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:i("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:ht.map(k=>e.jsx("button",{type:"button",onClick:()=>y(k),className:u("w-8 h-8 text-lg rounded flex items-center justify-center",x===k?"bg-primary-100 dark:bg-primary-900 border-2 border-primary-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:k},k))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.type","Type")}),e.jsx("div",{className:u("h-10 px-3 flex items-center rounded-lg text-sm font-medium",a.type==="expense"?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:a.type==="expense"?i("transaction.expense","Expense"):i("transaction.income","Income")})]}),v&&e.jsx("p",{className:"text-sm text-red-500",children:v}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:p,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:i("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:o.isPending||j!==null,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:o.isPending?"...":i("save","Save")})]})]})]})]});return typeof document>"u"?null:G.createPortal(w,document.body)}function ft(){const{t}=R("common"),{data:r=[],isLoading:a}=We(),i=Qe(),[m,f]=g.useState(!1),[s,x]=g.useState(null),[y,v]=g.useState(null),l=async o=>{try{await i.mutateAsync(o),v(null)}catch(n){console.error("Failed to delete category:",n)}},j=r.filter(o=>o.type==="expense"),c=r.filter(o=>o.type==="income");return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{title:t("settings.categoryManagement"),badge:r.length,children:[a?e.jsx("div",{className:"py-4 text-center text-gray-400",children:t("loading")}):r.length===0?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noCategories")}):e.jsxs("div",{className:"space-y-4",children:[j.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.expense","Expense")}),e.jsx("div",{className:"space-y-2",children:j.map(o=>e.jsx(ee,{category:o,onEdit:()=>x(o),onDelete:()=>v(o.id),isDeleting:i.isPending&&y===o.id,showDeleteConfirm:y===o.id,onConfirmDelete:()=>l(o.id),onCancelDelete:()=>v(null)},o.id))})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.income","Income")}),e.jsx("div",{className:"space-y-2",children:c.map(o=>e.jsx(ee,{category:o,onEdit:()=>x(o),onDelete:()=>v(o.id),isDeleting:i.isPending&&y===o.id,showDeleteConfirm:y===o.id,onConfirmDelete:()=>l(o.id),onCancelDelete:()=>v(null)},o.id))})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",onClick:()=>f(!0),children:t("settings.addCategory")})})]}),e.jsx(pt,{isOpen:m,onClose:()=>f(!1)}),e.jsx(bt,{isOpen:!!s,onClose:()=>x(null),category:s})]})}function ee({category:t,onEdit:r,onDelete:a,isDeleting:i,showDeleteConfirm:m,onConfirmDelete:f,onCancelDelete:s}){const{t:x}=R("common");return m?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:x("category.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:x("cancel")}),e.jsx("button",{onClick:f,disabled:i,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:i?"...":x("delete")})]})]}):e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:x("edit"),children:e.jsx(He,{size:16})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:x("delete"),children:e.jsx(se,{size:16})})]})]})}const te=["eth","bsc","polygon"];function jt(){const{t}=R("common"),r=z(),[a,i]=g.useState(!1),[m,f]=g.useState(""),[s,x]=g.useState(""),[y,v]=g.useState(["eth","bsc","polygon"]),[l,j]=g.useState(!1),[c,o]=g.useState("polygon"),[n,p]=g.useState(""),[h,w]=g.useState(""),[k,T]=g.useState(""),[C,_]=g.useState(null),{data:E,isLoading:N}=I({queryKey:["crypto-wallets"],queryFn:Ae}),{data:F,isLoading:W}=I({queryKey:["reward-contracts"],queryFn:Le}),Q=M({mutationFn:Me,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),i(!1),ge()}}),b=M({mutationFn:qe,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]})}}),H=M({mutationFn:De,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),r.invalidateQueries({queryKey:["dashboard-summary"]}),_(null)},onError:()=>{_(null)}}),U=M({mutationFn:Re,onSuccess:()=>{r.invalidateQueries({queryKey:["reward-contracts"]}),j(!1),me()}}),de=M({mutationFn:Fe,onSuccess:()=>{r.invalidateQueries({queryKey:["reward-contracts"]})}}),ge=()=>{f(""),x(""),v(["eth","bsc","polygon"])},me=()=>{o("polygon"),p(""),w(""),T("")},ue=()=>{if(!m||!m.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}Q.mutate({wallet_address:m,label:s||void 0,chains:y})},xe=d=>{_(d),H.mutate(d)},ye=()=>{if(!n||!n.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}U.mutate({chain_id:c,contract_address:n,label:h||void 0,token_symbol:k||void 0})},pe=d=>{v(K=>K.includes(d)?K.filter(he=>he!==d):[...K,d])};return N||W?e.jsx(D,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.wallets")}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>i(!a),children:t(a?"cancel":"crypto.addWallet")})]}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(q,{label:t("crypto.walletAddress"),placeholder:"0x...",value:m,onChange:d=>f(d.target.value)}),e.jsx(q,{label:t("crypto.walletLabel"),placeholder:t("crypto.labelPlaceholder"),value:s,onChange:d=>x(d.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:te.map(d=>e.jsxs("button",{type:"button",onClick:()=>pe(d),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${y.includes(d)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[d].icon," ",A[d].name]},d))})]}),e.jsx(S,{onClick:ue,disabled:Q.isPending,className:"w-full",children:Q.isPending?t("loading"):t("crypto.addWallet")})]}),e.jsx("div",{className:"space-y-3",children:E&&E.length>0?E.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:d.label||t("crypto.unnamedWallet")}),e.jsx("div",{className:"flex gap-1",children:d.chains.map(K=>e.jsx("span",{title:A[K].name,children:A[K].icon},K))})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:d.wallet_address})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>xe(d.id),disabled:C===d.id,children:C===d.id?e.jsx(L,{size:"sm"}):t("crypto.sync")}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteWallet"))&&b.mutate(d.id)},className:"text-red-600 hover:text-red-700 text-sm",children:t("delete")})]})]},d.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noWallets")})})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.rewardContracts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("crypto.rewardContractsDescription")})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>j(!l),children:t(l?"cancel":"crypto.addContract")})]}),l&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chain")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:te.map(d=>e.jsxs("button",{type:"button",onClick:()=>o(d),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${c===d?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[d].icon," ",A[d].name]},d))})]}),e.jsx(q,{label:t("crypto.contractAddress"),placeholder:"0x...",value:n,onChange:d=>p(d.target.value)}),e.jsx(q,{label:t("crypto.contractLabel"),placeholder:t("crypto.contractLabelPlaceholder"),value:h,onChange:d=>w(d.target.value)}),e.jsx(q,{label:t("crypto.tokenSymbol"),placeholder:"STEER",value:k,onChange:d=>T(d.target.value)}),e.jsx(S,{onClick:ye,disabled:U.isPending,className:"w-full",children:U.isPending?t("loading"):t("crypto.addContract")})]}),e.jsx("div",{className:"space-y-3",children:F&&F.length>0?F.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{title:A[d.chain_id].name,children:A[d.chain_id].icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:d.label||t("crypto.unnamedContract")}),d.token_symbol&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:d.token_symbol})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:d.contract_address})]}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteContract"))&&de.mutate(d.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:t("delete")})]},d.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noContracts")})})]})]})}function kt(){const{t}=R("common"),r=z(),{data:a,isLoading:i,error:m}=I({queryKey:["anomalyConfig"],queryFn:je}),f=M({mutationFn:c=>fe(c),onSuccess:()=>{r.invalidateQueries({queryKey:["anomalyConfig"]})}}),[s,x]=g.useState({sensitivity:"medium",large_transaction_threshold:1e4,unusual_spending_percent:50,recurring_change_percent:20,duplicate_charge_hours:24,enabled_types:["large_transaction","category_shift","duplicate"]});g.useEffect(()=>{a&&x({sensitivity:a.sensitivity,large_transaction_threshold:a.large_transaction_threshold,unusual_spending_percent:a.unusual_spending_percent,recurring_change_percent:a.recurring_change_percent,duplicate_charge_hours:a.duplicate_charge_hours,enabled_types:a.enabled_types||["large_transaction","category_shift","duplicate"]})},[a]);const y=()=>{f.mutate(s)},v=c=>{x(o=>{const n=o.enabled_types||[],p=n.includes(c)?n.filter(h=>h!==c):[...n,c];return{...o,enabled_types:p}})},l=[{key:"large_transaction",label:t("anomaly.type.large_transaction")},{key:"category_shift",label:t("anomaly.type.category_shift")},{key:"duplicate",label:t("anomaly.type.duplicate")},{key:"recurring_change",label:t("anomaly.type.recurring_change")},{key:"ml_detected",label:t("anomaly.type.ml_detected")}],j=[{value:"low",label:t("anomaly.config.sensitivityOptions.low")},{value:"medium",label:t("anomaly.config.sensitivityOptions.medium")},{value:"high",label:t("anomaly.config.sensitivityOptions.high")}];return i?e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"})]})}):m?e.jsxs(D,{className:"p-6 text-center text-gray-500",children:[e.jsx(X,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:t("common.noData")})]}):e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx($,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:t("anomaly.config.title")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{label:t("anomaly.config.sensitivity"),value:s.sensitivity,onChange:c=>x({...s,sensitivity:c.target.value}),options:j}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(q,{type:"number",label:t("anomaly.config.largeTransactionThreshold"),value:s.large_transaction_threshold,onChange:c=>x({...s,large_transaction_threshold:parseInt(c.target.value)||0})}),e.jsx(q,{type:"number",label:t("anomaly.config.unusualSpendingPercent"),value:s.unusual_spending_percent,onChange:c=>x({...s,unusual_spending_percent:parseInt(c.target.value)||0})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(q,{type:"number",label:t("anomaly.config.recurringChangePercent"),value:s.recurring_change_percent,onChange:c=>x({...s,recurring_change_percent:parseInt(c.target.value)||0})}),e.jsx(q,{type:"number",label:t("anomaly.config.duplicateChargeHours"),value:s.duplicate_charge_hours,onChange:c=>x({...s,duplicate_charge_hours:parseInt(c.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:t("anomaly.config.enabledTypes")}),e.jsx("div",{className:"space-y-3",children:l.map(c=>{const o=(s.enabled_types||[]).includes(c.key);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:c.label}),e.jsx($e,{checked:o,onChange:()=>v(c.key)})]},c.key)})})]}),e.jsx(S,{onClick:y,disabled:f.isPending,className:"w-full",children:f.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"â³"}),t("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4"}),t("anomaly.config.save")]})}),f.isSuccess&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 text-center",children:t("anomaly.config.saved")})]})]})}const B={async getNotifications(t){const r=new URLSearchParams;return t!=null&&t.unreadOnly&&r.append("unread_only","true"),t!=null&&t.limit&&r.append("limit",String(t.limit)),t!=null&&t.offset&&r.append("offset",String(t.offset)),t!=null&&t.type&&r.append("type",t.type),(await P.get(`/api/notifications?${r}`)).data},async getUnreadCount(){return(await P.get("/api/notifications/unread/count")).data},async markAsRead(t){return(await P.put(`/api/notifications/${t}/read`,{})).data},async markAllAsRead(){return(await P.put("/api/notifications/read-all",{})).data},async deleteNotification(t){return(await P.delete(`/api/notifications/${t}`)).data},async cleanupOldNotifications(t=30){return(await P.post("/api/notifications/cleanup",{days_old:t})).data},async getPreferences(){return(await P.get("/api/notifications/preferences")).data},async updatePreference(t,r,a){return(await P.put(`/api/notifications/preferences/${t}`,{enabled:r,settings:a})).data},async subscribePush(t){return(await P.post("/api/notifications/push/subscribe",t)).data},async unsubscribePush(){return(await P.post("/api/notifications/push/unsubscribe",{})).data}};function vt(){return typeof window>"u"?!1:"serviceWorker"in navigator&&"PushManager"in window}async function Nt(){return typeof window>"u"?"denied":await Notification.requestPermission()}function Ct(){return""}function wt(){const{t}=R("common"),r=z(),[a,i]=g.useState(!1),[m,f]=g.useState(!1),{data:s,isLoading:x}=I({queryKey:["notification-preferences"],queryFn:B.getPreferences}),y=M({mutationFn:({channel:n,enabled:p,settings:h})=>B.updatePreference(n,p,h),onSuccess:()=>{r.invalidateQueries({queryKey:["notification-preferences"]})}}),v=(s==null?void 0:s.preferences)||[];g.useEffect(()=>{(async()=>{if(vt()){const p=await Notification.permission;i(p==="granted")}})()},[]);const l=(n,p)=>{y.mutate({channel:n,enabled:!p})},j=async()=>{f(!0);try{if(await Nt()==="granted"&&(i(!0),"serviceWorker"in navigator&&"PushManager"in window)){const h=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ct()});await B.subscribePush(h.toJSON())}}catch(n){console.error("Failed to enable push notifications:",n)}finally{f(!1)}},c=n=>v.find(p=>p.channel===n),o=[{id:"push",icon:st,label:t("notifications.channels.push"),description:t("notifications.channels.pushDescription"),getEnabled:()=>a,onToggle:j},{id:"email",icon:Be,label:t("notifications.channels.email"),description:t("notifications.channels.emailDescription"),getEnabled:()=>{var n;return((n=c("email"))==null?void 0:n.enabled)??!0},onToggle:()=>{var n;return l("email",((n=c("email"))==null?void 0:n.enabled)??!0)}},{id:"in_app",icon:ne,label:t("notifications.channels.inApp"),description:t("notifications.channels.inAppDescription"),getEnabled:()=>{var n;return((n=c("in_app"))==null?void 0:n.enabled)??!0},onToggle:()=>{var n;return l("in_app",((n=c("in_app"))==null?void 0:n.enabled)??!0)}}];return x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(L,{size:"lg"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t("notifications.channels.title")})]}),e.jsx("div",{className:"space-y-4",children:o.map(n=>{const p=n.icon,h=n.getEnabled();return e.jsxs("div",{className:u("flex items-center justify-between p-3 rounded-lg border transition-colors",h?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:u("p-2 rounded-lg",h?"bg-green-100 dark:bg-green-900/50":"bg-gray-200 dark:bg-gray-600"),children:e.jsx(p,{className:u("w-5 h-5",h?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n.label}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n.description})]})]}),e.jsx("button",{onClick:n.onToggle,disabled:n.id==="push"&&m,className:u("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",h?"bg-green-500":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:u("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",h?"translate-x-6":"translate-x-1")})})]},n.id)})})]}),e.jsxs(D,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.types.title")}),e.jsx("div",{className:"space-y-3",children:[{key:"budget_alert",label:t("notifications.types.budget")},{key:"bill_reminder",label:t("notifications.types.bills")},{key:"anomaly_detected",label:t("notifications.types.anomalies")},{key:"goal_milestone",label:t("notifications.types.goals")},{key:"savings_tip",label:t("notifications.types.savings")},{key:"burn_rate_warning",label:t("notifications.types.burnRate")}].map(n=>{const p=c(n.key),h=(p==null?void 0:p.enabled)??!0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:n.label}),e.jsx("button",{onClick:()=>l(n.key,!h),className:u("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",h?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:u("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",h?"translate-x-6":"translate-x-1")})})]},n.key)})})]}),e.jsxs(D,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.quietHours.title")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("notifications.quietHours.description")})}),e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),t("notifications.quietHours.configure")]})]})]})]})}const _t={default:"appearance.themes.default","catppuccin-latte":"appearance.themes.catppuccinLatte","catppuccin-frappe":"appearance.themes.catppuccinFrappe","catppuccin-macchiato":"appearance.themes.catppuccinMacchiato","catppuccin-mocha":"appearance.themes.catppuccinMocha",dracula:"appearance.themes.dracula","dracula-light":"appearance.themes.draculaLight"},St={default:"Default","catppuccin-latte":"Catppuccin Latte","catppuccin-frappe":"Catppuccin Frappe","catppuccin-macchiato":"Catppuccin Macchiato","catppuccin-mocha":"Catppuccin Mocha",dracula:"Dracula","dracula-light":"Dracula Light"};function Pt(){const{t}=R("common"),{colorTheme:r,setColorTheme:a}=ie();return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:ve.map(i=>{const m=r===i.id,{base:f,surface:s,text:x,primary:y}=i.preview;return e.jsxs("button",{onClick:()=>a(i.id),className:u("relative flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all",m?"border-primary-500 ring-2 ring-primary-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsx("div",{className:"w-full aspect-[4/3] rounded-lg overflow-hidden border border-black/10",style:{backgroundColor:f},children:e.jsxs("div",{className:"p-2 h-full flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:y}}),e.jsx("div",{className:"h-1.5 rounded-full flex-1",style:{backgroundColor:x,opacity:.3}})]}),e.jsx("div",{className:"flex-1 rounded",style:{backgroundColor:s},children:e.jsxs("div",{className:"p-1.5 flex flex-col gap-1",children:[e.jsx("div",{className:"h-1 rounded-full w-3/4",style:{backgroundColor:x,opacity:.5}}),e.jsx("div",{className:"h-1 rounded-full w-1/2",style:{backgroundColor:x,opacity:.3}}),e.jsx("div",{className:"h-1.5 rounded-full w-2/5 mt-0.5",style:{backgroundColor:y}})]})})]})}),e.jsx("span",{className:u("text-xs font-medium truncate w-full text-center",m?"text-primary-700 dark:text-primary-300":"text-gray-600 dark:text-gray-400"),children:t(_t[i.id],St[i.id])}),m&&e.jsx("div",{className:"absolute top-1.5 right-1.5 w-5 h-5 rounded-full bg-primary-500 flex items-center justify-center",children:e.jsx(Y,{className:"w-3 h-3 text-white"})})]},i.id)})})}function Tt(){const{t}=R("common"),{theme:r,setTheme:a,accentColor:i,setAccentColor:m,colorTheme:f,tier:s,setTier:x}=ie(),y=[{id:"light",icon:Ne,label:t("appearance.light","Light")},{id:"dark",icon:Ce,label:t("appearance.dark","Dark")},{id:"system",icon:Ye,label:t("appearance.system","System")}],v=[{id:"pro",icon:Ve,label:t("appearance.pro","Pro"),desc:t("appearance.proDesc","Full access, all items visible")},{id:"lite",icon:Ue,label:t("appearance.lite","Lite"),desc:t("appearance.liteDesc","Simplified view, fewer items per page")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.themeMode","Theme Mode")}),f!=="default"?e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:t("appearance.themeControlled","Controlled by theme")}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:y.map(({id:l,icon:j,label:c})=>e.jsxs("button",{onClick:()=>a(l),className:u("flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all",r===l?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsx(j,{className:u("w-5 h-5",r===l?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400")}),e.jsx("span",{className:u("text-xs font-medium",r===l?"text-primary-700 dark:text-primary-300":"text-gray-600 dark:text-gray-400"),children:c})]},l))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.colorTheme","Color Theme")}),e.jsx(Pt,{})]}),f==="default"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.accentColor","Accent Color")}),e.jsx("div",{className:"flex flex-wrap gap-3",children:we.map(l=>e.jsxs("button",{onClick:()=>m(l.id),className:"group flex flex-col items-center gap-1.5",title:l.label,children:[e.jsx("div",{className:u("w-10 h-10 rounded-full transition-all ring-offset-2 ring-offset-white dark:ring-offset-gray-900",i===l.id?"ring-2 ring-gray-900 dark:ring-white scale-110":"ring-1 ring-gray-200 dark:ring-gray-700 group-hover:scale-105"),style:{backgroundColor:l.preview}}),e.jsx("span",{className:u("text-[10px] font-medium",i===l.id?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-500"),children:l.label})]},l.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.displayMode","Display Mode")}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:v.map(({id:l,icon:j,label:c,desc:o})=>e.jsxs("button",{onClick:()=>x(l),className:u("flex flex-col items-start gap-2 p-4 rounded-xl border-2 transition-all text-left",s===l?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:u("w-4 h-4",s===l?"text-primary-600 dark:text-primary-400":"text-gray-500")}),e.jsx("span",{className:u("text-sm font-semibold",s===l?"text-primary-700 dark:text-primary-300":"text-gray-700 dark:text-gray-300"),children:c})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:o})]},l))})]})]})}const Et=[{id:"appearance",labelKey:"settings.sections.appearance",icon:oe},{id:"general",labelKey:"settings.sections.general",icon:$},{id:"budget",labelKey:"settings.sections.budget",icon:le},{id:"categories",labelKey:"settings.sections.categories",icon:J},{id:"sources",labelKey:"settings.sections.sources",icon:Se},{id:"recurring",labelKey:"settings.sections.recurring",icon:Xe},{id:"notifications",labelKey:"settings.sections.notifications",icon:ne},{id:"crypto",labelKey:"settings.sections.crypto",icon:Pe},{id:"anomaly",labelKey:"anomaly.title",icon:X}];function Mt(){var _,E;const{t}=R("common"),r=z(),[a,i]=g.useState("appearance"),[m,f]=g.useState(!1),{data:s,isLoading:x}=I({queryKey:["settings"],queryFn:Te}),[y,v]=g.useState("JPY"),[l,j]=g.useState(25),[c,o]=g.useState(!1),[n,p]=g.useState(!0),[h,w]=g.useState(1e6);g.useEffect(()=>{s&&(v(s.currency),j(s.base_date),o(s.budget_carry_over),p(s.budget_email_alerts),w(s.large_transaction_threshold))},[s]),g.useEffect(()=>{if(s){const N=y!==s.currency||l!==s.base_date||c!==s.budget_carry_over||n!==s.budget_email_alerts||h!==s.large_transaction_threshold;f(N)}},[y,l,c,n,h,s]);const k=M({mutationFn:_e,onSuccess:()=>{r.invalidateQueries({queryKey:["settings"]}),r.invalidateQueries({queryKey:["dashboard-summary"]}),r.invalidateQueries({queryKey:["transactions"]}),r.invalidateQueries({queryKey:["analytics"]}),f(!1)},onError:N=>{console.error("Failed to save settings:",N)}}),T=()=>{k.mutate({currency:y,base_date:l,budget_carry_over:c,budget_email_alerts:n,large_transaction_threshold:h})};if(x)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(L,{size:"lg"})});const C={JPY:t("settings.currencyJPY"),USD:t("settings.currencyUSD"),VND:t("settings.currencyVND")};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-primary-600"}),t("settings.title")]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:t("settings.subtitle")})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto py-2 scrollbar-hide -mb-2",children:Et.map(N=>{const F=N.icon,W=a===N.id;return e.jsxs("button",{onClick:()=>i(N.id),className:u("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",W?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(F,{className:"w-3.5 h-3.5"}),t(N.labelKey)]},N.id)})})})})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx("div",{className:u("space-y-4",a!=="appearance"&&"hidden"),children:e.jsx(V,{icon:oe,title:t("appearance.title","Appearance"),description:t("appearance.subtitle","Theme, colors, and display preferences"),children:e.jsx(Tt,{})})}),e.jsx("div",{className:u("space-y-4",a!=="general"&&"hidden"),children:e.jsx(V,{icon:$,title:t("settings.general"),description:"Currency and basic preferences",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{label:t("settings.currency"),value:y,onChange:N=>v(N.target.value),options:[{value:"JPY",label:C.JPY},{value:"USD",label:C.USD},{value:"VND",label:C.VND}]}),e.jsx(q,{type:"number",label:t("settings.payday"),value:l,onChange:N=>j(parseInt(N.target.value,10)),min:1,max:31}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 -mt-2",children:t("settings.paydayDescription")})]})})}),e.jsx("div",{className:u("space-y-4",a!=="budget"&&"hidden"),children:e.jsx(V,{icon:le,title:t("settings.budgetSettings"),description:"Budget behavior and alerts",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{label:t("settings.budgetCarryOver"),description:t("settings.budgetCarryOverDescription"),checked:c,onChange:o}),e.jsx(ae,{label:t("settings.budgetEmailAlerts"),description:t("settings.budgetEmailAlertsDescription"),checked:n,onChange:p}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block mb-2",children:t("settings.largeTransactionThreshold")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t("settings.largeTransactionThresholdDescription")}),e.jsx(q,{type:"number",value:h,onChange:N=>w(parseInt(N.target.value,10)||0),min:0,step:1e5}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:t("settings.largeTransactionThresholdHint")})]})]})})}),e.jsx("div",{className:u("space-y-4",a!=="categories"&&"hidden"),children:e.jsx(ft,{})}),e.jsx("div",{className:u("space-y-4",a!=="sources"&&"hidden"),children:e.jsxs(Z,{title:t("settings.paymentSourceManagement"),badge:((_=s==null?void 0:s.sources)==null?void 0:_.length)||0,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:((E=s==null?void 0:s.sources)==null?void 0:E.map((N,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:N}),e.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:t("settings.delete")})]},F)))||e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noSources")})}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",children:t("settings.addSource")})})]})}),e.jsx("div",{className:u("space-y-4",a!=="recurring"&&"hidden"),children:e.jsx(Ie,{})}),e.jsx("div",{className:u("space-y-4",a!=="notifications"&&"hidden"),children:e.jsx(wt,{})}),e.jsx("div",{className:u("space-y-4",a!=="crypto"&&"hidden"),children:e.jsx(jt,{})}),e.jsx("div",{className:u("space-y-4",a!=="anomaly"&&"hidden"),children:e.jsx(kt,{})}),e.jsx(xt,{})]}),m&&typeof document<"u"&&G.createPortal(e.jsx("div",{className:"fixed bottom-20 left-0 right-0 p-4 bg-white/90 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-gray-700 z-40",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(S,{onClick:T,disabled:k.isPending,className:"w-full",size:"lg",children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"sm",className:"mr-2"}),t("saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),t("settings.saveSettings")]})})})}),document.body)]})}function V({icon:t,title:r,description:a,children:i,className:m}){return e.jsxs(D,{className:u("",m),children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:e.jsx(t,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r}),a&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]})]}),i]})}function ae({label:t,description:r,checked:a,onChange:i}){return e.jsxs("div",{className:"flex items-start justify-between py-1",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block",children:t}),r&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:r})]}),e.jsx("button",{onClick:()=>i(!a),className:u("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",a?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:u("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",a?"translate-x-6":"translate-x-1")})})]})}const $t=Ee("/settings")({component:Mt});export{$t as Route};
