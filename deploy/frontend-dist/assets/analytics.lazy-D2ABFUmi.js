import{j as t,u as e,k as n,m as s,c as r,l as i}from"./vendor-tanstack-C97-WeYN.js";import{r as a,R as o}from"./vendor-react-Bx4JnVfy.js";import{l as c,g as l,N as d,M as u,c as h,e as m,n as f,C as g,L as p,O as x,a as y,B as v,m as b,P as j,H as w}from"./index-BcaLFQys.js";import{u as k}from"./vendor-i18n-BrrOrGm_.js";import{R as _,C as S,a as N,X as E,Y as M,T as C,L as T,B as D,b as A,d as I,e as O,f as P,g as F,h as B}from"./vendor-recharts-Wt1h5c6F.js";import{a9 as K,T as L,w as z}from"./vendor-icons-DsCueGb8.js";import{e as $,s as V,f as H,g as R,h as q}from"./vendor-date-BkGg5e1q.js";function Y(t,e){if(0===t)return"";const n=Math.abs(t);return"VND"===e?n>=1e6?`${(t/1e6).toFixed(1)}M`:n>=1e3?`${(t/1e3).toFixed(0)}K`:t.toString():"JPY"===e?n>=1e4?`${(t/1e4).toFixed(1)}ä¸‡`:n>=1e3?`${(t/1e3).toFixed(0)}K`:t.toString():n>=1e6?`${(t/1e6).toFixed(1)}M`:n>=1e3?`${(t/1e3).toFixed(0)}K`:t.toString()}function U({data:e}){const{currency:n}=c(),{data:s}=l(),{t:r}=k("common"),{resolvedTheme:i}=d(),a="dark"===i,o=a?"#45475a":"#E5E7EB",h=a?"#a6adc8":"#6B7280",m=a?"#1e1e2e":"#fff",f=a?"#45475a":"#E5E7EB",g=a?"#cdd6f4":"#374151",p=e.every(t=>0===t.expenses),x=e.map(t=>({...t,net:t.income-t.expenses}));return t.jsx(_,{width:"100%",height:"100%",children:t.jsxs(S,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(N,{strokeDasharray:"3 3",stroke:o}),t.jsx(E,{dataKey:"month",stroke:h,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),t.jsx(M,{stroke:h,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:t=>u(t,n,(null==s?void 0:s.rates)||{},!1)}),t.jsx(C,{contentStyle:{backgroundColor:m,border:`1px solid ${f}`,borderRadius:"8px",fontSize:"14px",color:g},formatter:(t,e)=>[u(t,n,(null==s?void 0:s.rates)||{},!1),e],labelFormatter:t=>t}),t.jsx(T,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:g}}),t.jsx(D,{dataKey:"income",fill:"#4CAF50",name:r("chart.income"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:t.jsx(A,{dataKey:"income",position:"top",formatter:t=>Y(t,n),style:{fontSize:"10px",fill:"#4CAF50",fontWeight:500}})}),t.jsxs(D,{dataKey:"expenses",fill:"#F44336",name:r("chart.expense"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:200,animationDuration:800,animationEasing:"ease-out",children:[p?x.map((e,n)=>t.jsx(I,{fill:"#F4433633"},`cell-${n}`)):x.map((e,n)=>t.jsx(I,{fill:0===e.expenses?"#F4433633":"#F44336"},`cell-${n}`)),t.jsx(A,{dataKey:"expenses",position:"top",formatter:t=>Y(t,n),style:{fontSize:"10px",fill:"#F44336",fontWeight:500}})]}),t.jsx(O,{type:"monotone",dataKey:"net",name:r("chart.net"),stroke:"#2196F3",strokeWidth:2,dot:{fill:"#2196F3",strokeWidth:2,r:4},activeDot:{r:6},isAnimationActive:!0,animationBegin:400,animationDuration:1e3,animationEasing:"ease-out"})]})})}const W=["#4CAF50","#2196F3","#FF9800","#9C27B0","#F44336","#00BCD4","#FFEB3B","#795548","#607D8B"];function X({changePercent:e}){if(null==e)return null;const n=e>0,s=Math.abs(e)>=20;return 0===e?t.jsxs("span",{className:"inline-flex items-center gap-0.5 text-xs text-gray-500 dark:text-gray-400",children:[t.jsx(K,{className:"w-3 h-3"}),t.jsx("span",{children:"0%"})]}):t.jsxs("span",{className:h("inline-flex items-center gap-0.5 text-xs font-medium",n?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400",s&&"font-bold"),children:[n?t.jsx(L,{className:"w-3 h-3"}):t.jsx(z,{className:"w-3 h-3"}),t.jsxs("span",{children:[n?"+":"",e.toFixed(0),"%"]})]})}function G({data:e}){const{t:n}=k("common"),{currency:s}=c(),{data:r}=l(),{resolvedTheme:i}=d(),o="dark"===i,[m,f]=a.useState(!1),g=o?"#1e1e2e":"#fff",p=o?"#45475a":"#E5E7EB",x=o?"#cdd6f4":"#374151",y=e.reduce((t,e)=>t+e.amount,0),v=[...e].sort((t,e)=>e.amount-t.amount),b=(()=>{if(v.length<=7||m)return v.map((t,e)=>({...t,percentage:y>0?t.amount/y*100:0,color:W[e%W.length]}));const t=v.slice(0,7),e=v.slice(7),s=e.reduce((t,e)=>t+e.amount,0),r=t.map((t,e)=>({...t,percentage:y>0?t.amount/y*100:0,color:W[e%W.length]}));return e.length>0&&r.push({category:`${n("analytics.otherCategories")} (${e.length})`,amount:s,percentage:y>0?s/y*100:0,color:"#9E9E9E",isOther:!0,otherCount:e.length}),r})(),j=v.length>7,w=Math.max(200,32*b.length);return t.jsxs("div",{className:"w-full",children:[t.jsx(_,{width:"100%",height:w,children:t.jsxs(P,{data:b,layout:"vertical",margin:{top:5,right:60,left:0,bottom:5},children:[t.jsx(E,{type:"number",hide:!0,domain:[0,100]}),t.jsx(M,{type:"category",dataKey:"category",width:100,tick:{fill:x,fontSize:12},axisLine:!1,tickLine:!1}),t.jsx(C,{contentStyle:{backgroundColor:g,border:`1px solid ${p}`,borderRadius:"8px",fontSize:"14px",color:x},content:({active:e,payload:i})=>{if(!e||!(null==i?void 0:i[0]))return null;const a=i[0].payload,o=null!==a.change_percent&&void 0!==a.change_percent;return t.jsxs("div",{className:"p-3 rounded-lg shadow-lg",style:{backgroundColor:g,border:`1px solid ${p}`},children:[t.jsx("p",{className:"font-medium mb-1",children:a.category}),t.jsx("p",{className:"text-sm",children:u(a.amount,s,(null==r?void 0:r.rates)||{},!1)}),o&&t.jsxs("div",{className:"mt-1 pt-1 border-t border-gray-200 dark:border-gray-600",children:[t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n("analytics.vsPrevious"),": "]}),t.jsx(X,{changePercent:a.change_percent})]})]})}}),t.jsxs(D,{dataKey:"percentage",radius:[0,4,4,0],maxBarSize:24,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:[b.map((e,n)=>t.jsx(I,{fill:e.color},`cell-${n}`)),t.jsx(A,{dataKey:"percentage",content:e=>{const{x:n,y:s,width:r,height:i,value:a}=e;return t.jsxs("text",{x:n+r+8,y:s+i/2,fill:x,textAnchor:"start",dominantBaseline:"middle",fontSize:12,children:[a.toFixed(1),"%"]})}})]})]})}),j&&t.jsx("button",{onClick:()=>f(!m),className:h("w-full mt-2 py-2 px-4 text-sm font-medium rounded-lg transition-colors","text-primary-600 dark:text-primary-400","hover:bg-primary-50 dark:hover:bg-primary-900/20"),children:m?n("analytics.showLessCategories"):n("analytics.showAllCategories",{count:v.length})})]})}const J={income:"#4CAF50",expense:"#F44336",net:"#2196F3"};function Q({data:e,dataKey:n}){const{currency:s}=c(),{data:r}=l(),{isPrivacyMode:i}=m(),{t:a}=k("common"),{resolvedTheme:o}=d(),u="dark"===o,h=u?"#45475a":"#E5E7EB",g=u?"#a6adc8":"#6B7280",p=u?"#1e1e2e":"#fff",x=u?"#45475a":"#E5E7EB",y=u?"#cdd6f4":"#374151",v={income:a("chart.income"),expense:a("chart.expense"),net:a("chart.net")};return t.jsx(_,{width:"100%",height:"100%",children:t.jsxs(F,{data:e,margin:{top:5,right:30,left:20,bottom:5},children:[t.jsx(N,{strokeDasharray:"3 3",stroke:h}),t.jsx(E,{dataKey:"month",stroke:g,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),t.jsx(M,{stroke:g,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:t=>f(t,s,(null==r?void 0:r.rates)||{},!1,i)}),t.jsx(C,{contentStyle:{backgroundColor:p,border:`1px solid ${x}`,borderRadius:"8px",fontSize:"14px",color:y},formatter:t=>[f(t,s,(null==r?void 0:r.rates)||{},!1,i),v[n]]}),t.jsx(T,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:y}}),t.jsx(O,{type:"monotone",dataKey:n,stroke:J[n],strokeWidth:2,dot:{fill:J[n],r:4},activeDot:{r:6},name:v[n],isAnimationActive:!0,animationBegin:0,animationDuration:1200,animationEasing:"ease-out"})]})})}function Z({data:e,savingsGoal:n}){const{t:s}=k("common"),{currency:r}=c(),{data:i}=l(),{resolvedTheme:a}=d(),o="dark"===a,m=o?"#1e1e2e":"#fff",f=o?"#45475a":"#E5E7EB",g=o?"#cdd6f4":"#374151",p=e.length>0?e[e.length-1]:null,x=(null==p?void 0:p.net)||0,y=e.length>1?e.slice(0,-1):e,v=y.length>0?y.reduce((t,e)=>t+e.net,0)/y.length:x,b=[{name:s("analytics.thisMonth"),value:x,color:x>=0?"#4CAF50":"#F44336"},{name:s("analytics.average"),value:v,color:"#9E9E9E"}],j=0!==v?(x-v)/Math.abs(v)*100:0,w=j>=0,S=n&&n>0?Math.min(x/n*100,100):null;return 1===e.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-8",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:s("analytics.netCashFlow")}),t.jsx("p",{className:h("text-3xl font-bold",x>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:u(x,r,(null==i?void 0:i.rates)||{},!1)}),x>=0&&t.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:s("analytics.positiveCashFlow")}),n&&n>0&&t.jsxs("div",{className:"mt-4 w-full max-w-xs",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[t.jsx("span",{children:s("analytics.savingsGoal")}),t.jsxs("span",{children:[(S??0).toFixed(0),"%"]})]}),t.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:h("h-full rounded-full transition-all duration-700 ease-out",S&&S>=100?"bg-green-500":"bg-primary-500"),style:{width:`${S||0}%`}})}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:[u(n,r,(null==i?void 0:i.rates)||{},!1)," ",s("analytics.target")]})]})]}):t.jsxs("div",{className:"w-full h-full flex flex-col",children:[t.jsx("div",{className:"flex-1 min-h-[150px]",children:t.jsx(_,{width:"100%",height:"100%",children:t.jsxs(P,{data:b,layout:"vertical",margin:{top:10,right:60,left:10,bottom:10},children:[t.jsx(E,{type:"number",hide:!0}),t.jsx(M,{type:"category",dataKey:"name",width:80,tick:{fill:g,fontSize:12},axisLine:!1,tickLine:!1}),t.jsx(C,{contentStyle:{backgroundColor:m,border:`1px solid ${f}`,borderRadius:"8px",fontSize:"14px",color:g},formatter:t=>[u(t,r,(null==i?void 0:i.rates)||{},!1),s("analytics.netCashFlow")]}),n&&n>0&&t.jsx(B,{x:n,stroke:"#9C27B0",strokeDasharray:"3 3",label:{value:s("analytics.goal"),position:"top",fill:"#9C27B0",fontSize:10}}),t.jsx(D,{dataKey:"value",radius:[0,4,4,0],maxBarSize:32,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:b.map((e,n)=>t.jsx(I,{fill:e.color},`cell-${n}`))})]})})}),t.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 border-t border-gray-100 dark:border-gray-800",children:[t.jsxs("span",{className:h("text-sm font-medium",w?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[w?"â–²":"â–¼"," ",Math.abs(j).toFixed(1),"%"]}),t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:s("analytics.vsAverage")})]}),n&&n>0&&t.jsxs("div",{className:"px-4 pb-2",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[t.jsx("span",{children:s("analytics.savingsGoal")}),t.jsxs("span",{children:[u(x,r,(null==i?void 0:i.rates)||{},!1)," / ",u(n,r,(null==i?void 0:i.rates)||{},!1)]})]}),t.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:h("h-full rounded-full transition-all duration-700 ease-out",S&&S>=100?"bg-green-500":"bg-primary-500"),style:{width:`${S||0}%`}})})]})]})}const tt={toVector:(t,e)=>(void 0===t&&(t=e),Array.isArray(t)?t:[t,t]),add:(t,e)=>[t[0]+e[0],t[1]+e[1]],sub:(t,e)=>[t[0]-e[0],t[1]-e[1]],addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function et(t,e,n){return 0===e||Math.abs(e)===1/0?Math.pow(t,5*n):t*e*n/(e+n*t)}function nt(t,e,n,s=.15){return 0===s?function(t,e,n){return Math.max(e,Math.min(t,n))}(t,e,n):t<e?-et(e-t,n-e,s)+e:t>n?+et(t-n,n-e,s)+n:t}function st(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function rt(t,e,n){return(e=st(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function it(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,s)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?it(Object(n),!0).forEach(function(e){rt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const ot={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function ct(t){return t?t[0].toUpperCase()+t.slice(1):""}const lt=["enter","leave"];function dt(t,e="",n=!1){const s=ot[t],r=s&&s[e]||e;return"on"+ct(t)+ct(r)+(function(t=!1,e){return t&&!lt.includes(e)}(n,r)?"Capture":"")}const ut=["gotpointercapture","lostpointercapture"];function ht(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const s=ut.includes(e)?"capturecapture":"capture",r=!!~e.indexOf(s);return r&&(e=e.replace("capture","")),{device:e,capture:r,passive:n}}function mt(t){return"touches"in t}function ft(t){return mt(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function gt(t){return mt(t)?function(t){return"touchend"===t.type||"touchcancel"===t.type?t.changedTouches:t.targetTouches}(t)[0]:t}function pt(t,e){try{const n=e.clientX-t.clientX,s=e.clientY-t.clientY,r=(e.clientX+t.clientX)/2,i=(e.clientY+t.clientY)/2,a=Math.hypot(n,s),o=-180*Math.atan2(n,s)/Math.PI;return{angle:o,distance:a,origin:[r,i]}}catch(n){}return null}function xt(t){return function(t){return Array.from(t.touches).filter(e=>{var n,s;return e.target===t.currentTarget||(null===(n=t.currentTarget)||void 0===n||null===(s=n.contains)||void 0===s?void 0:s.call(n,e.target))})}(t).map(t=>t.identifier)}function yt(t,e){const[n,s]=Array.from(t.touches).filter(t=>e.includes(t.identifier));return pt(n,s)}function vt(t){const e=gt(t);return mt(t)?e.identifier:e.pointerId}function bt(t){const e=gt(t);return[e.clientX,e.clientY]}function jt(t){let{deltaX:e,deltaY:n,deltaMode:s}=t;return 1===s?(e*=40,n*=40):2===s&&(e*=800,n*=800),[e,n]}function wt(t,...e){return"function"==typeof t?t(...e):t}function kt(){}function _t(...t){return 0===t.length?kt:1===t.length?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function St(t,e){return Object.assign({},e,t||{})}let Nt=class{constructor(t,e,n){this.ctrl=t,this.args=e,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:e,ingKey:n,args:s}=this;e[n]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=s,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const e=this.state,n=this.config;e._active||(this.reset(),this.computeInitial(),e._active=!0,e.target=t.target,e.currentTarget=t.currentTarget,e.lastOffset=n.from?wt(n.from,e):e.offset,e.offset=e.lastOffset,e.startTime=e.timeStamp=t.timeStamp)}computeValues(t){const e=this.state;e._values=t,e.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:e,config:n,shared:s}=this;e.args=this.args;let r=0;if(t&&(e.event=t,n.preventDefault&&t.cancelable&&e.event.preventDefault(),e.type=t.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,function(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:s,metaKey:r,ctrlKey:i}=t;Object.assign(e,{shiftKey:n,altKey:s,metaKey:r,ctrlKey:i})}return e}(t)),s.down=s.pressed=s.buttons%2==1||s.touches>0,r=t.timeStamp-e.timeStamp,e.timeStamp=t.timeStamp,e.elapsedTime=e.timeStamp-e.startTime),e._active){const t=e._delta.map(Math.abs);tt.addTo(e._distance,t)}this.axisIntent&&this.axisIntent(t);const[i,a]=e._movement,[o,c]=n.threshold,{_step:l,values:d}=e;if(n.hasCustomTransform?(!1===l[0]&&(l[0]=Math.abs(i)>=o&&d[0]),!1===l[1]&&(l[1]=Math.abs(a)>=c&&d[1])):(!1===l[0]&&(l[0]=Math.abs(i)>=o&&Math.sign(i)*o),!1===l[1]&&(l[1]=Math.abs(a)>=c&&Math.sign(a)*c)),e.intentional=!1!==l[0]||!1!==l[1],!e.intentional)return;const u=[0,0];if(n.hasCustomTransform){const[t,e]=d;u[0]=!1!==l[0]?t-l[0]:0,u[1]=!1!==l[1]?e-l[1]:0}else u[0]=!1!==l[0]?i-l[0]:0,u[1]=!1!==l[1]?a-l[1]:0;this.restrictToAxis&&!e._blocked&&this.restrictToAxis(u);const h=e.offset,m=e._active&&!e._blocked||e.active;m&&(e.first=e._active&&!e.active,e.last=!e._active&&e.active,e.active=s[this.ingKey]=e._active,t&&(e.first&&("bounds"in n&&(e._bounds=wt(n.bounds,e)),this.setup&&this.setup()),e.movement=u,this.computeOffset()));const[f,g]=e.offset,[[p,x],[y,v]]=e._bounds;e.overflow=[f<p?-1:f>x?1:0,g<y?-1:g>v?1:0],e._movementBound[0]=!!e.overflow[0]&&(!1===e._movementBound[0]?e._movement[0]:e._movementBound[0]),e._movementBound[1]=!!e.overflow[1]&&(!1===e._movementBound[1]?e._movement[1]:e._movementBound[1]);const b=e._active&&n.rubberband||[0,0];if(e.offset=function(t,[e,n],[s,r]){const[[i,a],[o,c]]=t;return[nt(e,i,a,s),nt(n,o,c,r)]}(e._bounds,e.offset,b),e.delta=tt.sub(e.offset,h),this.computeMovement(),m&&(!e.last||r>32)){e.delta=tt.sub(e.offset,h);const t=e.delta.map(Math.abs);tt.addTo(e.distance,t),e.direction=e.delta.map(Math.sign),e._direction=e._delta.map(Math.sign),!e.first&&r>0&&(e.velocity=[t[0]/r,t[1]/r],e.timeDelta=r)}}emit(){const t=this.state,e=this.shared,n=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!n.triggerAllEvents)return;const s=this.handler(at(at(at({},e),t),{},{[this.aliasKey]:t.values}));void 0!==s&&(t.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};class Et extends Nt{constructor(...t){super(...t),rt(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=tt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=tt.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const e=this.state,n=this.config;if(!e.axis&&t){const s="object"==typeof n.axisThreshold?n.axisThreshold[ft(t)]:n.axisThreshold;e.axis=function([t,e],n){const s=Math.abs(t),r=Math.abs(e);return s>r&&s>n?"x":r>s&&r>n?"y":void 0}(e._movement,s)}e._blocked=(n.lockDirection||!!n.axis)&&!e.axis||!!n.axis&&n.axis!==e.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0}}}const Mt=t=>t,Ct={enabled:(t=!0)=>t,eventOptions:(t,e,n)=>at(at({},n.shared.eventOptions),t),preventDefault:(t=!1)=>t,triggerAllEvents:(t=!1)=>t,rubberband(t=0){switch(t){case!0:return[.15,.15];case!1:return[0,0];default:return tt.toVector(t)}},from:t=>"function"==typeof t?t:null!=t?tt.toVector(t):void 0,transform(t,e,n){const s=t||n.shared.transform;return this.hasCustomTransform=!!s,s||Mt},threshold:t=>tt.toVector(t,0)},Tt=at(at({},Ct),{},{axis(t,e,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(t=0)=>t,bounds(t={}){if("function"==typeof t)return e=>Tt.bounds(t(e));if("current"in t)return()=>t.current;if("function"==typeof HTMLElement&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:s=-1/0,bottom:r=1/0}=t;return[[e,n],[s,r]]}}),Dt={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};const At="undefined"!=typeof window&&window.document&&window.document.createElement;function It(){return At&&"ontouchstart"in window}const Ot={isBrowser:At,gesture:function(){try{return"constructor"in GestureEvent}catch(t){return!1}}(),touch:It(),touchscreen:It()||At&&window.navigator.maxTouchPoints>1,pointer:At&&"onpointerdown"in window,pointerLock:At&&"exitPointerLock"in window.document},Pt={mouse:0,touch:0,pen:8},Ft=at(at({},Tt),{},{device(t,e,{pointer:{touch:n=!1,lock:s=!1,mouse:r=!1}={}}){return this.pointerLock=s&&Ot.pointerLock,Ot.touch&&n?"touch":this.pointerLock?"mouse":Ot.pointer&&!r?"pointer":Ot.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&t?250:void 0,Ot.touchscreen&&!1!==n)return t||(void 0!==n?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:s=1,keys:r=!0}={}}){return this.pointerButtons=s,this.keys=r,!this.pointerLock&&"pointer"===this.device&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:s=3,axis:r}){const i=tt.toVector(t,n?s:r?1:0);return this.filterTaps=n,this.tapsThreshold=s,i},swipe({velocity:t=.5,distance:e=50,duration:n=250}={}){return{velocity:this.transform(tt.toVector(t)),distance:this.transform(tt.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return 180;case!1:return 0;default:return t}},axisThreshold:t=>t?at(at({},Pt),t):Pt,keyboardDisplacement:(t=10)=>t});function Bt(t){const[e,n]=t.overflow,[s,r]=t._delta,[i,a]=t._direction;(e<0&&s>0&&i<0||e>0&&s<0&&i>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&r>0&&a<0||n>0&&r<0&&a>0)&&(t._movement[1]=t._movementBound[1])}const Kt=at(at({},Ct),{},{device(t,e,{shared:n,pointer:{touch:s=!1}={}}){if(n.target&&!Ot.touch&&Ot.gesture)return"gesture";if(Ot.touch&&s)return"touch";if(Ot.touchscreen){if(Ot.pointer)return"pointer";if(Ot.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:s={}}){const r=t=>{const e=St(wt(n,t),{min:-1/0,max:1/0});return[e.min,e.max]},i=t=>{const e=St(wt(s,t),{min:-1/0,max:1/0});return[e.min,e.max]};return"function"!=typeof n&&"function"!=typeof s?[r(),i()]:t=>[r(t),i(t)]},threshold(t,e,n){this.lockDirection="lock"===n.axis;return tt.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey:t=>void 0===t?"ctrlKey":t,pinchOnWheel:(t=!0)=>t});const Lt=at(at({},Tt),{},{mouseOnly:(t=!0)=>t});const zt=Tt;const $t=Tt;const Vt=at(at({},Tt),{},{mouseOnly:(t=!0)=>t}),Ht=new Map,Rt=new Map;function qt(t){Ht.set(t.key,t.engine),Rt.set(t.key,t.resolver)}const Yt={key:"drag",engine:class extends Et{constructor(...t){super(...t),rt(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const e=t._bounds.getBoundingClientRect(),n=t.currentTarget.getBoundingClientRect(),s={left:e.left-n.left+t.offset[0],right:e.right-n.right+t.offset[0],top:e.top-n.top+t.offset[1],bottom:e.bottom-n.bottom+t.offset[1]};t._bounds=Tt.bounds(s)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const e=this.config,n=this.state;if(null!=t.buttons&&(Array.isArray(e.pointerButtons)?!e.pointerButtons.includes(t.buttons):-1!==e.pointerButtons&&e.pointerButtons!==t.buttons))return;const s=this.ctrl.setEventIds(t);e.pointerCapture&&t.target.setPointerCapture(t.pointerId),s&&s.size>1&&n._pointerActive||(this.start(t),this.setupPointer(t),n._pointerId=vt(t),n._pointerActive=!0,this.computeValues(bt(t)),this.computeInitial(),e.preventScrollAxis&&"mouse"!==ft(t)?(n._active=!1,this.setupScrollPrevention(t)):e.delay>0?(this.setupDelayTrigger(t),e.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const e=this.state;e._active=!0,e._preventScroll=!0,e._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const e=this.state,n=this.config;if(!e._pointerActive)return;const s=vt(t);if(void 0!==e._pointerId&&s!==e._pointerId)return;const r=bt(t);return document.pointerLockElement===t.target?e._delta=[t.movementX,t.movementY]:(e._delta=tt.sub(r,e._values),this.computeValues(r)),tt.addTo(e._movement,e._delta),this.compute(t),e._delayed&&e.intentional?(this.timeoutStore.remove("dragDelay"),e.active=!1,void this.startPointerDrag(t)):n.preventScrollAxis&&!e._preventScroll?e.axis?e.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(e._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(t)):void 0:void this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch(a){}const e=this.state,n=this.config;if(!e._active||!e._pointerActive)return;const s=vt(t);if(void 0!==e._pointerId&&s!==e._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[r,i]=e._distance;if(e.tap=r<=n.tapsThreshold&&i<=n.tapsThreshold,e.tap&&n.filterTaps)e._force=!0;else{const[t,s]=e._delta,[r,i]=e._movement,[a,o]=n.swipe.velocity,[c,l]=n.swipe.distance,d=n.swipe.duration;if(e.elapsedTime<d){const n=Math.abs(t/e.timeDelta),d=Math.abs(s/e.timeDelta);n>a&&Math.abs(r)>c&&(e.swipe[0]=Math.sign(t)),d>o&&Math.abs(i)>l&&(e.swipe[1]=Math.sign(s))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const e=this.config,n=e.device;e.pointerLock&&t.currentTarget.requestPointerLock(),e.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,function(t){"persist"in t&&"function"==typeof t.persist&&t.persist()}(t);const e=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",e),this.eventStore.add(this.sharedConfig.window,"touch","cancel",e),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const e=Dt[t.key];if(e){const n=this.state,s=t.shiftKey?10:t.altKey?.1:1;this.start(t),n._delta=e(this.config.keyboardDisplacement,s),n._keyboardActive=!0,tt.addTo(n._movement,n._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Dt&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const e=this.config.device;t(e,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(e,"change",this.pointerMove.bind(this)),t(e,"end",this.pointerUp.bind(this)),t(e,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:Ft},Ut={key:"hover",engine:class extends Et{constructor(...t){super(...t),rt(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.start(t),this.computeValues(bt(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&"mouse"!==t.pointerType)return;const e=this.state;if(!e._active)return;e._active=!1;const n=bt(t);e._movement=e._delta=tt.sub(n,e._values),this.computeValues(n),this.compute(t),e.delta=e.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}},resolver:Vt},Wt={key:"move",engine:class extends Et{constructor(...t){super(...t),rt(this,"ingKey","moving")}move(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues(bt(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const e=bt(t),n=this.state;n._delta=tt.sub(e,n._values),tt.addTo(n._movement,n._delta),this.computeValues(e),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}},resolver:Lt},Xt={key:"pinch",engine:class extends Nt{constructor(...t){super(...t),rt(this,"ingKey","pinching"),rt(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:e,lastOffset:n}=this.state;this.state.offset="wheel"===t?tt.add(e,n):[(1+e[0])*n[0],e[1]+n[1]]}computeMovement(){const{offset:t,lastOffset:e}=this.state;this.state.movement=[t[0]/e[0],t[1]-e[1]]}axisIntent(){const t=this.state,[e,n]=t._movement;if(!t.axis){const s=30*Math.abs(e)-Math.abs(n);s<0?t.axis="angle":s>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&("scale"===this.state.axis?t[1]=0:"angle"===this.state.axis&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const e=this.state,n=this.ctrl.touchIds;if(e._active&&e._touchIds.every(t=>n.has(t)))return;if(n.size<2)return;this.start(t),e._touchIds=Array.from(n).slice(0,2);const s=yt(t,e._touchIds);s&&this.pinchStart(t,s)}pointerStart(t){if(null!=t.buttons&&t.buttons%2!=1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const e=this.state,n=e._pointerEvents,s=this.ctrl.pointerIds;if(e._active&&Array.from(n.keys()).every(t=>s.has(t)))return;if(n.size<2&&n.set(t.pointerId,t),e._pointerEvents.size<2)return;this.start(t);const r=pt(...Array.from(n.values()));r&&this.pinchStart(t,r)}pinchStart(t,e){this.state.origin=e.origin,this.computeValues([e.distance,e.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const e=yt(t,this.state._touchIds);e&&this.pinchMove(t,e)}pointerMove(t){const e=this.state._pointerEvents;if(e.has(t.pointerId)&&e.set(t.pointerId,t),!this.state._active)return;const n=pt(...Array.from(e.values()));n&&this.pinchMove(t,n)}pinchMove(t,e){const n=this.state,s=n._values[1],r=e.angle-s;let i=0;Math.abs(r)>270&&(i+=Math.sign(r)),this.computeValues([e.distance,e.angle-360*i]),n.origin=e.origin,n.turns=i,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const e=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch(n){}e._pointerEvents.has(t.pointerId)&&e._pointerEvents.delete(t.pointerId),e._active&&e._pointerEvents.size<2&&(e._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const e=this.state;e._active||(this.start(t),this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const e=this.state;this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY];const n=e._movement;e._movement=[t.scale-1,t.rotation],e._delta=tt.sub(e._movement,n),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const e=this.config.modifierKey;e&&!(Array.isArray(e)?e.find(e=>t[e]):t[e])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const e=this.state;e._delta=[-jt(t)[1]/100*e.offset[0],0],tt.addTo(e._movement,e._delta),Bt(e),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const e=this.config.device;e&&(t(e,"start",this[e+"Start"].bind(this)),t(e,"change",this[e+"Move"].bind(this)),t(e,"end",this[e+"End"].bind(this)),t(e,"cancel",this[e+"End"].bind(this)),t("lostPointerCapture","",this[e+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:Kt},Gt={key:"scroll",engine:class extends Et{constructor(...t){super(...t),rt(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const e=this.state,n=function(t){var e,n;const{scrollX:s,scrollY:r,scrollLeft:i,scrollTop:a}=t.currentTarget;return[null!==(e=null!=s?s:i)&&void 0!==e?e:0,null!==(n=null!=r?r:a)&&void 0!==n?n:0]}(t);e._delta=tt.sub(n,e._values),tt.addTo(e._movement,e._delta),this.computeValues(n),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}},resolver:zt},Jt={key:"wheel",engine:class extends Et{constructor(...t){super(...t),rt(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const e=this.state;e._delta=jt(t),tt.addTo(e._movement,e._delta),Bt(e),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}},resolver:$t};function Qt(t,e){if(null==t)return{};var n,s,r=function(t,e){if(null==t)return{};var n,s,r={},i=Object.keys(t);for(s=0;s<i.length;s++)n=i[s],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)n=i[s],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}const Zt={target(t){if(t)return()=>"current"in t?t.current:t},enabled:(t=!0)=>t,window:(t=(Ot.isBrowser?window:void 0))=>t,eventOptions:({passive:t=!0,capture:e=!1}={})=>({passive:t,capture:e}),transform:t=>t},te=["target","eventOptions","window","enabled","transform"];function ee(t={},e){const n={};for(const[s,r]of Object.entries(e))switch(typeof r){case"function":n[s]=r.call(n,t[s],s,t);break;case"object":n[s]=ee(t[s],r);break;case"boolean":r&&(n[s]=t[s])}return n}let ne=class{constructor(t,e){rt(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=e}add(t,e,n,s,r){const i=this._listeners,a=function(t,e=""){const n=ot[t];return t+(n&&n[e]||e)}(e,n),o=at(at({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),r);t.addEventListener(a,s,o);const c=()=>{t.removeEventListener(a,s,o),i.delete(c)};return i.add(c),c}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}};class se{constructor(){rt(this,"_timeouts",new Map)}add(t,e,n=140,...s){this.remove(t),this._timeouts.set(t,window.setTimeout(e,n,...s))}remove(t){const e=this._timeouts.get(t);e&&window.clearTimeout(e)}clean(){this._timeouts.forEach(t=>{window.clearTimeout(t)}),this._timeouts.clear()}}class re{constructor(t){rt(this,"gestures",new Set),rt(this,"_targetEventStore",new ne(this)),rt(this,"gestureEventStores",{}),rt(this,"gestureTimeoutStores",{}),rt(this,"handlers",{}),rt(this,"config",{}),rt(this,"pointerIds",new Set),rt(this,"touchIds",new Set),rt(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(t,e){e.drag&&ie(t,"drag");e.wheel&&ie(t,"wheel");e.scroll&&ie(t,"scroll");e.move&&ie(t,"move");e.pinch&&ie(t,"pinch");e.hover&&ie(t,"hover")}(this,t)}setEventIds(t){return mt(t)?(this.touchIds=new Set(xt(t)),this.touchIds):"pointerId"in t?("pointerup"===t.type||"pointercancel"===t.type?this.pointerIds.delete(t.pointerId):"pointerdown"===t.type&&this.pointerIds.add(t.pointerId),this.pointerIds):void 0}applyHandlers(t,e){this.handlers=t,this.nativeHandlers=e}applyConfig(t,e){this.config=function(t,e,n={}){const s=t,{target:r,eventOptions:i,window:a,enabled:o,transform:c}=s,l=Qt(s,te);if(n.shared=ee({target:r,eventOptions:i,window:a,enabled:o,transform:c},Zt),e){const t=Rt.get(e);n[e]=ee(at({shared:n.shared},l),t)}else for(const d in l){const t=Rt.get(d);t&&(n[d]=ee(at({shared:n.shared},l[d]),t))}return n}(t,e,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const e=this.config.shared,n={};let s;if(!e.target||(s=e.target(),s)){if(e.enabled){for(const e of this.gestures){const r=this.config[e],i=ae(n,r.eventOptions,!!s);if(r.enabled){new(Ht.get(e))(this,t,e).bind(i)}}const r=ae(n,e.eventOptions,!!s);for(const e in this.nativeHandlers)r(e,"",n=>this.nativeHandlers[e](at(at({},this.state.shared),{},{event:n,args:t})),void 0,!0)}for(const t in n)n[t]=_t(...n[t]);if(!s)return n;for(const t in n){const{device:e,capture:r,passive:i}=ht(t);this._targetEventStore.add(s,e,"",n[t],{capture:r,passive:i})}}}}function ie(t,e){t.gestures.add(e),t.gestureEventStores[e]=new ne(t,e),t.gestureTimeoutStores[e]=new se}const ae=(t,e,n)=>(s,r,i,a={},o=!1)=>{var c,l;const d=null!==(c=a.capture)&&void 0!==c?c:e.capture,u=null!==(l=a.passive)&&void 0!==l?l:e.passive;let h=o?s:dt(s,r,d);n&&u&&(h+="Passive"),t[h]=t[h]||[],t[h].push(i)},oe=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function ce(t,e,n,s,r,i){if(!t.has(n))return;if(!Ht.has(s))return;const a=n+"Start",o=n+"End";r[s]=t=>{let s;return t.first&&a in e&&e[a](t),n in e&&(s=e[n](t)),t.last&&o in e&&e[o](t),s},i[s]=i[s]||{}}function le(t,e){const[n,s,r]=function(t){const e={},n={},s=new Set;for(let r in t)oe.test(r)?(s.add(RegExp.lastMatch),n[r]=t[r]):e[r]=t[r];return[n,e,s]}(t),i={};return ce(r,n,"onDrag","drag",i,e),ce(r,n,"onWheel","wheel",i,e),ce(r,n,"onScroll","scroll",i,e),ce(r,n,"onPinch","pinch",i,e),ce(r,n,"onMove","move",i,e),ce(r,n,"onHover","hover",i,e),{handlers:i,config:e,nativeHandlers:s}}function de(t){return t.forEach(qt),function(t,e){const{handlers:n,nativeHandlers:s,config:r}=le(t,e||{});return function(t,e={},n,s){const r=o.useMemo(()=>new re(t),[]);if(r.applyHandlers(t,s),r.applyConfig(e,n),o.useEffect(r.effect.bind(r)),o.useEffect(()=>r.clean.bind(r),[]),void 0===e.target)return r.bind.bind(r)}(n,r,void 0,s)}}function ue({children:e,className:n="",minScale:s=1,maxScale:r=3}){const i=a.useRef(null),[o,c]=a.useState(1),[l,d]=a.useState({x:0,y:0}),u=a.useCallback(()=>{c(1),d({x:0,y:0})},[]);var h,m;return h={onPinch:({offset:[t],memo:e})=>{const n=Math.min(r,Math.max(s,t));return c(n),n<=1&&d({x:0,y:0}),e},onDrag:({offset:[t,e],pinching:n})=>{if(o>1&&!n){const n=100*(o-1)/2;d({x:Math.min(n,Math.max(-n,t)),y:Math.min(n,Math.max(-n,e))})}},onWheel:({delta:[,t],event:e})=>{e.preventDefault();const n=Math.min(r,Math.max(s,o-.01*t));c(n),n<=1&&d({x:0,y:0})}},m={target:i,pinch:{scaleBounds:{min:s,max:r}},drag:{filterTaps:!0},wheel:{preventDefault:!0}},de([Yt,Xt,Gt,Jt,Wt,Ut])(h,m||{}),t.jsxs("div",{className:`relative overflow-hidden touch-none ${n}`,children:[t.jsx("div",{ref:i,style:{transform:`scale(${o}) translate(${l.x}px, ${l.y}px)`,transformOrigin:"center center",transition:"transform 0.1s ease-out"},className:"w-full h-full",children:e}),o>1&&t.jsxs("button",{onClick:u,className:"absolute bottom-2 right-2 px-2 py-1 text-xs bg-gray-800/70 text-white rounded-md hover:bg-gray-700/70 transition-colors",children:[Math.round(100*o),"% - Tap to reset"]})]})}const he={spike:"ðŸ“ˆ",trend:"ðŸ“Š",unusual:"ðŸ”",budget:"ðŸ’°",saving:"âœ¨"},me={info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"},fe={info:"text-blue-700 dark:text-blue-300",warning:"text-amber-700 dark:text-amber-300",success:"text-green-700 dark:text-green-300"};function ge({insight:e}){const{currency:n}=c(),{data:s}=l();return t.jsx("div",{className:`p-4 rounded-lg border ${me[e.severity]} transition-all hover:shadow-sm`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:he[e.type]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:`font-medium ${fe[e.severity]}`,children:e.title}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&t.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-2",children:u(e.amount,n,(null==s?void 0:s.rates)||{},!1)})]}),void 0!==e.percentage_change&&t.jsxs("span",{className:"text-sm font-medium px-2 py-1 rounded "+(e.percentage_change>0?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400":"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"),children:[e.percentage_change>0?"+":"",e.percentage_change.toFixed(0),"%"]})]})})}function pe(){const{t:n}=k("common"),{data:s,isLoading:r,error:i}=e({queryKey:["spending-insights"],queryFn:x,staleTime:3e5});if(r)return t.jsxs(g,{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.spendingInsights","Spending Insights")}),t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(p,{size:"md"})})]});if(i)return t.jsxs(g,{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.spendingInsights","Spending Insights")}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:n("common.error","Failed to load insights")})]});const a=(null==s?void 0:s.insights)||[];return t.jsxs(g,{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.spendingInsights","Spending Insights")}),0===a.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("span",{className:"text-4xl mb-3 block",children:"ðŸŽ‰"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:n("analytics.noInsights","No notable spending patterns detected")}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:n("analytics.insightsHint","Keep tracking to see personalized insights")})]}):t.jsx("div",{className:"space-y-3",children:a.map((e,n)=>t.jsx(ge,{insight:e},`${e.type}-${e.category}-${n}`))})]})}async function xe(t=50,e="ja"){return(await y.post("/api/ai/categorize/suggestions",{limit:t,language:e})).data}async function ye(t){return(await y.post("/api/ai/categorize/apply",t)).data}function ve({suggestion:e,isSelected:n,onToggle:s}){const{currency:r}=c(),{data:i}=l(),{t:a}=k("common"),o=e.confidence>=.8?"text-green-600 dark:text-green-400":e.confidence>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return t.jsxs("div",{className:"p-3 rounded-lg border transition-colors cursor-pointer "+(n?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),onClick:()=>s(e.transaction_id,e.suggested_category),children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:e.description}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:u(e.amount,r,(null==i?void 0:i.rates)||{},!1)})]}),t.jsxs("div",{className:"text-right flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[e.is_new_category&&t.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:a("ai.newCategory")}),t.jsx("span",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:e.suggested_category})]}),t.jsxs("p",{className:`text-xs mt-1 ${o}`,children:[Math.round(100*e.confidence),"% ",a("ai.confidence")]})]})]}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 italic",children:e.reason})]})}function be(){const{t:e,i18n:r}=k("common"),i=n(),[o,c]=a.useState(null),[l,d]=a.useState(new Map),[u,h]=a.useState(!0),[m,f]=a.useState(0),[x,y]=a.useState(null),b=a.useRef(!1),j=s({mutationFn:()=>xe(50,r.language),onSuccess:t=>{c(t),f(t.total_other_count);const e=new Map;t.suggestions.forEach(t=>{t.confidence>=.7&&e.set(t.transaction_id,t.suggested_category)}),d(e)}}),w=s({mutationFn:()=>ye({approved:Array.from(l.entries()).map(([t,e])=>({transaction_id:t,category:e})),create_rules:u}),onSuccess:()=>{i.invalidateQueries({queryKey:["analytics"]}),i.invalidateQueries({queryKey:["transactions"]});const t=m-l.size;t>0?(f(t),c(null),d(new Map),setTimeout(()=>j.mutate(),500)):(c(null),d(new Map),f(0))}}),_=a.useCallback(async()=>{b.current=!1;const t=Math.ceil(m/50);let e=0;y({isRunning:!0,processed:0,total:m,currentBatch:0,totalBatches:t});for(let n=0;n<t&&!b.current;n++){y(t=>t?{...t,currentBatch:n+1}:null);try{const t=await xe(50,r.language);if(0===t.suggestions.length)break;if(b.current)break;const n=t.suggestions.filter(t=>t.confidence>=.7).map(t=>({transaction_id:t.transaction_id,category:t.suggested_category}));n.length>0&&(await ye({approved:n,create_rules:u}),e+=n.length),y(t=>t?{...t,processed:e}:null),await new Promise(t=>setTimeout(t,300))}catch{break}}y(null),i.invalidateQueries({queryKey:["analytics"]}),i.invalidateQueries({queryKey:["transactions"]}),c(null),f(0)},[m,r.language,u,i]),S=()=>{b.current=!0,y(null)},N=(t,e)=>{d(n=>{const s=new Map(n);return s.has(t)?s.delete(t):s.set(t,e),s})};if(null==x?void 0:x.isRunning){const n=x.total>0?Math.round(x.processed/x.total*100):0;return t.jsx(g,{children:t.jsxs("div",{className:"py-8",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 text-center mb-4",children:e("ai.processingAll")}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2",children:t.jsx("div",{className:"bg-primary-500 h-4 rounded-full transition-all duration-300",style:{width:`${n}%`}})}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-4",children:e("ai.processProgress",{processed:x.processed,total:x.total,batch:x.currentBatch,totalBatches:x.totalBatches})}),t.jsx("div",{className:"text-center",children:t.jsx(v,{variant:"outline",onClick:S,children:e("common.cancel")})})]})})}if(!o){const n=m,s=n>250,r=.5*Math.ceil(n/50);return t.jsxs(g,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.categoryCleanupDesc")}),n>0&&t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:e("ai.remainingOther",{count:n})})]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsx(v,{onClick:()=>j.mutate(),disabled:j.isPending,children:j.isPending?t.jsxs(t.Fragment,{children:[t.jsx(p,{size:"sm",className:"mr-2"}),e("ai.analyzing")]}):e("ai.analyzeOther")}),s&&t.jsx(v,{variant:"outline",onClick:_,disabled:j.isPending,title:e("ai.analyzeAllCredits",{credits:r.toFixed(1)}),children:e("ai.analyzeAll",{count:n})})]})]}),j.isError&&t.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:e("ai.analyzeError")})]})}if(0===o.suggestions.length)return t.jsx(g,{children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e("ai.noSuggestions")}),t.jsx(v,{variant:"outline",onClick:()=>c(null),className:"mt-4",children:e("common.close")})]})});const E=m-o.suggestions.length,M=E>250;return t.jsxs(g,{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.foundSuggestions",{count:o.suggestions.length,total:m})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{variant:"outline",size:"sm",onClick:()=>{if(!o)return;const t=new Map;o.suggestions.forEach(e=>{t.set(e.transaction_id,e.suggested_category)}),d(t)},children:e("ai.selectAll")}),t.jsx(v,{variant:"outline",size:"sm",onClick:()=>{d(new Map)},children:e("ai.deselectAll")})]})]}),o.new_categories_suggested.length>0&&t.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e("ai.newCategoriesSuggested"),": ",o.new_categories_suggested.join(", ")]})}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:o.suggestions.map(e=>t.jsx(ve,{suggestion:e,isSelected:l.has(e.transaction_id),onToggle:N},e.transaction_id))}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[t.jsx("input",{type:"checkbox",checked:u,onChange:t=>h(t.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),e("ai.createRulesAuto")]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsx(v,{variant:"outline",onClick:()=>c(null),children:e("common.cancel")}),M&&t.jsx(v,{variant:"outline",onClick:_,disabled:w.isPending,children:e("ai.analyzeAll",{count:E})}),t.jsx(v,{onClick:()=>w.mutate(),disabled:0===l.size||w.isPending,children:w.isPending?t.jsxs(t.Fragment,{children:[t.jsx(p,{size:"sm",className:"mr-2"}),e("ai.applying")]}):e("ai.applySelected",{count:l.size})})]})]}),w.isError&&t.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:e("ai.applyError")})]})]})}function je({label:e,value:n,change:s,trend:r="neutral",subtitle:i,className:a}){const{t:o}=k("common");return t.jsxs("div",{className:h("bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm","border border-gray-100 dark:border-gray-700",a),children:[t.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:e}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 truncate",children:n}),null!=s&&t.jsxs("div",{className:h("flex items-center gap-1 mt-1","positive"===r?"text-green-600 dark:text-green-400":"negative"===r?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"),children:[t.jsxs("span",{className:"text-sm font-medium",children:[null==s?null:s>0?"â†‘":s<0?"â†“":"â†’"," ",Math.abs(s).toFixed(1),"%"]}),t.jsx("span",{className:"text-xs text-gray-400",children:o("analytics.vsLastPeriod")})]}),i&&t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1 truncate",children:i})]})}function we({analytics:e,displayCurrency:n="JPY"}){const{t:s}=k("common"),{total_income:r,total_expense:i,net_cashflow:a,comparison:o,top_category:c}=e;return t.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[t.jsx(je,{label:s("analytics.heroIncome"),value:u(r,n),change:null==o?void 0:o.income_change,trend:(null==o?void 0:o.income_change)?o.income_change>0?"positive":"negative":"neutral"}),t.jsx(je,{label:s("analytics.heroExpense"),value:u(i,n),change:null==o?void 0:o.expense_change,trend:(null==o?void 0:o.expense_change)?o.expense_change<0?"positive":"negative":"neutral"}),t.jsx(je,{label:s("analytics.heroNet"),value:u(a,n),change:null==o?void 0:o.net_change,trend:(null==o?void 0:o.net_change)?o.net_change>0?"positive":"negative":"neutral"}),t.jsx(je,{label:s("analytics.heroTopCategory"),value:(null==c?void 0:c.name)||"-",subtitle:c?`${u(c.amount,n)} (${c.percentage}%)`:void 0})]})}function ke(t){return function(t){return"[object Object]"===Object.prototype.toString.call(t)}(t)||Array.isArray(t)}function _e(t,e){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;return JSON.stringify(Object.keys(t.breakpoints||{}))===JSON.stringify(Object.keys(e.breakpoints||{}))&&n.every(n=>{const s=t[n],r=e[n];return"function"==typeof s?`${s}`==`${r}`:ke(s)&&ke(r)?_e(s,r):s===r})}function Se(t){return t.concat().sort((t,e)=>t.name>e.name?1:-1).map(t=>t.options)}function Ne(t){return"number"==typeof t}function Ee(t){return"string"==typeof t}function Me(t){return"boolean"==typeof t}function Ce(t){return"[object Object]"===Object.prototype.toString.call(t)}function Te(t){return Math.abs(t)}function De(t){return Math.sign(t)}function Ae(t,e){return Te(t-e)}function Ie(t){return Ke(t).map(Number)}function Oe(t){return t[Pe(t)]}function Pe(t){return Math.max(0,t.length-1)}function Fe(t,e){return e===Pe(t)}function Be(t,e=0){return Array.from(Array(t),(t,n)=>e+n)}function Ke(t){return Object.keys(t)}function Le(t,e){return[t,e].reduce((t,e)=>(Ke(e).forEach(n=>{const s=t[n],r=e[n],i=Ce(s)&&Ce(r);t[n]=i?Le(s,r):r}),t),{})}function ze(t,e){return void 0!==e.MouseEvent&&t instanceof e.MouseEvent}function $e(){let t=[];const e={add:function(n,s,r,i={passive:!0}){let a;if("addEventListener"in n)n.addEventListener(s,r,i),a=()=>n.removeEventListener(s,r,i);else{const t=n;t.addListener(r),a=()=>t.removeListener(r)}return t.push(a),e},clear:function(){t=t.filter(t=>t())}};return e}function Ve(t,e,n,s){const r=$e(),i=1e3/60;let a=null,o=0,c=0;function l(t){if(!c)return;a||(a=t,n(),n());const r=t-a;for(a=t,o+=r;o>=i;)n(),o-=i;s(o/i),c&&(c=e.requestAnimationFrame(l))}function d(){e.cancelAnimationFrame(c),a=null,o=0,c=0}return{init:function(){r.add(t,"visibilitychange",()=>{t.hidden&&(a=null,o=0)})},destroy:function(){d(),r.clear()},start:function(){c||(c=e.requestAnimationFrame(l))},stop:d,update:n,render:s}}function He(t=0,e=0){const n=Te(t-e);function s(e){return e<t}function r(t){return t>e}function i(t){return s(t)||r(t)}return{length:n,max:e,min:t,constrain:function(n){return i(n)?s(n)?t:e:n},reachedAny:i,reachedMax:r,reachedMin:s,removeOffset:function(t){return n?t-n*Math.ceil((t-e)/n):t}}}function Re(t,e,n){const{constrain:s}=He(0,t),r=t+1;let i=a(e);function a(t){return n?Te((r+t)%r):s(t)}function o(){return i}function c(){return Re(t,o(),n)}const l={get:o,set:function(t){return i=a(t),l},add:function(t){return c().set(o()+t)},clone:c};return l}function qe(t,e,n,s,r,i,a,o,c,l,d,u,h,m,f,g,p,x,y){const{cross:v,direction:b}=t,j=["INPUT","SELECT","TEXTAREA"],w={passive:!1},k=$e(),_=$e(),S=He(50,225).constrain(m.measure(20)),N={mouse:300,touch:400},E={mouse:500,touch:600},M=f?43:25;let C=!1,T=0,D=0,A=!1,I=!1,O=!1,P=!1;function F(t){if(!ze(t,s)&&t.touches.length>=2)return B(t);const e=i.readPoint(t),n=i.readPoint(t,v),a=Ae(e,T),c=Ae(n,D);if(!I&&!P){if(!t.cancelable)return B(t);if(I=a>c,!I)return B(t)}const d=i.pointerMove(t);a>g&&(O=!0),l.useFriction(.3).useDuration(.75),o.start(),r.add(b(d)),t.preventDefault()}function B(t){const e=d.byDistance(0,!1).index!==u.get(),n=i.pointerUp(t)*(f?E:N)[P?"mouse":"touch"],s=function(t,e){const n=u.add(-1*De(t)),s=d.byDistance(t,!f).distance;return f||Te(t)<S?s:p&&e?.5*s:d.byIndex(n.get(),0).distance}(b(n),e),r=function(t,e){if(0===t||0===e)return 0;if(Te(t)<=Te(e))return 0;const n=Ae(Te(t),Te(e));return Te(n/t)}(n,s),a=M-10*r,o=x+r/50;I=!1,A=!1,_.clear(),l.useDuration(a).useFriction(o),c.distance(s,!f),P=!1,h.emit("pointerUp")}function K(t){O&&(t.stopPropagation(),t.preventDefault(),O=!1)}return{init:function(t){if(!y)return;function o(o){(Me(y)||y(t,o))&&function(t){const o=ze(t,s);if(P=o,O=f&&o&&!t.buttons&&C,C=Ae(r.get(),a.get())>=2,o&&0!==t.button)return;if(function(t){const e=t.nodeName||"";return j.includes(e)}(t.target))return;A=!0,i.pointerDown(t),l.useFriction(0).useDuration(0),r.set(a),function(){const t=P?n:e;_.add(t,"touchmove",F,w).add(t,"touchend",B).add(t,"mousemove",F,w).add(t,"mouseup",B)}(),T=i.readPoint(t),D=i.readPoint(t,v),h.emit("pointerDown")}(o)}const c=e;k.add(c,"dragstart",t=>t.preventDefault(),w).add(c,"touchmove",()=>{},w).add(c,"touchend",()=>{}).add(c,"touchstart",o).add(c,"mousedown",o).add(c,"touchcancel",B).add(c,"contextmenu",B).add(c,"click",K,!0)},destroy:function(){k.clear(),_.clear()},pointerDown:function(){return A}}}function Ye(t,e){let n,s;function r(t){return t.timeStamp}function i(n,s){const r="client"+("x"===(s||t.scroll)?"X":"Y");return(ze(n,e)?n:n.touches[0])[r]}return{pointerDown:function(t){return n=t,s=t,i(t)},pointerMove:function(t){const e=i(t)-i(s),a=r(t)-r(n)>170;return s=t,a&&(n=t),e},pointerUp:function(t){if(!n||!s)return 0;const e=i(s)-i(n),a=r(t)-r(n),o=r(t)-r(s)>170,c=e/a;return a&&!o&&Te(c)>.1?c:0},readPoint:i}}function Ue(t,e,n,s,r,i,a){const o=[t].concat(s);let c,l,d=[],u=!1;function h(t){return r.measureSize(a.measure(t))}return{init:function(r){i&&(l=h(t),d=s.map(h),c=new ResizeObserver(n=>{(Me(i)||i(r,n))&&function(n){for(const i of n){if(u)return;const n=i.target===t,a=s.indexOf(i.target),o=n?l:d[a];if(Te(h(n?t:s[a])-o)>=.5){r.reInit(),e.emit("resize");break}}}(n)}),n.requestAnimationFrame(()=>{o.forEach(t=>c.observe(t))}))},destroy:function(){u=!0,c&&c.disconnect()}}}function We(t,e,n,s,r){const i=r.measure(10),a=r.measure(50),o=He(.1,.99);let c=!1;function l(){return!c&&(!!t.reachedAny(n.get())&&!!t.reachedAny(e.get()))}return{shouldConstrain:l,constrain:function(r){if(!l())return;const c=t.reachedMin(e.get())?"min":"max",d=Te(t[c]-e.get()),u=n.get()-e.get(),h=o.constrain(d/a);n.subtract(u*h),!r&&Te(u)<i&&(n.set(t.constrain(n.get())),s.useDuration(25).useBaseFriction())},toggleActive:function(t){c=!t}}}function Xe(t,e,n,s){const r=e.min+.1,i=e.max+.1,{reachedMin:a,reachedMax:o}=He(r,i);return{loop:function(e){if(!function(t){return 1===t?o(n.get()):-1===t&&a(n.get())}(e))return;const r=t*(-1*e);s.forEach(t=>t.add(r))}}}function Ge(t,e,n,s,r){const{reachedAny:i,removeOffset:a,constrain:o}=s;function c(t){return t.concat().sort((t,e)=>Te(t)-Te(e))[0]}function l(e,s){const r=[e,e+n,e-n];if(!t)return e;if(!s)return c(r);const i=r.filter(t=>De(t)===s);return i.length?c(i):Oe(r)-n}return{byDistance:function(n,s){const c=r.get()+n,{index:d,distance:u}=function(n){const s=t?a(n):o(n),r=e.map((t,e)=>({diff:l(t-s,0),index:e})).sort((t,e)=>Te(t.diff)-Te(e.diff)),{index:i}=r[0];return{index:i,distance:s}}(c),h=!t&&i(c);return!s||h?{index:d,distance:n}:{index:d,distance:n+l(e[d]-u,0)}},byIndex:function(t,n){return{index:t,distance:l(e[t]-r.get(),n)}},shortcut:l}}function Je(t,e,n,s,r,i,a,o){const c={passive:!0,capture:!0};let l=0;function d(t){"Tab"===t.code&&(l=(new Date).getTime())}return{init:function(u){o&&(i.add(document,"keydown",d,!1),e.forEach((e,d)=>{i.add(e,"focus",e=>{(Me(o)||o(u,e))&&function(e){if((new Date).getTime()-l>10)return;a.emit("slideFocusStart"),t.scrollLeft=0;const i=n.findIndex(t=>t.includes(e));Ne(i)&&(r.useDuration(0),s.index(i,0),a.emit("slideFocus"))}(d)},c)}))}}}function Qe(t){let e=t;function n(t){return Ne(t)?t:t.get()}return{get:function(){return e},set:function(t){e=n(t)},add:function(t){e+=n(t)},subtract:function(t){e-=n(t)}}}function Ze(t,e){const n="x"===t.scroll?function(t){return`translate3d(${t}px,0px,0px)`}:function(t){return`translate3d(0px,${t}px,0px)`},s=e.style;let r=null,i=!1;return{clear:function(){i||(s.transform="",e.getAttribute("style")||e.removeAttribute("style"))},to:function(e){if(i)return;const a=(o=t.direction(e),Math.round(100*o)/100);var o;a!==r&&(s.transform=n(a),r=a)},toggleActive:function(t){i=!t}}}function tn(t,e,n,s,r,i,a,o,c){const l=Ie(r),d=Ie(r).reverse(),u=function(){const t=a[0];return f(m(d,t),n,!1)}().concat(function(){const t=e-a[0]-1;return f(m(l,t),-n,!0)}());function h(t,e){return t.reduce((t,e)=>t-r[e],e)}function m(t,e){return t.reduce((t,n)=>h(t,e)>0?t.concat([n]):t,[])}function f(r,a,l){const d=function(t){return i.map((n,r)=>({start:n-s[r]+.5+t,end:n+e-.5+t}))}(a);return r.map(e=>{const s=l?0:-n,r=l?n:0,i=l?"end":"start",a=d[e][i];return{index:e,loopPoint:a,slideLocation:Qe(-1),translate:Ze(t,c[e]),target:()=>o.get()>a?s:r}})}return{canLoop:function(){return u.every(({index:t})=>h(l.filter(e=>e!==t),e)<=.1)},clear:function(){u.forEach(t=>t.translate.clear())},loop:function(){u.forEach(t=>{const{target:e,translate:n,slideLocation:s}=t,r=e();r!==s.get()&&(n.to(r),s.set(r))})},loopPoints:u}}function en(t,e,n){let s,r=!1;return{init:function(i){n&&(s=new MutationObserver(t=>{r||(Me(n)||n(i,t))&&function(t){for(const n of t)if("childList"===n.type){i.reInit(),e.emit("slidesChanged");break}}(t)}),s.observe(t,{childList:!0}))},destroy:function(){s&&s.disconnect(),r=!0}}}function nn(t,e,n,s){const r={};let i,a=null,o=null,c=!1;return{init:function(){i=new IntersectionObserver(t=>{c||(t.forEach(t=>{const n=e.indexOf(t.target);r[n]=t}),a=null,o=null,n.emit("slidesInView"))},{root:t.parentElement,threshold:s}),e.forEach(t=>i.observe(t))},destroy:function(){i&&i.disconnect(),c=!0},get:function(t=!0){if(t&&a)return a;if(!t&&o)return o;const e=function(t){return Ke(r).reduce((e,n)=>{const s=parseInt(n),{isIntersecting:i}=r[s];return(t&&i||!t&&!i)&&e.push(s),e},[])}(t);return t&&(a=e),t||(o=e),e}}}function sn(t,e,n,s,r,i,a,o,c){const{startEdge:l,endEdge:d,direction:u}=t,h=Ne(n);return{groupSlides:function(t){return h?function(t,e){return Ie(t).filter(t=>t%e===0).map(n=>t.slice(n,n+e))}(t,n):function(t){return t.length?Ie(t).reduce((n,h,m)=>{const f=Oe(n)||0,g=0===f,p=h===Pe(t),x=r[l]-i[f][l],y=r[l]-i[h][d],v=!s&&g?u(a):0,b=Te(y-(!s&&p?u(o):0)-(x+v));return m&&b>e+c&&n.push(h),p&&n.push(t.length),n},[]).map((e,n,s)=>{const r=Math.max(s[n-1]||0);return t.slice(r,e)}):[]}(t)}}}function rn(t,e,n,s,r,i,a){const{align:o,axis:c,direction:l,startIndex:d,loop:u,duration:h,dragFree:m,dragThreshold:f,inViewThreshold:g,slidesToScroll:p,skipSnaps:x,containScroll:y,watchResize:v,watchSlides:b,watchDrag:j,watchFocus:w}=i,k={measure:function(t){const{offsetTop:e,offsetLeft:n,offsetWidth:s,offsetHeight:r}=t;return{top:e,right:n+s,bottom:e+r,left:n,width:s,height:r}}},_=k.measure(e),S=n.map(k.measure),N=function(t,e){const n="rtl"===e,s="y"===t,r=!s&&n?-1:1;return{scroll:s?"y":"x",cross:s?"x":"y",startEdge:s?"top":n?"right":"left",endEdge:s?"bottom":n?"left":"right",measureSize:function(t){const{height:e,width:n}=t;return s?e:n},direction:function(t){return t*r}}}(c,l),E=N.measureSize(_),M=function(t){return{measure:function(e){return t*(e/100)}}}(E),C=function(t,e){const n={start:function(){return 0},center:function(t){return s(t)/2},end:s};function s(t){return e-t}return{measure:function(s,r){return Ee(t)?n[t](s):t(e,s,r)}}}(o,E),T=!u&&!!y,D=u||!!y,{slideSizes:A,slideSizesWithGaps:I,startGap:O,endGap:P}=function(t,e,n,s,r,i){const{measureSize:a,startEdge:o,endEdge:c}=t,l=n[0]&&r,d=function(){if(!l)return 0;const t=n[0];return Te(e[o]-t[o])}(),u=function(){if(!l)return 0;const t=i.getComputedStyle(Oe(s));return parseFloat(t.getPropertyValue(`margin-${c}`))}(),h=n.map(a),m=n.map((t,e,n)=>{const s=!e,r=Fe(n,e);return s?h[e]+d:r?h[e]+u:n[e+1][o]-t[o]}).map(Te);return{slideSizes:h,slideSizesWithGaps:m,startGap:d,endGap:u}}(N,_,S,n,D,r),F=sn(N,E,p,u,_,S,O,P,2),{snaps:B,snapsAligned:K}=function(t,e,n,s,r){const{startEdge:i,endEdge:a}=t,{groupSlides:o}=r,c=o(s).map(t=>Oe(t)[a]-t[0][i]).map(Te).map(e.measure),l=s.map(t=>n[i]-t[i]).map(t=>-Te(t)),d=o(l).map(t=>t[0]).map((t,e)=>t+c[e]);return{snaps:l,snapsAligned:d}}(N,C,_,S,F),L=-Oe(B)+Oe(I),{snapsContained:z,scrollContainLimit:$}=function(t,e,n,s,r){const i=He(-e+t,0),a=n.map((t,e)=>{const{min:s,max:r}=i,a=i.constrain(t),o=!e,l=Fe(n,e);return o?r:l||c(s,a)?s:c(r,a)?r:a}).map(t=>parseFloat(t.toFixed(3))),o=function(){const t=a[0],e=Oe(a);return He(a.lastIndexOf(t),a.indexOf(e)+1)}();function c(t,e){return Ae(t,e)<=1}return{snapsContained:function(){if(e<=t+r)return[i.max];if("keepSnaps"===s)return a;const{min:n,max:c}=o;return a.slice(n,c)}(),scrollContainLimit:o}}(E,L,K,y,2),V=T?z:K,{limit:H}=function(t,e,n){const s=e[0];return{limit:He(n?s-t:Oe(e),s)}}(L,V,u),R=Re(Pe(V),d,u),q=R.clone(),Y=Ie(n),U=Ve(s,r,()=>(({dragHandler:t,scrollBody:e,scrollBounds:n,options:{loop:s}})=>{s||n.constrain(t.pointerDown()),e.seek()})(ot),t=>(({scrollBody:t,translate:e,location:n,offsetLocation:s,previousLocation:r,scrollLooper:i,slideLooper:a,dragHandler:o,animation:c,eventHandler:l,scrollBounds:d,options:{loop:u}},h)=>{const m=t.settled(),f=!d.shouldConstrain(),g=u?m:m&&f,p=g&&!o.pointerDown();p&&c.stop();const x=n.get()*h+r.get()*(1-h);s.set(x),u&&(i.loop(t.direction()),a.loop()),e.to(s.get()),p&&l.emit("settle"),g||l.emit("scroll")})(ot,t)),W=V[R.get()],X=Qe(W),G=Qe(W),J=Qe(W),Q=Qe(W),Z=function(t,e,n,s,r,i){let a=0,o=0,c=r,l=i,d=t.get(),u=0;function h(t){return c=t,f}function m(t){return l=t,f}const f={direction:function(){return o},duration:function(){return c},velocity:function(){return a},seek:function(){const e=s.get()-t.get();let r=0;return c?(n.set(t),a+=e/c,a*=l,d+=a,t.add(a),r=d-u):(a=0,n.set(s),t.set(s),r=e),o=De(r),u=d,f},settled:function(){return Te(s.get()-e.get())<.001},useBaseFriction:function(){return m(i)},useBaseDuration:function(){return h(r)},useFriction:m,useDuration:h};return f}(X,J,G,Q,h,.68),tt=Ge(u,V,L,H,Q),et=function(t,e,n,s,r,i,a){function o(r){const o=r.distance,c=r.index!==e.get();i.add(o),o&&(s.duration()?t.start():(t.update(),t.render(1),t.update())),c&&(n.set(e.get()),e.set(r.index),a.emit("select"))}return{distance:function(t,e){o(r.byDistance(t,e))},index:function(t,n){const s=e.clone().set(t);o(r.byIndex(s.get(),n))}}}(U,R,q,Z,tt,Q,a),nt=function(t){const{max:e,length:n}=t;return{get:function(t){return n?(t-e)/-n:0}}}(H),st=$e(),rt=nn(e,n,a,g),{slideRegistry:it}=function(t,e,n,s,r,i){const{groupSlides:a}=r,{min:o,max:c}=s;return{slideRegistry:function(){const s=a(i),r=!t||"keepSnaps"===e;return 1===n.length?[i]:r?s:s.slice(o,c).map((t,e,n)=>{const s=!e,r=Fe(n,e);return s?Be(Oe(n[0])+1):r?Be(Pe(i)-Oe(n)[0]+1,Oe(n)[0]):t})}()}}(T,y,V,$,F,Y),at=Je(t,n,it,et,Z,st,a,w),ot={ownerDocument:s,ownerWindow:r,eventHandler:a,containerRect:_,slideRects:S,animation:U,axis:N,dragHandler:qe(N,t,s,r,Q,Ye(N,r),X,U,et,Z,tt,R,a,M,m,f,x,.68,j),eventStore:st,percentOfView:M,index:R,indexPrevious:q,limit:H,location:X,offsetLocation:J,previousLocation:G,options:i,resizeHandler:Ue(e,a,r,n,N,v,k),scrollBody:Z,scrollBounds:We(H,J,Q,Z,M),scrollLooper:Xe(L,H,J,[X,J,G,Q]),scrollProgress:nt,scrollSnapList:V.map(nt.get),scrollSnaps:V,scrollTarget:tt,scrollTo:et,slideLooper:tn(N,E,L,A,I,B,V,J,n),slideFocus:at,slidesHandler:en(e,a,b),slidesInView:rt,slideIndexes:Y,slideRegistry:it,slidesToScroll:F,target:Q,translate:Ze(N,e)};return ot}const an={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function on(t){function e(t,e){return Le(t,e||{})}return{mergeOptions:e,optionsAtMedia:function(n){const s=n.breakpoints||{},r=Ke(s).filter(e=>t.matchMedia(e).matches).map(t=>s[t]).reduce((t,n)=>e(t,n),{});return e(n,r)},optionsMediaQueries:function(e){return e.map(t=>Ke(t.breakpoints||{})).reduce((t,e)=>t.concat(e),[]).map(t.matchMedia)}}}function cn(t,e,n){const s=t.ownerDocument,r=s.defaultView,i=on(r),a=function(t){let e=[];return{init:function(n,s){return e=s.filter(({options:e})=>!1!==t.optionsAtMedia(e).active),e.forEach(e=>e.init(n,t)),s.reduce((t,e)=>Object.assign(t,{[e.name]:e}),{})},destroy:function(){e=e.filter(t=>t.destroy())}}}(i),o=$e(),c=function(){let t,e={};function n(t){return e[t]||[]}const s={init:function(e){t=e},emit:function(e){return n(e).forEach(n=>n(t,e)),s},off:function(t,r){return e[t]=n(t).filter(t=>t!==r),s},on:function(t,r){return e[t]=n(t).concat([r]),s},clear:function(){e={}}};return s}(),{mergeOptions:l,optionsAtMedia:d,optionsMediaQueries:u}=i,{on:h,off:m,emit:f}=c,g=N;let p,x,y,v,b=!1,j=l(an,cn.globalOptions),w=l(j),k=[];function _(e){const n=rn(t,y,v,s,r,e,c);if(e.loop&&!n.slideLooper.canLoop()){return _(Object.assign({},e,{loop:!1}))}return n}function S(e,n){b||(j=l(j,e),w=d(j),k=n||k,function(){const{container:e,slides:n}=w,s=Ee(e)?t.querySelector(e):e;y=s||t.children[0];const r=Ee(n)?y.querySelectorAll(n):n;v=[].slice.call(r||y.children)}(),p=_(w),u([j,...k.map(({options:t})=>t)]).forEach(t=>o.add(t,"change",N)),w.active&&(p.translate.to(p.location.get()),p.animation.init(),p.slidesInView.init(),p.slideFocus.init(T),p.eventHandler.init(T),p.resizeHandler.init(T),p.slidesHandler.init(T),p.options.loop&&p.slideLooper.loop(),y.offsetParent&&v.length&&p.dragHandler.init(T),x=a.init(T,k)))}function N(t,e){const n=C();E(),S(l({startIndex:n},t),e),c.emit("reInit")}function E(){p.dragHandler.destroy(),p.eventStore.clear(),p.translate.clear(),p.slideLooper.clear(),p.resizeHandler.destroy(),p.slidesHandler.destroy(),p.slidesInView.destroy(),p.animation.destroy(),a.destroy(),o.clear()}function M(t,e,n){w.active&&!b&&(p.scrollBody.useBaseFriction().useDuration(!0===e?0:w.duration),p.scrollTo.index(t,n||0))}function C(){return p.index.get()}const T={canScrollNext:function(){return p.index.add(1).get()!==C()},canScrollPrev:function(){return p.index.add(-1).get()!==C()},containerNode:function(){return y},internalEngine:function(){return p},destroy:function(){b||(b=!0,o.clear(),E(),c.emit("destroy"),c.clear())},off:m,on:h,emit:f,plugins:function(){return x},previousScrollSnap:function(){return p.indexPrevious.get()},reInit:g,rootNode:function(){return t},scrollNext:function(t){M(p.index.add(1).get(),t,-1)},scrollPrev:function(t){M(p.index.add(-1).get(),t,1)},scrollProgress:function(){return p.scrollProgress.get(p.offsetLocation.get())},scrollSnapList:function(){return p.scrollSnapList},scrollTo:M,selectedScrollSnap:C,slideNodes:function(){return v},slidesInView:function(){return p.slidesInView.get()},slidesNotInView:function(){return p.slidesInView.get(!1)}};return S(e,n),setTimeout(()=>c.emit("init"),0),T}function ln(t={},e=[]){const n=a.useRef(t),s=a.useRef(e),[r,i]=a.useState(),[o,c]=a.useState(),l=a.useCallback(()=>{r&&r.reInit(n.current,s.current)},[r]);return a.useEffect(()=>{_e(n.current,t)||(n.current=t,l())},[t,l]),a.useEffect(()=>{(function(t,e){if(t.length!==e.length)return!1;const n=Se(t),s=Se(e);return n.every((t,e)=>_e(t,s[e]))})(s.current,e)||(s.current=e,l())},[e,l]),a.useEffect(()=>{if("undefined"!=typeof window&&window.document&&window.document.createElement&&o){cn.globalOptions=ln.globalOptions;const t=cn(o,n.current,s.current);return i(t),()=>t.destroy()}i(void 0)},[o,i]),[c,r]}cn.globalOptions=void 0,ln.globalOptions=void 0;const dn={spike:"âš ï¸",trend:"ðŸ“ˆ",unusual:"ðŸ“Š",budget:"ðŸ’°",saving:"ðŸŽ‰"},un={warning:"border-l-amber-500 bg-amber-50 dark:bg-amber-900/20",success:"border-l-green-500 bg-green-50 dark:bg-green-900/20",info:"border-l-blue-500 bg-blue-50 dark:bg-blue-900/20"};function hn({insight:e,displayCurrency:n="JPY",onScrollToChart:s}){const{t:i}=k("common"),a=r();return t.jsx("div",{className:h("rounded-xl p-4 border-l-4 min-w-0","bg-white dark:bg-gray-800","shadow-sm",un[e.severity]||un.info),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl flex-shrink-0",children:dn[e.type]||"ðŸ’¡"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.title}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&t.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-1",children:[u(e.amount,n),e.percentage_change&&t.jsxs("span",{className:h("ml-2",e.percentage_change>0?"text-red-600":"text-green-600"),children:[e.percentage_change>0?"+":"",e.percentage_change,"%"]})]}),t.jsxs(v,{variant:"ghost",className:"mt-2 p-0 h-auto text-sm text-primary-600 hover:text-primary-700",onClick:()=>{e.category?a({to:"/transactions",search:{categories:e.category}}):"trend"!==e.type&&"unusual"!==e.type||null==s||s()},children:[e.category?i("analytics.viewTransactions",{category:e.category}):"trend"===e.type||"unusual"===e.type?i("analytics.viewBreakdown"):i("analytics.learnMore")," â†’"]})]})]})})}function mn({insights:e,displayCurrency:n="JPY",onScrollToChart:s}){const{t:r}=k("common"),[i,o]=a.useState(0),[c,l]=ln({loop:!1,align:"start",containScroll:"trimSnaps"}),d=a.useCallback(()=>{l&&o(l.selectedScrollSnap())},[l]);return a.useEffect(()=>{if(l)return d(),l.on("select",d),()=>{l.off("select",d)}},[l,d]),e&&0!==e.length?t.jsxs("div",{className:"relative",children:[e.length>1&&t.jsx("p",{className:"text-xs text-gray-400 text-center mb-2",children:r("analytics.swipeHint")}),t.jsx("div",{className:"overflow-hidden",ref:c,children:t.jsx("div",{className:"flex gap-3",children:e.map((e,r)=>t.jsx("div",{className:"flex-shrink-0 w-full min-w-0",children:t.jsx(hn,{insight:e,displayCurrency:n,onScrollToChart:s})},`${e.type}-${e.category||r}`))})}),e.length>1&&t.jsx("div",{className:"flex justify-center gap-1.5 mt-3",children:e.map((e,n)=>t.jsx("button",{"aria-label":`Go to insight ${n+1}`,className:h("w-2 h-2 rounded-full transition-all",n===i?"bg-primary-600 w-4":"bg-gray-300 dark:bg-gray-600"),onClick:()=>null==l?void 0:l.scrollTo(n)},n))})]}):null}function fn({selectedMonth:e,onChange:n,className:s}){const{i18n:r}=k(),i=$(e,1)>new Date;return t.jsxs("div",{className:h("flex items-center gap-2",s),children:[t.jsx("button",{onClick:()=>{n(V(e,1))},className:h("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors"),"aria-label":"Previous month",children:"â†"}),t.jsx("span",{className:"min-w-[140px] text-center font-medium text-gray-900 dark:text-gray-100",children:(t=>{const e=r.language;return"ja"===e?H(t,"yyyyå¹´Mæœˆ"):"vi"===e?`ThÃ¡ng ${H(t,"M/yyyy")}`:H(t,"MMMM yyyy")})(e)}),t.jsx("button",{onClick:()=>{const t=$(e,1);t<=new Date&&n(t)},disabled:i,className:h("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors",i&&"opacity-50 cursor-not-allowed"),"aria-label":"Next month",children:"â†’"})]})}const gn=[{value:"current-month",labelKey:"analytics.currentMonth"},{value:"3-months",labelKey:"analytics.3months"},{value:"6-months",labelKey:"analytics.6months"},{value:"1-year",labelKey:"analytics.1year"}];function pn({selected:e,onChange:n,className:s}){const{t:r}=k("common");return t.jsx("div",{className:h("inline-flex rounded-lg bg-gray-100 dark:bg-gray-800 p-1",s),children:gn.map(({value:s,labelKey:i})=>t.jsx("button",{onClick:()=>n(s),className:h("px-3 py-1.5 text-sm font-medium rounded-md transition-all",s===e?"bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:r(i)},s))})}const xn=i("/analytics")({component:function(){const{t:n}=k("common"),s=a.useRef(null),[r,i]=a.useState(new Date),[o,c]=a.useState("current-month"),[l,d]=a.useState(!1),u=function(t,e){const n=R(e),s=H(n>new Date?new Date:n,"yyyy-MM-dd");switch(t){case"current-month":return{start:H(q(e),"yyyy-MM-dd"),end:s};case"3-months":return{start:H(V(q(e),2),"yyyy-MM-dd"),end:s};case"6-months":return{start:H(V(q(e),5),"yyyy-MM-dd"),end:s};case"1-year":return{start:H(V(q(e),11),"yyyy-MM-dd"),end:s};default:return b()}}(o,r),{data:m,isLoading:f}=e({queryKey:["analytics",u],queryFn:()=>j(u)}),{data:y}=e({queryKey:["insights"],queryFn:x}),{data:v}=e({queryKey:["goals"],queryFn:w}),_=v&&v.length>0?Math.round(v[0].target_amount/(12*v[0].years)):null,S=a.useCallback(()=>{var t;null==(t=s.current)||t.scrollIntoView({behavior:"smooth"})},[]);return t.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100",children:n("analytics.title")}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:n("analytics.subtitle")})]}),t.jsxs("div",{className:"mb-6 space-y-3",children:[t.jsx(fn,{selectedMonth:r,onChange:t=>{i(t)},className:"justify-center"}),t.jsx("div",{className:"flex justify-center",children:t.jsx(pn,{selected:o,onChange:t=>{c(t)}})})]}),f?t.jsx("div",{className:"flex justify-center py-12",children:t.jsx(p,{size:"lg"})}):t.jsxs("div",{className:"space-y-6",children:[m&&t.jsx(we,{analytics:m}),(null==y?void 0:y.insights)&&y.insights.length>0&&t.jsx(mn,{insights:y.insights,onScrollToChart:S}),t.jsxs("div",{ref:s,className:"space-y-6",children:[t.jsxs(g,{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.incomeVsExpense")}),t.jsx(ue,{className:"h-64 sm:h-80",children:(null==m?void 0:m.monthly_trends)&&m.monthly_trends.length>0?t.jsx(U,{data:m.monthly_trends}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("analytics.noData")})})]}),t.jsxs(g,{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.categoryBreakdown")}),t.jsx(ue,{className:"h-64 sm:h-80",children:(null==m?void 0:m.category_breakdown)&&m.category_breakdown.length>0?t.jsx(G,{data:m.category_breakdown}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("analytics.noData")})})]}),t.jsxs(g,{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.monthlyCashFlow")}),t.jsx("div",{className:"h-64 sm:h-80",children:(null==m?void 0:m.monthly_trends)&&m.monthly_trends.length>0?m.monthly_trends.length<3?t.jsx(Z,{data:m.monthly_trends,savingsGoal:_}):t.jsx(ue,{className:"h-full",children:t.jsx(Q,{data:m.monthly_trends,dataKey:"net"})}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("analytics.noData")})})]})]}),t.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[t.jsxs("button",{onClick:()=>d(!l),className:h("w-full px-4 py-3 flex items-center justify-between","bg-gray-50 dark:bg-gray-800","text-left font-medium text-gray-900 dark:text-gray-100"),children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{children:"ðŸ¤–"}),n("analytics.aiTools")]}),t.jsx("span",{className:h("transform transition-transform",l?"rotate-180":""),children:"â–¼"})]}),l&&t.jsxs("div",{className:"p-4 space-y-4 bg-white dark:bg-gray-900",children:[t.jsx(be,{}),t.jsx(pe,{})]})]})]})]})}});export{xn as Route};
