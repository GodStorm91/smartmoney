import{c as O,u as z,k as R,j as e,m as le}from"./vendor-tanstack-DOuiVnRb.js";import{r as i,a as Y}from"./vendor-react-B9eo89kj.js";import{a as W,C as A,L as M,B as N,c as F,A as ie,D as ce,F as de,G as oe,H as me,I as q,J as ge,K as xe,M as ue,N as ye}from"./index-Cyepc-vJ.js";import{C as U,a as P}from"./crypto-Dbpx5UD4.js";import{S as he}from"./Select-BuxQOdGm.js";import{R as pe}from"./RecurringTransactionsList-CML8po5F.js";import{u as T}from"./vendor-i18n-CtQU9zWU.js";import{a6 as $,a7 as be,P as fe,t as G,a8 as je,J as ke,X as V,z as ve,s as Ne}from"./vendor-icons-Boynwk5e.js";import{b as Ce,d as we,e as Se,f as Re}from"./recurring-service-CZDZgyPV.js";import"./vendor-recharts-BfEtinVu.js";import"./vendor-date-fteVm545.js";async function _e(){return(await W.get("/api/category-rules/")).data.rules}async function Fe(t){return(await W.post("/api/category-rules/",t)).data}async function Pe(t){await W.delete(`/api/category-rules/${t}`)}async function De(t=!0){return(await W.post("/api/category-rules/apply",{dry_run:t})).data}async function Ee(){return(await W.get("/api/category-rules/suggest")).data.suggestions}async function qe(){return(await W.post("/api/category-rules/seed-defaults")).data}const Te={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},Ae=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function Me(){const{t}=T("common"),d=O(),[s,c]=i.useState(null),[o,u]=i.useState(!1),[y,g]=i.useState(!1),[m,h]=i.useState(null),[x,p]=i.useState(""),[j,r]=i.useState("Other"),[b,f]=i.useState("contains"),{data:k,isLoading:v}=z({queryKey:["category-rules"],queryFn:_e}),{data:n,isLoading:S}=z({queryKey:["category-rules-suggestions"],queryFn:Ee,enabled:y}),C=R({mutationFn:Pe,onSuccess:()=>{d.invalidateQueries({queryKey:["category-rules"]}),c(null)}}),w=R({mutationFn:Fe,onSuccess:()=>{d.invalidateQueries({queryKey:["category-rules"]}),p(""),r("Other"),f("contains"),u(!1)}}),_=R({mutationFn:qe,onSuccess:()=>{d.invalidateQueries({queryKey:["category-rules"]})}}),D=R({mutationFn:l=>De(l),onSuccess:(l,K)=>{K?h({count:l.affected_count,applied:!1}):(d.invalidateQueries({queryKey:["transactions"]}),d.invalidateQueries({queryKey:["analytics"]}),h({count:l.affected_count,applied:!0}))}}),L=l=>{confirm(t("common.confirmDelete"))&&(c(l),C.mutate(l))},Q=()=>{x.trim()&&w.mutate({keyword:x.trim(),category:j,match_type:b,priority:10})},I=l=>{w.mutate({keyword:l.keyword,category:l.suggested_category,match_type:"contains",priority:10})};return v?e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("categoryRules.title")})]}),e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(M,{size:"md"})})]}):e.jsxs(U,{title:t("categoryRules.title"),badge:(k==null?void 0:k.length)||0,children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!k||k.length===0)&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>_.mutate(),disabled:_.isPending,children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),_.isPending?t("common.loading"):t("categoryRules.seedDefaults")]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>u(!o),children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),t("categoryRules.addRule")]})]}),o&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:t("categoryRules.keyword"),value:x,onChange:l=>p(l.target.value),className:F("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),e.jsx("select",{value:j,onChange:l=>r(l.target.value),className:F("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:Ae.map(l=>e.jsx("option",{value:l,children:l},l))}),e.jsxs("select",{value:b,onChange:l=>f(l.target.value),className:F("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[e.jsx("option",{value:"contains",children:t("categoryRules.contains")}),e.jsx("option",{value:"starts_with",children:t("categoryRules.startsWith")}),e.jsx("option",{value:"exact",children:t("categoryRules.exact")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>u(!1),children:t("common.cancel")}),e.jsx(N,{size:"sm",onClick:Q,disabled:!x.trim()||w.isPending,children:w.isPending?t("common.saving"):t("common.save")})]})]}),k&&k.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-6",children:k.map(l=>e.jsxs("div",{className:F("flex items-center justify-between p-3 rounded-lg border",l.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:l.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:l.category}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",t(Te[l.match_type]),")"]})]}),e.jsx("button",{onClick:()=>L(l.id),disabled:s===l.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:s===l.id?e.jsx(M,{size:"sm"}):e.jsx(G,{className:"w-4 h-4"})})]},l.id))}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("categoryRules.applyDescription")}),m&&e.jsx("p",{className:F("text-sm mt-1",m.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:m.applied?t("categoryRules.appliedCount",{count:m.count}):t("categoryRules.previewCount",{count:m.count})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>D.mutate(!0),disabled:D.isPending,children:D.isPending?t("common.loading"):t("categoryRules.preview")}),e.jsxs(N,{size:"sm",onClick:()=>D.mutate(!1),disabled:D.isPending||(m==null?void 0:m.count)===0,children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),t("categoryRules.applyNow")]})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("categoryRules.noRules")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("categoryRules.noRulesDescription")})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[e.jsx("button",{onClick:()=>g(!y),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:t(y?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),y&&e.jsx("div",{className:"mt-4 space-y-2",children:S?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(M,{size:"sm"})}):n&&n.length>0?n.map((l,K)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:l.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:l.suggested_category}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",l.count,"x)"]})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>I(l),disabled:w.isPending,children:e.jsx(ke,{className:"w-4 h-4"})})]},K)):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:t("categoryRules.noSuggestions")})})]})]})}const We=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function Le({isOpen:t,onClose:d,defaultType:s="expense",onCreated:c}){const{t:o}=T("common"),u=Ce(),[y,g]=i.useState(""),[m,h]=i.useState("ðŸ“"),[x,p]=i.useState(s),[j,r]=i.useState(""),b=async v=>{var S,C;v.preventDefault(),r("");const n=y.trim();if(!n){r(o("category.errors.nameRequired","Name is required"));return}try{const _=`custom_${(await u.mutateAsync({name:n,icon:m,type:x})).id}`;c==null||c(_),f()}catch(w){r(((C=(S=w.response)==null?void 0:S.data)==null?void 0:C.detail)||o("category.errors.createFailed","Failed to create category"))}},f=()=>{g(""),h("ðŸ“"),p(s),r(""),d()};if(!t)return null;const k=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:f}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:o("category.createTitle","Create Category")}),e.jsx("button",{onClick:f,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(V,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("category.name","Category Name")}),e.jsx("input",{type:"text",value:y,onChange:v=>g(v.target.value),placeholder:o("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:We.map(v=>e.jsx("button",{type:"button",onClick:()=>h(v),className:F("w-8 h-8 text-lg rounded flex items-center justify-center",m===v?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:v},v))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("category.type","Type")}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>p("expense"),className:F("flex-1 py-2 rounded-md text-sm font-medium transition-colors",x==="expense"?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:o("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>p("income"),className:F("flex-1 py-2 rounded-md text-sm font-medium transition-colors",x==="income"?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:o("transaction.income","Income")})]})]}),j&&e.jsx("p",{className:"text-sm text-red-500",children:j}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:f,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:o("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:u.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:u.isPending?"...":o("common.create","Create")})]})]})]})]});return typeof document>"u"?null:Y.createPortal(k,document.body)}const Ie=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function Ke({isOpen:t,onClose:d,category:s}){const{t:c}=T("common"),o=O(),[u,y]=i.useState(""),[g,m]=i.useState("ðŸ“"),[h,x]=i.useState(""),[p,j]=i.useState(null);i.useEffect(()=>{s&&(y(s.name),m(s.icon),x(""),j(null))},[s]);const r=R({mutationFn:n=>we(s.id,n),onSuccess:n=>{j(n.affected_transactions),o.invalidateQueries({queryKey:["categories"]}),o.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{f()},1500)},onError:n=>{var C,w;x(((w=(C=n.response)==null?void 0:C.data)==null?void 0:w.detail)||c("category.errors.updateFailed","Failed to update category"))}}),b=async n=>{n.preventDefault(),x("");const S=u.trim();if(!S){x(c("category.errors.nameRequired","Name is required"));return}const C={};if(S!==(s==null?void 0:s.name)&&(C.name=S),g!==(s==null?void 0:s.icon)&&(C.icon=g),Object.keys(C).length===0){f();return}r.mutate(C)},f=()=>{y(""),m("ðŸ“"),x(""),j(null),d()};if(!t||!s)return null;const k=u.trim()!==s.name,v=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:f}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:c("category.editTitle","Edit Category")}),e.jsx("button",{onClick:f,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(V,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),p!==null&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[c("category.updateSuccess","Category updated!"),p>0&&e.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:c("category.transactionsUpdated","{{count}} transactions updated",{count:p})})]})}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("category.name","Category Name")}),e.jsx("input",{type:"text",value:u,onChange:n=>y(n.target.value),placeholder:c("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),k&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[e.jsx(ve,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:c("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:Ie.map(n=>e.jsx("button",{type:"button",onClick:()=>m(n),className:F("w-8 h-8 text-lg rounded flex items-center justify-center",g===n?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:n},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("category.type","Type")}),e.jsx("div",{className:F("h-10 px-3 flex items-center rounded-lg text-sm font-medium",s.type==="expense"?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:s.type==="expense"?c("transaction.expense","Expense"):c("transaction.income","Income")})]}),h&&e.jsx("p",{className:"text-sm text-red-500",children:h}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:f,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:c("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:r.isPending||p!==null,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:r.isPending?"...":c("common.save","Save")})]})]})]})]});return typeof document>"u"?null:Y.createPortal(v,document.body)}function ze(){const{t}=T("common"),{data:d=[],isLoading:s}=Se(),c=Re(),[o,u]=i.useState(!1),[y,g]=i.useState(null),[m,h]=i.useState(null),x=async r=>{try{await c.mutateAsync(r),h(null)}catch(b){console.error("Failed to delete category:",b)}},p=d.filter(r=>r.type==="expense"),j=d.filter(r=>r.type==="income");return e.jsxs(e.Fragment,{children:[e.jsxs(U,{title:t("settings.categoryManagement"),badge:d.length,children:[s?e.jsx("div",{className:"py-4 text-center text-gray-400",children:t("common.loading")}):d.length===0?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noCategories")}):e.jsxs("div",{className:"space-y-4",children:[p.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.expense","Expense")}),e.jsx("div",{className:"space-y-2",children:p.map(r=>e.jsx(B,{category:r,onEdit:()=>g(r),onDelete:()=>h(r.id),isDeleting:c.isPending&&m===r.id,showDeleteConfirm:m===r.id,onConfirmDelete:()=>x(r.id),onCancelDelete:()=>h(null)},r.id))})]}),j.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.income","Income")}),e.jsx("div",{className:"space-y-2",children:j.map(r=>e.jsx(B,{category:r,onEdit:()=>g(r),onDelete:()=>h(r.id),isDeleting:c.isPending&&m===r.id,showDeleteConfirm:m===r.id,onConfirmDelete:()=>x(r.id),onCancelDelete:()=>h(null)},r.id))})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(N,{variant:"outline",onClick:()=>u(!0),children:t("settings.addCategory")})})]}),e.jsx(Le,{isOpen:o,onClose:()=>u(!1)}),e.jsx(Ke,{isOpen:!!y,onClose:()=>g(null),category:y})]})}function B({category:t,onEdit:d,onDelete:s,isDeleting:c,showDeleteConfirm:o,onConfirmDelete:u,onCancelDelete:y}){const{t:g}=T("common");return o?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:g("category.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:g("common.cancel")}),e.jsx("button",{onClick:u,disabled:c,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:c?"...":g("common.delete")})]})]}):e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:d,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:g("common.edit"),children:e.jsx(Ne,{size:16})}),e.jsx("button",{onClick:s,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:g("common.delete"),children:e.jsx(G,{size:16})})]})]})}const H=["eth","bsc","polygon"];function Oe(){const{t}=T("common"),d=O(),[s,c]=i.useState(!1),[o,u]=i.useState(""),[y,g]=i.useState(""),[m,h]=i.useState(["eth","bsc","polygon"]),[x,p]=i.useState(!1),[j,r]=i.useState("polygon"),[b,f]=i.useState(""),[k,v]=i.useState(""),[n,S]=i.useState(""),[C,w]=i.useState(null),{data:_,isLoading:D}=z({queryKey:["crypto-wallets"],queryFn:ge}),{data:L,isLoading:Q}=z({queryKey:["reward-contracts"],queryFn:xe}),I=R({mutationFn:ie,onSuccess:()=>{d.invalidateQueries({queryKey:["crypto-wallets"]}),c(!1),Z()}}),l=R({mutationFn:ce,onSuccess:()=>{d.invalidateQueries({queryKey:["crypto-wallets"]})}}),K=R({mutationFn:de,onSuccess:()=>{d.invalidateQueries({queryKey:["crypto-wallets"]}),d.invalidateQueries({queryKey:["dashboard-summary"]}),w(null)},onError:()=>{w(null)}}),J=R({mutationFn:oe,onSuccess:()=>{d.invalidateQueries({queryKey:["reward-contracts"]}),p(!1),ee()}}),X=R({mutationFn:me,onSuccess:()=>{d.invalidateQueries({queryKey:["reward-contracts"]})}}),Z=()=>{u(""),g(""),h(["eth","bsc","polygon"])},ee=()=>{r("polygon"),f(""),v(""),S("")},te=()=>{if(!o||!o.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}I.mutate({wallet_address:o,label:y||void 0,chains:m})},ae=a=>{w(a),K.mutate(a)},se=()=>{if(!b||!b.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}J.mutate({chain_id:j,contract_address:b,label:k||void 0,token_symbol:n||void 0})},re=a=>{h(E=>E.includes(a)?E.filter(ne=>ne!==a):[...E,a])};return D||Q?e.jsx(A,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(M,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(A,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.wallets")}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>c(!s),children:t(s?"common.cancel":"crypto.addWallet")})]}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(q,{label:t("crypto.walletAddress"),placeholder:"0x...",value:o,onChange:a=>u(a.target.value)}),e.jsx(q,{label:t("crypto.walletLabel"),placeholder:t("crypto.labelPlaceholder"),value:y,onChange:a=>g(a.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(a=>e.jsxs("button",{type:"button",onClick:()=>re(a),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${m.includes(a)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[P[a].icon," ",P[a].name]},a))})]}),e.jsx(N,{onClick:te,disabled:I.isPending,className:"w-full",children:I.isPending?t("common.loading"):t("crypto.addWallet")})]}),e.jsx("div",{className:"space-y-3",children:_&&_.length>0?_.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.label||t("crypto.unnamedWallet")}),e.jsx("div",{className:"flex gap-1",children:a.chains.map(E=>e.jsx("span",{title:P[E].name,children:P[E].icon},E))})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:a.wallet_address})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>ae(a.id),disabled:C===a.id,children:C===a.id?e.jsx(M,{size:"sm"}):t("crypto.sync")}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteWallet"))&&l.mutate(a.id)},className:"text-red-600 hover:text-red-700 text-sm",children:t("common.delete")})]})]},a.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noWallets")})})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.rewardContracts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("crypto.rewardContractsDescription")})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>p(!x),children:t(x?"common.cancel":"crypto.addContract")})]}),x&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chain")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(a=>e.jsxs("button",{type:"button",onClick:()=>r(a),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${j===a?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[P[a].icon," ",P[a].name]},a))})]}),e.jsx(q,{label:t("crypto.contractAddress"),placeholder:"0x...",value:b,onChange:a=>f(a.target.value)}),e.jsx(q,{label:t("crypto.contractLabel"),placeholder:t("crypto.contractLabelPlaceholder"),value:k,onChange:a=>v(a.target.value)}),e.jsx(q,{label:t("crypto.tokenSymbol"),placeholder:"STEER",value:n,onChange:a=>S(a.target.value)}),e.jsx(N,{onClick:se,disabled:J.isPending,className:"w-full",children:J.isPending?t("common.loading"):t("crypto.addContract")})]}),e.jsx("div",{className:"space-y-3",children:L&&L.length>0?L.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{title:P[a.chain_id].name,children:P[a.chain_id].icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.label||t("crypto.unnamedContract")}),a.token_symbol&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:a.token_symbol})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:a.contract_address})]}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteContract"))&&X.mutate(a.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:t("common.delete")})]},a.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noContracts")})})]})]})}function Qe(){var k,v;const{t}=T("common"),d=O(),{data:s,isLoading:c}=z({queryKey:["settings"],queryFn:ye}),[o,u]=i.useState("JPY"),[y,g]=i.useState(25),[m,h]=i.useState(!1),[x,p]=i.useState(!0),[j,r]=i.useState(1e6);i.useEffect(()=>{s&&(u(s.currency),g(s.base_date),h(s.budget_carry_over),p(s.budget_email_alerts),r(s.large_transaction_threshold))},[s]);const b=R({mutationFn:ue,onSuccess:()=>{d.invalidateQueries({queryKey:["settings"]}),d.invalidateQueries({queryKey:["dashboard-summary"]}),d.invalidateQueries({queryKey:["transactions"]}),d.invalidateQueries({queryKey:["analytics"]}),alert(t("settings.saveSuccess"))},onError:n=>{console.error("Failed to save settings:",n),alert(t("settings.saveFailed"))}}),f=()=>{b.mutate({currency:o,base_date:y,budget_carry_over:m,budget_email_alerts:x,large_transaction_threshold:j})};return c?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(M,{size:"lg"})}):e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:t("settings.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("settings.subtitle")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:t("settings.general")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(he,{label:t("settings.currency"),value:o,onChange:n=>u(n.target.value),options:[{value:"JPY",label:t("settings.currencyJPY")},{value:"USD",label:t("settings.currencyUSD")},{value:"VND",label:t("settings.currencyVND")}]}),e.jsx(q,{type:"number",label:t("settings.payday"),value:y,onChange:n=>g(parseInt(n.target.value,10)),min:1,max:31})]}),e.jsx("div",{className:"mt-6",children:e.jsx(N,{onClick:f,disabled:b.isPending,children:b.isPending?t("common.loading"):t("settings.saveSettings")})})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:t("settings.budgetSettings")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:t("settings.budgetCarryOver")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("settings.budgetCarryOverDescription")})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:n=>h(n.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:t("settings.budgetEmailAlerts")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("settings.budgetEmailAlertsDescription")})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:n=>p(n.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:t("settings.largeTransactionThreshold")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:t("settings.largeTransactionThresholdDescription")}),e.jsx(q,{type:"number",value:j,onChange:n=>r(parseInt(n.target.value,10)||0),min:0,step:1e5,placeholder:"1000000"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:t("settings.largeTransactionThresholdHint")})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(N,{onClick:f,disabled:b.isPending,children:b.isPending?t("common.loading"):t("settings.saveSettings")})})]}),e.jsx(ze,{}),e.jsxs(U,{title:t("settings.paymentSourceManagement"),badge:((k=s==null?void 0:s.sources)==null?void 0:k.length)||0,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:((v=s==null?void 0:s.sources)==null?void 0:v.map((n,S)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:n}),e.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:t("settings.delete")})]},S)))||e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noSources")})}),e.jsx("div",{className:"mt-4",children:e.jsx(N,{variant:"outline",children:t("settings.addSource")})})]}),e.jsx(Me,{}),e.jsx(pe,{}),e.jsx(Oe,{})]})]})}const tt=le("/settings")({component:Qe});export{tt as Route};
