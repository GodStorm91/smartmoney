import{k as Dr,aQ as T,aP as _e,r as O,Y as zt,K as Rt,u as z,aj as we,j as i,aM as I,l as M,aw as zn,ax as Mr,J as Lr,a6 as fn,z as Ct,C as V,D as Dt,aY as Rn,G as Br,a1 as Fe,B as rt,x as Fr,aZ as hn,a_ as fe,a$ as ht,L as $r,h as Kn,aS as zr,ay as Rr,b0 as Kr,t as Vn,S as Me,R as Vr,av as Hr,b1 as Yr,b2 as Ur,b3 as Wr,a0 as Gr,b4 as qr,Z as Xr,b5 as oe,b6 as Jr,aI as Qr,i as Zr}from"./index-Cl0A3kUX.js";import{f as ft,L as it,B as ce,n as Tt,C as he,A as Hn,l as st,h as yt,E as ts,m as $e,F as es,o as Qt,G as Yn,j as It,H as pe,i as ge,D as ns,u as Un,S as mn,I as rs,d as ss,r as Wn,J as is,K as as,s as Zt,x as Gn,M as Mt,N as qn,R as ke,O as Se,P as Xn,Q as os}from"./generateCategoricalChart-ya-rBU0X.js";import{X as Kt,Y as Vt,L as qe,C as Jn,a as cs}from"./LineChart-MXc9O0K-.js";import{c as pn,a as gn,A as ls,b as us}from"./ai-categorization-service-DamaYoS4.js";import{D as ds}from"./download-GRogSqWg.js";import{M as fs}from"./mail-lWNQphjl.js";import{C as hs}from"./chevron-up-DMjJEdY9.js";import{C as ms}from"./chevron-down-geDZ1eWv.js";import{T as ze}from"./triangle-alert-BRsbzUu_.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M5 12h14",key:"1ays0h"}]],gs=Dr("minus",ps);var ys=["layout","type","stroke","connectNulls","isRange","ref"],xs=["key"],Qn;function Lt(e){"@babel/helpers - typeof";return Lt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(e)}function Zn(e,t){if(e==null)return{};var n=bs(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function bs(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function _t(){return _t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_t.apply(this,arguments)}function yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yn(Object(n),!0).forEach(function(r){at(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function vs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,er(r.key),r)}}function js(e,t,n){return t&&xn(e.prototype,t),n&&xn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _s(e,t,n){return t=ye(t),ws(e,tr()?Reflect.construct(t,n||[],ye(e).constructor):t.apply(e,n))}function ws(e,t){if(t&&(Lt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ks(e)}function ks(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tr=function(){return!!e})()}function ye(e){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ye(e)}function Ss(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Re(e,t)}function Re(e,t){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Re(e,t)}function at(e,t,n){return t=er(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function er(e){var t=As(e,"string");return Lt(t)=="symbol"?t:t+""}function As(e,t){if(Lt(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Lt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var kt=function(e){function t(){var n;vs(this,t);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return n=_s(this,t,[].concat(s)),at(n,"state",{isAnimationFinished:!0}),at(n,"id",Un("recharts-area-")),at(n,"handleAnimationEnd",function(){var o=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),ge(o)&&o()}),at(n,"handleAnimationStart",function(){var o=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),ge(o)&&o()}),n}return Ss(t,e),js(t,[{key:"renderDots",value:function(r,s,a){var o=this.props.isAnimationActive,l=this.state.isAnimationFinished;if(o&&!l)return null;var c=this.props,u=c.dot,d=c.points,f=c.dataKey,h=ft(this.props,!1),p=ft(u,!0),m=d.map(function(b,g){var x=gt(gt(gt({key:"dot-".concat(g),r:3},h),p),{},{index:g,cx:b.x,cy:b.y,dataKey:f,value:b.value,payload:b.payload,points:d});return t.renderDotItem(u,x)}),y={clipPath:r?"url(#clipPath-".concat(s?"":"dots-").concat(a,")"):null};return T.createElement(it,_t({className:"recharts-area-dots"},y),m)}},{key:"renderHorizontalRect",value:function(r){var s=this.props,a=s.baseLine,o=s.points,l=s.strokeWidth,c=o[0].x,u=o[o.length-1].x,d=r*Math.abs(c-u),f=ce(o.map(function(h){return h.y||0}));return Tt(a)&&typeof a=="number"?f=Math.max(a,f):a&&Array.isArray(a)&&a.length&&(f=Math.max(ce(a.map(function(h){return h.y||0})),f)),Tt(f)?T.createElement("rect",{x:c<u?c:c-d,y:0,width:d,height:Math.floor(f+(l?parseInt("".concat(l),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var s=this.props,a=s.baseLine,o=s.points,l=s.strokeWidth,c=o[0].y,u=o[o.length-1].y,d=r*Math.abs(c-u),f=ce(o.map(function(h){return h.x||0}));return Tt(a)&&typeof a=="number"?f=Math.max(a,f):a&&Array.isArray(a)&&a.length&&(f=Math.max(ce(a.map(function(h){return h.x||0})),f)),Tt(f)?T.createElement("rect",{x:0,y:c<u?c:c-d,width:f+(l?parseInt("".concat(l),10):1),height:Math.floor(d)}):null}},{key:"renderClipRect",value:function(r){var s=this.props.layout;return s==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,s,a,o){var l=this.props,c=l.layout,u=l.type,d=l.stroke,f=l.connectNulls,h=l.isRange;l.ref;var p=Zn(l,ys);return T.createElement(it,{clipPath:a?"url(#clipPath-".concat(o,")"):null},T.createElement(he,_t({},ft(p,!0),{points:r,connectNulls:f,type:u,baseLine:s,layout:c,stroke:"none",className:"recharts-area-area"})),d!=="none"&&T.createElement(he,_t({},ft(this.props,!1),{className:"recharts-area-curve",layout:c,type:u,connectNulls:f,fill:"none",points:r})),d!=="none"&&h&&T.createElement(he,_t({},ft(this.props,!1),{className:"recharts-area-curve",layout:c,type:u,connectNulls:f,fill:"none",points:s})))}},{key:"renderAreaWithAnimation",value:function(r,s){var a=this,o=this.props,l=o.points,c=o.baseLine,u=o.isAnimationActive,d=o.animationBegin,f=o.animationDuration,h=o.animationEasing,p=o.animationId,m=this.state,y=m.prevPoints,b=m.prevBaseLine;return T.createElement(Hn,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"area-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(g){var x=g.t;if(y){var v=y.length/l.length,_=l.map(function(S,N){var E=Math.floor(N*v);if(y[E]){var P=y[E],C=st(P.x,S.x),H=st(P.y,S.y);return gt(gt({},S),{},{x:C(x),y:H(x)})}return S}),k;if(Tt(c)&&typeof c=="number"){var w=st(b,c);k=w(x)}else if(yt(c)||ts(c)){var j=st(b,0);k=j(x)}else k=c.map(function(S,N){var E=Math.floor(N*v);if(b[E]){var P=b[E],C=st(P.x,S.x),H=st(P.y,S.y);return gt(gt({},S),{},{x:C(x),y:H(x)})}return S});return a.renderAreaStatically(_,k,r,s)}return T.createElement(it,null,T.createElement("defs",null,T.createElement("clipPath",{id:"animationClipPath-".concat(s)},a.renderClipRect(x))),T.createElement(it,{clipPath:"url(#animationClipPath-".concat(s,")")},a.renderAreaStatically(l,c,r,s)))})}},{key:"renderArea",value:function(r,s){var a=this.props,o=a.points,l=a.baseLine,c=a.isAnimationActive,u=this.state,d=u.prevPoints,f=u.prevBaseLine,h=u.totalLength;return c&&o&&o.length&&(!d&&h>0||!$e(d,o)||!$e(f,l))?this.renderAreaWithAnimation(r,s):this.renderAreaStatically(o,l,r,s)}},{key:"render",value:function(){var r,s=this.props,a=s.hide,o=s.dot,l=s.points,c=s.className,u=s.top,d=s.left,f=s.xAxis,h=s.yAxis,p=s.width,m=s.height,y=s.isAnimationActive,b=s.id;if(a||!l||!l.length)return null;var g=this.state.isAnimationFinished,x=l.length===1,v=_e("recharts-area",c),_=f&&f.allowDataOverflow,k=h&&h.allowDataOverflow,w=_||k,j=yt(b)?this.id:b,S=(r=ft(o,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},N=S.r,E=N===void 0?3:N,P=S.strokeWidth,C=P===void 0?2:P,H=es(o)?o:{},W=H.clipDot,G=W===void 0?!0:W,X=E*2+C;return T.createElement(it,{className:v},_||k?T.createElement("defs",null,T.createElement("clipPath",{id:"clipPath-".concat(j)},T.createElement("rect",{x:_?d:d-p/2,y:k?u:u-m/2,width:_?p:p*2,height:k?m:m*2})),!G&&T.createElement("clipPath",{id:"clipPath-dots-".concat(j)},T.createElement("rect",{x:d-X/2,y:u-X/2,width:p+X,height:m+X}))):null,x?null:this.renderArea(w,j),(o||x)&&this.renderDots(w,G,j),(!y||g)&&Qt.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:s.curPoints,prevBaseLine:s.curBaseLine}:r.points!==s.curPoints||r.baseLine!==s.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])}(O.PureComponent);Qn=kt;at(kt,"displayName","Area");at(kt,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Yn.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});at(kt,"getBaseValue",function(e,t,n,r){var s=e.layout,a=e.baseValue,o=t.props.baseValue,l=o??a;if(Tt(l)&&typeof l=="number")return l;var c=s==="horizontal"?r:n,u=c.scale.domain();if(c.type==="number"){var d=Math.max(u[0],u[1]),f=Math.min(u[0],u[1]);return l==="dataMin"?f:l==="dataMax"||d<0?d:Math.max(Math.min(u[0],u[1]),0)}return l==="dataMin"?u[0]:l==="dataMax"?u[1]:u[0]});at(kt,"getComposedData",function(e){var t=e.props,n=e.item,r=e.xAxis,s=e.yAxis,a=e.xAxisTicks,o=e.yAxisTicks,l=e.bandSize,c=e.dataKey,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=t.layout,m=u&&u.length,y=Qn.getBaseValue(t,n,r,s),b=p==="horizontal",g=!1,x=f.map(function(_,k){var w;m?w=u[d+k]:(w=It(_,c),Array.isArray(w)?g=!0:w=[y,w]);var j=w[1]==null||m&&It(_,c)==null;return b?{x:pe({axis:r,ticks:a,bandSize:l,entry:_,index:k}),y:j?null:s.scale(w[1]),value:w,payload:_}:{x:j?null:r.scale(w[1]),y:pe({axis:s,ticks:o,bandSize:l,entry:_,index:k}),value:w,payload:_}}),v;return m||g?v=x.map(function(_){var k=Array.isArray(_.value)?_.value[0]:null;return b?{x:_.x,y:k!=null&&_.y!=null?s.scale(k):null}:{x:k!=null?r.scale(k):null,y:_.y}}):v=b?s.scale(y):r.scale(y),gt({points:x,baseLine:v,layout:p,isRange:g},h)});at(kt,"renderDotItem",function(e,t){var n;if(T.isValidElement(e))n=T.cloneElement(e,t);else if(ge(e))n=e(t);else{var r=_e("recharts-area-dot",typeof e!="boolean"?e.className:""),s=t.key,a=Zn(t,xs);n=T.createElement(ns,_t({},a,{key:s,className:r}))}return n});function Bt(e){"@babel/helpers - typeof";return Bt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bt(e)}function Ns(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Es(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sr(r.key),r)}}function Ps(e,t,n){return t&&Es(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Os(e,t,n){return t=xe(t),Ts(e,nr()?Reflect.construct(t,n||[],xe(e).constructor):t.apply(e,n))}function Ts(e,t){if(t&&(Bt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cs(e)}function Cs(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nr=function(){return!!e})()}function xe(e){return xe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},xe(e)}function Is(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ke(e,t)}function Ke(e,t){return Ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Ke(e,t)}function rr(e,t,n){return t=sr(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sr(e){var t=Ds(e,"string");return Bt(t)=="symbol"?t:t+""}function Ds(e,t){if(Bt(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Bt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ae=function(e){function t(){return Ns(this,t),Os(this,t,arguments)}return Is(t,e),Ps(t,[{key:"render",value:function(){return null}}])}(O.Component);rr(Ae,"displayName","ZAxis");rr(Ae,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var Ms=["option","isActive"];function qt(){return qt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qt.apply(this,arguments)}function Ls(e,t){if(e==null)return{};var n=Bs(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Bs(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function Fs(e){var t=e.option,n=e.isActive,r=Ls(e,Ms);return typeof t=="string"?O.createElement(mn,qt({option:O.createElement(rs,qt({type:t},r)),isActive:n,shapeType:"symbols"},r)):O.createElement(mn,qt({option:t,isActive:n,shapeType:"symbols"},r))}function Ft(e){"@babel/helpers - typeof";return Ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(e)}function Xt(){return Xt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xt.apply(this,arguments)}function bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bn(Object(n),!0).forEach(function(r){xt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bn(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function $s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ar(r.key),r)}}function zs(e,t,n){return t&&vn(e.prototype,t),n&&vn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Rs(e,t,n){return t=be(t),Ks(e,ir()?Reflect.construct(t,n||[],be(e).constructor):t.apply(e,n))}function Ks(e,t){if(t&&(Ft(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Vs(e)}function Vs(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ir(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ir=function(){return!!e})()}function be(e){return be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},be(e)}function Hs(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ve(e,t)}function Ve(e,t){return Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Ve(e,t)}function xt(e,t,n){return t=ar(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ar(e){var t=Ys(e,"string");return Ft(t)=="symbol"?t:t+""}function Ys(e,t){if(Ft(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Ft(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ne=function(e){function t(){var n;$s(this,t);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return n=Rs(this,t,[].concat(s)),xt(n,"state",{isAnimationFinished:!1}),xt(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0})}),xt(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1})}),xt(n,"id",Un("recharts-scatter-")),n}return Hs(t,e),zs(t,[{key:"renderSymbolsStatically",value:function(r){var s=this,a=this.props,o=a.shape,l=a.activeShape,c=a.activeIndex,u=ft(this.props,!1);return r.map(function(d,f){var h=c===f,p=h?l:o,m=Q(Q({},u),d);return T.createElement(it,Xt({className:"recharts-scatter-symbol",key:"symbol-".concat(d==null?void 0:d.cx,"-").concat(d==null?void 0:d.cy,"-").concat(d==null?void 0:d.size,"-").concat(f)},ss(s.props,d,f),{role:"img"}),T.createElement(Fs,Xt({option:p,isActive:h,key:"symbol-".concat(f)},m)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,s=this.props,a=s.points,o=s.isAnimationActive,l=s.animationBegin,c=s.animationDuration,u=s.animationEasing,d=s.animationId,f=this.state.prevPoints;return T.createElement(Hn,{begin:l,duration:c,isActive:o,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(d),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(h){var p=h.t,m=a.map(function(y,b){var g=f&&f[b];if(g){var x=st(g.cx,y.cx),v=st(g.cy,y.cy),_=st(g.size,y.size);return Q(Q({},y),{},{cx:x(p),cy:v(p),size:_(p)})}var k=st(0,y.size);return Q(Q({},y),{},{size:k(p)})});return T.createElement(it,null,r.renderSymbolsStatically(m))})}},{key:"renderSymbols",value:function(){var r=this.props,s=r.points,a=r.isAnimationActive,o=this.state.prevPoints;return a&&s&&s.length&&(!o||!$e(o,s))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(s)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var s=this.props,a=s.points,o=s.xAxis,l=s.yAxis,c=s.children,u=Wn(c,is);return u?u.map(function(d,f){var h=d.props,p=h.direction,m=h.dataKey;return T.cloneElement(d,{key:"".concat(p,"-").concat(m,"-").concat(a[f]),data:a,xAxis:o,yAxis:l,layout:p==="x"?"vertical":"horizontal",dataPointFormatter:function(b,g){return{x:b.cx,y:b.cy,value:p==="x"?+b.node.x:+b.node.y,errorVal:It(b,g)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,s=r.points,a=r.line,o=r.lineType,l=r.lineJointType,c=ft(this.props,!1),u=ft(a,!1),d,f;if(o==="joint")d=s.map(function(v){return{x:v.cx,y:v.cy}});else if(o==="fitting"){var h=as(s),p=h.xmin,m=h.xmax,y=h.a,b=h.b,g=function(_){return y*_+b};d=[{x:p,y:g(p)},{x:m,y:g(m)}]}var x=Q(Q(Q({},c),{},{fill:"none",stroke:c&&c.fill},u),{},{points:d});return T.isValidElement(a)?f=T.cloneElement(a,x):ge(a)?f=a(x):f=T.createElement(he,Xt({},x,{type:l})),T.createElement(it,{className:"recharts-scatter-line",key:"recharts-scatter-line"},f)}},{key:"render",value:function(){var r=this.props,s=r.hide,a=r.points,o=r.line,l=r.className,c=r.xAxis,u=r.yAxis,d=r.left,f=r.top,h=r.width,p=r.height,m=r.id,y=r.isAnimationActive;if(s||!a||!a.length)return null;var b=this.state.isAnimationFinished,g=_e("recharts-scatter",l),x=c&&c.allowDataOverflow,v=u&&u.allowDataOverflow,_=x||v,k=yt(m)?this.id:m;return T.createElement(it,{className:g,clipPath:_?"url(#clipPath-".concat(k,")"):null},x||v?T.createElement("defs",null,T.createElement("clipPath",{id:"clipPath-".concat(k)},T.createElement("rect",{x:x?d:d-h/2,y:v?f:f-p/2,width:x?h:h*2,height:v?p:p*2}))):null,o&&this.renderLine(),this.renderErrorBar(),T.createElement(it,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!y||b)&&Qt.renderCallByParent(this.props,a))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:s.curPoints}:r.points!==s.curPoints?{curPoints:r.points}:null}}])}(O.PureComponent);xt(Ne,"displayName","Scatter");xt(Ne,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Yn.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});xt(Ne,"getComposedData",function(e){var t=e.xAxis,n=e.yAxis,r=e.zAxis,s=e.item,a=e.displayedData,o=e.xAxisTicks,l=e.yAxisTicks,c=e.offset,u=s.props.tooltipType,d=Wn(s.props.children,Zt),f=yt(t.dataKey)?s.props.dataKey:t.dataKey,h=yt(n.dataKey)?s.props.dataKey:n.dataKey,p=r&&r.dataKey,m=r?r.range:Ae.defaultProps.range,y=m&&m[0],b=t.scale.bandwidth?t.scale.bandwidth():0,g=n.scale.bandwidth?n.scale.bandwidth():0,x=a.map(function(v,_){var k=It(v,f),w=It(v,h),j=!yt(p)&&It(v,p)||"-",S=[{name:yt(t.dataKey)?s.props.name:t.name||t.dataKey,unit:t.unit||"",value:k,payload:v,dataKey:f,type:u},{name:yt(n.dataKey)?s.props.name:n.name||n.dataKey,unit:n.unit||"",value:w,payload:v,dataKey:h,type:u}];j!=="-"&&S.push({name:r.name||r.dataKey,unit:r.unit||"",value:j,payload:v,dataKey:p,type:u});var N=pe({axis:t,ticks:o,bandSize:b,entry:v,index:_,dataKey:f}),E=pe({axis:n,ticks:l,bandSize:g,entry:v,index:_,dataKey:h}),P=j!=="-"?r.scale(j):y,C=Math.sqrt(Math.max(P,0)/Math.PI);return Q(Q({},v),{},{cx:N,cy:E,x:N-C,y:E-C,xAxis:t,yAxis:n,zAxis:r,width:2*C,height:2*C,size:P,node:{x:k,y:w,z:j},tooltipPayload:S,tooltipPosition:{x:N,y:E},payload:v},d&&d[_]&&d[_].props)});return Q({points:x},c)});var or=Gn({chartName:"BarChart",GraphicalChild:Mt,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Kt},{axisType:"yAxis",AxisComp:Vt}],formatAxisMap:qn}),Us=Gn({chartName:"ComposedChart",GraphicalChild:[qe,kt,Mt,Ne],axisComponents:[{axisType:"xAxis",AxisComp:Kt},{axisType:"yAxis",AxisComp:Vt},{axisType:"zAxis",AxisComp:Ae}],formatAxisMap:qn});function jn(e,t){if(e===0)return"";const n=Math.abs(e);return t==="VND"?n>=1e6?`${(e/1e6).toFixed(1)}M`:n>=1e3?`${(e/1e3).toFixed(0)}K`:e.toString():t==="JPY"?n>=1e4?`${(e/1e4).toFixed(1)}万`:n>=1e3?`${(e/1e3).toFixed(0)}K`:e.toString():n>=1e6?`${(e/1e6).toFixed(1)}M`:n>=1e3?`${(e/1e3).toFixed(0)}K`:e.toString()}function cr({data:e}){const{currency:t}=zt(),{data:n}=Rt(),{t:r}=z("common"),{resolvedTheme:s}=we(),a=s==="dark",o=a?"#45475a":"#E5E7EB",l=a?"#a6adc8":"#6B7280",c=a?"#1e1e2e":"#fff",u=a?"#45475a":"#E5E7EB",d=a?"#cdd6f4":"#374151",f=e.every(p=>p.expenses===0),h=e.map(p=>({...p,net:p.income-p.expenses}));return i.jsx(ke,{width:"100%",height:"100%",children:i.jsxs(Us,{data:h,margin:{top:20,right:30,left:20,bottom:5},children:[i.jsx(Jn,{strokeDasharray:"3 3",stroke:o}),i.jsx(Kt,{dataKey:"month",stroke:l,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),i.jsx(Vt,{stroke:l,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:p=>I(p,t,(n==null?void 0:n.rates)||{},!1)}),i.jsx(Se,{contentStyle:{backgroundColor:c,border:`1px solid ${u}`,borderRadius:"8px",fontSize:"14px",color:d},formatter:(p,m)=>[I(p,t,(n==null?void 0:n.rates)||{},!1),m],labelFormatter:p=>p}),i.jsx(Xn,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:d}}),i.jsx(Mt,{dataKey:"income",fill:"#4CAF50",name:r("chart.income"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:i.jsx(Qt,{dataKey:"income",position:"top",formatter:p=>jn(p,t),style:{fontSize:"10px",fill:"#4CAF50",fontWeight:500}})}),i.jsxs(Mt,{dataKey:"expenses",fill:"#F44336",name:r("chart.expense"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:200,animationDuration:800,animationEasing:"ease-out",children:[f?h.map((p,m)=>i.jsx(Zt,{fill:"#F4433633"},`cell-${m}`)):h.map((p,m)=>i.jsx(Zt,{fill:p.expenses===0?"#F4433633":"#F44336"},`cell-${m}`)),i.jsx(Qt,{dataKey:"expenses",position:"top",formatter:p=>jn(p,t),style:{fontSize:"10px",fill:"#F44336",fontWeight:500}})]}),i.jsx(qe,{type:"monotone",dataKey:"net",name:r("chart.net"),stroke:"#2196F3",strokeWidth:2,dot:{fill:"#2196F3",strokeWidth:2,r:4},activeDot:{r:6},isAnimationActive:!0,animationBegin:400,animationDuration:1e3,animationEasing:"ease-out"})]})})}const le=7,ue=["#4CAF50","#2196F3","#FF9800","#9C27B0","#F44336","#00BCD4","#FFEB3B","#795548","#607D8B"];function Ws({changePercent:e}){if(e==null)return null;const t=e>0,n=Math.abs(e)>=20;return e===0?i.jsxs("span",{className:"inline-flex items-center gap-0.5 text-xs text-gray-500 dark:text-gray-400",children:[i.jsx(gs,{className:"w-3 h-3"}),i.jsx("span",{children:"0%"})]}):i.jsxs("span",{className:M("inline-flex items-center gap-0.5 text-xs font-medium",t?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400",n&&"font-bold"),children:[t?i.jsx(zn,{className:"w-3 h-3"}):i.jsx(Mr,{className:"w-3 h-3"}),i.jsxs("span",{children:[t?"+":"",e.toFixed(0),"%"]})]})}function lr({data:e}){const{t}=z("common"),{currency:n}=zt(),{data:r}=Rt(),{resolvedTheme:s}=we(),a=s==="dark",[o,l]=O.useState(!1),c=a?"#1e1e2e":"#fff",u=a?"#45475a":"#E5E7EB",d=a?"#cdd6f4":"#374151",f=e.reduce((x,v)=>x+v.amount,0),h=[...e].sort((x,v)=>v.amount-x.amount),m=(()=>{if(h.length<=le||o)return h.map((w,j)=>({...w,percentage:f>0?w.amount/f*100:0,color:ue[j%ue.length]}));const x=h.slice(0,le),v=h.slice(le),_=v.reduce((w,j)=>w+j.amount,0),k=x.map((w,j)=>({...w,percentage:f>0?w.amount/f*100:0,color:ue[j%ue.length]}));return v.length>0&&k.push({category:`${t("analytics.otherCategories")} (${v.length})`,amount:_,percentage:f>0?_/f*100:0,color:"#9E9E9E",isOther:!0,otherCount:v.length}),k})(),y=h.length>le,b=x=>{const{x:v,y:_,width:k,height:w,value:j}=x;return i.jsxs("text",{x:v+k+8,y:_+w/2,fill:d,textAnchor:"start",dominantBaseline:"middle",fontSize:12,children:[j.toFixed(1),"%"]})},g=Math.max(200,m.length*32);return i.jsxs("div",{className:"w-full",children:[i.jsx(ke,{width:"100%",height:g,children:i.jsxs(or,{data:m,layout:"vertical",margin:{top:5,right:60,left:0,bottom:5},children:[i.jsx(Kt,{type:"number",hide:!0,domain:[0,100]}),i.jsx(Vt,{type:"category",dataKey:"category",width:100,tick:{fill:d,fontSize:12},axisLine:!1,tickLine:!1}),i.jsx(Se,{contentStyle:{backgroundColor:c,border:`1px solid ${u}`,borderRadius:"8px",fontSize:"14px",color:d},content:({active:x,payload:v})=>{if(!x||!(v!=null&&v[0]))return null;const _=v[0].payload,k=_.change_percent!==null&&_.change_percent!==void 0;return i.jsxs("div",{className:"p-3 rounded-lg shadow-lg",style:{backgroundColor:c,border:`1px solid ${u}`},children:[i.jsx("p",{className:"font-medium mb-1",children:_.category}),i.jsx("p",{className:"text-sm",children:I(_.amount,n,(r==null?void 0:r.rates)||{},!1)}),k&&i.jsxs("div",{className:"mt-1 pt-1 border-t border-gray-200 dark:border-gray-600",children:[i.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t("analytics.vsPrevious"),": "]}),i.jsx(Ws,{changePercent:_.change_percent})]})]})}}),i.jsxs(Mt,{dataKey:"percentage",radius:[0,4,4,0],maxBarSize:24,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:[m.map((x,v)=>i.jsx(Zt,{fill:x.color},`cell-${v}`)),i.jsx(Qt,{dataKey:"percentage",content:b})]})]})}),y&&i.jsx("button",{onClick:()=>l(!o),className:M("w-full mt-2 py-2 px-4 text-sm font-medium rounded-lg transition-colors","text-primary-600 dark:text-primary-400","hover:bg-primary-50 dark:hover:bg-primary-900/20"),children:o?t("analytics.showLessCategories"):t("analytics.showAllCategories",{count:h.length})})]})}const _n={income:"#4CAF50",expense:"#F44336",net:"#2196F3"};function Gs({data:e,dataKey:t}){const{currency:n}=zt(),{data:r}=Rt(),{isPrivacyMode:s}=Lr(),{t:a}=z("common"),{resolvedTheme:o}=we(),l=o==="dark",c=l?"#45475a":"#E5E7EB",u=l?"#a6adc8":"#6B7280",d=l?"#1e1e2e":"#fff",f=l?"#45475a":"#E5E7EB",h=l?"#cdd6f4":"#374151",p={income:a("chart.income"),expense:a("chart.expense"),net:a("chart.net")};return i.jsx(ke,{width:"100%",height:"100%",children:i.jsxs(cs,{data:e,margin:{top:5,right:30,left:20,bottom:5},children:[i.jsx(Jn,{strokeDasharray:"3 3",stroke:c}),i.jsx(Kt,{dataKey:"month",stroke:u,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),i.jsx(Vt,{stroke:u,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:m=>fn(m,n,(r==null?void 0:r.rates)||{},!1,s)}),i.jsx(Se,{contentStyle:{backgroundColor:d,border:`1px solid ${f}`,borderRadius:"8px",fontSize:"14px",color:h},formatter:m=>[fn(m,n,(r==null?void 0:r.rates)||{},!1,s),p[t]]}),i.jsx(Xn,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:h}}),i.jsx(qe,{type:"monotone",dataKey:t,stroke:_n[t],strokeWidth:2,dot:{fill:_n[t],r:4},activeDot:{r:6},name:p[t],isAnimationActive:!0,animationBegin:0,animationDuration:1200,animationEasing:"ease-out"})]})})}function qs({data:e,savingsGoal:t}){const{t:n}=z("common"),{currency:r}=zt(),{data:s}=Rt(),{resolvedTheme:a}=we(),o=a==="dark",l=o?"#1e1e2e":"#fff",c=o?"#45475a":"#E5E7EB",u=o?"#cdd6f4":"#374151",d=e.length>0?e[e.length-1]:null,f=(d==null?void 0:d.net)||0,h=e.length>1?e.slice(0,-1):e,p=h.length>0?h.reduce((x,v)=>x+v.net,0)/h.length:f,m=[{name:n("analytics.thisMonth"),value:f,color:f>=0?"#4CAF50":"#F44336"},{name:n("analytics.average"),value:p,color:"#9E9E9E"}],y=p!==0?(f-p)/Math.abs(p)*100:0,b=y>=0,g=t&&t>0?Math.min(f/t*100,100):null;return e.length===1?i.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-8",children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:n("analytics.netCashFlow")}),i.jsx("p",{className:M("text-3xl font-bold",f>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:I(f,r,(s==null?void 0:s.rates)||{},!1)}),f>=0&&i.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:n("analytics.positiveCashFlow")}),t&&t>0&&i.jsxs("div",{className:"mt-4 w-full max-w-xs",children:[i.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[i.jsx("span",{children:n("analytics.savingsGoal")}),i.jsxs("span",{children:[(g??0).toFixed(0),"%"]})]}),i.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:i.jsx("div",{className:M("h-full rounded-full transition-all duration-700 ease-out",g&&g>=100?"bg-green-500":"bg-primary-500"),style:{width:`${g||0}%`}})}),i.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:[I(t,r,(s==null?void 0:s.rates)||{},!1)," ",n("analytics.target")]})]})]}):i.jsxs("div",{className:"w-full h-full flex flex-col",children:[i.jsx("div",{className:"flex-1 min-h-[150px]",children:i.jsx(ke,{width:"100%",height:"100%",children:i.jsxs(or,{data:m,layout:"vertical",margin:{top:10,right:60,left:10,bottom:10},children:[i.jsx(Kt,{type:"number",hide:!0}),i.jsx(Vt,{type:"category",dataKey:"name",width:80,tick:{fill:u,fontSize:12},axisLine:!1,tickLine:!1}),i.jsx(Se,{contentStyle:{backgroundColor:l,border:`1px solid ${c}`,borderRadius:"8px",fontSize:"14px",color:u},formatter:x=>[I(x,r,(s==null?void 0:s.rates)||{},!1),n("analytics.netCashFlow")]}),t&&t>0&&i.jsx(os,{x:t,stroke:"#9C27B0",strokeDasharray:"3 3",label:{value:n("analytics.goal"),position:"top",fill:"#9C27B0",fontSize:10}}),i.jsx(Mt,{dataKey:"value",radius:[0,4,4,0],maxBarSize:32,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:m.map((x,v)=>i.jsx(Zt,{fill:x.color},`cell-${v}`))})]})})}),i.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 border-t border-gray-100 dark:border-gray-800",children:[i.jsxs("span",{className:M("text-sm font-medium",b?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[b?"▲":"▼"," ",Math.abs(y).toFixed(1),"%"]}),i.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("analytics.vsAverage")})]}),t&&t>0&&i.jsxs("div",{className:"px-4 pb-2",children:[i.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[i.jsx("span",{children:n("analytics.savingsGoal")}),i.jsxs("span",{children:[I(f,r,(s==null?void 0:s.rates)||{},!1)," / ",I(t,r,(s==null?void 0:s.rates)||{},!1)]})]}),i.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:i.jsx("div",{className:M("h-full rounded-full transition-all duration-700 ease-out",g&&g>=100?"bg-green-500":"bg-primary-500"),style:{width:`${g||0}%`}})})]})]})}function Xs(e,t,n){return Math.max(t,Math.min(e,n))}const L={toVector(e,t){return e===void 0&&(e=t),Array.isArray(e)?e:[e,e]},add(e,t){return[e[0]+t[0],e[1]+t[1]]},sub(e,t){return[e[0]-t[0],e[1]-t[1]]},addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function wn(e,t,n){return t===0||Math.abs(t)===1/0?Math.pow(e,n*5):e*t*n/(t+n*e)}function kn(e,t,n,r=.15){return r===0?Xs(e,t,n):e<t?-wn(t-e,n-t,r)+t:e>n?+wn(e-n,n-t,r)+n:e}function Js(e,[t,n],[r,s]){const[[a,o],[l,c]]=e;return[kn(t,a,o,r),kn(n,l,c,s)]}function Qs(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Zs(e){var t=Qs(e,"string");return typeof t=="symbol"?t:String(t)}function K(e,t,n){return t=Zs(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Sn(Object(n),!0).forEach(function(r){K(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sn(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const ur={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function An(e){return e?e[0].toUpperCase()+e.slice(1):""}const ti=["enter","leave"];function ei(e=!1,t){return e&&!ti.includes(t)}function ni(e,t="",n=!1){const r=ur[e],s=r&&r[t]||t;return"on"+An(e)+An(s)+(ei(n,s)?"Capture":"")}const ri=["gotpointercapture","lostpointercapture"];function si(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=ri.includes(t)?"capturecapture":"capture",s=!!~t.indexOf(r);return s&&(t=t.replace("capture","")),{device:t,capture:s,passive:n}}function ii(e,t=""){const n=ur[e],r=n&&n[t]||t;return e+r}function Ee(e){return"touches"in e}function dr(e){return Ee(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function ai(e){return Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||((n=e.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,t.target))})}function oi(e){return e.type==="touchend"||e.type==="touchcancel"?e.changedTouches:e.targetTouches}function fr(e){return Ee(e)?oi(e)[0]:e}function He(e,t){try{const n=t.clientX-e.clientX,r=t.clientY-e.clientY,s=(t.clientX+e.clientX)/2,a=(t.clientY+e.clientY)/2,o=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:o,origin:[s,a]}}catch{}return null}function ci(e){return ai(e).map(t=>t.identifier)}function Nn(e,t){const[n,r]=Array.from(e.touches).filter(s=>t.includes(s.identifier));return He(n,r)}function Le(e){const t=fr(e);return Ee(e)?t.identifier:t.pointerId}function $t(e){const t=fr(e);return[t.clientX,t.clientY]}const En=40,Pn=800;function hr(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return r===1?(t*=En,n*=En):r===2&&(t*=Pn,n*=Pn),[t,n]}function li(e){var t,n;const{scrollX:r,scrollY:s,scrollLeft:a,scrollTop:o}=e.currentTarget;return[(t=r??a)!==null&&t!==void 0?t:0,(n=s??o)!==null&&n!==void 0?n:0]}function ui(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:s,ctrlKey:a}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:s,ctrlKey:a})}return t}function ve(e,...t){return typeof e=="function"?e(...t):e}function di(){}function fi(...e){return e.length===0?di:e.length===1?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function On(e,t){return Object.assign({},t,e||{})}const hi=32;let mr=class{constructor(t,n,r){this.ctrl=t,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:n,ingKey:r,args:s}=this;n[r]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=s,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=t.target,n.currentTarget=t.currentTarget,n.lastOffset=r.from?ve(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=t.timeStamp)}computeValues(t){const n=this.state;n._values=t,n.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:n,config:r,shared:s}=this;n.args=this.args;let a=0;if(t&&(n.event=t,r.preventDefault&&t.cancelable&&n.event.preventDefault(),n.type=t.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,ui(t)),s.down=s.pressed=s.buttons%2===1||s.touches>0,a=t.timeStamp-n.timeStamp,n.timeStamp=t.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const w=n._delta.map(Math.abs);L.addTo(n._distance,w)}this.axisIntent&&this.axisIntent(t);const[o,l]=n._movement,[c,u]=r.threshold,{_step:d,values:f}=n;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=c&&f[0]),d[1]===!1&&(d[1]=Math.abs(l)>=u&&f[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=c&&Math.sign(o)*c),d[1]===!1&&(d[1]=Math.abs(l)>=u&&Math.sign(l)*u)),n.intentional=d[0]!==!1||d[1]!==!1,!n.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[w,j]=f;h[0]=d[0]!==!1?w-d[0]:0,h[1]=d[1]!==!1?j-d[1]:0}else h[0]=d[0]!==!1?o-d[0]:0,h[1]=d[1]!==!1?l-d[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(h);const p=n.offset,m=n._active&&!n._blocked||n.active;m&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=s[this.ingKey]=n._active,t&&(n.first&&("bounds"in r&&(n._bounds=ve(r.bounds,n)),this.setup&&this.setup()),n.movement=h,this.computeOffset()));const[y,b]=n.offset,[[g,x],[v,_]]=n._bounds;n.overflow=[y<g?-1:y>x?1:0,b<v?-1:b>_?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const k=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=Js(n._bounds,n.offset,k),n.delta=L.sub(n.offset,p),this.computeMovement(),m&&(!n.last||a>hi)){n.delta=L.sub(n.offset,p);const w=n.delta.map(Math.abs);L.addTo(n.distance,w),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&a>0&&(n.velocity=[w[0]/a,w[1]/a],n.timeDelta=a)}}emit(){const t=this.state,n=this.shared,r=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!r.triggerAllEvents)return;const s=this.handler($($($({},n),t),{},{[this.aliasKey]:t.values}));s!==void 0&&(t.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};function mi([e,t],n){const r=Math.abs(e),s=Math.abs(t);if(r>s&&r>n)return"x";if(s>r&&s>n)return"y"}class re extends mr{constructor(...t){super(...t),K(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=L.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=L.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const n=this.state,r=this.config;if(!n.axis&&t){const s=typeof r.axisThreshold=="object"?r.axisThreshold[dr(t)]:r.axisThreshold;n.axis=mi(n._movement,s)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const pi=e=>e,Tn=.15,pr={enabled(e=!0){return e},eventOptions(e,t,n){return $($({},n.shared.eventOptions),e)},preventDefault(e=!1){return e},triggerAllEvents(e=!1){return e},rubberband(e=0){switch(e){case!0:return[Tn,Tn];case!1:return[0,0];default:return L.toVector(e)}},from(e){if(typeof e=="function")return e;if(e!=null)return L.toVector(e)},transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||pi},threshold(e){return L.toVector(e,0)}},gi=0,St=$($({},pr),{},{axis(e,t,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(e=gi){return e},bounds(e={}){if(typeof e=="function")return a=>St.bounds(e(a));if("current"in e)return()=>e.current;if(typeof HTMLElement=="function"&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:s=1/0}=e;return[[t,n],[r,s]]}}),Cn={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class yi extends re{constructor(...t){super(...t),K(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const n=t._bounds.getBoundingClientRect(),r=t.currentTarget.getBoundingClientRect(),s={left:n.left-r.left+t.offset[0],right:n.right-r.right+t.offset[0],top:n.top-r.top+t.offset[1],bottom:n.bottom-r.bottom+t.offset[1]};t._bounds=St.bounds(s)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const n=this.config,r=this.state;if(t.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(t.buttons):n.pointerButtons!==-1&&n.pointerButtons!==t.buttons))return;const s=this.ctrl.setEventIds(t);n.pointerCapture&&t.target.setPointerCapture(t.pointerId),!(s&&s.size>1&&r._pointerActive)&&(this.start(t),this.setupPointer(t),r._pointerId=Le(t),r._pointerActive=!0,this.computeValues($t(t)),this.computeInitial(),n.preventScrollAxis&&dr(t)!=="mouse"?(r._active=!1,this.setupScrollPrevention(t)):n.delay>0?(this.setupDelayTrigger(t),n.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const n=this.state,r=this.config;if(!n._pointerActive)return;const s=Le(t);if(n._pointerId!==void 0&&s!==n._pointerId)return;const a=$t(t);if(document.pointerLockElement===t.target?n._delta=[t.movementX,t.movementY]:(n._delta=L.sub(a,n._values),this.computeValues(a)),L.addTo(n._movement,n._delta),this.compute(t),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(t);return}if(r.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===r.preventScrollAxis||r.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(t);return}else return;this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch{}const n=this.state,r=this.config;if(!n._active||!n._pointerActive)return;const s=Le(t);if(n._pointerId!==void 0&&s!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[a,o]=n._distance;if(n.tap=a<=r.tapsThreshold&&o<=r.tapsThreshold,n.tap&&r.filterTaps)n._force=!0;else{const[l,c]=n._delta,[u,d]=n._movement,[f,h]=r.swipe.velocity,[p,m]=r.swipe.distance,y=r.swipe.duration;if(n.elapsedTime<y){const b=Math.abs(l/n.timeDelta),g=Math.abs(c/n.timeDelta);b>f&&Math.abs(u)>p&&(n.swipe[0]=Math.sign(l)),g>h&&Math.abs(d)>m&&(n.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const n=this.config,r=n.device;n.pointerLock&&t.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,xi(t);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const n=Cn[t.key];if(n){const r=this.state,s=t.shiftKey?10:t.altKey?.1:1;this.start(t),r._delta=n(this.config.keyboardDisplacement,s),r._keyboardActive=!0,L.addTo(r._movement,r._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Cn&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const n=this.config.device;t(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(n,"change",this.pointerMove.bind(this)),t(n,"end",this.pointerUp.bind(this)),t(n,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function xi(e){"persist"in e&&typeof e.persist=="function"&&e.persist()}const se=typeof window<"u"&&window.document&&window.document.createElement;function gr(){return se&&"ontouchstart"in window}function bi(){return gr()||se&&window.navigator.maxTouchPoints>1}function vi(){return se&&"onpointerdown"in window}function ji(){return se&&"exitPointerLock"in window.document}function _i(){try{return"constructor"in GestureEvent}catch{return!1}}const Z={isBrowser:se,gesture:_i(),touch:gr(),touchscreen:bi(),pointer:vi(),pointerLock:ji()},wi=250,ki=180,Si=.5,Ai=50,Ni=250,Ei=10,In={mouse:0,touch:0,pen:8},Pi=$($({},St),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:s=!1}={}}){return this.pointerLock=r&&Z.pointerLock,Z.touch&&n?"touch":this.pointerLock?"mouse":Z.pointer&&!s?"pointer":Z.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&e?wi:void 0,!(!Z.touchscreen||n===!1))return e||(n!==void 0?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:s=!0}={}}){return this.pointerButtons=r,this.keys=s,!this.pointerLock&&this.device==="pointer"&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:s=void 0}){const a=L.toVector(e,n?r:s?1:0);return this.filterTaps=n,this.tapsThreshold=r,a},swipe({velocity:e=Si,distance:t=Ai,duration:n=Ni}={}){return{velocity:this.transform(L.toVector(e)),distance:this.transform(L.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return ki;case!1:return 0;default:return e}},axisThreshold(e){return e?$($({},In),e):In},keyboardDisplacement(e=Ei){return e}});function yr(e){const[t,n]=e.overflow,[r,s]=e._delta,[a,o]=e._direction;(t<0&&r>0&&a<0||t>0&&r<0&&a>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&s>0&&o<0||n>0&&s<0&&o>0)&&(e._movement[1]=e._movementBound[1])}const Oi=30,Ti=100;class Ci extends mr{constructor(...t){super(...t),K(this,"ingKey","pinching"),K(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:n,lastOffset:r}=this.state;t==="wheel"?this.state.offset=L.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:t,lastOffset:n}=this.state;this.state.movement=[t[0]/n[0],t[1]-n[1]]}axisIntent(){const t=this.state,[n,r]=t._movement;if(!t.axis){const s=Math.abs(n)*Oi-Math.abs(r);s<0?t.axis="angle":s>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&(this.state.axis==="scale"?t[1]=0:this.state.axis==="angle"&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(a=>r.has(a))||r.size<2)return;this.start(t),n._touchIds=Array.from(r).slice(0,2);const s=Nn(t,n._touchIds);s&&this.pinchStart(t,s)}pointerStart(t){if(t.buttons!=null&&t.buttons%2!==1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const n=this.state,r=n._pointerEvents,s=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(o=>s.has(o))||(r.size<2&&r.set(t.pointerId,t),n._pointerEvents.size<2))return;this.start(t);const a=He(...Array.from(r.values()));a&&this.pinchStart(t,a)}pinchStart(t,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const n=Nn(t,this.state._touchIds);n&&this.pinchMove(t,n)}pointerMove(t){const n=this.state._pointerEvents;if(n.has(t.pointerId)&&n.set(t.pointerId,t),!this.state._active)return;const r=He(...Array.from(n.values()));r&&this.pinchMove(t,r)}pinchMove(t,n){const r=this.state,s=r._values[1],a=n.angle-s;let o=0;Math.abs(a)>270&&(o+=Math.sign(a)),this.computeValues([n.distance,n.angle-360*o]),r.origin=n.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const n=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch{}n._pointerEvents.has(t.pointerId)&&n._pointerEvents.delete(t.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const n=this.state;n._active||(this.start(t),this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY];const r=n._movement;n._movement=[t.scale-1,t.rotation],n._delta=L.sub(n._movement,r),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>t[r]):!t[n])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const r=this.state;r._delta=[-hr(t)[1]/Ti*r.offset[0],0],L.addTo(r._movement,r._delta),yr(r),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const n=this.config.device;n&&(t(n,"start",this[n+"Start"].bind(this)),t(n,"change",this[n+"Move"].bind(this)),t(n,"end",this[n+"End"].bind(this)),t(n,"cancel",this[n+"End"].bind(this)),t("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}}const Ii=$($({},pr),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Z.touch&&Z.gesture)return"gesture";if(Z.touch&&r)return"touch";if(Z.touchscreen){if(Z.pointer)return"pointer";if(Z.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const s=o=>{const l=On(ve(n,o),{min:-1/0,max:1/0});return[l.min,l.max]},a=o=>{const l=On(ve(r,o),{min:-1/0,max:1/0});return[l.min,l.max]};return typeof n!="function"&&typeof r!="function"?[s(),a()]:o=>[s(o),a(o)]},threshold(e,t,n){return this.lockDirection=n.axis==="lock",L.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey(e){return e===void 0?"ctrlKey":e},pinchOnWheel(e=!0){return e}});class Di extends re{constructor(...t){super(...t),K(this,"ingKey","moving")}move(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues($t(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const n=$t(t),r=this.state;r._delta=L.sub(n,r._values),L.addTo(r._movement,r._delta),this.computeValues(n),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}}const Mi=$($({},St),{},{mouseOnly:(e=!0)=>e});class Li extends re{constructor(...t){super(...t),K(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const n=this.state,r=li(t);n._delta=L.sub(r,n._values),L.addTo(n._movement,n._delta),this.computeValues(r),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}}const Bi=St;class Fi extends re{constructor(...t){super(...t),K(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const n=this.state;n._delta=hr(t),L.addTo(n._movement,n._delta),yr(n),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}}const $i=St;class zi extends re{constructor(...t){super(...t),K(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.start(t),this.computeValues($t(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&t.pointerType!=="mouse")return;const n=this.state;if(!n._active)return;n._active=!1;const r=$t(t);n._movement=n._delta=L.sub(r,n._values),this.computeValues(r),this.compute(t),n.delta=n.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}}const Ri=$($({},St),{},{mouseOnly:(e=!0)=>e}),Xe=new Map,Ye=new Map;function Ki(e){Xe.set(e.key,e.engine),Ye.set(e.key,e.resolver)}const Vi={key:"drag",engine:yi,resolver:Pi},Hi={key:"hover",engine:zi,resolver:Ri},Yi={key:"move",engine:Di,resolver:Mi},Ui={key:"pinch",engine:Ci,resolver:Ii},Wi={key:"scroll",engine:Li,resolver:Bi},Gi={key:"wheel",engine:Fi,resolver:$i};function qi(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function Xi(e,t){if(e==null)return{};var n=qi(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const Ji={target(e){if(e)return()=>"current"in e?e.current:e},enabled(e=!0){return e},window(e=Z.isBrowser?window:void 0){return e},eventOptions({passive:e=!0,capture:t=!1}={}){return{passive:e,capture:t}},transform(e){return e}},Qi=["target","eventOptions","window","enabled","transform"];function me(e={},t){const n={};for(const[r,s]of Object.entries(t))switch(typeof s){case"function":n[r]=s.call(n,e[r],r,e);break;case"object":n[r]=me(e[r],s);break;case"boolean":s&&(n[r]=e[r]);break}return n}function Zi(e,t,n={}){const r=e,{target:s,eventOptions:a,window:o,enabled:l,transform:c}=r,u=Xi(r,Qi);if(n.shared=me({target:s,eventOptions:a,window:o,enabled:l,transform:c},Ji),t){const d=Ye.get(t);n[t]=me($({shared:n.shared},u),d)}else for(const d in u){const f=Ye.get(d);f&&(n[d]=me($({shared:n.shared},u[d]),f))}return n}let xr=class{constructor(t,n){K(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=n}add(t,n,r,s,a){const o=this._listeners,l=ii(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=$($({},c),a);t.addEventListener(l,s,u);const d=()=>{t.removeEventListener(l,s,u),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}};class ta{constructor(){K(this,"_timeouts",new Map)}add(t,n,r=140,...s){this.remove(t),this._timeouts.set(t,window.setTimeout(n,r,...s))}remove(t){const n=this._timeouts.get(t);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class ea{constructor(t){K(this,"gestures",new Set),K(this,"_targetEventStore",new xr(this)),K(this,"gestureEventStores",{}),K(this,"gestureTimeoutStores",{}),K(this,"handlers",{}),K(this,"config",{}),K(this,"pointerIds",new Set),K(this,"touchIds",new Set),K(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),na(this,t)}setEventIds(t){if(Ee(t))return this.touchIds=new Set(ci(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,n){this.handlers=t,this.nativeHandlers=n}applyConfig(t,n){this.config=Zi(t,n,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const n=this.config.shared,r={};let s;if(!(n.target&&(s=n.target(),!s))){if(n.enabled){for(const o of this.gestures){const l=this.config[o],c=Dn(r,l.eventOptions,!!s);if(l.enabled){const u=Xe.get(o);new u(this,t,o).bind(c)}}const a=Dn(r,n.eventOptions,!!s);for(const o in this.nativeHandlers)a(o,"",l=>this.nativeHandlers[o]($($({},this.state.shared),{},{event:l,args:t})),void 0,!0)}for(const a in r)r[a]=fi(...r[a]);if(!s)return r;for(const a in r){const{device:o,capture:l,passive:c}=si(a);this._targetEventStore.add(s,o,"",r[a],{capture:l,passive:c})}}}}function Pt(e,t){e.gestures.add(t),e.gestureEventStores[t]=new xr(e,t),e.gestureTimeoutStores[t]=new ta}function na(e,t){t.drag&&Pt(e,"drag"),t.wheel&&Pt(e,"wheel"),t.scroll&&Pt(e,"scroll"),t.move&&Pt(e,"move"),t.pinch&&Pt(e,"pinch"),t.hover&&Pt(e,"hover")}const Dn=(e,t,n)=>(r,s,a,o={},l=!1)=>{var c,u;const d=(c=o.capture)!==null&&c!==void 0?c:t.capture,f=(u=o.passive)!==null&&u!==void 0?u:t.passive;let h=l?r:ni(r,s,d);n&&f&&(h+="Passive"),e[h]=e[h]||[],e[h].push(a)},ra=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function sa(e){const t={},n={},r=new Set;for(let s in e)ra.test(s)?(r.add(RegExp.lastMatch),n[s]=e[s]):t[s]=e[s];return[n,t,r]}function Ot(e,t,n,r,s,a){if(!e.has(n)||!Xe.has(r))return;const o=n+"Start",l=n+"End",c=u=>{let d;return u.first&&o in t&&t[o](u),n in t&&(d=t[n](u)),u.last&&l in t&&t[l](u),d};s[r]=c,a[r]=a[r]||{}}function ia(e,t){const[n,r,s]=sa(e),a={};return Ot(s,n,"onDrag","drag",a,t),Ot(s,n,"onWheel","wheel",a,t),Ot(s,n,"onScroll","scroll",a,t),Ot(s,n,"onPinch","pinch",a,t),Ot(s,n,"onMove","move",a,t),Ot(s,n,"onHover","hover",a,t),{handlers:a,config:t,nativeHandlers:r}}function aa(e,t={},n,r){const s=T.useMemo(()=>new ea(e),[]);if(s.applyHandlers(e,r),s.applyConfig(t,n),T.useEffect(s.effect.bind(s)),T.useEffect(()=>s.clean.bind(s),[]),t.target===void 0)return s.bind.bind(s)}function oa(e){return e.forEach(Ki),function(n,r){const{handlers:s,nativeHandlers:a,config:o}=ia(n,r||{});return aa(s,o,void 0,a)}}function ca(e,t){return oa([Vi,Ui,Wi,Gi,Yi,Hi])(e,t||{})}function Be({children:e,className:t="",minScale:n=1,maxScale:r=3}){const s=O.useRef(null),[a,o]=O.useState(1),[l,c]=O.useState({x:0,y:0}),u=O.useCallback(()=>{o(1),c({x:0,y:0})},[]);return ca({onPinch:({offset:[d],memo:f})=>{const h=Math.min(r,Math.max(n,d));return o(h),h<=1&&c({x:0,y:0}),f},onDrag:({offset:[d,f],pinching:h})=>{if(a>1&&!h){const p=(a-1)*100/2;c({x:Math.min(p,Math.max(-p,d)),y:Math.min(p,Math.max(-p,f))})}},onWheel:({delta:[,d],event:f})=>{f.preventDefault();const h=Math.min(r,Math.max(n,a-d*.01));o(h),h<=1&&c({x:0,y:0})}},{target:s,pinch:{scaleBounds:{min:n,max:r}},drag:{filterTaps:!0},wheel:{preventDefault:!0}}),i.jsxs("div",{className:`relative overflow-hidden touch-none ${t}`,children:[i.jsx("div",{ref:s,style:{transform:`scale(${a}) translate(${l.x}px, ${l.y}px)`,transformOrigin:"center center",transition:"transform 0.1s ease-out"},className:"w-full h-full",children:e}),a>1&&i.jsxs("button",{onClick:u,className:"absolute bottom-2 right-2 px-2 py-1 text-xs bg-gray-800/70 text-white rounded-md hover:bg-gray-700/70 transition-colors",children:[Math.round(a*100),"% - Tap to reset"]})]})}const la={spike:"📈",trend:"📊",unusual:"🔍",budget:"💰",saving:"✨"},ua={info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"},da={info:"text-blue-700 dark:text-blue-300",warning:"text-amber-700 dark:text-amber-300",success:"text-green-700 dark:text-green-300"};function fa({insight:e}){const{currency:t}=zt(),{data:n}=Rt();return i.jsx("div",{className:`p-4 rounded-lg border ${ua[e.severity]} transition-all hover:shadow-sm`,children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-2xl",children:la[e.type]}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h4",{className:`font-medium ${da[e.severity]}`,children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&i.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-2",children:I(e.amount,t,(n==null?void 0:n.rates)||{},!1)})]}),e.percentage_change!==void 0&&i.jsxs("span",{className:`text-sm font-medium px-2 py-1 rounded ${e.percentage_change>0?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400":"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"}`,children:[e.percentage_change>0?"+":"",e.percentage_change.toFixed(0),"%"]})]})})}function ha(){const{t:e}=z("common"),{data:t,isLoading:n,error:r}=Ct({queryKey:["spending-insights"],queryFn:Rn,staleTime:5*60*1e3});if(n)return i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),i.jsx("div",{className:"flex justify-center py-8",children:i.jsx(Dt,{size:"md"})})]});if(r)return i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),i.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:e("error","Failed to load insights")})]});const s=(t==null?void 0:t.insights)||[];return i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("span",{className:"text-4xl mb-3 block",children:"🎉"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:e("analytics.noInsights","No notable spending patterns detected")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:e("analytics.insightsHint","Keep tracking to see personalized insights")})]}):i.jsx("div",{className:"space-y-3",children:s.map((a,o)=>i.jsx(fa,{insight:a},`${a.type}-${a.category}-${o}`))})]})}const de=50,ma=.5;function pa({suggestion:e,isSelected:t,onToggle:n}){const{currency:r}=zt(),{data:s}=Rt(),{t:a}=z("common"),o=e.confidence>=.8?"text-green-600 dark:text-green-400":e.confidence>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return i.jsxs("div",{className:`p-3 rounded-lg border transition-colors cursor-pointer ${t?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>n(e.transaction_id,e.suggested_category),children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:e.description}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:I(e.amount,r,(s==null?void 0:s.rates)||{},!1)})]}),i.jsxs("div",{className:"text-right flex-shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[e.is_new_category&&i.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:a("ai.newCategory")}),i.jsx("span",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:e.suggested_category})]}),i.jsxs("p",{className:`text-xs mt-1 ${o}`,children:[Math.round(e.confidence*100),"% ",a("ai.confidence")]})]})]}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 italic",children:e.reason})]})}function ga(){const{t:e,i18n:t}=z("common"),n=Br(),[r,s]=O.useState(null),[a,o]=O.useState(new Map),[l,c]=O.useState(!0),[u,d]=O.useState(0),[f,h]=O.useState(null),p=O.useRef(!1),m=Fe({mutationFn:()=>pn(de,t.language),onSuccess:j=>{s(j),d(j.total_other_count);const S=new Map;j.suggestions.forEach(N=>{N.confidence>=.7&&S.set(N.transaction_id,N.suggested_category)}),o(S)}}),y=Fe({mutationFn:()=>gn({approved:Array.from(a.entries()).map(([j,S])=>({transaction_id:j,category:S})),create_rules:l}),onSuccess:()=>{n.invalidateQueries({queryKey:["analytics"]}),n.invalidateQueries({queryKey:["transactions"]});const j=u-a.size;j>0?(d(j),s(null),o(new Map),setTimeout(()=>m.mutate(),500)):(s(null),o(new Map),d(0))}}),b=O.useCallback(async()=>{p.current=!1;const j=Math.ceil(u/de);let S=0;h({isRunning:!0,processed:0,total:u,currentBatch:0,totalBatches:j});for(let N=0;N<j&&!p.current;N++){h(E=>E?{...E,currentBatch:N+1}:null);try{const E=await pn(de,t.language);if(E.suggestions.length===0||p.current)break;const P=E.suggestions.filter(C=>C.confidence>=.7).map(C=>({transaction_id:C.transaction_id,category:C.suggested_category}));P.length>0&&(await gn({approved:P,create_rules:l}),S+=P.length),h(C=>C?{...C,processed:S}:null),await new Promise(C=>setTimeout(C,300))}catch{break}}h(null),n.invalidateQueries({queryKey:["analytics"]}),n.invalidateQueries({queryKey:["transactions"]}),s(null),d(0)},[u,t.language,l,n]),g=()=>{p.current=!0,h(null)},x=(j,S)=>{o(N=>{const E=new Map(N);return E.has(j)?E.delete(j):E.set(j,S),E})},v=()=>{if(!r)return;const j=new Map;r.suggestions.forEach(S=>{j.set(S.transaction_id,S.suggested_category)}),o(j)},_=()=>{o(new Map)};if(f!=null&&f.isRunning){const j=f.total>0?Math.round(f.processed/f.total*100):0;return i.jsx(V,{children:i.jsxs("div",{className:"py-8",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 text-center mb-4",children:e("ai.processingAll")}),i.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2",children:i.jsx("div",{className:"bg-primary-500 h-4 rounded-full transition-all duration-300",style:{width:`${j}%`}})}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-4",children:e("ai.processProgress",{processed:f.processed,total:f.total,batch:f.currentBatch,totalBatches:f.totalBatches})}),i.jsx("div",{className:"text-center",children:i.jsx(rt,{variant:"outline",onClick:g,children:e("cancel")})})]})})}if(!r){const j=u,S=j>250,N=Math.ceil(j/de)*ma;return i.jsxs(V,{children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.categoryCleanupDesc")}),j>0&&i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:e("ai.remainingOther",{count:j})})]}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx(rt,{onClick:()=>m.mutate(),disabled:m.isPending,children:m.isPending?i.jsxs(i.Fragment,{children:[i.jsx(Dt,{size:"sm",className:"mr-2"}),e("ai.analyzing")]}):e("ai.analyzeOther")}),S&&i.jsx(rt,{variant:"outline",onClick:b,disabled:m.isPending,title:e("ai.analyzeAllCredits",{credits:N.toFixed(1)}),children:e("ai.analyzeAll",{count:j})})]})]}),m.isError&&i.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:e("ai.analyzeError")})]})}if(r.suggestions.length===0)return i.jsx(V,{children:i.jsxs("div",{className:"text-center py-8",children:[i.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e("ai.noSuggestions")}),i.jsx(rt,{variant:"outline",onClick:()=>s(null),className:"mt-4",children:e("close")})]})});const k=u-r.suggestions.length,w=k>250;return i.jsxs(V,{children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.foundSuggestions",{count:r.suggestions.length,total:u})})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(rt,{variant:"outline",size:"sm",onClick:v,children:e("ai.selectAll")}),i.jsx(rt,{variant:"outline",size:"sm",onClick:_,children:e("ai.deselectAll")})]})]}),r.new_categories_suggested.length>0&&i.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:i.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e("ai.newCategoriesSuggested"),": ",r.new_categories_suggested.join(", ")]})}),i.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:r.suggestions.map(j=>i.jsx(pa,{suggestion:j,isSelected:a.has(j.transaction_id),onToggle:x},j.transaction_id))}),i.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[i.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[i.jsx("input",{type:"checkbox",checked:l,onChange:j=>c(j.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),e("ai.createRulesAuto")]}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx(rt,{variant:"outline",onClick:()=>s(null),children:e("cancel")}),w&&i.jsx(rt,{variant:"outline",onClick:b,disabled:y.isPending,children:e("ai.analyzeAll",{count:k})}),i.jsx(rt,{onClick:()=>y.mutate(),disabled:a.size===0||y.isPending,children:y.isPending?i.jsxs(i.Fragment,{children:[i.jsx(Dt,{size:"sm",className:"mr-2"}),e("ai.applying")]}):e("ai.applySelected",{count:a.size})})]})]}),y.isError&&i.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:e("ai.applyError")})]})]})}function bt({label:e,value:t,change:n,trend:r="neutral",subtitle:s,className:a}){const{t:o}=z("common"),l=()=>r==="positive"?"text-green-600 dark:text-green-400":r==="negative"?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",c=()=>n==null?null:n>0?"↑":n<0?"↓":"→";return i.jsxs("div",{className:M("bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm","border border-gray-100 dark:border-gray-700",a),children:[i.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:e}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 truncate",children:t}),n!=null&&i.jsxs("div",{className:M("flex items-center gap-1 mt-1",l()),children:[i.jsxs("span",{className:"text-sm font-medium",children:[c()," ",Math.abs(n).toFixed(1),"%"]}),i.jsx("span",{className:"text-xs text-gray-400",children:o("analytics.vsLastPeriod")})]}),s&&i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1 truncate",children:s})]})}function ya({analytics:e,displayCurrency:t="JPY"}){const{t:n}=z("common"),{total_income:r,total_expense:s,net_cashflow:a,comparison:o,top_category:l}=e,c=()=>o!=null&&o.income_change?o.income_change>0?"positive":"negative":"neutral",u=()=>o!=null&&o.expense_change?o.expense_change<0?"positive":"negative":"neutral",d=()=>o!=null&&o.net_change?o.net_change>0?"positive":"negative":"neutral";return i.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[i.jsx(bt,{label:n("analytics.heroIncome"),value:I(r,t),change:o==null?void 0:o.income_change,trend:c()}),i.jsx(bt,{label:n("analytics.heroExpense"),value:I(s,t),change:o==null?void 0:o.expense_change,trend:u()}),i.jsx(bt,{label:n("analytics.heroNet"),value:I(a,t),change:o==null?void 0:o.net_change,trend:d()}),i.jsx(bt,{label:n("analytics.heroTopCategory"),value:(l==null?void 0:l.name)||"-",subtitle:l?`${I(l.amount,t)} (${l.percentage}%)`:void 0})]})}function xa(e){return Object.prototype.toString.call(e)==="[object Object]"}function Mn(e){return xa(e)||Array.isArray(e)}function ba(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Je(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;const s=JSON.stringify(Object.keys(e.breakpoints||{})),a=JSON.stringify(Object.keys(t.breakpoints||{}));return s!==a?!1:n.every(o=>{const l=e[o],c=t[o];return typeof l=="function"?`${l}`==`${c}`:!Mn(l)||!Mn(c)?l===c:Je(l,c)})}function Ln(e){return e.concat().sort((t,n)=>t.name>n.name?1:-1).map(t=>t.options)}function va(e,t){if(e.length!==t.length)return!1;const n=Ln(e),r=Ln(t);return n.every((s,a)=>{const o=r[a];return Je(s,o)})}function Qe(e){return typeof e=="number"}function Ue(e){return typeof e=="string"}function Pe(e){return typeof e=="boolean"}function Bn(e){return Object.prototype.toString.call(e)==="[object Object]"}function F(e){return Math.abs(e)}function Ze(e){return Math.sign(e)}function Jt(e,t){return F(e-t)}function ja(e,t){if(e===0||t===0||F(e)<=F(t))return 0;const n=Jt(F(e),F(t));return F(n/e)}function _a(e){return Math.round(e*100)/100}function te(e){return ee(e).map(Number)}function tt(e){return e[ie(e)]}function ie(e){return Math.max(0,e.length-1)}function tn(e,t){return t===ie(e)}function Fn(e,t=0){return Array.from(Array(e),(n,r)=>t+r)}function ee(e){return Object.keys(e)}function br(e,t){return[e,t].reduce((n,r)=>(ee(r).forEach(s=>{const a=n[s],o=r[s],l=Bn(a)&&Bn(o);n[s]=l?br(a,o):o}),n),{})}function We(e,t){return typeof t.MouseEvent<"u"&&e instanceof t.MouseEvent}function wa(e,t){const n={start:r,center:s,end:a};function r(){return 0}function s(c){return a(c)/2}function a(c){return t-c}function o(c,u){return Ue(e)?n[e](c):e(t,c,u)}return{measure:o}}function ne(){let e=[];function t(s,a,o,l={passive:!0}){let c;if("addEventListener"in s)s.addEventListener(a,o,l),c=()=>s.removeEventListener(a,o,l);else{const u=s;u.addListener(o),c=()=>u.removeListener(o)}return e.push(c),r}function n(){e=e.filter(s=>s())}const r={add:t,clear:n};return r}function ka(e,t,n,r){const s=ne(),a=1e3/60;let o=null,l=0,c=0;function u(){s.add(e,"visibilitychange",()=>{e.hidden&&m()})}function d(){p(),s.clear()}function f(b){if(!c)return;o||(o=b,n(),n());const g=b-o;for(o=b,l+=g;l>=a;)n(),l-=a;const x=l/a;r(x),c&&(c=t.requestAnimationFrame(f))}function h(){c||(c=t.requestAnimationFrame(f))}function p(){t.cancelAnimationFrame(c),o=null,l=0,c=0}function m(){o=null,l=0}return{init:u,destroy:d,start:h,stop:p,update:n,render:r}}function Sa(e,t){const n=t==="rtl",r=e==="y",s=r?"y":"x",a=r?"x":"y",o=!r&&n?-1:1,l=d(),c=f();function u(m){const{height:y,width:b}=m;return r?y:b}function d(){return r?"top":n?"right":"left"}function f(){return r?"bottom":n?"left":"right"}function h(m){return m*o}return{scroll:s,cross:a,startEdge:l,endEdge:c,measureSize:u,direction:h}}function wt(e=0,t=0){const n=F(e-t);function r(u){return u<e}function s(u){return u>t}function a(u){return r(u)||s(u)}function o(u){return a(u)?r(u)?e:t:u}function l(u){return n?u-n*Math.ceil((u-t)/n):u}return{length:n,max:t,min:e,constrain:o,reachedAny:a,reachedMax:s,reachedMin:r,removeOffset:l}}function vr(e,t,n){const{constrain:r}=wt(0,e),s=e+1;let a=o(t);function o(h){return n?F((s+h)%s):r(h)}function l(){return a}function c(h){return a=o(h),f}function u(h){return d().set(l()+h)}function d(){return vr(e,l(),n)}const f={get:l,set:c,add:u,clone:d};return f}function Aa(e,t,n,r,s,a,o,l,c,u,d,f,h,p,m,y,b,g,x){const{cross:v,direction:_}=e,k=["INPUT","SELECT","TEXTAREA"],w={passive:!1},j=ne(),S=ne(),N=wt(50,225).constrain(p.measure(20)),E={mouse:300,touch:400},P={mouse:500,touch:600},C=m?43:25;let H=!1,W=0,G=0,X=!1,mt=!1,ot=!1,ct=!1;function Ht(A){if(!x)return;function D(U){(Pe(x)||x(A,U))&&Ut(U)}const R=t;j.add(R,"dragstart",U=>U.preventDefault(),w).add(R,"touchmove",()=>{},w).add(R,"touchend",()=>{}).add(R,"touchstart",D).add(R,"mousedown",D).add(R,"touchcancel",Y).add(R,"contextmenu",Y).add(R,"click",ut,!0)}function et(){j.clear(),S.clear()}function At(){const A=ct?n:t;S.add(A,"touchmove",q,w).add(A,"touchend",Y).add(A,"mousemove",q,w).add(A,"mouseup",Y)}function Nt(A){const D=A.nodeName||"";return k.includes(D)}function lt(){return(m?P:E)[ct?"mouse":"touch"]}function Yt(A,D){const R=f.add(Ze(A)*-1),U=d.byDistance(A,!m).distance;return m||F(A)<N?U:b&&D?U*.5:d.byIndex(R.get(),0).distance}function Ut(A){const D=We(A,r);ct=D,ot=m&&D&&!A.buttons&&H,H=Jt(s.get(),o.get())>=2,!(D&&A.button!==0)&&(Nt(A.target)||(X=!0,a.pointerDown(A),u.useFriction(0).useDuration(0),s.set(o),At(),W=a.readPoint(A),G=a.readPoint(A,v),h.emit("pointerDown")))}function q(A){if(!We(A,r)&&A.touches.length>=2)return Y(A);const R=a.readPoint(A),U=a.readPoint(A,v),nt=Jt(R,W),dt=Jt(U,G);if(!mt&&!ct&&(!A.cancelable||(mt=nt>dt,!mt)))return Y(A);const vt=a.pointerMove(A);nt>y&&(ot=!0),u.useFriction(.3).useDuration(.75),l.start(),s.add(_(vt)),A.preventDefault()}function Y(A){const R=d.byDistance(0,!1).index!==f.get(),U=a.pointerUp(A)*lt(),nt=Yt(_(U),R),dt=ja(U,nt),vt=C-10*dt,pt=g+dt/50;mt=!1,X=!1,S.clear(),u.useDuration(vt).useFriction(pt),c.distance(nt,!m),ct=!1,h.emit("pointerUp")}function ut(A){ot&&(A.stopPropagation(),A.preventDefault(),ot=!1)}function J(){return X}return{init:Ht,destroy:et,pointerDown:J}}function Na(e,t){let r,s;function a(f){return f.timeStamp}function o(f,h){const m=`client${(h||e.scroll)==="x"?"X":"Y"}`;return(We(f,t)?f:f.touches[0])[m]}function l(f){return r=f,s=f,o(f)}function c(f){const h=o(f)-o(s),p=a(f)-a(r)>170;return s=f,p&&(r=f),h}function u(f){if(!r||!s)return 0;const h=o(s)-o(r),p=a(f)-a(r),m=a(f)-a(s)>170,y=h/p;return p&&!m&&F(y)>.1?y:0}return{pointerDown:l,pointerMove:c,pointerUp:u,readPoint:o}}function Ea(){function e(n){const{offsetTop:r,offsetLeft:s,offsetWidth:a,offsetHeight:o}=n;return{top:r,right:s+a,bottom:r+o,left:s,width:a,height:o}}return{measure:e}}function Pa(e){function t(r){return e*(r/100)}return{measure:t}}function Oa(e,t,n,r,s,a,o){const l=[e].concat(r);let c,u,d=[],f=!1;function h(b){return s.measureSize(o.measure(b))}function p(b){if(!a)return;u=h(e),d=r.map(h);function g(x){for(const v of x){if(f)return;const _=v.target===e,k=r.indexOf(v.target),w=_?u:d[k],j=h(_?e:r[k]);if(F(j-w)>=.5){b.reInit(),t.emit("resize");break}}}c=new ResizeObserver(x=>{(Pe(a)||a(b,x))&&g(x)}),n.requestAnimationFrame(()=>{l.forEach(x=>c.observe(x))})}function m(){f=!0,c&&c.disconnect()}return{init:p,destroy:m}}function Ta(e,t,n,r,s,a){let o=0,l=0,c=s,u=a,d=e.get(),f=0;function h(){const w=r.get()-e.get(),j=!c;let S=0;return j?(o=0,n.set(r),e.set(r),S=w):(n.set(e),o+=w/c,o*=u,d+=o,e.add(o),S=d-f),l=Ze(S),f=d,k}function p(){const w=r.get()-t.get();return F(w)<.001}function m(){return c}function y(){return l}function b(){return o}function g(){return v(s)}function x(){return _(a)}function v(w){return c=w,k}function _(w){return u=w,k}const k={direction:y,duration:m,velocity:b,seek:h,settled:p,useBaseFriction:x,useBaseDuration:g,useFriction:_,useDuration:v};return k}function Ca(e,t,n,r,s){const a=s.measure(10),o=s.measure(50),l=wt(.1,.99);let c=!1;function u(){return!(c||!e.reachedAny(n.get())||!e.reachedAny(t.get()))}function d(p){if(!u())return;const m=e.reachedMin(t.get())?"min":"max",y=F(e[m]-t.get()),b=n.get()-t.get(),g=l.constrain(y/o);n.subtract(b*g),!p&&F(b)<a&&(n.set(e.constrain(n.get())),r.useDuration(25).useBaseFriction())}function f(p){c=!p}return{shouldConstrain:u,constrain:d,toggleActive:f}}function Ia(e,t,n,r,s){const a=wt(-t+e,0),o=f(),l=d(),c=h();function u(m,y){return Jt(m,y)<=1}function d(){const m=o[0],y=tt(o),b=o.lastIndexOf(m),g=o.indexOf(y)+1;return wt(b,g)}function f(){return n.map((m,y)=>{const{min:b,max:g}=a,x=a.constrain(m),v=!y,_=tn(n,y);return v?g:_||u(b,x)?b:u(g,x)?g:x}).map(m=>parseFloat(m.toFixed(3)))}function h(){if(t<=e+s)return[a.max];if(r==="keepSnaps")return o;const{min:m,max:y}=l;return o.slice(m,y)}return{snapsContained:c,scrollContainLimit:l}}function Da(e,t,n){const r=t[0],s=n?r-e:tt(t);return{limit:wt(s,r)}}function Ma(e,t,n,r){const a=t.min+.1,o=t.max+.1,{reachedMin:l,reachedMax:c}=wt(a,o);function u(h){return h===1?c(n.get()):h===-1?l(n.get()):!1}function d(h){if(!u(h))return;const p=e*(h*-1);r.forEach(m=>m.add(p))}return{loop:d}}function La(e){const{max:t,length:n}=e;function r(a){const o=a-t;return n?o/-n:0}return{get:r}}function Ba(e,t,n,r,s){const{startEdge:a,endEdge:o}=e,{groupSlides:l}=s,c=f().map(t.measure),u=h(),d=p();function f(){return l(r).map(y=>tt(y)[o]-y[0][a]).map(F)}function h(){return r.map(y=>n[a]-y[a]).map(y=>-F(y))}function p(){return l(u).map(y=>y[0]).map((y,b)=>y+c[b])}return{snaps:u,snapsAligned:d}}function Fa(e,t,n,r,s,a){const{groupSlides:o}=s,{min:l,max:c}=r,u=d();function d(){const h=o(a),p=!e||t==="keepSnaps";return n.length===1?[a]:p?h:h.slice(l,c).map((m,y,b)=>{const g=!y,x=tn(b,y);if(g){const v=tt(b[0])+1;return Fn(v)}if(x){const v=ie(a)-tt(b)[0]+1;return Fn(v,tt(b)[0])}return m})}return{slideRegistry:u}}function $a(e,t,n,r,s){const{reachedAny:a,removeOffset:o,constrain:l}=r;function c(m){return m.concat().sort((y,b)=>F(y)-F(b))[0]}function u(m){const y=e?o(m):l(m),b=t.map((x,v)=>({diff:d(x-y,0),index:v})).sort((x,v)=>F(x.diff)-F(v.diff)),{index:g}=b[0];return{index:g,distance:y}}function d(m,y){const b=[m,m+n,m-n];if(!e)return m;if(!y)return c(b);const g=b.filter(x=>Ze(x)===y);return g.length?c(g):tt(b)-n}function f(m,y){const b=t[m]-s.get(),g=d(b,y);return{index:m,distance:g}}function h(m,y){const b=s.get()+m,{index:g,distance:x}=u(b),v=!e&&a(b);if(!y||v)return{index:g,distance:m};const _=t[g]-x,k=m+d(_,0);return{index:g,distance:k}}return{byDistance:h,byIndex:f,shortcut:d}}function za(e,t,n,r,s,a,o){function l(f){const h=f.distance,p=f.index!==t.get();a.add(h),h&&(r.duration()?e.start():(e.update(),e.render(1),e.update())),p&&(n.set(t.get()),t.set(f.index),o.emit("select"))}function c(f,h){const p=s.byDistance(f,h);l(p)}function u(f,h){const p=t.clone().set(f),m=s.byIndex(p.get(),h);l(m)}return{distance:c,index:u}}function Ra(e,t,n,r,s,a,o,l){const c={passive:!0,capture:!0};let u=0;function d(p){if(!l)return;function m(y){if(new Date().getTime()-u>10)return;o.emit("slideFocusStart"),e.scrollLeft=0;const x=n.findIndex(v=>v.includes(y));Qe(x)&&(s.useDuration(0),r.index(x,0),o.emit("slideFocus"))}a.add(document,"keydown",f,!1),t.forEach((y,b)=>{a.add(y,"focus",g=>{(Pe(l)||l(p,g))&&m(b)},c)})}function f(p){p.code==="Tab"&&(u=new Date().getTime())}return{init:d}}function Gt(e){let t=e;function n(){return t}function r(c){t=o(c)}function s(c){t+=o(c)}function a(c){t-=o(c)}function o(c){return Qe(c)?c:c.get()}return{get:n,set:r,add:s,subtract:a}}function jr(e,t){const n=e.scroll==="x"?o:l,r=t.style;let s=null,a=!1;function o(h){return`translate3d(${h}px,0px,0px)`}function l(h){return`translate3d(0px,${h}px,0px)`}function c(h){if(a)return;const p=_a(e.direction(h));p!==s&&(r.transform=n(p),s=p)}function u(h){a=!h}function d(){a||(r.transform="",t.getAttribute("style")||t.removeAttribute("style"))}return{clear:d,to:c,toggleActive:u}}function Ka(e,t,n,r,s,a,o,l,c){const d=te(s),f=te(s).reverse(),h=g().concat(x());function p(j,S){return j.reduce((N,E)=>N-s[E],S)}function m(j,S){return j.reduce((N,E)=>p(N,S)>0?N.concat([E]):N,[])}function y(j){return a.map((S,N)=>({start:S-r[N]+.5+j,end:S+t-.5+j}))}function b(j,S,N){const E=y(S);return j.map(P=>{const C=N?0:-n,H=N?n:0,W=N?"end":"start",G=E[P][W];return{index:P,loopPoint:G,slideLocation:Gt(-1),translate:jr(e,c[P]),target:()=>l.get()>G?C:H}})}function g(){const j=o[0],S=m(f,j);return b(S,n,!1)}function x(){const j=t-o[0]-1,S=m(d,j);return b(S,-n,!0)}function v(){return h.every(({index:j})=>{const S=d.filter(N=>N!==j);return p(S,t)<=.1})}function _(){h.forEach(j=>{const{target:S,translate:N,slideLocation:E}=j,P=S();P!==E.get()&&(N.to(P),E.set(P))})}function k(){h.forEach(j=>j.translate.clear())}return{canLoop:v,clear:k,loop:_,loopPoints:h}}function Va(e,t,n){let r,s=!1;function a(c){if(!n)return;function u(d){for(const f of d)if(f.type==="childList"){c.reInit(),t.emit("slidesChanged");break}}r=new MutationObserver(d=>{s||(Pe(n)||n(c,d))&&u(d)}),r.observe(e,{childList:!0})}function o(){r&&r.disconnect(),s=!0}return{init:a,destroy:o}}function Ha(e,t,n,r){const s={};let a=null,o=null,l,c=!1;function u(){l=new IntersectionObserver(m=>{c||(m.forEach(y=>{const b=t.indexOf(y.target);s[b]=y}),a=null,o=null,n.emit("slidesInView"))},{root:e.parentElement,threshold:r}),t.forEach(m=>l.observe(m))}function d(){l&&l.disconnect(),c=!0}function f(m){return ee(s).reduce((y,b)=>{const g=parseInt(b),{isIntersecting:x}=s[g];return(m&&x||!m&&!x)&&y.push(g),y},[])}function h(m=!0){if(m&&a)return a;if(!m&&o)return o;const y=f(m);return m&&(a=y),m||(o=y),y}return{init:u,destroy:d,get:h}}function Ya(e,t,n,r,s,a){const{measureSize:o,startEdge:l,endEdge:c}=e,u=n[0]&&s,d=m(),f=y(),h=n.map(o),p=b();function m(){if(!u)return 0;const x=n[0];return F(t[l]-x[l])}function y(){if(!u)return 0;const x=a.getComputedStyle(tt(r));return parseFloat(x.getPropertyValue(`margin-${c}`))}function b(){return n.map((x,v,_)=>{const k=!v,w=tn(_,v);return k?h[v]+d:w?h[v]+f:_[v+1][l]-x[l]}).map(F)}return{slideSizes:h,slideSizesWithGaps:p,startGap:d,endGap:f}}function Ua(e,t,n,r,s,a,o,l,c){const{startEdge:u,endEdge:d,direction:f}=e,h=Qe(n);function p(g,x){return te(g).filter(v=>v%x===0).map(v=>g.slice(v,v+x))}function m(g){return g.length?te(g).reduce((x,v,_)=>{const k=tt(x)||0,w=k===0,j=v===ie(g),S=s[u]-a[k][u],N=s[u]-a[v][d],E=!r&&w?f(o):0,P=!r&&j?f(l):0,C=F(N-P-(S+E));return _&&C>t+c&&x.push(v),j&&x.push(g.length),x},[]).map((x,v,_)=>{const k=Math.max(_[v-1]||0);return g.slice(k,x)}):[]}function y(g){return h?p(g,n):m(g)}return{groupSlides:y}}function Wa(e,t,n,r,s,a,o){const{align:l,axis:c,direction:u,startIndex:d,loop:f,duration:h,dragFree:p,dragThreshold:m,inViewThreshold:y,slidesToScroll:b,skipSnaps:g,containScroll:x,watchResize:v,watchSlides:_,watchDrag:k,watchFocus:w}=a,j=2,S=Ea(),N=S.measure(t),E=n.map(S.measure),P=Sa(c,u),C=P.measureSize(N),H=Pa(C),W=wa(l,C),G=!f&&!!x,X=f||!!x,{slideSizes:mt,slideSizesWithGaps:ot,startGap:ct,endGap:Ht}=Ya(P,N,E,n,X,s),et=Ua(P,C,b,f,N,E,ct,Ht,j),{snaps:At,snapsAligned:Nt}=Ba(P,W,N,E,et),lt=-tt(At)+tt(ot),{snapsContained:Yt,scrollContainLimit:Ut}=Ia(C,lt,Nt,x,j),q=G?Yt:Nt,{limit:Y}=Da(lt,q,f),ut=vr(ie(q),d,f),J=ut.clone(),B=te(n),A=({dragHandler:Et,scrollBody:Ie,scrollBounds:De,options:{loop:ae}})=>{ae||De.constrain(Et.pointerDown()),Ie.seek()},D=({scrollBody:Et,translate:Ie,location:De,offsetLocation:ae,previousLocation:Ar,scrollLooper:Nr,slideLooper:Er,dragHandler:Pr,animation:Or,eventHandler:an,scrollBounds:Tr,options:{loop:on}},cn)=>{const ln=Et.settled(),Cr=!Tr.shouldConstrain(),un=on?ln:ln&&Cr,dn=un&&!Pr.pointerDown();dn&&Or.stop();const Ir=De.get()*cn+Ar.get()*(1-cn);ae.set(Ir),on&&(Nr.loop(Et.direction()),Er.loop()),Ie.to(ae.get()),dn&&an.emit("settle"),un||an.emit("scroll")},R=ka(r,s,()=>A(Ce),Et=>D(Ce,Et)),U=.68,nt=q[ut.get()],dt=Gt(nt),vt=Gt(nt),pt=Gt(nt),jt=Gt(nt),Wt=Ta(dt,pt,vt,jt,h,U),Oe=$a(f,q,lt,Y,jt),Te=za(R,ut,J,Wt,Oe,jt,o),nn=La(Y),rn=ne(),kr=Ha(t,n,o,y),{slideRegistry:sn}=Fa(G,x,q,Ut,et,B),Sr=Ra(e,n,sn,Te,Wt,rn,o,w),Ce={ownerDocument:r,ownerWindow:s,eventHandler:o,containerRect:N,slideRects:E,animation:R,axis:P,dragHandler:Aa(P,e,r,s,jt,Na(P,s),dt,R,Te,Wt,Oe,ut,o,H,p,m,g,U,k),eventStore:rn,percentOfView:H,index:ut,indexPrevious:J,limit:Y,location:dt,offsetLocation:pt,previousLocation:vt,options:a,resizeHandler:Oa(t,o,s,n,P,v,S),scrollBody:Wt,scrollBounds:Ca(Y,pt,jt,Wt,H),scrollLooper:Ma(lt,Y,pt,[dt,pt,vt,jt]),scrollProgress:nn,scrollSnapList:q.map(nn.get),scrollSnaps:q,scrollTarget:Oe,scrollTo:Te,slideLooper:Ka(P,C,lt,mt,ot,At,q,pt,n),slideFocus:Sr,slidesHandler:Va(t,o,_),slidesInView:kr,slideIndexes:B,slideRegistry:sn,slidesToScroll:et,target:jt,translate:jr(P,t)};return Ce}function Ga(){let e={},t;function n(u){t=u}function r(u){return e[u]||[]}function s(u){return r(u).forEach(d=>d(t,u)),c}function a(u,d){return e[u]=r(u).concat([d]),c}function o(u,d){return e[u]=r(u).filter(f=>f!==d),c}function l(){e={}}const c={init:n,emit:s,off:o,on:a,clear:l};return c}const qa={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Xa(e){function t(a,o){return br(a,o||{})}function n(a){const o=a.breakpoints||{},l=ee(o).filter(c=>e.matchMedia(c).matches).map(c=>o[c]).reduce((c,u)=>t(c,u),{});return t(a,l)}function r(a){return a.map(o=>ee(o.breakpoints||{})).reduce((o,l)=>o.concat(l),[]).map(e.matchMedia)}return{mergeOptions:t,optionsAtMedia:n,optionsMediaQueries:r}}function Ja(e){let t=[];function n(a,o){return t=o.filter(({options:l})=>e.optionsAtMedia(l).active!==!1),t.forEach(l=>l.init(a,e)),o.reduce((l,c)=>Object.assign(l,{[c.name]:c}),{})}function r(){t=t.filter(a=>a.destroy())}return{init:n,destroy:r}}function je(e,t,n){const r=e.ownerDocument,s=r.defaultView,a=Xa(s),o=Ja(a),l=ne(),c=Ga(),{mergeOptions:u,optionsAtMedia:d,optionsMediaQueries:f}=a,{on:h,off:p,emit:m}=c,y=P;let b=!1,g,x=u(qa,je.globalOptions),v=u(x),_=[],k,w,j;function S(){const{container:B,slides:A}=v;w=(Ue(B)?e.querySelector(B):B)||e.children[0];const R=Ue(A)?w.querySelectorAll(A):A;j=[].slice.call(R||w.children)}function N(B){const A=Wa(e,w,j,r,s,B,c);if(B.loop&&!A.slideLooper.canLoop()){const D=Object.assign({},B,{loop:!1});return N(D)}return A}function E(B,A){b||(x=u(x,B),v=d(x),_=A||_,S(),g=N(v),f([x,..._.map(({options:D})=>D)]).forEach(D=>l.add(D,"change",P)),v.active&&(g.translate.to(g.location.get()),g.animation.init(),g.slidesInView.init(),g.slideFocus.init(J),g.eventHandler.init(J),g.resizeHandler.init(J),g.slidesHandler.init(J),g.options.loop&&g.slideLooper.loop(),w.offsetParent&&j.length&&g.dragHandler.init(J),k=o.init(J,_)))}function P(B,A){const D=et();C(),E(u({startIndex:D},B),A),c.emit("reInit")}function C(){g.dragHandler.destroy(),g.eventStore.clear(),g.translate.clear(),g.slideLooper.clear(),g.resizeHandler.destroy(),g.slidesHandler.destroy(),g.slidesInView.destroy(),g.animation.destroy(),o.destroy(),l.clear()}function H(){b||(b=!0,l.clear(),C(),c.emit("destroy"),c.clear())}function W(B,A,D){!v.active||b||(g.scrollBody.useBaseFriction().useDuration(A===!0?0:v.duration),g.scrollTo.index(B,D||0))}function G(B){const A=g.index.add(1).get();W(A,B,-1)}function X(B){const A=g.index.add(-1).get();W(A,B,1)}function mt(){return g.index.add(1).get()!==et()}function ot(){return g.index.add(-1).get()!==et()}function ct(){return g.scrollSnapList}function Ht(){return g.scrollProgress.get(g.offsetLocation.get())}function et(){return g.index.get()}function At(){return g.indexPrevious.get()}function Nt(){return g.slidesInView.get()}function lt(){return g.slidesInView.get(!1)}function Yt(){return k}function Ut(){return g}function q(){return e}function Y(){return w}function ut(){return j}const J={canScrollNext:mt,canScrollPrev:ot,containerNode:Y,internalEngine:Ut,destroy:H,off:p,on:h,emit:m,plugins:Yt,previousScrollSnap:At,reInit:y,rootNode:q,scrollNext:G,scrollPrev:X,scrollProgress:Ht,scrollSnapList:ct,scrollTo:W,selectedScrollSnap:et,slideNodes:ut,slidesInView:Nt,slidesNotInView:lt};return E(t,n),setTimeout(()=>c.emit("init"),0),J}je.globalOptions=void 0;function en(e={},t=[]){const n=O.useRef(e),r=O.useRef(t),[s,a]=O.useState(),[o,l]=O.useState(),c=O.useCallback(()=>{s&&s.reInit(n.current,r.current)},[s]);return O.useEffect(()=>{Je(n.current,e)||(n.current=e,c())},[e,c]),O.useEffect(()=>{va(r.current,t)||(r.current=t,c())},[t,c]),O.useEffect(()=>{if(ba()&&o){je.globalOptions=en.globalOptions;const u=je(o,n.current,r.current);return a(u),()=>u.destroy()}else a(void 0)},[o,a]),[l,s]}en.globalOptions=void 0;const Qa={spike:"⚠️",trend:"📈",unusual:"📊",budget:"💰",saving:"🎉"},$n={warning:"border-l-amber-500 bg-amber-50 dark:bg-amber-900/20",success:"border-l-green-500 bg-green-50 dark:bg-green-900/20",info:"border-l-blue-500 bg-blue-50 dark:bg-blue-900/20"};function Za({insight:e,displayCurrency:t="JPY",onScrollToChart:n}){const{t:r}=z("common"),s=Fr(),a=()=>{e.category?s({to:"/transactions",search:{categories:e.category}}):(e.type==="trend"||e.type==="unusual")&&(n==null||n())},o=()=>e.category?r("analytics.viewTransactions",{category:e.category}):e.type==="trend"||e.type==="unusual"?r("analytics.viewBreakdown"):r("analytics.learnMore");return i.jsx("div",{className:M("rounded-xl p-4 border-l-4 min-w-0","bg-white dark:bg-gray-800","shadow-sm",$n[e.severity]||$n.info),children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-2xl flex-shrink-0",children:Qa[e.type]||"💡"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&i.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-1",children:[I(e.amount,t),e.percentage_change&&i.jsxs("span",{className:M("ml-2",e.percentage_change>0?"text-red-600":"text-green-600"),children:[e.percentage_change>0?"+":"",e.percentage_change,"%"]})]}),i.jsxs(rt,{variant:"ghost",className:"mt-2 p-0 h-auto text-sm text-primary-600 hover:text-primary-700",onClick:a,children:[o()," →"]})]})]})})}function to({insights:e,displayCurrency:t="JPY",onScrollToChart:n}){const{t:r}=z("common"),[s,a]=O.useState(0),[o,l]=en({loop:!1,align:"start",containScroll:"trimSnaps"}),c=O.useCallback(()=>{l&&a(l.selectedScrollSnap())},[l]);return O.useEffect(()=>{if(l)return c(),l.on("select",c),()=>{l.off("select",c)}},[l,c]),!e||e.length===0?null:i.jsxs("div",{className:"relative",children:[e.length>1&&i.jsx("p",{className:"text-xs text-gray-400 text-center mb-2",children:r("analytics.swipeHint")}),i.jsx("div",{className:"overflow-hidden",ref:o,children:i.jsx("div",{className:"flex gap-3",children:e.map((u,d)=>i.jsx("div",{className:"flex-shrink-0 w-full min-w-0",children:i.jsx(Za,{insight:u,displayCurrency:t,onScrollToChart:n})},`${u.type}-${u.category||d}`))})}),e.length>1&&i.jsx("div",{className:"flex justify-center gap-1.5 mt-3",children:e.map((u,d)=>i.jsx("button",{"aria-label":`Go to insight ${d+1}`,className:M("w-2 h-2 rounded-full transition-all",d===s?"bg-primary-600 w-4":"bg-gray-300 dark:bg-gray-600"),onClick:()=>l==null?void 0:l.scrollTo(d)},d))})]})}function _r({selectedMonth:e,onChange:t,className:n}){const{i18n:r}=z(),s=c=>{const u=r.language;return u==="ja"?ht(c,"yyyy年M月"):u==="vi"?`Tháng ${ht(c,"M/yyyy")}`:ht(c,"MMMM yyyy")},a=()=>{t(fe(e,1))},o=()=>{const c=hn(e,1);c<=new Date&&t(c)},l=hn(e,1)>new Date;return i.jsxs("div",{className:M("flex items-center gap-2",n),children:[i.jsx("button",{onClick:a,className:M("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors"),"aria-label":"Previous month",children:"←"}),i.jsx("span",{className:"min-w-[140px] text-center font-medium text-gray-900 dark:text-gray-100",children:s(e)}),i.jsx("button",{onClick:o,disabled:l,className:M("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors",l&&"opacity-50 cursor-not-allowed"),"aria-label":"Next month",children:"→"})]})}const eo=[{value:"current-month",labelKey:"analytics.currentMonth"},{value:"3-months",labelKey:"analytics.3months"},{value:"6-months",labelKey:"analytics.6months"},{value:"1-year",labelKey:"analytics.1year"}];function no({selected:e,onChange:t,className:n}){const{t:r}=z("common");return i.jsx("div",{className:M("inline-flex rounded-lg bg-gray-100 dark:bg-gray-800 p-1",n),children:eo.map(({value:s,labelKey:a})=>i.jsx("button",{onClick:()=>t(s),className:M("px-3 py-1.5 text-sm font-medium rounded-md transition-all",s===e?"bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:r(a)},s))})}function ro({year:e,month:t,onDownloadPDF:n,isDownloading:r}){const{t:s}=z("common"),a=ht(new Date(e,t-1),"MMMM yyyy");return i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:s("report.title")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:n,disabled:r,className:"p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":s(r?"report.downloading":"report.downloadPDF"),title:s(r?"report.downloading":"report.downloadPDF"),children:r?i.jsx($r,{size:18,className:"animate-spin"}):i.jsx(ds,{size:18})}),i.jsx("button",{disabled:!0,className:"p-2 rounded-lg text-gray-400 dark:text-gray-600 cursor-not-allowed","aria-label":s("report.sendEmail"),title:s("report.comingSoon"),children:i.jsx(fs,{size:18})})]})]})}function wr({value:e,invertColor:t=!1,className:n}){const{t:r}=z("common");if(e==null)return i.jsx("span",{className:M("inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium","bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400",n),children:r("report.deltaNew")});if(e===0)return i.jsx("span",{className:M("inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium","bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400",n),children:"0%"});const s=e>0,a=t?!s:s,o=s?ls:us;return i.jsxs("span",{className:M("inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-xs font-medium",a?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",n),children:[i.jsx(o,{className:"w-3 h-3"}),Math.abs(e).toFixed(1),"%"]})}const Ge=({value:e,max:t=100,className:n})=>{const r=Math.min(100,Math.max(0,e/t*100));return i.jsx("div",{className:_e("h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",n),children:i.jsx("div",{className:"h-full bg-primary-600 animate-progress-fill",style:{width:`${r}%`}})})};function so(e){switch(e){case"over_budget":return"error";case"threshold_80":return"warning";case"threshold_50":return"info";default:return"success"}}function io(e,t){switch(e){case"over_budget":return t("report.overBudget");case"threshold_80":return t("report.warning");case"threshold_50":return t("report.caution");default:return t("report.onTrack")}}function ao({data:e}){const{t}=z("common");return i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[i.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[I(Math.abs(e.total_spent))," / ",I(e.total_budget)]}),i.jsxs("span",{className:M("font-medium",e.is_over_budget?"text-red-500":"text-gray-700 dark:text-gray-300"),children:[e.percentage_used.toFixed(1),"%"]})]}),i.jsx(Ge,{value:Math.min(e.percentage_used,100)})]}),i.jsx("div",{className:"space-y-3",children:e.category_status.map(n=>i.jsx("div",{className:"flex items-center justify-between gap-2",children:i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("span",{className:"text-sm font-medium truncate text-gray-900 dark:text-gray-100",children:n.category}),i.jsx(wr,{value:n.spending_change,invertColor:!0,className:"ml-1"}),i.jsx(Kn,{variant:so(n.status),className:"ml-1 text-[10px]",children:io(n.status,t)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ge,{value:Math.min(n.percentage,100),className:"flex-1"}),i.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-16 text-right",children:[I(Math.abs(n.spent))," / ",I(n.budget_amount)]})]})]})},n.category))})]})}function oo({status:e}){switch(e){case"over_budget":return i.jsx(Rr,{className:"w-5 h-5 text-red-500 shrink-0"});case"threshold_80":return i.jsx(ze,{className:"w-5 h-5 text-amber-500 shrink-0"});case"threshold_50":return i.jsx(ze,{className:"w-5 h-5 text-yellow-500 shrink-0"});default:return i.jsx(zr,{className:"w-5 h-5 text-green-500 shrink-0"})}}function co(e){switch(e){case"over_budget":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"threshold_80":return"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800";case"threshold_50":return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800";default:return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"}}function lo({focusAreas:e,budgetAdherence:t}){const{t:n}=z("common"),[r,s]=O.useState(!1),a=t.category_status.length;return e.length===0?i.jsx("div",{className:"text-center py-6 text-sm text-gray-500 dark:text-gray-400",children:n("report.noFocusAreas")}):i.jsxs("div",{className:"space-y-3",children:[e.map(o=>i.jsx("div",{className:M("rounded-lg border p-3",co(o.status)),children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(oo,{status:o.status}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:o.category}),i.jsx(wr,{value:o.spending_change,invertColor:!0})]}),i.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:[I(Math.abs(o.spent))," / ",I(o.budget_amount)]}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n(o.suggestion_key,o.suggestion_params)})]})]})},o.category)),a>e.length&&i.jsxs("button",{onClick:()=>s(!r),className:"flex items-center gap-1 text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline w-full justify-center py-2",children:[r?n("report.hideAll"):n("report.seeAll",{count:a}),r?i.jsx(hs,{className:"w-4 h-4"}):i.jsx(ms,{className:"w-4 h-4"})]}),r&&i.jsx(ao,{data:t})]})}function uo(e){const t=e.summary;if(t.total_income===0&&t.total_expense===0)return null;const n=t.expense_change<0?`Expenses decreased by ${Math.abs(t.expense_change).toFixed(1)}%`:t.savings_rate>20?`Savings rate at ${t.savings_rate.toFixed(1)}%`:`Income: ${t.total_income.toLocaleString()}`,r=t.expense_change>10?`Expenses increased by ${t.expense_change.toFixed(1)}%`:t.savings_rate<10?`Low savings rate: ${t.savings_rate.toFixed(1)}%`:"No major concerns this month",s=t.net_change>0?`Net cashflow improved by ${t.net_change.toFixed(1)}%`:t.net_change<0?`Net cashflow decreased by ${Math.abs(t.net_change).toFixed(1)}%`:"Cashflow stable compared to last month";return{year:e.year,month:e.month,win:n,warning:r,trend:s,generated_at:"",is_cached:!1,credits_used:0}}const fo=[{key:"win",Icon:Hr,color:"text-green-600 dark:text-green-400",bg:"bg-green-100 dark:bg-green-900/30"},{key:"warning",Icon:ze,color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-100 dark:bg-amber-900/30"},{key:"trend",Icon:zn,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-100 dark:bg-blue-900/30"}];function ho({year:e,month:t,reportData:n}){const{t:r}=z("common"),{data:s,refetch:a}=Ct({queryKey:["ai-summary",e,t],queryFn:()=>Yr(e,t),staleTime:1/0,retry:!1}),o=Fe({mutationFn:d=>Kr(e,t,void 0,d),onSuccess:()=>{a()},onError:()=>{Vn.error(r("report.aiSummaryError"))}}),l=s??uo(n),c=o.isPending,u=!!s;return!l&&!u?i.jsx(V,{className:"p-4",children:i.jsxs("button",{onClick:()=>o.mutate(!1),disabled:c,className:"flex items-center gap-2 w-full justify-center py-2 text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline disabled:opacity-50",children:[i.jsx(Me,{className:"w-4 h-4"}),r("report.generateSummary"),i.jsxs("span",{className:"text-xs text-gray-400",children:["~0.02 ",r("report.credits")]})]})}):i.jsxs(V,{className:"p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-1.5",children:[i.jsx(Me,{className:"w-4 h-4 text-primary-500"}),r("report.smartSummary")]}),i.jsxs("button",{onClick:()=>o.mutate(!0),disabled:c,className:"text-xs text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 flex items-center gap-1 disabled:opacity-50",children:[i.jsx(Vr,{className:`w-3 h-3 ${c?"animate-spin":""}`}),r("report.regenerate")]})]}),c?i.jsx("div",{className:"flex justify-center py-4",children:i.jsx(Dt,{size:"sm"})}):i.jsxs("div",{className:"space-y-2.5",children:[fo.map(({key:d,Icon:f,color:h,bg:p})=>i.jsxs("div",{className:"flex items-start gap-2.5",children:[i.jsx("div",{className:`p-1 rounded-md ${p} shrink-0`,children:i.jsx(f,{className:`w-3.5 h-3.5 ${h}`})}),i.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-snug",children:l==null?void 0:l[d]})]},d)),!u&&i.jsxs("button",{onClick:()=>o.mutate(!1),className:"text-xs text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1 mt-1",children:[i.jsx(Me,{className:"w-3 h-3"}),r("report.generateAI"),i.jsxs("span",{className:"text-gray-400",children:["~0.02 ",r("report.credits")]})]})]})]})}function mo(e){switch(e){case"ahead":return"success";case"on_track":return"info";default:return"warning"}}function po({goal:e}){const{t}=z("common"),n={ahead:t("report.ahead"),on_track:t("report.onTrack"),behind:t("report.behind")}[e.status]||e.status;return i.jsxs("div",{className:"p-4 border rounded-lg border-gray-200 dark:border-gray-700",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:t("report.goalYears",{years:e.years})}),i.jsx(Kn,{variant:mo(e.status),children:n})]}),i.jsx(Ge,{value:Math.min(e.progress_percentage,100),className:"mb-2"}),i.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[i.jsxs("span",{children:[I(e.total_saved)," / ",I(e.target_amount)]}),i.jsxs("span",{children:[e.progress_percentage.toFixed(1),"%"]})]}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:t("report.neededPerMonth",{amount:I(e.needed_per_month)})})]})}function go({accounts:e,totalNetWorth:t}){const{t:n}=z("common");return i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[i.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:n("report.totalNetWorth")}),i.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:I(t)})]}),i.jsx("div",{className:"space-y-2",children:e.map(r=>i.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:r.account_name}),i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.account_type})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:I(r.balance,r.currency,void 0,!0)}),r.currency!=="JPY"&&i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.currency})]})]},r.account_id))})]})}function yo({insights:e}){const{t}=z("common");return e.length===0?null:i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.insights")}),i.jsx("div",{className:"space-y-3",children:e.map((n,r)=>i.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600",children:[i.jsx("div",{className:"flex items-center gap-2 mb-1",children:i.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:n.title})}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n.message})]},r))})]})}function xo({embedded:e=!1}){const{t}=z("common"),[n,r]=O.useState(new Date),[s,a]=O.useState(!1),o=n.getFullYear(),l=n.getMonth()+1,{data:c,isLoading:u,error:d}=Ct({queryKey:["monthly-report",o,l],queryFn:()=>Wr(o,l),staleTime:1e3*60*5}),f=O.useCallback(async()=>{a(!0);try{const p=await Ur(o,l),m=URL.createObjectURL(p),y=document.createElement("a");y.href=m,y.download=`monthly_report_${o}_${String(l).padStart(2,"0")}.pdf`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(m)}catch{Vn.error(t("report.downloadError"))}finally{a(!1)}},[o,l,t]),h=i.jsxs(i.Fragment,{children:[i.jsx(ro,{year:o,month:l,onDownloadPDF:f,isDownloading:s}),i.jsx(_r,{selectedMonth:n,onChange:r,className:"mb-6"}),u&&i.jsx("div",{className:"flex justify-center py-20",children:i.jsx(Dt,{size:"lg"})}),d&&i.jsx(V,{className:"text-center py-10",children:i.jsx("p",{className:"text-red-500",children:t("report.loadError")})}),c&&i.jsxs("div",{className:"space-y-6",children:[i.jsx(ho,{year:o,month:l,reportData:c}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[i.jsx(bt,{label:t("analytics.heroIncome"),value:I(c.summary.total_income),change:c.summary.income_change,trend:c.summary.income_change>0?"positive":c.summary.income_change<0?"negative":"neutral"}),i.jsx(bt,{label:t("analytics.heroExpense"),value:I(c.summary.total_expense),change:c.summary.expense_change,trend:c.summary.expense_change<0?"positive":c.summary.expense_change>0?"negative":"neutral"}),i.jsx(bt,{label:t("analytics.heroNet"),value:I(c.summary.net_cashflow),change:c.summary.net_change,trend:c.summary.net_change>0?"positive":c.summary.net_change<0?"negative":"neutral"}),i.jsx(bt,{label:t("report.savingsRate"),value:`${c.summary.savings_rate.toFixed(1)}%`,subtitle:t("report.savingsRateDesc")})]}),c.budget_adherence&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.budgetAdherence")}),i.jsx(lo,{focusAreas:c.budget_adherence.focus_areas??[],budgetAdherence:c.budget_adherence})]}),c.category_breakdown.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.categoryBreakdown")}),i.jsx(lr,{data:c.category_breakdown})]}),c.spending_trends.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.spendingTrends")}),i.jsx(cr,{data:c.spending_trends})]}),c.goal_progress.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.goalProgress")}),i.jsx("div",{className:"space-y-4",children:c.goal_progress.map(p=>i.jsx(po,{goal:p},p.goal_id))})]}),c.account_summary.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.accountSummary")}),i.jsx(go,{accounts:c.account_summary,totalNetWorth:c.total_net_worth})]}),i.jsx(yo,{insights:c.insights}),c.summary.total_income===0&&c.summary.total_expense===0&&i.jsx(V,{className:"text-center py-10",children:i.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("report.noData")})})]})]});return e?h:i.jsx("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:h})}function bo(e,t){const n=qr(t),r=ht(n>new Date?new Date:n,"yyyy-MM-dd");switch(e){case"current-month":return{start:ht(oe(t),"yyyy-MM-dd"),end:r};case"3-months":return{start:ht(fe(oe(t),2),"yyyy-MM-dd"),end:r};case"6-months":return{start:ht(fe(oe(t),5),"yyyy-MM-dd"),end:r};case"1-year":return{start:ht(fe(oe(t),11),"yyyy-MM-dd"),end:r};default:return Xr()}}function vo(){const{t:e}=z("common"),t=Gr({strict:!1}),[n,r]=O.useState((t==null?void 0:t.tab)==="report"?"report":"overview"),s=O.useRef(null),[a,o]=O.useState(new Date),[l,c]=O.useState("current-month"),[u,d]=O.useState(!1),f=bo(l,a),{data:h,isLoading:p}=Ct({queryKey:["analytics",f],queryFn:()=>Jr(f)}),{data:m}=Ct({queryKey:["insights"],queryFn:Rn}),{data:y}=Ct({queryKey:["goals"],queryFn:Qr}),b=y&&y.length>0?Math.round(y[0].target_amount/(y[0].years*12)):null,g=_=>{c(_)},x=_=>{o(_)},v=O.useCallback(()=>{var _;(_=s.current)==null||_.scrollIntoView({behavior:"smooth"})},[]);return i.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100",children:e("analytics.title")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:e("analytics.subtitle")})]}),i.jsx("div",{className:"flex justify-center mb-6",children:i.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-full p-1 inline-flex",role:"tablist",children:[i.jsx("button",{role:"tab","aria-selected":n==="overview",onClick:()=>r("overview"),className:M("px-4 py-2 text-sm font-medium rounded-full transition-colors",n==="overview"?"bg-primary-500 text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:e("analytics.tabOverview","Overview")}),i.jsx("button",{role:"tab","aria-selected":n==="report",onClick:()=>r("report"),className:M("px-4 py-2 text-sm font-medium rounded-full transition-colors",n==="report"?"bg-primary-500 text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:e("analytics.tabReport","Monthly Report")})]})}),n==="report"?i.jsx(xo,{embedded:!0}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-6 space-y-3",children:[i.jsx(_r,{selectedMonth:a,onChange:x,className:"justify-center"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(no,{selected:l,onChange:g})})]}),p?i.jsx("div",{className:"flex justify-center py-12",children:i.jsx(Dt,{size:"lg"})}):i.jsxs("div",{className:"space-y-6",children:[h&&i.jsx(ya,{analytics:h}),(m==null?void 0:m.insights)&&m.insights.length>0&&i.jsx(to,{insights:m.insights,onScrollToChart:v}),i.jsxs("div",{ref:s,className:"space-y-6",children:[i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.incomeVsExpense")}),i.jsx(Be,{className:"h-64 sm:h-80",children:h!=null&&h.monthly_trends&&h.monthly_trends.length>0?i.jsx(cr,{data:h.monthly_trends}):i.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]}),i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.categoryBreakdown")}),i.jsx(Be,{className:"h-64 sm:h-80",children:h!=null&&h.category_breakdown&&h.category_breakdown.length>0?i.jsx(lr,{data:h.category_breakdown}):i.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]}),i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.monthlyCashFlow")}),i.jsx("div",{className:"h-64 sm:h-80",children:h!=null&&h.monthly_trends&&h.monthly_trends.length>0?h.monthly_trends.length<3?i.jsx(qs,{data:h.monthly_trends,savingsGoal:b}):i.jsx(Be,{className:"h-full",children:i.jsx(Gs,{data:h.monthly_trends,dataKey:"net"})}):i.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]})]}),i.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[i.jsxs("button",{onClick:()=>d(!u),className:M("w-full px-4 py-3 flex items-center justify-between","bg-gray-50 dark:bg-gray-800","text-left font-medium text-gray-900 dark:text-gray-100"),children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{children:"🤖"}),e("analytics.aiTools")]}),i.jsx("span",{className:M("transform transition-transform",u?"rotate-180":""),children:"▼"})]}),u&&i.jsxs("div",{className:"p-4 space-y-4 bg-white dark:bg-gray-900",children:[i.jsx(ga,{}),i.jsx(ha,{})]})]})]})]})]})}const Co=Zr("/analytics")({component:vo});export{Co as Route};
