import{c as e,k as t,j as a,u as r,m as s}from"./vendor-tanstack-CNAyyoyW.js";import{r as n,a as i}from"./vendor-react-Bx4JnVfy.js";import{R as l}from"./RecurringTransactionsList-CBkNYAz9.js";import{u as o,c,I as d,B as u,C as g}from"./index-D_WYPlpB.js";import{S as m}from"./Select-DugyblwZ.js";import{R as x}from"./RecurringOptions-4_-LPjb9.js";import{d as y,e as h,f as p,g as b,h as f}from"./recurring-service-CuEa5IC9.js";import{u as j}from"./vendor-i18n-BrrOrGm_.js";import{X as v,A as k,y as N,z as w,P as S,a0 as _}from"./vendor-icons-BP-EQ_TG.js";import"./vendor-recharts-BrNIwK9z.js";import"./vendor-date-BkGg5e1q.js";function C({isOpen:r,onClose:s,editItem:l,initialSuggestion:g}){const{t:b}=j("common"),f=e(),{data:k}=o(),{data:N}=y(),w=(e=[])=>e.flatMap(e=>[{name:e.name},...e.children.map(e=>({name:e.name}))]),S=w(null==N?void 0:N.expense),_=w(null==N?void 0:N.income),[C,q]=n.useState(""),[D,O]=n.useState(""),[I,F]=n.useState(""),[P,T]=n.useState(null),[R,A]=n.useState(!1),[K,M]=n.useState("monthly"),[Q,z]=n.useState(0),[L,E]=n.useState(1),[W,B]=n.useState(7),[G,H]=n.useState((new Date).toISOString().split("T")[0]);n.useEffect(()=>{r&&l?(q(l.description),O(Math.abs(l.amount).toString()),F(l.category),T(l.account_id),A(l.is_income),M(l.frequency),z(l.day_of_week??0),E(l.day_of_month??1),B(l.interval_days??7),H(l.next_run_date)):r&&g?(q(g.description),O(g.amount.toString()),F(g.category),T(null),A(g.is_income),M(g.frequency),z(g.day_of_week??0),E(g.day_of_month??(new Date).getDate()),B(g.interval_days??14),H((new Date).toISOString().split("T")[0])):r&&(q(""),O(""),F(""),T(null),A(!1),M("monthly"),z(0),E((new Date).getDate()),B(7),H((new Date).toISOString().split("T")[0]))},[r,l,g]);const J=t({mutationFn:h,onSuccess:()=>{f.invalidateQueries({queryKey:["recurring-transactions"]}),s()}}),U=t({mutationFn:({id:e,data:t})=>p(e,t),onSuccess:()=>{f.invalidateQueries({queryKey:["recurring-transactions"]}),s()}}),V=R?_:S,X=J.isPending||U.isPending;if(!r)return null;const Y=a.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:s}),a.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-lg max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:b(l?"recurring.edit":"recurring.add")}),a.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:a.jsx(v,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:e=>{e.preventDefault();const t={description:C,amount:parseInt(D,10),category:I,account_id:P,is_income:R,frequency:K,day_of_week:"weekly"===K?Q:null,day_of_month:"monthly"===K?L:null,interval_days:"custom"===K?W:null,start_date:G};l?U.mutate({id:l.id,data:t}):J.mutate(t)},className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:b("transaction.type")}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{type:"button",onClick:()=>A(!1),className:c("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",R?"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400":"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300"),children:b("transaction.expense")}),a.jsx("button",{type:"button",onClick:()=>A(!0),className:c("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",R?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:b("transaction.income")})]})]}),a.jsx(d,{label:b("transaction.description"),value:C,onChange:e=>q(e.target.value),placeholder:b("recurring.descriptionPlaceholder","e.g., Monthly rent"),required:!0}),a.jsx(d,{label:b("transaction.amount"),type:"number",value:D,onChange:e=>O(e.target.value),placeholder:"0",min:"1",required:!0}),a.jsx(m,{label:b("transaction.category"),value:I,onChange:e=>F(e.target.value),options:[{value:"",label:b("transaction.selectCategory")},...V.map(e=>({value:e.name,label:e.name}))],required:!0}),a.jsx(m,{label:b("transaction.account"),value:(null==P?void 0:P.toString())??"",onChange:e=>T(e.target.value?parseInt(e.target.value,10):null),options:[{value:"",label:b("transaction.selectAccount","Select account (optional)")},...(null==k?void 0:k.map(e=>({value:e.id.toString(),label:e.name})))??[]]}),a.jsx(x,{frequency:K,setFrequency:M,dayOfWeek:Q,setDayOfWeek:z,dayOfMonth:L,setDayOfMonth:E,intervalDays:W,setIntervalDays:B}),a.jsx(d,{label:b("recurring.startDate"),type:"date",value:G,onChange:e=>H(e.target.value),required:!0}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx(u,{type:"button",variant:"outline",onClick:s,className:"flex-1",children:b("button.cancel")}),a.jsx(u,{type:"submit",disabled:X,className:"flex-1",children:X?b("button.saving","Saving..."):b("button.save")})]})]})]})]});return"undefined"==typeof document?null:i.createPortal(Y,document.body)}const q="Â¥";function D({onCreateFromSuggestion:s}){const{t:i}=j("common"),l=e(),[o,d]=n.useState(!0),[m,x]=n.useState(null),{data:y,isLoading:h}=r({queryKey:["recurring-suggestions"],queryFn:()=>f(3),staleTime:3e5}),p=t({mutationFn:b,onSuccess:()=>{l.invalidateQueries({queryKey:["recurring-suggestions"]}),x(null)},onError:()=>{x(null)}}),_=e=>{switch(e.frequency){case"weekly":return i("recurring.weekly");case"monthly":return i("recurring.monthly");case"custom":return i("recurring.everyNDays",{n:e.interval_days??14});default:return e.frequency}};return h||!y||0===y.length?null:a.jsxs(g,{className:"mb-6 border-l-4 border-l-amber-400 bg-amber-50/50 dark:bg-amber-950/20",children:[a.jsxs("button",{onClick:()=>d(!o),className:"w-full flex items-center justify-between text-left",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/50 rounded-lg",children:a.jsx(k,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("recurring.suggestions.title","Detected Patterns")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("recurring.suggestions.subtitle","{{count}} potential recurring transactions found",{count:y.length})})]})]}),o?a.jsx(N,{className:"w-5 h-5 text-gray-400"}):a.jsx(w,{className:"w-5 h-5 text-gray-400"})]}),o&&a.jsx("div",{className:"mt-4 space-y-3",children:y.map(e=>{return a.jsx("div",{className:c("p-4 rounded-lg border bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700","transition-opacity",m===e.hash&&"opacity-50"),children:a.jsxs("div",{className:"flex items-start justify-between gap-4",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.description}),a.jsxs("span",{className:c("px-2 py-0.5 text-xs font-medium rounded-full",(t=e.confidence,t>=80?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":t>=60?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300")),children:[e.confidence,"%"]})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{className:c("font-numbers",e.is_income?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.is_income?"+":"-",q,e.amount.toLocaleString()]}),a.jsx("span",{children:e.category}),a.jsx("span",{children:_(e)}),a.jsx("span",{className:"text-xs",children:i("recurring.suggestions.occurrences","{{count}} times",{count:e.occurrences})})]})]}),a.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[a.jsxs(u,{size:"sm",variant:"primary",onClick:()=>s(e),className:"gap-1",children:[a.jsx(S,{className:"w-4 h-4"}),i("button.create")]}),a.jsx("button",{onClick:t=>((e,t)=>{t.stopPropagation(),x(e),p.mutate(e)})(e.hash,t),disabled:m===e.hash,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:i("recurring.suggestions.dismiss","Dismiss"),children:a.jsx(v,{className:"w-4 h-4"})})]})]})},e.hash);var t})})]})}const O=s("/recurring")({component:function(){const{t:t}=j("common"),r=e(),[s,i]=n.useState(!1),[o,c]=n.useState(null);return a.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(_,{className:"w-8 h-8 text-blue-500"}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("recurring.pageTitle","Recurring Transactions")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t("recurring.pageSubtitle","Automate your regular income and expenses")})]})]}),a.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(S,{className:"w-5 h-5"}),t("recurring.add","Add Recurring")]})]}),a.jsx(D,{onCreateFromSuggestion:e=>{c(e),i(!0)}}),a.jsx(l,{}),a.jsx(C,{isOpen:s,onClose:()=>{i(!1),c(null),r.invalidateQueries({queryKey:["recurring-suggestions"]})},initialSuggestion:o})]})}});export{O as Route};
