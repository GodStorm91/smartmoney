var Ve=t=>{throw TypeError(t)};var Ae=(t,s,r)=>s.has(t)||Ve("Cannot "+r);var T=(t,s,r)=>(Ae(t,s,"read from private field"),r?r.call(t):s.get(t)),Y=(t,s,r)=>s.has(t)?Ve("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,r),H=(t,s,r,a)=>(Ae(t,s,"write to private field"),a?a.call(t,r):s.set(t,r),r),G=(t,s,r)=>(Ae(t,s,"access private method"),r);import{b1 as jt,b2 as Le,b3 as vt,b4 as kt,b5 as nt,J as ae,b6 as Nt,b7 as wt,r as g,b8 as _t,b9 as Ct,ba as St,bb as Ft,bc as We,bd as Ue,be as Mt,bf as Rt,k as Z,u as X,x as At,N as lt,M as we,j as e,C as ue,l as I,a8 as se,bg as Dt,bh as Pt,bi as Lt,Y as _e,v as Ce,$ as it,z as Q,a3 as W,E as ge,ao as qe,o as ot,R as re,T as qt,I as Je,B as he,P as ze,aW as Et,g as ye,ay as Se,p as Qe,aO as Ee,L as ve,X as oe,H as Fe,au as dt,aA as $t,K as Tt,ag as It,as as je,az as Ot,a1 as ct,bj as Bt,ad as de,af as zt,i as Qt}from"./index-CqkF-9Du.js";import{c as Kt,d as Ht,s as Vt,C as ke,e as Ne,f as xt,h as Wt,i as Ut,j as mt,k as ut,l as gt,m as ht,n as Jt,o as Yt,p as Gt,q as Xt,r as Zt,t as es,u as yt,v as pt}from"./crypto-CyRaatqk.js";import{E as Ke}from"./HierarchicalCategoryPicker-BiiqqkZC.js";import{C as Me}from"./chevron-down-U6P-4oA9.js";import{R as ts,B as ss}from"./generateCategoricalChart-B0OhJUud.js";import{L as rs}from"./LineChart-CRXsrov7.js";import{C as as,X as ns,Y as ls,L as is}from"./YAxis-CMN-KoFi.js";import{C as bt}from"./chevron-up-CR4GJipl.js";import{C as os}from"./clock-KmUpsSzT.js";import{T as ds,R as cs}from"./TransactionFormModal-1ZqRqIIB.js";import"./useCategories-CvMuzx9p.js";import"./recurring-service-DRysxgtb.js";import"./RecurringOptions-DeQ2BUHS.js";import"./useXPGain-DX6Gl6aa.js";function Ye(t,s){const r=new Set(s);return t.filter(a=>!r.has(a))}function xs(t,s,r){const a=t.slice(0);return a[s]=r,a}var ne,V,le,ie,J,te,pe,be,fe,z,$e,Te,Ie,Oe,Be,at,ms=(at=class extends jt{constructor(s,r,a){super();Y(this,z);Y(this,ne);Y(this,V);Y(this,le);Y(this,ie);Y(this,J);Y(this,te);Y(this,pe);Y(this,be);Y(this,fe,[]);H(this,ne,s),H(this,ie,a),H(this,le,[]),H(this,J,[]),H(this,V,[]),this.setQueries(r)}onSubscribe(){this.listeners.size===1&&T(this,J).forEach(s=>{s.subscribe(r=>{G(this,z,Oe).call(this,s,r)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,T(this,J).forEach(s=>{s.destroy()})}setQueries(s,r){H(this,le,s),H(this,ie,r),Le.batch(()=>{const a=T(this,J),c=G(this,z,Ie).call(this,T(this,le));H(this,fe,c),c.forEach(b=>b.observer.setOptions(b.defaultedQueryOptions));const l=c.map(b=>b.observer),n=l.map(b=>b.getCurrentResult()),p=a.length!==l.length,j=l.some((b,N)=>b!==a[N]),k=p||j,S=k?!0:n.some((b,N)=>{const u=T(this,V)[N];return!u||!vt(b,u)});!k&&!S||(k&&H(this,J,l),H(this,V,n),this.hasListeners()&&(k&&(Ye(a,l).forEach(b=>{b.destroy()}),Ye(l,a).forEach(b=>{b.subscribe(N=>{G(this,z,Oe).call(this,b,N)})})),G(this,z,Be).call(this)))})}getCurrentResult(){return T(this,V)}getQueries(){return T(this,J).map(s=>s.getCurrentQuery())}getObservers(){return T(this,J)}getOptimisticResult(s,r){const a=G(this,z,Ie).call(this,s),c=a.map(l=>l.observer.getOptimisticResult(l.defaultedQueryOptions));return[c,l=>G(this,z,Te).call(this,l??c,r),()=>G(this,z,$e).call(this,c,a)]}},ne=new WeakMap,V=new WeakMap,le=new WeakMap,ie=new WeakMap,J=new WeakMap,te=new WeakMap,pe=new WeakMap,be=new WeakMap,fe=new WeakMap,z=new WeakSet,$e=function(s,r){return r.map((a,c)=>{const l=s[c];return a.defaultedQueryOptions.notifyOnChangeProps?l:a.observer.trackResult(l,n=>{r.forEach(p=>{p.observer.trackProp(n)})})})},Te=function(s,r){return r?((!T(this,te)||T(this,V)!==T(this,be)||r!==T(this,pe))&&(H(this,pe,r),H(this,be,T(this,V)),H(this,te,kt(T(this,te),r(s)))),T(this,te)):s},Ie=function(s){const r=new Map;T(this,J).forEach(c=>{const l=c.options.queryHash;if(!l)return;const n=r.get(l);n?n.push(c):r.set(l,[c])});const a=[];return s.forEach(c=>{var j;const l=T(this,ne).defaultQueryOptions(c),p=((j=r.get(l.queryHash))==null?void 0:j.shift())??new nt(T(this,ne),l);a.push({defaultedQueryOptions:l,observer:p})}),a},Oe=function(s,r){const a=T(this,J).indexOf(s);a!==-1&&(H(this,V,xs(T(this,V),a,r)),G(this,z,Be).call(this))},Be=function(){var s;if(this.hasListeners()){const r=T(this,te),a=G(this,z,$e).call(this,T(this,V),T(this,fe)),c=G(this,z,Te).call(this,a,(s=T(this,ie))==null?void 0:s.combine);r!==c&&Le.batch(()=>{this.listeners.forEach(l=>{l(T(this,V))})})}},at);function Ge({queries:t,...s},r){const a=ae(),c=Nt(),l=wt(),n=g.useMemo(()=>t.map(C=>{const D=a.defaultQueryOptions(C);return D._optimisticResults=c?"isRestoring":"optimistic",D}),[t,a,c]);n.forEach(C=>{_t(C),Ct(C,l)}),St(l);const[p]=g.useState(()=>new ms(a,n,s)),[j,k,S]=p.getOptimisticResult(n,s.combine),b=!c&&s.subscribed!==!1;g.useSyncExternalStore(g.useCallback(C=>b?p.subscribe(Le.batchCalls(C)):Ft,[p,b]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),g.useEffect(()=>{p.setQueries(n,s)},[n,s,p]);const u=j.some((C,D)=>We(n[D],C))?j.flatMap((C,D)=>{const M=n[D];if(M){const h=new nt(a,M);if(We(M,C))return Ue(M,h,l);Mt(C,c)&&Ue(M,h,l)}return[]}):[];if(u.length>0)throw Promise.all(u);const R=j.find((C,D)=>{const M=n[D];return M&&Rt({result:C,errorResetBoundary:l,throwOnError:M.throwOnError,query:a.getQueryCache().get(M.queryHash),suspense:M.suspense})});if(R!=null&&R.error)throw R.error;return k(S())}/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],gs=Z("archive",us);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],ys=Z("arrow-down-right",hs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],bs=Z("arrow-right-left",ps);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],js=Z("arrow-up-right",fs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ks=Z("circle-check",vs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],He=Z("gift",Ns);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],_s=Z("layers",ws);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Ss=Z("percent",Cs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Xe=Z("square-check-big",Fs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ze=Z("square",Ms),Rs={bank:{icon:"ðŸ¦",color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/30"},cash:{icon:"ðŸ’µ",color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/30"},credit_card:{icon:"ðŸ’³",color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/30"},investment:{icon:"ðŸ“ˆ",color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/30"},receivable:{icon:"ðŸ’°",color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/30"},savings:{icon:"ðŸ·",color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/30"},crypto:{icon:"â‚¿",color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/30"},other:{icon:"ðŸ“",color:"text-gray-600",bgColor:"bg-gray-50 dark:bg-gray-700"}};function As({account:t,onEdit:s,onAddTransaction:r}){const{t:a}=X("common"),c=At(),{data:l}=lt(),{isPrivacyMode:n}=we(),p=Rs[t.type],j=t.current_balance>=0,k=()=>{const b=new Date,N=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;c({to:"/transactions",search:{accountId:t.id,month:N,fromAccounts:!0}})},S=b=>{b.stopPropagation(),r==null||r(t.id)};return e.jsxs(ue,{className:"relative hover:shadow-md transition-shadow cursor-pointer",onClick:k,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:I("p-3 rounded-lg",p.bgColor),children:e.jsx("span",{className:"text-2xl",children:p.icon})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:I("text-sm",p.color),children:a(`account.type.${t.type}`)})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("transaction.addTransaction"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-green-600 dark:text-green-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),s&&e.jsx("button",{onClick:b=>{b.stopPropagation(),s(t.id)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("account.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),!t.is_active&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:a("account.inactive")})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:a("account.currentBalance")}),e.jsx("p",{className:I("text-3xl font-bold font-mono",j?"text-green-600":"text-red-600"),children:se(t.current_balance,t.currency,(l==null?void 0:l.rates)||{},!0,n)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("account.initialBalance")}),e.jsx("p",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:se(t.initial_balance,t.currency,(l==null?void 0:l.rates)||{},!0,n)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("account.transactions")}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:t.transaction_count})]})]}),t.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:a("account.notes")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.notes})]})]})}const De=t=>{const s=t.startsWith("-"),a=t.replace(/[^\d.]/g,"").split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),(s?"-":"")+a.join(".")},Pe=t=>{const s=t.startsWith("-"),r=t.replace(/[^\d.]/g,"");return(s?"-":"")+r},ce=t=>t==="USD"?100:1;function Ds({isOpen:t,onClose:s,editingAccountId:r}){const{t:a}=X("common"),c=Dt(),l=Pt(),{data:n}=Lt(r||void 0),p=_e(),{isPrivacyMode:j}=we(),[k,S]=g.useState(""),[b,N]=g.useState("bank"),[u,R]=g.useState(""),[C,D]=g.useState(""),[M,h]=g.useState("JPY"),[w,y]=g.useState(""),[v,_]=g.useState({}),[L,q]=g.useState(""),[m,x]=g.useState(!1),o=["bank","cash","credit_card","investment","receivable","savings","other"],A=n&&n.transaction_count>0,E=(()=>{if(!n||!L)return null;const P=ce(n.currency),f=parseFloat(L)*P,i=n.current_balance;return f-i})();g.useEffect(()=>{if(t){if(r&&n)if(S(n.name),N(n.type),y(n.notes||""),h(n.currency),A)q(""),x(!1);else{const P=ce(n.currency);R((n.initial_balance/P).toString()),D(n.initial_balance_date)}else S(""),N("bank"),R("0"),D(new Date().toISOString().split("T")[0]),h("JPY"),y(""),q(""),x(!1);_({})}},[t,r,n,A]);const d=()=>{const P={};return k.trim()||(P.name=a("account.errors.nameRequired")),r?r&&!A&&(C||(P.initialBalanceDate=a("account.errors.dateRequired"))):C||(P.initialBalanceDate=a("account.errors.dateRequired")),_(P),Object.keys(P).length===0},F=async P=>{if(P.preventDefault(),!!d()){if(r&&A&&L&&!m){x(!0);return}try{if(r){const f={name:k.trim(),type:b,notes:w.trim()||void 0};if(!A&&n){const i=ce(n.currency);f.initial_balance=Math.round(parseFloat(u||"0")*i),f.initial_balance_date=C}if(A&&L&&n){const i=ce(n.currency);f.desired_current_balance=Math.round(parseFloat(L)*i)}await l.mutateAsync({id:r,data:f})}else{const f=ce(M),i={name:k.trim(),type:b,initial_balance:Math.round(parseFloat(u||"0")*f),initial_balance_date:C,currency:M,notes:w.trim()||void 0};await c.mutateAsync(i)}s()}catch(f){_({submit:f.message||a("account.errors.submitFailed")})}}};if(!t)return null;const ee=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:a(r?"account.editAccount":"account.createAccount")}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.name")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",value:k,onChange:P=>S(P.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",v.name?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:a("account.namePlaceholder")}),v.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.accountType")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"type",value:b,onChange:P=>N(P.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:o.map(P=>e.jsx("option",{value:P,children:a(`account.type.${P}`)},P))})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:De(u),onChange:P=>R(Pe(P.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:C,onChange:P=>D(P.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",v.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),v.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.initialBalanceDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.currency")}),e.jsxs("select",{id:"currency",value:M,onChange:P=>h(P.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"VND",children:"VND (â‚«)"})]})]})]}),r&&!A&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:De(u),onChange:P=>R(Pe(P.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:C,onChange:P=>D(P.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",v.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),v.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.initialBalanceDate})]})]}),r&&A&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:"Current Balance"}),e.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-200",children:se(n.current_balance,n.currency,p,!0,j)})]}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:[n.transaction_count," transactions"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"desiredBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Desired Current Balance"}),e.jsx("input",{type:"text",inputMode:"decimal",id:"desiredBalance",value:De(L),onChange:P=>{q(Pe(P.target.value)),x(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"Enter the actual balance"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the actual balance from your bank/wallet to reconcile"})]}),E!==null&&E!==0&&e.jsx("div",{className:I("border rounded-lg p-4",E>0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:I("text-sm font-medium",E>0?"text-green-900":"text-red-900"),children:"Adjustment Amount"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:I("text-lg font-bold",E>0?"text-green-900":"text-red-900"),children:E>0?"â†‘":"â†“"}),e.jsx("span",{className:I("text-lg font-bold",E>0?"text-green-900":"text-red-900"),children:se(Math.abs(E),n.currency,p,!0,j)})]})]})}),m&&E!==null&&E!==0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-900",children:"Confirm Balance Adjustment"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["This will create a balance adjustment transaction of"," ",e.jsx("span",{className:"font-semibold",children:se(Math.abs(E),n.currency,p,!0,j)})," ","to reconcile your account balance."]})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.notes")}),e.jsx("textarea",{id:"notes",value:w,onChange:P=>y(P.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:a("account.notesPlaceholder")})]}),v.submit&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:v.submit})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[m&&e.jsx("button",{type:"button",onClick:()=>{x(!1),q("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel Adjustment"}),!m&&e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("cancel")}),e.jsx("button",{type:"submit",disabled:c.isPending||l.isPending,className:I("flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",m?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:c.isPending||l.isPending?a("saving"):m?"Confirm Adjustment":a(r?"update":"create")})]})]})]})]});return typeof document>"u"?null:Ce.createPortal(ee,document.body)}const Ps=["eth","bsc","polygon"];function et({token:t,isPrivacyMode:s}){return e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.logo_url?e.jsx("img",{src:t.logo_url,alt:t.symbol,className:"w-5 h-5 rounded-full",onError:r=>{r.target.style.display="none"}}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-[10px] font-medium",children:t.symbol.slice(0,2)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate",children:t.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:s?"***":Number(t.balance)<1e-4?"<0.0001":Number(t.balance).toFixed(4)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s?"$***":`$${Number(t.balance_usd).toFixed(2)}`})]})]})}function tt(){const{t}=X("common"),s=ae(),{currency:r}=it(),{isPrivacyMode:a}=we(),c=_e(),[l,n]=g.useState(!1),[p,j]=g.useState(""),[k,S]=g.useState(""),[b,N]=g.useState(["eth","bsc","polygon"]),[u,R]=g.useState(null),[C,D]=g.useState(null),{data:M,isLoading:h}=Q({queryKey:["crypto-wallets"],queryFn:xt}),{data:w}=Q({queryKey:["crypto-wallets-balance",M==null?void 0:M.map(f=>f.id)],queryFn:async()=>!M||M.length===0?[]:Promise.all(M.map(f=>Wt(f.id))),enabled:!!M&&M.length>0}),{data:y,isLoading:v}=Q({queryKey:["crypto-portfolio",C],queryFn:()=>Ut(C),enabled:!!C}),_=W({mutationFn:Kt,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),n(!1),j(""),S(""),N(["eth","bsc","polygon"])}}),L=W({mutationFn:Ht,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]})}}),q=W({mutationFn:Vt,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]}),s.invalidateQueries({queryKey:["dashboard-summary"]}),R(null)},onError:()=>{R(null)}}),m=()=>{p.trim()&&_.mutate({wallet_address:p.trim(),label:k.trim()||void 0,chains:b})},x=f=>{confirm(t("confirmDelete"))&&L.mutate(f)},o=f=>{R(f),q.mutate(f)},A=f=>{N(i=>i.includes(f)?i.filter(K=>K!==f):[...i,f])},O=f=>{D(i=>i===f?null:f)},E=f=>`${f.slice(0,6)}...${f.slice(-4)}`,d=(f,i)=>{const K={eth:`https://etherscan.io/address/${f}`,bsc:`https://bscscan.com/address/${f}`,polygon:`https://polygonscan.com/address/${f}`,arbitrum:`https://arbiscan.io/address/${f}`,optimism:`https://optimistic.etherscan.io/address/${f}`};return K[i]||K.eth},F=(w==null?void 0:w.reduce((f,i)=>f+Number(i.total_balance_usd||0),0))||0,ee=1/((c==null?void 0:c.USD)||.00667),P=Math.round(F*ee);return h?e.jsx(ke,{title:t("crypto.wallets"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ge,{size:"md"})})}):e.jsxs(ke,{title:t("crypto.wallets"),badge:(M==null?void 0:M.length)||0,defaultOpen:M&&M.length>0,children:[w&&w.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalBalance")}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:se(P,r,c,!1,a)})]}),w&&w.length>0?e.jsx("div",{className:"space-y-3 mb-4",children:w.map(f=>{var i,K;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(qe,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:f.label||E(f.wallet_address)}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("code",{className:"text-xs",children:E(f.wallet_address)}),e.jsx("a",{href:d(f.wallet_address,"eth"),target:"_blank",rel:"noopener noreferrer",className:"hover:text-purple-500",children:e.jsx(Ke,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a?"$***":`$${Number(f.total_balance_usd||0).toFixed(2)}`}),e.jsx("div",{className:"flex gap-1 mt-1",children:(i=f.chains)==null?void 0:i.map($=>{var B;return e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",title:(B=Ne[$])==null?void 0:B.name,children:$.toUpperCase()},$)})})]})]}),e.jsxs("button",{onClick:()=>O(f.id),className:"flex items-center gap-2 mt-3 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors",children:[C===f.id?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(ot,{className:"w-4 h-4"}),t("crypto.tokens")]}),C===f.id&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:v?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(ge,{size:"sm"})}):y!=null&&y.chains&&y.chains.length>0?e.jsx("div",{className:"space-y-4",children:y.chains.filter($=>$.tokens.length>0||$.native_balance).sort(($,B)=>Number(B.total_usd)-Number($.total_usd)).map($=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:$.chain_name}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:a?"$***":`$${Number($.total_usd).toFixed(2)}`})]}),e.jsxs("div",{className:"space-y-1",children:[$.native_balance&&Number($.native_balance.balance)>0&&e.jsx(et,{token:$.native_balance,isPrivacyMode:a}),$.tokens.filter(B=>Number(B.balance_usd)>=1).sort((B,Re)=>Number(Re.balance_usd)-Number(B.balance_usd)).map(B=>e.jsx(et,{token:B,isPrivacyMode:a},B.token_address))]})]},$.chain_id))}):e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-2",children:t("crypto.noTokens")})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:(K=f.sync_statuses)!=null&&K.some($=>$.last_sync_at)?t("crypto.lastSync",{time:new Date(Math.max(...f.sync_statuses.filter($=>$.last_sync_at).map($=>new Date($.last_sync_at).getTime()))).toLocaleString()}):t("crypto.neverSynced")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(f.id),disabled:u===f.id,className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg transition-colors",title:t("crypto.sync"),children:u===f.id?e.jsx(ge,{size:"sm"}):e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(f.id),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:t("delete"),children:e.jsx(qt,{className:"w-4 h-4"})})]})]})]},f.id)})}):l?null:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(qe,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:t("crypto.noWallets")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:t("crypto.addWalletDescription")})]}),l?e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(Je,{label:t("crypto.walletAddress"),placeholder:"0x...",value:p,onChange:f=>j(f.target.value)}),e.jsx(Je,{label:t("crypto.walletLabel"),placeholder:t("crypto.walletLabelPlaceholder"),value:k,onChange:f=>S(f.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.selectChains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ps.map(f=>{var i;return e.jsx("button",{type:"button",onClick:()=>A(f),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${b.includes(f)?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:((i=Ne[f])==null?void 0:i.name)||f.toUpperCase()},f)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(he,{variant:"outline",onClick:()=>n(!1),children:t("cancel")}),e.jsx(he,{onClick:m,disabled:!p.trim()||b.length===0||_.isPending,children:_.isPending?t("saving"):t("crypto.addWallet")})]})]}):e.jsxs(he,{variant:"outline",onClick:()=>n(!0),className:"w-full",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),t("crypto.addWallet")]})]})}function Ls({snapshots:t}){const{resolvedTheme:s}=Et(),r=s==="dark",a=r?"#374151":"#E5E7EB",c=r?"#9CA3AF":"#6B7280",l=r?"#1F2937":"#FFFFFF",n=r?"#374151":"#E5E7EB",p="#6366F1",j=g.useMemo(()=>[...t].sort((b,N)=>new Date(b.snapshot_date).getTime()-new Date(N.snapshot_date).getTime()).map(b=>({date:b.snapshot_date,value:Number(b.balance_usd),formattedDate:new Date(b.snapshot_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})),[t]),[k,S]=g.useMemo(()=>{const b=j.map(C=>C.value),N=Math.min(...b),u=Math.max(...b),R=(u-N)*.1||10;return[Math.max(0,N-R),u+R]},[j]);return j.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No historical data available"}):e.jsx(ts,{width:"100%",height:"100%",children:e.jsxs(rs,{data:j,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(as,{strokeDasharray:"3 3",stroke:a,vertical:!1}),e.jsx(ns,{dataKey:"formattedDate",tick:{fill:c,fontSize:11},tickLine:!1,axisLine:{stroke:a},interval:"preserveStartEnd"}),e.jsx(ls,{domain:[k,S],tick:{fill:c,fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:b=>`$${b.toFixed(0)}`,width:50}),e.jsx(ss,{contentStyle:{backgroundColor:l,border:`1px solid ${n}`,borderRadius:"8px",fontSize:"12px"},labelStyle:{color:c,fontWeight:"bold"},formatter:b=>[`$${b.toFixed(2)}`,"Value"]}),e.jsx(is,{type:"monotone",dataKey:"value",stroke:p,strokeWidth:2,dot:j.length<=10,activeDot:{r:6,fill:p}})]})})}function qs({positionId:t}){var O,E;const{t:s}=X(),r=ae(),[a,c]=g.useState(null),[l,n]=g.useState(!1),[p,j]=g.useState(null),[k,S]=g.useState(null),[b,N]=g.useState(null),{data:u,isLoading:R}=Q({queryKey:["position-roi",t],queryFn:()=>ht(t)}),{data:C=[]}=Q({queryKey:["position-rewards-list",t],queryFn:()=>Jt(t)}),D=W({mutationFn:()=>mt(90),onSuccess:d=>{c({scanned:d.scanned_claims,new:d.new_claims}),r.invalidateQueries({queryKey:["position-roi"]}),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["unattributed-rewards"]}),setTimeout(()=>c(null),5e3)}}),M=W({mutationFn:d=>ut(d),onSuccess:d=>{S(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:d.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),j(null),setTimeout(()=>S(null),5e3)},onError:d=>{N(d.message||s("crypto.transactionCreateError","Failed to create transaction")),j(null),setTimeout(()=>N(null),5e3)}}),h=W({mutationFn:d=>gt(d),onSuccess:d=>{const F=s("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:d.created,total:d.total_usd.toFixed(2),skipped:d.skipped});S(F),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>S(null),8e3)},onError:d=>{N(d.message||s("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>N(null),5e3)}}),w=C.filter(d=>!d.transaction_id),y=1,v=((O=u==null?void 0:u.rewards_by_token)==null?void 0:O.filter(d=>Number(d.amount_usd)>=y))||[],_=((E=u==null?void 0:u.rewards_by_month)==null?void 0:E.filter(d=>Number(d.amount_usd)>=y))||[],L=C.filter(d=>Number(d.reward_usd||0)>=y),q=v.reduce((d,F)=>d+Number(F.amount_usd||0),0);if(R)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const m=d=>{if(d==null)return null;const F=Number(d);return isNaN(F)?null:`$${F.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},x=d=>{if(d===null)return"-";const F=Number(d);return`${F>=0?"+":""}${F.toFixed(2)}%`},o=d=>{const[F,ee]=d.split("-");return new Date(Number(F),Number(ee)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},A=d=>Number(d).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanRewardsHint","Scan blockchain for claimed rewards")}),e.jsx("button",{onClick:()=>D.mutate(),disabled:D.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(ye,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),u&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),s("crypto.roiSummary","ROI Summary")]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),v.length>0?e.jsx("div",{className:"space-y-1",children:v.map(d=>{const F=m(d.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[A(d.amount)," ",d.symbol]}),F&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",F]})]},d.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:m(q)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[L.length," ",s("crypto.claims","claims")]})]}),u.cost_basis_usd!==null&&u.simple_roi_pct!==null&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-green-200 dark:border-green-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.costBasis","Cost Basis")}),e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:m(u.cost_basis_usd)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.roi","ROI")}),e.jsx("div",{className:`text-lg font-semibold ${u.simple_roi_pct>=0?"text-green-800 dark:text-green-200":"text-red-600 dark:text-red-400"}`,children:x(u.simple_roi_pct)}),u.days_held&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[u.days_held," ",s("crypto.daysHeld","days")]})]})]})]})]}),u&&_.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:_.map(d=>{const F=m(d.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:o(d.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[d.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[A(d.amount)," ",d.symbol]}),F&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",F]})]})]},`${d.month}-${d.symbol}`)})})]}),L.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>n(!l),className:"flex items-center gap-2 font-medium text-gray-900 dark:text-gray-100 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[e.jsx(Ee,{className:"h-4 w-4"}),s("crypto.allRewards","All Rewards")," (",L.length,")",l?e.jsx(bt,{className:"h-4 w-4"}):e.jsx(Me,{className:"h-4 w-4"})]}),w.length>0&&e.jsxs("button",{type:"button",onClick:()=>h.mutate(w.map(d=>d.id)),disabled:h.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 rounded-lg transition-colors",children:[h.isPending?e.jsx(ve,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(ze,{className:"h-3.5 w-3.5"}),s("crypto.createAllTransactions","Create All Txns")," (",w.length,")"]})]}),l&&e.jsxs(e.Fragment,{children:[k&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(ye,{className:"h-4 w-4"}),k]}),b&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(oe,{className:"h-4 w-4"}),b]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:L.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Number(d.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})," ",d.reward_token_symbol||"tokens"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[new Date(d.claimed_at).toLocaleDateString()," via ",d.source,d.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(d.reward_usd).toFixed(2)]})]})]}),d.reward_usd&&Number(d.reward_usd)>0&&e.jsx("div",{className:"flex-shrink-0 ml-3",children:d.transaction_id?e.jsxs("a",{href:`/transactions?id=${d.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(Ke,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{j(d.id),M.mutate(d.id)},disabled:p===d.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[p===d.id?e.jsx(ve,{className:"h-3 w-3 animate-spin"}):e.jsx(Ee,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},d.id))})]})]}),u&&L.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(He,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),q<y?s("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:y}):s("crypto.noRewards","No rewards claimed for this position yet.")]})]})}function Es({source:t="symbiotic"}){var L,q;const{t:s}=X(),r=ae(),[a,c]=g.useState(null),[l,n]=g.useState(null),[p,j]=g.useState(null),{data:k,isLoading:S}=Q({queryKey:["staking-rewards",t],queryFn:()=>Yt(t)}),{data:b=[]}=Q({queryKey:["all-rewards"],queryFn:Gt}),N=b.filter(m=>!m.transaction_id&&m.reward_usd&&Number(m.reward_usd)>0),u=W({mutationFn:()=>mt(90),onSuccess:m=>{c({scanned:m.scanned_claims,new:m.new_claims}),r.invalidateQueries({queryKey:["staking-rewards"]}),r.invalidateQueries({queryKey:["all-rewards"]}),setTimeout(()=>c(null),5e3)}}),R=W({mutationFn:m=>gt(m),onSuccess:m=>{const x=s("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:m.created,total:m.total_usd.toFixed(2),skipped:m.skipped});n(x),r.invalidateQueries({queryKey:["all-rewards"]}),r.invalidateQueries({queryKey:["staking-rewards"]}),r.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>n(null),8e3)},onError:m=>{j(m.message||s("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>j(null),5e3)}});if(S)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const C=m=>{if(m==null)return null;const x=Number(m);return isNaN(x)?null:`$${x.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},D=m=>{const[x,o]=m.split("-");return new Date(Number(x),Number(o)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},M=m=>Number(m).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4}),h=t==="symbiotic"?"Symbiotic":t,w=1,y=((L=k==null?void 0:k.rewards_by_token)==null?void 0:L.filter(m=>Number(m.amount_usd)>=w))||[],v=((q=k==null?void 0:k.rewards_by_month)==null?void 0:q.filter(m=>Number(m.amount_usd)>=w))||[],_=y.reduce((m,x)=>m+Number(x.amount_usd||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanStakingRewardsHint","Scan blockchain for claimed staking rewards")}),e.jsx("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(ye,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),l&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(ye,{className:"h-4 w-4"}),l]}),p&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(oe,{className:"h-4 w-4"}),p]}),N.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:s("crypto.unlinkedRewardsHint","{{count}} rewards ready to convert to transactions",{count:N.length})}),e.jsx("button",{onClick:()=>R.mutate(N.map(m=>m.id)),disabled:R.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-amber-600 hover:bg-amber-700 disabled:bg-amber-400 text-white text-sm font-medium rounded-lg transition-colors",children:R.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 animate-spin"}),s("crypto.creating","Creating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4"}),s("crypto.createAllTransactions","Create All Txns")," (",N.length,")"]})})]}),k&&y.length>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),s("crypto.stakingRewardsSummary","{{source}} Rewards Summary",{source:h})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),y.length>0?e.jsx("div",{className:"space-y-1",children:y.map(m=>{const x=C(m.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[M(m.amount)," ",m.symbol]}),x&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",x]})]},m.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:C(_)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[v.reduce((m,x)=>m+x.count,0)," ",s("crypto.claims","claims")]})]})})]}),k&&v.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:v.map(m=>{const x=C(m.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:D(m.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[m.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[M(m.amount)," ",m.symbol]}),x&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",x]})]})]},`${m.month}-${m.symbol}`)})})]}),k&&y.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(He,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:_<w?s("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:w}):s("crypto.noStakingRewards","No staking rewards found")}),e.jsx("p",{className:"text-sm",children:s("crypto.noStakingRewardsHint",'Click "Scan Rewards" to search for claimed rewards on the blockchain.')})]})]})}async function $s(t,s){return(await Fe.post(`/api/crypto/positions/${encodeURIComponent(t)}/close`,s)).data}async function Ts(){return(await Fe.get("/api/crypto/positions/closed")).data}function Is({group:t,lastSnapshotValueUsd:s,costBasisUsd:r,totalRewardsUsd:a,onClose:c,onSuccess:l}){var d;const{t:n}=X("common"),{data:p}=lt(),j=((d=p==null?void 0:p.rates)==null?void 0:d.USD)||150,k=ae(),[S,b]=g.useState(new Date().toISOString().slice(0,16)),[N,u]=g.useState(s),[R,C]=g.useState(Math.round(s*j)),[D,M]=g.useState(null),[h,w]=g.useState(`LP Exit: ${t.protocol} ${t.name}`),[y,v]=g.useState("");g.useEffect(()=>{C(Math.round(N*j))},[N,j]);const{data:_}=Q({queryKey:["accounts"],queryFn:()=>Tt()}),L=(_==null?void 0:_.filter(F=>F.is_active&&(F.type==="bank"||F.type==="savings")))||[],q=r!==null?N-r+(a||0):null,m=r&&q!==null?q/r*100:null,x=t.tokens[0],o=(x==null?void 0:x.id)||"",A=(x==null?void 0:x.wallet_address)||"",O=W({mutationFn:()=>{if(!D)throw new Error(n("crypto.selectAccount","Select destination account"));const F={exit_date:new Date(S).toISOString(),exit_value_usd:N,exit_value_jpy:R,destination_account_id:D,note:h||void 0,tx_hash:y||void 0,wallet_address:A,chain_id:t.chain_id,protocol:t.protocol,symbol:t.name};return $s(o,F)},onSuccess:()=>{k.invalidateQueries({queryKey:["closed-positions"]}),k.invalidateQueries({queryKey:["defi-positions"]}),k.invalidateQueries({queryKey:["accounts"]}),l(),c()}}),E=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-hidden",style:{touchAction:"pan-y"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:c}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:n("crypto.closePosition","Close Position")}),e.jsx("button",{onClick:c,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.protocol," - ",t.name]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.chain_id.toUpperCase()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Qe,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitDate","Exit Date")]}),e.jsx("input",{type:"datetime-local",value:S,onChange:F=>b(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(dt,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitValue","Exit Value")," (USD)"]}),e.jsx("input",{type:"number",step:"0.01",value:N,onChange:F=>u(parseFloat(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("crypto.exitValue","Exit Value")," (JPY)"]}),e.jsx("input",{type:"number",value:R,onChange:F=>C(parseInt(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(qe,{className:"w-4 h-4 inline mr-1"}),n("crypto.destinationAccount","Destination Account")]}),e.jsxs("select",{value:D||"",onChange:F=>M(parseInt(F.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:n("select","Select...")}),L.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("note","Note")}),e.jsx("input",{type:"text",value:h,onChange:F=>w(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["TX Hash (",n("optional","optional"),")"]}),e.jsx("input",{type:"text",value:y,onChange:F=>v(F.target.value),placeholder:"0x...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-sm"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("crypto.pnlPreview","P&L Preview")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.costBasis","Cost Basis")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r!==null?`$${r.toFixed(2)}`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.totalRewards","Total Rewards")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a?`$${a.toFixed(2)}`:"$0.00"})]}),e.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.realizedPnl","Realized P&L")}),e.jsx("p",{className:`text-lg font-bold ${q!==null?q>=0?"text-green-600":"text-red-600":"text-gray-400"}`,children:q!==null?`${q>=0?"+":""}$${q.toFixed(2)} (${m==null?void 0:m.toFixed(1)}%)`:"N/A"})]})]})]}),O.error&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx($t,{className:"w-4 h-4"}),O.error.message]})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",children:n("cancel","Cancel")}),e.jsx("button",{onClick:()=>O.mutate(),disabled:!D||O.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:O.isPending?n("loading","Loading..."):n("crypto.confirmClose","Confirm Close")})]})]})]});return typeof document>"u"?null:Ce.createPortal(E,document.body)}function Os({group:t,onClose:s}){const[r,a]=g.useState("overview"),[c,l]=g.useState(!1),n=t.tokens[0],p=Ge({queries:t.tokens.map(h=>({queryKey:["position-history",h.id],queryFn:()=>Xt(h.id,30),retry:!1}))}),j=p.some(h=>h.isLoading),k=g.useMemo(()=>{const h=p.filter(v=>{var _;return(_=v.data)==null?void 0:_.snapshots}).flatMap(v=>v.data.snapshots);if(h.length===0)return null;const w=new Map;for(const v of h){const _=w.get(v.snapshot_date)||0;w.set(v.snapshot_date,_+Number(v.balance_usd))}return{snapshots:Array.from(w.entries()).map(([v,_])=>({snapshot_date:v,balance_usd:_}))}},[p]),S=Ge({queries:t.tokens.map(h=>({queryKey:["position-performance",h.id],queryFn:()=>Zt(h.id),retry:!1}))}),b=S.some(h=>h.isLoading),N=S.every(h=>!h.isLoading),u=g.useMemo(()=>{if(!N)return null;const h=S.filter(E=>E.data);if(h.length===0)return null;const w=h[0].data;if(h.length===1)return w;let y=0,v=0,_=0,L=0,q=0,m=!1,x=0,o=0;for(const E of h){const d=E.data;y+=Number(d.start_value_usd),v+=Number(d.current_value_usd),_+=Number(d.total_return_usd),L=Math.max(L,d.days_held),q+=d.snapshot_count,d.il_usd!=null&&(m=!0,x+=Number(d.il_usd)),d.hodl_value_usd!=null&&(o+=Number(d.hodl_value_usd))}const A=y>0?_/y*100:0;let O=null;if(L>=7&&y>0){const E=((v/y)**(365/L)-1)*100;Math.abs(E)<=500&&(O=E)}return{position_id:w.position_id,protocol:w.protocol,symbol:t.name,days_held:L,start_value_usd:y,current_value_usd:v,total_return_usd:_,total_return_pct:A,annualized_return_pct:O,current_apy:w.current_apy,snapshot_count:q,il_percentage:m&&y>0?x/y*100:null,il_usd:m?x:null,hodl_value_usd:m?o:null,lp_vs_hodl_usd:m?v-o:null,lp_outperformed_hodl:m?v>o:void 0}},[S,t.name,N]),{data:R}=Q({queryKey:["position-roi",n.id],queryFn:()=>ht(n.id),retry:!1}),C=j||b,D=h=>{const w=Number(h.balance);return w<1e-4?"<0.0001":w<1?w.toFixed(4):w.toFixed(2)},M=e.jsxs("div",{className:"fixed inset-0 z-[100001]",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsx("div",{className:"fixed inset-0 z-[100002] flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90dvh] my-auto overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 dark:from-gray-800 dark:to-gray-900 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex -space-x-2",children:t.tokens.slice(0,3).map((h,w)=>h.logo_url?e.jsx("img",{src:h.logo_url,alt:h.symbol,className:"w-10 h-10 rounded-full border-2 border-white/20",style:{zIndex:t.tokens.length-w}},h.id):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",style:{zIndex:t.tokens.length-w},children:h.symbol.slice(0,2)},h.id))}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:t.protocol}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.name})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Current Value"}),e.jsxs("p",{className:"text-4xl font-bold",children:["$",t.total_usd.toFixed(2)]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-2 text-sm",children:e.jsx("span",{className:"text-gray-400",children:t.tokens.map((h,w)=>e.jsxs("span",{children:[w>0&&" + ",D(h)," ",h.symbol]},h.id))})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>a("overview"),className:I("flex-1 px-4 py-3 text-sm font-medium transition-colors",r==="overview"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:"Gain/Loss"}),e.jsxs("button",{onClick:()=>a("rewards"),className:I("flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2",r==="rewards"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:[e.jsx(He,{className:"w-4 h-4"}),"Rewards"]})]}),e.jsx("div",{className:"p-4 space-y-4 max-h-[50vh] overflow-y-auto",children:C?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(ge,{size:"lg"})}):e.jsxs(e.Fragment,{children:[r==="overview"&&e.jsxs(e.Fragment,{children:[u&&e.jsxs(ue,{className:"overflow-hidden",children:[e.jsxs("div",{className:I("p-4 text-center",Number(u.total_return_pct)>=0?"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20":"bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[Number(u.total_return_pct)>=0?e.jsx(js,{className:"w-5 h-5 text-green-600"}):e.jsx(ys,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:I("text-sm font-medium",Number(u.total_return_pct)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:"Total Return"})]}),e.jsxs("p",{className:I("text-3xl font-bold",Number(u.total_return_pct)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[Number(u.total_return_pct)>=0?"+":"",u.total_return_pct.toFixed(2),"%"]}),e.jsxs("p",{className:I("text-lg font-semibold mt-1",Number(u.total_return_usd)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:[Number(u.total_return_usd)>=0?"+":"","$",Math.abs(Number(u.total_return_usd)).toFixed(2)]})]}),e.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(dt,{className:"w-3.5 h-3.5"}),"Invested"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",Number(u.start_value_usd).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(os,{className:"w-3.5 h-3.5"}),"Duration"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[u.days_held," days"]})]})]})]}),u&&u.annualized_return_pct!==null&&e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Annualized Return"})]}),e.jsxs("span",{className:I("font-bold text-lg",Number(u.annualized_return_pct)>=0?"text-green-600":"text-red-600"),children:[Number(u.annualized_return_pct)>=0?"+":"",u.annualized_return_pct.toFixed(2),"%"]})]})}),u&&u.current_apy!=null&&e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current APY"})]}),e.jsxs("span",{className:"font-bold text-lg text-purple-600 dark:text-purple-400",children:[Number(u.current_apy).toFixed(2),"%"]})]})}),k&&k.snapshots.length>0&&e.jsxs(ue,{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-3",children:"30-Day Performance"}),e.jsx("div",{className:"h-40",children:e.jsx(Ls,{snapshots:k.snapshots})})]}),e.jsx("button",{onClick:()=>l(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Close Position"})]}),r==="rewards"&&e.jsx(e.Fragment,{children:t.protocol_module==="staked"?e.jsx(Es,{source:"symbiotic"}):e.jsx(qs,{positionId:n.id})})]})}),c&&e.jsx(Is,{group:t,lastSnapshotValueUsd:t.total_usd,costBasisUsd:(R==null?void 0:R.cost_basis_usd)??null,totalRewardsUsd:(R==null?void 0:R.total_rewards_usd)??null,onClose:()=>l(!1),onSuccess:()=>{l(!1),s()}})]})})]});return typeof document>"u"?null:Ce.createPortal(M,document.body)}function Bs({walletId:t}){const{t:s}=X(),r=ae(),[a,c]=g.useState(new Set),[l,n]=g.useState(""),{data:p=[]}=Q({queryKey:["unattributed-rewards"],queryFn:yt}),{data:j}=Q({queryKey:["defi-positions",t],queryFn:()=>pt(t),enabled:!!t}),k=W({mutationFn:({rewardIds:o,positionId:A})=>es(o,A),onSuccess:()=>{r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["position-rewards"]}),c(new Set),n("")}}),[S,b]=g.useState(null),[N,u]=g.useState(null),[R,C]=g.useState(null),D=W({mutationFn:o=>ut(o),onSuccess:o=>{u(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:o.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["transactions"]}),b(null),setTimeout(()=>u(null),5e3)},onError:o=>{C(o.message||s("crypto.transactionCreateError","Failed to create transaction")),b(null),setTimeout(()=>C(null),5e3)}});if(p.length===0)return null;const M=1,h=p.filter(o=>Number(o.reward_usd||0)>=M);if(h.length===0)return null;const w=(j==null?void 0:j.positions)||[],y=o=>`${Number(o.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})} ${o.reward_token_symbol||"tokens"}`,v=o=>new Date(o).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),_=o=>{const A=new Set(a);A.has(o)?A.delete(o):A.add(o),c(A)},L=()=>{a.size===h.length?c(new Set):c(new Set(h.map(o=>o.id)))},q=h.length>0&&a.size===h.length,m=a.size>0,x=()=>{a.size===0||!l||k.mutate({rewardIds:Array.from(a),positionId:l})};return e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(It,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),e.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:s("crypto.unattributedRewards",{count:h.length})})]}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:s("crypto.unattributedRewardsDesc","These rewards need to be assigned to a position for ROI tracking.")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-yellow-100 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:L,className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[q?e.jsx(Xe,{className:"h-4 w-4 text-primary-600"}):e.jsx(Ze,{className:"h-4 w-4"}),q?s("deselectAll","Deselect All"):s("selectAll","Select All")]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs("select",{value:l,onChange:o=>n(o.target.value),disabled:!m,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:s("crypto.selectPosition","Select position...")}),w.map(o=>e.jsxs("option",{value:o.id,children:[o.protocol," - ",o.symbol]},o.id))]}),e.jsxs("button",{type:"button",onClick:x,disabled:!m||!l||k.isPending,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-md transition-colors disabled:cursor-not-allowed",children:[e.jsx(ks,{className:"h-4 w-4"}),k.isPending?s("assigning","Assigning..."):s("crypto.assignSelected","Assign {{count}} Selected",{count:a.size})]})]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(ye,{className:"h-4 w-4"}),N]}),R&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(oe,{className:"h-4 w-4"}),R]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.map(o=>e.jsxs("div",{onClick:()=>_(o.id),className:`flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-colors ${a.has(o.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700":"bg-white dark:bg-gray-800 border-yellow-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:a.has(o.id)?e.jsx(Xe,{className:"h-5 w-5 text-primary-600"}):e.jsx(Ze,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:y(o)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[v(o.claimed_at)," via ",o.source,o.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(o.reward_usd).toFixed(2)]})]})]}),o.reward_usd&&o.reward_usd>0&&e.jsx("div",{className:"flex-shrink-0",onClick:A=>A.stopPropagation(),children:o.transaction_id?e.jsxs("a",{href:`/transactions?id=${o.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(Ke,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{b(o.id),D.mutate(o.id)},disabled:S===o.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[S===o.id?e.jsx(ve,{className:"h-3 w-3 animate-spin"}):e.jsx(Ee,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},o.id))}),m&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200 dark:border-gray-700 text-sm text-yellow-700 dark:text-yellow-300",children:s("crypto.selectedRewards","{{count}} reward(s) selected",{count:a.size})})]})}const zs={deposit:"ðŸ’°",stake:"ðŸ”’",borrow:"ðŸ’¸",reward:"ðŸŽ",liquidity:"ðŸ’§"},Qs={liquidity_pool:"LP",staking:"Staking",lending:"Lending",farming:"Farming",vault:"Vault"};function Ks(t){const s={};for(const r of t){const a=`${r.protocol}-${r.chain_id}-${r.name||r.token_name}-${r.position_type}`;s[a]||(s[a]={key:a,name:r.name||r.token_name,protocol:r.protocol,protocol_module:r.protocol_module,position_type:r.position_type,chain_id:r.chain_id,tokens:[],total_usd:0}),s[a].tokens.push(r),s[a].total_usd+=Number(r.balance_usd)}return Object.values(s)}function Hs({group:t,onClick:s,isPrivacyMode:r}){const a=t.chain_id,c=Ne[a],l=t.tokens[0],n=r?t.tokens.map(p=>`*** ${p.symbol}`).join(" + "):t.tokens.map(p=>{const j=Number(p.balance);return`${j<1e-4?"<0.0001":j<1?j.toFixed(4):j.toFixed(2)} ${p.symbol}`}).join(" + ");return e.jsxs("button",{onClick:()=>s(t),className:"w-full flex items-center justify-between py-3 px-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors text-left group",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:t.tokens.length>1?e.jsxs("div",{className:"flex -space-x-2",children:[t.tokens.slice(0,3).map((p,j)=>p.logo_url?e.jsx("img",{src:p.logo_url,alt:p.symbol,className:"w-7 h-7 rounded-full border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-j},onError:k=>{k.target.style.display="none"}},p.id):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-j},children:p.symbol.slice(0,2)},p.id)),t.tokens.length>3&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",t.tokens.length-3]})]}):l.logo_url?e.jsx("img",{src:l.logo_url,alt:l.symbol,className:"w-8 h-8 rounded-full",onError:p=>{p.target.style.display="none"}}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:zs[t.position_type]||"ðŸ“ˆ"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.protocol}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:Qs[t.protocol_module]||t.protocol_module})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"truncate",children:t.name}),c&&e.jsxs("span",{className:"text-xs px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:[c.icon," ",a.toUpperCase()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:r?"$***":`$${t.total_usd.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[180px] truncate",children:n})]}),e.jsx(ot,{className:"w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors"})]})]})}function st(){const{t}=X("common"),{currency:s}=it(),{isPrivacyMode:r}=we(),[a,c]=g.useState(null),l=_e(),{data:n,isLoading:p}=Q({queryKey:["crypto-wallets"],queryFn:xt}),{data:j=[]}=Q({queryKey:["unattributed-rewards"],queryFn:yt}),{data:k,isLoading:S,refetch:b}=Q({queryKey:["crypto-defi-positions",n==null?void 0:n.map(y=>y.id)],queryFn:async()=>!n||n.length===0?[]:await Promise.all(n.map(v=>pt(v.id).catch(()=>({wallet_address:v.wallet_address,total_value_usd:0,positions:[],last_sync_at:null})))),enabled:!!n&&n.length>0}),N=(k==null?void 0:k.flatMap(y=>y.positions))||[],u=Ks(N),R=(k==null?void 0:k.reduce((y,v)=>y+Number(v.total_value_usd||0),0))||0,C=1/((l==null?void 0:l.USD)||.00667),D=Math.round(R*C),M=u.reduce((y,v)=>{const _=v.protocol;return y[_]||(y[_]=[]),y[_].push(v),y},{});if(p||S)return e.jsx(ke,{title:t("crypto.defiPositions"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ge,{size:"md"})})});if(!n||n.length===0)return null;const w=j.length>0?`${u.length} Â· ${j.length} âš `:u.length;return e.jsxs(ke,{title:t("crypto.defiPositions"),badge:w,defaultOpen:u.length>0,children:[N.length>0&&e.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalDefiValue")}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:se(D,s,l,!1,r)})]}),e.jsx("button",{onClick:()=>b(),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors",title:t("crypto.refresh"),children:e.jsx(re,{className:"w-5 h-5"})})]})}),n[0]&&e.jsx("div",{className:"mb-4",children:e.jsx(Bs,{walletId:n[0].id})}),u.length>0?e.jsx("div",{className:"space-y-4",children:Object.entries(M).sort(([,y],[,v])=>{const _=y.reduce((q,m)=>q+m.total_usd,0);return v.reduce((q,m)=>q+m.total_usd,0)-_}).map(([y,v])=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:y}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r?"$***":`$${v.reduce((_,L)=>_+L.total_usd,0).toFixed(2)}`})]})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:v.sort((_,L)=>L.total_usd-_.total_usd).map(_=>e.jsx(Hs,{group:_,onClick:c,isPrivacyMode:r},_.key))})]},y))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_s,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("crypto.noDefiPositions")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("crypto.noDefiPositionsDescription")})]}),a&&e.jsx(Os,{group:a,onClose:()=>c(null)})]})}function rt(){const{t}=X("common"),[s,r]=g.useState(!1),{data:a,isLoading:c}=Q({queryKey:["closed-positions"],queryFn:Ts});return c||!a||a.total_closed===0?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!s),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gs,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t("crypto.closedPositions","Closed Positions")}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.total_closed," ",t("crypto.positions","positions")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[a.total_realized_pnl_jpy!==null&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:t("crypto.totalPnl","Total P&L")}),e.jsxs("p",{className:`font-medium ${a.total_realized_pnl_jpy>=0?"text-green-600":"text-red-600"}`,children:[a.total_realized_pnl_jpy>=0?"+":"",je(a.total_realized_pnl_jpy,"JPY")]})]}),s?e.jsx(bt,{className:"w-5 h-5 text-gray-500"}):e.jsx(Me,{className:"w-5 h-5 text-gray-500"})]})]}),s&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 space-y-3",children:a.positions.map(l=>{const n=Ne[l.chain_id],p=l.realized_pnl_jpy!==null&&l.realized_pnl_jpy>=0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[l.protocol," - ",l.symbol]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[n&&e.jsx("span",{children:n.icon}),e.jsx("span",{children:new Date(l.exit_date).toLocaleDateString()})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:je(l.exit_value_jpy,"JPY")}),l.realized_pnl_jpy!==null&&e.jsxs("div",{className:`flex items-center justify-end gap-1 text-sm ${p?"text-green-600":"text-red-600"}`,children:[p?e.jsx(Se,{className:"w-3 h-3"}):e.jsx(Ot,{className:"w-3 h-3"}),p?"+":"",je(l.realized_pnl_jpy,"JPY"),l.realized_pnl_pct!==null&&e.jsxs("span",{className:"text-xs",children:["(",l.realized_pnl_pct.toFixed(1),"%)"]})]})]})]},l.id)})})]})}async function Vs(t){return(await Fe.post("/api/transfers/",t)).data}async function Ws(t){return(await Fe.post("/api/transfers/exchange",t)).data}const xe={JPY:"Â¥",USD:"$",VND:"â‚«"};function me(t){const s=t.replace(/[^\d]/g,"");return s?parseInt(s).toLocaleString("en-US"):""}function U(t){return parseInt(t.replace(/[,.\s]/g,""),10)||0}function Us({isOpen:t,onClose:s}){const{t:r}=X("common"),a=ae(),{data:c}=ct(),l=_e(),[n,p]=g.useState(null),[j,k]=g.useState(null),[S,b]=g.useState(""),[N,u]=g.useState(""),[R,C]=g.useState(""),[D,M]=g.useState(new Date().toISOString().split("T")[0]),[h,w]=g.useState(""),[y,v]=g.useState({}),[_,L]=g.useState(!1),[q,m]=g.useState(null),x=g.useMemo(()=>c==null?void 0:c.find(i=>i.id===n),[c,n]),o=g.useMemo(()=>c==null?void 0:c.find(i=>i.id===j),[c,j]),A=g.useMemo(()=>(c==null?void 0:c.filter(i=>i.id!==n))||[],[c,n]),{data:O}=Q({queryKey:["transactions","income",x==null?void 0:x.currency],queryFn:()=>zt({type:"income"}),enabled:_&&!!x,select:i=>i.filter(K=>K.currency===(x==null?void 0:x.currency))});g.useEffect(()=>{if(!x||!o||!S||!l)return;const i=U(S);if(i<=0)return;if(x.currency===o.currency){u(me(i.toString()));return}const K=l[x.currency]||1,$=l[o.currency]||1,B=i/K,Re=Math.round(B*$);u(me(Re.toString()))},[x,o,S,l]),g.useEffect(()=>{var i;t&&(p(((i=c==null?void 0:c[0])==null?void 0:i.id)||null),k(null),b(""),u(""),C(""),M(new Date().toISOString().split("T")[0]),w(""),v({}),L(!1),m(null))},[t,c]);const E=W({mutationFn:Vs,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["transfers"]}),a.invalidateQueries({queryKey:["analytics"]}),s()}}),d=W({mutationFn:Ws,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["transfers"]}),a.invalidateQueries({queryKey:["analytics"]}),s()}}),F=_?d:E,ee=()=>{const i={};return n||(i.fromAccount=r("transfer.errors.fromRequired")),j||(i.toAccount=r("transfer.errors.toRequired")),n&&j&&n===j&&(i.toAccount=r("transfer.errors.sameAccount")),(!S||U(S)<=0)&&(i.fromAmount=r("transfer.errors.amountRequired")),(!N||U(N)<=0)&&(i.toAmount=r("transfer.errors.amountRequired")),v(i),Object.keys(i).length===0},P=i=>{if(i.preventDefault(),!ee())return;const K=(x==null?void 0:x.currency)||"JPY",$=(o==null?void 0:o.currency)||"JPY";if(_){const B={date:D,from_account_id:n,from_amount:de(U(S),K),to_account_id:j,to_amount:de(U(N),$),link_to_transaction_id:q||void 0,notes:h.trim()||void 0};d.mutate(B)}else{const B={from_account_id:n,to_account_id:j,from_amount:de(U(S),K),to_amount:de(U(N),$),fee_amount:de(U(R)||0,K),date:D,description:h.trim()||void 0};x&&o&&x.currency!==o.currency&&(B.exchange_rate=U(N)/U(S)),E.mutate(B)}};if(!t)return null;const f=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 animate-modal-backdrop",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:_?r("transfer.exchangeTitle","Currency Exchange"):r("transfer.title")}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:P,className:"p-6 space-y-5",children:[e.jsx("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:i=>L(i.target.checked),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx(re,{className:"w-4 h-4"}),r("transfer.exchangeMode","Currency Exchange")]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.fromAccount")}),e.jsxs("select",{value:n||"",onChange:i=>p(i.target.value?parseInt(i.target.value):null),className:I("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",y.fromAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),c==null?void 0:c.map(i=>e.jsxs("option",{value:i.id,children:[i.name," (",xe[i.currency]||i.currency,")"]},i.id))]}),y.fromAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:y.fromAccount})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Bt,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.toAccount")}),e.jsxs("select",{value:j||"",onChange:i=>k(i.target.value?parseInt(i.target.value):null),className:I("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",y.toAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),A.map(i=>e.jsxs("option",{value:i.id,children:[i.name," (",xe[i.currency]||i.currency,")"]},i.id))]}),y.toAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:y.toAccount})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:x?xe[x.currency]||x.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:S,onChange:i=>b(me(i.target.value)),className:I("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",y.fromAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),y.fromAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:y.fromAmount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.convertedAmount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:o?xe[o.currency]||o.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:N,onChange:i=>u(me(i.target.value)),className:I("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",y.toAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),y.toAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:y.toAmount})]})]}),x&&o&&x.currency!==o.currency&&S&&N&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["1 ",x.currency," â‰ˆ ",(U(N)/U(S)).toFixed(4)," ",o.currency]}),_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.linkToIncome","Link to Income")," (",r("optional"),")"]}),e.jsxs("select",{value:q||"",onChange:i=>m(i.target.value?parseInt(i.target.value):null),className:"w-full h-12 px-4 border border-gray-300 rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",children:[e.jsx("option",{value:"",children:r("transfer.noLink","None")}),O==null?void 0:O.map(i=>e.jsxs("option",{value:i.id,children:[i.date," - ",i.description," (",je(i.amount,i.currency),")"]},i.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:r("transfer.linkToIncomeHelp","Link this exchange to an income transaction for tracking")})]}),!_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.fee")," (",r("optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:x?xe[x.currency]||x.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:R,onChange:i=>C(me(i.target.value)),className:"w-full h-12 pl-10 pr-4 border border-gray-300 rounded-lg text-right dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.date")}),e.jsx("input",{type:"date",value:D,onChange:i=>M(i.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.description")," (",r("optional"),")"]}),e.jsx("input",{type:"text",value:h,onChange:i=>w(i.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:r("transfer.descriptionPlaceholder")})]}),F.isError&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:r("transfer.error")}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(he,{type:"button",variant:"outline",onClick:s,className:"flex-1 h-12",children:r("cancel")}),e.jsx(he,{type:"submit",loading:F.isPending,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700",children:r("transfer.create")})]})]})]})]});return typeof document>"u"?null:Ce.createPortal(f,document.body)}const ft="accounts_collapsed_sections";function Js(){try{const t=localStorage.getItem(ft);if(t)return new Set(JSON.parse(t))}catch{}return new Set}function Ys(t){localStorage.setItem(ft,JSON.stringify([...t]))}function Gs(){const{t}=X("common"),[s,r]=g.useState(!1),[a,c]=g.useState(!1),[l,n]=g.useState(!1),[p,j]=g.useState(!1),[k,S]=g.useState(!1),[b,N]=g.useState(null),[u,R]=g.useState(null),[C,D]=g.useState(()=>Js());g.useEffect(()=>{Ys(C)},[C]),g.useEffect(()=>{const x=()=>{j(!0)},o=()=>{S(!0)};return window.addEventListener("open-add-transaction-modal",x),window.addEventListener("open-receipt-scanner",o),()=>{window.removeEventListener("open-add-transaction-modal",x),window.removeEventListener("open-receipt-scanner",o)}},[]);const M=g.useCallback(x=>{D(o=>{const A=new Set(o);return A.has(x)?A.delete(x):A.add(x),A})},[]),{data:h,isLoading:w,error:y}=ct(s),v=()=>{N(null),c(!0)},_=x=>{N(x),c(!0)},L=()=>{c(!1),N(null)},q=h==null?void 0:h.reduce((x,o)=>{const A=o.type;return x[A]||(x[A]=[]),x[A].push(o),x},{}),m=["bank","savings","cash","credit_card","investment","crypto","receivable","other"];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:t("account.accounts")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:t("account.manageYourAccounts")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(bs,{className:"w-5 h-5"}),t("transfer.title")]}),e.jsxs("button",{onClick:v,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),t("account.createAccount")]})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:x=>r(x.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 dark:bg-gray-700"}),t("account.showInactive")]})})]}),w&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),y&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-red-700 dark:text-red-400",children:[t("account.errors.loadFailed"),": ",y.message]})}),!w&&!y&&(!h||h.length===0)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-700 mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:t("account.noAccounts")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:t("account.createFirstAccount")}),e.jsxs("button",{onClick:v,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),t("account.createAccount")]})]}),!w&&!y&&h&&h.length>0&&e.jsxs("div",{className:"space-y-8",children:[m.map(x=>{const o=q==null?void 0:q[x];if(!o||o.length===0)return null;const A=C.has(x);return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>M(x),className:"w-full flex items-center justify-between mb-4 group cursor-pointer",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[t(`account.type.${x}`),e.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",o.length,")"]})]}),e.jsx(Me,{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform duration-200 ${A?"-rotate-90":""}`})]}),e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 transition-all duration-200 ease-in-out ${A?"max-h-0 opacity-0 overflow-hidden":"max-h-[2000px] opacity-100"}`,children:o.map(O=>e.jsx(As,{account:O,onEdit:_,onAddTransaction:E=>{R(E),j(!0)}},O.id))})]},x)}),e.jsx(tt,{}),e.jsx(st,{}),e.jsx(rt,{})]}),!w&&!y&&(!h||h.length===0)&&e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx(tt,{}),e.jsx(st,{}),e.jsx(rt,{})]}),e.jsx(Ds,{isOpen:a,onClose:L,editingAccountId:b}),e.jsx(Us,{isOpen:l,onClose:()=>n(!1)}),e.jsx(ds,{isOpen:p,onClose:()=>{j(!1),R(null)},defaultAccountId:u}),e.jsx(cs,{isOpen:k,onClose:()=>S(!1),onScanComplete:()=>S(!1)})]})}const ur=Qt("/accounts")({component:Gs});export{ur as Route};
