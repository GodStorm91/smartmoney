import{H as j,u as h,ar as _,j as e,L as w,ai as k,as as o,l as M,h as b,r as y,z as C,t as R,E as D,C as c,i as F}from"./index-D4jnuRad.js";import{M as L,a as u,C as P,I as E}from"./IncomeExpenseBarChart-D65onRLs.js";import{D as S}from"./download-C7czT8yu.js";import{M as T}from"./mail-Bokyu0hM.js";import"./generateCategoricalChart-jyvHPnEp.js";import"./YAxis-BFlQe59X.js";async function $(t,s){return(await j.get(`/api/reports/monthly-usage/${t}/${s}`)).data}async function B(t,s){return(await j.get(`/api/reports/monthly-usage/${t}/${s}/pdf`,{responseType:"blob"})).data}function z({year:t,month:s,onDownloadPDF:r,isDownloading:n}){const{t:l}=h("common"),d=_(new Date(t,s-1),"MMMM yyyy");return e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:l("report.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:d})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,disabled:n,className:"p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":l(n?"report.downloading":"report.downloadPDF"),title:l(n?"report.downloading":"report.downloadPDF"),children:n?e.jsx(w,{size:18,className:"animate-spin"}):e.jsx(S,{size:18})}),e.jsx("button",{disabled:!0,className:"p-2 rounded-lg text-gray-400 dark:text-gray-600 cursor-not-allowed","aria-label":l("report.sendEmail"),title:l("report.comingSoon"),children:e.jsx(T,{size:18})})]})]})}const p=({value:t,max:s=100,className:r})=>{const n=Math.min(100,Math.max(0,t/s*100));return e.jsx("div",{className:k("h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",r),children:e.jsx("div",{className:"h-full transition-all duration-300 ease-in-out bg-blue-600",style:{width:`${n}%`}})})};function I(t){switch(t){case"over_budget":return"error";case"threshold_80":return"warning";case"threshold_50":return"info";default:return"success"}}function U(t,s){switch(t){case"over_budget":return s("report.overBudget");case"threshold_80":return s("report.warning");case"threshold_50":return s("report.caution");default:return s("report.onTrack")}}function A({data:t}){const{t:s}=h("common");return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[o(Math.abs(t.total_spent))," / ",o(t.total_budget)]}),e.jsxs("span",{className:M("font-medium",t.is_over_budget?"text-red-500":"text-gray-700 dark:text-gray-300"),children:[t.percentage_used.toFixed(1),"%"]})]}),e.jsx(p,{value:Math.min(t.percentage_used,100)})]}),e.jsx("div",{className:"space-y-3",children:t.category_status.map(r=>e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium truncate text-gray-900 dark:text-gray-100",children:r.category}),e.jsx(b,{variant:I(r.status),className:"ml-2 text-[10px]",children:U(r.status,s)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{value:Math.min(r.percentage,100),className:"flex-1"}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-16 text-right",children:[o(Math.abs(r.spent))," / ",o(r.budget_amount)]})]})]})},r.category))})]})}function Y(t){switch(t){case"ahead":return"success";case"on_track":return"info";default:return"warning"}}function q({goal:t}){const{t:s}=h("common"),r={ahead:s("report.ahead"),on_track:s("report.onTrack"),behind:s("report.behind")}[t.status]||t.status;return e.jsxs("div",{className:"p-4 border rounded-lg border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:s("report.goalYears",{years:t.years})}),e.jsx(b,{variant:Y(t.status),children:r})]}),e.jsx(p,{value:Math.min(t.progress_percentage,100),className:"mb-2"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:[o(t.total_saved)," / ",o(t.target_amount)]}),e.jsxs("span",{children:[t.progress_percentage.toFixed(1),"%"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:s("report.neededPerMonth",{amount:o(t.needed_per_month)})})]})}function H({accounts:t,totalNetWorth:s}){const{t:r}=h("common");return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:r("report.totalNetWorth")}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o(s)})]}),e.jsx("div",{className:"space-y-2",children:t.map(n=>e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:n.account_name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.account_type})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:o(n.balance,n.currency,void 0,!0)}),n.currency!=="JPY"&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.currency})]})]},n.account_id))})]})}function O(){const{t}=h("common"),[s,r]=y.useState(new Date),[n,l]=y.useState(!1),d=s.getFullYear(),m=s.getMonth()+1,{data:a,isLoading:f,error:v}=C({queryKey:["monthly-report",d,m],queryFn:()=>$(d,m),staleTime:1e3*60*5}),N=y.useCallback(async()=>{l(!0);try{const i=await B(d,m),g=URL.createObjectURL(i),x=document.createElement("a");x.href=g,x.download=`monthly_report_${d}_${String(m).padStart(2,"0")}.pdf`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(g)}catch{R.error(t("report.downloadError"))}finally{l(!1)}},[d,m,t]);return e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[e.jsx(z,{year:d,month:m,onDownloadPDF:N,isDownloading:n}),e.jsx(L,{selectedMonth:s,onChange:r,className:"mb-6"}),f&&e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(D,{size:"lg"})}),v&&e.jsx(c,{className:"text-center py-10",children:e.jsx("p",{className:"text-red-500",children:t("report.loadError")})}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(u,{label:t("analytics.heroIncome"),value:o(a.summary.total_income),change:a.summary.income_change,trend:a.summary.income_change>0?"positive":a.summary.income_change<0?"negative":"neutral"}),e.jsx(u,{label:t("analytics.heroExpense"),value:o(a.summary.total_expense),change:a.summary.expense_change,trend:a.summary.expense_change<0?"positive":a.summary.expense_change>0?"negative":"neutral"}),e.jsx(u,{label:t("analytics.heroNet"),value:o(a.summary.net_cashflow),change:a.summary.net_change,trend:a.summary.net_change>0?"positive":a.summary.net_change<0?"negative":"neutral"}),e.jsx(u,{label:t("report.savingsRate"),value:`${a.summary.savings_rate.toFixed(1)}%`,subtitle:t("report.savingsRateDesc")})]}),a.budget_adherence&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.budgetAdherence")}),e.jsx(A,{data:a.budget_adherence})]}),a.category_breakdown.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.categoryBreakdown")}),e.jsx(P,{data:a.category_breakdown})]}),a.spending_trends.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.spendingTrends")}),e.jsx(E,{data:a.spending_trends})]}),a.goal_progress.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.goalProgress")}),e.jsx("div",{className:"space-y-4",children:a.goal_progress.map(i=>e.jsx(q,{goal:i},i.goal_id))})]}),a.account_summary.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.accountSummary")}),e.jsx(H,{accounts:a.account_summary,totalNetWorth:a.total_net_worth})]}),a.insights.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.insights")}),e.jsx("div",{className:"space-y-3",children:a.insights.map((i,g)=>e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:i.title})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.message})]},g))})]}),a.summary.total_income===0&&a.summary.total_expense===0&&e.jsx(c,{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("report.noData")})})]})]})}const X=F("/report")({component:O});export{X as Route};
