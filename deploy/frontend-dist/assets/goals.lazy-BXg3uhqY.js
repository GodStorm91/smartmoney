import{j as e,c as a,u as t,k as r,m as s}from"./vendor-tanstack-CNAyyoyW.js";import{r as o,a as l}from"./vendor-react-Bx4JnVfy.js";import{c as n,I as i,u as c,J as d,K as g,B as m,M as u,N as x,O as y,L as h,P as p,Q as b,R as v,T as f}from"./index-BtnNbyTi.js";import{B as j}from"./Badge-B98ofg-U.js";import{u as N}from"./vendor-i18n-BrrOrGm_.js";import"./vendor-recharts-BrNIwK9z.js";import"./vendor-icons-BP-EQ_TG.js";import"./vendor-date-BkGg5e1q.js";function k({years:a,custom:t=!1,disabled:r=!1,onClick:s}){const{t:o}=N(),l=()=>t?o("goals.card.customPeriod"):o("goals.card.yearGoal",{years:a});return e.jsxs("button",{onClick:s,disabled:r,className:n("relative w-full p-6 rounded-xl border-2 border-dashed","transition-all duration-200 ease-out","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",r?"border-gray-200 bg-gray-50 cursor-not-allowed opacity-60":"border-gray-300 bg-white hover:border-primary-500 hover:bg-primary-50 hover:shadow-md cursor-pointer"),"aria-label":o(r?"goals.card.ariaDisabled":"goals.card.ariaCreate",{label:l()}),"aria-disabled":r,children:[r&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(j,{variant:"default",className:"text-xs",children:o("goals.card.alreadySet")})}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:n("text-5xl transition-transform duration-200",!r&&"group-hover:scale-110"),children:t?"âš™ï¸":"âž•"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:n("text-lg font-semibold mb-1",r?"text-gray-400":"text-gray-900"),children:l()}),e.jsx("p",{className:n("text-sm",r?"text-gray-400":"text-gray-600"),children:o(t?"goals.card.customDescription":1===a?"goals.card.shortTerm":3===a?"goals.card.mediumTerm":5===a?"goals.card.mediumLongTerm":10===a?"goals.card.longTerm":"goals.card.createGoal")})]})]})]})}const S=[1,3,5,10];function w({onCreateClick:a,existingGoalYears:t,maxGoals:r}){const{t:s}=N("common"),o=e=>t.includes(e),l=r-t.length;return e.jsxs("div",{className:"w-full max-w-5xl mx-auto py-12 px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s("goals.createGoal")}),e.jsxs("p",{className:"text-gray-600",children:[s("goals.selectPeriod"),l>0&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["ï¼ˆ",s("goals.remainingSlots",{count:l}),"ï¼‰"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6",children:[S.map(t=>e.jsx(k,{years:t,disabled:o(t),onClick:()=>a(t)},t)),e.jsx(k,{custom:!0,disabled:l<=0,onClick:()=>a()})]}),l<=0&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:s("goals.maxGoalsReached",{max:r})})})]})}function C({selectedOption:a,customDate:t,customDateError:r,onOptionChange:s,onCustomDateChange:o}){const{t:l,i18n:n}=N(),c=new Date((new Date).getFullYear(),(new Date).getMonth()+1,1),d="ja"===n.language?"ja-JP":"vi"===n.language?"vi-VN":"en-US";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:l("goals.form.startDate")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"today",checked:"today"===a,onChange:()=>s("today"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":l("goals.form.startDateTodayAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l("goals.form.startDateToday")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:(new Date).toLocaleDateString(d)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"month_start",checked:"month_start"===a,onChange:()=>s("month_start"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":l("goals.form.startDateNextMonthAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l("goals.form.startDateNextMonth")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:c.toLocaleDateString(d)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"custom",checked:"custom"===a,onChange:()=>s("custom"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":l("goals.form.startDateCustomAria")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:l("goals.form.startDateCustom")}),"custom"===a&&e.jsx(i,{type:"date",value:t,onChange:e=>o(e.target.value),error:r,className:"text-sm","aria-label":l("goals.form.startDateCustomAria")})]})]})]})]})}const D={emergency_fund:{icon:"ðŸ›¡ï¸",color:"bg-red-50 border-red-200 hover:bg-red-100"},home_down_payment:{icon:"ðŸ ",color:"bg-blue-50 border-blue-200 hover:bg-blue-100"},vacation_travel:{icon:"âœˆï¸",color:"bg-cyan-50 border-cyan-200 hover:bg-cyan-100"},vehicle:{icon:"ðŸš—",color:"bg-green-50 border-green-200 hover:bg-green-100"},education:{icon:"ðŸ“š",color:"bg-purple-50 border-purple-200 hover:bg-purple-100"},wedding:{icon:"ðŸ’",color:"bg-pink-50 border-pink-200 hover:bg-pink-100"},large_purchase:{icon:"ðŸ›’",color:"bg-orange-50 border-orange-200 hover:bg-orange-100"},debt_payoff:{icon:"ðŸ’³",color:"bg-yellow-50 border-yellow-200 hover:bg-yellow-100"},retirement:{icon:"ðŸ–ï¸",color:"bg-teal-50 border-teal-200 hover:bg-teal-100"},investment:{icon:"ðŸ“ˆ",color:"bg-indigo-50 border-indigo-200 hover:bg-indigo-100"},custom:{icon:"ðŸŽ¯",color:"bg-gray-50 border-gray-200 hover:bg-gray-100"}},_=["emergency_fund","home_down_payment","vacation_travel","vehicle","education","wedding","large_purchase","debt_payoff","retirement","investment","custom"];function q({selectedType:a,onSelect:t,hasEmergencyFund:r}){const{t:s}=N();return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("goals.selectType")}),!r&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:s("goals.emergencyFundFirst")}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:_.map(o=>{const l=D[o],n=a===o,i=!r&&"emergency_fund"!==o;return e.jsxs("button",{onClick:()=>!i&&t(o),disabled:i,className:`\n                p-4 rounded-lg border-2 text-center transition-all\n                ${n?"ring-2 ring-blue-500 border-blue-500":l.color}\n                ${i?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n              `,children:[e.jsx("span",{className:"text-2xl block mb-1",children:l.icon}),e.jsx("span",{className:"text-xs font-medium text-gray-700 block",children:s(`goals.types.${o}`)})]},o)})})]})}function P({isOpen:s,onClose:n,preselectedYears:y,editingGoalId:h}){const p=a(),{t:b,i18n:v}=N(),[f,j]=o.useState(1),[k,S]=o.useState(null),[w,D]=o.useState(""),[_,P]=o.useState(y||3),[A,F]=o.useState(""),[T,G]=o.useState("today"),[I,K]=o.useState(""),[L,O]=o.useState("JPY"),[Y,$]=o.useState(null),[M,J]=o.useState({}),[E,Q]=o.useState(""),{data:U=[]}=c(),{data:V=!0}=t({queryKey:["has-emergency-fund"],queryFn:u,enabled:s&&!h}),{data:R}=t({queryKey:["goal",h],queryFn:()=>x(h),enabled:!!h&&s});o.useEffect(()=>{if(s){if(h&&R){j(2),S(R.goal_type||"custom"),D(R.name||""),P(R.years);const e="ja"===v.language?"ja-JP":"vi"===v.language?"vi-VN":"en-US";F(R.target_amount.toLocaleString(e)),R.start_date&&(G("custom"),K(R.start_date)),$(R.account_id||null)}else j(1),S(null),D(""),P(y||3),F(""),G("today"),K(""),O("JPY"),$(null);J({}),Q("")}},[s,y,h,R]);const z=r({mutationFn:async e=>h?d(h,e):g(e),onSuccess:()=>{p.invalidateQueries({queryKey:["goals"]}),p.invalidateQueries({queryKey:["goals-progress-full"]}),p.invalidateQueries({queryKey:["has-emergency-fund"]}),p.invalidateQueries({queryKey:["accounts"]}),n()},onError:()=>{Q(b(h?"goals.errors.updateFailed":"goals.errors.createFailed"))}}),B=()=>{const e=1e4;switch(L){case"JPY":return`Â¥${e.toLocaleString()}`;case"USD":return`$${e.toLocaleString()}`;case"VND":return`${e.toLocaleString()}â‚«`;default:return e.toLocaleString()}},H=e=>{e.preventDefault();const a=function(e,a,t,r,s){const o={};s||(e<1||e>10)&&(o.years="goals.errors.yearsRange");const l=parseInt(a.replace(/[,.\s]/g,""),10);return!a||isNaN(l)?o.targetAmount="goals.errors.amountRequired":l<1e4&&(o.targetAmount="goals.errors.amountMinimum"),"custom"!==t||r||(o.customDate="goals.errors.dateRequired"),o}(_,A,T,I,y),t={};for(const[o,l]of Object.entries(a))l&&(t[o]="goals.errors.amountMinimum"===l?b(l,{amount:B()}):b(l));if(Object.keys(t).length>0)return void J(t);const r=parseInt(A.replace(/[,.\s]/g,""),10),s=function(e,a){if("today"===e)return(new Date).toISOString().split("T")[0];if("month_start"===e){const e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,1).toISOString().split("T")[0]}return a}(T,I);h?z.mutate({name:w||void 0,target_amount:r,start_date:s||void 0,account_id:Y||void 0}):z.mutate({goal_type:k||"custom",name:w||void 0,target_amount:r,currency:L,years:_,start_date:s||void 0})};if(!s)return null;const W=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:n}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:b(h?"goals.modal.editTitle":1===f?"goals.modal.createTitle":`goals.types.${k}`)}),!h&&2===f&&e.jsxs("button",{onClick:()=>j(1),className:"text-sm text-blue-600 hover:underline mt-1",children:["â† ",b("common.back")]})]}),e.jsx("div",{className:"p-6",children:1!==f||h?e.jsxs("form",{onSubmit:H,className:"space-y-5",children:[e.jsx(i,{label:b("goals.form.name"),type:"text",value:w,onChange:e=>D(e.target.value),placeholder:b("goals.form.namePlaceholder")}),!y&&!h&&e.jsx(i,{label:b("goals.form.years"),type:"number",min:1,max:10,value:_,onChange:e=>P(parseInt(e.target.value,10)||1),error:M.years,required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:b("goals.form.currency")}),e.jsxs("select",{value:L,onChange:e=>O(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",disabled:!!h,children:[e.jsx("option",{value:"JPY",children:b("currency.JPY")}),e.jsx("option",{value:"USD",children:b("currency.USD")}),e.jsx("option",{value:"VND",children:b("currency.VND")})]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{label:b("goals.form.targetAmount"),type:"text",value:A,onChange:e=>{const a="ja"===v.language?"ja-JP":"vi"===v.language?"vi-VN":"en-US";F(function(e){const a=e.replace(/[,.\s]/g,"");return/^\d*$/.test(a)?a?parseInt(a,10).toLocaleString("en-US"):"":e}(e.target.value,a))},error:M.targetAmount,placeholder:b("goals.form.targetAmountPlaceholder"),required:!0})})]}),e.jsx(C,{selectedOption:T,customDate:I,customDateError:M.customDate,onOptionChange:G,onCustomDateChange:K}),(h||U.length>0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:b("goals.form.linkedAccount")}),e.jsxs("select",{value:Y||"",onChange:e=>$(e.target.value?parseInt(e.target.value,10):null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:b("goals.form.autoCreateAccount")}),U.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",b(`account.type.${a.type}`),")"]},a.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:b("goals.form.linkedAccountHint")})]}),E&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-800 dark:text-red-300",children:E})]}):e.jsx(q,{selectedType:k,onSelect:e=>{S(e),w||D(b(`goals.types.${e}`)),j(2)},hasEmergencyFund:V})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-6 py-4 flex gap-3 justify-end",children:[e.jsx(m,{variant:"outline",onClick:n,disabled:z.isPending,children:b("common.cancel")}),2===f&&e.jsx(m,{variant:"primary",onClick:H,disabled:z.isPending||!A,children:z.isPending?b("goals.modal.creating"):b(h?"goals.modal.update":"goals.modal.create")})]})]})]});return"undefined"==typeof document?null:l.createPortal(W,document.body)}const A=s("/goals")({component:function(){const{t:s}=N("common"),l=a(),[n,i]=o.useState(!1),[c,d]=o.useState(),[g,m]=o.useState(null),{data:u,isLoading:x}=t({queryKey:["goals"],queryFn:b}),{data:j,isLoading:k}=t({queryKey:["goals-progress-full",null==u?void 0:u.map(e=>e.id),3],queryFn:async()=>u&&0!==u.length?Promise.all(u.map(e=>v(e.id,!0,3))):[],enabled:!!u&&u.length>0}),S=new Date,C=new Date;C.setMonth(C.getMonth()-3);const{data:D}=t({queryKey:["category-breakdown-goals",3],queryFn:()=>f({start:C.toISOString().split("T")[0],end:S.toISOString().split("T")[0]}),enabled:!!u&&u.length>0}),_=o.useMemo(()=>{if(!(null==D?void 0:D.length))return;const e=[...D].filter(e=>"transfer"!==e.category.toLowerCase()).sort((e,a)=>a.amount-e.amount);return e[0]?{name:e[0].category,monthlyAmount:e[0].amount/3}:void 0},[D]),q=r({mutationFn:y,onSuccess:()=>{l.invalidateQueries({queryKey:["goals"]}),l.invalidateQueries({queryKey:["goals-progress-full"]}),l.invalidateQueries({queryKey:["has-emergency-fund"]})}}),A=x||k,F=(null==u?void 0:u.map(e=>e.years))||[],T=F.length<4,G=e=>{d(e),m(null),i(!0)},I=e=>{m(e),d(void 0),i(!0)},K=e=>{q.mutate(e)};return e.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:s("goals.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("goals.subtitle")})]}),A?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(h,{size:"lg"})}):j&&j.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6",children:j.map(a=>a.achievability&&e.jsx(p,{goalId:a.goal_id,goalName:s("goals.yearGoal",{years:a.years}),achievability:a.achievability,targetAmount:a.target_amount,currentAmount:a.total_saved,onEdit:I,onDelete:K,topExpenseCategory:_},a.goal_id))}),T&&e.jsx("div",{className:"mt-12",children:e.jsx(w,{onCreateClick:G,existingGoalYears:F,maxGoals:4})})]}):u&&u.length>0?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(h,{size:"lg"})}):e.jsx(w,{onCreateClick:G,existingGoalYears:[],maxGoals:4}),e.jsx(P,{isOpen:n,onClose:()=>{i(!1),d(void 0),m(null)},preselectedYears:c,editingGoalId:g})]})}});export{A as Route};
