import{l as S,H as T,u as B,r as k,j as e,aR as q,m as p,P as F,I as M,B as P,a0 as I,M as L,N as _,D as $,a9 as D,b6 as R}from"./index-CN9-KDEz.js";import{d as H,e as J}from"./useCategories-CDfG0Vha.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Q=S("external-link",Y);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],V=S("rotate-ccw",z);async function W(r){return(await T.post("/api/receipts/scan",r)).data}async function G(r){const a=new FormData;return a.append("file",r),(await T.post("/api/receipts/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function O(r){return r||null}function X({selected:r,onSelect:a,isIncome:l=!1}){const{t:c}=B("common"),{data:o,isLoading:C}=H(),j=J(),[s,y]=k.useState(null),[h,d]=k.useState(!1),[g,x]=k.useState(""),[i,b]=k.useState("ðŸ“");if(C||!o)return e.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const v=l?o.income:o.expense,u=t=>{for(const n of v)if(n.children.some(E=>E.name===t))return n;return null},m=t=>{y(t),d(!1)},f=t=>{s&&a(t.name,s.name)},w=()=>{y(null),d(!1)},N=async()=>{!s||!g.trim()||(await j.mutateAsync({name:g.trim(),icon:i,parent_id:s.id,type:l?"income":"expense"}),a(g.trim(),s.name),x(""),d(!1))};return s?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:w,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(q,{className:"w-4 h-4"}),s.icon," ",s.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.children.map(t=>e.jsxs("button",{type:"button",onClick:()=>f(t),className:p("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",r===t.name?"bg-primary-100 border-2 border-primary-500 dark:bg-primary-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:t.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:t.name})]},t.id)),e.jsxs("button",{type:"button",onClick:()=>d(!0),className:p("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(F,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:c("category.addCustom","Add")})]})]}),h&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{value:i,onChange:t=>b(t.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(M,{value:g,onChange:t=>x(t.target.value),placeholder:c("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>d(!1),children:c("cancel","Cancel")}),e.jsx(P,{size:"sm",onClick:N,disabled:!g.trim()||j.isPending,children:c("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.map(t=>{var n;return e.jsxs("button",{type:"button",onClick:()=>m(t),className:p("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((n=u(r))==null?void 0:n.id)===t.id?"bg-primary-100 border-2 border-primary-500 dark:bg-primary-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:t.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:t.name})]},t.id)})})}function A(r,a,l){if(a==="JPY"||!l[a])return r;const c=l[a];if(c===0)return r;const o=a==="USD"?r/100:r;return Math.round(o/c)}function Z({parentCategory:r,transactionAmount:a,isExpense:l,transactionCurrency:c="JPY"}){var t;const{t:o}=B("common"),{currency:C}=I(),{isPrivacyMode:j}=L(),{data:s}=_(),y=k.useMemo(()=>{const n=new Date;return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`},[]),{data:h}=$({queryKey:["budget","tracking",y],queryFn:()=>R(y),staleTime:2*60*1e3,retry:!1}),d=n=>D(n,C,(s==null?void 0:s.rates)||{},!0,j);if(!l)return null;const g=(t=h==null?void 0:h.categories)==null?void 0:t.find(n=>n.category===r);if(!g)return null;const{spent:x,budgeted:i}=g,b=i>0?x/i*100:0,v=A(a,c,(s==null?void 0:s.rates)||{}),u=x+v,m=i>0?u/i*100:0,f=u>i,w=()=>m>=100?"bg-red-500":m>=80?"bg-amber-500":"bg-green-500",N=()=>f?"text-red-600 dark:text-red-400":m>=80?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400";return e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 truncate",children:o("budget.insight.countsToward",{category:r})}),e.jsx("span",{className:p("text-xs font-semibold whitespace-nowrap",N()),children:f?o("budget.insight.over",{amount:d(u-i)}):o("budget.insight.left",{amount:d(i-u)})})]}),e.jsx("div",{className:"mt-1.5",children:e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsxs("div",{className:"h-full rounded-full relative overflow-hidden",children:[e.jsx("div",{className:p("h-full rounded-full transition-all duration-300",w()),style:{width:`${Math.min(m,100)}%`}}),a>0&&e.jsx("div",{className:"absolute top-0 h-full opacity-50 rounded-r-full",style:{left:`${Math.min(b,100)}%`,width:`${Math.min(m-b,100-Math.min(b,100))}%`,background:"repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.4) 2px, rgba(255,255,255,0.4) 4px)"}})]})})}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[o("budget.budgetContext.progress",{spent:d(x),budgeted:d(i)}),a>0&&e.jsxs("span",{className:p("ml-1",N()),children:["â†’ ",d(u)]})]}),f&&a>0&&e.jsx("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mt-1",children:o("budget.insight.willExceed")})]})}export{Z as B,Q as E,X as H,V as R,O as g,W as s,G as u};
