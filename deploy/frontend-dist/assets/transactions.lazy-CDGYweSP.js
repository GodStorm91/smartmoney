import{j as e,k as t,m as a,c as s,n as r,u as n,l}from"./vendor-tanstack-C97-WeYN.js";import{r as i,a as o}from"./vendor-react-Bx4JnVfy.js";import{c,u as d,d as x,B as m,I as u,e as g,g as h,h as y,i as p,j as b,k as f,C as j,l as v,m as k,n as N,S as w,o as C,p as S,q as M,r as D,s as L,t as z,v as E,w as T}from"./index-BcaLFQys.js";import{S as R}from"./Select-DpezmgiA.js";import{p as P,y as _,R as A,Z as O,z as Y,D as q,X as $,s as F,F as K,J as Q,K as U,g as W,N as B,O as J,Q as V,P as H,V as I,Y as X,_ as Z}from"./vendor-icons-DsCueGb8.js";import{g as G,H as ee,u as te,a as ae,T as se,R as re}from"./TransactionFormModal-BtX5XUXX.js";import{u as ne}from"./useAccounts-mGMWZWw3.js";import{u as le}from"./vendor-i18n-BrrOrGm_.js";import"./vendor-recharts-Wt1h5c6F.js";import"./vendor-date-BkGg5e1q.js";import"./recurring-service-C6AvS8lH.js";import"./useCategories-D3xfeowY.js";import"./RecurringOptions-pBg7JqST.js";function ie({children:t,variant:a="default",className:s}){return e.jsx("span",{className:c("inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium",{"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300":"default"===a,"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-400":"success"===a,"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-400":"warning"===a,"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-400":"error"===a,"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-400":"info"===a,"bg-purple-100 text-purple-700 dark:bg-purple-900/40 dark:text-purple-400":"purple"===a},s),children:t})}function oe({icon:t,title:a,description:s,action:r,className:n,compact:l=!1}){return e.jsxs("div",{className:c("flex flex-col items-center justify-center px-4",l?"py-6":"py-12",n),children:[t?e.jsx("div",{className:c("flex items-center justify-center rounded-2xl bg-gray-100 dark:bg-gray-800",l?"w-12 h-12 mb-3":"w-16 h-16 mb-4"),children:e.jsx("div",{className:c("text-gray-400 dark:text-gray-500",l?"[&>svg]:w-6 [&>svg]:h-6":"[&>svg]:w-8 [&>svg]:h-8"),children:t})}):e.jsx("div",{className:c("flex items-center justify-center rounded-2xl bg-gray-100 dark:bg-gray-800",l?"w-12 h-12 mb-3":"w-16 h-16 mb-4"),children:e.jsx(P,{className:c("text-gray-400 dark:text-gray-500",l?"w-6 h-6":"w-8 h-8")})}),e.jsx("h3",{className:c("font-semibold text-gray-700 dark:text-gray-300 text-center",l?"text-sm mb-1.5":"text-base mb-2"),children:a}),s&&e.jsx("p",{className:c("text-gray-500 dark:text-gray-400 text-center max-w-sm",l?"text-xs mb-4":"text-sm mb-6"),children:s}),r&&e.jsx("div",{children:r})]})}function ce({label:t,options:a,selected:s,onChange:r,placeholder:n}){const[l,o]=i.useState(!1),d=i.useRef(null);i.useEffect(()=>{function e(e){d.current&&!d.current.contains(e.target)&&o(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const x=s.length>0?`${s.length} selected`:n||"Select...";return e.jsxs("div",{ref:d,className:"relative w-full",children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t}),e.jsxs("button",{type:"button",onClick:()=>o(!l),className:c("w-full px-4 py-2 border rounded-lg text-left flex justify-between items-center","bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"),children:[e.jsx("span",{className:0===s.length?"text-gray-500":"",children:x}),e.jsx("svg",{className:c("w-4 h-4 transition-transform",l&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:a.map(t=>e.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.includes(t.value),onChange:()=>{return e=t.value,void(s.includes(e)?r(s.filter(t=>t!==e)):r([...s,e]));var e},className:"mr-3 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:t.label})]},t.value))})]})}function de({children:t,onRefresh:a,disabled:s=!1,className:r}){const{pullDistance:n,isRefreshing:l,handlers:o}=function({onRefresh:e,threshold:t=80,disabled:a=!1}){const[s,r]=i.useState(0),[n,l]=i.useState(!1),[o,c]=i.useState(!1),d=i.useRef(0),x=i.useRef(0),m=i.useCallback(e=>{a||n||e.currentTarget.scrollTop>0||(d.current=e.touches[0].clientY,c(!0))},[a,n]),u=i.useCallback(e=>{if(!o||a||n)return;x.current=e.touches[0].clientY;const s=x.current-d.current;if(s>0){const e=.4;r(Math.min(s*e,1.5*t))}},[o,a,n,t]),g=i.useCallback(async()=>{if(o&&!a)if(c(!1),s>=t&&!n){l(!0),r(t);try{await e()}finally{l(!1),r(0)}}else r(0)},[o,a,s,t,n,e]);return i.useEffect(()=>()=>{r(0),l(!1),c(!1)},[]),{pullDistance:s,isRefreshing:n,isPulling:o,handlers:{onTouchStart:m,onTouchMove:u,onTouchEnd:g}}}({onRefresh:a,threshold:80,disabled:s}),d=Math.min(n/80,1),x=n>10||l;return e.jsxs("div",{className:c("relative overflow-auto",r),...o,children:[e.jsx("div",{className:c("absolute left-1/2 -translate-x-1/2 z-10 transition-opacity duration-200",x?"opacity-100":"opacity-0"),style:{top:Math.max(n-40,8)},children:e.jsx("div",{className:c("flex items-center justify-center w-10 h-10 rounded-full","bg-white dark:bg-gray-800 shadow-lg","border border-gray-200 dark:border-gray-700"),children:e.jsx(_,{size:20,className:c("text-primary-600 transition-transform",l&&"animate-spin"),style:{transform:l?void 0:`rotate(${360*d}deg)`}})})}),e.jsx("div",{style:{transform:`translateY(${n}px)`,transition:0===n?"transform 0.2s ease-out":"none"},children:t})]})}function xe({receiptUrl:t,onClose:a}){const{t:s}=le(),[r,n]=i.useState(1),l=G(t);if(!l)return null;return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:e=>{e.target===e.currentTarget&&a()},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsxs("h2",{className:"text-white font-medium flex items-center gap-2",children:[e.jsx(A,{size:20}),s("receipt.viewReceipt","View Receipt")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(e=>Math.max(e-.25,.5)),className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomOut","Zoom out"),children:e.jsx(O,{size:20})}),e.jsxs("span",{className:"text-white text-sm w-12 text-center",children:[Math.round(100*r),"%"]}),e.jsx("button",{onClick:()=>n(e=>Math.min(e+.25,3)),className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomIn","Zoom in"),children:e.jsx(Y,{size:20})}),e.jsx("button",{onClick:()=>{const e=document.createElement("a");e.href=l,e.download=`receipt-${Date.now()}.jpg`,e.click()},className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.download","Download"),children:e.jsx(q,{size:20})}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.close","Close"),children:e.jsx($,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center p-4",children:e.jsx("img",{src:l,alt:"Receipt",className:"max-w-full max-h-full object-contain transition-transform duration-200",style:{transform:`scale(${r})`}})})]})}function me({isOpen:s,onClose:r,transaction:n}){const{t:l}=le("common"),g=t(),{data:h=[]}=ne(),[y,p]=i.useState(""),[b,f]=i.useState(""),[j,v]=i.useState(""),[k,N]=i.useState(""),[w,C]=i.useState("JPY"),[S,M]=i.useState(""),[D,L]=i.useState(null),[z,E]=i.useState("expense"),[T,P]=i.useState(!1),[_,A]=i.useState(null),[O,Y]=i.useState(null),[q,K]=i.useState(null),[Q,U]=i.useState(!1),[W,B]=i.useState(!1),J=i.useRef(null),V=e=>{const t=e.replace(/[^\d]/g,"");return t?Number(t).toLocaleString():""},H=a({mutationFn:e=>d(n.id,e),onSuccess:()=>{g.invalidateQueries({queryKey:["transactions"]}),g.invalidateQueries({queryKey:["dashboard"]}),g.invalidateQueries({queryKey:["analytics"]}),r()}}),I=a({mutationFn:()=>x(n.id),onSuccess:()=>{g.invalidateQueries({queryKey:["transactions"]}),g.invalidateQueries({queryKey:["dashboard"]}),g.invalidateQueries({queryKey:["analytics"]}),r()}});i.useEffect(()=>{if(n&&s){p(n.date),f(n.description);const e=Math.abs(n.amount).toString();v(e),N(V(e)),C(n.currency||"JPY"),M(n.category),L(n.account_id??null),E(n.type),P(!1),A(n.receipt_url||null),Y(null),K(null)}},[null==n?void 0:n.id,s]);i.useEffect(()=>{if(D){const e=h.find(e=>e.id===D);(null==e?void 0:e.currency)&&C(e.currency)}},[D,h]);if(i.useEffect(()=>(s&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[s]),!s||!n)return null;const X=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),e.jsx("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md max-h-[90dvh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:l("transaction.editTitle")}),T?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:l("transaction.deleteConfirm")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:n.description}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>P(!1),className:"flex-1",children:l("button.cancel")}),e.jsx(m,{variant:"secondary",onClick:()=>{I.mutate()},disabled:I.isPending,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:I.isPending?"...":l("button.delete")})]})]}):e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const t=parseFloat(j);if(isNaN(t))return;const a=h.find(e=>e.id===D),s=(null==a?void 0:a.name)||(null==n?void 0:n.source)||"";let r=_;if(O){B(!0);try{r=await te(O)}finally{B(!1)}}H.mutate({date:y,description:b,amount:Math.round("expense"===z?-Math.abs(t):Math.abs(t)),currency:w,category:S||"Other",source:s,type:z,account_id:D,receipt_url:r})},className:"space-y-4",children:[e.jsx(u,{label:l("transaction.date"),type:"date",value:y,onChange:e=>p(e.target.value),required:!0}),e.jsx(u,{label:l("transaction.description"),value:b,onChange:e=>f(e.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(u,{label:l("transaction.amount"),type:"text",inputMode:"numeric",value:k,onChange:e=>{const t=e.target.value.replace(/[^\d]/g,"");v(t),N(V(t))},required:!0})}),e.jsx("div",{className:"w-28",children:e.jsx(R,{label:l("transaction.currency","Currency"),value:w,onChange:e=>C(e.target.value),options:[{value:"JPY",label:"¥ JPY"},{value:"USD",label:"$ USD"},{value:"VND",label:"₫ VND"}]})})]}),e.jsx(R,{label:l("transaction.type"),value:z,onChange:e=>E(e.target.value),options:[{value:"income",label:l("transaction.typeIncome")},{value:"expense",label:l("transaction.typeExpense")}]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:l("transaction.category")}),e.jsx(ee,{selected:S,onSelect:e=>M(e),isIncome:"income"===z})]}),e.jsx(R,{label:l("account.account"),value:(null==D?void 0:D.toString())||"",onChange:e=>L(e.target.value?Number(e.target.value):null),options:[{value:"",label:l("account.selectAccount")},...h.map(e=>({value:e.id.toString(),label:e.name}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:l("receipt.receipt","Receipt")}),e.jsx("input",{ref:J,type:"file",accept:"image/*",capture:"environment",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];a&&a.type.startsWith("image/")&&(Y(a),K(URL.createObjectURL(a)))},className:"hidden"}),q||_?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:q||G(_)||"",alt:"Receipt",className:"w-full h-20 object-cover cursor-pointer",onClick:()=>!q&&U(!0)}),e.jsx("button",{type:"button",onClick:()=>{Y(null),q&&(URL.revokeObjectURL(q),K(null)),A(null),J.current&&(J.current.value="")},className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx($,{size:14})})]}):e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=J.current)?void 0:e.click()},className:"w-full h-10 flex items-center justify-center gap-2 border border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 text-gray-500 dark:text-gray-400 rounded-lg text-sm",children:[e.jsx(F,{size:16}),l("receipt.attachReceipt","Attach Receipt")]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:l("button.cancel")}),e.jsx(m,{type:"submit",disabled:H.isPending||W,className:"flex-1",children:W?l("receipt.uploading","Uploading..."):H.isPending?"...":l("button.save")})]}),e.jsx("button",{type:"button",onClick:()=>P(!0),className:c("w-full text-center text-sm text-red-600 hover:text-red-700","py-2 transition-colors"),children:l("transaction.deleteTransaction")})]})]})}),Q&&_&&e.jsx(xe,{receiptUrl:_,onClose:()=>U(!1)})]});return"undefined"!=typeof document?o.createPortal(X,document.body):null}function ue({transaction:t,isOpen:a,onClose:s,onEdit:r,onDelete:n}){const{t:l}=le("common"),{isPrivacyMode:d}=g(),{data:x}=h(),[u,b]=i.useState(!1),f=(null==x?void 0:x.rates)||{};if(!a||!t)return null;const j=t.currency||"JPY",v=y(Math.abs(t.amount),j,f,!0,d),k=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 animate-in fade-in",onClick:s}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-in zoom-in-95 duration-200",onClick:e=>{e.target===e.currentTarget&&s()},children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-xl shadow-xl w-full max-w-md max-h-[80dvh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-900 z-10",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("transactions.transactionDetails")}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx($,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"text-center py-2",children:[e.jsxs("p",{className:c("text-3xl font-bold font-numbers","income"===t.type?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"),children:["income"===t.type?"+":"-",d?"****":v]}),e.jsx("p",{className:c("text-sm font-medium mt-1","income"===t.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:"income"===t.type?l("transactions.income"):l("transactions.expense")})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l("transactions.description")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.description||"-"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l("transactions.category")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.category})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l("transactions.date")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:p(t.date,"MMMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l("transactions.source")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.source||"-"})]})]})]}),t.receipt_url&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:l("transactions.receipt")}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.receipt_url,alt:"Receipt",className:"w-full h-48 object-cover rounded-lg bg-gray-100 dark:bg-gray-800"}),e.jsx("a",{href:t.receipt_url,target:"_blank",rel:"noopener noreferrer",className:"absolute bottom-2 right-2 p-2 bg-black/50 rounded-lg hover:bg-black/70 transition-colors",children:e.jsx(B,{className:"w-4 h-4 text-white"})})]})]})]}),u?e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-3 sticky bottom-0 bg-white dark:bg-gray-900",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 text-center",children:l("transactions.deleteConfirm")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",className:"flex-1",onClick:()=>b(!1),children:l("common.cancel")}),e.jsx(m,{variant:"danger",className:"flex-1",onClick:()=>{n&&n(t),s()},children:l("common.delete")})]})]}):e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 sticky bottom-0 bg-white dark:bg-gray-900",children:[e.jsxs(m,{variant:"outline",className:"flex-1",onClick:()=>null==r?void 0:r(t),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),l("common.edit")]}),e.jsxs(m,{variant:"danger",className:"flex-1",onClick:()=>b(!0),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),l("common.delete")]})]})]})})]});return o.createPortal(k,document.body)}function ge({onClick:t}){const{t:a}=le("common");return o.createPortal(e.jsx("button",{onClick:t,className:c("fixed bottom-20 right-4 sm:bottom-6 sm:right-6 z-50","w-14 h-14 rounded-full","bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600","text-white shadow-lg","flex items-center justify-center","active:scale-95 transition-all","md:hidden"),"aria-label":a("transaction.addTransaction","Add Transaction"),children:e.jsx(H,{size:28})}),document.body)}function he({transaction:t,onViewDetail:a,onEdit:s,onDelete:r}){const{isPrivacyMode:n}=g(),l=b(),[o,c]=i.useState(0),[d,x]=i.useState(!1),[m,u]=i.useState(0),[h,y]=i.useState(!1),v=i.useRef(null),k=i.useRef(null),N=i.useRef(null),w=i.useRef(!1),C=i.useRef(0),S=i.useCallback(()=>{N.current&&(clearTimeout(N.current),N.current=null),w.current=!1},[]),M=i.useCallback(()=>{y(!1)},[]);return i.useEffect(()=>{const e=e=>{k.current&&!k.current.contains(e.target)&&M()};if(h)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[h,M]),i.useEffect(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&c(0)};if(o>0)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]),e.jsxs("div",{ref:v,className:"relative overflow-hidden",children:[h&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:M,children:e.jsx("div",{ref:k,className:"absolute bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden animate-in fade-in zoom-in-95 duration-150 select-none",style:{left:"50%",bottom:"20px",transform:"translateX(-50%)",maxWidth:"280px",width:"calc(100% - 32px)"},onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"py-2",children:[e.jsxs("button",{onClick:()=>{s(t),M()},className:"w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-blue-600 dark:text-blue-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Edit"})]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(`${t.description}: ${f(t.amount,t.type,t.currency||"JPY",l,!1,!1)}`),M()},className:"w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"})}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Copy"})]}),e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsxs("button",{onClick:()=>{r(t),M()},className:"w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-red-600 dark:text-red-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Delete"})]})]})})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center justify-center bg-red-600",style:{width:"80px"},children:e.jsxs("button",{onClick:e=>{e.stopPropagation(),r(t)},className:"h-full w-full flex flex-col items-center justify-center text-white transition-opacity",style:{opacity:o>0?1:0},"aria-label":"Delete transaction",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 mb-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),e.jsx("span",{className:"text-xs font-medium",children:"削除"})]})}),e.jsx("div",{className:"relative",style:{transform:`translateX(-${o}px)`,transition:d?"none":"transform 250ms ease-out"},onTouchStart:e=>{u(e.touches[0].clientX),C.current=e.touches[0].clientY,x(!0),w.current=!1,N.current=setTimeout(()=>{w.current=!0,y(!0)},500)},onTouchMove:e=>{if(!d)return;const t=e.touches[0].clientX,a=e.touches[0].clientY,s=Math.abs(a-C.current);if(w.current)return;if(s>10)return void S();const r=m-t;c(r>0?Math.min(r,80):Math.max(r,-20))},onTouchEnd:()=>{x(!1),w.current?c(0):(S(),c(o>40?80:0))},onTouchCancel:S,onClick:()=>{w.current?y(!1):o>40||a(t)},onContextMenu:e=>{e.preventDefault(),y(!0)},children:e.jsxs(j,{className:"cursor-pointer active:scale-[0.98] transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-50",children:t.description}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:p(t.date)})]}),e.jsx("p",{className:"text-lg font-bold font-numbers "+(t.is_transfer?"text-blue-500 dark:text-blue-400":"income"===t.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:f(t.amount,t.type,t.currency||"JPY",l,!0,n)})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(ie,{children:t.category}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.source})]})]})})]})}function ye({isOpen:t,onClose:a,onConfirm:s,transaction:r,isDeleting:n=!1}){const{t:l}=le("common"),{currency:i}=v(),{isPrivacyMode:c}=g(),d=b();if(!t||!r)return null;const x=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:l("transaction.deleteConfirm","取引を削除しますか？")}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6 space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.description}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:p(r.date)}),e.jsx("span",{className:"font-bold font-numbers "+("income"===r.type?"text-green-600":"text-red-600"),children:f(r.amount,r.type,i,d,!1,c)})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:r.category}),e.jsx("span",{children:"-"}),e.jsx("span",{children:r.source})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:l("transaction.deleteWarning","この操作は取り消せません。本当に削除しますか？")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:a,disabled:n,className:"flex-1",children:l("button.cancel","キャンセル")}),e.jsx(m,{onClick:s,disabled:n,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:n?"削除中...":l("button.delete","削除")})]})]})]});return"undefined"!=typeof document?o.createPortal(x,document.body):null}function pe({isOpen:t,onClose:a,onConfirm:s,selectedCount:r,isLoading:n}){const{t:l}=le("common"),[c,d]=i.useState(""),x=[{value:"",label:l("transactions.selectCategory","Select category...")},{value:"食費",label:l("category.food","Food")},{value:"住宅",label:l("category.housing","Housing")},{value:"交通",label:l("category.transport","Transport")},{value:"娯楽",label:l("category.entertainment","Entertainment")},{value:"通信",label:l("category.communication","Communication")},{value:"日用品",label:l("category.daily","Daily Necessities")},{value:"医療",label:l("category.medical","Medical")},{value:"教育",label:l("category.education","Education")},{value:"その他",label:l("category.other","Other")}];if(!t)return null;const u=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:l("transactions.recategorizeTitle","Change Category")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:l("transactions.recategorizeDescription","Update category for {{count}} transactions",{count:r})}),e.jsx(R,{label:l("transactions.newCategory","New Category"),value:c,onChange:e=>d(e.target.value),options:x}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(m,{variant:"outline",onClick:a,className:"flex-1",children:l("button.cancel","Cancel")}),e.jsx(m,{onClick:()=>{c&&(s(c),d(""))},disabled:!c||n,className:"flex-1",children:n?l("button.saving","Saving..."):l("button.apply","Apply")})]})]})]});return"undefined"!=typeof document?o.createPortal(u,document.body):null}function be({isOpen:t,onClose:a,onConfirm:s,selectedCount:r,isDeleting:n}){const{t:l}=le("common");if(!t)return null;const i=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:l("transactions.bulkDeleteTitle","Delete Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:l("transactions.bulkDeleteConfirm","Are you sure you want to delete {{count}} transactions? This cannot be undone.",{count:r})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:a,className:"flex-1",children:l("button.cancel","Cancel")}),e.jsx(m,{variant:"danger",onClick:s,disabled:n,className:"flex-1",children:n?l("button.deleting","Deleting..."):l("button.delete","Delete")})]})]})]});return"undefined"!=typeof document?o.createPortal(i,document.body):null}function fe(e,t,a){const s=function(e){const t=e.map(e=>[e.date,`"${e.description.replace(/"/g,'""')}"`,e.amount.toString(),e.type,e.category,e.source]);return[["Date","Description","Amount","Type","Category","Source"].join(","),...t.map(e=>e.join(","))].join("\n")}(e);!function(e,t){const a=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}(s,`smartmoney_transactions_${t&&a?`${t}_to_${a}`:(new Date).toISOString().split("T")[0]}.csv`)}function je(e){const[t,a]=e.split("-").map(Number),s=`${t}-${String(a).padStart(2,"0")}-01`,r=new Date(t,a,0).getDate();return{start:s,end:`${t}-${String(a).padStart(2,"0")}-${String(r).padStart(2,"0")}`}}const ve=l("/transactions")({component:function(){const{t:l}=le("common"),{currency:o}=v(),{isPrivacyMode:d}=g(),h=b(),y=t(),P=s(),_=k(),{data:A}=ne(),{categories:O,month:Y,accountId:q,fromAccounts:F,type:K,action:Q}=r({from:"/transactions"}),U=O?O.split(",").filter(Boolean):[],W=Y?je(Y):_,[B,J]=i.useState({start_date:W.start,end_date:W.end,categories:U,source:"",type:K||"all"}),[V,H]=i.useState(""),G=function(e,t){const[a,s]=i.useState(e);return i.useEffect(()=>{const a=setTimeout(()=>s(e),t);return()=>clearTimeout(a)},[e,t]),a}(V,300),[ee,te]=i.useState(""),[xe,ve]=i.useState(""),[ke,Ne]=i.useState("thisMonth"),[we,Ce]=i.useState(!1),Se=e=>{if(Ne(e),"custom"!==e){const t=(e=>{const t=new Date;let a,s=t;switch(e){case"today":a=t;break;case"thisWeek":a=new Date(t),a.setDate(t.getDay()-t.getDay());break;case"thisMonth":default:a=new Date(t.getFullYear(),t.getMonth(),1);break;case"lastMonth":a=new Date(t.getFullYear(),t.getMonth()-1,1),s=new Date(t.getFullYear(),t.getMonth(),0);break;case"last3Months":a=new Date(t.getFullYear(),t.getMonth()-3,1)}return{start:a.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}})(e);J(e=>({...e,start_date:t.start,end_date:t.end}))}},Me=(e,t)=>{const a=t?parseFloat(t):void 0;"min"===e?(te(t),J(e=>({...e,min_amount:a}))):(ve(t),J(e=>({...e,max_amount:a})))},De=e=>{const t=B[e];return"categories"===e?!!(t&&t.length>0):"type"===e?"all"!==t:"source"===e?!!t:"min_amount"===e||"max_amount"===e?void 0!==t:!!t},Le=[De("categories"),De("source"),De("min_amount"),De("max_amount"),"thisMonth"!==ke].filter(Boolean).length,[ze,Ee]=i.useState("date"),[Te,Re]=i.useState("desc"),[Pe,_e]=i.useState(50),[Ae,Oe]=i.useState(!1),Ye=e=>{Oe(!0),ze===e?Re(e=>"asc"===e?"desc":"asc"):(Ee(e),Re("desc")),setTimeout(()=>Oe(!1),150)};i.useEffect(()=>{J(e=>({...e,search:G||void 0}))},[G]),i.useEffect(()=>{if(O||Y||void 0!==K){const e=Y?je(Y):_,t=O?O.split(",").filter(Boolean):[];J(a=>({...a,categories:t.length>0?t:a.categories,start_date:e.start,end_date:e.end,type:K||"all"}))}},[O,Y,K]);const qe=e=>{const t=K===e?void 0:e;P({to:"/transactions",search:e=>({...e,type:t})})},[$e,Fe]=i.useState(null),[Ke,Qe]=i.useState(null),[Ue,We]=i.useState(!1),[Be,Je]=i.useState(null),[Ve,He]=i.useState(!1),[Ie,Xe]=i.useState(new Set),[Ze,Ge]=i.useState(!1),[et,tt]=i.useState(!1),{data:at,isLoading:st}=n({queryKey:["transactions",B],queryFn:()=>T(B)});i.useEffect(()=>{Xe(new Set)},[at]),i.useEffect(()=>{"add-transaction"===Q?(We(!0),P({to:"/transactions",search:e=>({...e,action:void 0})})):"scan-receipt"===Q&&(He(!0),P({to:"/transactions",search:e=>({...e,action:void 0})}))},[Q,P]),i.useEffect(()=>{const e=()=>{We(!0)},t=()=>{He(!0)};return window.addEventListener("open-add-transaction-modal",e),window.addEventListener("open-receipt-scanner",t),()=>{window.removeEventListener("open-add-transaction-modal",e),window.removeEventListener("open-receipt-scanner",t)}},[]);const rt=ae(E,"transaction",[["transactions"],["analytics"]]),nt=[{value:"食費",label:l("category.food","Food")},{value:"住宅",label:l("category.housing","Housing")},{value:"交通",label:l("category.transport","Transport")},{value:"娯楽",label:l("category.entertainment","Entertainment")},{value:"通信",label:l("category.communication","Communication")},{value:"日用品",label:l("category.daily","Daily Necessities")},{value:"医療",label:l("category.medical","Medical")},{value:"教育",label:l("category.education","Education")},{value:"その他",label:l("category.other","Other")}],lt=at&&at.length>0&&at.every(e=>Ie.has(e.id)),it=a({mutationFn:e=>x(e),onSuccess:()=>{y.invalidateQueries({queryKey:["transactions"]}),y.invalidateQueries({queryKey:["dashboard"]}),y.invalidateQueries({queryKey:["analytics"]}),Je(null)}}),ot=a({mutationFn:()=>L(Array.from(Ie)),onSuccess:()=>{y.invalidateQueries({queryKey:["transactions"]}),y.invalidateQueries({queryKey:["dashboard"]}),y.invalidateQueries({queryKey:["analytics"]}),Xe(new Set),tt(!1)}}),ct=a({mutationFn:e=>D(Array.from(Ie),e),onSuccess:()=>{y.invalidateQueries({queryKey:["transactions"]}),Xe(new Set),Ge(!1)}}),dt=i.useMemo(()=>{if(!at)return[];if(!q)return at;const e=Number(q);return at.filter(t=>null!=t.account_id&&Number(t.account_id)===e)},[at,q]),xt=i.useMemo(()=>q&&A&&A.find(e=>e.id===Number(q))||null,[q,A]),mt=(null==xt?void 0:xt.currency)||o,ut={JPY:1,USD:.00667,VND:167},{income:gt,expense:ht,net:yt}=i.useMemo(()=>{const e=dt,t=(e,t)=>{if(xt)return e;const a=M[t]??0,s=e/Math.pow(10,a);if("JPY"===t)return s;const r=h[t]??ut[t];return r&&0!==r?s/r:s},a=e.filter(e=>"income"===e.type&&!e.is_transfer).reduce((e,a)=>e+t(a.amount,a.currency||"JPY"),0),s=e.filter(e=>"expense"===e.type&&!e.is_transfer).reduce((e,a)=>e+t(Math.abs(a.amount),a.currency||"JPY"),0);return{income:a,expense:s,net:a-s}},[dt,xt,h]),pt=i.useMemo(()=>dt.length?[...dt].sort((e,t)=>{let a=0;switch(ze){case"date":a=e.date.localeCompare(t.date);break;case"description":a=e.description.localeCompare(t.description);break;case"category":a=e.category.localeCompare(t.category);break;case"source":a=e.source.localeCompare(t.source);break;case"amount":a=e.amount-t.amount}return"asc"===Te?a:-a}):[],[dt,ze,Te]),bt=i.useMemo(()=>"all"===Pe?pt:pt.slice(0,Pe),[pt,Pe]),ft=i.useMemo(()=>{if(!bt.length)return[];const e=[];let t="";return bt.forEach(a=>{a.date!==t?(t=a.date,e.push({date:a.date,transactions:[a]})):e[e.length-1].transactions.push(a)}),e},[bt]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-6 pb-28",children:[F&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>P({to:"/accounts"}),className:"mb-4 -ml-2",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),l("common.backToAccounts")]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:l("transactions.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l("transactions.subtitle")})]}),e.jsx(j,{className:"mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(u,{placeholder:l("transactions.searchPlaceholder","Search transactions..."),value:V,onChange:e=>H(e.target.value),className:"h-11"}),V&&e.jsx("button",{onClick:()=>{H(""),J(e=>{const t={...e};return H(""),t.search=void 0,t})},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx($,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Ce(!we),className:c("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",we||Le>0?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[e.jsx(X,{className:"w-4 h-4"}),l("button.filter","Filter"),Le>0&&e.jsx("span",{className:"bg-primary-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:Le}),e.jsx(Z,{className:c("w-4 h-4 transition-transform",we&&"rotate-180")})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide flex-1",children:[{key:"today",label:l("date.today","Today")},{key:"thisWeek",label:l("date.thisWeek","This Week")},{key:"thisMonth",label:l("date.thisMonth","This Month")}].map(({key:t,label:a})=>e.jsx("button",{onClick:()=>Se(t),className:c("px-3 py-2 text-xs sm:text-sm font-medium rounded-lg whitespace-nowrap transition-colors",ke===t?"bg-primary-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:a},t))})]}),we&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-600 space-y-3 animate-slide-up",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(u,{type:"number",placeholder:l("transactions.minAmount","Min"),value:ee,onChange:e=>Me("min",e.target.value),className:"h-10"}),e.jsx(u,{type:"number",placeholder:l("transactions.maxAmount","Max"),value:xe,onChange:e=>Me("max",e.target.value),className:"h-10"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx(ce,{label:l("transactions.category","Category"),options:nt,selected:B.categories||[],onChange:e=>J({...B,categories:e}),placeholder:l("transactions.allCategories","All")})}),e.jsx(R,{label:l("transactions.source","Source"),value:B.source||"",onChange:e=>J({...B,source:e.target.value}),options:[{value:"",label:l("transactions.all","All")},...(null==A?void 0:A.map(e=>({value:e.name,label:e.name})))||[]]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{J({start_date:_.start,end_date:_.end,categories:[],source:"",type:"all"}),H(""),Ne("thisMonth"),te(""),ve(""),P({to:"/transactions",search:{}})},children:l("button.reset","Reset")}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>at&&fe(at,B.start_date,B.end_date),disabled:!at||0===at.length,children:l("transactions.export","Export")})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs(j,{onClick:()=>qe("income"),className:"cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] "+("income"===K?"ring-2 ring-green-500 dark:ring-green-400 bg-green-50/50 dark:bg-green-900/20":""),children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:l("transactions.income")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-green-600 dark:text-green-400",children:N(gt,mt,h,!0,d)})]}),e.jsxs(j,{onClick:()=>qe("expense"),className:"cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] "+("expense"===K?"ring-2 ring-red-500 dark:ring-red-400 bg-red-50/50 dark:bg-red-900/20":""),children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:l("transactions.expense")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-red-600 dark:text-red-400",children:N(ht,mt,h,!0,d)})]}),e.jsxs(j,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:l("transactions.difference")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-blue-600 dark:text-blue-400",children:N(yt,mt,h,!0,d)})]})]}),!st&&at&&at.length>0&&e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l("transactions.show","Show"),":"]}),e.jsx("div",{className:"hidden md:flex gap-1",children:[50,100,"all"].map(t=>e.jsx("button",{onClick:()=>_e(t),className:"px-3 py-1 text-sm rounded-md transition-colors "+(Pe===t?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"all"===t?l("transactions.showAll","All"):t},t))}),e.jsxs("select",{value:Pe,onChange:e=>_e("all"===e.target.value?"all":Number(e.target.value)),className:"md:hidden px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"all",children:l("transactions.showAll","All")})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l("transactions.sort","Sort"),":"]}),e.jsxs("select",{value:`${ze}-${Te}`,onChange:e=>(e=>{Oe(!0);const[t,a]=e.split("-");Ee(t),Re(a),setTimeout(()=>Oe(!1),150)})(e.target.value),className:"px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"date-desc",children:l("transactions.sortDateDesc","Date ↓")}),e.jsx("option",{value:"date-asc",children:l("transactions.sortDateAsc","Date ↑")}),e.jsx("option",{value:"amount-desc",children:l("transactions.sortAmountDesc","Amount ↓")}),e.jsx("option",{value:"amount-asc",children:l("transactions.sortAmountAsc","Amount ↑")})]}),Ae&&e.jsxs("svg",{className:"animate-spin h-4 w-4 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:l("transactions.showingCount","Showing {{shown}} of {{total}}",{shown:bt.length,total:pt.length})})]}),st?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:l("transactions.date")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:l("transactions.description")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:l("transactions.category")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:l("transactions.source")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:l("transactions.amount")}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:l("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:[...Array(5)].map((t,a)=>e.jsx(w,{},a))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:[...Array(5)].map((t,a)=>e.jsx(C,{},a))})]}):at&&at.length>0?e.jsxs("div",{className:"transition-opacity duration-150 "+(Ae?"opacity-50":"opacity-100"),children:[e.jsx(j,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12",children:e.jsx("input",{type:"checkbox",checked:lt,onChange:()=>{Xe(lt?new Set:new Set((null==at?void 0:at.map(e=>e.id))||[]))},className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ye("date"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[l("transactions.date"),"date"===ze&&e.jsx("span",{className:"text-blue-600",children:"asc"===Te?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ye("description"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[l("transactions.description"),"description"===ze&&e.jsx("span",{className:"text-blue-600",children:"asc"===Te?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ye("category"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[l("transactions.category"),"category"===ze&&e.jsx("span",{className:"text-blue-600",children:"asc"===Te?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ye("source"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[l("transactions.source"),"source"===ze&&e.jsx("span",{className:"text-blue-600",children:"asc"===Te?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ye("amount"),children:e.jsxs("span",{className:"flex items-center justify-end gap-1",children:[l("transactions.amount"),"amount"===ze&&e.jsx("span",{className:"text-blue-600",children:"asc"===Te?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:l("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:bt.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:Ie.has(t.id),onChange:()=>(e=>{const t=new Set(Ie);t.has(e)?t.delete(e):t.add(e),Xe(t)})(t.id),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:p(t.date)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:t.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(ie,{variant:"income"===t.type?"info":"default",children:t.category})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-300",children:t.source}),e.jsx("td",{className:"px-6 py-4 text-sm font-semibold font-numbers text-right "+(t.is_transfer?"text-blue-500 dark:text-blue-400":"income"===t.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:f(t.amount,t.type,t.currency||"JPY",h,!0,d)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>Fe(t),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors","aria-label":l("button.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})})}),e.jsx("button",{onClick:()=>Je(t),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors","aria-label":l("button.delete"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-red-600 dark:text-red-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]})})]},t.id))})]})}),e.jsx(de,{onRefresh:async()=>{await y.invalidateQueries({queryKey:["transactions"]}),await y.invalidateQueries({queryKey:["dashboard"]}),await y.invalidateQueries({queryKey:["analytics"]})},className:"md:hidden",children:e.jsx("div",{className:"space-y-6 pb-20",children:"date"===ze?ft.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:S(t.date)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx("div",{className:"space-y-3",children:t.transactions.map(t=>e.jsx(he,{transaction:t,onViewDetail:Qe,onEdit:Fe,onDelete:Je},t.id))})]},t.date)):e.jsx("div",{className:"space-y-3",children:bt.map(t=>e.jsx(he,{transaction:t,onViewDetail:Qe,onEdit:Fe,onDelete:Je},t.id))})})})]}):e.jsx(j,{children:e.jsx(oe,{icon:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),title:l("transactions.noData"),description:l("transactions.noDataDescription","Upload a CSV file or add transactions manually to get started."),action:e.jsx(m,{onClick:()=>We(!0),children:l("transaction.addTransaction")})})}),Ie.size>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg p-4 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("transactions.selectedCount","{{count}} selected",{count:Ie.size})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Xe(new Set),children:l("button.clearSelection","Clear")}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Ge(!0),children:l("transactions.recategorize","Recategorize")}),e.jsx(m,{variant:"danger",size:"sm",onClick:()=>tt(!0),children:l("transactions.deleteSelected","Delete")})]})]})}),e.jsx(me,{isOpen:!!$e,onClose:()=>Fe(null),transaction:$e}),e.jsx(ue,{isOpen:!!Ke,onClose:()=>Qe(null),transaction:Ke,onEdit:Fe,onDelete:Je}),e.jsx(se,{isOpen:Ue,onClose:()=>We(!1)}),e.jsx(ye,{isOpen:!!Be,onClose:()=>Je(null),onConfirm:()=>{Be&&it.mutate(Be.id)},transaction:Be,isDeleting:it.isPending}),e.jsx(pe,{isOpen:Ze,onClose:()=>Ge(!1),onConfirm:e=>ct.mutate(e),selectedCount:Ie.size,isLoading:ct.isPending}),e.jsx(be,{isOpen:et,onClose:()=>tt(!1),onConfirm:()=>ot.mutate(),selectedCount:Ie.size,isDeleting:ot.isPending}),e.jsx(re,{isOpen:Ve,onClose:()=>He(!1),onScanComplete:e=>{if(!e.amount||!e.category)return;const t=null==A?void 0:A[0],a=(null==t?void 0:t.currency)||"JPY",s=z(Math.abs(e.amount),a);rt.mutate({date:e.date||(new Date).toISOString().split("T")[0],description:e.merchant||"Receipt Scan",amount:-s,currency:a,category:e.category,source:(null==t?void 0:t.name)||"Unknown",type:"expense"})}}),e.jsx(ge,{onClick:()=>We(!0)})]})}});export{ve as Route};
