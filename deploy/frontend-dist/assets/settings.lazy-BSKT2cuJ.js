import{k as I,F as P,u as E,G as O,r as g,z,a1 as R,j as e,C as M,D as K,B as S,P as he,l as m,T as ae,g as se,X as re,w as Y,I as D,af as be,ag as H,ah as fe,ai as ne,R as je,aj as ke,ak as ve,al as Ne,am as Ce,an as we,ao as ie,Q as _e,ap as Se,aq as Pe,i as Te}from"./index-CAo5feKb.js";import{C as G,c as qe,d as Re,s as De,a as Me,b as Ee,e as A,f as Fe,g as Ae}from"./crypto-dhEWm214.js";import{S as le}from"./Select-WWcriSHE.js";import{P as Ke,R as Le}from"./RecurringTransactionsList-BxY7OFbY.js";import{T as V}from"./tag-ajg-wPq1.js";import{u as ze,a as Ie,b as Oe,c as We}from"./useCategories-MHt0Alv3.js";import{T as Z}from"./triangle-alert-CiOXZG73.js";import{P as Qe}from"./pencil-C8gf3kQ0.js";import{S as $e,Z as He}from"./Switch-F4HDU_cd.js";import{M as Ue}from"./mail-0BbuSl7h.js";import{C as Be}from"./crown-C_QmKGyq.js";import"./chevron-down-yyHEm7Kg.js";import"./recurring-service-DAvPH-s1.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Ve=I("monitor",Je);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],ce=I("palette",Ye);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],Ze=I("repeat",Ge);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],et=I("save",Xe);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],at=I("smartphone",tt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],rt=I("wand-sparkles",st);async function nt(){return(await P.get("/api/category-rules/")).data.rules}async function it(t){return(await P.post("/api/category-rules/",t)).data}async function lt(t){await P.delete(`/api/category-rules/${t}`)}async function ct(t=!0){return(await P.post("/api/category-rules/apply",{dry_run:t})).data}async function ot(){return(await P.get("/api/category-rules/suggest")).data.suggestions}async function dt(){return(await P.post("/api/category-rules/seed-defaults")).data}const gt={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},mt=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function xt(){const{t}=E("common"),n=O(),[a,l]=g.useState(null),[x,f]=g.useState(!1),[s,b]=g.useState(!1),[j,d]=g.useState(null),[u,k]=g.useState(""),[i,c]=g.useState("Other"),[r,y]=g.useState("contains"),{data:p,isLoading:w}=z({queryKey:["category-rules"],queryFn:nt}),{data:v,isLoading:T}=z({queryKey:["category-rules-suggestions"],queryFn:ot,enabled:s}),C=R({mutationFn:lt,onSuccess:()=>{n.invalidateQueries({queryKey:["category-rules"]}),l(null)}}),_=R({mutationFn:it,onSuccess:()=>{n.invalidateQueries({queryKey:["category-rules"]}),k(""),c("Other"),y("contains"),f(!1)}}),q=R({mutationFn:dt,onSuccess:()=>{n.invalidateQueries({queryKey:["category-rules"]})}}),N=R({mutationFn:h=>ct(h),onSuccess:(h,$)=>{$?d({count:h.affected_count,applied:!1}):(n.invalidateQueries({queryKey:["transactions"]}),n.invalidateQueries({queryKey:["analytics"]}),d({count:h.affected_count,applied:!0}))}}),F=h=>{confirm(t("confirmDelete"))&&(l(h),C.mutate(h))},W=()=>{u.trim()&&_.mutate({keyword:u.trim(),category:i,match_type:r,priority:10})},Q=h=>{_.mutate({keyword:h.keyword,category:h.suggested_category,match_type:"contains",priority:10})};return w?e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("categoryRules.title")})]}),e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{size:"md"})})]}):e.jsxs(G,{title:t("categoryRules.title"),badge:(p==null?void 0:p.length)||0,children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!p||p.length===0)&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>q.mutate(),disabled:q.isPending,children:[e.jsx(rt,{className:"w-4 h-4 mr-1"}),q.isPending?t("loading"):t("categoryRules.seedDefaults")]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>f(!x),children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),t("categoryRules.addRule")]})]}),x&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:t("categoryRules.keyword"),value:u,onChange:h=>k(h.target.value),className:m("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),e.jsx("select",{value:i,onChange:h=>c(h.target.value),className:m("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:mt.map(h=>e.jsx("option",{value:h,children:h},h))}),e.jsxs("select",{value:r,onChange:h=>y(h.target.value),className:m("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[e.jsx("option",{value:"contains",children:t("categoryRules.contains")}),e.jsx("option",{value:"starts_with",children:t("categoryRules.startsWith")}),e.jsx("option",{value:"exact",children:t("categoryRules.exact")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>f(!1),children:t("cancel")}),e.jsx(S,{size:"sm",onClick:W,disabled:!u.trim()||_.isPending,children:_.isPending?t("saving"):t("save")})]})]}),p&&p.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-6",children:p.map(h=>e.jsxs("div",{className:m("flex items-center justify-between p-3 rounded-lg border",h.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:h.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:h.category}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",t(gt[h.match_type]),")"]})]}),e.jsx("button",{onClick:()=>F(h.id),disabled:a===h.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:a===h.id?e.jsx(K,{size:"sm"}):e.jsx(ae,{className:"w-4 h-4"})})]},h.id))}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("categoryRules.applyDescription")}),j&&e.jsx("p",{className:m("text-sm mt-1",j.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:j.applied?t("categoryRules.appliedCount",{count:j.count}):t("categoryRules.previewCount",{count:j.count})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>N.mutate(!0),disabled:N.isPending,children:N.isPending?t("loading"):t("categoryRules.preview")}),e.jsxs(S,{size:"sm",onClick:()=>N.mutate(!1),disabled:N.isPending||(j==null?void 0:j.count)===0,children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),t("categoryRules.applyNow")]})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("categoryRules.noRules")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("categoryRules.noRulesDescription")})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[e.jsx("button",{onClick:()=>b(!s),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:t(s?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),s&&e.jsx("div",{className:"mt-4 space-y-2",children:T?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(K,{size:"sm"})}):v&&v.length>0?v.map((h,$)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:h.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:h.suggested_category}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",h.count,"x)"]})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>Q(h),disabled:_.isPending,children:e.jsx(se,{className:"w-4 h-4"})})]},$)):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:t("categoryRules.noSuggestions")})})]})]})}const ut=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function yt({isOpen:t,onClose:n,defaultType:a="expense",onCreated:l}){const{t:x}=E("common"),f=ze(),[s,b]=g.useState(""),[j,d]=g.useState("ðŸ“"),[u,k]=g.useState(a),[i,c]=g.useState(""),r=async w=>{var T,C;w.preventDefault(),c("");const v=s.trim();if(!v){c(x("category.errors.nameRequired","Name is required"));return}try{const q=`custom_${(await f.mutateAsync({name:v,icon:j,type:u})).id}`;l==null||l(q),y()}catch(_){c(((C=(T=_.response)==null?void 0:T.data)==null?void 0:C.detail)||x("category.errors.createFailed","Failed to create category"))}},y=()=>{b(""),d("ðŸ“"),k(a),c(""),n()};if(!t)return null;const p=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:y}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:x("category.createTitle","Create Category")}),e.jsx("button",{onClick:y,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(re,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("category.name","Category Name")}),e.jsx("input",{type:"text",value:s,onChange:w=>b(w.target.value),placeholder:x("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:ut.map(w=>e.jsx("button",{type:"button",onClick:()=>d(w),className:m("w-8 h-8 text-lg rounded flex items-center justify-center",j===w?"bg-primary-100 dark:bg-primary-900 border-2 border-primary-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("category.type","Type")}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>k("expense"),className:m("flex-1 py-2 rounded-md text-sm font-medium transition-colors",u==="expense"?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:x("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>k("income"),className:m("flex-1 py-2 rounded-md text-sm font-medium transition-colors",u==="income"?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:x("transaction.income","Income")})]})]}),i&&e.jsx("p",{className:"text-sm text-red-500",children:i}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:y,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:x("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:f.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:f.isPending?"...":x("create","Create")})]})]})]})]});return typeof document>"u"?null:Y.createPortal(p,document.body)}const pt=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function ht({isOpen:t,onClose:n,category:a}){const{t:l}=E("common"),x=O(),[f,s]=g.useState(""),[b,j]=g.useState("ðŸ“"),[d,u]=g.useState(""),[k,i]=g.useState(null);g.useEffect(()=>{a&&(s(a.name),j(a.icon),u(""),i(null))},[a]);const c=R({mutationFn:v=>Ie(a.id,v),onSuccess:v=>{i(v.affected_transactions),x.invalidateQueries({queryKey:["categories"]}),x.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{y()},1500)},onError:v=>{var C,_;u(((_=(C=v.response)==null?void 0:C.data)==null?void 0:_.detail)||l("category.errors.updateFailed","Failed to update category"))}}),r=async v=>{v.preventDefault(),u("");const T=f.trim();if(!T){u(l("category.errors.nameRequired","Name is required"));return}const C={};if(T!==(a==null?void 0:a.name)&&(C.name=T),b!==(a==null?void 0:a.icon)&&(C.icon=b),Object.keys(C).length===0){y();return}c.mutate(C)},y=()=>{s(""),j("ðŸ“"),u(""),i(null),n()};if(!t||!a)return null;const p=f.trim()!==a.name,w=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:y}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:l("category.editTitle","Edit Category")}),e.jsx("button",{onClick:y,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(re,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),k!==null&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[l("category.updateSuccess","Category updated!"),k>0&&e.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:l("category.transactionsUpdated","{{count}} transactions updated",{count:k})})]})}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("category.name","Category Name")}),e.jsx("input",{type:"text",value:f,onChange:v=>s(v.target.value),placeholder:l("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),p&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[e.jsx(Z,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:l("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:pt.map(v=>e.jsx("button",{type:"button",onClick:()=>j(v),className:m("w-8 h-8 text-lg rounded flex items-center justify-center",b===v?"bg-primary-100 dark:bg-primary-900 border-2 border-primary-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:v},v))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("category.type","Type")}),e.jsx("div",{className:m("h-10 px-3 flex items-center rounded-lg text-sm font-medium",a.type==="expense"?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:a.type==="expense"?l("transaction.expense","Expense"):l("transaction.income","Income")})]}),d&&e.jsx("p",{className:"text-sm text-red-500",children:d}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:y,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:l("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:c.isPending||k!==null,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:c.isPending?"...":l("save","Save")})]})]})]})]});return typeof document>"u"?null:Y.createPortal(w,document.body)}function bt(){const{t}=E("common"),{data:n=[],isLoading:a}=Oe(),l=We(),[x,f]=g.useState(!1),[s,b]=g.useState(null),[j,d]=g.useState(null),u=async c=>{try{await l.mutateAsync(c),d(null)}catch(r){console.error("Failed to delete category:",r)}},k=n.filter(c=>c.type==="expense"),i=n.filter(c=>c.type==="income");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{title:t("settings.categoryManagement"),badge:n.length,children:[a?e.jsx("div",{className:"py-4 text-center text-gray-400",children:t("loading")}):n.length===0?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noCategories")}):e.jsxs("div",{className:"space-y-4",children:[k.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.expense","Expense")}),e.jsx("div",{className:"space-y-2",children:k.map(c=>e.jsx(X,{category:c,onEdit:()=>b(c),onDelete:()=>d(c.id),isDeleting:l.isPending&&j===c.id,showDeleteConfirm:j===c.id,onConfirmDelete:()=>u(c.id),onCancelDelete:()=>d(null)},c.id))})]}),i.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.income","Income")}),e.jsx("div",{className:"space-y-2",children:i.map(c=>e.jsx(X,{category:c,onEdit:()=>b(c),onDelete:()=>d(c.id),isDeleting:l.isPending&&j===c.id,showDeleteConfirm:j===c.id,onConfirmDelete:()=>u(c.id),onCancelDelete:()=>d(null)},c.id))})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",onClick:()=>f(!0),children:t("settings.addCategory")})})]}),e.jsx(yt,{isOpen:x,onClose:()=>f(!1)}),e.jsx(ht,{isOpen:!!s,onClose:()=>b(null),category:s})]})}function X({category:t,onEdit:n,onDelete:a,isDeleting:l,showDeleteConfirm:x,onConfirmDelete:f,onCancelDelete:s}){const{t:b}=E("common");return x?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:b("category.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:b("cancel")}),e.jsx("button",{onClick:f,disabled:l,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:l?"...":b("delete")})]})]}):e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:b("edit"),children:e.jsx(Qe,{size:16})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:b("delete"),children:e.jsx(ae,{size:16})})]})]})}const ee=["eth","bsc","polygon"];function ft(){const{t}=E("common"),n=O(),[a,l]=g.useState(!1),[x,f]=g.useState(""),[s,b]=g.useState(""),[j,d]=g.useState(["eth","bsc","polygon"]),[u,k]=g.useState(!1),[i,c]=g.useState("polygon"),[r,y]=g.useState(""),[p,w]=g.useState(""),[v,T]=g.useState(""),[C,_]=g.useState(null),{data:q,isLoading:N}=z({queryKey:["crypto-wallets"],queryFn:Fe}),{data:F,isLoading:W}=z({queryKey:["reward-contracts"],queryFn:Ae}),Q=R({mutationFn:qe,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),l(!1),de()}}),h=R({mutationFn:Re,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]})}}),$=R({mutationFn:De,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),n.invalidateQueries({queryKey:["dashboard-summary"]}),_(null)},onError:()=>{_(null)}}),U=R({mutationFn:Me,onSuccess:()=>{n.invalidateQueries({queryKey:["reward-contracts"]}),k(!1),ge()}}),oe=R({mutationFn:Ee,onSuccess:()=>{n.invalidateQueries({queryKey:["reward-contracts"]})}}),de=()=>{f(""),b(""),d(["eth","bsc","polygon"])},ge=()=>{c("polygon"),y(""),w(""),T("")},me=()=>{if(!x||!x.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}Q.mutate({wallet_address:x,label:s||void 0,chains:j})},xe=o=>{_(o),$.mutate(o)},ue=()=>{if(!r||!r.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}U.mutate({chain_id:i,contract_address:r,label:p||void 0,token_symbol:v||void 0})},ye=o=>{d(L=>L.includes(o)?L.filter(pe=>pe!==o):[...L,o])};return N||W?e.jsx(M,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.wallets")}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>l(!a),children:t(a?"cancel":"crypto.addWallet")})]}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(D,{label:t("crypto.walletAddress"),placeholder:"0x...",value:x,onChange:o=>f(o.target.value)}),e.jsx(D,{label:t("crypto.walletLabel"),placeholder:t("crypto.labelPlaceholder"),value:s,onChange:o=>b(o.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map(o=>e.jsxs("button",{type:"button",onClick:()=>ye(o),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${j.includes(o)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[o].icon," ",A[o].name]},o))})]}),e.jsx(S,{onClick:me,disabled:Q.isPending,className:"w-full",children:Q.isPending?t("loading"):t("crypto.addWallet")})]}),e.jsx("div",{className:"space-y-3",children:q&&q.length>0?q.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:o.label||t("crypto.unnamedWallet")}),e.jsx("div",{className:"flex gap-1",children:o.chains.map(L=>e.jsx("span",{title:A[L].name,children:A[L].icon},L))})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:o.wallet_address})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>xe(o.id),disabled:C===o.id,children:C===o.id?e.jsx(K,{size:"sm"}):t("crypto.sync")}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteWallet"))&&h.mutate(o.id)},className:"text-red-600 hover:text-red-700 text-sm",children:t("delete")})]})]},o.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noWallets")})})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.rewardContracts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("crypto.rewardContractsDescription")})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>k(!u),children:t(u?"cancel":"crypto.addContract")})]}),u&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chain")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map(o=>e.jsxs("button",{type:"button",onClick:()=>c(o),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${i===o?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[o].icon," ",A[o].name]},o))})]}),e.jsx(D,{label:t("crypto.contractAddress"),placeholder:"0x...",value:r,onChange:o=>y(o.target.value)}),e.jsx(D,{label:t("crypto.contractLabel"),placeholder:t("crypto.contractLabelPlaceholder"),value:p,onChange:o=>w(o.target.value)}),e.jsx(D,{label:t("crypto.tokenSymbol"),placeholder:"STEER",value:v,onChange:o=>T(o.target.value)}),e.jsx(S,{onClick:ue,disabled:U.isPending,className:"w-full",children:U.isPending?t("loading"):t("crypto.addContract")})]}),e.jsx("div",{className:"space-y-3",children:F&&F.length>0?F.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{title:A[o.chain_id].name,children:A[o.chain_id].icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:o.label||t("crypto.unnamedContract")}),o.token_symbol&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:o.token_symbol})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:o.contract_address})]}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteContract"))&&oe.mutate(o.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:t("delete")})]},o.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noContracts")})})]})]})}function jt(){const{t}=E("common"),n=O(),{data:a,isLoading:l,error:x}=z({queryKey:["anomalyConfig"],queryFn:fe}),f=R({mutationFn:i=>be(i),onSuccess:()=>{n.invalidateQueries({queryKey:["anomalyConfig"]})}}),[s,b]=g.useState({sensitivity:"medium",large_transaction_threshold:1e4,unusual_spending_percent:50,recurring_change_percent:20,duplicate_charge_hours:24,enabled_types:["large_transaction","category_shift","duplicate"]});g.useEffect(()=>{a&&b({sensitivity:a.sensitivity,large_transaction_threshold:a.large_transaction_threshold,unusual_spending_percent:a.unusual_spending_percent,recurring_change_percent:a.recurring_change_percent,duplicate_charge_hours:a.duplicate_charge_hours,enabled_types:a.enabled_types||["large_transaction","category_shift","duplicate"]})},[a]);const j=()=>{f.mutate(s)},d=i=>{b(c=>{const r=c.enabled_types||[],y=r.includes(i)?r.filter(p=>p!==i):[...r,i];return{...c,enabled_types:y}})},u=[{key:"large_transaction",label:t("anomaly.type.large_transaction")},{key:"category_shift",label:t("anomaly.type.category_shift")},{key:"duplicate",label:t("anomaly.type.duplicate")},{key:"recurring_change",label:t("anomaly.type.recurring_change")},{key:"ml_detected",label:t("anomaly.type.ml_detected")}],k=[{value:"low",label:t("anomaly.config.sensitivityOptions.low")},{value:"medium",label:t("anomaly.config.sensitivityOptions.medium")},{value:"high",label:t("anomaly.config.sensitivityOptions.high")}];return l?e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"})]})}):x?e.jsxs(M,{className:"p-6 text-center text-gray-500",children:[e.jsx(Z,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:t("common.noData")})]}):e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(H,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:t("anomaly.config.title")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{label:t("anomaly.config.sensitivity"),value:s.sensitivity,onChange:i=>b({...s,sensitivity:i.target.value}),options:k}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(D,{type:"number",label:t("anomaly.config.largeTransactionThreshold"),value:s.large_transaction_threshold,onChange:i=>b({...s,large_transaction_threshold:parseInt(i.target.value)||0})}),e.jsx(D,{type:"number",label:t("anomaly.config.unusualSpendingPercent"),value:s.unusual_spending_percent,onChange:i=>b({...s,unusual_spending_percent:parseInt(i.target.value)||0})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(D,{type:"number",label:t("anomaly.config.recurringChangePercent"),value:s.recurring_change_percent,onChange:i=>b({...s,recurring_change_percent:parseInt(i.target.value)||0})}),e.jsx(D,{type:"number",label:t("anomaly.config.duplicateChargeHours"),value:s.duplicate_charge_hours,onChange:i=>b({...s,duplicate_charge_hours:parseInt(i.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:t("anomaly.config.enabledTypes")}),e.jsx("div",{className:"space-y-3",children:u.map(i=>{const c=(s.enabled_types||[]).includes(i.key);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i.label}),e.jsx($e,{checked:c,onChange:()=>d(i.key)})]},i.key)})})]}),e.jsx(S,{onClick:j,disabled:f.isPending,className:"w-full",children:f.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"â³"}),t("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),t("anomaly.config.save")]})}),f.isSuccess&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 text-center",children:t("anomaly.config.saved")})]})]})}const B={async getNotifications(t){const n=new URLSearchParams;return t!=null&&t.unreadOnly&&n.append("unread_only","true"),t!=null&&t.limit&&n.append("limit",String(t.limit)),t!=null&&t.offset&&n.append("offset",String(t.offset)),t!=null&&t.type&&n.append("type",t.type),(await P.get(`/api/notifications?${n}`)).data},async getUnreadCount(){return(await P.get("/api/notifications/unread/count")).data},async markAsRead(t){return(await P.put(`/api/notifications/${t}/read`,{})).data},async markAllAsRead(){return(await P.put("/api/notifications/read-all",{})).data},async deleteNotification(t){return(await P.delete(`/api/notifications/${t}`)).data},async cleanupOldNotifications(t=30){return(await P.post("/api/notifications/cleanup",{days_old:t})).data},async getPreferences(){return(await P.get("/api/notifications/preferences")).data},async updatePreference(t,n,a){return(await P.put(`/api/notifications/preferences/${t}`,{enabled:n,settings:a})).data},async subscribePush(t){return(await P.post("/api/notifications/push/subscribe",t)).data},async unsubscribePush(){return(await P.post("/api/notifications/push/unsubscribe",{})).data}};function kt(){return typeof window>"u"?!1:"serviceWorker"in navigator&&"PushManager"in window}async function vt(){return typeof window>"u"?"denied":await Notification.requestPermission()}function Nt(){return""}function Ct(){const{t}=E("common"),n=O(),[a,l]=g.useState(!1),[x,f]=g.useState(!1),{data:s,isLoading:b}=z({queryKey:["notification-preferences"],queryFn:B.getPreferences}),j=R({mutationFn:({channel:r,enabled:y,settings:p})=>B.updatePreference(r,y,p),onSuccess:()=>{n.invalidateQueries({queryKey:["notification-preferences"]})}}),d=(s==null?void 0:s.preferences)||[];g.useEffect(()=>{(async()=>{if(kt()){const y=await Notification.permission;l(y==="granted")}})()},[]);const u=(r,y)=>{j.mutate({channel:r,enabled:!y})},k=async()=>{f(!0);try{if(await vt()==="granted"&&(l(!0),"serviceWorker"in navigator&&"PushManager"in window)){const p=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Nt()});await B.subscribePush(p.toJSON())}}catch(r){console.error("Failed to enable push notifications:",r)}finally{f(!1)}},i=r=>d.find(y=>y.channel===r),c=[{id:"push",icon:at,label:t("notifications.channels.push"),description:t("notifications.channels.pushDescription"),getEnabled:()=>a,onToggle:k},{id:"email",icon:Ue,label:t("notifications.channels.email"),description:t("notifications.channels.emailDescription"),getEnabled:()=>{var r;return((r=i("email"))==null?void 0:r.enabled)??!0},onToggle:()=>{var r;return u("email",((r=i("email"))==null?void 0:r.enabled)??!0)}},{id:"in_app",icon:ne,label:t("notifications.channels.inApp"),description:t("notifications.channels.inAppDescription"),getEnabled:()=>{var r;return((r=i("in_app"))==null?void 0:r.enabled)??!0},onToggle:()=>{var r;return u("in_app",((r=i("in_app"))==null?void 0:r.enabled)??!0)}}];return b?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{size:"lg"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(H,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t("notifications.channels.title")})]}),e.jsx("div",{className:"space-y-4",children:c.map(r=>{const y=r.icon,p=r.getEnabled();return e.jsxs("div",{className:m("flex items-center justify-between p-3 rounded-lg border transition-colors",p?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:m("p-2 rounded-lg",p?"bg-green-100 dark:bg-green-900/50":"bg-gray-200 dark:bg-gray-600"),children:e.jsx(y,{className:m("w-5 h-5",p?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r.label}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.description})]})]}),e.jsx("button",{onClick:r.onToggle,disabled:r.id==="push"&&x,className:m("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",p?"bg-green-500":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:m("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",p?"translate-x-6":"translate-x-1")})})]},r.id)})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.types.title")}),e.jsx("div",{className:"space-y-3",children:[{key:"budget_alert",label:t("notifications.types.budget")},{key:"bill_reminder",label:t("notifications.types.bills")},{key:"anomaly_detected",label:t("notifications.types.anomalies")},{key:"goal_milestone",label:t("notifications.types.goals")},{key:"savings_tip",label:t("notifications.types.savings")},{key:"burn_rate_warning",label:t("notifications.types.burnRate")}].map(r=>{const y=i(r.key),p=(y==null?void 0:y.enabled)??!0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r.label}),e.jsx("button",{onClick:()=>u(r.key,!p),className:m("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",p?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:m("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",p?"translate-x-6":"translate-x-1")})})]},r.key)})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.quietHours.title")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("notifications.quietHours.description")})}),e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),t("notifications.quietHours.configure")]})]})]})]})}function wt(){const{t}=E("common"),{theme:n,setTheme:a,accentColor:l,setAccentColor:x,tier:f,setTier:s}=ke(),b=[{id:"light",icon:ve,label:t("appearance.light","Light")},{id:"dark",icon:Ne,label:t("appearance.dark","Dark")},{id:"system",icon:Ve,label:t("appearance.system","System")}],j=[{id:"pro",icon:Be,label:t("appearance.pro","Pro"),desc:t("appearance.proDesc","Full access, all items visible")},{id:"lite",icon:He,label:t("appearance.lite","Lite"),desc:t("appearance.liteDesc","Simplified view, fewer items per page")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.themeMode","Theme Mode")}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:b.map(({id:d,icon:u,label:k})=>e.jsxs("button",{onClick:()=>a(d),className:m("flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all",n===d?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsx(u,{className:m("w-5 h-5",n===d?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400")}),e.jsx("span",{className:m("text-xs font-medium",n===d?"text-primary-700 dark:text-primary-300":"text-gray-600 dark:text-gray-400"),children:k})]},d))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.accentColor","Accent Color")}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Ce.map(d=>e.jsxs("button",{onClick:()=>x(d.id),className:"group flex flex-col items-center gap-1.5",title:d.label,children:[e.jsx("div",{className:m("w-10 h-10 rounded-full transition-all ring-offset-2 ring-offset-white dark:ring-offset-gray-900",l===d.id?"ring-2 ring-gray-900 dark:ring-white scale-110":"ring-1 ring-gray-200 dark:ring-gray-700 group-hover:scale-105"),style:{backgroundColor:d.preview}}),e.jsx("span",{className:m("text-[10px] font-medium",l===d.id?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-500"),children:d.label})]},d.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.displayMode","Display Mode")}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:j.map(({id:d,icon:u,label:k,desc:i})=>e.jsxs("button",{onClick:()=>s(d),className:m("flex flex-col items-start gap-2 p-4 rounded-xl border-2 transition-all text-left",f===d?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:m("w-4 h-4",f===d?"text-primary-600 dark:text-primary-400":"text-gray-500")}),e.jsx("span",{className:m("text-sm font-semibold",f===d?"text-primary-700 dark:text-primary-300":"text-gray-700 dark:text-gray-300"),children:k})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:i})]},d))})]})]})}const _t=[{id:"appearance",labelKey:"settings.sections.appearance",icon:ce},{id:"general",labelKey:"settings.sections.general",icon:H},{id:"budget",labelKey:"settings.sections.budget",icon:ie},{id:"categories",labelKey:"settings.sections.categories",icon:V},{id:"sources",labelKey:"settings.sections.sources",icon:_e},{id:"recurring",labelKey:"settings.sections.recurring",icon:Ze},{id:"notifications",labelKey:"settings.sections.notifications",icon:ne},{id:"crypto",labelKey:"settings.sections.crypto",icon:Se},{id:"anomaly",labelKey:"anomaly.title",icon:Z}];function St(){var _,q;const{t}=E("common"),n=O(),[a,l]=g.useState("appearance"),[x,f]=g.useState(!1),{data:s,isLoading:b}=z({queryKey:["settings"],queryFn:Pe}),[j,d]=g.useState("JPY"),[u,k]=g.useState(25),[i,c]=g.useState(!1),[r,y]=g.useState(!0),[p,w]=g.useState(1e6);g.useEffect(()=>{s&&(d(s.currency),k(s.base_date),c(s.budget_carry_over),y(s.budget_email_alerts),w(s.large_transaction_threshold))},[s]),g.useEffect(()=>{if(s){const N=j!==s.currency||u!==s.base_date||i!==s.budget_carry_over||r!==s.budget_email_alerts||p!==s.large_transaction_threshold;f(N)}},[j,u,i,r,p,s]);const v=R({mutationFn:we,onSuccess:()=>{n.invalidateQueries({queryKey:["settings"]}),n.invalidateQueries({queryKey:["dashboard-summary"]}),n.invalidateQueries({queryKey:["transactions"]}),n.invalidateQueries({queryKey:["analytics"]}),f(!1)},onError:N=>{console.error("Failed to save settings:",N)}}),T=()=>{v.mutate({currency:j,base_date:u,budget_carry_over:i,budget_email_alerts:r,large_transaction_threshold:p})};if(b)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(K,{size:"lg"})});const C={JPY:t("settings.currencyJPY"),USD:t("settings.currencyUSD"),VND:t("settings.currencyVND")};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-primary-600"}),t("settings.title")]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:t("settings.subtitle")})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto py-2 scrollbar-hide -mb-2",children:_t.map(N=>{const F=N.icon,W=a===N.id;return e.jsxs("button",{onClick:()=>l(N.id),className:m("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",W?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(F,{className:"w-3.5 h-3.5"}),t(N.labelKey)]},N.id)})})})})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx("div",{className:m("space-y-4",a!=="appearance"&&"hidden"),children:e.jsx(J,{icon:ce,title:t("appearance.title","Appearance"),description:t("appearance.subtitle","Theme, colors, and display preferences"),children:e.jsx(wt,{})})}),e.jsx("div",{className:m("space-y-4",a!=="general"&&"hidden"),children:e.jsx(J,{icon:H,title:t("settings.general"),description:"Currency and basic preferences",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(le,{label:t("settings.currency"),value:j,onChange:N=>d(N.target.value),options:[{value:"JPY",label:C.JPY},{value:"USD",label:C.USD},{value:"VND",label:C.VND}]}),e.jsx(D,{type:"number",label:t("settings.payday"),value:u,onChange:N=>k(parseInt(N.target.value,10)),min:1,max:31}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 -mt-2",children:t("settings.paydayDescription")})]})})}),e.jsx("div",{className:m("space-y-4",a!=="budget"&&"hidden"),children:e.jsx(J,{icon:ie,title:t("settings.budgetSettings"),description:"Budget behavior and alerts",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(te,{label:t("settings.budgetCarryOver"),description:t("settings.budgetCarryOverDescription"),checked:i,onChange:c}),e.jsx(te,{label:t("settings.budgetEmailAlerts"),description:t("settings.budgetEmailAlertsDescription"),checked:r,onChange:y}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block mb-2",children:t("settings.largeTransactionThreshold")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t("settings.largeTransactionThresholdDescription")}),e.jsx(D,{type:"number",value:p,onChange:N=>w(parseInt(N.target.value,10)||0),min:0,step:1e5}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:t("settings.largeTransactionThresholdHint")})]})]})})}),e.jsx("div",{className:m("space-y-4",a!=="categories"&&"hidden"),children:e.jsx(bt,{})}),e.jsx("div",{className:m("space-y-4",a!=="sources"&&"hidden"),children:e.jsxs(G,{title:t("settings.paymentSourceManagement"),badge:((_=s==null?void 0:s.sources)==null?void 0:_.length)||0,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:((q=s==null?void 0:s.sources)==null?void 0:q.map((N,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:N}),e.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:t("settings.delete")})]},F)))||e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noSources")})}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",children:t("settings.addSource")})})]})}),e.jsx("div",{className:m("space-y-4",a!=="recurring"&&"hidden"),children:e.jsx(Le,{})}),e.jsx("div",{className:m("space-y-4",a!=="notifications"&&"hidden"),children:e.jsx(Ct,{})}),e.jsx("div",{className:m("space-y-4",a!=="crypto"&&"hidden"),children:e.jsx(ft,{})}),e.jsx("div",{className:m("space-y-4",a!=="anomaly"&&"hidden"),children:e.jsx(jt,{})}),e.jsx(xt,{})]}),x&&typeof document<"u"&&Y.createPortal(e.jsx("div",{className:"fixed bottom-20 left-0 right-0 p-4 bg-white/90 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-gray-700 z-40",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(S,{onClick:T,disabled:v.isPending,className:"w-full",size:"lg",children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:"sm",className:"mr-2"}),t("saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),t("settings.saveSettings")]})})})}),document.body)]})}function J({icon:t,title:n,description:a,children:l,className:x}){return e.jsxs(M,{className:m("",x),children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:e.jsx(t,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n}),a&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]})]}),l]})}function te({label:t,description:n,checked:a,onChange:l}){return e.jsxs("div",{className:"flex items-start justify-between py-1",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block",children:t}),n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:n})]}),e.jsx("button",{onClick:()=>l(!a),className:m("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",a?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:m("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",a?"translate-x-6":"translate-x-1")})})]})}const Ot=Te("/settings")({component:St});export{Ot as Route};
