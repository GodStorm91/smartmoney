import{k as ne,u as q,Y as X,r as y,j as e,C as Q,B as V,I as Ie,D as zt,a5 as vt,S as or,N as ir,l as v,X as Ne,aN as xt,P as ve,aO as et,J as te,K as re,a6 as Z,ax as Te,aP as lr,ay as je,g as ht,p as cr,aQ as it,ag as ge,af as R,q as Kt,o as oe,aR as It,x as ft,az as jt,L as lt,ae as ct,O as Vt,T as dr,G as qt,a1 as Ce,aS as ur,aT as mr,ai as gr,z as ke,i as xr}from"./index-DrTfRdV3.js";import{d as bt,e as hr}from"./useCategories-BKA-Gn9_.js";import{C as fr}from"./chevron-down-B4MNf48x.js";import{R as br,E as Nt,u as pr,d as yr,g as vr,r as jr,c as Nr,a as wr,b as wt,e as kr,f as Sr,p as Ar,h as Cr}from"./BudgetInsightWidget-BLjUk1sJ.js";import{T as le}from"./triangle-alert-CHUJdtF_.js";import{f as G,_ as Ut,a as Pr,b as Wt,c as _r,i as pe,T as pt,p as ie,L as se,g as Ht,d as yt,e as Gt,D as Mr,C as Or,h as Oe,j as Ae,S as Tr,A as Dr,k as Er,l as kt,m as $r,n as Pe,o as Lr,u as Rr,G as Br,q as Ve,r as Fr,s as Jt,t as zr,v as ze,w as St,x as Kr,y as Ir,R as Vr,z as qr}from"./generateCategoricalChart-CtqYlzzr.js";import{P as Ur}from"./pencil-BTWMSF3G.js";import{Z as Wr}from"./zap-8Ioml4b1.js";import{T as Hr}from"./TransactionEditModal-DH9N_abU.js";import{u as Gr}from"./useXPGain-DKDOIpdg.js";import{D as Jr}from"./download-bBR8RmxA.js";import"./Select-BSWSmIql.js";import"./zoom-out-BjqTAhUh.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Yr=ne("arrow-down",Qr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Xr=ne("arrow-up",Zr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ta=ne("calendar-days",ea);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],At=ne("copy",ra);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],sa=ne("ellipsis",aa);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],oa=ne("history",na);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],la=ne("layout-grid",ia);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],da=ne("list",ca);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],ma=ne("shield-alert",ua);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],xa=ne("shield-check",ga);function Ke(t,r=0){if(!t&&t!==0)return"";const s=typeof t=="string"?parseFloat(t):t;return isNaN(s)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:r,maximumFractionDigits:r}).format(s)}function ha(t){if(!t)return 0;const r=t.replace(/,/g,""),s=parseFloat(r);return isNaN(s)?0:s}function fa(t){return{JPY:"Â¥",USD:"$",VND:"â‚«",EUR:"â‚¬",GBP:"Â£"}[t]||t}function ba(t){return["VND"].includes(t)?"suffix":"prefix"}function pa(t){return{JPY:0,VND:0,KRW:0,USD:2,EUR:2,GBP:2}[t]??0}function ya({onGenerate:t,isLoading:r,error:s,suggestions:a}){const{t:n}=q("common"),{currency:o}=X(),[i,l]=y.useState(""),[u,c]=y.useState(!1),d=fa(o),g=ba(o),f=pa(o);y.useEffect(()=>{if(a!=null&&a.previous_income&&!u&&!i){const w=a.previous_income/Math.pow(10,f);l(Ke(w,f)),c(!0)}},[a,u,i,f]);const m=w=>{const p=w.target.value.replace(/[^\d.]/g,"");if(p){const k=parseFloat(p);isNaN(k)||l(Ke(k,f))}else l("")},h=w=>{w.preventDefault();const b=ha(i),p=Math.round(b*Math.pow(10,f));p>0&&(t(p),l(""))},x=()=>{a!=null&&a.previous_income&&t(a.previous_income)},j=w=>{const[b,p]=w.split("-");return new Date(parseInt(b),parseInt(p)-1).toLocaleDateString(void 0,{month:"long",year:"numeric"})};return e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.has_previous)&&a.previous_month&&e.jsx(Q,{className:"p-6 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("budget.previousBudgetFound",{month:j(a.previous_month)})}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:n("budget.cloneDescription")}),e.jsx(V,{onClick:x,loading:r,className:"w-full sm:w-auto",children:n("budget.clonePreviousMonth")})]})]})}),(a==null?void 0:a.has_previous)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:n("budget.orCreateNew")})})]}),e.jsxs(Q,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("budget.generateTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:n("budget.generateDescription")}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("budget.monthlyIncome")}),e.jsxs("div",{className:"relative",children:[g==="prefix"&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:d})}),e.jsx(Ie,{type:"text",inputMode:"decimal",value:i,onChange:m,placeholder:Ke(5e5,f),required:!0,disabled:r,className:g==="prefix"?"pl-8":"pr-10"}),g==="suffix"&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:d})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[n("budget.incomeHint"),(a==null?void 0:a.previous_income)&&e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400",children:["(",n("budget.previousIncome"),": ",d,Ke(a.previous_income/Math.pow(10,f),f),")"]})]})]}),e.jsx(V,{type:"submit",loading:r,disabled:!i,className:"w-full",children:n("budget.generateButton")}),s&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:n("budget.generateError")})]})]})]})}function va({copyPreview:t,isCopyPreviewLoading:r,suggestions:s,selectedMonth:a,formatCurrency:n,formatMonth:o,onCopy:i,onGenerate:l,onStartEmpty:u,isCopyLoading:c,isGenerateLoading:d,generateError:g}){const{t:f}=q("common"),[m,h]=y.useState("choose");if(r)return e.jsx(Q,{className:"p-8 flex items-center justify-center",children:e.jsx(zt,{})});if(m==="generate")return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>h("choose"),className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors p-1 -ml-1",children:[e.jsx(vt,{className:"w-4 h-4"}),f("common.back")]}),e.jsx(ya,{onGenerate:l,isLoading:d,error:g,suggestions:s})]});if(m==="copy"&&t)return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>h("choose"),className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors p-1 -ml-1",children:[e.jsx(vt,{className:"w-4 h-4"}),f("common.back")]}),e.jsxs(Q,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:f("budget.copyFromPrevious",{month:o(t.source_budget.month)})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:f("budget.wizard.copyDescription")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:f("budget.totalBudgeted")}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:n(t.spending_summary.reduce((p,k)=>p+k.budgeted,0))})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:f("budget.categories")}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:t.spending_summary.length})]})]}),e.jsxs(V,{onClick:i,loading:c,className:"w-full",children:[e.jsx(At,{className:"w-4 h-4 mr-2"}),f("budget.copyAndEdit")]})]})]});const j=[...!!t?[{id:"copy",icon:At,title:f("budget.wizard.copyTitle"),description:f("budget.wizard.copyHint",{month:o(t.source_budget.month)}),accent:"blue"}]:[],{id:"generate",icon:or,title:f("budget.wizard.aiTitle"),description:f("budget.wizard.aiHint"),accent:"purple"},{id:"empty",icon:ir,title:f("budget.wizard.emptyTitle"),description:f("budget.wizard.emptyHint"),accent:"gray"}],w={blue:"border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700",purple:"border-purple-200 dark:border-purple-800 bg-purple-50/50 dark:bg-purple-900/20 hover:border-purple-300 dark:hover:border-purple-700",gray:"border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 hover:border-gray-300 dark:hover:border-gray-600"},b={blue:"bg-blue-100 dark:bg-blue-800 text-blue-600 dark:text-blue-300",purple:"bg-purple-100 dark:bg-purple-800 text-purple-600 dark:text-purple-300",gray:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:f("budget.wizard.title",{month:o(a)})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:f("budget.wizard.subtitle")})]}),e.jsx("div",{className:"space-y-3",children:j.map(p=>{const k=p.icon;return e.jsxs("button",{onClick:()=>{p.id==="empty"?u():h(p.id)},className:v("w-full flex items-start gap-4 p-4 rounded-xl border-2 transition-all text-left","focus:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2","active:scale-[0.98]",w[p.accent]),children:[e.jsx("div",{className:v("p-2.5 rounded-xl flex-shrink-0",b[p.accent]),children:e.jsx(k,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:p.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:p.description})]})]},p.id)})})]})}function ja({onSubmit:t,onCancel:r,isLoading:s}){const{t:a}=q("common"),[n,o]=y.useState(""),i=l=>{l.preventDefault(),n.trim()&&(t(n.trim()),o(""))};return e.jsxs(Q,{className:"p-6 border-blue-200 bg-blue-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:a("budget.feedbackTitle")}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsx("textarea",{value:n,onChange:l=>o(l.target.value),placeholder:a("budget.feedbackPlaceholder"),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 min-h-[100px]",disabled:s,required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{type:"submit",disabled:s||!n.trim(),children:a(s?"budget.regenerating":"budget.submitFeedback")}),e.jsx(V,{type:"button",variant:"outline",onClick:r,children:a("cancel")})]})]})]})}function Na({budget:t,onClose:r,onAdd:s}){const{t:a}=q("common"),{data:n}=bt(),o=hr(),[i,l]=y.useState(null),[u,c]=y.useState(""),[d,g]=y.useState(""),[f,m]=y.useState(!1),[h,x]=y.useState(""),[j,w]=y.useState("ðŸ“"),b=y.useMemo(()=>new Set(t.allocations.map(A=>A.category)),[t.allocations]),p=y.useMemo(()=>{const A=t.allocations.reduce((E,O)=>E+O.amount,0);return t.monthly_income-(t.savings_target||0)-A},[t]),k=(n==null?void 0:n.expense)||[],_=A=>{A.children.filter(O=>!b.has(O.name)).length===0&&!b.has(A.name)?c(A.name):l(A),m(!1)},z=A=>{c(A.name)},$=()=>{l(null),c(""),m(!1)},N=async()=>{!i||!h.trim()||(await o.mutateAsync({name:h.trim(),icon:j,parent_id:i.id,type:"expense"}),c(h.trim()),x(""),m(!1))},T=A=>{A.preventDefault(),!(!u||parseInt(d)<=0)&&s(u,parseInt(d))},C=Math.floor(p/3);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(Q,{className:"w-full max-w-md animate-in fade-in zoom-in duration-200 max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a("budget.addCategory")}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:T,className:"p-4 space-y-4 overflow-y-auto flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a("budget.category")}),u?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[e.jsx("span",{className:"flex-1 font-medium text-blue-700 dark:text-blue-300",children:u}),e.jsx("button",{type:"button",onClick:()=>{c(""),l(null)},className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",children:a("change","Change")})]}):i?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:$,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(xt,{className:"w-4 h-4"}),i.icon," ",i.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[i.children.map(A=>{const E=b.has(A.name);return e.jsxs("button",{type:"button",onClick:()=>!E&&z(A),disabled:E,className:v("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",E?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:A.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:A.name}),E&&e.jsx("span",{className:"text-[10px] text-gray-400",children:a("budget.alreadyAdded","Added")})]},A.id)}),e.jsxs("button",{type:"button",onClick:()=>m(!0),className:v("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(ve,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("category.addCustom","Add")})]})]}),f&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ie,{value:j,onChange:A=>w(A.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(Ie,{value:h,onChange:A=>x(A.target.value),placeholder:a("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(V,{type:"button",variant:"outline",size:"sm",onClick:()=>m(!1),children:a("cancel","Cancel")}),e.jsx(V,{type:"button",size:"sm",onClick:N,disabled:!h.trim()||o.isPending,children:a("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:k.map(A=>{const E=A.children.filter(P=>!b.has(P.name)),O=E.length===0&&b.has(A.name);return e.jsxs("button",{type:"button",onClick:()=>!O&&_(A),disabled:O,className:v("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",O?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:A.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:A.name}),E.length>0&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:[E.length," ",a("budget.available","available")]})]},A.id)})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a("budget.amount")}),e.jsx(Ie,{type:"number",value:d,onChange:A=>g(A.target.value),placeholder:et(0),min:1,autoFocus:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a("budget.remainingBudget"),": ",et(p)]})]}),C>0&&e.jsx("button",{type:"button",onClick:()=>g(String(C)),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:a("budget.suggestAmount",{amount:et(C)})})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(V,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:a("cancel")}),e.jsxs(V,{type:"submit",disabled:!u||parseInt(d)<=0,className:"flex-1",children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),a("budget.add")]})]})]})]})})}function wa({isOpen:t,onConfirm:r,onCancel:s,monthlyIncome:a,totalAllocated:n,savingsTarget:o,categoryCount:i,isLoading:l=!1}){const{t:u}=q("common"),{currency:c}=X(),{isPrivacyMode:d}=te(),{data:g}=re(),f=x=>Z(x,c,(g==null?void 0:g.rates)||{},!1,d);if(!t)return null;const m=a-n-o,h=m<0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:v("fixed z-50 bg-white dark:bg-gray-800 shadow-xl","inset-x-0 bottom-0 rounded-t-2xl","lg:inset-auto lg:left-1/2 lg:top-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2","lg:rounded-xl lg:max-w-md lg:w-full"),role:"dialog","aria-modal":"true","aria-labelledby":"confirm-dialog-title",children:[e.jsx("div",{className:"lg:hidden flex justify-center pt-3 pb-1",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("h2",{id:"confirm-dialog-title",className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:u("budget.confirmDialog.title")}),e.jsx("button",{onClick:s,className:"p-2 -mr-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":u("button.close"),children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u("budget.monthlyIncome")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:f(a)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u("budget.totalAllocated")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:f(n)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u("budget.savingsTarget")}),e.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400",children:f(o)})]}),e.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u(h?"budget.overAllocated":"budget.confirmDialog.unallocated")}),e.jsx("span",{className:v("font-semibold",h?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"),children:h?`-${f(Math.abs(m))}`:f(m)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(Te,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:u("budget.confirmDialog.categoriesConfigured",{count:i})})]}),h&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-400",children:u("budget.confirmDialog.overAllocatedWarning")})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(V,{variant:"outline",onClick:s,className:"flex-1",disabled:l,children:u("button.cancel")}),e.jsx(V,{onClick:r,className:"flex-1",disabled:l,children:u(l?"budget.saving":"budget.save")})]})]})]})}const Se=[{id:"overview",labelKey:"budget.tabs.overview",icon:la},{id:"categories",labelKey:"budget.tabs.categories",icon:da},{id:"transactions",labelKey:"budget.tabs.transactions",icon:lr},{id:"forecast",labelKey:"budget.tabs.forecast",icon:je}];function ka({activeTab:t,onTabChange:r,children:s,className:a,alertTabs:n=[]}){const{t:o}=q("common"),i=y.useRef(null),l=y.useRef(null);y.useEffect(()=>{if(l.current&&i.current){const c=i.current,d=l.current,g=d.offsetLeft-c.offsetWidth/2+d.offsetWidth/2;c.scrollTo({left:g,behavior:"smooth"})}},[t]);const u=(c,d)=>{let g=d;c.key==="ArrowLeft"?(c.preventDefault(),g=d>0?d-1:Se.length-1):c.key==="ArrowRight"?(c.preventDefault(),g=d<Se.length-1?d+1:0):c.key==="Home"?(c.preventDefault(),g=0):c.key==="End"&&(c.preventDefault(),g=Se.length-1),g!==d&&r(Se[g].id)};return e.jsxs("div",{className:v("flex flex-col",a),children:[e.jsx("div",{className:"hidden md:flex items-center gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg mb-4",role:"tablist","aria-label":o("budget.tabs.navigation"),children:Se.map((c,d)=>{const g=c.icon,f=t===c.id,m=n.includes(c.id);return e.jsxs("button",{role:"tab","aria-selected":f,"aria-controls":`tabpanel-${c.id}`,tabIndex:f?0:-1,onClick:()=>r(c.id),onKeyDown:h=>u(h,d),className:v("relative flex items-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-all","focus:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2",f?"bg-white dark:bg-gray-900 text-green-600 dark:text-green-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"),children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:o(c.labelKey)}),m&&e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]},c.id)})}),e.jsx("div",{ref:i,className:"md:hidden flex gap-2 overflow-x-auto scrollbar-hide pb-1 mb-4 -mx-1 px-1",role:"tablist","aria-label":o("budget.tabs.navigation"),children:Se.map((c,d)=>{const g=c.icon,f=t===c.id,m=n.includes(c.id);return e.jsxs("button",{ref:f?l:void 0,role:"tab","aria-selected":f,"aria-controls":`tabpanel-${c.id}`,tabIndex:f?0:-1,onClick:()=>r(c.id),onKeyDown:h=>u(h,d),className:v("relative flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium whitespace-nowrap transition-all flex-shrink-0","focus:outline-none focus-visible:ring-2 focus-visible:ring-green-500","min-h-[44px]",f?"bg-green-600 text-white shadow-sm":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"),children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:o(c.labelKey)}),m&&e.jsx("span",{className:v("absolute top-1 right-1 w-2 h-2 rounded-full",f?"bg-white":"bg-red-500")})]},c.id)})}),e.jsx("div",{id:`tabpanel-${t}`,role:"tabpanel","aria-labelledby":`tab-${t}`,tabIndex:0,children:s})]})}function Sa({versions:t,currentVersion:r,formatCurrency:s,onRestore:a,isRestoring:n}){const{t:o}=q("common"),[i,l]=y.useState(!1);if(t.length<=1)return null;const u=c=>new Date(c).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>l(!i),className:v("flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-colors","text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800",i&&"bg-gray-100 dark:bg-gray-800"),children:[e.jsx(oa,{className:"w-4 h-4"}),e.jsxs("span",{children:["v",r]}),e.jsx(fr,{className:v("w-3.5 h-3.5 transition-transform",i&&"rotate-180")})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>l(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:o("budget.versionHistory")})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.map(c=>e.jsxs("div",{className:v("px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700/50",c.is_active&&"bg-blue-50 dark:bg-blue-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-sm",children:["v",c.version]}),c.is_active&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(ht,{className:"w-3 h-3"}),o("budget.current")]}),c.copied_from_id&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",o("budget.copied"),")"]})]}),!c.is_active&&e.jsxs("button",{onClick:()=>{a(c.id),l(!1)},disabled:n,className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",children:[e.jsx(br,{className:"w-3 h-3"}),o("budget.restore")]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:u(c.created_at)}),e.jsx("span",{className:"mx-1",children:"Â·"}),e.jsx("span",{children:s(c.total_allocated)})]})]},c.id))})]})]})]})}function Aa({totalBudget:t,totalSpent:r,totalAllocated:s,month:a,className:n}){const{t:o}=q("common"),{currency:i}=X(),{isPrivacyMode:l}=te(),{data:u}=re(),c=k=>Z(k,i,(u==null?void 0:u.rates)||{},!0,l),d=k=>Z(k,i,(u==null?void 0:u.rates)||{},!1,l),g=t-r,f=s>0?r/s*100:0,m=t>0?Math.max(0,g/t*100):0,{daysRemaining:h,dailyRate:x,safeDaily:j,status:w}=y.useMemo(()=>{const[k,_]=a.split("-").map(Number),z=new Date(k,_,0).getDate(),$=new Date().getDate(),N=Math.max(1,$),T=Math.max(0,z-$),C=r/N,A=t-r,E=T>0?A/T:0,O=r+C*T,P=t>0?O/t*100:0;let F="good";return P>100?F="danger":P>90&&(F="warning"),{daysRemaining:T,dailyRate:C,safeDaily:E,status:F}},[a,r,t]),b=y.useMemo(()=>r>s?{label:o("budget.health.overBudgetStatus"),status:"danger",color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/30",ring:"ring-red-200 dark:ring-red-800"}:f>95?{label:o("budget.health.almostFull"),status:"warning",color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-50 dark:bg-amber-900/30",ring:"ring-amber-200 dark:ring-amber-800"}:f>85?{label:o("budget.health.warningNearLimit"),status:"caution",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/30",ring:"ring-yellow-200 dark:ring-yellow-800"}:{label:o("budget.health.onTrack"),status:"good",color:"text-green-600 dark:text-green-400",bg:"bg-green-50 dark:bg-green-900/30",ring:"ring-green-200 dark:ring-green-800"},[r,s,f,o]),p=x>j&&j>0;return e.jsxs("div",{className:v("rounded-2xl ring-1 overflow-hidden",b.bg,b.ring,n),children:[e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium opacity-60 uppercase tracking-wider",children:o("budget.availableToSpend")}),e.jsxs("div",{className:v("flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold",b.status==="danger"?"bg-red-500 text-white":b.status==="warning"?"bg-amber-500 text-white":b.status==="caution"?"bg-yellow-500 text-gray-900":"bg-green-500 text-white"),children:[b.status==="danger"?e.jsx(le,{className:"w-3.5 h-3.5"}):e.jsx(je,{className:"w-3.5 h-3.5"}),b.label]})]}),e.jsxs("p",{className:v("text-4xl font-extrabold tracking-tight",g<0?"text-red-600 dark:text-red-400":b.color),children:[g<0&&"âˆ’",c(Math.abs(g))]}),e.jsx("div",{className:"mt-3 h-2.5 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:v("h-full rounded-full transition-all duration-700 ease-out",g<0?"bg-red-500":m<20?"bg-amber-500":m<40?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,Math.max(0,m))}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs opacity-70 mt-1.5",children:[e.jsxs("span",{children:[d(r)," ",o("budget.spent")]}),e.jsx("span",{children:o("budget.ofTotalBudget",{total:d(t)})})]})]}),e.jsxs("div",{className:"px-4 py-3 bg-black/5 dark:bg-white/5 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:o("budget.projection.currentPace")}),e.jsxs("p",{className:v("text-lg font-bold leading-tight",p?"text-amber-600 dark:text-amber-400":""),children:[d(x),e.jsx("span",{className:"text-[10px] font-normal opacity-50",children:o("budget.pulse.perDay")})]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:o("budget.projection.safePace")}),e.jsxs("p",{className:"text-lg font-bold leading-tight text-green-600 dark:text-green-400",children:[j>0?d(j):"â€”",j>0&&e.jsx("span",{className:"text-[10px] font-normal opacity-50",children:o("budget.pulse.perDay")})]})]}),e.jsxs("div",{className:"min-w-0 text-right",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:o("budget.daysLeft")}),e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(cr,{className:"w-3.5 h-3.5 opacity-50"}),e.jsx("p",{className:"text-lg font-bold leading-tight",children:h})]})]})]})]})}function Ca({income:t,allocated:r,savings:s,formatCurrency:a,className:n}){const{t:o}=q("common"),i=t>0?Math.min(100,r/t*100):0,l=t>0?Math.min(100,s/t*100):0,u=Math.max(0,100-i-l);return e.jsxs("div",{className:v("rounded-xl bg-gray-50 dark:bg-gray-800/50 p-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(tt,{label:o("budget.flow.income"),value:a(t),color:"text-green-600 dark:text-green-400"}),e.jsx(it,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0 mx-1"}),e.jsx(tt,{label:o("budget.flow.allocated"),value:a(r),color:"text-blue-600 dark:text-blue-400"}),e.jsx(it,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0 mx-1"}),e.jsx(tt,{label:o("budget.flow.saved"),value:a(s),color:"text-pink-600 dark:text-pink-400"})]}),e.jsxs("div",{className:"h-3 rounded-full overflow-hidden flex bg-gray-200 dark:bg-gray-700",children:[i>0&&e.jsx("div",{className:"bg-blue-500 transition-all duration-500",style:{width:`${i}%`},title:`${o("budget.flow.allocated")}: ${Math.round(i)}%`}),l>0&&e.jsx("div",{className:"bg-pink-500 transition-all duration-500",style:{width:`${l}%`},title:`${o("budget.flow.saved")}: ${Math.round(l)}%`}),u>0&&e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 transition-all duration-500",style:{width:`${u}%`}})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-[10px] text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),Math.round(i),"% ",o("budget.flow.allocated").toLowerCase()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-pink-500"}),Math.round(l),"% ",o("budget.flow.saved").toLowerCase()]}),u>1&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600"}),Math.round(u),"% ",o("budget.flow.unallocated").toLowerCase()]})]})]})}function tt({label:t,value:r,color:s}){return e.jsxs("div",{className:"text-center min-w-0 flex-1",children:[e.jsx("p",{className:"text-[10px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate",children:t}),e.jsx("p",{className:v("text-sm font-bold truncate",s),children:r})]})}var Pa=["points","className","baseLinePoints","connectNulls"];function _e(){return _e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},_e.apply(this,arguments)}function _a(t,r){if(t==null)return{};var s=Ma(t,r),a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],!(r.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function Ma(t,r){if(t==null)return{};var s={};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){if(r.indexOf(a)>=0)continue;s[a]=t[a]}return s}function Ct(t){return Ea(t)||Da(t)||Ta(t)||Oa()}function Oa(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ta(t,r){if(t){if(typeof t=="string")return dt(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return dt(t,r)}}function Da(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ea(t){if(Array.isArray(t))return dt(t)}function dt(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}var Pt=function(r){return r&&r.x===+r.x&&r.y===+r.y},$a=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=[[]];return r.forEach(function(a){Pt(a)?s[s.length-1].push(a):s[s.length-1].length>0&&s.push([])}),Pt(r[0])&&s[s.length-1].push(r[0]),s[s.length-1].length<=0&&(s=s.slice(0,-1)),s},Re=function(r,s){var a=$a(r);s&&(a=[a.reduce(function(o,i){return[].concat(Ct(o),Ct(i))},[])]);var n=a.map(function(o){return o.reduce(function(i,l,u){return"".concat(i).concat(u===0?"M":"L").concat(l.x,",").concat(l.y)},"")}).join("");return a.length===1?"".concat(n,"Z"):n},La=function(r,s,a){var n=Re(r,a);return"".concat(n.slice(-1)==="Z"?n.slice(0,-1):n,"L").concat(Re(s.reverse(),a).slice(1))},Ra=function(r){var s=r.points,a=r.className,n=r.baseLinePoints,o=r.connectNulls,i=_a(r,Pa);if(!s||!s.length)return null;var l=ge("recharts-polygon",a);if(n&&n.length){var u=i.stroke&&i.stroke!=="none",c=La(s,n,o);return R.createElement("g",{className:l},R.createElement("path",_e({},G(i,!0),{fill:c.slice(-1)==="Z"?i.fill:"none",stroke:"none",d:c})),u?R.createElement("path",_e({},G(i,!0),{fill:"none",d:Re(s,o)})):null,u?R.createElement("path",_e({},G(i,!0),{fill:"none",d:Re(n,o)})):null)}var d=Re(s,o);return R.createElement("path",_e({},G(i,!0),{fill:d.slice(-1)==="Z"?i.fill:"none",className:l,d}))},Ba=Ut,Fa=Pr,za=Wt;function Ka(t,r){return t&&t.length?Ba(t,za(r),Fa):void 0}var Ia=Ka;const Va=Kt(Ia);var qa=Ut,Ua=Wt,Wa=_r;function Ha(t,r){return t&&t.length?qa(t,Ua(r),Wa):void 0}var Ga=Ha;const Ja=Kt(Ga);var Qa=["cx","cy","angle","ticks","axisLine"],Ya=["ticks","tick","angle","tickFormatter","stroke"];function De(t){"@babel/helpers - typeof";return De=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},De(t)}function Be(){return Be=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},Be.apply(this,arguments)}function _t(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function fe(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?_t(Object(s),!0).forEach(function(a){Ge(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_t(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Mt(t,r){if(t==null)return{};var s=Za(t,r),a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],!(r.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function Za(t,r){if(t==null)return{};var s={};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){if(r.indexOf(a)>=0)continue;s[a]=t[a]}return s}function Xa(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Ot(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,Yt(a.key),a)}}function es(t,r,s){return r&&Ot(t.prototype,r),s&&Ot(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function ts(t,r,s){return r=Ue(r),rs(t,Qt()?Reflect.construct(r,s||[],Ue(t).constructor):r.apply(t,s))}function rs(t,r){if(r&&(De(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return as(t)}function as(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Qt=function(){return!!t})()}function Ue(t){return Ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Ue(t)}function ss(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&ut(t,r)}function ut(t,r){return ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},ut(t,r)}function Ge(t,r,s){return r=Yt(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Yt(t){var r=ns(t,"string");return De(r)=="symbol"?r:r+""}function ns(t,r){if(De(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(De(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Je=function(t){function r(){return Xa(this,r),ts(this,r,arguments)}return ss(r,t),es(r,[{key:"getTickValueCoord",value:function(a){var n=a.coordinate,o=this.props,i=o.angle,l=o.cx,u=o.cy;return ie(l,u,n,i)}},{key:"getTickTextAnchor",value:function(){var a=this.props.orientation,n;switch(a){case"left":n="end";break;case"right":n="start";break;default:n="middle";break}return n}},{key:"getViewBox",value:function(){var a=this.props,n=a.cx,o=a.cy,i=a.angle,l=a.ticks,u=Va(l,function(d){return d.coordinate||0}),c=Ja(l,function(d){return d.coordinate||0});return{cx:n,cy:o,startAngle:i,endAngle:i,innerRadius:c.coordinate||0,outerRadius:u.coordinate||0}}},{key:"renderAxisLine",value:function(){var a=this.props,n=a.cx,o=a.cy,i=a.angle,l=a.ticks,u=a.axisLine,c=Mt(a,Qa),d=l.reduce(function(h,x){return[Math.min(h[0],x.coordinate),Math.max(h[1],x.coordinate)]},[1/0,-1/0]),g=ie(n,o,d[0],i),f=ie(n,o,d[1],i),m=fe(fe(fe({},G(c,!1)),{},{fill:"none"},G(u,!1)),{},{x1:g.x,y1:g.y,x2:f.x,y2:f.y});return R.createElement("line",Be({className:"recharts-polar-radius-axis-line"},m))}},{key:"renderTicks",value:function(){var a=this,n=this.props,o=n.ticks,i=n.tick,l=n.angle,u=n.tickFormatter,c=n.stroke,d=Mt(n,Ya),g=this.getTickTextAnchor(),f=G(d,!1),m=G(i,!1),h=o.map(function(x,j){var w=a.getTickValueCoord(x),b=fe(fe(fe(fe({textAnchor:g,transform:"rotate(".concat(90-l,", ").concat(w.x,", ").concat(w.y,")")},f),{},{stroke:"none",fill:c},m),{},{index:j},w),{},{payload:x});return R.createElement(se,Be({className:ge("recharts-polar-radius-axis-tick",Ht(i)),key:"tick-".concat(x.coordinate)},yt(a.props,x,j)),r.renderTickItem(i,b,u?u(x.value,j):x.value))});return R.createElement(se,{className:"recharts-polar-radius-axis-ticks"},h)}},{key:"render",value:function(){var a=this.props,n=a.ticks,o=a.axisLine,i=a.tick;return!n||!n.length?null:R.createElement(se,{className:ge("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),i&&this.renderTicks(),Gt.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(a,n,o){var i;return R.isValidElement(a)?i=R.cloneElement(a,n):pe(a)?i=a(n):i=R.createElement(pt,Be({},n,{className:"recharts-polar-radius-axis-tick-value"}),o),i}}])}(y.PureComponent);Ge(Je,"displayName","PolarRadiusAxis");Ge(Je,"axisType","radiusAxis");Ge(Je,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Ee(t){"@babel/helpers - typeof";return Ee=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ee(t)}function ye(){return ye=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},ye.apply(this,arguments)}function Tt(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function be(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Tt(Object(s),!0).forEach(function(a){Qe(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Tt(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function os(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Dt(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,Xt(a.key),a)}}function is(t,r,s){return r&&Dt(t.prototype,r),s&&Dt(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function ls(t,r,s){return r=We(r),cs(t,Zt()?Reflect.construct(r,s||[],We(t).constructor):r.apply(t,s))}function cs(t,r){if(r&&(Ee(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ds(t)}function ds(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Zt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zt=function(){return!!t})()}function We(t){return We=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},We(t)}function us(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&mt(t,r)}function mt(t,r){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},mt(t,r)}function Qe(t,r,s){return r=Xt(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Xt(t){var r=ms(t,"string");return Ee(r)=="symbol"?r:r+""}function ms(t,r){if(Ee(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(Ee(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var gs=Math.PI/180,Et=1e-5,Ye=function(t){function r(){return os(this,r),ls(this,r,arguments)}return us(r,t),is(r,[{key:"getTickLineCoord",value:function(a){var n=this.props,o=n.cx,i=n.cy,l=n.radius,u=n.orientation,c=n.tickSize,d=c||8,g=ie(o,i,l,a.coordinate),f=ie(o,i,l+(u==="inner"?-1:1)*d,a.coordinate);return{x1:g.x,y1:g.y,x2:f.x,y2:f.y}}},{key:"getTickTextAnchor",value:function(a){var n=this.props.orientation,o=Math.cos(-a.coordinate*gs),i;return o>Et?i=n==="outer"?"start":"end":o<-Et?i=n==="outer"?"end":"start":i="middle",i}},{key:"renderAxisLine",value:function(){var a=this.props,n=a.cx,o=a.cy,i=a.radius,l=a.axisLine,u=a.axisLineType,c=be(be({},G(this.props,!1)),{},{fill:"none"},G(l,!1));if(u==="circle")return R.createElement(Mr,ye({className:"recharts-polar-angle-axis-line"},c,{cx:n,cy:o,r:i}));var d=this.props.ticks,g=d.map(function(f){return ie(n,o,i,f.coordinate)});return R.createElement(Ra,ye({className:"recharts-polar-angle-axis-line"},c,{points:g}))}},{key:"renderTicks",value:function(){var a=this,n=this.props,o=n.ticks,i=n.tick,l=n.tickLine,u=n.tickFormatter,c=n.stroke,d=G(this.props,!1),g=G(i,!1),f=be(be({},d),{},{fill:"none"},G(l,!1)),m=o.map(function(h,x){var j=a.getTickLineCoord(h),w=a.getTickTextAnchor(h),b=be(be(be({textAnchor:w},d),{},{stroke:"none",fill:c},g),{},{index:x,payload:h,x:j.x2,y:j.y2});return R.createElement(se,ye({className:ge("recharts-polar-angle-axis-tick",Ht(i)),key:"tick-".concat(h.coordinate)},yt(a.props,h,x)),l&&R.createElement("line",ye({className:"recharts-polar-angle-axis-tick-line"},f,j)),i&&r.renderTickItem(i,b,u?u(h.value,x):h.value))});return R.createElement(se,{className:"recharts-polar-angle-axis-ticks"},m)}},{key:"render",value:function(){var a=this.props,n=a.ticks,o=a.radius,i=a.axisLine;return o<=0||!n||!n.length?null:R.createElement(se,{className:ge("recharts-polar-angle-axis",this.props.className)},i&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(a,n,o){var i;return R.isValidElement(a)?i=R.cloneElement(a,n):pe(a)?i=a(n):i=R.createElement(pt,ye({},n,{className:"recharts-polar-angle-axis-tick-value"}),o),i}}])}(y.PureComponent);Qe(Ye,"displayName","PolarAngleAxis");Qe(Ye,"axisType","angleAxis");Qe(Ye,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var qe;function $e(t){"@babel/helpers - typeof";return $e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},$e(t)}function Me(){return Me=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},Me.apply(this,arguments)}function $t(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function I(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$t(Object(s),!0).forEach(function(a){ae(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$t(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function xs(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Lt(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,tr(a.key),a)}}function hs(t,r,s){return r&&Lt(t.prototype,r),s&&Lt(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function fs(t,r,s){return r=He(r),bs(t,er()?Reflect.construct(r,s||[],He(t).constructor):r.apply(t,s))}function bs(t,r){if(r&&($e(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ps(t)}function ps(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function er(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(er=function(){return!!t})()}function He(t){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},He(t)}function ys(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&gt(t,r)}function gt(t,r){return gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},gt(t,r)}function ae(t,r,s){return r=tr(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function tr(t){var r=vs(t,"string");return $e(r)=="symbol"?r:r+""}function vs(t,r){if($e(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if($e(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ce=function(t){function r(s){var a;return xs(this,r),a=fs(this,r,[s]),ae(a,"pieRef",null),ae(a,"sectorRefs",[]),ae(a,"id",Rr("recharts-pie-")),ae(a,"handleAnimationEnd",function(){var n=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),pe(n)&&n()}),ae(a,"handleAnimationStart",function(){var n=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),pe(n)&&n()}),a.state={isAnimationFinished:!s.isAnimationActive,prevIsAnimationActive:s.isAnimationActive,prevAnimationId:s.animationId,sectorToFocus:0},a}return ys(r,t),hs(r,[{key:"isActiveIndex",value:function(a){var n=this.props.activeIndex;return Array.isArray(n)?n.indexOf(a)!==-1:a===n}},{key:"hasActiveIndex",value:function(){var a=this.props.activeIndex;return Array.isArray(a)?a.length!==0:a||a===0}},{key:"renderLabels",value:function(a){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.label,l=o.labelLine,u=o.dataKey,c=o.valueKey,d=G(this.props,!1),g=G(i,!1),f=G(l,!1),m=i&&i.offsetRadius||20,h=a.map(function(x,j){var w=(x.startAngle+x.endAngle)/2,b=ie(x.cx,x.cy,x.outerRadius+m,w),p=I(I(I(I({},d),x),{},{stroke:"none"},g),{},{index:j,textAnchor:r.getTextAnchor(b.x,x.cx)},b),k=I(I(I(I({},d),x),{},{fill:"none",stroke:x.fill},f),{},{index:j,points:[ie(x.cx,x.cy,x.outerRadius,w),b]}),_=u;return Oe(u)&&Oe(c)?_="value":Oe(u)&&(_=c),R.createElement(se,{key:"label-".concat(x.startAngle,"-").concat(x.endAngle,"-").concat(x.midAngle,"-").concat(j)},l&&r.renderLabelLineItem(l,k,"line"),r.renderLabelItem(i,p,Ae(x,_)))});return R.createElement(se,{className:"recharts-pie-labels"},h)}},{key:"renderSectorsStatically",value:function(a){var n=this,o=this.props,i=o.activeShape,l=o.blendStroke,u=o.inactiveShape;return a.map(function(c,d){if((c==null?void 0:c.startAngle)===0&&(c==null?void 0:c.endAngle)===0&&a.length!==1)return null;var g=n.isActiveIndex(d),f=u&&n.hasActiveIndex()?u:null,m=g?i:f,h=I(I({},c),{},{stroke:l?c.fill:c.stroke,tabIndex:-1});return R.createElement(se,Me({ref:function(j){j&&!n.sectorRefs.includes(j)&&n.sectorRefs.push(j)},tabIndex:-1,className:"recharts-pie-sector"},yt(n.props,c,d),{key:"sector-".concat(c==null?void 0:c.startAngle,"-").concat(c==null?void 0:c.endAngle,"-").concat(c.midAngle,"-").concat(d)}),R.createElement(Tr,Me({option:m,isActive:g,shapeType:"sector"},h)))})}},{key:"renderSectorsWithAnimation",value:function(){var a=this,n=this.props,o=n.sectors,i=n.isAnimationActive,l=n.animationBegin,u=n.animationDuration,c=n.animationEasing,d=n.animationId,g=this.state,f=g.prevSectors,m=g.prevIsAnimationActive;return R.createElement(Dr,{begin:l,duration:u,isActive:i,easing:c,from:{t:0},to:{t:1},key:"pie-".concat(d,"-").concat(m),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(h){var x=h.t,j=[],w=o&&o[0],b=w.startAngle;return o.forEach(function(p,k){var _=f&&f[k],z=k>0?Er(p,"paddingAngle",0):0;if(_){var $=kt(_.endAngle-_.startAngle,p.endAngle-p.startAngle),N=I(I({},p),{},{startAngle:b+z,endAngle:b+$(x)+z});j.push(N),b=N.endAngle}else{var T=p.endAngle,C=p.startAngle,A=kt(0,T-C),E=A(x),O=I(I({},p),{},{startAngle:b+z,endAngle:b+E+z});j.push(O),b=O.endAngle}}),R.createElement(se,null,a.renderSectorsStatically(j))})}},{key:"attachKeyboardHandlers",value:function(a){var n=this;a.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var i=++n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[i].focus(),n.setState({sectorToFocus:i});break}case"ArrowRight":{var l=--n.state.sectorToFocus<0?n.sectorRefs.length-1:n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[l].focus(),n.setState({sectorToFocus:l});break}case"Escape":{n.sectorRefs[n.state.sectorToFocus].blur(),n.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var a=this.props,n=a.sectors,o=a.isAnimationActive,i=this.state.prevSectors;return o&&n&&n.length&&(!i||!$r(i,n))?this.renderSectorsWithAnimation():this.renderSectorsStatically(n)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var a=this,n=this.props,o=n.hide,i=n.sectors,l=n.className,u=n.label,c=n.cx,d=n.cy,g=n.innerRadius,f=n.outerRadius,m=n.isAnimationActive,h=this.state.isAnimationFinished;if(o||!i||!i.length||!Pe(c)||!Pe(d)||!Pe(g)||!Pe(f))return null;var x=ge("recharts-pie",l);return R.createElement(se,{tabIndex:this.props.rootTabIndex,className:x,ref:function(w){a.pieRef=w}},this.renderSectors(),u&&this.renderLabels(i),Gt.renderCallByParent(this.props,null,!1),(!m||h)&&Lr.renderCallByParent(this.props,i,!1))}}],[{key:"getDerivedStateFromProps",value:function(a,n){return n.prevIsAnimationActive!==a.isAnimationActive?{prevIsAnimationActive:a.isAnimationActive,prevAnimationId:a.animationId,curSectors:a.sectors,prevSectors:[],isAnimationFinished:!0}:a.isAnimationActive&&a.animationId!==n.prevAnimationId?{prevAnimationId:a.animationId,curSectors:a.sectors,prevSectors:n.curSectors,isAnimationFinished:!0}:a.sectors!==n.curSectors?{curSectors:a.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(a,n){return a>n?"start":a<n?"end":"middle"}},{key:"renderLabelLineItem",value:function(a,n,o){if(R.isValidElement(a))return R.cloneElement(a,n);if(pe(a))return a(n);var i=ge("recharts-pie-label-line",typeof a!="boolean"?a.className:"");return R.createElement(Or,Me({},n,{key:o,type:"linear",className:i}))}},{key:"renderLabelItem",value:function(a,n,o){if(R.isValidElement(a))return R.cloneElement(a,n);var i=o;if(pe(a)&&(i=a(n),R.isValidElement(i)))return i;var l=ge("recharts-pie-label-text",typeof a!="boolean"&&!pe(a)?a.className:"");return R.createElement(pt,Me({},n,{alignmentBaseline:"middle",className:l}),i)}}])}(y.PureComponent);qe=ce;ae(ce,"displayName","Pie");ae(ce,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Br.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});ae(ce,"parseDeltaAngle",function(t,r){var s=Ve(r-t),a=Math.min(Math.abs(r-t),360);return s*a});ae(ce,"getRealPieData",function(t){var r=t.data,s=t.children,a=G(t,!1),n=Fr(s,Jt);return r&&r.length?r.map(function(o,i){return I(I(I({payload:o},a),o),n&&n[i]&&n[i].props)}):n&&n.length?n.map(function(o){return I(I({},a),o.props)}):[]});ae(ce,"parseCoordinateOfPie",function(t,r){var s=r.top,a=r.left,n=r.width,o=r.height,i=zr(n,o),l=a+ze(t.cx,n,n/2),u=s+ze(t.cy,o,o/2),c=ze(t.innerRadius,i,0),d=ze(t.outerRadius,i,i*.8),g=t.maxRadius||Math.sqrt(n*n+o*o)/2;return{cx:l,cy:u,innerRadius:c,outerRadius:d,maxRadius:g}});ae(ce,"getComposedData",function(t){var r=t.item,s=t.offset,a=r.type.defaultProps!==void 0?I(I({},r.type.defaultProps),r.props):r.props,n=qe.getRealPieData(a);if(!n||!n.length)return null;var o=a.cornerRadius,i=a.startAngle,l=a.endAngle,u=a.paddingAngle,c=a.dataKey,d=a.nameKey,g=a.valueKey,f=a.tooltipType,m=Math.abs(a.minAngle),h=qe.parseCoordinateOfPie(a,s),x=qe.parseDeltaAngle(i,l),j=Math.abs(x),w=c;Oe(c)&&Oe(g)?(St(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),w="value"):Oe(c)&&(St(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),w=g);var b=n.filter(function(N){return Ae(N,w,0)!==0}).length,p=(j>=360?b:b-1)*u,k=j-b*m-p,_=n.reduce(function(N,T){var C=Ae(T,w,0);return N+(Pe(C)?C:0)},0),z;if(_>0){var $;z=n.map(function(N,T){var C=Ae(N,w,0),A=Ae(N,d,T),E=(Pe(C)?C:0)/_,O;T?O=$.endAngle+Ve(x)*u*(C!==0?1:0):O=i;var P=O+Ve(x)*((C!==0?m:0)+E*k),F=(O+P)/2,B=(h.innerRadius+h.outerRadius)/2,U=[{name:A,value:C,payload:N,dataKey:w,type:f}],Y=ie(h.cx,h.cy,B,F);return $=I(I(I({percent:E,cornerRadius:o,name:A,tooltipPayload:U,midAngle:F,middleRadius:B,tooltipPosition:Y},N),h),{},{value:Ae(N,w),startAngle:O,endAngle:P,payload:N,paddingAngle:Ve(x)*u}),$})}return I(I({},h),{},{sectors:z,data:n})});var js=Kr({chartName:"PieChart",GraphicalChild:ce,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:Ye},{axisType:"radiusAxis",AxisComp:Je}],formatAxisMap:Ir,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const rt=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#6b7280"];function Ns({allocations:t,totalBudget:r,totalAllocated:s,compact:a=!1,className:n}){const{t:o}=q("common"),{currency:i}=X(),{isPrivacyMode:l}=te(),{data:u}=re(),[c,d]=y.useState(null),g=b=>Z(b,i,(u==null?void 0:u.rates)||{},!1,l),f=y.useMemo(()=>{if(!t.length)return[];const b=[...t].sort(($,N)=>N.amount-$.amount),p=b.slice(0,5),_=b.slice(5).reduce(($,N)=>$+N.amount,0),z=p.map(($,N)=>({name:$.category,value:$.amount,percentage:s>0?$.amount/s*100:0,color:rt[N%rt.length]}));return _>0&&z.push({name:o("budget.donutChart.other"),value:_,percentage:s>0?_/s*100:0,color:rt[7]}),z},[t,s,o]),m=r-s,h=b=>{const{cx:p,cy:k,innerRadius:_,outerRadius:z,startAngle:$,endAngle:N,fill:T,payload:C}=b;return e.jsxs("g",{children:[e.jsx(qr,{cx:p,cy:k,innerRadius:_-2,outerRadius:z+4,startAngle:$,endAngle:N,fill:T}),e.jsx("text",{x:p,y:k-6,textAnchor:"middle",className:"fill-gray-500 dark:fill-gray-400 text-[10px]",children:C.name}),e.jsx("text",{x:p,y:k+10,textAnchor:"middle",className:"fill-gray-900 dark:fill-gray-100 text-xs font-bold",children:g(C.value)})]})};if(!t.length)return null;const x=a?120:200,j=a?36:55,w=a?52:80;return e.jsxs("div",{className:v(a?"flex items-center gap-4":"flex flex-col items-center",n),children:[e.jsxs("div",{className:"relative flex-shrink-0",style:{width:x,height:x},children:[e.jsx(Vr,{width:"100%",height:"100%",children:e.jsx(js,{children:e.jsx(ce,{data:f,cx:"50%",cy:"50%",innerRadius:j,outerRadius:w,paddingAngle:2,dataKey:"value",activeIndex:c??void 0,activeShape:c!==null?h:void 0,onMouseEnter:(b,p)=>d(p),onMouseLeave:()=>d(null),children:f.map((b,p)=>e.jsx(Jt,{fill:b.color,className:"cursor-pointer transition-opacity hover:opacity-80"},`cell-${p}`))})})}),c===null&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("span",{className:v("text-gray-500 dark:text-gray-400",a?"text-[9px]":"text-xs"),children:m>=0?o("budget.donutChart.remaining"):o("budget.overAllocated")}),e.jsx("span",{className:v("font-bold",a?"text-xs":"text-lg",m>=0?"text-gray-900 dark:text-gray-100":"text-red-600 dark:text-red-400"),children:m>=0?g(m):`âˆ’${g(Math.abs(m))}`})]})]}),e.jsx("div",{className:v("grid gap-y-1 gap-x-4",a?"grid-cols-1 flex-1 min-w-0":"grid-cols-2 mt-4 w-full max-w-xs"),children:f.map((b,p)=>e.jsxs("button",{className:v("flex items-center gap-2 text-left p-1 rounded transition-colors min-w-0",c===p&&"bg-gray-100 dark:bg-gray-800"),onMouseEnter:()=>d(p),onMouseLeave:()=>d(null),onFocus:()=>d(p),onBlur:()=>d(null),children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:b.color},"aria-hidden":"true"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:b.name}),e.jsxs("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 ml-auto flex-shrink-0",children:[Math.round(b.percentage),"%"]})]},p))})]})}function ws({categories:t,daysRemaining:r,onViewCategory:s,className:a}){const{t:n}=q("common"),{currency:o}=X(),{isPrivacyMode:i}=te(),{data:l}=re(),[u,c]=y.useState(new Set),d=x=>Z(x,o,(l==null?void 0:l.rates)||{},!1,i),m=(()=>{const x=[],j=t.filter(k=>k.status==="red"),w=t.filter(k=>k.status==="orange"),b=t.filter(k=>k.status==="green"||k.status==="yellow");j.slice(0,2).forEach(k=>{const _=Math.abs(k.remaining);x.push({type:"exceeded",category:k.category,message:n("budget.alerts.exceededBy",{category:k.category,amount:d(_)}),action:n("budget.alerts.cutToStay",{category:k.category,amount:d(_)})})});const p=j.length>0?1:2;return w.slice(0,p).forEach(k=>{const _=r>0?k.remaining/r:0;x.push({type:"warning",category:k.category,message:n("budget.alerts.approaching",{category:k.category,amount:d(k.remaining),days:r}),action:r>0?n("budget.alerts.reduceDaily",{category:k.category,amount:d(_)}):void 0})}),j.length===0&&w.length===0&&b.length>0&&x.push({type:"onTrack",message:n("budget.alerts.allOnTrack",{count:b.length})}),x})().filter(x=>!u.has(x.category||"onTrack"));if(m.length===0)return null;const h=x=>{switch(x){case"exceeded":return{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-400",icon:It};case"warning":return{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",text:"text-amber-700 dark:text-amber-400",icon:le};case"onTrack":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-400",icon:Te}}};return e.jsx("div",{className:v("space-y-2",a),children:m.slice(0,2).map((x,j)=>{const w=h(x.type),b=w.icon;return e.jsxs("div",{className:v("flex items-start gap-3 p-3 rounded-lg border",w.bg,w.border),role:"alert",children:[e.jsx(b,{className:v("w-5 h-5 flex-shrink-0 mt-0.5",w.text),"aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:v("text-sm font-medium",w.text),children:x.message}),x.action&&e.jsx("p",{className:v("text-xs mt-0.5 opacity-80",w.text),children:x.action})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[x.category&&s&&e.jsx("button",{onClick:()=>s(x.category),className:v("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5",w.text),"aria-label":n("viewDetails"),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const p=x.category||"onTrack";c(k=>new Set([...k,p]))},className:v("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5",w.text),"aria-label":n("button.close"),children:e.jsx(Ne,{className:"w-4 h-4"})})]})]},x.category||`alert-${j}`)})})}function rr({amount:t,transactions:r,month:s,className:a}){const{t:n}=q("common"),o=ft(),{currency:i}=X(),{isPrivacyMode:l}=te(),{data:u}=re(),[c,d]=y.useState(!1),g=h=>Z(h,i,(u==null?void 0:u.rates)||{},!1,l);if(c||t<=0)return null;const f=(r==null?void 0:r.length)||0,m=()=>{o({to:"/transactions",search:{month:s||void 0}})};return e.jsxs("div",{className:v("flex items-start gap-3 p-3 rounded-xl border","bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",a),role:"alert",children:[e.jsx(le,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:n("budget.uncategorized.title")}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-0.5",children:n("budget.uncategorized.description",{amount:g(t),count:f})}),e.jsxs(V,{variant:"ghost",size:"sm",onClick:m,className:"mt-2 h-7 px-2 text-xs font-medium text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-800/40",children:[n("budget.uncategorized.reviewCta"),e.jsx(it,{className:"w-3.5 h-3.5 ml-1"})]})]}),e.jsx("button",{onClick:()=>d(!0),className:"p-1.5 rounded-full hover:bg-amber-100 dark:hover:bg-amber-800/40 text-amber-500","aria-label":n("button.close"),children:e.jsx(Ne,{className:"w-4 h-4"})})]})}function ks({tracking:t,className:r}){const{t:s}=q("common"),a=y.useMemo(()=>{const i=t.uncategorized_spending||0,l=t.total_spent+i;return l<=0?100:Math.round(t.total_spent/l*100)},[t]),n=(t.uncategorized_spending||0)>0,o=a>=90;return n?e.jsxs("div",{className:v("flex items-center gap-2 px-3 py-2 rounded-lg",r),children:[o?e.jsx(xa,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(ma,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:v("h-full rounded-full transition-all duration-500",o?"bg-green-500":"bg-amber-500"),style:{width:`${a}%`}})}),e.jsxs("span",{className:v("text-xs font-semibold tabular-nums flex-shrink-0",o?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"),children:[a,"%"]})]}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-0.5",children:s("budget.coverage.label")})]})]}):null}function Ss(t,r,s,a){const{category:n,budgeted:o,spent:i}=t,l=Math.max(1,s),u=i/l,c=o-i,d=r>0?c/r:0,g=i+u*r,f=Math.max(0,g-o);let m;s>=15?m="high":s>=7?m="medium":m="low";const h=o>0?g/o*100:0;let x;return h>100?x="danger":h>85?x="warning":x="safe",{category:n,predictedTotal:g,budgetAmount:o,exceededBy:f,confidence:m,status:x,dailyPace:u,safeDailyPace:d,anomalyDetected:!1,anomalyDescription:void 0,daysRemaining:r,daysElapsed:s}}function As(t,r,s){const{days_remaining:a}=r,o=30-a;return r.categories.map(i=>Ss(i,a,o)).filter(i=>i.status!=="safe"||i.anomalyDetected).sort((i,l)=>{const u={danger:0,warning:1,safe:2};return u[i.status]!==u[l.status]?u[i.status]-u[l.status]:l.exceededBy-i.exceededBy})}function ar(t){const r=t.total_spent,s=t.total_budgeted,a=t.days_remaining,o=Math.max(1,30-a),i=r/o,l=r+i*a,u=s>0?l/s*100:0;let c;return u>100?c="danger":u>85?c="warning":c="safe",{totalPredicted:l,totalBudget:s,overallStatus:c,overallPercent:u}}function Cs({budget:t,tracking:r,previousMonthData:s,selectedMonth:a,onViewCategory:n}){const{t:o}=q("common"),{currency:i}=X(),{isPrivacyMode:l}=te(),{data:u}=re(),c=x=>Z(x,i,(u==null?void 0:u.rates)||{},!1,l),d=t.allocations.reduce((x,j)=>x+j.amount,0),g=t.monthly_income-(t.savings_target||0),f=(r==null?void 0:r.total_spent)||0,m=y.useMemo(()=>r?ar(r):null,[r]),h=()=>{const x=new URL(window.location.href);x.searchParams.set("tab","forecast"),window.history.pushState({},"",x.toString()),window.dispatchEvent(new PopStateEvent("popstate"))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Aa,{totalBudget:g,totalSpent:f,totalAllocated:d,month:a}),m&&e.jsxs("button",{onClick:h,className:v("w-full flex items-center gap-3 p-3 rounded-xl border text-left transition-colors",m.overallStatus==="danger"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":m.overallStatus==="warning"?"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30"),children:[m.overallStatus==="danger"?e.jsx(le,{className:"w-5 h-5 text-red-500 flex-shrink-0"}):m.overallStatus==="warning"?e.jsx(je,{className:"w-5 h-5 text-amber-500 flex-shrink-0"}):e.jsx(Te,{className:"w-5 h-5 text-green-500 flex-shrink-0"}),e.jsx("p",{className:v("flex-1 text-sm font-medium",m.overallStatus==="danger"?"text-red-700 dark:text-red-300":m.overallStatus==="warning"?"text-amber-700 dark:text-amber-300":"text-green-700 dark:text-green-300"),children:m.overallStatus==="danger"?o("budget.forecastAlert.exceedBy",{amount:c(m.totalPredicted-m.totalBudget)}):m.overallStatus==="warning"?o("budget.forecastAlert.nearLimit",{percent:Math.round(m.overallPercent)}):o("budget.forecastAlert.onTrackSave",{amount:c(m.totalBudget-m.totalPredicted)})}),e.jsxs("span",{className:v("text-xs font-medium flex items-center gap-0.5 flex-shrink-0",m.overallStatus==="danger"?"text-red-500 dark:text-red-400":m.overallStatus==="warning"?"text-amber-500 dark:text-amber-400":"text-green-500 dark:text-green-400"),children:[o("budget.forecastAlert.seeDetails"),e.jsx(oe,{className:"w-3.5 h-3.5"})]})]}),(r==null?void 0:r.uncategorized_spending)!=null&&r.uncategorized_spending>0&&e.jsx(rr,{amount:r.uncategorized_spending,transactions:r.uncategorized_transactions,month:a}),r&&e.jsx(ks,{tracking:r}),r&&r.categories&&r.categories.length>0&&e.jsx(ws,{categories:r.categories,daysRemaining:r.days_remaining,onViewCategory:n}),e.jsx(Ca,{income:t.monthly_income,allocated:d,savings:t.savings_target||0,formatCurrency:c}),t.allocations.length>0&&e.jsxs(Q,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:o("budget.donutChart.title")}),e.jsx(Ns,{allocations:t.allocations,totalBudget:g,totalAllocated:d,compact:!0})]})]})}function sr(t){return t>=95?"exceeded":t>=80?"warning":"on_track"}const Ps={on_track:{icon:Te,bgColor:"bg-green-100 dark:bg-green-900/30",iconColor:"text-green-600 dark:text-green-400",label:"On Track",ariaLabel:"Budget on track"},warning:{icon:le,bgColor:"bg-yellow-100 dark:bg-yellow-900/30",iconColor:"text-yellow-600 dark:text-yellow-400",label:"Warning",ariaLabel:"Budget warning - approaching limit"},exceeded:{icon:It,bgColor:"bg-red-100 dark:bg-red-900/30",iconColor:"text-red-600 dark:text-red-400",label:"Exceeded",ariaLabel:"Budget exceeded"}};function nr({status:t,className:r}){const s=Ps[t],a=s.icon;return e.jsx("div",{className:v("flex-shrink-0",r),role:"status","aria-label":s.ariaLabel,children:e.jsx(a,{className:v("w-3.5 h-3.5",s.iconColor),"aria-hidden":"true"})})}function _s({allocations:t,trackingItems:r,selectedCategory:s,onSelectCategory:a,isDraft:n,onAddCategory:o,className:i}){const{t:l}=q("common"),{currency:u}=X(),{isPrivacyMode:c}=te(),{data:d}=re(),g=y.useRef(null),f=y.useRef([]),[m,h]=y.useState(()=>{const b=t.findIndex(p=>p.category===s);return b>=0?b:0});y.useEffect(()=>{const b=t.findIndex(p=>p.category===s);b>=0&&h(b)},[s,t]),y.useEffect(()=>{const b=f.current[m];b==null||b.scrollIntoView({block:"nearest",behavior:"smooth"})},[m]);const x=b=>Z(b,u,(d==null?void 0:d.rates)||{},!0,c),j=b=>r==null?void 0:r.find(p=>p.category===b),w=b=>{if(t.length!==0)switch(b.key){case"ArrowDown":b.preventDefault(),h(p=>p<t.length-1?p+1:0);break;case"ArrowUp":b.preventDefault(),h(p=>p>0?p-1:t.length-1);break;case"Home":b.preventDefault(),h(0);break;case"End":b.preventDefault(),h(t.length-1);break;case"Enter":case" ":b.preventDefault(),a(t[m].category);break}};return e.jsxs("div",{className:v("flex flex-col h-full",i),children:[n&&o&&e.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs(V,{variant:"outline",size:"sm",onClick:o,className:"w-full",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),l("budget.addCategory")]})}),e.jsxs("div",{ref:g,className:"flex-1 overflow-y-auto scrollbar-hide focus:outline-none",role:"listbox",tabIndex:0,"aria-label":l("budget.allocations"),"aria-activedescendant":t.length>0?`category-${m}`:void 0,onKeyDown:w,children:[t.map((b,p)=>{const k=j(b.category),_=(k==null?void 0:k.percentage)||0,z=(k==null?void 0:k.spent)||0,$=sr(_),N=s===b.category,T=m===p;return e.jsxs("button",{ref:C=>{f.current[p]=C},id:`category-${p}`,role:"option","aria-selected":N,tabIndex:-1,onClick:()=>{h(p),a(b.category)},className:v("w-full flex items-center justify-between px-4 py-3","text-left transition-all","hover:bg-gray-50 dark:hover:bg-gray-800",T&&"ring-2 ring-inset ring-green-500",N&&"bg-green-50 dark:bg-green-900/20 border-l-3 border-green-500"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:b.category}),e.jsx(nr,{status:$})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[x(z)," / ",x(b.amount)]}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:[Math.round(_),"%"]})]})]}),e.jsx(oe,{className:v("w-4 h-4 text-gray-400 flex-shrink-0 transition-transform",N&&"text-green-500")})]},b.category)}),t.length===0&&e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:l("budget.noAllocations")})]})]})}function Rt(t,r,s){if(r==="JPY")return t;const a=s[r];return!a||a===0?t:Math.round(t/a)}function Bt({category:t,month:r,trackingItem:s,isOpen:a,onClose:n,mode:o="overlay",className:i}){const{t:l}=q("common"),u=ft(),{currency:c}=X(),{isPrivacyMode:d}=te(),{data:g}=re(),{data:f}=bt(),[m,h]=y.useState([]),[x,j]=y.useState(!1),[w,b]=y.useState(null),[p,k]=y.useState(null),_=P=>Z(P,c,(g==null?void 0:g.rates)||{},!0,d),z=y.useMemo(()=>{const P=new Map;return f&&(f.expense.forEach(F=>{const B=F.children.map(U=>U.name);P.set(F.name,B)}),f.income.forEach(F=>{const B=F.children.map(U=>U.name);P.set(F.name,B)})),P},[f]),$=y.useMemo(()=>{const P=z.get(t)||[];return[t,...P]},[t,z]),N=y.useMemo(()=>{if(!f)return null;for(const P of[...f.expense,...f.income])if(P.children.some(F=>F.name===t))return P.name;return null},[t,f]);y.useEffect(()=>{if(!a)return;let P=!0;async function F(){j(!0),b(null);try{const[B,U]=r.split("-").map(Number),Y=new Date(B,U,0).getDate(),S=`${B}-${String(U).padStart(2,"0")}-01`,L=`${B}-${String(U).padStart(2,"0")}-${String(Y).padStart(2,"0")}`,K=await ct({categories:$,start_date:S,end_date:L,type:"expense"});if(P){const H=(g==null?void 0:g.rates)||{},de=K.filter(J=>!J.is_transfer).map(J=>({...J,amountJpy:Rt(Math.abs(J.amount),J.currency||"JPY",H)})).sort((J,D)=>D.amountJpy-J.amountJpy);h(de.slice(0,10).map(({amountJpy:J,...D})=>D))}}catch{P&&b("Failed to load transactions")}finally{P&&j(!1)}}return F(),()=>{P=!1}},[t,r,a,$]),y.useEffect(()=>{if(!a)return;let P=!0;async function F(){try{const[B,U]=r.split("-").map(Number);let Y=B,S=U-1;S<1&&(S=12,Y-=1);const[L,K]=[Y,S],H=new Date(L,K,0).getDate(),xe=`${L}-${String(K).padStart(2,"0")}-01`,de=`${L}-${String(K).padStart(2,"0")}-${String(H).padStart(2,"0")}`,J=await ct({categories:$,start_date:xe,end_date:de,type:"expense"});if(P){const D=(g==null?void 0:g.rates)||{},Ze=J.filter(we=>!we.is_transfer).reduce((we,Fe)=>{const Xe=Rt(Math.abs(Fe.amount),Fe.currency||"JPY",D);return we+Xe},0);k(Ze)}}catch{}}return F(),()=>{P=!1}},[t,r,a,$]),y.useEffect(()=>{if(o!=="overlay"||!a)return;const P=F=>{F.key==="Escape"&&n()};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[a,o,n]);const T=P=>Vt(P,"MMM d"),C=()=>{n(),u({to:"/transactions",search:{categories:t,month:r}})},A=()=>{n()},E=(s==null?void 0:s.spent)||0,O=p?Math.round((E-p)/p*100):null;return a?o==="inline"?e.jsxs("div",{className:v("flex flex-col h-full",i),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("nav",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:l("budget.title","Budget")}),e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:l("budget.categories","Categories")}),N&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:N})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:_((s==null?void 0:s.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:_(E)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:v("h-full rounded-full transition-all duration-500",(s==null?void 0:s.status)==="red"?"bg-red-500":(s==null?void 0:s.status)==="orange"?"bg-orange-500":(s==null?void 0:s.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(s==null?void 0:s.percentage)||0)}%`}})}),O!==null&&e.jsxs("div",{className:v("flex items-center gap-2 text-sm",O>0?"text-red-600 dark:text-red-400":O<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[O>0?e.jsx(je,{className:"w-4 h-4"}):O<0?e.jsx(jt,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[O>0?"+":"",O,"% vs last month (",_(p||0),")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:l("dashboard.recentTransactions")}),x?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(lt,{className:"w-6 h-6 animate-spin text-gray-400"})}):w?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:w})]}):m.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:l("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[m.map(P=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:P.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:T(P.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:_(P.amount)})]},P.id)),m.length>=10&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:C,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:l("dashboard.viewAllCategories")}),e.jsx(Nt,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(V,{onClick:A,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:l("transaction.addTransaction")})]}),e.jsx(V,{variant:"outline",onClick:C,className:"w-full",children:e.jsx("span",{children:l("transactions.viewAll")})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 dark:bg-black/50 z-40 lg:hidden",onClick:n}),e.jsxs("div",{className:v("fixed right-0 top-0 h-full w-full sm:w-96 bg-white dark:bg-gray-900 shadow-xl z-50","flex flex-col transform transition-transform duration-300 ease-out",a?"translate-x-0":"translate-x-full",i),children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("nav",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:l("budget.title","Budget")}),e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:l("budget.categories","Categories")}),N&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{className:"truncate",children:N})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:t})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors flex-shrink-0 ml-2",children:e.jsx(Ne,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:_((s==null?void 0:s.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:_(E)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:v("h-full rounded-full transition-all duration-500",(s==null?void 0:s.status)==="red"?"bg-red-500":(s==null?void 0:s.status)==="orange"?"bg-orange-500":(s==null?void 0:s.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(s==null?void 0:s.percentage)||0)}%`}})}),O!==null&&e.jsxs("div",{className:v("flex items-center gap-2 text-sm",O>0?"text-red-600 dark:text-red-400":O<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[O>0?e.jsx(je,{className:"w-4 h-4"}):O<0?e.jsx(jt,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[O>0?"+":"",O,"% vs last month (",_(p||0),")"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:l("dashboard.recentTransactions")}),x?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(lt,{className:"w-6 h-6 animate-spin text-gray-400"})}):w?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:w})]}):m.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:l("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[m.map(P=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:P.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:T(P.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:_(P.amount)})]},P.id)),m.length>=10&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:C,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:l("dashboard.viewAllCategories")}),e.jsx(Nt,{className:"w-3 h-3"})]})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(V,{onClick:A,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:l("transaction.addTransaction")})]}),e.jsx(V,{variant:"outline",onClick:C,className:"w-full",children:e.jsx("span",{children:l("transactions.viewAll")})})]})]})]}):null}function Ms({isDraft:t,onEdit:r,onDelete:s,onQuickAdjust:a}){const{t:n}=q("common"),[o,i]=y.useState(!1),[l,u]=y.useState(!1),c=y.useRef(null);y.useEffect(()=>{if(!o)return;const m=h=>{c.current&&!c.current.contains(h.target)&&(i(!1),u(!1))};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[o]);const d=m=>{m.stopPropagation(),i(!o),u(!1)},g=(m,h)=>{m.stopPropagation(),h(),i(!1)},f=m=>{m.stopPropagation(),l?(s(),i(!1),u(!1)):u(!0)};return e.jsxs("div",{ref:c,className:"relative",children:[e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":n("budget.cardActions","Actions"),"aria-expanded":o,children:e.jsx(sa,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"})}),o&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-20 py-1",children:[e.jsxs("button",{onClick:m=>g(m,r),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(Ur,{className:"w-4 h-4"}),n("budget.editAmount")]}),t&&a&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:m=>g(m,()=>a(5e3)),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(Xr,{className:"w-4 h-4"}),"+5,000"]}),e.jsxs("button",{onClick:m=>g(m,()=>a(-5e3)),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(Yr,{className:"w-4 h-4"}),"-5,000"]}),e.jsxs("button",{onClick:m=>g(m,()=>a("percent")),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("span",{className:"w-4 h-4 text-center text-xs font-bold",children:"%"}),"+10%"]})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700 my-1"}),e.jsxs("button",{onClick:f,className:v("w-full flex items-center gap-2 px-3 py-2.5 text-sm transition-colors",l?"text-white bg-red-600 hover:bg-red-700":"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20"),children:[e.jsx(dr,{className:"w-4 h-4"}),n(l?"budget.deleteConfirm":"delete")]})]})]})}function Os({currentAmount:t,onSave:r,onCancel:s}){const{t:a}=q("common"),n=y.useRef(null),[o,i]=y.useState(t.toLocaleString());y.useEffect(()=>{var d,g;(d=n.current)==null||d.focus(),(g=n.current)==null||g.select()},[]);const l=d=>{const g=d.replace(/[^\d]/g,"");return g?parseInt(g,10).toLocaleString():""},u=d=>parseInt(d.replace(/[^\d]/g,""),10)||0,c=()=>{const d=u(o);d!==t?r(d):s()};return e.jsxs("div",{className:"flex items-center gap-1",onClick:d=>d.stopPropagation(),children:[e.jsx("input",{ref:n,type:"text",inputMode:"numeric",value:o,onChange:d=>i(l(d.target.value)),onKeyDown:d=>{d.key==="Enter"?c():d.key==="Escape"&&s()},className:"w-28 text-right text-lg font-bold border-2 border-blue-400 rounded px-2 py-1 dark:bg-gray-700 dark:border-blue-500 dark:text-gray-100 focus:outline-none focus:border-blue-500","aria-label":a("budget.editAmount")}),e.jsx("button",{onClick:c,className:"p-1.5 bg-green-100 dark:bg-green-900/40 hover:bg-green-200 dark:hover:bg-green-900/60 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":a("save"),children:e.jsx(ht,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("button",{onClick:s,className:"p-1.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":a("cancel"),children:e.jsx(Ne,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})})]})}function Ts(t,r,s,a,n,o){if(a<=0)return null;const i=a-s;if(s>a){const l=s-a;return{text:t("budget.nudge.overTapToAdjust",{amount:r(l)}),className:"text-red-600 dark:text-red-400"}}if(n>=80){const l=Math.round(s-a*.75);return{text:t("budget.nudge.reduceToStaySafe",{amount:r(Math.max(l,0))}),className:"text-amber-600 dark:text-amber-400"}}if(o&&o>0&&i>0){const l=Math.round(i/o);return{text:t("budget.nudge.safeToSpend",{amount:r(l)}),className:"text-green-600 dark:text-green-400"}}return null}function Ds({allocation:t,trackingItem:r,daysRemaining:s,isDraft:a,isUpdating:n,isDeleting:o,formatCurrency:i,onAmountChange:l,onDelete:u,onCategoryClick:c,onQuickAdjust:d}){const{t:g}=q("common"),[f,m]=y.useState(!1),h=(r==null?void 0:r.spent)||0,x=(r==null?void 0:r.budgeted)||t.amount,j=x>0?h/x*100:0,w=sr(j),b=()=>j>=100?"bg-red-500":j>=80?"bg-amber-500":"bg-green-500",p=r?Ts(g,i,h,x,j,s):null,k=()=>{!a&&!f&&c()};return e.jsxs(Q,{className:v("p-3 sm:p-4 transition-all",a?"border-dashed border-blue-300 dark:border-blue-700":"cursor-pointer hover:shadow-md hover:border-blue-300 dark:hover:border-blue-600",(n||o)&&"opacity-50 pointer-events-none"),onClick:k,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:t.category}),r&&e.jsx(nr,{status:w})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:f?e.jsx(Os,{currentAmount:t.amount,onSave:_=>{l(_),m(!1)},onCancel:()=>m(!1)}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-base font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap",children:i(t.amount)}),e.jsx(Ms,{isDraft:a,onEdit:()=>m(!0),onDelete:u,onQuickAdjust:a?d:void 0})]})})]}),r&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[i(h)," / ",i(x)]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:v("h-full rounded-full transition-all duration-500 ease-out",b()),style:{width:`${Math.min(j,100)}%`}})}),j>100&&e.jsx("div",{className:"h-1 bg-red-200 dark:bg-red-900/50 rounded-full mt-0.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500 rounded-full",style:{width:`${Math.min((h-x)/x*100,100)}%`}})})]}),p&&e.jsx("p",{className:v("text-xs font-medium mt-1.5",p.className),children:p.text})]})}function Es({budgetId:t,allocations:r,totalBudget:s,tracking:a,month:n,daysRemaining:o,isDraft:i,onAddCategory:l,onAllocationChange:u}){const{t:c}=q("common"),d=ft(),g=qt(),{data:f}=bt(),{currency:m}=X(),{isPrivacyMode:h}=te(),{data:x}=re(),j=N=>Z(N,m,(x==null?void 0:x.rates)||{},!0,h),w=y.useMemo(()=>{const N=new Map;if(!f)return N;for(const T of[...f.expense,...f.income])N.set(T.name,T.children.map(C=>C.name));return N},[f]),b=y.useMemo(()=>{var T;const N=new Map;return(T=a==null?void 0:a.categories)==null||T.forEach(C=>N.set(C.category,C)),N},[a]),p=y.useMemo(()=>[...r].sort((N,T)=>{const C=b.get(N.category),A=b.get(T.category),E=(C==null?void 0:C.spent)||0,O=(A==null?void 0:A.spent)||0,P=(C==null?void 0:C.budgeted)||N.amount,F=(A==null?void 0:A.budgeted)||T.amount,B=E-P,U=O-F;if(B>0&&U<=0)return-1;if(U>0&&B<=0)return 1;const Y=P>0?E/P:0;return(F>0?O/F:0)-Y}),[r,b]),k=Ce({mutationFn:({category:N,amount:T})=>pr(t,N,T),onSuccess:()=>g.invalidateQueries({queryKey:["budget"]})}),_=Ce({mutationFn:N=>yr(t,N),onSuccess:()=>g.invalidateQueries({queryKey:["budget"]})}),z=N=>{const T=w.get(N)||[];d({to:"/transactions",search:{categories:[N,...T].join(","),month:n||void 0}})},$=(N,T)=>{if(!i||!u)return;const C=r[N],A=T==="percent"?Math.floor(C.amount*1.1):Math.max(0,C.amount+T),E=[...r];E[N]={...C,amount:A},u(E)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:c("budget.allocations")}),l&&e.jsxs(V,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),c("budget.addCategory")]})]}),i&&u&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:c("budget.tapToEdit")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:p.map(N=>{const T=r.findIndex(C=>C.category===N.category);return e.jsx(Ds,{allocation:N,totalBudget:s,trackingItem:b.get(N.category),daysRemaining:o,isDraft:i,isUpdating:k.isPending,isDeleting:_.isPending,formatCurrency:j,onAmountChange:C=>{if(i&&u){const A=[...r];A[T]={...N,amount:C},u(A)}else k.mutate({category:N.category,amount:C})},onDelete:()=>{i&&u?u(r.filter((C,A)=>A!==T)):_.mutate(N.category)},onCategoryClick:()=>z(N.category),onQuickAdjust:C=>$(T,C)},N.category)})}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:c("budget.noAllocations")})]})}function $s({budget:t,tracking:r,isDraft:s,selectedMonth:a,onAddCategory:n,onAllocationChange:o}){const{t:i}=q("common"),[l,u]=y.useState(null),c=t.monthly_income-(t.savings_target||0),d=y.useCallback(g=>{var f;return(f=r==null?void 0:r.categories)==null?void 0:f.find(m=>m.category===g)},[r]);return e.jsxs("div",{className:"space-y-4",children:[(r==null?void 0:r.uncategorized_spending)!=null&&r.uncategorized_spending>0&&e.jsx(rr,{amount:r.uncategorized_spending,transactions:r.uncategorized_transactions,month:a}),e.jsxs("div",{className:"hidden lg:grid lg:grid-cols-[280px_1fr] lg:gap-4 lg:min-h-[500px]",children:[e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:e.jsx(_s,{allocations:t.allocations,trackingItems:r==null?void 0:r.categories,selectedCategory:l,onSelectCategory:u,isDraft:s,onAddCategory:n})}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:l?e.jsx(Bt,{category:l,month:a,trackingItem:d(l),isOpen:!0,onClose:()=>u(null),mode:"inline"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400 p-8",children:i("budget.selectCategoryHint")})})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx(Es,{budgetId:t.id,allocations:t.allocations,totalBudget:c,tracking:r,month:a,daysRemaining:r==null?void 0:r.days_remaining,isDraft:s,onAddCategory:n,onAllocationChange:o})}),e.jsx("div",{className:"lg:hidden",children:e.jsx(Bt,{category:l||"",month:a,trackingItem:l?d(l):void 0,isOpen:!!l,onClose:()=>u(null),mode:"overlay"})})]})}const at=20;function Ls({allocations:t,month:r,onEditTransaction:s}){const{t:a}=q("common"),{currency:n}=X(),{isPrivacyMode:o}=te(),{data:i}=re(),[l,u]=y.useState([]),[c,d]=y.useState(!0),[g,f]=y.useState(null),[m,h]=y.useState("all"),[x,j]=y.useState(""),[w,b]=y.useState("date"),[p,k]=y.useState("desc"),[_,z]=y.useState(1),$=S=>Z(S,n,(i==null?void 0:i.rates)||{},!0,o),N=S=>Z(S,n,(i==null?void 0:i.rates)||{},!1,o),T=y.useMemo(()=>["all",...t.map(S=>S.category)],[t]),C=y.useMemo(()=>{const S=new Map;return t.forEach(L=>S.set(L.category,L.amount)),S},[t]),A=y.useMemo(()=>{const S=new Map;return l.forEach(L=>{const K=L.category||"";S.set(K,(S.get(K)||0)+Math.abs(L.amount))}),S},[l]);y.useEffect(()=>{let S=!0;async function L(){d(!0);try{const[K,H]=r.split("-").map(Number),xe=new Date(K,H,0).getDate(),de=await ct({start_date:`${K}-${String(H).padStart(2,"0")}-01`,end_date:`${K}-${String(H).padStart(2,"0")}-${String(xe).padStart(2,"0")}`,type:"expense"});S&&u(de.filter(J=>!J.is_transfer))}catch{S&&f("Failed to load")}finally{S&&d(!1)}}return L(),()=>{S=!1}},[r]);const E=y.useMemo(()=>{let S=[...l];if(m!=="all"&&(S=S.filter(L=>L.category===m)),x.trim()){const L=x.toLowerCase();S=S.filter(K=>{var H;return K.description.toLowerCase().includes(L)||((H=K.category)==null?void 0:H.toLowerCase().includes(L))})}return S.sort((L,K)=>{const H=w==="date"?new Date(L.date).getTime()-new Date(K.date).getTime():Math.abs(L.amount)-Math.abs(K.amount);return p==="desc"?-H:H}),S},[l,m,x,w,p]),O=Math.ceil(E.length/at),P=E.slice((_-1)*at,_*at);if(y.useEffect(()=>{z(1)},[m,x,w,p]),c)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(lt,{className:"w-6 h-6 animate-spin text-gray-400"})});if(g)return e.jsx(Q,{className:"p-6 text-center text-red-500",children:g});const F=m!=="all"?C.get(m):void 0,B=m!=="all"?A.get(m)||0:void 0,U=F&&F>0?Math.round(B/F*100):void 0,Y=S=>{const L=C.get(S);return L!==void 0&&L>0&&(A.get(S)||0)>L};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("select",{value:m,onChange:S=>h(S.target.value),className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:T.map(S=>e.jsx("option",{value:S,children:S==="all"?a("transactions.allCategories"):S},S))}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ur,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:x,onChange:S=>j(S.target.value),placeholder:a("transactions.search"),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm"})]}),e.jsxs("select",{value:`${w}-${p}`,onChange:S=>{const[L,K]=S.target.value.split("-");b(L),k(K)},className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"date-desc",children:a("transactions.sortDateDesc")}),e.jsx("option",{value:"date-asc",children:a("transactions.sortDateAsc")}),e.jsx("option",{value:"amount-desc",children:a("transactions.sortAmountDesc")}),e.jsx("option",{value:"amount-asc",children:a("transactions.sortAmountAsc")})]})]}),F!==void 0&&B!==void 0&&e.jsxs("div",{className:"px-3 py-2.5 rounded-lg bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:m}),e.jsxs("span",{className:v("text-sm font-semibold",U>100?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:[a("budget.budgetContext.progress",{spent:N(B),budgeted:N(F)})," ","(",U,"%)"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:v("h-full rounded-full transition-all",U>100?"bg-red-500":U>85?"bg-amber-500":"bg-green-500"),style:{width:`${Math.min(100,U)}%`}})})]}),e.jsx(Q,{className:"divide-y divide-gray-100 dark:divide-gray-800 overflow-hidden",children:P.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:a("transactions.noData")}):P.map(S=>{const L=C.get(S.category||""),K=L&&L>0?Math.round(Math.abs(S.amount)/L*100):0,H=Y(S.category||"");return e.jsxs("button",{onClick:()=>s==null?void 0:s(S),className:v("w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",H&&"border-l-3 border-l-red-400 dark:border-l-red-500"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:S.description}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Vt(S.date,"MMM d")," â€¢ ",S.category||a("category.other")]})]}),e.jsxs("div",{className:"text-right ml-4 flex-shrink-0",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:$(S.amount)}),K>10&&e.jsx("p",{className:v("text-[10px] font-medium mt-0.5",K>30?"text-red-500":K>20?"text-amber-500":"text-gray-400"),children:a("budget.budgetContext.impact",{percent:K})})]})]},S.id)})}),O>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500",children:a("transactions.showingCount",{shown:P.length,total:E.length})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>z(S=>Math.max(1,S-1)),disabled:_===1,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm",children:[_," / ",O]}),e.jsx("button",{onClick:()=>z(S=>Math.min(O,S+1)),disabled:_===O,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(oe,{className:"w-5 h-5"})})]})]})]})}function Rs({predictions:t,onViewCategory:r,onAdjustBudget:s,onDismiss:a,maxAlerts:n=3,className:o}){const{t:i}=q("common"),{currency:l}=X(),{isPrivacyMode:u}=te(),{data:c}=re(),d=h=>Z(h,l,(c==null?void 0:c.rates)||{},!0,u),g=t.slice(0,n);if(g.length===0)return null;const f=h=>h.anomalyDetected?{icon:Wr,bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200 dark:border-purple-800",iconBg:"bg-purple-100 dark:bg-purple-900/50",iconColor:"text-purple-600 dark:text-purple-400",textColor:"text-purple-800 dark:text-purple-200"}:h.status==="danger"?{icon:le,bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",iconBg:"bg-red-100 dark:bg-red-900/50",iconColor:"text-red-600 dark:text-red-400",textColor:"text-red-800 dark:text-red-200"}:{icon:je,bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",iconBg:"bg-amber-100 dark:bg-amber-900/50",iconColor:"text-amber-600 dark:text-amber-400",textColor:"text-amber-800 dark:text-amber-200"},m=h=>i(`budget.forecast.confidence.${h}`);return e.jsxs("div",{className:v("space-y-3",o),children:[g.map(h=>{const x=f(h),j=x.icon;return e.jsx(Q,{className:v("p-4 border",x.bg,x.border),role:"alert",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:v("p-2 rounded-lg flex-shrink-0",x.iconBg),children:e.jsx(j,{className:v("w-5 h-5",x.iconColor)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:v("font-semibold",x.textColor),children:h.anomalyDetected?i("budget.forecast.anomalyDetected"):h.status==="danger"?i("budget.forecast.predictedOverspend"):i("budget.forecast.approachingLimit")}),e.jsx("p",{className:v("text-sm mt-0.5",x.textColor,"opacity-90"),children:h.anomalyDetected?`${h.category}: ${h.anomalyDescription}`:`${h.category} ${i("budget.forecast.willExceedBy")} ${d(h.exceededBy)}`})]}),a&&e.jsx("button",{onClick:()=>a(h.category),className:v("p-1 rounded hover:bg-black/5 dark:hover:bg-white/5",x.textColor),"aria-label":i("button.close"),children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:v("flex items-center gap-4 mt-2 text-xs",x.textColor,"opacity-80"),children:[e.jsxs("span",{children:[i("budget.forecast.currentPace"),": ",d(h.dailyPace),"/day"]}),e.jsxs("span",{children:[i("budget.forecast.safePace"),": ",d(h.safeDailyPace),"/day"]}),e.jsxs("span",{children:[h.daysRemaining," ",i("budget.daysLeft")]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:v("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",h.confidence==="high"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":h.confidence==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:[i("budget.forecast.confidenceLabel"),": ",m(h.confidence)]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(V,{variant:"ghost",size:"sm",onClick:()=>r(h.category),className:x.textColor,children:[e.jsx(mr,{className:"w-4 h-4 mr-1"}),i("viewDetails")]}),s&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:()=>s(h.category),className:x.textColor,children:[e.jsx(gr,{className:"w-4 h-4 mr-1"}),i("budget.forecast.adjustBudget")]})]})]})]})},h.category)}),t.length>n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:i("budget.forecast.moreAlerts",{count:t.length-n})})]})}function Bs({budget:t,tracking:r,selectedMonth:s,onViewCategory:a,onAdjustBudget:n}){const{t:o}=q("common"),{currency:i}=X(),{isPrivacyMode:l}=te(),{data:u}=re(),c=m=>Z(m,i,(u==null?void 0:u.rates)||{},!0,l),d=y.useMemo(()=>r?As(t.allocations,r):[],[t.allocations,r]),g=y.useMemo(()=>r?ar(r):null,[r]);if(!r)return e.jsx(Q,{className:"p-8 text-center text-gray-500",children:o("budget.forecast.noData")});const f=d.length>0;return e.jsxs("div",{className:"space-y-6",children:[g&&e.jsx(Q,{className:v("p-6 border-2",g.overallStatus==="danger"?"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/20":g.overallStatus==="warning"?"border-amber-300 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20":"border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-900/20"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:v("w-14 h-14 rounded-full flex items-center justify-center",g.overallStatus==="danger"?"bg-red-500":g.overallStatus==="warning"?"bg-amber-500":"bg-green-500"),children:g.overallStatus==="danger"?e.jsx(le,{className:"w-7 h-7 text-white"}):g.overallStatus==="warning"?e.jsx(je,{className:"w-7 h-7 text-white"}):e.jsx(Te,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:v("text-lg font-bold",g.overallStatus==="danger"?"text-red-800 dark:text-red-200":g.overallStatus==="warning"?"text-amber-800 dark:text-amber-200":"text-green-800 dark:text-green-200"),children:g.overallStatus==="danger"?o("budget.forecast.overBudgetProjected"):g.overallStatus==="warning"?o("budget.forecast.approachingLimit"):o("budget.forecast.onTrack")}),e.jsx("p",{className:v("text-sm mt-0.5",g.overallStatus==="danger"?"text-red-700 dark:text-red-300":g.overallStatus==="warning"?"text-amber-700 dark:text-amber-300":"text-green-700 dark:text-green-300"),children:o("budget.forecast.projectedSpending",{amount:c(g.totalPredicted),budget:c(g.totalBudget)})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:v("text-3xl font-bold",g.overallStatus==="danger"?"text-red-600 dark:text-red-400":g.overallStatus==="warning"?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400"),children:[Math.round(g.overallPercent),"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:o("budget.forecast.ofBudget")})]})]})}),f?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:o("budget.forecast.predictedWarnings")}),e.jsx(Rs,{predictions:d,onViewCategory:a,onAdjustBudget:n,maxAlerts:5})]}):e.jsxs(Q,{className:"p-6 text-center bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsx(Te,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:o("budget.forecast.allClear")}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:o("budget.forecast.allClearDescription")})]}),e.jsxs(Q,{className:"overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:o("budget.forecast.categoryForecasts")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:r.categories.map(m=>{const h=d.find(w=>w.category===m.category),x=(h==null?void 0:h.predictedTotal)||m.spent,j=m.budgeted>0?x/m.budgeted*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:m.category}),e.jsxs("p",{className:"text-sm text-gray-500",children:[c(m.spent)," â†’ ",c(x)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:v("font-semibold",j>100?"text-red-600":j>85?"text-amber-600":"text-green-600"),children:[Math.round(j),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/ ",c(m.budgeted)]})]})]},m.category)})})]})]})}const Ft="budget-active-tab",Fs=["overview","categories","transactions","forecast"];function st(t){return t!==null&&Fs.includes(t)}function zs(t="overview"){const[r,s]=y.useState(()=>{if(typeof window<"u"){const o=new URLSearchParams(window.location.search).get("tab");if(st(o))return o;const i=localStorage.getItem(Ft);if(st(i))return i}return t}),a=y.useCallback(n=>{if(s(n),typeof window<"u"){const o=new URL(window.location.href);o.searchParams.set("tab",n),window.history.replaceState({},"",o.toString()),localStorage.setItem(Ft,n)}},[]);return y.useEffect(()=>{const n=()=>{const i=new URLSearchParams(window.location.search).get("tab");st(i)&&s(i)};return window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]),{activeTab:r,setActiveTab:a}}const nt=()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`},ot=t=>{const[r,s]=t.split("-").map(Number),a=s-1<1?12:s-1;return`${s-1<1?r-1:r}-${String(a).padStart(2,"0")}`};function Ks(){const{t,i18n:r}=q("common"),s=qt(),{currency:a}=X(),{isPrivacyMode:n}=te(),{data:o}=re(),[i,l]=y.useState(!1),[u,c]=y.useState(null),[d,g]=y.useState(nt),[f,m]=y.useState([]),[h,x]=y.useState(!1),[j,w]=y.useState(!1),[b,p]=y.useState(null),{activeTab:k,setActiveTab:_}=zs("overview"),{showBudgetCreatedXP:z}=Gr(),$=M=>Z(M,a,(o==null?void 0:o.rates)||{},!0,n),N=M=>{const[W,ee]=M.split("-");return new Date(parseInt(W),parseInt(ee)-1).toLocaleDateString(r.language,{month:"long",year:"numeric"})},T=d===nt(),C=y.useCallback(M=>{g(W=>{const[ee,ue]=W.split("-").map(Number);let me=ee,he=ue;return M==="prev"?(he-=1,he<1&&(he=12,me-=1)):(he+=1,he>12&&(he=1,me+=1)),`${me}-${String(he).padStart(2,"0")}`})},[]),A=y.useCallback(()=>g(nt()),[]),{data:E,isLoading:O,error:P}=ke({queryKey:["budget","month",d],queryFn:async()=>{var M;try{return await wt(d)}catch(W){if(((M=W==null?void 0:W.response)==null?void 0:M.status)===404)return null;throw W}},retry:!1}),{data:F}=ke({queryKey:["budget","previous-month",d],queryFn:async()=>{try{return await wt(ot(d))}catch{return null}},enabled:!!E,staleTime:5*60*1e3}),{data:B}=ke({queryKey:["budget","tracking",d],queryFn:async()=>{var M;try{return await kr(d)}catch(W){if(((M=W==null?void 0:W.response)==null?void 0:M.status)===404)return null;throw W}},retry:!1,enabled:!!E}),{data:U}=ke({queryKey:["budget","suggestions"],queryFn:Sr,enabled:!E&&!O}),{data:Y,isLoading:S}=ke({queryKey:["budget","copy-preview",d],queryFn:()=>Ar(ot(d),d),enabled:!E&&!O&&!u,retry:!1}),{data:L}=ke({queryKey:["budget","versions",d],queryFn:()=>Cr(d),enabled:!!E}),K=Ce({mutationFn:M=>vr({monthly_income:M,language:r.language}),onSuccess:M=>{c(M),J("generate",M),z()}}),H=Ce({mutationFn:M=>jr((u||E).id,{feedback:M,language:r.language}),onSuccess:M=>{c(M),l(!1),J("regenerate",M)}}),xe=Ce({mutationFn:()=>Nr({source_month:ot(d),target_month:d}),onSuccess:M=>{c(M),s.invalidateQueries({queryKey:["budget"]})}}),de=Ce({mutationFn:M=>wr(M),onSuccess:()=>{s.invalidateQueries({queryKey:["budget"]})}}),J=y.useCallback((M,W)=>{m(ee=>[...ee.slice(-9),{action:M,data:W}])},[]),D=u||E,Le=!!u,Ze=(D==null?void 0:D.allocations.reduce((M,W)=>M+W.amount,0))||0,we=y.useMemo(()=>{if(!B)return null;const M=B.total_spent/(B.total_budgeted||1);return M>1?"bg-red-500":M>.85?"bg-amber-500":"bg-green-500"},[B]),Fe=y.useMemo(()=>{if(!B)return[];const M=[];return B.categories.some(ee=>ee.status==="red")&&M.push("categories"),B.total_spent/(B.total_budgeted||1)>1&&M.push("forecast"),M},[B]),Xe=y.useCallback(()=>{if(!D)return;const M=`${t("budget.title")} - ${D.month}
${t("budget.monthlyIncome")}: ${$(D.monthly_income)}
${t("budget.savingsTarget")}: ${$(D.savings_target||0)}

${t("budget.allocations")}:
${D.allocations.map(me=>`- ${me.category}: ${$(me.amount)}`).join(`
`)}

${t("budget.aiAdvice")}: ${D.advice||"-"}
`,W=new Blob([M],{type:"text/plain"}),ee=URL.createObjectURL(W),ue=document.createElement("a");ue.href=ee,ue.download=`budget-${D.month}.txt`,ue.click(),URL.revokeObjectURL(ee)},[D,t]);return O?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(zt,{})}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:()=>C("prev"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:N(d)}),we&&e.jsx("span",{className:v("w-2.5 h-2.5 rounded-full flex-shrink-0",we),title:t("budget.health.title")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!T&&e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center text-green-600 dark:text-green-400",title:t("common.today"),children:e.jsx(ta,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C("next"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",disabled:d>=new Date().toISOString().slice(0,7),children:e.jsx(oe,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:t("budget.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("budget.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&L.length>1&&D&&e.jsx(Sa,{versions:L,currentVersion:D.version||1,formatCurrency:$,onRestore:M=>de.mutate(M),isRestoring:de.isPending}),D&&e.jsx("button",{onClick:Xe,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",title:t("export"),children:e.jsx(Jr,{className:"w-5 h-5"})})]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 space-y-4",children:[!D&&!P&&e.jsx(va,{copyPreview:Y,isCopyPreviewLoading:S,suggestions:U,selectedMonth:d,formatCurrency:$,formatMonth:N,onCopy:()=>xe.mutate(),onGenerate:M=>K.mutate(M),onStartEmpty:()=>{var M;c({id:0,month:d,monthly_income:((M=Y==null?void 0:Y.source_budget)==null?void 0:M.monthly_income)||0,allocations:[],created_at:new Date().toISOString()})},isCopyLoading:xe.isPending,isGenerateLoading:K.isPending,generateError:K.isError}),D&&e.jsxs(ka,{activeTab:k,onTabChange:_,alertTabs:Fe,children:[k==="overview"&&e.jsx(Cs,{budget:D,tracking:B||void 0,previousMonthData:F,selectedMonth:d,onViewCategory:()=>_("categories")}),k==="categories"&&e.jsx($s,{budget:D,tracking:B||void 0,isDraft:Le,selectedMonth:d,onAddCategory:()=>x(!0),onAllocationChange:M=>{Le&&c({...D,allocations:M})}}),k==="transactions"&&e.jsx(Ls,{allocations:D.allocations,month:d,onEditTransaction:p}),k==="forecast"&&e.jsx(Bs,{budget:D,tracking:B||void 0,selectedMonth:d,onViewCategory:()=>_("categories")}),Le&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(V,{variant:"outline",onClick:()=>l(!i),className:"flex-1",children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),t("budget.regenerate")]}),e.jsxs(V,{onClick:()=>w(!0),className:"flex-1",children:[e.jsx(ht,{className:"w-4 h-4 mr-2"}),t("budget.save")]})]}),i&&e.jsx(ja,{onSubmit:M=>H.mutate(M),onCancel:()=>l(!1),isLoading:H.isPending})]}),P&&e.jsx(Q,{className:"p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:P instanceof Error?P.message:t("budget.generateError")})}),h&&D&&e.jsx(Na,{budget:D,onClose:()=>x(!1),onAdd:(M,W)=>{const ee=[...D.allocations,{category:M,amount:W}];c({...D,allocations:ee,savings_target:Math.max(0,D.monthly_income-ee.reduce((ue,me)=>ue+me.amount,0))}),x(!1),J("add-category",D)}})]}),D&&Le&&e.jsx("div",{className:"fixed bottom-20 right-4 sm:hidden",children:e.jsx(V,{size:"lg",className:"rounded-full shadow-lg",onClick:()=>x(!0),children:e.jsx(ve,{className:"w-6 h-6"})})}),b&&e.jsx(Hr,{transaction:b,isOpen:!!b,onClose:()=>{p(null),s.invalidateQueries({queryKey:["budget","tracking"]})}}),e.jsx(wa,{isOpen:j,onConfirm:async()=>{await s.refetchQueries({queryKey:["budget"]}),c(null),w(!1)},onCancel:()=>w(!1),monthlyIncome:(D==null?void 0:D.monthly_income)||0,totalAllocated:Ze,savingsTarget:(D==null?void 0:D.savings_target)||0,categoryCount:(D==null?void 0:D.allocations.length)||0})]})}function Is({className:t}){return e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}const rn=xr("/budget")({component:Ks});export{rn as Route};
