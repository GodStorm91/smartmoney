import{c as v,u as b,k as g,j as r}from"./vendor-tanstack-DOuiVnRb.js";import{r as N}from"./vendor-react-B9eo89kj.js";import{C as u,L as x,c as n}from"./index-C4UxDUME.js";import{j as k,g as _,k as w}from"./recurring-service-BNpQv5m2.js";import{u as R}from"./vendor-i18n-CtQU9zWU.js";import{_ as y,A as C,a9 as q,a8 as D,t as S}from"./vendor-icons-Boynwk5e.js";const L={JPY:"¥"},T=["recurring.days.monday","recurring.days.tuesday","recurring.days.wednesday","recurring.days.thursday","recurring.days.friday","recurring.days.saturday","recurring.days.sunday"];function E(){const{t:a}=R("common"),c=v(),[i,d]=N.useState(null),{data:s,isLoading:m}=b({queryKey:["recurring-transactions"],queryFn:()=>w()}),h=g({mutationFn:k,onSuccess:()=>{c.invalidateQueries({queryKey:["recurring-transactions"]}),d(null)}}),l=g({mutationFn:({id:e,is_active:t})=>_(e,{is_active:t}),onSuccess:()=>{c.invalidateQueries({queryKey:["recurring-transactions"]})}}),j=e=>{confirm(a("common.confirmDelete","Are you sure you want to delete this?"))&&(d(e),h.mutate(e))},f=e=>{l.mutate({id:e.id,is_active:!e.is_active})},p=e=>{switch(e.frequency){case"weekly":const t=T[e.day_of_week??0];return`${a("recurring.weekly")} - ${a(t)}`;case"monthly":return`${a("recurring.monthly")} - ${e.day_of_month??1}日`;case"yearly":return a("recurring.yearly");case"custom":return a("recurring.everyNDays",{n:e.interval_days??7});default:return e.frequency}},o=e=>e?new Date(e).toLocaleDateString():"-";return m?r.jsxs(u,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6",children:a("recurring.title")}),r.jsx("div",{className:"flex justify-center py-8",children:r.jsx(x,{size:"md"})})]}):r.jsxs(u,{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[r.jsx(y,{className:"w-5 h-5 text-blue-500"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("recurring.title")})]}),s&&s.length>0?r.jsx("div",{className:"space-y-3",children:s.map(e=>r.jsx("div",{className:n("p-4 rounded-lg border transition-colors",e.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.description}),r.jsx("span",{className:n("px-2 py-0.5 text-xs rounded-full",e.is_active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400"),children:e.is_active?a("recurring.active"):a("recurring.inactive")})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[r.jsxs("span",{className:"font-numbers",children:[e.is_income?"+":"-",L.JPY,Math.abs(e.amount).toLocaleString()]}),r.jsx("span",{children:e.category}),r.jsx("span",{children:p(e)})]}),r.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-gray-400 dark:text-gray-500",children:[r.jsx(C,{className:"w-3 h-3"}),r.jsxs("span",{children:[a("recurring.nextRun"),": ",o(e.next_run_date)]}),e.last_run_date&&r.jsxs("span",{className:"ml-3",children:[a("recurring.lastRun"),": ",o(e.last_run_date)]})]})]}),r.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[r.jsx("button",{onClick:()=>f(e),disabled:l.isPending,className:n("p-2 rounded-lg transition-colors",e.is_active?"hover:bg-yellow-100 dark:hover:bg-yellow-900/30 text-yellow-600":"hover:bg-green-100 dark:hover:bg-green-900/30 text-green-600"),title:e.is_active?a("recurring.inactive"):a("recurring.active"),children:e.is_active?r.jsx(q,{className:"w-4 h-4"}):r.jsx(D,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>j(e.id),disabled:i===e.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",title:a("button.delete"),children:i===e.id?r.jsx(x,{size:"sm"}):r.jsx(S,{className:"w-4 h-4"})})]})]})},e.id))}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(y,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a("recurring.noRecurring")}),r.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:a("recurring.addFirst")})]})]})}export{E as R};
