import{j as r,a as Bs,f as Rs,e as zs}from"./vendor-router-DONIM_LE.js";import{r as C,R as ot}from"./vendor-react-Cwh1aMWO.js";import{u as be,b as $s,c as dt}from"./vendor-query-B0NEAgzV.js";import{K as _e,z as ke,aa as Xe,aE as I,j as M,an as yt,am as Ks,y as Vs,Y as Pt,C as K,s as ve,b0 as ns,B as ee,aD as Hs,b1 as rs,m as Us,L as Ys,g as is,aH as Gs,at as qs,b2 as Xs,t as as,S as Ke,R as Ws,aj as Js,b3 as Qs,b4 as Zs,b5 as en,a$ as tn,b6 as sn,b7 as Ce,M as nn,b8 as rn,ao as an}from"./index-C27mG4zb.js";import{u as R}from"./vendor-i18n-CNDlYvyf.js";import{R as We,d as on,e as os,X as Je,Y as Qe,T as Ze,f as cs,b as Ue,L as ut,C as Ye,g as ls,B as ds,h as cn,i as ln,c as dn}from"./vendor-charts-D-N8xF42.js";import{M as un}from"./minus-CeyH1m3F.js";import{c as Lt,a as Ot,A as fn,b as hn}from"./ai-categorization-service-YnniqA7o.js";import{a as Ft,s as Ve,e as mn,b as Be}from"./subMonths-DkhDKdYa.js";import{D as gn}from"./download-Dl1HbdK2.js";import{M as pn}from"./mail-D1j5hYvQ.js";import{C as xn}from"./chevron-up-B17u_cla.js";import{C as us}from"./chevron-down-DEqb1tFR.js";import{T as ft}from"./triangle-alert-CbQMrZzZ.js";function Bt(t,e,s){if(t===0)return"";const n=Math.abs(t);if(e==="VND")return n>=1e6?`${(t/1e6).toFixed(1)}M`:n>=1e3?`${(t/1e3).toFixed(0)}K`:t.toString();if(e==="JPY"){if(n>=1e4){const i=s==="ja"?"ä¸‡":"W";return`${(t/1e4).toFixed(1)}${i}`}return n>=1e3?`${(t/1e3).toFixed(0)}K`:t.toString()}return n>=1e6?`${(t/1e6).toFixed(1)}M`:n>=1e3?`${(t/1e3).toFixed(0)}K`:t.toString()}function fs({data:t}){const{currency:e}=_e(),{data:s}=ke(),{t:n,i18n:i}=R("common"),{resolvedTheme:o}=Xe(),a=i.language,l=o==="dark",c=l?"#45475a":"#E5E7EB",d=l?"#a6adc8":"#6B7280",f=l?"#1e1e2e":"#fff",h=l?"#45475a":"#E5E7EB",u=l?"#cdd6f4":"#374151",x=t.every(g=>g.expenses===0),m=t.map(g=>({...g,net:g.income-g.expenses}));return r.jsx(We,{width:"100%",height:"100%",children:r.jsxs(on,{data:m,margin:{top:20,right:30,left:20,bottom:5},children:[r.jsx(os,{strokeDasharray:"3 3",stroke:c}),r.jsx(Je,{dataKey:"month",stroke:d,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),r.jsx(Qe,{stroke:d,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:g=>I(g,e,(s==null?void 0:s.rates)||{},!1)}),r.jsx(Ze,{contentStyle:{backgroundColor:f,border:`1px solid ${h}`,borderRadius:"8px",fontSize:"14px",color:u},formatter:(g,b)=>[I(g,e,(s==null?void 0:s.rates)||{},!1),b],labelFormatter:g=>g}),r.jsx(cs,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:u}}),r.jsx(Ue,{dataKey:"income",fill:"#4CAF50",name:n("chart.income"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:r.jsx(ut,{dataKey:"income",position:"top",formatter:g=>Bt(g,e,a),style:{fontSize:"10px",fill:"#4CAF50",fontWeight:500}})}),r.jsxs(Ue,{dataKey:"expenses",fill:"#F44336",name:n("chart.expense"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:200,animationDuration:800,animationEasing:"ease-out",children:[x?m.map((g,b)=>r.jsx(Ye,{fill:"#F4433633"},`cell-${b}`)):m.map((g,b)=>r.jsx(Ye,{fill:g.expenses===0?"#F4433633":"#F44336"},`cell-${b}`)),r.jsx(ut,{dataKey:"expenses",position:"top",formatter:g=>Bt(g,e,a),style:{fontSize:"10px",fill:"#F44336",fontWeight:500}})]}),r.jsx(ls,{type:"monotone",dataKey:"net",name:n("chart.net"),stroke:"#2196F3",strokeWidth:2,dot:{fill:"#2196F3",strokeWidth:2,r:4},activeDot:{r:6},isAnimationActive:!0,animationBegin:400,animationDuration:1e3,animationEasing:"ease-out"})]})})}const Re=7,ze=["#4CAF50","#2196F3","#FF9800","#9C27B0","#F44336","#00BCD4","#FFEB3B","#795548","#607D8B"];function yn({changePercent:t}){if(t==null)return null;const e=t>0,s=Math.abs(t)>=20;return t===0?r.jsxs("span",{className:"inline-flex items-center gap-0.5 text-xs text-gray-500 dark:text-gray-400",children:[r.jsx(un,{className:"w-3 h-3"}),r.jsx("span",{children:"0%"})]}):r.jsxs("span",{className:M("inline-flex items-center gap-0.5 text-xs font-medium",e?"text-expense-600 dark:text-expense-300":"text-income-600 dark:text-income-300",s&&"font-bold"),children:[e?r.jsx(yt,{className:"w-3 h-3"}):r.jsx(Ks,{className:"w-3 h-3"}),r.jsxs("span",{children:[e?"+":"",t.toFixed(0),"%"]})]})}function hs({data:t}){const{t:e}=R("common"),{currency:s}=_e(),{data:n}=ke(),{resolvedTheme:i}=Xe(),o=i==="dark",[a,l]=C.useState(!1),c=o?"#1e1e2e":"#fff",d=o?"#45475a":"#E5E7EB",f=o?"#cdd6f4":"#374151",h=t.reduce((y,v)=>y+v.amount,0),u=[...t].sort((y,v)=>v.amount-y.amount),m=(()=>{if(u.length<=Re||a)return u.map((w,j)=>({...w,percentage:h>0?w.amount/h*100:0,color:ze[j%ze.length]}));const y=u.slice(0,Re),v=u.slice(Re),k=v.reduce((w,j)=>w+j.amount,0),E=y.map((w,j)=>({...w,percentage:h>0?w.amount/h*100:0,color:ze[j%ze.length]}));return v.length>0&&E.push({category:`${e("analytics.otherCategories")} (${v.length})`,amount:k,percentage:h>0?k/h*100:0,color:"#9E9E9E",isOther:!0,otherCount:v.length}),E})(),g=u.length>Re,b=y=>{const{x:v,y:k,width:E,height:w,value:j}=y;return r.jsxs("text",{x:v+E+8,y:k+w/2,fill:f,textAnchor:"start",dominantBaseline:"middle",fontSize:12,children:[j.toFixed(1),"%"]})},p=Math.max(200,m.length*32);return r.jsxs("div",{className:"w-full",children:[r.jsx(We,{width:"100%",height:p,children:r.jsxs(ds,{data:m,layout:"vertical",margin:{top:5,right:60,left:0,bottom:5},children:[r.jsx(Je,{type:"number",hide:!0,domain:[0,100]}),r.jsx(Qe,{type:"category",dataKey:"category",width:100,tick:{fill:f,fontSize:12},axisLine:!1,tickLine:!1}),r.jsx(Ze,{contentStyle:{backgroundColor:c,border:`1px solid ${d}`,borderRadius:"8px",fontSize:"14px",color:f},content:({active:y,payload:v})=>{if(!y||!(v!=null&&v[0]))return null;const k=v[0].payload,E=k.change_percent!==null&&k.change_percent!==void 0;return r.jsxs("div",{className:"p-3 rounded-lg shadow-lg",style:{backgroundColor:c,border:`1px solid ${d}`},children:[r.jsx("p",{className:"font-medium mb-1",children:k.category}),r.jsx("p",{className:"text-sm",children:I(k.amount,s,(n==null?void 0:n.rates)||{},!1)}),E&&r.jsxs("div",{className:"mt-1 pt-1 border-t border-gray-200 dark:border-gray-600",children:[r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e("analytics.vsPrevious"),": "]}),r.jsx(yn,{changePercent:k.change_percent})]})]})}}),r.jsxs(Ue,{dataKey:"percentage",radius:[0,4,4,0],maxBarSize:24,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:[m.map((y,v)=>r.jsx(Ye,{fill:y.color},`cell-${v}`)),r.jsx(ut,{dataKey:"percentage",content:b})]})]})}),g&&r.jsx("button",{onClick:()=>l(!a),className:M("w-full mt-2 py-2 px-4 text-sm font-medium rounded-lg transition-colors","text-primary-600 dark:text-primary-400","hover:bg-primary-50 dark:hover:bg-primary-900/20"),children:a?e("analytics.showLessCategories"):e("analytics.showAllCategories",{count:u.length})})]})}const Rt={income:"#4CAF50",expense:"#F44336",net:"#2196F3"};function bn({data:t,dataKey:e}){const{currency:s}=_e(),{data:n}=ke(),{isPrivacyMode:i}=Vs(),{t:o}=R("common"),{resolvedTheme:a}=Xe(),l=a==="dark",c=l?"#45475a":"#E5E7EB",d=l?"#a6adc8":"#6B7280",f=l?"#1e1e2e":"#fff",h=l?"#45475a":"#E5E7EB",u=l?"#cdd6f4":"#374151",x={income:o("chart.income"),expense:o("chart.expense"),net:o("chart.net")};return r.jsx(We,{width:"100%",height:"100%",children:r.jsxs(cn,{data:t,margin:{top:5,right:30,left:20,bottom:5},children:[r.jsx(os,{strokeDasharray:"3 3",stroke:c}),r.jsx(Je,{dataKey:"month",stroke:d,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),r.jsx(Qe,{stroke:d,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:m=>Pt(m,s,(n==null?void 0:n.rates)||{},!1,i)}),r.jsx(Ze,{contentStyle:{backgroundColor:f,border:`1px solid ${h}`,borderRadius:"8px",fontSize:"14px",color:u},formatter:m=>[Pt(m,s,(n==null?void 0:n.rates)||{},!1,i),x[e]]}),r.jsx(cs,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:u}}),r.jsx(ls,{type:"monotone",dataKey:e,stroke:Rt[e],strokeWidth:2,dot:{fill:Rt[e],r:4},activeDot:{r:6},name:x[e],isAnimationActive:!0,animationBegin:0,animationDuration:1200,animationEasing:"ease-out"})]})})}function vn({data:t,savingsGoal:e}){const{t:s}=R("common"),{currency:n}=_e(),{data:i}=ke(),{resolvedTheme:o}=Xe(),a=o==="dark",l=a?"#1e1e2e":"#fff",c=a?"#45475a":"#E5E7EB",d=a?"#cdd6f4":"#374151",f=t.length>0?t[t.length-1]:null,h=(f==null?void 0:f.net)||0,u=t.length>1?t.slice(0,-1):t,x=u.length>0?u.reduce((y,v)=>y+v.net,0)/u.length:h,m=[{name:s("analytics.thisMonth"),value:h,color:h>=0?"#4CAF50":"#F44336"},{name:s("analytics.average"),value:x,color:"#9E9E9E"}],g=x!==0?(h-x)/Math.abs(x)*100:0,b=g>=0,p=e&&e>0?Math.min(h/e*100,100):null;return t.length===1?r.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-8",children:[r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:s("analytics.netCashFlow")}),r.jsx("p",{className:M("text-3xl font-bold",h>=0?"text-income-600 dark:text-income-300":"text-expense-600 dark:text-expense-300"),children:I(h,n,(i==null?void 0:i.rates)||{},!1)}),h>=0&&r.jsx("p",{className:"text-sm text-income-600 dark:text-income-300 mt-1",children:s("analytics.positiveCashFlow")}),e&&e>0&&r.jsxs("div",{className:"mt-4 w-full max-w-xs",children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[r.jsx("span",{children:s("analytics.savingsGoal")}),r.jsxs("span",{children:[(p??0).toFixed(0),"%"]})]}),r.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:M("h-full rounded-full transition-[width] duration-700 ease-out",p&&p>=100?"bg-green-500":"bg-primary-500"),style:{width:`${p||0}%`}})}),r.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:[I(e,n,(i==null?void 0:i.rates)||{},!1)," ",s("analytics.target")]})]})]}):r.jsxs("div",{className:"w-full h-full flex flex-col",children:[r.jsx("div",{className:"flex-1 min-h-[150px]",children:r.jsx(We,{width:"100%",height:"100%",children:r.jsxs(ds,{data:m,layout:"vertical",margin:{top:10,right:60,left:10,bottom:10},children:[r.jsx(Je,{type:"number",hide:!0}),r.jsx(Qe,{type:"category",dataKey:"name",width:80,tick:{fill:d,fontSize:12},axisLine:!1,tickLine:!1}),r.jsx(Ze,{contentStyle:{backgroundColor:l,border:`1px solid ${c}`,borderRadius:"8px",fontSize:"14px",color:d},formatter:y=>[I(y,n,(i==null?void 0:i.rates)||{},!1),s("analytics.netCashFlow")]}),e&&e>0&&r.jsx(ln,{x:e,stroke:"#9C27B0",strokeDasharray:"3 3",label:{value:s("analytics.goal"),position:"top",fill:"#9C27B0",fontSize:10}}),r.jsx(Ue,{dataKey:"value",radius:[0,4,4,0],maxBarSize:32,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:m.map((y,v)=>r.jsx(Ye,{fill:y.color},`cell-${v}`))})]})})}),r.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 border-t border-gray-100 dark:border-gray-800",children:[r.jsxs("span",{className:M("text-sm font-medium",b?"text-income-600 dark:text-income-300":"text-expense-600 dark:text-expense-300"),children:[b?"â–²":"â–¼"," ",Math.abs(g).toFixed(1),"%"]}),r.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:s("analytics.vsAverage")})]}),e&&e>0&&r.jsxs("div",{className:"px-4 pb-2",children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[r.jsx("span",{children:s("analytics.savingsGoal")}),r.jsxs("span",{children:[I(h,n,(i==null?void 0:i.rates)||{},!1)," / ",I(e,n,(i==null?void 0:i.rates)||{},!1)]})]}),r.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:M("h-full rounded-full transition-[width] duration-700 ease-out",p&&p>=100?"bg-green-500":"bg-primary-500"),style:{width:`${p||0}%`}})})]})]})}function jn(t,e,s){return Math.max(e,Math.min(t,s))}const P={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function zt(t,e,s){return e===0||Math.abs(e)===1/0?Math.pow(t,s*5):t*e*s/(e+s*t)}function $t(t,e,s,n=.15){return n===0?jn(t,e,s):t<e?-zt(e-t,s-e,n)+e:t>s?+zt(t-s,s-e,n)+s:t}function _n(t,[e,s],[n,i]){const[[o,a],[l,c]]=t;return[$t(e,o,a,n),$t(s,l,c,i)]}function kn(t,e){if(typeof t!="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var n=s.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function wn(t){var e=kn(t,"string");return typeof e=="symbol"?e:String(e)}function $(t,e,s){return e=wn(e),e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Kt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),s.push.apply(s,n)}return s}function B(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?Kt(Object(s),!0).forEach(function(n){$(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Kt(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}const ms={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function Vt(t){return t?t[0].toUpperCase()+t.slice(1):""}const Nn=["enter","leave"];function Sn(t=!1,e){return t&&!Nn.includes(e)}function En(t,e="",s=!1){const n=ms[t],i=n&&n[e]||e;return"on"+Vt(t)+Vt(i)+(Sn(s,i)?"Capture":"")}const Cn=["gotpointercapture","lostpointercapture"];function Tn(t){let e=t.substring(2).toLowerCase();const s=!!~e.indexOf("passive");s&&(e=e.replace("passive",""));const n=Cn.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(n);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:s}}function An(t,e=""){const s=ms[t],n=s&&s[e]||e;return t+n}function et(t){return"touches"in t}function gs(t){return et(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function In(t){return Array.from(t.touches).filter(e=>{var s,n;return e.target===t.currentTarget||((s=t.currentTarget)===null||s===void 0||(n=s.contains)===null||n===void 0?void 0:n.call(s,e.target))})}function Dn(t){return t.type==="touchend"||t.type==="touchcancel"?t.changedTouches:t.targetTouches}function ps(t){return et(t)?Dn(t)[0]:t}function ht(t,e){try{const s=e.clientX-t.clientX,n=e.clientY-t.clientY,i=(e.clientX+t.clientX)/2,o=(e.clientY+t.clientY)/2,a=Math.hypot(s,n);return{angle:-(Math.atan2(s,n)*180)/Math.PI,distance:a,origin:[i,o]}}catch{}return null}function Mn(t){return In(t).map(e=>e.identifier)}function Ht(t,e){const[s,n]=Array.from(t.touches).filter(i=>e.includes(i.identifier));return ht(s,n)}function ct(t){const e=ps(t);return et(t)?e.identifier:e.pointerId}function je(t){const e=ps(t);return[e.clientX,e.clientY]}const Ut=40,Yt=800;function xs(t){let{deltaX:e,deltaY:s,deltaMode:n}=t;return n===1?(e*=Ut,s*=Ut):n===2&&(e*=Yt,s*=Yt),[e,s]}function Pn(t){var e,s;const{scrollX:n,scrollY:i,scrollLeft:o,scrollTop:a}=t.currentTarget;return[(e=n??o)!==null&&e!==void 0?e:0,(s=i??a)!==null&&s!==void 0?s:0]}function Ln(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:s,altKey:n,metaKey:i,ctrlKey:o}=t;Object.assign(e,{shiftKey:s,altKey:n,metaKey:i,ctrlKey:o})}return e}function Ge(t,...e){return typeof t=="function"?t(...e):t}function On(){}function Fn(...t){return t.length===0?On:t.length===1?t[0]:function(){let e;for(const s of t)e=s.apply(this,arguments)||e;return e}}function Gt(t,e){return Object.assign({},e,t||{})}const Bn=32;let ys=class{constructor(e,s,n){this.ctrl=e,this.args=s,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:s,ingKey:n,args:i}=this;s[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const s=this.state,n=this.config;s._active||(this.reset(),this.computeInitial(),s._active=!0,s.target=e.target,s.currentTarget=e.currentTarget,s.lastOffset=n.from?Ge(n.from,s):s.offset,s.offset=s.lastOffset,s.startTime=s.timeStamp=e.timeStamp)}computeValues(e){const s=this.state;s._values=e,s.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:s,config:n,shared:i}=this;s.args=this.args;let o=0;if(e&&(s.event=e,n.preventDefault&&e.cancelable&&s.event.preventDefault(),s.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,Ln(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,o=e.timeStamp-s.timeStamp,s.timeStamp=e.timeStamp,s.elapsedTime=s.timeStamp-s.startTime),s._active){const w=s._delta.map(Math.abs);P.addTo(s._distance,w)}this.axisIntent&&this.axisIntent(e);const[a,l]=s._movement,[c,d]=n.threshold,{_step:f,values:h}=s;if(n.hasCustomTransform?(f[0]===!1&&(f[0]=Math.abs(a)>=c&&h[0]),f[1]===!1&&(f[1]=Math.abs(l)>=d&&h[1])):(f[0]===!1&&(f[0]=Math.abs(a)>=c&&Math.sign(a)*c),f[1]===!1&&(f[1]=Math.abs(l)>=d&&Math.sign(l)*d)),s.intentional=f[0]!==!1||f[1]!==!1,!s.intentional)return;const u=[0,0];if(n.hasCustomTransform){const[w,j]=h;u[0]=f[0]!==!1?w-f[0]:0,u[1]=f[1]!==!1?j-f[1]:0}else u[0]=f[0]!==!1?a-f[0]:0,u[1]=f[1]!==!1?l-f[1]:0;this.restrictToAxis&&!s._blocked&&this.restrictToAxis(u);const x=s.offset,m=s._active&&!s._blocked||s.active;m&&(s.first=s._active&&!s.active,s.last=!s._active&&s.active,s.active=i[this.ingKey]=s._active,e&&(s.first&&("bounds"in n&&(s._bounds=Ge(n.bounds,s)),this.setup&&this.setup()),s.movement=u,this.computeOffset()));const[g,b]=s.offset,[[p,y],[v,k]]=s._bounds;s.overflow=[g<p?-1:g>y?1:0,b<v?-1:b>k?1:0],s._movementBound[0]=s.overflow[0]?s._movementBound[0]===!1?s._movement[0]:s._movementBound[0]:!1,s._movementBound[1]=s.overflow[1]?s._movementBound[1]===!1?s._movement[1]:s._movementBound[1]:!1;const E=s._active?n.rubberband||[0,0]:[0,0];if(s.offset=_n(s._bounds,s.offset,E),s.delta=P.sub(s.offset,x),this.computeMovement(),m&&(!s.last||o>Bn)){s.delta=P.sub(s.offset,x);const w=s.delta.map(Math.abs);P.addTo(s.distance,w),s.direction=s.delta.map(Math.sign),s._direction=s._delta.map(Math.sign),!s.first&&o>0&&(s.velocity=[w[0]/o,w[1]/o],s.timeDelta=o)}}emit(){const e=this.state,s=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const i=this.handler(B(B(B({},s),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};function Rn([t,e],s){const n=Math.abs(t),i=Math.abs(e);if(n>i&&n>s)return"x";if(i>n&&i>s)return"y"}class Pe extends ys{constructor(...e){super(...e),$(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=P.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=P.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const s=this.state,n=this.config;if(!s.axis&&e){const i=typeof n.axisThreshold=="object"?n.axisThreshold[gs(e)]:n.axisThreshold;s.axis=Rn(s._movement,i)}s._blocked=(n.lockDirection||!!n.axis)&&!s.axis||!!n.axis&&n.axis!==s.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const zn=t=>t,qt=.15,bs={enabled(t=!0){return t},eventOptions(t,e,s){return B(B({},s.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[qt,qt];case!1:return[0,0];default:return P.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return P.toVector(t)},transform(t,e,s){const n=t||s.shared.transform;return this.hasCustomTransform=!!n,n||zn},threshold(t){return P.toVector(t,0)}},$n=0,he=B(B({},bs),{},{axis(t,e,{axis:s}){if(this.lockDirection=s==="lock",!this.lockDirection)return s},axisThreshold(t=$n){return t},bounds(t={}){if(typeof t=="function")return o=>he.bounds(t(o));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:s=1/0,top:n=-1/0,bottom:i=1/0}=t;return[[e,s],[n,i]]}}),Xt={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};class Kn extends Pe{constructor(...e){super(...e),$(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const s=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),i={left:s.left-n.left+e.offset[0],right:s.right-n.right+e.offset[0],top:s.top-n.top+e.offset[1],bottom:s.bottom-n.bottom+e.offset[1]};e._bounds=he.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const s=this.config,n=this.state;if(e.buttons!=null&&(Array.isArray(s.pointerButtons)?!s.pointerButtons.includes(e.buttons):s.pointerButtons!==-1&&s.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);s.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(i&&i.size>1&&n._pointerActive)&&(this.start(e),this.setupPointer(e),n._pointerId=ct(e),n._pointerActive=!0,this.computeValues(je(e)),this.computeInitial(),s.preventScrollAxis&&gs(e)!=="mouse"?(n._active=!1,this.setupScrollPrevention(e)):s.delay>0?(this.setupDelayTrigger(e),s.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const s=this.state;s._active=!0,s._preventScroll=!0,s._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const s=this.state,n=this.config;if(!s._pointerActive)return;const i=ct(e);if(s._pointerId!==void 0&&i!==s._pointerId)return;const o=je(e);if(document.pointerLockElement===e.target?s._delta=[e.movementX,e.movementY]:(s._delta=P.sub(o,s._values),this.computeValues(o)),P.addTo(s._movement,s._delta),this.compute(e),s._delayed&&s.intentional){this.timeoutStore.remove("dragDelay"),s.active=!1,this.startPointerDrag(e);return}if(n.preventScrollAxis&&!s._preventScroll)if(s.axis)if(s.axis===n.preventScrollAxis||n.preventScrollAxis==="xy"){s._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const s=this.state,n=this.config;if(!s._active||!s._pointerActive)return;const i=ct(e);if(s._pointerId!==void 0&&i!==s._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[o,a]=s._distance;if(s.tap=o<=n.tapsThreshold&&a<=n.tapsThreshold,s.tap&&n.filterTaps)s._force=!0;else{const[l,c]=s._delta,[d,f]=s._movement,[h,u]=n.swipe.velocity,[x,m]=n.swipe.distance,g=n.swipe.duration;if(s.elapsedTime<g){const b=Math.abs(l/s.timeDelta),p=Math.abs(c/s.timeDelta);b>h&&Math.abs(d)>x&&(s.swipe[0]=Math.sign(l)),p>u&&Math.abs(f)>m&&(s.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const s=this.config,n=s.device;s.pointerLock&&e.currentTarget.requestPointerLock(),s.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,Vn(e);const s=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",s),this.eventStore.add(this.sharedConfig.window,"touch","cancel",s),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const s=Xt[e.key];if(s){const n=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=s(this.config.keyboardDisplacement,i),n._keyboardActive=!0,P.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in Xt&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const s=this.config.device;e(s,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(s,"change",this.pointerMove.bind(this)),e(s,"end",this.pointerUp.bind(this)),e(s,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function Vn(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}const Le=typeof window<"u"&&window.document&&window.document.createElement;function vs(){return Le&&"ontouchstart"in window}function Hn(){return vs()||Le&&window.navigator.maxTouchPoints>1}function Un(){return Le&&"onpointerdown"in window}function Yn(){return Le&&"exitPointerLock"in window.document}function Gn(){try{return"constructor"in GestureEvent}catch{return!1}}const G={isBrowser:Le,gesture:Gn(),touch:vs(),touchscreen:Hn(),pointer:Un(),pointerLock:Yn()},qn=250,Xn=180,Wn=.5,Jn=50,Qn=250,Zn=10,Wt={mouse:0,touch:0,pen:8},er=B(B({},he),{},{device(t,e,{pointer:{touch:s=!1,lock:n=!1,mouse:i=!1}={}}){return this.pointerLock=n&&G.pointerLock,G.touch&&s?"touch":this.pointerLock?"mouse":G.pointer&&!i?"pointer":G.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:s}){if(this.preventScrollDelay=typeof s=="number"?s:s||s===void 0&&t?qn:void 0,!(!G.touchscreen||s===!1))return t||(s!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:s=!0,buttons:n=1,keys:i=!0}={}}){return this.pointerButtons=n,this.keys=i,!this.pointerLock&&this.device==="pointer"&&s},threshold(t,e,{filterTaps:s=!1,tapsThreshold:n=3,axis:i=void 0}){const o=P.toVector(t,s?n:i?1:0);return this.filterTaps=s,this.tapsThreshold=n,o},swipe({velocity:t=Wn,distance:e=Jn,duration:s=Qn}={}){return{velocity:this.transform(P.toVector(t)),distance:this.transform(P.toVector(e)),duration:s}},delay(t=0){switch(t){case!0:return Xn;case!1:return 0;default:return t}},axisThreshold(t){return t?B(B({},Wt),t):Wt},keyboardDisplacement(t=Zn){return t}});function js(t){const[e,s]=t.overflow,[n,i]=t._delta,[o,a]=t._direction;(e<0&&n>0&&o<0||e>0&&n<0&&o>0)&&(t._movement[0]=t._movementBound[0]),(s<0&&i>0&&a<0||s>0&&i<0&&a>0)&&(t._movement[1]=t._movementBound[1])}const tr=30,sr=100;class nr extends ys{constructor(...e){super(...e),$(this,"ingKey","pinching"),$(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:s,lastOffset:n}=this.state;e==="wheel"?this.state.offset=P.add(s,n):this.state.offset=[(1+s[0])*n[0],s[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:s}=this.state;this.state.movement=[e[0]/s[0],e[1]-s[1]]}axisIntent(){const e=this.state,[s,n]=e._movement;if(!e.axis){const i=Math.abs(s)*tr-Math.abs(n);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const s=this.state,n=this.ctrl.touchIds;if(s._active&&s._touchIds.every(o=>n.has(o))||n.size<2)return;this.start(e),s._touchIds=Array.from(n).slice(0,2);const i=Ht(e,s._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const s=this.state,n=s._pointerEvents,i=this.ctrl.pointerIds;if(s._active&&Array.from(n.keys()).every(a=>i.has(a))||(n.size<2&&n.set(e.pointerId,e),s._pointerEvents.size<2))return;this.start(e);const o=ht(...Array.from(n.values()));o&&this.pinchStart(e,o)}pinchStart(e,s){const n=this.state;n.origin=s.origin,this.computeValues([s.distance,s.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const s=Ht(e,this.state._touchIds);s&&this.pinchMove(e,s)}pointerMove(e){const s=this.state._pointerEvents;if(s.has(e.pointerId)&&s.set(e.pointerId,e),!this.state._active)return;const n=ht(...Array.from(s.values()));n&&this.pinchMove(e,n)}pinchMove(e,s){const n=this.state,i=n._values[1],o=s.angle-i;let a=0;Math.abs(o)>270&&(a+=Math.sign(o)),this.computeValues([s.distance,s.angle-360*a]),n.origin=s.origin,n.turns=a,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(s=>!this.ctrl.touchIds.has(s))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const s=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}s._pointerEvents.has(e.pointerId)&&s._pointerEvents.delete(e.pointerId),s._active&&s._pointerEvents.size<2&&(s._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const s=this.state;s._active||(this.start(e),this.computeValues([e.scale,e.rotation]),s.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const s=this.state;this.computeValues([e.scale,e.rotation]),s.origin=[e.clientX,e.clientY];const n=s._movement;s._movement=[e.scale-1,e.rotation],s._delta=P.sub(s._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const s=this.config.modifierKey;s&&(Array.isArray(s)?!s.find(n=>e[n]):!e[s])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const n=this.state;n._delta=[-xs(e)[1]/sr*n.offset[0],0],P.addTo(n._movement,n._delta),js(n),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const s=this.config.device;s&&(e(s,"start",this[s+"Start"].bind(this)),e(s,"change",this[s+"Move"].bind(this)),e(s,"end",this[s+"End"].bind(this)),e(s,"cancel",this[s+"End"].bind(this)),e("lostPointerCapture","",this[s+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const rr=B(B({},bs),{},{device(t,e,{shared:s,pointer:{touch:n=!1}={}}){if(s.target&&!G.touch&&G.gesture)return"gesture";if(G.touch&&n)return"touch";if(G.touchscreen){if(G.pointer)return"pointer";if(G.touch)return"touch"}},bounds(t,e,{scaleBounds:s={},angleBounds:n={}}){const i=a=>{const l=Gt(Ge(s,a),{min:-1/0,max:1/0});return[l.min,l.max]},o=a=>{const l=Gt(Ge(n,a),{min:-1/0,max:1/0});return[l.min,l.max]};return typeof s!="function"&&typeof n!="function"?[i(),o()]:a=>[i(a),o(a)]},threshold(t,e,s){return this.lockDirection=s.axis==="lock",P.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});class ir extends Pe{constructor(...e){super(...e),$(this,"ingKey","moving")}move(e){this.config.mouseOnly&&e.pointerType!=="mouse"||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(je(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;const s=je(e),n=this.state;n._delta=P.sub(s,n._values),P.addTo(n._movement,n._delta),this.computeValues(s),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}}const ar=B(B({},he),{},{mouseOnly:(t=!0)=>t});class or extends Pe{constructor(...e){super(...e),$(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const s=this.state,n=Pn(e);s._delta=P.sub(n,s._values),P.addTo(s._movement,s._delta),this.computeValues(n),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const cr=he;class lr extends Pe{constructor(...e){super(...e),$(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const s=this.state;s._delta=xs(e),P.addTo(s._movement,s._delta),js(s),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const dr=he;class ur extends Pe{constructor(...e){super(...e),$(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&e.pointerType!=="mouse"||(this.start(e),this.computeValues(je(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&e.pointerType!=="mouse")return;const s=this.state;if(!s._active)return;s._active=!1;const n=je(e);s._movement=s._delta=P.sub(n,s._values),this.computeValues(n),this.compute(e),s.delta=s.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}}const fr=B(B({},he),{},{mouseOnly:(t=!0)=>t}),bt=new Map,mt=new Map;function hr(t){bt.set(t.key,t.engine),mt.set(t.key,t.resolver)}const mr={key:"drag",engine:Kn,resolver:er},gr={key:"hover",engine:ur,resolver:fr},pr={key:"move",engine:ir,resolver:ar},xr={key:"pinch",engine:nr,resolver:rr},yr={key:"scroll",engine:or,resolver:cr},br={key:"wheel",engine:lr,resolver:dr};function vr(t,e){if(t==null)return{};var s={},n=Object.keys(t),i,o;for(o=0;o<n.length;o++)i=n[o],!(e.indexOf(i)>=0)&&(s[i]=t[i]);return s}function jr(t,e){if(t==null)return{};var s=vr(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}const _r={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=G.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},kr=["target","eventOptions","window","enabled","transform"];function He(t={},e){const s={};for(const[n,i]of Object.entries(e))switch(typeof i){case"function":s[n]=i.call(s,t[n],n,t);break;case"object":s[n]=He(t[n],i);break;case"boolean":i&&(s[n]=t[n]);break}return s}function wr(t,e,s={}){const n=t,{target:i,eventOptions:o,window:a,enabled:l,transform:c}=n,d=jr(n,kr);if(s.shared=He({target:i,eventOptions:o,window:a,enabled:l,transform:c},_r),e){const f=mt.get(e);s[e]=He(B({shared:s.shared},d),f)}else for(const f in d){const h=mt.get(f);h&&(s[f]=He(B({shared:s.shared},d[f]),h))}return s}let _s=class{constructor(e,s){$(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=s}add(e,s,n,i,o){const a=this._listeners,l=An(s,n),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},d=B(B({},c),o);e.addEventListener(l,i,d);const f=()=>{e.removeEventListener(l,i,d),a.delete(f)};return a.add(f),f}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}};class Nr{constructor(){$(this,"_timeouts",new Map)}add(e,s,n=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(s,n,...i))}remove(e){const s=this._timeouts.get(e);s&&window.clearTimeout(s)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Sr{constructor(e){$(this,"gestures",new Set),$(this,"_targetEventStore",new _s(this)),$(this,"gestureEventStores",{}),$(this,"gestureTimeoutStores",{}),$(this,"handlers",{}),$(this,"config",{}),$(this,"pointerIds",new Set),$(this,"touchIds",new Set),$(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Er(this,e)}setEventIds(e){if(et(e))return this.touchIds=new Set(Mn(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,s){this.handlers=e,this.nativeHandlers=s}applyConfig(e,s){this.config=wr(e,s,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const s=this.config.shared,n={};let i;if(!(s.target&&(i=s.target(),!i))){if(s.enabled){for(const a of this.gestures){const l=this.config[a],c=Jt(n,l.eventOptions,!!i);if(l.enabled){const d=bt.get(a);new d(this,e,a).bind(c)}}const o=Jt(n,s.eventOptions,!!i);for(const a in this.nativeHandlers)o(a,"",l=>this.nativeHandlers[a](B(B({},this.state.shared),{},{event:l,args:e})),void 0,!0)}for(const o in n)n[o]=Fn(...n[o]);if(!i)return n;for(const o in n){const{device:a,capture:l,passive:c}=Tn(o);this._targetEventStore.add(i,a,"",n[o],{capture:l,passive:c})}}}}function xe(t,e){t.gestures.add(e),t.gestureEventStores[e]=new _s(t,e),t.gestureTimeoutStores[e]=new Nr}function Er(t,e){e.drag&&xe(t,"drag"),e.wheel&&xe(t,"wheel"),e.scroll&&xe(t,"scroll"),e.move&&xe(t,"move"),e.pinch&&xe(t,"pinch"),e.hover&&xe(t,"hover")}const Jt=(t,e,s)=>(n,i,o,a={},l=!1)=>{var c,d;const f=(c=a.capture)!==null&&c!==void 0?c:e.capture,h=(d=a.passive)!==null&&d!==void 0?d:e.passive;let u=l?n:En(n,i,f);s&&h&&(u+="Passive"),t[u]=t[u]||[],t[u].push(o)},Cr=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Tr(t){const e={},s={},n=new Set;for(let i in t)Cr.test(i)?(n.add(RegExp.lastMatch),s[i]=t[i]):e[i]=t[i];return[s,e,n]}function ye(t,e,s,n,i,o){if(!t.has(s)||!bt.has(n))return;const a=s+"Start",l=s+"End",c=d=>{let f;return d.first&&a in e&&e[a](d),s in e&&(f=e[s](d)),d.last&&l in e&&e[l](d),f};i[n]=c,o[n]=o[n]||{}}function Ar(t,e){const[s,n,i]=Tr(t),o={};return ye(i,s,"onDrag","drag",o,e),ye(i,s,"onWheel","wheel",o,e),ye(i,s,"onScroll","scroll",o,e),ye(i,s,"onPinch","pinch",o,e),ye(i,s,"onMove","move",o,e),ye(i,s,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:n}}function Ir(t,e={},s,n){const i=ot.useMemo(()=>new Sr(t),[]);if(i.applyHandlers(t,n),i.applyConfig(e,s),ot.useEffect(i.effect.bind(i)),ot.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function Dr(t){return t.forEach(hr),function(s,n){const{handlers:i,nativeHandlers:o,config:a}=Ar(s,n||{});return Ir(i,a,void 0,o)}}function Mr(t,e){return Dr([mr,xr,yr,br,pr,gr])(t,e||{})}function lt({children:t,className:e="",minScale:s=1,maxScale:n=3}){const i=C.useRef(null),[o,a]=C.useState(1),[l,c]=C.useState({x:0,y:0}),d=C.useCallback(()=>{a(1),c({x:0,y:0})},[]);return Mr({onPinch:({offset:[f],memo:h})=>{const u=Math.min(n,Math.max(s,f));return a(u),u<=1&&c({x:0,y:0}),h},onDrag:({offset:[f,h],pinching:u})=>{if(o>1&&!u){const x=(o-1)*100/2;c({x:Math.min(x,Math.max(-x,f)),y:Math.min(x,Math.max(-x,h))})}},onWheel:({delta:[,f],event:h})=>{h.preventDefault();const u=Math.min(n,Math.max(s,o-f*.01));a(u),u<=1&&c({x:0,y:0})}},{target:i,pinch:{scaleBounds:{min:s,max:n}},drag:{filterTaps:!0},wheel:{preventDefault:!0}}),r.jsxs("div",{className:`relative overflow-hidden touch-none ${e}`,children:[r.jsx("div",{ref:i,style:{transform:`scale(${o}) translate(${l.x}px, ${l.y}px)`,transformOrigin:"center center",transition:"transform 0.1s ease-out"},className:"w-full h-full",children:t}),o>1&&r.jsxs("button",{onClick:d,className:"absolute bottom-2 right-2 px-2 py-1 text-xs bg-gray-800/70 text-white rounded-md hover:bg-gray-700/70 transition-colors",children:[Math.round(o*100),"% - Tap to reset"]})]})}const Pr={spike:"ðŸ“ˆ",trend:"ðŸ“Š",unusual:"ðŸ”",budget:"ðŸ’°",saving:"âœ¨"},Lr={info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"},Or={info:"text-blue-700 dark:text-blue-300",warning:"text-amber-700 dark:text-amber-300",success:"text-green-700 dark:text-green-300"};function Fr({insight:t}){const{currency:e}=_e(),{data:s}=ke();return r.jsx("div",{className:`p-4 rounded-lg border ${Lr[t.severity]} transition-all hover:shadow-sm`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:Pr[t.type]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:`font-medium ${Or[t.severity]}`,children:t.title}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t.message}),t.amount&&r.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-2",children:I(t.amount,e,(s==null?void 0:s.rates)||{},!1)})]}),t.percentage_change!==void 0&&r.jsxs("span",{className:`text-sm font-medium px-2 py-1 rounded ${t.percentage_change>0?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400":"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"}`,children:[t.percentage_change>0?"+":"",t.percentage_change.toFixed(0),"%"]})]})})}function Br(){const{t}=R("common"),{data:e,isLoading:s,error:n}=be({queryKey:["spending-insights"],queryFn:ns,staleTime:5*60*1e3});if(s)return r.jsxs(K,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:t("analytics.spendingInsights","Spending Insights")}),r.jsx("div",{className:"flex justify-center py-8",children:r.jsx(ve,{size:"md"})})]});if(n)return r.jsxs(K,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:t("analytics.spendingInsights","Spending Insights")}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:t("error","Failed to load insights")})]});const i=(e==null?void 0:e.insights)||[];return r.jsxs(K,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:t("analytics.spendingInsights","Spending Insights")}),i.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("span",{className:"text-4xl mb-3 block",children:"ðŸŽ‰"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("analytics.noInsights","No notable spending patterns detected")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:t("analytics.insightsHint","Keep tracking to see personalized insights")})]}):r.jsx("div",{className:"space-y-3",children:i.map((o,a)=>r.jsx(Fr,{insight:o},`${o.type}-${o.category}-${a}`))})]})}const $e=50,Rr=.5;function zr({suggestion:t,isSelected:e,onToggle:s}){const{currency:n}=_e(),{data:i}=ke(),{t:o}=R("common"),a=t.confidence>=.8?"text-green-600 dark:text-green-400":t.confidence>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return r.jsxs("div",{className:`p-3 rounded-lg border transition-colors cursor-pointer ${e?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>s(t.transaction_id,t.suggested_category),children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:t.description}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:I(t.amount,n,(i==null?void 0:i.rates)||{},!1)})]}),r.jsxs("div",{className:"text-right flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[t.is_new_category&&r.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:o("ai.newCategory")}),r.jsx("span",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:t.suggested_category})]}),r.jsxs("p",{className:`text-xs mt-1 ${a}`,children:[Math.round(t.confidence*100),"% ",o("ai.confidence")]})]})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 italic",children:t.reason})]})}function $r(){const{t,i18n:e}=R("common"),s=$s(),[n,i]=C.useState(null),[o,a]=C.useState(new Map),[l,c]=C.useState(!0),[d,f]=C.useState(0),[h,u]=C.useState(null),x=C.useRef(!1),m=dt({mutationFn:()=>Lt($e,e.language),onSuccess:j=>{i(j),f(j.total_other_count);const N=new Map;j.suggestions.forEach(S=>{S.confidence>=.7&&N.set(S.transaction_id,S.suggested_category)}),a(N)}}),g=dt({mutationFn:()=>Ot({approved:Array.from(o.entries()).map(([j,N])=>({transaction_id:j,category:N})),create_rules:l}),onSuccess:()=>{s.invalidateQueries({queryKey:["analytics"]}),s.invalidateQueries({queryKey:["transactions"]});const j=d-o.size;j>0?(f(j),i(null),a(new Map),setTimeout(()=>m.mutate(),500)):(i(null),a(new Map),f(0))}}),b=C.useCallback(async()=>{x.current=!1;const j=Math.ceil(d/$e);let N=0;u({isRunning:!0,processed:0,total:d,currentBatch:0,totalBatches:j});for(let S=0;S<j&&!x.current;S++){u(T=>T?{...T,currentBatch:S+1}:null);try{const T=await Lt($e,e.language);if(T.suggestions.length===0||x.current)break;const A=T.suggestions.filter(L=>L.confidence>=.7).map(L=>({transaction_id:L.transaction_id,category:L.suggested_category}));A.length>0&&(await Ot({approved:A,create_rules:l}),N+=A.length),u(L=>L?{...L,processed:N}:null),await new Promise(L=>setTimeout(L,300))}catch{break}}u(null),s.invalidateQueries({queryKey:["analytics"]}),s.invalidateQueries({queryKey:["transactions"]}),i(null),f(0)},[d,e.language,l,s]),p=()=>{x.current=!0,u(null)},y=(j,N)=>{a(S=>{const T=new Map(S);return T.has(j)?T.delete(j):T.set(j,N),T})},v=()=>{if(!n)return;const j=new Map;n.suggestions.forEach(N=>{j.set(N.transaction_id,N.suggested_category)}),a(j)},k=()=>{a(new Map)};if(h!=null&&h.isRunning){const j=h.total>0?Math.round(h.processed/h.total*100):0;return r.jsx(K,{children:r.jsxs("div",{className:"py-8",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 text-center mb-4",children:t("ai.processingAll")}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2",children:r.jsx("div",{className:"bg-primary-500 h-4 rounded-full transition-[width] duration-300",style:{width:`${j}%`}})}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-4",children:t("ai.processProgress",{processed:h.processed,total:h.total,batch:h.currentBatch,totalBatches:h.totalBatches})}),r.jsx("div",{className:"text-center",children:r.jsx(ee,{variant:"outline",onClick:p,children:t("cancel")})})]})})}if(!n){const j=d,N=j>250,S=Math.ceil(j/$e)*Rr;return r.jsxs(K,{children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("ai.categoryCleanup")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("ai.categoryCleanupDesc")}),j>0&&r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:t("ai.remainingOther",{count:j})})]}),r.jsxs("div",{className:"flex gap-2 flex-wrap",children:[r.jsx(ee,{onClick:()=>m.mutate(),disabled:m.isPending,children:m.isPending?r.jsxs(r.Fragment,{children:[r.jsx(ve,{size:"sm",className:"mr-2"}),t("ai.analyzing")]}):t("ai.analyzeOther")}),N&&r.jsx(ee,{variant:"outline",onClick:b,disabled:m.isPending,title:t("ai.analyzeAllCredits",{credits:S.toFixed(1)}),children:t("ai.analyzeAll",{count:j})})]})]}),m.isError&&r.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:t("ai.analyzeError")})]})}if(n.suggestions.length===0)return r.jsx(K,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("ai.noSuggestions")}),r.jsx(ee,{variant:"outline",onClick:()=>i(null),className:"mt-4",children:t("close")})]})});const E=d-n.suggestions.length,w=E>250;return r.jsxs(K,{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("ai.categoryCleanup")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("ai.foundSuggestions",{count:n.suggestions.length,total:d})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(ee,{variant:"outline",size:"sm",onClick:v,children:t("ai.selectAll")}),r.jsx(ee,{variant:"outline",size:"sm",onClick:k,children:t("ai.deselectAll")})]})]}),n.new_categories_suggested.length>0&&r.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:r.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[t("ai.newCategoriesSuggested"),": ",n.new_categories_suggested.join(", ")]})}),r.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:n.suggestions.map(j=>r.jsx(zr,{suggestion:j,isSelected:o.has(j.transaction_id),onToggle:y},j.transaction_id))}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[r.jsx("input",{type:"checkbox",checked:l,onChange:j=>c(j.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),t("ai.createRulesAuto")]}),r.jsxs("div",{className:"flex gap-2 flex-wrap",children:[r.jsx(ee,{variant:"outline",onClick:()=>i(null),children:t("cancel")}),w&&r.jsx(ee,{variant:"outline",onClick:b,disabled:g.isPending,children:t("ai.analyzeAll",{count:E})}),r.jsx(ee,{onClick:()=>g.mutate(),disabled:o.size===0||g.isPending,children:g.isPending?r.jsxs(r.Fragment,{children:[r.jsx(ve,{size:"sm",className:"mr-2"}),t("ai.applying")]}):t("ai.applySelected",{count:o.size})})]})]}),g.isError&&r.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:t("ai.applyError")})]})]})}function ce({label:t,value:e,change:s,trend:n="neutral",subtitle:i,className:o,hero:a=!1}){const{t:l}=R("common"),c=()=>n==="positive"?"text-income-600 dark:text-income-300":n==="negative"?"text-expense-600 dark:text-expense-300":"text-gray-500 dark:text-gray-400",d=()=>s==null?null:s>0?"â†‘":s<0?"â†“":"â†’";return r.jsxs("div",{className:M("bg-white dark:bg-gray-800 rounded-xl p-4 shadow-card","border border-gray-100 dark:border-gray-700",o),children:[r.jsx("p",{className:"text-[11px] font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1.5",children:t}),r.jsx("p",{className:M("font-extrabold tracking-tight text-gray-900 dark:text-gray-100 font-numbers truncate",a?"text-3xl sm:text-4xl tracking-tighter":"text-2xl"),children:e}),s!=null&&r.jsxs("div",{className:M("flex items-center gap-1.5 mt-1.5",c()),children:[r.jsxs("span",{className:"text-sm font-semibold",children:[d()," ",Math.abs(s).toFixed(1),"%"]}),r.jsx("span",{className:"text-xs text-gray-400",children:l("analytics.vsLastPeriod")})]}),i&&r.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mt-1.5 truncate",children:i})]})}function Kr({analytics:t,displayCurrency:e="JPY"}){const{t:s}=R("common"),{total_income:n,total_expense:i,net_cashflow:o,comparison:a,top_category:l}=t,c=()=>a!=null&&a.income_change?a.income_change>0?"positive":"negative":"neutral",d=()=>a!=null&&a.expense_change?a.expense_change<0?"positive":"negative":"neutral",f=()=>a!=null&&a.net_change?a.net_change>0?"positive":"negative":"neutral";return r.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[r.jsx(ce,{label:s("analytics.heroNet"),value:I(o,e),change:a==null?void 0:a.net_change,trend:f(),hero:!0,className:"col-span-2 bg-hero-gradient"}),r.jsx(ce,{label:s("analytics.heroIncome"),value:I(n,e),change:a==null?void 0:a.income_change,trend:c(),className:"bg-income-50/50 dark:bg-income-900/10 border-income-100 dark:border-income-900/20"}),r.jsx(ce,{label:s("analytics.heroExpense"),value:I(i,e),change:a==null?void 0:a.expense_change,trend:d(),className:"bg-expense-50/50 dark:bg-expense-900/10 border-expense-100 dark:border-expense-900/20"}),r.jsx(ce,{label:s("analytics.heroTopCategory"),value:(l==null?void 0:l.name)||"-",subtitle:l?`${I(l.amount,e)} (${l.percentage}%)`:void 0,className:"col-span-2"})]})}function Vr(t){return Object.prototype.toString.call(t)==="[object Object]"}function Qt(t){return Vr(t)||Array.isArray(t)}function Hr(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function vt(t,e){const s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;const i=JSON.stringify(Object.keys(t.breakpoints||{})),o=JSON.stringify(Object.keys(e.breakpoints||{}));return i!==o?!1:s.every(a=>{const l=t[a],c=e[a];return typeof l=="function"?`${l}`==`${c}`:!Qt(l)||!Qt(c)?l===c:vt(l,c)})}function Zt(t){return t.concat().sort((e,s)=>e.name>s.name?1:-1).map(e=>e.options)}function Ur(t,e){if(t.length!==e.length)return!1;const s=Zt(t),n=Zt(e);return s.every((i,o)=>{const a=n[o];return vt(i,a)})}function jt(t){return typeof t=="number"}function gt(t){return typeof t=="string"}function tt(t){return typeof t=="boolean"}function es(t){return Object.prototype.toString.call(t)==="[object Object]"}function F(t){return Math.abs(t)}function _t(t){return Math.sign(t)}function Ae(t,e){return F(t-e)}function Yr(t,e){if(t===0||e===0||F(t)<=F(e))return 0;const s=Ae(F(t),F(e));return F(s/t)}function Gr(t){return Math.round(t*100)/100}function Ie(t){return De(t).map(Number)}function q(t){return t[Oe(t)]}function Oe(t){return Math.max(0,t.length-1)}function kt(t,e){return e===Oe(t)}function ts(t,e=0){return Array.from(Array(t),(s,n)=>e+n)}function De(t){return Object.keys(t)}function ks(t,e){return[t,e].reduce((s,n)=>(De(n).forEach(i=>{const o=s[i],a=n[i],l=es(o)&&es(a);s[i]=l?ks(o,a):a}),s),{})}function pt(t,e){return typeof e.MouseEvent<"u"&&t instanceof e.MouseEvent}function qr(t,e){const s={start:n,center:i,end:o};function n(){return 0}function i(c){return o(c)/2}function o(c){return e-c}function a(c,d){return gt(t)?s[t](c):t(e,c,d)}return{measure:a}}function Me(){let t=[];function e(i,o,a,l={passive:!0}){let c;if("addEventListener"in i)i.addEventListener(o,a,l),c=()=>i.removeEventListener(o,a,l);else{const d=i;d.addListener(a),c=()=>d.removeListener(a)}return t.push(c),n}function s(){t=t.filter(i=>i())}const n={add:e,clear:s};return n}function Xr(t,e,s,n){const i=Me(),o=1e3/60;let a=null,l=0,c=0;function d(){i.add(t,"visibilitychange",()=>{t.hidden&&m()})}function f(){x(),i.clear()}function h(b){if(!c)return;a||(a=b,s(),s());const p=b-a;for(a=b,l+=p;l>=o;)s(),l-=o;const y=l/o;n(y),c&&(c=e.requestAnimationFrame(h))}function u(){c||(c=e.requestAnimationFrame(h))}function x(){e.cancelAnimationFrame(c),a=null,l=0,c=0}function m(){a=null,l=0}return{init:d,destroy:f,start:u,stop:x,update:s,render:n}}function Wr(t,e){const s=e==="rtl",n=t==="y",i=n?"y":"x",o=n?"x":"y",a=!n&&s?-1:1,l=f(),c=h();function d(m){const{height:g,width:b}=m;return n?g:b}function f(){return n?"top":s?"right":"left"}function h(){return n?"bottom":s?"left":"right"}function u(m){return m*a}return{scroll:i,cross:o,startEdge:l,endEdge:c,measureSize:d,direction:u}}function fe(t=0,e=0){const s=F(t-e);function n(d){return d<t}function i(d){return d>e}function o(d){return n(d)||i(d)}function a(d){return o(d)?n(d)?t:e:d}function l(d){return s?d-s*Math.ceil((d-e)/s):d}return{length:s,max:e,min:t,constrain:a,reachedAny:o,reachedMax:i,reachedMin:n,removeOffset:l}}function ws(t,e,s){const{constrain:n}=fe(0,t),i=t+1;let o=a(e);function a(u){return s?F((i+u)%i):n(u)}function l(){return o}function c(u){return o=a(u),h}function d(u){return f().set(l()+u)}function f(){return ws(t,l(),s)}const h={get:l,set:c,add:d,clone:f};return h}function Jr(t,e,s,n,i,o,a,l,c,d,f,h,u,x,m,g,b,p,y){const{cross:v,direction:k}=t,E=["INPUT","SELECT","TEXTAREA"],w={passive:!1},j=Me(),N=Me(),S=fe(50,225).constrain(x.measure(20)),T={mouse:300,touch:400},A={mouse:500,touch:600},L=m?43:25;let X=!1,W=0,J=0,le=!1,ae=!1,te=!1,se=!1;function we(_){if(!y)return;function D(H){(tt(y)||y(_,H))&&Se(H)}const z=e;j.add(z,"dragstart",H=>H.preventDefault(),w).add(z,"touchmove",()=>{},w).add(z,"touchend",()=>{}).add(z,"touchstart",D).add(z,"mousedown",D).add(z,"touchcancel",V).add(z,"contextmenu",V).add(z,"click",re,!0)}function Q(){j.clear(),N.clear()}function me(){const _=se?s:e;N.add(_,"touchmove",U,w).add(_,"touchend",V).add(_,"mousemove",U,w).add(_,"mouseup",V)}function ge(_){const D=_.nodeName||"";return E.includes(D)}function ne(){return(m?A:T)[se?"mouse":"touch"]}function Ne(_,D){const z=h.add(_t(_)*-1),H=f.byDistance(_,!m).distance;return m||F(_)<S?H:b&&D?H*.5:f.byIndex(z.get(),0).distance}function Se(_){const D=pt(_,n);se=D,te=m&&D&&!_.buttons&&X,X=Ae(i.get(),a.get())>=2,!(D&&_.button!==0)&&(ge(_.target)||(le=!0,o.pointerDown(_),d.useFriction(0).useDuration(0),i.set(a),me(),W=o.readPoint(_),J=o.readPoint(_,v),u.emit("pointerDown")))}function U(_){if(!pt(_,n)&&_.touches.length>=2)return V(_);const z=o.readPoint(_),H=o.readPoint(_,v),Z=Ae(z,W),ie=Ae(H,J);if(!ae&&!se&&(!_.cancelable||(ae=Z>ie,!ae)))return V(_);const de=o.pointerMove(_);Z>g&&(te=!0),d.useFriction(.3).useDuration(.75),l.start(),i.add(k(de)),_.preventDefault()}function V(_){const z=f.byDistance(0,!1).index!==h.get(),H=o.pointerUp(_)*ne(),Z=Ne(k(H),z),ie=Yr(H,Z),de=L-10*ie,oe=p+ie/50;ae=!1,le=!1,N.clear(),d.useDuration(de).useFriction(oe),c.distance(Z,!m),se=!1,u.emit("pointerUp")}function re(_){te&&(_.stopPropagation(),_.preventDefault(),te=!1)}function Y(){return le}return{init:we,destroy:Q,pointerDown:Y}}function Qr(t,e){let n,i;function o(h){return h.timeStamp}function a(h,u){const m=`client${(u||t.scroll)==="x"?"X":"Y"}`;return(pt(h,e)?h:h.touches[0])[m]}function l(h){return n=h,i=h,a(h)}function c(h){const u=a(h)-a(i),x=o(h)-o(n)>170;return i=h,x&&(n=h),u}function d(h){if(!n||!i)return 0;const u=a(i)-a(n),x=o(h)-o(n),m=o(h)-o(i)>170,g=u/x;return x&&!m&&F(g)>.1?g:0}return{pointerDown:l,pointerMove:c,pointerUp:d,readPoint:a}}function Zr(){function t(s){const{offsetTop:n,offsetLeft:i,offsetWidth:o,offsetHeight:a}=s;return{top:n,right:i+o,bottom:n+a,left:i,width:o,height:a}}return{measure:t}}function ei(t){function e(n){return t*(n/100)}return{measure:e}}function ti(t,e,s,n,i,o,a){const l=[t].concat(n);let c,d,f=[],h=!1;function u(b){return i.measureSize(a.measure(b))}function x(b){if(!o)return;d=u(t),f=n.map(u);function p(y){for(const v of y){if(h)return;const k=v.target===t,E=n.indexOf(v.target),w=k?d:f[E],j=u(k?t:n[E]);if(F(j-w)>=.5){b.reInit(),e.emit("resize");break}}}c=new ResizeObserver(y=>{(tt(o)||o(b,y))&&p(y)}),s.requestAnimationFrame(()=>{l.forEach(y=>c.observe(y))})}function m(){h=!0,c&&c.disconnect()}return{init:x,destroy:m}}function si(t,e,s,n,i,o){let a=0,l=0,c=i,d=o,f=t.get(),h=0;function u(){const w=n.get()-t.get(),j=!c;let N=0;return j?(a=0,s.set(n),t.set(n),N=w):(s.set(t),a+=w/c,a*=d,f+=a,t.add(a),N=f-h),l=_t(N),h=f,E}function x(){const w=n.get()-e.get();return F(w)<.001}function m(){return c}function g(){return l}function b(){return a}function p(){return v(i)}function y(){return k(o)}function v(w){return c=w,E}function k(w){return d=w,E}const E={direction:g,duration:m,velocity:b,seek:u,settled:x,useBaseFriction:y,useBaseDuration:p,useFriction:k,useDuration:v};return E}function ni(t,e,s,n,i){const o=i.measure(10),a=i.measure(50),l=fe(.1,.99);let c=!1;function d(){return!(c||!t.reachedAny(s.get())||!t.reachedAny(e.get()))}function f(x){if(!d())return;const m=t.reachedMin(e.get())?"min":"max",g=F(t[m]-e.get()),b=s.get()-e.get(),p=l.constrain(g/a);s.subtract(b*p),!x&&F(b)<o&&(s.set(t.constrain(s.get())),n.useDuration(25).useBaseFriction())}function h(x){c=!x}return{shouldConstrain:d,constrain:f,toggleActive:h}}function ri(t,e,s,n,i){const o=fe(-e+t,0),a=h(),l=f(),c=u();function d(m,g){return Ae(m,g)<=1}function f(){const m=a[0],g=q(a),b=a.lastIndexOf(m),p=a.indexOf(g)+1;return fe(b,p)}function h(){return s.map((m,g)=>{const{min:b,max:p}=o,y=o.constrain(m),v=!g,k=kt(s,g);return v?p:k||d(b,y)?b:d(p,y)?p:y}).map(m=>parseFloat(m.toFixed(3)))}function u(){if(e<=t+i)return[o.max];if(n==="keepSnaps")return a;const{min:m,max:g}=l;return a.slice(m,g)}return{snapsContained:c,scrollContainLimit:l}}function ii(t,e,s){const n=e[0],i=s?n-t:q(e);return{limit:fe(i,n)}}function ai(t,e,s,n){const o=e.min+.1,a=e.max+.1,{reachedMin:l,reachedMax:c}=fe(o,a);function d(u){return u===1?c(s.get()):u===-1?l(s.get()):!1}function f(u){if(!d(u))return;const x=t*(u*-1);n.forEach(m=>m.add(x))}return{loop:f}}function oi(t){const{max:e,length:s}=t;function n(o){const a=o-e;return s?a/-s:0}return{get:n}}function ci(t,e,s,n,i){const{startEdge:o,endEdge:a}=t,{groupSlides:l}=i,c=h().map(e.measure),d=u(),f=x();function h(){return l(n).map(g=>q(g)[a]-g[0][o]).map(F)}function u(){return n.map(g=>s[o]-g[o]).map(g=>-F(g))}function x(){return l(d).map(g=>g[0]).map((g,b)=>g+c[b])}return{snaps:d,snapsAligned:f}}function li(t,e,s,n,i,o){const{groupSlides:a}=i,{min:l,max:c}=n,d=f();function f(){const u=a(o),x=!t||e==="keepSnaps";return s.length===1?[o]:x?u:u.slice(l,c).map((m,g,b)=>{const p=!g,y=kt(b,g);if(p){const v=q(b[0])+1;return ts(v)}if(y){const v=Oe(o)-q(b)[0]+1;return ts(v,q(b)[0])}return m})}return{slideRegistry:d}}function di(t,e,s,n,i){const{reachedAny:o,removeOffset:a,constrain:l}=n;function c(m){return m.concat().sort((g,b)=>F(g)-F(b))[0]}function d(m){const g=t?a(m):l(m),b=e.map((y,v)=>({diff:f(y-g,0),index:v})).sort((y,v)=>F(y.diff)-F(v.diff)),{index:p}=b[0];return{index:p,distance:g}}function f(m,g){const b=[m,m+s,m-s];if(!t)return m;if(!g)return c(b);const p=b.filter(y=>_t(y)===g);return p.length?c(p):q(b)-s}function h(m,g){const b=e[m]-i.get(),p=f(b,g);return{index:m,distance:p}}function u(m,g){const b=i.get()+m,{index:p,distance:y}=d(b),v=!t&&o(b);if(!g||v)return{index:p,distance:m};const k=e[p]-y,E=m+f(k,0);return{index:p,distance:E}}return{byDistance:u,byIndex:h,shortcut:f}}function ui(t,e,s,n,i,o,a){function l(h){const u=h.distance,x=h.index!==e.get();o.add(u),u&&(n.duration()?t.start():(t.update(),t.render(1),t.update())),x&&(s.set(e.get()),e.set(h.index),a.emit("select"))}function c(h,u){const x=i.byDistance(h,u);l(x)}function d(h,u){const x=e.clone().set(h),m=i.byIndex(x.get(),u);l(m)}return{distance:c,index:d}}function fi(t,e,s,n,i,o,a,l){const c={passive:!0,capture:!0};let d=0;function f(x){if(!l)return;function m(g){if(new Date().getTime()-d>10)return;a.emit("slideFocusStart"),t.scrollLeft=0;const y=s.findIndex(v=>v.includes(g));jt(y)&&(i.useDuration(0),n.index(y,0),a.emit("slideFocus"))}o.add(document,"keydown",h,!1),e.forEach((g,b)=>{o.add(g,"focus",p=>{(tt(l)||l(x,p))&&m(b)},c)})}function h(x){x.code==="Tab"&&(d=new Date().getTime())}return{init:f}}function Te(t){let e=t;function s(){return e}function n(c){e=a(c)}function i(c){e+=a(c)}function o(c){e-=a(c)}function a(c){return jt(c)?c:c.get()}return{get:s,set:n,add:i,subtract:o}}function Ns(t,e){const s=t.scroll==="x"?a:l,n=e.style;let i=null,o=!1;function a(u){return`translate3d(${u}px,0px,0px)`}function l(u){return`translate3d(0px,${u}px,0px)`}function c(u){if(o)return;const x=Gr(t.direction(u));x!==i&&(n.transform=s(x),i=x)}function d(u){o=!u}function f(){o||(n.transform="",e.getAttribute("style")||e.removeAttribute("style"))}return{clear:f,to:c,toggleActive:d}}function hi(t,e,s,n,i,o,a,l,c){const f=Ie(i),h=Ie(i).reverse(),u=p().concat(y());function x(j,N){return j.reduce((S,T)=>S-i[T],N)}function m(j,N){return j.reduce((S,T)=>x(S,N)>0?S.concat([T]):S,[])}function g(j){return o.map((N,S)=>({start:N-n[S]+.5+j,end:N+e-.5+j}))}function b(j,N,S){const T=g(N);return j.map(A=>{const L=S?0:-s,X=S?s:0,W=S?"end":"start",J=T[A][W];return{index:A,loopPoint:J,slideLocation:Te(-1),translate:Ns(t,c[A]),target:()=>l.get()>J?L:X}})}function p(){const j=a[0],N=m(h,j);return b(N,s,!1)}function y(){const j=e-a[0]-1,N=m(f,j);return b(N,-s,!0)}function v(){return u.every(({index:j})=>{const N=f.filter(S=>S!==j);return x(N,e)<=.1})}function k(){u.forEach(j=>{const{target:N,translate:S,slideLocation:T}=j,A=N();A!==T.get()&&(S.to(A),T.set(A))})}function E(){u.forEach(j=>j.translate.clear())}return{canLoop:v,clear:E,loop:k,loopPoints:u}}function mi(t,e,s){let n,i=!1;function o(c){if(!s)return;function d(f){for(const h of f)if(h.type==="childList"){c.reInit(),e.emit("slidesChanged");break}}n=new MutationObserver(f=>{i||(tt(s)||s(c,f))&&d(f)}),n.observe(t,{childList:!0})}function a(){n&&n.disconnect(),i=!0}return{init:o,destroy:a}}function gi(t,e,s,n){const i={};let o=null,a=null,l,c=!1;function d(){l=new IntersectionObserver(m=>{c||(m.forEach(g=>{const b=e.indexOf(g.target);i[b]=g}),o=null,a=null,s.emit("slidesInView"))},{root:t.parentElement,threshold:n}),e.forEach(m=>l.observe(m))}function f(){l&&l.disconnect(),c=!0}function h(m){return De(i).reduce((g,b)=>{const p=parseInt(b),{isIntersecting:y}=i[p];return(m&&y||!m&&!y)&&g.push(p),g},[])}function u(m=!0){if(m&&o)return o;if(!m&&a)return a;const g=h(m);return m&&(o=g),m||(a=g),g}return{init:d,destroy:f,get:u}}function pi(t,e,s,n,i,o){const{measureSize:a,startEdge:l,endEdge:c}=t,d=s[0]&&i,f=m(),h=g(),u=s.map(a),x=b();function m(){if(!d)return 0;const y=s[0];return F(e[l]-y[l])}function g(){if(!d)return 0;const y=o.getComputedStyle(q(n));return parseFloat(y.getPropertyValue(`margin-${c}`))}function b(){return s.map((y,v,k)=>{const E=!v,w=kt(k,v);return E?u[v]+f:w?u[v]+h:k[v+1][l]-y[l]}).map(F)}return{slideSizes:u,slideSizesWithGaps:x,startGap:f,endGap:h}}function xi(t,e,s,n,i,o,a,l,c){const{startEdge:d,endEdge:f,direction:h}=t,u=jt(s);function x(p,y){return Ie(p).filter(v=>v%y===0).map(v=>p.slice(v,v+y))}function m(p){return p.length?Ie(p).reduce((y,v,k)=>{const E=q(y)||0,w=E===0,j=v===Oe(p),N=i[d]-o[E][d],S=i[d]-o[v][f],T=!n&&w?h(a):0,A=!n&&j?h(l):0,L=F(S-A-(N+T));return k&&L>e+c&&y.push(v),j&&y.push(p.length),y},[]).map((y,v,k)=>{const E=Math.max(k[v-1]||0);return p.slice(E,y)}):[]}function g(p){return u?x(p,s):m(p)}return{groupSlides:g}}function yi(t,e,s,n,i,o,a){const{align:l,axis:c,direction:d,startIndex:f,loop:h,duration:u,dragFree:x,dragThreshold:m,inViewThreshold:g,slidesToScroll:b,skipSnaps:p,containScroll:y,watchResize:v,watchSlides:k,watchDrag:E,watchFocus:w}=o,j=2,N=Zr(),S=N.measure(e),T=s.map(N.measure),A=Wr(c,d),L=A.measureSize(S),X=ei(L),W=qr(l,L),J=!h&&!!y,le=h||!!y,{slideSizes:ae,slideSizesWithGaps:te,startGap:se,endGap:we}=pi(A,S,T,s,le,i),Q=xi(A,L,b,h,S,T,se,we,j),{snaps:me,snapsAligned:ge}=ci(A,W,S,T,Q),ne=-q(me)+q(te),{snapsContained:Ne,scrollContainLimit:Se}=ri(L,ne,ge,y,j),U=J?Ne:ge,{limit:V}=ii(ne,U,h),re=ws(Oe(U),f,h),Y=re.clone(),O=Ie(s),_=({dragHandler:pe,scrollBody:it,scrollBounds:at,options:{loop:Fe}})=>{Fe||at.constrain(pe.pointerDown()),it.seek()},D=({scrollBody:pe,translate:it,location:at,offsetLocation:Fe,previousLocation:As,scrollLooper:Is,slideLooper:Ds,dragHandler:Ms,animation:Ps,eventHandler:Ct,scrollBounds:Ls,options:{loop:Tt}},At)=>{const It=pe.settled(),Os=!Ls.shouldConstrain(),Dt=Tt?It:It&&Os,Mt=Dt&&!Ms.pointerDown();Mt&&Ps.stop();const Fs=at.get()*At+As.get()*(1-At);Fe.set(Fs),Tt&&(Is.loop(pe.direction()),Ds.loop()),it.to(Fe.get()),Mt&&Ct.emit("settle"),Dt||Ct.emit("scroll")},z=Xr(n,i,()=>_(rt),pe=>D(rt,pe)),H=.68,Z=U[re.get()],ie=Te(Z),de=Te(Z),oe=Te(Z),ue=Te(Z),Ee=si(ie,oe,de,ue,u,H),st=di(h,U,ne,V,ue),nt=ui(z,re,Y,Ee,st,ue,a),Nt=oi(V),St=Me(),Cs=gi(e,s,a,g),{slideRegistry:Et}=li(J,y,U,Se,Q,O),Ts=fi(t,s,Et,nt,Ee,St,a,w),rt={ownerDocument:n,ownerWindow:i,eventHandler:a,containerRect:S,slideRects:T,animation:z,axis:A,dragHandler:Jr(A,t,n,i,ue,Qr(A,i),ie,z,nt,Ee,st,re,a,X,x,m,p,H,E),eventStore:St,percentOfView:X,index:re,indexPrevious:Y,limit:V,location:ie,offsetLocation:oe,previousLocation:de,options:o,resizeHandler:ti(e,a,i,s,A,v,N),scrollBody:Ee,scrollBounds:ni(V,oe,ue,Ee,X),scrollLooper:ai(ne,V,oe,[ie,oe,de,ue]),scrollProgress:Nt,scrollSnapList:U.map(Nt.get),scrollSnaps:U,scrollTarget:st,scrollTo:nt,slideLooper:hi(A,L,ne,ae,te,me,U,oe,s),slideFocus:Ts,slidesHandler:mi(e,a,k),slidesInView:Cs,slideIndexes:O,slideRegistry:Et,slidesToScroll:Q,target:ue,translate:Ns(A,e)};return rt}function bi(){let t={},e;function s(d){e=d}function n(d){return t[d]||[]}function i(d){return n(d).forEach(f=>f(e,d)),c}function o(d,f){return t[d]=n(d).concat([f]),c}function a(d,f){return t[d]=n(d).filter(h=>h!==f),c}function l(){t={}}const c={init:s,emit:i,off:a,on:o,clear:l};return c}const vi={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function ji(t){function e(o,a){return ks(o,a||{})}function s(o){const a=o.breakpoints||{},l=De(a).filter(c=>t.matchMedia(c).matches).map(c=>a[c]).reduce((c,d)=>e(c,d),{});return e(o,l)}function n(o){return o.map(a=>De(a.breakpoints||{})).reduce((a,l)=>a.concat(l),[]).map(t.matchMedia)}return{mergeOptions:e,optionsAtMedia:s,optionsMediaQueries:n}}function _i(t){let e=[];function s(o,a){return e=a.filter(({options:l})=>t.optionsAtMedia(l).active!==!1),e.forEach(l=>l.init(o,t)),a.reduce((l,c)=>Object.assign(l,{[c.name]:c}),{})}function n(){e=e.filter(o=>o.destroy())}return{init:s,destroy:n}}function qe(t,e,s){const n=t.ownerDocument,i=n.defaultView,o=ji(i),a=_i(o),l=Me(),c=bi(),{mergeOptions:d,optionsAtMedia:f,optionsMediaQueries:h}=o,{on:u,off:x,emit:m}=c,g=A;let b=!1,p,y=d(vi,qe.globalOptions),v=d(y),k=[],E,w,j;function N(){const{container:O,slides:_}=v;w=(gt(O)?t.querySelector(O):O)||t.children[0];const z=gt(_)?w.querySelectorAll(_):_;j=[].slice.call(z||w.children)}function S(O){const _=yi(t,w,j,n,i,O,c);if(O.loop&&!_.slideLooper.canLoop()){const D=Object.assign({},O,{loop:!1});return S(D)}return _}function T(O,_){b||(y=d(y,O),v=f(y),k=_||k,N(),p=S(v),h([y,...k.map(({options:D})=>D)]).forEach(D=>l.add(D,"change",A)),v.active&&(p.translate.to(p.location.get()),p.animation.init(),p.slidesInView.init(),p.slideFocus.init(Y),p.eventHandler.init(Y),p.resizeHandler.init(Y),p.slidesHandler.init(Y),p.options.loop&&p.slideLooper.loop(),w.offsetParent&&j.length&&p.dragHandler.init(Y),E=a.init(Y,k)))}function A(O,_){const D=Q();L(),T(d({startIndex:D},O),_),c.emit("reInit")}function L(){p.dragHandler.destroy(),p.eventStore.clear(),p.translate.clear(),p.slideLooper.clear(),p.resizeHandler.destroy(),p.slidesHandler.destroy(),p.slidesInView.destroy(),p.animation.destroy(),a.destroy(),l.clear()}function X(){b||(b=!0,l.clear(),L(),c.emit("destroy"),c.clear())}function W(O,_,D){!v.active||b||(p.scrollBody.useBaseFriction().useDuration(_===!0?0:v.duration),p.scrollTo.index(O,D||0))}function J(O){const _=p.index.add(1).get();W(_,O,-1)}function le(O){const _=p.index.add(-1).get();W(_,O,1)}function ae(){return p.index.add(1).get()!==Q()}function te(){return p.index.add(-1).get()!==Q()}function se(){return p.scrollSnapList}function we(){return p.scrollProgress.get(p.offsetLocation.get())}function Q(){return p.index.get()}function me(){return p.indexPrevious.get()}function ge(){return p.slidesInView.get()}function ne(){return p.slidesInView.get(!1)}function Ne(){return E}function Se(){return p}function U(){return t}function V(){return w}function re(){return j}const Y={canScrollNext:ae,canScrollPrev:te,containerNode:V,internalEngine:Se,destroy:X,off:x,on:u,emit:m,plugins:Ne,previousScrollSnap:me,reInit:g,rootNode:U,scrollNext:J,scrollPrev:le,scrollProgress:we,scrollSnapList:se,scrollTo:W,selectedScrollSnap:Q,slideNodes:re,slidesInView:ge,slidesNotInView:ne};return T(e,s),setTimeout(()=>c.emit("init"),0),Y}qe.globalOptions=void 0;function wt(t={},e=[]){const s=C.useRef(t),n=C.useRef(e),[i,o]=C.useState(),[a,l]=C.useState(),c=C.useCallback(()=>{i&&i.reInit(s.current,n.current)},[i]);return C.useEffect(()=>{vt(s.current,t)||(s.current=t,c())},[t,c]),C.useEffect(()=>{Ur(n.current,e)||(n.current=e,c())},[e,c]),C.useEffect(()=>{if(Hr()&&a){qe.globalOptions=wt.globalOptions;const d=qe(a,s.current,n.current);return o(d),()=>d.destroy()}else o(void 0)},[a,o]),[l,i]}wt.globalOptions=void 0;const ki={spike:"âš ï¸",trend:"ðŸ“ˆ",unusual:"ðŸ“Š",budget:"ðŸ’°",saving:"ðŸŽ‰"},ss={warning:"border-l-amber-500 bg-amber-50 dark:bg-amber-900/20",success:"border-l-green-500 bg-green-50 dark:bg-green-900/20",info:"border-l-blue-500 bg-blue-50 dark:bg-blue-900/20"};function wi({insight:t,displayCurrency:e="JPY",onScrollToChart:s}){const{t:n}=R("common"),i=Bs(),o=()=>{t.category?i({to:"/transactions",search:{categories:t.category}}):(t.type==="trend"||t.type==="unusual")&&(s==null||s())},a=()=>t.category?n("analytics.viewTransactions",{category:t.category}):t.type==="trend"||t.type==="unusual"?n("analytics.viewBreakdown"):n("analytics.learnMore");return r.jsx("div",{className:M("rounded-xl p-4 border-l-4 min-w-0","bg-white dark:bg-gray-800","shadow-card",ss[t.severity]||ss.info),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl flex-shrink-0",children:ki[t.type]||"ðŸ’¡"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-bold text-gray-900 dark:text-gray-100 truncate",children:t.title}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t.message}),t.amount&&r.jsxs("p",{className:"text-base font-bold font-numbers text-gray-800 dark:text-gray-200 mt-1.5",children:[I(t.amount,e),t.percentage_change&&r.jsxs("span",{className:M("ml-2 text-sm font-semibold",t.percentage_change>0?"text-red-600":"text-green-600"),children:[t.percentage_change>0?"+":"",t.percentage_change,"%"]})]}),r.jsxs(ee,{variant:"ghost",className:"mt-2 p-0 h-auto text-sm font-semibold text-primary-600 hover:text-primary-700",onClick:o,children:[a()," â†’"]})]})]})})}function Ni({insights:t,displayCurrency:e="JPY",onScrollToChart:s}){const{t:n}=R("common"),[i,o]=C.useState(0),[a,l]=wt({loop:!1,align:"start",containScroll:"trimSnaps"}),c=C.useCallback(()=>{l&&o(l.selectedScrollSnap())},[l]);return C.useEffect(()=>{if(l)return c(),l.on("select",c),()=>{l.off("select",c)}},[l,c]),!t||t.length===0?null:r.jsxs("div",{className:"relative",children:[t.length>1&&r.jsx("p",{className:"text-xs text-gray-400 text-center mb-2",children:n("analytics.swipeHint")}),r.jsx("div",{className:"overflow-hidden",ref:a,children:r.jsx("div",{className:"flex gap-3",children:t.map((d,f)=>r.jsx("div",{className:"flex-shrink-0 w-full min-w-0",children:r.jsx(wi,{insight:d,displayCurrency:e,onScrollToChart:s})},`${d.type}-${d.category||f}`))})}),t.length>1&&r.jsx("div",{className:"flex justify-center gap-1.5 mt-3",children:t.map((d,f)=>r.jsx("button",{"aria-label":`Go to insight ${f+1}`,className:M("h-2 rounded-full transition-[width,background-color] duration-200",f===i?"bg-primary-600 w-5":"bg-gray-300 dark:bg-gray-600 w-2"),onClick:()=>l==null?void 0:l.scrollTo(f)},f))})]})}function Ss({selectedMonth:t,onChange:e,className:s}){const n=()=>{e(Ve(t,1))},i=()=>{const a=Ft(t,1);a<=new Date&&e(a)},o=Ft(t,1)>new Date;return r.jsxs("div",{className:M("flex items-center gap-2",s),children:[r.jsx("button",{onClick:n,className:M("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors"),"aria-label":"Previous month",children:r.jsx(Hs,{className:"w-5 h-5"})}),r.jsx("span",{className:"min-w-[140px] text-center font-semibold text-gray-900 dark:text-gray-100",children:rs(t)}),r.jsx("button",{onClick:i,disabled:o,className:M("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors",o&&"opacity-50 cursor-not-allowed"),"aria-label":"Next month",children:r.jsx(Us,{className:"w-5 h-5"})})]})}const Si=[{value:"current-month",labelKey:"analytics.currentMonth"},{value:"3-months",labelKey:"analytics.3months"},{value:"6-months",labelKey:"analytics.6months"},{value:"1-year",labelKey:"analytics.1year"}];function Ei({selected:t,onChange:e,className:s}){const{t:n}=R("common");return r.jsx("div",{className:M("inline-flex rounded-lg bg-gray-100 dark:bg-gray-800 p-1",s),children:Si.map(({value:i,labelKey:o})=>r.jsx("button",{onClick:()=>e(i),className:M("px-3 py-1.5 text-sm font-semibold rounded-md transition-colors",i===t?"bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-md":"text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:n(o)},i))})}function Ci({year:t,month:e,onDownloadPDF:s,isDownloading:n}){const{t:i}=R("common"),o=rs(new Date(t,e-1));return r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:i("report.title")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:o})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:s,disabled:n,className:"p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":i(n?"report.downloading":"report.downloadPDF"),title:i(n?"report.downloading":"report.downloadPDF"),children:n?r.jsx(Ys,{size:18,className:"animate-spin"}):r.jsx(gn,{size:18})}),r.jsx("button",{disabled:!0,className:"p-2 rounded-lg text-gray-400 dark:text-gray-600 cursor-not-allowed","aria-label":i("report.sendEmail"),title:i("report.comingSoon"),children:r.jsx(pn,{size:18})})]})]})}function Es({value:t,invertColor:e=!1,className:s}){const{t:n}=R("common");if(t==null)return r.jsx("span",{className:M("inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium","bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400",s),children:n("report.deltaNew")});if(t===0)return r.jsx("span",{className:M("inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium","bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400",s),children:"0%"});const i=t>0,o=e?!i:i,a=i?fn:hn;return r.jsxs("span",{className:M("inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-xs font-medium",o?"bg-income-100 text-income-600 dark:bg-income-900/30 dark:text-income-300":"bg-expense-100 text-expense-600 dark:bg-expense-900/30 dark:text-expense-300",s),children:[r.jsx(a,{className:"w-3 h-3"}),Math.abs(t).toFixed(1),"%"]})}const xt=({value:t,max:e=100,className:s})=>{const n=Math.min(100,Math.max(0,t/e*100));return r.jsx("div",{className:dn("h-2.5 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",s),children:r.jsx("div",{className:"h-full bg-primary-600 animate-progress-fill rounded-full progress-glow",style:{width:`${n}%`}})})};function Ti(t){switch(t){case"over_budget":return"error";case"threshold_80":return"warning";case"threshold_50":return"info";default:return"success"}}function Ai(t,e){switch(t){case"over_budget":return e("report.overBudget");case"threshold_80":return e("report.warning");case"threshold_50":return e("report.caution");default:return e("report.onTrack")}}function Ii({data:t}){const{t:e}=R("common");return r.jsxs("div",{children:[r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[r.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[I(Math.abs(t.total_spent))," / ",I(t.total_budget)]}),r.jsxs("span",{className:M("font-medium",t.is_over_budget?"text-red-500":"text-gray-700 dark:text-gray-300"),children:[t.percentage_used.toFixed(1),"%"]})]}),r.jsx(xt,{value:Math.min(t.percentage_used,100)})]}),r.jsx("div",{className:"space-y-3",children:t.category_status.map(s=>r.jsx("div",{className:"flex items-center justify-between gap-2",children:r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-sm font-medium truncate text-gray-900 dark:text-gray-100",children:s.category}),r.jsx(Es,{value:s.spending_change,invertColor:!0,className:"ml-1"}),r.jsx(is,{variant:Ti(s.status),className:"ml-1 text-[10px]",children:Ai(s.status,e)})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(xt,{value:Math.min(s.percentage,100),className:"flex-1"}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-16 text-right",children:[I(Math.abs(s.spent))," / ",I(s.budget_amount)]})]})]})},s.category))})]})}function Di({status:t}){switch(t){case"over_budget":return r.jsx(qs,{className:"w-5 h-5 text-red-500 shrink-0"});case"threshold_80":return r.jsx(ft,{className:"w-5 h-5 text-amber-500 shrink-0"});case"threshold_50":return r.jsx(ft,{className:"w-5 h-5 text-yellow-500 shrink-0"});default:return r.jsx(Gs,{className:"w-5 h-5 text-green-500 shrink-0"})}}function Mi(t){switch(t){case"over_budget":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"threshold_80":return"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800";case"threshold_50":return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800";default:return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"}}function Pi({focusAreas:t,budgetAdherence:e}){const{t:s}=R("common"),[n,i]=C.useState(!1),o=e.category_status.length;return t.length===0?r.jsx("div",{className:"text-center py-6 text-sm text-gray-500 dark:text-gray-400",children:s("report.noFocusAreas")}):r.jsxs("div",{className:"space-y-3",children:[t.map(a=>r.jsx("div",{className:M("rounded-lg border p-3",Mi(a.status)),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Di,{status:a.status}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:a.category}),r.jsx(Es,{value:a.spending_change,invertColor:!0})]}),r.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:[I(Math.abs(a.spent))," / ",I(a.budget_amount)]}),r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:s(a.suggestion_key,a.suggestion_params)})]})]})},a.category)),o>t.length&&r.jsxs("button",{onClick:()=>i(!n),className:"flex items-center gap-1 text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline w-full justify-center py-2",children:[n?s("report.hideAll"):s("report.seeAll",{count:o}),n?r.jsx(xn,{className:"w-4 h-4"}):r.jsx(us,{className:"w-4 h-4"})]}),n&&r.jsx(Ii,{data:e})]})}function Li(t){const e=t.summary;if(e.total_income===0&&e.total_expense===0)return null;const s=e.expense_change<0?`Expenses decreased by ${Math.abs(e.expense_change).toFixed(1)}%`:e.savings_rate>20?`Savings rate at ${e.savings_rate.toFixed(1)}%`:`Income: ${e.total_income.toLocaleString()}`,n=e.expense_change>10?`Expenses increased by ${e.expense_change.toFixed(1)}%`:e.savings_rate<10?`Low savings rate: ${e.savings_rate.toFixed(1)}%`:"No major concerns this month",i=e.net_change>0?`Net cashflow improved by ${e.net_change.toFixed(1)}%`:e.net_change<0?`Net cashflow decreased by ${Math.abs(e.net_change).toFixed(1)}%`:"Cashflow stable compared to last month";return{year:t.year,month:t.month,win:s,warning:n,trend:i,generated_at:"",is_cached:!1,credits_used:0}}const Oi=[{key:"win",Icon:Js,color:"text-green-600 dark:text-green-400",bg:"bg-green-100 dark:bg-green-900/30"},{key:"warning",Icon:ft,color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-100 dark:bg-amber-900/30"},{key:"trend",Icon:yt,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-100 dark:bg-blue-900/30"}];function Fi({year:t,month:e,reportData:s}){const{t:n}=R("common"),{data:i,refetch:o}=be({queryKey:["ai-summary",t,e],queryFn:()=>Qs(t,e),staleTime:1/0,retry:!1}),a=dt({mutationFn:f=>Xs(t,e,void 0,f),onSuccess:()=>{o()},onError:()=>{as.error(n("report.aiSummaryError"))}}),l=i??Li(s),c=a.isPending,d=!!i;return!l&&!d?r.jsx(K,{className:"p-4",children:r.jsxs("button",{onClick:()=>a.mutate(!1),disabled:c,className:"flex items-center gap-2 w-full justify-center py-2 text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline disabled:opacity-50",children:[r.jsx(Ke,{className:"w-4 h-4"}),n("report.generateSummary"),r.jsxs("span",{className:"text-xs text-gray-400",children:["~0.02 ",n("report.credits")]})]})}):r.jsxs(K,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-1.5",children:[r.jsx(Ke,{className:"w-4 h-4 text-primary-500"}),n("report.smartSummary")]}),r.jsxs("button",{onClick:()=>a.mutate(!0),disabled:c,className:"text-xs text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 flex items-center gap-1 disabled:opacity-50",children:[r.jsx(Ws,{className:`w-3 h-3 ${c?"animate-spin":""}`}),n("report.regenerate")]})]}),c?r.jsx("div",{className:"flex justify-center py-4",children:r.jsx(ve,{size:"sm"})}):r.jsxs("div",{className:"space-y-2.5",children:[Oi.map(({key:f,Icon:h,color:u,bg:x})=>r.jsxs("div",{className:"flex items-start gap-2.5",children:[r.jsx("div",{className:`p-1 rounded-md ${x} shrink-0`,children:r.jsx(h,{className:`w-3.5 h-3.5 ${u}`})}),r.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-snug",children:l==null?void 0:l[f]})]},f)),!d&&r.jsxs("button",{onClick:()=>a.mutate(!1),className:"text-xs text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1 mt-1",children:[r.jsx(Ke,{className:"w-3 h-3"}),n("report.generateAI"),r.jsxs("span",{className:"text-gray-400",children:["~0.02 ",n("report.credits")]})]})]})]})}function Bi(t){switch(t){case"ahead":return"success";case"on_track":return"info";default:return"warning"}}function Ri({goal:t}){const{t:e}=R("common"),s={ahead:e("report.ahead"),on_track:e("report.onTrack"),behind:e("report.behind")}[t.status]||t.status;return r.jsxs("div",{className:"p-4 border rounded-lg border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:e("report.goalYears",{years:t.years})}),r.jsx(is,{variant:Bi(t.status),children:s})]}),r.jsx(xt,{value:Math.min(t.progress_percentage,100),className:"mb-2"}),r.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[r.jsxs("span",{children:[I(t.total_saved)," / ",I(t.target_amount)]}),r.jsxs("span",{children:[t.progress_percentage.toFixed(1),"%"]})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:e("report.neededPerMonth",{amount:I(t.needed_per_month)})})]})}function zi({accounts:t,totalNetWorth:e}){const{t:s}=R("common");return r.jsxs("div",{children:[r.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:s("report.totalNetWorth")}),r.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:I(e)})]}),r.jsx("div",{className:"space-y-2",children:t.map(n=>r.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:n.account_name}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.account_type})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:I(n.balance,n.currency,void 0,!0)}),n.currency!=="JPY"&&r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.currency})]})]},n.account_id))})]})}function $i({insights:t}){const{t:e}=R("common");return t.length===0?null:r.jsxs(K,{children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:e("report.insights")}),r.jsx("div",{className:"space-y-3",children:t.map((s,n)=>r.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600",children:[r.jsx("div",{className:"flex items-center gap-2 mb-1",children:r.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:s.title})}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.message})]},n))})]})}function Ki({embedded:t=!1}){const{t:e}=R("common"),[s,n]=C.useState(new Date),[i,o]=C.useState(!1),a=s.getFullYear(),l=s.getMonth()+1,{data:c,isLoading:d,error:f}=be({queryKey:["monthly-report",a,l],queryFn:()=>en(a,l),staleTime:1e3*60*5}),h=C.useCallback(async()=>{o(!0);try{const x=await Zs(a,l),m=URL.createObjectURL(x),g=document.createElement("a");g.href=m,g.download=`monthly_report_${a}_${String(l).padStart(2,"0")}.pdf`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(m)}catch{as.error(e("report.downloadError"))}finally{o(!1)}},[a,l,e]),u=r.jsxs(r.Fragment,{children:[r.jsx(Ci,{year:a,month:l,onDownloadPDF:h,isDownloading:i}),r.jsx(Ss,{selectedMonth:s,onChange:n,className:"mb-6"}),d&&r.jsx("div",{className:"flex justify-center py-20",children:r.jsx(ve,{size:"lg"})}),f&&r.jsx(K,{className:"text-center py-10",children:r.jsx("p",{className:"text-red-500",children:e("report.loadError")})}),c&&r.jsxs("div",{className:"space-y-6",children:[r.jsx(Fi,{year:a,month:l,reportData:c}),r.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[r.jsx(ce,{label:e("analytics.heroIncome"),value:I(c.summary.total_income),change:c.summary.income_change,trend:c.summary.income_change>0?"positive":c.summary.income_change<0?"negative":"neutral"}),r.jsx(ce,{label:e("analytics.heroExpense"),value:I(c.summary.total_expense),change:c.summary.expense_change,trend:c.summary.expense_change<0?"positive":c.summary.expense_change>0?"negative":"neutral"}),r.jsx(ce,{label:e("analytics.heroNet"),value:I(c.summary.net_cashflow),change:c.summary.net_change,trend:c.summary.net_change>0?"positive":c.summary.net_change<0?"negative":"neutral"}),r.jsx(ce,{label:e("report.savingsRate"),value:`${c.summary.savings_rate.toFixed(1)}%`,subtitle:e("report.savingsRateDesc")})]}),c.budget_adherence&&r.jsxs(K,{children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:e("report.budgetAdherence")}),r.jsx(Pi,{focusAreas:c.budget_adherence.focus_areas??[],budgetAdherence:c.budget_adherence})]}),c.category_breakdown.length>0&&r.jsxs(K,{children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:e("report.categoryBreakdown")}),r.jsx(hs,{data:c.category_breakdown})]}),c.spending_trends.length>0&&r.jsxs(K,{children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:e("report.spendingTrends")}),r.jsx(fs,{data:c.spending_trends})]}),c.goal_progress.length>0&&r.jsxs(K,{children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:e("report.goalProgress")}),r.jsx("div",{className:"space-y-4",children:c.goal_progress.map(x=>r.jsx(Ri,{goal:x},x.goal_id))})]}),c.account_summary.length>0&&r.jsxs(K,{children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:e("report.accountSummary")}),r.jsx(zi,{accounts:c.account_summary,totalNetWorth:c.total_net_worth})]}),r.jsx($i,{insights:c.insights}),c.summary.total_income===0&&c.summary.total_expense===0&&r.jsx(K,{className:"text-center py-10",children:r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e("report.noData")})})]})]});return t?u:r.jsx("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:u})}function Vi(t,e){const s=mn(e),n=Ce(s>new Date?new Date:s,"yyyy-MM-dd");switch(t){case"current-month":return{start:Ce(Be(e),"yyyy-MM-dd"),end:n};case"3-months":return{start:Ce(Ve(Be(e),2),"yyyy-MM-dd"),end:n};case"6-months":return{start:Ce(Ve(Be(e),5),"yyyy-MM-dd"),end:n};case"1-year":return{start:Ce(Ve(Be(e),11),"yyyy-MM-dd"),end:n};default:return nn()}}function Hi(){const{t}=R("common"),e=Rs({strict:!1}),[s,n]=C.useState((e==null?void 0:e.tab)==="report"?"report":"overview"),i=C.useRef(null),[o,a]=C.useState(new Date),[l,c]=C.useState("current-month"),[d,f]=C.useState(!1),h=Vi(l,o),{data:u,isLoading:x}=be({queryKey:["analytics",h],queryFn:()=>rn(h)}),{data:m}=be({queryKey:["insights"],queryFn:ns}),{data:g}=be({queryKey:["goals"],queryFn:an}),b=g&&g.length>0?Math.round(g[0].target_amount/(g[0].years*12)):null,p=k=>{c(k)},y=k=>{a(k)},v=C.useCallback(()=>{var k;(k=i.current)==null||k.scrollIntoView({behavior:"smooth"})},[]);return r.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold text-gray-900 dark:text-gray-100 tracking-tight",children:t("analytics.title")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t("analytics.subtitle")})]}),r.jsx("div",{className:"flex justify-center mb-6",children:r.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-full p-1 inline-flex",role:"tablist",children:[r.jsx("button",{role:"tab","aria-selected":s==="overview",onClick:()=>n("overview"),className:M("px-5 py-2 text-sm font-semibold rounded-full transition-colors",s==="overview"?"bg-primary-600 text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:t("analytics.tabOverview","Overview")}),r.jsx("button",{role:"tab","aria-selected":s==="report",onClick:()=>n("report"),className:M("px-5 py-2 text-sm font-semibold rounded-full transition-colors",s==="report"?"bg-primary-600 text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:t("analytics.tabReport","Monthly Report")})]})}),s==="report"?r.jsx(Ki,{embedded:!0}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-6 space-y-3",children:[r.jsx(Ss,{selectedMonth:o,onChange:y,className:"justify-center"}),r.jsx("div",{className:"flex justify-center",children:r.jsx(Ei,{selected:l,onChange:p})})]}),x?r.jsx("div",{className:"flex justify-center py-12",children:r.jsx(ve,{size:"lg"})}):r.jsxs("div",{className:"space-y-6",children:[u&&r.jsx(Kr,{analytics:u}),(m==null?void 0:m.insights)&&m.insights.length>0&&r.jsx(Ni,{insights:m.insights,onScrollToChart:v}),r.jsxs("div",{ref:i,className:"space-y-6",children:[r.jsxs(K,{className:"shadow-card",children:[r.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[r.jsx("div",{className:"p-1.5 rounded-lg bg-primary-100 dark:bg-primary-900/30",children:r.jsx(tn,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),r.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:t("analytics.incomeVsExpense")})]}),r.jsx(lt,{className:"h-64 sm:h-80",children:u!=null&&u.monthly_trends&&u.monthly_trends.length>0?r.jsx(fs,{data:u.monthly_trends}):r.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:t("analytics.noData")})})]}),r.jsxs(K,{className:"shadow-card",children:[r.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[r.jsx("div",{className:"p-1.5 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:r.jsx(sn,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"})}),r.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:t("analytics.categoryBreakdown")})]}),r.jsx(lt,{className:"h-64 sm:h-80",children:u!=null&&u.category_breakdown&&u.category_breakdown.length>0?r.jsx(hs,{data:u.category_breakdown}):r.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:t("analytics.noData")})})]}),r.jsxs(K,{className:"shadow-card",children:[r.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[r.jsx("div",{className:"p-1.5 rounded-lg bg-net-100 dark:bg-net-900/30",children:r.jsx(yt,{className:"w-4 h-4 text-net-600 dark:text-net-300"})}),r.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:t("analytics.monthlyCashFlow")})]}),r.jsx("div",{className:"h-64 sm:h-80",children:u!=null&&u.monthly_trends&&u.monthly_trends.length>0?u.monthly_trends.length<3?r.jsx(vn,{data:u.monthly_trends,savingsGoal:b}):r.jsx(lt,{className:"h-full",children:r.jsx(bn,{data:u.monthly_trends,dataKey:"net"})}):r.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:t("analytics.noData")})})]})]}),r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden shadow-card",children:[r.jsxs("button",{onClick:()=>f(!d),className:M("w-full px-4 py-3.5 flex items-center justify-between","bg-gray-50/80 dark:bg-gray-800/80","text-left font-semibold text-gray-900 dark:text-gray-100"),children:[r.jsxs("span",{className:"flex items-center gap-2.5",children:[r.jsx("div",{className:"p-1.5 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:r.jsx(Ke,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),t("analytics.aiTools")]}),r.jsx(us,{className:M("w-4 h-4 text-gray-500 transition-transform duration-200",d&&"rotate-180")})]}),d&&r.jsxs("div",{className:"p-4 space-y-4 bg-white dark:bg-gray-900",children:[r.jsx($r,{}),r.jsx(Br,{})]})]})]})]})]})}const oa=zs("/analytics")({component:Hi});export{oa as Route};
