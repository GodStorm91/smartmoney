import{j as e,c as t,k as a,e as s,n as r,u as n,m as o}from"./vendor-tanstack-CNAyyoyW.js";import{r as l,a as i}from"./vendor-react-Bx4JnVfy.js";import{c,u as d,d as u,e as x,B as m,I as g,g as h,t as y,h as p,i as b,C as f,j as v,k as j,l as k,m as N,n as w,o as C,p as S,S as D,q as L,r as M,E,s as P,v as z}from"./index-BtnNbyTi.js";import{S as R}from"./Select-BLvcVgC4.js";import{B as T}from"./Badge-B98ofg-U.js";import{g as A,H as _,u as O,a as q,T as K,R as U}from"./TransactionFormModal-CyUb93yE.js";import{u as I}from"./vendor-i18n-BrrOrGm_.js";import{R as Y,a1 as F,a2 as $,a3 as J,X as B,K as Q,m as W,P as V,a4 as H,a5 as X,n as Z,Y as G,a6 as ee,z as te}from"./vendor-icons-BP-EQ_TG.js";import"./vendor-recharts-BrNIwK9z.js";import"./vendor-date-BkGg5e1q.js";import"./recurring-service-CSbN6xO4.js";import"./RecurringOptions-CRhcxQxn.js";function ae({label:t,options:a,selected:s,onChange:r,placeholder:n}){const[o,i]=l.useState(!1),d=l.useRef(null);l.useEffect(()=>{function e(e){d.current&&!d.current.contains(e.target)&&i(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const u=s.length>0?`${s.length} selected`:n||"Select...";return e.jsxs("div",{ref:d,className:"relative w-full",children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t}),e.jsxs("button",{type:"button",onClick:()=>i(!o),className:c("w-full px-4 py-2 border rounded-lg text-left flex justify-between items-center","bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"),children:[e.jsx("span",{className:0===s.length?"text-gray-500":"",children:u}),e.jsx("svg",{className:c("w-4 h-4 transition-transform",o&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:a.map(t=>e.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.includes(t.value),onChange:()=>{return e=t.value,void(s.includes(e)?r(s.filter(t=>t!==e)):r([...s,e]));var e},className:"mr-3 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:t.label})]},t.value))})]})}function se({receiptUrl:t,onClose:a}){const{t:s}=I(),[r,n]=l.useState(1),o=A(t);if(!o)return null;return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:e=>{e.target===e.currentTarget&&a()},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsxs("h2",{className:"text-white font-medium flex items-center gap-2",children:[e.jsx(Y,{size:20}),s("receipt.viewReceipt","View Receipt")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(e=>Math.max(e-.25,.5)),className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomOut","Zoom out"),children:e.jsx(F,{size:20})}),e.jsxs("span",{className:"text-white text-sm w-12 text-center",children:[Math.round(100*r),"%"]}),e.jsx("button",{onClick:()=>n(e=>Math.min(e+.25,3)),className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomIn","Zoom in"),children:e.jsx($,{size:20})}),e.jsx("button",{onClick:()=>{const e=document.createElement("a");e.href=o,e.download=`receipt-${Date.now()}.jpg`,e.click()},className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.download","Download"),children:e.jsx(J,{size:20})}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.close","Close"),children:e.jsx(B,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center p-4",children:e.jsx("img",{src:o,alt:"Receipt",className:"max-w-full max-h-full object-contain transition-transform duration-200",style:{transform:`scale(${r})`}})})]})}function re({isOpen:s,onClose:r,transaction:n}){const{t:o}=I("common"),h=t(),{data:y=[]}=d(),[p,b]=l.useState(""),[f,v]=l.useState(""),[j,k]=l.useState(""),[N,w]=l.useState(""),[C,S]=l.useState("JPY"),[D,L]=l.useState(""),[M,E]=l.useState(null),[P,z]=l.useState("expense"),[T,q]=l.useState(!1),[K,U]=l.useState(null),[Y,F]=l.useState(null),[$,J]=l.useState(null),[W,V]=l.useState(!1),[H,X]=l.useState(!1),Z=l.useRef(null),G=e=>{const t=e.replace(/[^\d]/g,"");return t?Number(t).toLocaleString():""},ee=a({mutationFn:e=>u(n.id,e),onSuccess:()=>{h.invalidateQueries({queryKey:["transactions"]}),h.invalidateQueries({queryKey:["dashboard"]}),h.invalidateQueries({queryKey:["analytics"]}),r()}}),te=a({mutationFn:()=>x(n.id),onSuccess:()=>{h.invalidateQueries({queryKey:["transactions"]}),h.invalidateQueries({queryKey:["dashboard"]}),h.invalidateQueries({queryKey:["analytics"]}),r()}});l.useEffect(()=>{if(n&&s){b(n.date),v(n.description);const e=Math.abs(n.amount).toString();k(e),w(G(e)),S(n.currency||"JPY"),L(n.category),E(n.account_id??null),z(n.type),q(!1),U(n.receipt_url||null),F(null),J(null)}},[null==n?void 0:n.id,s]);l.useEffect(()=>{if(M){const e=y.find(e=>e.id===M);(null==e?void 0:e.currency)&&S(e.currency)}},[M,y]);if(l.useEffect(()=>(s&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[s]),!s||!n)return null;const ae=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),e.jsx("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md max-h-[90dvh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:o("transaction.editTitle")}),T?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:o("transaction.deleteConfirm")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:n.description}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>q(!1),className:"flex-1",children:o("button.cancel")}),e.jsx(m,{variant:"secondary",onClick:()=>{te.mutate()},disabled:te.isPending,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:te.isPending?"...":o("button.delete")})]})]}):e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const t=parseFloat(j);if(isNaN(t))return;const a=y.find(e=>e.id===M),s=(null==a?void 0:a.name)||(null==n?void 0:n.source)||"";let r=K;if(Y){X(!0);try{r=await O(Y)}finally{X(!1)}}ee.mutate({date:p,description:f,amount:Math.round("expense"===P?-Math.abs(t):Math.abs(t)),currency:C,category:D||"Other",source:s,type:P,account_id:M,receipt_url:r})},className:"space-y-4",children:[e.jsx(g,{label:o("transaction.date"),type:"date",value:p,onChange:e=>b(e.target.value),required:!0}),e.jsx(g,{label:o("transaction.description"),value:f,onChange:e=>v(e.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(g,{label:o("transaction.amount"),type:"text",inputMode:"numeric",value:N,onChange:e=>{const t=e.target.value.replace(/[^\d]/g,"");k(t),w(G(t))},required:!0})}),e.jsx("div",{className:"w-28",children:e.jsx(R,{label:o("transaction.currency","Currency"),value:C,onChange:e=>S(e.target.value),options:[{value:"JPY",label:"Â¥ JPY"},{value:"USD",label:"$ USD"},{value:"VND",label:"â‚« VND"}]})})]}),e.jsx(R,{label:o("transaction.type"),value:P,onChange:e=>z(e.target.value),options:[{value:"income",label:o("transaction.typeIncome")},{value:"expense",label:o("transaction.typeExpense")}]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("transaction.category")}),e.jsx(_,{selected:D,onSelect:e=>L(e),isIncome:"income"===P})]}),e.jsx(R,{label:o("account.account"),value:(null==M?void 0:M.toString())||"",onChange:e=>E(e.target.value?Number(e.target.value):null),options:[{value:"",label:o("account.selectAccount")},...y.map(e=>({value:e.id.toString(),label:e.name}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("receipt.receipt","Receipt")}),e.jsx("input",{ref:Z,type:"file",accept:"image/*",capture:"environment",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];a&&a.type.startsWith("image/")&&(F(a),J(URL.createObjectURL(a)))},className:"hidden"}),$||K?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:$||A(K)||"",alt:"Receipt",className:"w-full h-20 object-cover cursor-pointer",onClick:()=>!$&&V(!0)}),e.jsx("button",{type:"button",onClick:()=>{F(null),$&&(URL.revokeObjectURL($),J(null)),U(null),Z.current&&(Z.current.value="")},className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(B,{size:14})})]}):e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=Z.current)?void 0:e.click()},className:"w-full h-10 flex items-center justify-center gap-2 border border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 text-gray-500 dark:text-gray-400 rounded-lg text-sm",children:[e.jsx(Q,{size:16}),o("receipt.attachReceipt","Attach Receipt")]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:o("button.cancel")}),e.jsx(m,{type:"submit",disabled:ee.isPending||H,className:"flex-1",children:H?o("receipt.uploading","Uploading..."):ee.isPending?"...":o("button.save")})]}),e.jsx("button",{type:"button",onClick:()=>q(!0),className:c("w-full text-center text-sm text-red-600 hover:text-red-700","py-2 transition-colors"),children:o("transaction.deleteTransaction")})]})]})}),W&&K&&e.jsx(se,{receiptUrl:K,onClose:()=>V(!1)})]});return"undefined"!=typeof document?i.createPortal(ae,document.body):null}const ne={food:["ã”é£¯","ã”ã¯ã‚“","ãƒ©ãƒ³ãƒ","ãƒ‡ã‚£ãƒŠãƒ¼","æ˜¼é£Ÿ","å¤•é£Ÿ","æœé£Ÿ","å¼å½“","ã‚³ãƒ¼ãƒ’ãƒ¼","ã‚«ãƒ•ã‚§","ã‚¹ã‚¿ãƒ","ãƒãƒƒã‚¯","ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰","ã™ãå®¶","å‰é‡å®¶","ãƒ©ãƒ¼ãƒ¡ãƒ³","å¯¿å¸","ã™ã—","ã†ã©ã‚“","ãã°","ã‚«ãƒ¬ãƒ¼","ãƒ‘ãƒ³","ã‚±ãƒ¼ã‚­","ã‚»ãƒ–ãƒ³","ãƒ•ã‚¡ãƒŸãƒ","ãƒ­ãƒ¼ã‚½ãƒ³","ã‚³ãƒ³ãƒ“ãƒ‹","ã‚¹ãƒ¼ãƒ‘ãƒ¼","coffee","cafe","lunch","dinner","breakfast","food","restaurant","starbucks","mcdonalds","ramen","sushi","curry","bread","cake","konbini","supermarket","gohan","ko-hi-","kohi"],transport:["é›»è»Š","ã§ã‚“ã—ã‚ƒ","ãƒã‚¹","ã‚¿ã‚¯ã‚·ãƒ¼","åœ°ä¸‹é‰„","JR","æ–°å¹¹ç·š","ã‚¬ã‚½ãƒªãƒ³","é§è»Šå ´","Suica","PASMO","ãƒ‘ã‚¹ãƒ¢","ã‚¹ã‚¤ã‚«","train","bus","taxi","subway","gas","parking","uber","lyft"],shopping:["è²·ã„ç‰©","ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°","æœ","ãµã","é´","ãã¤","ã‚¢ãƒã‚¾ãƒ³","æ¥½å¤©","é›‘è²¨","ãƒ¦ãƒ‹ã‚¯ãƒ­","GU","ç„¡å°","shopping","clothes","shoes","amazon","uniqlo","muji"],entertainment:["æ˜ ç”»","ãˆã„ãŒ","ã‚²ãƒ¼ãƒ ","ã‚«ãƒ©ã‚ªã‚±","ãƒœã‚¦ãƒªãƒ³ã‚°","æœ¬","ã»ã‚“","Netflix","ãƒãƒƒãƒˆãƒ•ãƒªãƒƒã‚¯ã‚¹","Spotify","ã‚¹ãƒãƒ†ã‚£ãƒ•ã‚¡ã‚¤","movie","game","karaoke","bowling","book","netflix","spotify"],utilities:["é›»æ°—","ã§ã‚“ã","ã‚¬ã‚¹","æ°´é“","ã™ã„ã©ã†","ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ","Wi-Fi","electric","electricity","water","internet","wifi"],communication:["æºå¸¯","ã‘ã„ãŸã„","ã‚¹ãƒãƒ›","é›»è©±","ã§ã‚“ã‚","phone","mobile","cell"],health:["ç—…é™¢","ã³ã‚‡ã†ã„ã‚“","è–¬","ãã™ã‚Š","åŒ»è€…","ã„ã—ã‚ƒ","æ­¯åŒ»è€…","ã‚¸ãƒ ","ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹","hospital","medicine","doctor","dentist","gym","fitness"],housing:["å®¶è³ƒ","ã‚„ã¡ã‚“","å…‰ç†±è²»","rent","mortgage"]};function oe(e){if(!e||0===e.trim().length)return null;const t=e.trim(),a=t.match(/[\d,]+/);if(!a)return null;const s=a[0].replace(/,/g,""),r=parseInt(s,10);if(isNaN(r)||r<=0)return null;let n="JPY";const o=t.toLowerCase();/dollar|dollars|usd|\$|ãƒ‰ãƒ«/.test(o)?n="USD":/dong|vnd|Ä‘á»“ng|ãƒ‰ãƒ³/.test(o)?n="VND":/yen|å††|Â¥|ãˆã‚“/.test(o)&&(n="JPY");let l=t.replace(/[\d,]+/,"").replace(/yen|å††|Â¥|dollar|dollars|usd|\$|dong|vnd|Ä‘á»“ng|ãƒ‰ãƒ«|ãƒ‰ãƒ³|ãˆã‚“/gi,"").trim();l||(l="Voice entry");const i=function(e){const t=e.toLowerCase();for(const[a,s]of Object.entries(ne))for(const e of s)if(t.includes(e.toLowerCase()))return a}(t);return{amount:r,currency:n,description:l,suggestedCategoryId:i}}const le=[{id:"food",labelKey:"category.food",icon:"ğŸ½ï¸",value:"Food"},{id:"housing",labelKey:"category.housing",icon:"ğŸ ",value:"Housing"},{id:"transport",labelKey:"category.transport",icon:"ğŸš—",value:"Transportation"},{id:"utilities",labelKey:"category.utilities",icon:"ğŸ’¡",value:"Utilities"},{id:"communication",labelKey:"category.communication",icon:"ğŸ“±",value:"Communication"},{id:"entertainment",labelKey:"category.entertainment",icon:"ğŸ¬",value:"Entertainment"},{id:"shopping",labelKey:"category.shopping",icon:"ğŸ›ï¸",value:"Shopping"},{id:"health",labelKey:"category.health",icon:"ğŸ¥",value:"Health"},{id:"proxy_purchase",labelKey:"category.proxy_purchase",icon:"ğŸ›’",value:"Proxy Purchase"},{id:"other",labelKey:"category.other",icon:"ğŸ“¦",value:"Other"}],ie={JPY:"Â¥",USD:"$",VND:"â‚«"},ce=["JPY","USD","VND"],de=["1","2","3","4","5","6","7","8","9","00","0","DEL"];function ue(){var t;const{t:a}=I("common"),{data:s}=d(),r=h(),[n,o]=l.useState("closed"),[u,x]=l.useState(""),[m,g]=l.useState(""),[b,f]=l.useState(null),[v,j]=l.useState("JPY"),[k,N]=l.useState(""),[w,C]=l.useState(""),S=l.useRef(null),D=l.useRef(!1),[L,M]=l.useState(!1),[E,P]=l.useState(0),{status:z,transcript:R,isSupported:T,startListening:A,stopListening:_}=function(e={}){const{language:t="ja-JP",onResult:a,onError:s}=e,[r,n]=l.useState("idle"),[o,i]=l.useState(""),[c,d]=l.useState(null),[u,x]=l.useState(!1),m=l.useRef(null),g=l.useRef("idle"),h=l.useRef(a),y=l.useRef(s),p=l.useRef(!1),b=l.useRef(!1);l.useEffect(()=>{g.current=r},[r]),l.useEffect(()=>{h.current=a,y.current=s},[a,s]),l.useEffect(()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;x(!!e)},[]),l.useEffect(()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return;const a=new e;return a.continuous=!0,a.interimResults=!0,a.lang=t,a.onstart=()=>{p.current=!1,d(null)},a.onresult=e=>{const t=e.results,a=t[t.length-1][0].transcript;i(a)},a.onerror=e=>{var t;if(p.current=!1,"aborted"===e.error)return;const a="no-speech"===e.error?"No speech detected":"audio-capture"===e.error?"Microphone not found":"not-allowed"===e.error?"Microphone access denied":`Error: ${e.error}`;d(a),n("error"),null==(t=y.current)||t.call(y,a)},a.onend=()=>{p.current=!1,b.current||"listening"!==g.current||n("idle")},m.current=a,()=>{a.abort()}},[t]);const f=l.useCallback(()=>{if(m.current&&!p.current&&"listening"!==g.current){p.current=!0,b.current=!0,i(""),d(null),n("listening");try{m.current.start()}catch(e){p.current=!1}}},[]),v=l.useCallback(()=>{var e;if(b.current=!1,m.current&&"listening"===g.current){try{m.current.stop()}catch(t){}o?(n("processing"),null==(e=h.current)||e.call(h,o)):n("idle")}},[o]),j=l.useCallback(()=>{i(""),d(null),n("idle")},[]);return{status:r,transcript:o,isSupported:u,startListening:f,stopListening:v,resetTranscript:j,error:c}}({language:"ja-JP",onResult:e=>{const t=oe(e);t&&(x(t.amount.toString()),j(t.currency),N(t.description),t.suggestedCategoryId?(g(t.suggestedCategoryId),1===(null==s?void 0:s.length)?setTimeout(()=>{Q(t.suggestedCategoryId)},100):o("account")):o("category"))}}),O=null==s?void 0:s.find(e=>e.id===b),K=l.useMemo(()=>{if(!s)return[];if(!w.trim())return s;const e=w.toLowerCase();return s.filter(t=>t.name.toLowerCase().includes(e))},[s,w]);l.useEffect(()=>{if((null==s?void 0:s.length)&&!b){f(s[0].id);const e=s[0].currency;ce.includes(e)&&j(e)}},[s,b]),l.useEffect(()=>{if(O){const e=O.currency;ce.includes(e)&&j(e)}},[O]);const U=ie[v]||v,F=l.useMemo(()=>{if(!u||!O)return null;const e=O.currency;if(v===e)return null;const t=parseInt(u);if(isNaN(t))return null;const a=r[v]||1,s=r[e]||1,n=t/a,o=Math.round(n*s);return{value:o,formatted:o.toLocaleString(),currency:e,symbol:ie[e]||e}},[u,v,O,r]),$=q(p,"transaction",[["transactions"],["analytics"]]),J=u?parseInt(u).toLocaleString():"0",Q=async(e,t)=>{const a=e||m,r=t||b,n=le.find(e=>e.id===a),o=null==s?void 0:s.find(e=>e.id===r);if(!u||!n||!o)return;const l=o.currency||"JPY",i=(null==F?void 0:F.value)??parseInt(u),c=y(i,l);try{await $.mutateAsync({date:(new Date).toISOString().split("T")[0],description:k||n.value,amount:-c,currency:l,category:n.value,source:o.name,type:"expense"}),G()}catch{}},G=()=>{o("closed"),x(""),g(""),N(""),C("")},ee=()=>{G()},te=()=>{D.current=!1,P(0);const e=Date.now();S.current=setTimeout(()=>{D.current=!0,M(!0),P(100)},600);const t=setInterval(()=>{const a=Date.now()-e,s=Math.min(a/600*100,100);P(s),s>=100&&clearInterval(t)},16)},ae=()=>{S.current&&(clearTimeout(S.current),S.current=null),P(0),D.current||(o("amount"),x(""),g(""),C(""))},se=()=>{S.current&&(clearTimeout(S.current),S.current=null),P(0),D.current=!1},re=e=>{M(!1),D.current=!1,"transaction"===e?window.dispatchEvent(new CustomEvent("open-add-transaction-modal")):"receipt"===e&&window.dispatchEvent(new CustomEvent("open-receipt-scanner"))},ne=1+E/100*.15;return"closed"===n?i.createPortal(e.jsxs(e.Fragment,{children:[L&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>M(!1)}),L&&e.jsxs("div",{className:"fixed bottom-36 right-4 z-50 flex flex-col-reverse gap-2 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("button",{onClick:()=>re("receipt"),className:"flex items-center gap-3 pl-4 pr-5 py-3 rounded-full bg-purple-500 hover:bg-purple-600 text-white shadow-lg",children:[e.jsx(Y,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:a("receipt.scanReceipt","Scan Receipt")})]}),e.jsxs("button",{onClick:()=>re("transaction"),className:"flex items-center gap-3 pl-4 pr-5 py-3 rounded-full bg-green-500 hover:bg-green-600 text-white shadow-lg",children:[e.jsx(W,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:a("transaction.addTransaction","Add Transaction")})]})]}),e.jsx("button",{onPointerDown:te,onPointerUp:ae,onPointerLeave:se,onPointerCancel:se,className:c("fixed bottom-28 right-4 sm:bottom-6 sm:right-6 z-50","w-14 h-14 rounded-full","bg-gradient-to-r from-blue-500 to-purple-500","text-white shadow-lg","flex items-center justify-center","transition-transform duration-75",L&&"rotate-45"),style:{transform:`scale(${ne})`},"aria-label":a("quickEntry.add","Quick Add"),children:e.jsx(V,{size:28})})]}),document.body):i.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:ee,children:e.jsxs("div",{className:c("fixed inset-x-0 bottom-0 z-50","bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl","transform transition-transform duration-300","max-h-[85vh] overflow-hidden"),onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:"amount"===n?ee:()=>{"category"===n?o("amount"):"account"===n&&o("category")},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(B,{size:20,className:"text-gray-500"})}),e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["amount"===n&&a("quickEntry.enterAmount","Enter Amount"),"category"===n&&a("quickEntry.selectCategory","Select Category"),"account"===n&&a("quickEntry.selectAccount","Select Account")]}),e.jsx("div",{className:"w-9"})," "]}),"amount"===n&&e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:ce.map(t=>e.jsxs("button",{onClick:()=>j(t),className:c("px-4 py-2 rounded-full text-sm font-medium transition-all",v===t?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[ie[t]," ",t]},t))}),e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("div",{className:"text-4xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[U,J]}),F&&e.jsxs("div",{className:"text-lg text-blue-500 dark:text-blue-400 mt-2 font-numbers",children:["â‰ˆ ",F.symbol,F.formatted]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:a("quickEntry.expense","Expense")})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-w-xs mx-auto",children:de.map(t=>e.jsx("button",{onClick:()=>(e=>{"DEL"===e?x(e=>e.slice(0,-1)):u.length<10&&x(t=>t+e)})(t),className:c("h-14 rounded-xl text-xl font-medium transition-colors","DEL"===t?"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"DEL"===t?e.jsx(H,{size:20,className:"mx-auto"}):t},t))}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[T&&e.jsx("button",{onMouseDown:A,onMouseUp:_,onMouseLeave:"listening"===z?_:void 0,onTouchStart:A,onTouchEnd:_,onTouchCancel:_,className:c("h-14 w-14 rounded-xl flex items-center justify-center transition-all select-none touch-none","listening"===z?"bg-red-500 text-white animate-pulse scale-110":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),title:a("voiceInput.holdToTalk","Hold to talk"),children:e.jsx(X,{size:24})}),e.jsx("button",{onClick:()=>{"amount"===n&&u&&o("category")},disabled:!u,className:c("flex-1 h-14 rounded-xl font-medium text-white transition-all",u?"bg-blue-500 hover:bg-blue-600":"bg-gray-300 dark:bg-gray-600 cursor-not-allowed"),children:a("common.next","Next")})]}),"listening"===z&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/30 rounded-lg border-2 border-red-300 dark:border-red-700",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center font-medium",children:R||a("voiceInput.listening","Listening...")})})]}),"category"===n&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-center py-2 mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[U,J]}),F&&e.jsxs("span",{className:"text-lg text-blue-500 dark:text-blue-400 ml-2 font-numbers",children:["â†’ ",F.symbol,F.formatted]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:le.map(t=>e.jsxs("button",{onClick:()=>{return e=t.id,g(e),void(1===(null==s?void 0:s.length)?Q(e):o("account"));var e},className:c("flex flex-col items-center p-4 rounded-xl transition-all","bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600","active:scale-95"),children:[e.jsx("span",{className:"text-2xl mb-1",children:t.icon}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-300 text-center",children:a(t.labelKey,t.value)})]},t.id))})]}),"account"===n&&e.jsxs("div",{className:"p-4 overflow-x-hidden",children:[e.jsxs("div",{className:"text-center py-2 mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[U,J]}),F&&e.jsxs("span",{className:"text-lg text-blue-500 dark:text-blue-400 ml-2 font-numbers",children:["â†’ ",F.symbol,F.formatted]}),e.jsx("span",{className:"ml-2 text-gray-500",children:null==(t=le.find(e=>e.id===m))?void 0:t.icon})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:w,onChange:e=>C(e.target.value),placeholder:a("account.searchPlaceholder","Search accounts..."),className:c("w-full h-10 pl-9 pr-4 rounded-lg text-sm","bg-gray-100 dark:bg-gray-700 border-0","text-gray-900 dark:text-gray-100","placeholder:text-gray-400 dark:placeholder:text-gray-500","focus:outline-none focus:ring-2 focus:ring-blue-500"),autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto overflow-x-hidden",children:[K.map(t=>e.jsxs("button",{onClick:()=>{return e=t.id,f(e),void Q(m,e);var e},className:c("w-full flex items-center justify-between p-4 rounded-xl transition-all","bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600","active:scale-[0.98]"),children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:ie[t.currency]||t.currency})]},t.id)),0===K.length&&e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:a("account.noResults","No accounts found")})]}),$.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),e.jsx("span",{children:a("common.saving","Saving...")})]})]})]})}),document.body)}function xe({transaction:t,onEdit:a,onDelete:s}){const{isPrivacyMode:r}=b(),n=h(),[o,i]=l.useState(0),[c,d]=l.useState(!1),[u,x]=l.useState(0),m=l.useRef(null);return l.useEffect(()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&i(0)};if(o>0)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]),e.jsxs("div",{ref:m,className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center justify-center bg-red-600",style:{width:"80px"},children:e.jsxs("button",{onClick:e=>{e.stopPropagation(),s(t)},className:"h-full w-full flex flex-col items-center justify-center text-white transition-opacity",style:{opacity:o>0?1:0},"aria-label":"Delete transaction",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 mb-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),e.jsx("span",{className:"text-xs font-medium",children:"å‰Šé™¤"})]})}),e.jsx("div",{className:"relative",style:{transform:`translateX(-${o}px)`,transition:c?"none":"transform 250ms ease-out"},onTouchStart:e=>{x(e.touches[0].clientX),d(!0)},onTouchMove:e=>{if(!c)return;const t=e.touches[0].clientX,a=u-t;i(a>0?Math.min(a,80):Math.max(a,-20))},onTouchEnd:()=>{d(!1),i(o>40?80:0)},onClick:()=>{o>0?i(0):a(t)},children:e.jsxs(f,{className:"cursor-pointer active:scale-[0.98] transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-50",children:t.description}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:v(t.date)})]}),e.jsx("p",{className:"text-lg font-bold font-numbers "+(t.is_transfer?"text-blue-500 dark:text-blue-400":"income"===t.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:j(t.amount,t.type,t.currency||"JPY",n,!0,r)})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(T,{children:t.category}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.source})]})]})})]})}function me({isOpen:t,onClose:a,onConfirm:s,transaction:r,isDeleting:n=!1}){const{t:o}=I("common"),{currency:l}=k(),{isPrivacyMode:c}=b(),d=h();if(!t||!r)return null;const u=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:o("transaction.deleteConfirm","å–å¼•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6 space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.description}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:v(r.date)}),e.jsx("span",{className:"font-bold font-numbers "+("income"===r.type?"text-green-600":"text-red-600"),children:j(r.amount,r.type,l,d,!1,c)})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:r.category}),e.jsx("span",{children:"-"}),e.jsx("span",{children:r.source})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:o("transaction.deleteWarning","ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:a,disabled:n,className:"flex-1",children:o("button.cancel","ã‚­ãƒ£ãƒ³ã‚»ãƒ«")}),e.jsx(m,{onClick:s,disabled:n,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:n?"å‰Šé™¤ä¸­...":o("button.delete","å‰Šé™¤")})]})]})]});return"undefined"!=typeof document?i.createPortal(u,document.body):null}function ge({isOpen:t,onClose:a,onConfirm:s,selectedCount:r,isLoading:n}){const{t:o}=I("common"),[c,d]=l.useState(""),u=[{value:"",label:o("transactions.selectCategory","Select category...")},{value:"é£Ÿè²»",label:o("category.food","Food")},{value:"ä½å®…",label:o("category.housing","Housing")},{value:"äº¤é€š",label:o("category.transport","Transport")},{value:"å¨¯æ¥½",label:o("category.entertainment","Entertainment")},{value:"é€šä¿¡",label:o("category.communication","Communication")},{value:"æ—¥ç”¨å“",label:o("category.daily","Daily Necessities")},{value:"åŒ»ç™‚",label:o("category.medical","Medical")},{value:"æ•™è‚²",label:o("category.education","Education")},{value:"ãã®ä»–",label:o("category.other","Other")}];if(!t)return null;const x=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:o("transactions.recategorizeTitle","Change Category")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:o("transactions.recategorizeDescription","Update category for {{count}} transactions",{count:r})}),e.jsx(R,{label:o("transactions.newCategory","New Category"),value:c,onChange:e=>d(e.target.value),options:u}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(m,{variant:"outline",onClick:a,className:"flex-1",children:o("button.cancel","Cancel")}),e.jsx(m,{onClick:()=>{c&&(s(c),d(""))},disabled:!c||n,className:"flex-1",children:n?o("button.saving","Saving..."):o("button.apply","Apply")})]})]})]});return"undefined"!=typeof document?i.createPortal(x,document.body):null}function he({isOpen:t,onClose:a,onConfirm:s,selectedCount:r,isDeleting:n}){const{t:o}=I("common");if(!t)return null;const l=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:o("transactions.bulkDeleteTitle","Delete Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:o("transactions.bulkDeleteConfirm","Are you sure you want to delete {{count}} transactions? This cannot be undone.",{count:r})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:a,className:"flex-1",children:o("button.cancel","Cancel")}),e.jsx(m,{variant:"danger",onClick:s,disabled:n,className:"flex-1",children:n?o("button.deleting","Deleting..."):o("button.delete","Delete")})]})]})]});return"undefined"!=typeof document?i.createPortal(l,document.body):null}function ye(e,t,a){const s=function(e){const t=e.map(e=>[e.date,`"${e.description.replace(/"/g,'""')}"`,e.amount.toString(),e.type,e.category,e.source]);return[["Date","Description","Amount","Type","Category","Source"].join(","),...t.map(e=>e.join(","))].join("\n")}(e);!function(e,t){const a=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}(s,`smartmoney_transactions_${t&&a?`${t}_to_${a}`:(new Date).toISOString().split("T")[0]}.csv`)}function pe(e){const[t,a]=e.split("-").map(Number),s=`${t}-${String(a).padStart(2,"0")}-01`,r=new Date(t,a,0).getDate();return{start:s,end:`${t}-${String(a).padStart(2,"0")}-${String(r).padStart(2,"0")}`}}const be=o("/transactions")({component:function(){const{t:o}=I("common"),{currency:i}=k(),{isPrivacyMode:u}=b(),A=h(),_=t(),O=s(),Y=N(),{data:F}=d(),{categories:$,month:J,accountId:Q,fromAccounts:W,type:V}=r({from:"/transactions"}),H=$?$.split(",").filter(Boolean):[],X=J?pe(J):Y,[Z,se]=l.useState({start_date:X.start,end_date:X.end,categories:H,source:"",type:V||"all"}),[ne,oe]=l.useState(""),le=function(e,t){const[a,s]=l.useState(e);return l.useEffect(()=>{const a=setTimeout(()=>s(e),t);return()=>clearTimeout(a)},[e,t]),a}(ne,300),[ie,ce]=l.useState(""),[de,be]=l.useState(""),[fe,ve]=l.useState("thisMonth"),[je,ke]=l.useState(!1),Ne=e=>{if(ve(e),"custom"!==e){const t=(e=>{const t=new Date;let a,s=t;switch(e){case"today":a=t;break;case"thisWeek":a=new Date(t),a.setDate(t.getDay()-t.getDay());break;case"thisMonth":default:a=new Date(t.getFullYear(),t.getMonth(),1);break;case"lastMonth":a=new Date(t.getFullYear(),t.getMonth()-1,1),s=new Date(t.getFullYear(),t.getMonth(),0);break;case"last3Months":a=new Date(t.getFullYear(),t.getMonth()-3,1)}return{start:a.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}})(e);se(e=>({...e,start_date:t.start,end_date:t.end}))}},we=(e,t)=>{const a=t?parseFloat(t):void 0;"min"===e?(ce(t),se(e=>({...e,min_amount:a}))):(be(t),se(e=>({...e,max_amount:a})))},Ce=e=>{const t=Z[e];return"categories"===e?!!(t&&t.length>0):"type"===e?"all"!==t:"source"===e?!!t:"min_amount"===e||"max_amount"===e?void 0!==t:!!t},Se=[Ce("categories"),Ce("source"),Ce("min_amount"),Ce("max_amount"),"thisMonth"!==fe].filter(Boolean).length,[De,Le]=l.useState("date"),[Me,Ee]=l.useState("desc"),[Pe,ze]=l.useState(50),[Re,Te]=l.useState(!1),Ae=e=>{Te(!0),De===e?Ee(e=>"asc"===e?"desc":"asc"):(Le(e),Ee("desc")),setTimeout(()=>Te(!1),150)};l.useEffect(()=>{se(e=>({...e,search:le||void 0}))},[le]),l.useEffect(()=>{if($||J||void 0!==V){const e=J?pe(J):Y,t=$?$.split(",").filter(Boolean):[];se(a=>({...a,categories:t.length>0?t:a.categories,start_date:e.start,end_date:e.end,type:V||"all"}))}},[$,J,V]);const _e=e=>{const t=V===e?void 0:e;O({to:"/transactions",search:e=>({...e,type:t})})},[Oe,qe]=l.useState(null),[Ke,Ue]=l.useState(!1),[Ie,Ye]=l.useState(null),[Fe,$e]=l.useState(!1),[Je,Be]=l.useState(new Set),[Qe,We]=l.useState(!1),[Ve,He]=l.useState(!1),{data:Xe,isLoading:Ze}=n({queryKey:["transactions",Z],queryFn:()=>z(Z)});l.useEffect(()=>{Be(new Set)},[Xe]),l.useEffect(()=>{const e=()=>{Ue(!0)},t=()=>{$e(!0)};return window.addEventListener("open-add-transaction-modal",e),window.addEventListener("open-receipt-scanner",t),()=>{window.removeEventListener("open-add-transaction-modal",e),window.removeEventListener("open-receipt-scanner",t)}},[]);const Ge=q(p,"transaction",[["transactions"],["analytics"]]),et=[{value:"é£Ÿè²»",label:o("category.food","Food")},{value:"ä½å®…",label:o("category.housing","Housing")},{value:"äº¤é€š",label:o("category.transport","Transport")},{value:"å¨¯æ¥½",label:o("category.entertainment","Entertainment")},{value:"é€šä¿¡",label:o("category.communication","Communication")},{value:"æ—¥ç”¨å“",label:o("category.daily","Daily Necessities")},{value:"åŒ»ç™‚",label:o("category.medical","Medical")},{value:"æ•™è‚²",label:o("category.education","Education")},{value:"ãã®ä»–",label:o("category.other","Other")}],tt=Xe&&Xe.length>0&&Xe.every(e=>Je.has(e.id)),at=a({mutationFn:e=>x(e),onSuccess:()=>{_.invalidateQueries({queryKey:["transactions"]}),_.invalidateQueries({queryKey:["dashboard"]}),_.invalidateQueries({queryKey:["analytics"]}),Ye(null)}}),st=a({mutationFn:()=>w(Array.from(Je)),onSuccess:()=>{_.invalidateQueries({queryKey:["transactions"]}),_.invalidateQueries({queryKey:["dashboard"]}),_.invalidateQueries({queryKey:["analytics"]}),Be(new Set),He(!1)}}),rt=a({mutationFn:e=>C(Array.from(Je),e),onSuccess:()=>{_.invalidateQueries({queryKey:["transactions"]}),Be(new Set),We(!1)}}),nt=l.useMemo(()=>{if(!Xe)return[];if(!Q)return Xe;const e=Number(Q);return Xe.filter(t=>null!=t.account_id&&Number(t.account_id)===e)},[Xe,Q]),ot=l.useMemo(()=>Q&&F&&F.find(e=>e.id===Number(Q))||null,[Q,F]),lt=(null==ot?void 0:ot.currency)||i,it={JPY:1,USD:.00667,VND:167},{income:ct,expense:dt,net:ut}=l.useMemo(()=>{const e=nt,t=(e,t)=>{if(ot)return e;const a=P[t]??0,s=e/Math.pow(10,a);if("JPY"===t)return s;const r=A[t]??it[t];return r&&0!==r?s/r:s},a=e.filter(e=>"income"===e.type&&!e.is_transfer).reduce((e,a)=>e+t(a.amount,a.currency||"JPY"),0),s=e.filter(e=>"expense"===e.type&&!e.is_transfer).reduce((e,a)=>e+t(Math.abs(a.amount),a.currency||"JPY"),0);return{income:a,expense:s,net:a-s}},[nt,ot,A]),xt=l.useMemo(()=>nt.length?[...nt].sort((e,t)=>{let a=0;switch(De){case"date":a=e.date.localeCompare(t.date);break;case"description":a=e.description.localeCompare(t.description);break;case"category":a=e.category.localeCompare(t.category);break;case"source":a=e.source.localeCompare(t.source);break;case"amount":a=e.amount-t.amount}return"asc"===Me?a:-a}):[],[nt,De,Me]),mt=l.useMemo(()=>"all"===Pe?xt:xt.slice(0,Pe),[xt,Pe]),gt=l.useMemo(()=>{if(!mt.length)return[];const e=[];let t="";return mt.forEach(a=>{a.date!==t?(t=a.date,e.push({date:a.date,transactions:[a]})):e[e.length-1].transactions.push(a)}),e},[mt]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-6 pb-28",children:[W&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>O({to:"/accounts"}),className:"mb-4 -ml-2",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),o("common.backToAccounts")]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:o("transactions.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:o("transactions.subtitle")})]}),e.jsx(f,{className:"mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(g,{placeholder:o("transactions.searchPlaceholder","Search transactions..."),value:ne,onChange:e=>oe(e.target.value),className:"h-11"}),ne&&e.jsx("button",{onClick:()=>{oe(""),se(e=>{const t={...e};return oe(""),t.search=void 0,t})},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ke(!je),className:c("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",je||Se>0?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[e.jsx(ee,{className:"w-4 h-4"}),o("button.filter","Filter"),Se>0&&e.jsx("span",{className:"bg-primary-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:Se}),e.jsx(te,{className:c("w-4 h-4 transition-transform",je&&"rotate-180")})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide flex-1",children:[{key:"today",label:o("date.today","Today")},{key:"thisWeek",label:o("date.thisWeek","This Week")},{key:"thisMonth",label:o("date.thisMonth","This Month")}].map(({key:t,label:a})=>e.jsx("button",{onClick:()=>Ne(t),className:c("px-3 py-2 text-xs sm:text-sm font-medium rounded-lg whitespace-nowrap transition-colors",fe===t?"bg-primary-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:a},t))})]}),je&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-600 space-y-3 animate-slide-up",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(g,{type:"number",placeholder:o("transactions.minAmount","Min"),value:ie,onChange:e=>we("min",e.target.value),className:"h-10"}),e.jsx(g,{type:"number",placeholder:o("transactions.maxAmount","Max"),value:de,onChange:e=>we("max",e.target.value),className:"h-10"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx(ae,{label:o("transactions.category","Category"),options:et,selected:Z.categories||[],onChange:e=>se({...Z,categories:e}),placeholder:o("transactions.allCategories","All")})}),e.jsx(R,{label:o("transactions.source","Source"),value:Z.source||"",onChange:e=>se({...Z,source:e.target.value}),options:[{value:"",label:o("transactions.all","All")},...(null==F?void 0:F.map(e=>({value:e.name,label:e.name})))||[]]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{se({start_date:Y.start,end_date:Y.end,categories:[],source:"",type:"all"}),oe(""),ve("thisMonth"),ce(""),be(""),O({to:"/transactions",search:{}})},children:o("button.reset","Reset")}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Xe&&ye(Xe,Z.start_date,Z.end_date),disabled:!Xe||0===Xe.length,children:o("transactions.export","Export")})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs(f,{onClick:()=>_e("income"),className:"cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] "+("income"===V?"ring-2 ring-green-500 dark:ring-green-400 bg-green-50/50 dark:bg-green-900/20":""),children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:o("transactions.income")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-green-600 dark:text-green-400",children:S(ct,lt,A,!0,u)})]}),e.jsxs(f,{onClick:()=>_e("expense"),className:"cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] "+("expense"===V?"ring-2 ring-red-500 dark:ring-red-400 bg-red-50/50 dark:bg-red-900/20":""),children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:o("transactions.expense")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-red-600 dark:text-red-400",children:S(dt,lt,A,!0,u)})]}),e.jsxs(f,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:o("transactions.difference")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-blue-600 dark:text-blue-400",children:S(ut,lt,A,!0,u)})]})]}),!Ze&&Xe&&Xe.length>0&&e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o("transactions.show","Show"),":"]}),e.jsx("div",{className:"hidden md:flex gap-1",children:[50,100,"all"].map(t=>e.jsx("button",{onClick:()=>ze(t),className:"px-3 py-1 text-sm rounded-md transition-colors "+(Pe===t?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"all"===t?o("transactions.showAll","All"):t},t))}),e.jsxs("select",{value:Pe,onChange:e=>ze("all"===e.target.value?"all":Number(e.target.value)),className:"md:hidden px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"all",children:o("transactions.showAll","All")})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o("transactions.sort","Sort"),":"]}),e.jsxs("select",{value:`${De}-${Me}`,onChange:e=>(e=>{Te(!0);const[t,a]=e.split("-");Le(t),Ee(a),setTimeout(()=>Te(!1),150)})(e.target.value),className:"px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"date-desc",children:o("transactions.sortDateDesc","Date â†“")}),e.jsx("option",{value:"date-asc",children:o("transactions.sortDateAsc","Date â†‘")}),e.jsx("option",{value:"amount-desc",children:o("transactions.sortAmountDesc","Amount â†“")}),e.jsx("option",{value:"amount-asc",children:o("transactions.sortAmountAsc","Amount â†‘")})]}),Re&&e.jsxs("svg",{className:"animate-spin h-4 w-4 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:o("transactions.showingCount","Showing {{shown}} of {{total}}",{shown:mt.length,total:xt.length})})]}),Ze?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:o("transactions.date")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:o("transactions.description")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:o("transactions.category")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:o("transactions.source")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:o("transactions.amount")}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:o("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:[...Array(5)].map((t,a)=>e.jsx(D,{},a))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:[...Array(5)].map((t,a)=>e.jsx(L,{},a))})]}):Xe&&Xe.length>0?e.jsxs("div",{className:"transition-opacity duration-150 "+(Re?"opacity-50":"opacity-100"),children:[e.jsx(f,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12",children:e.jsx("input",{type:"checkbox",checked:tt,onChange:()=>{Be(tt?new Set:new Set((null==Xe?void 0:Xe.map(e=>e.id))||[]))},className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ae("date"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[o("transactions.date"),"date"===De&&e.jsx("span",{className:"text-blue-600",children:"asc"===Me?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ae("description"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[o("transactions.description"),"description"===De&&e.jsx("span",{className:"text-blue-600",children:"asc"===Me?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ae("category"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[o("transactions.category"),"category"===De&&e.jsx("span",{className:"text-blue-600",children:"asc"===Me?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ae("source"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[o("transactions.source"),"source"===De&&e.jsx("span",{className:"text-blue-600",children:"asc"===Me?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>Ae("amount"),children:e.jsxs("span",{className:"flex items-center justify-end gap-1",children:[o("transactions.amount"),"amount"===De&&e.jsx("span",{className:"text-blue-600",children:"asc"===Me?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:o("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:mt.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:Je.has(t.id),onChange:()=>(e=>{const t=new Set(Je);t.has(e)?t.delete(e):t.add(e),Be(t)})(t.id),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:v(t.date)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:t.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(T,{variant:"income"===t.type?"info":"default",children:t.category})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-300",children:t.source}),e.jsx("td",{className:"px-6 py-4 text-sm font-semibold font-numbers text-right "+(t.is_transfer?"text-blue-500 dark:text-blue-400":"income"===t.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:j(t.amount,t.type,t.currency||"JPY",A,!0,u)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>qe(t),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors","aria-label":o("button.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})})}),e.jsx("button",{onClick:()=>Ye(t),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors","aria-label":o("button.delete"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-red-600 dark:text-red-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]})})]},t.id))})]})}),e.jsx("div",{className:"md:hidden space-y-6",children:"date"===De?gt.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:M(t.date)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx("div",{className:"space-y-3",children:t.transactions.map(t=>e.jsx(xe,{transaction:t,onEdit:qe,onDelete:Ye},t.id))})]},t.date)):e.jsx("div",{className:"space-y-3",children:mt.map(t=>e.jsx(xe,{transaction:t,onEdit:qe,onDelete:Ye},t.id))})})]}):e.jsx(f,{children:e.jsx(E,{icon:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),title:o("transactions.noData"),description:o("transactions.noDataDescription","Upload a CSV file or add transactions manually to get started."),action:e.jsx(m,{onClick:()=>Ue(!0),children:o("transaction.addTransaction")})})}),Je.size>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg p-4 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:o("transactions.selectedCount","{{count}} selected",{count:Je.size})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Be(new Set),children:o("button.clearSelection","Clear")}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>We(!0),children:o("transactions.recategorize","Recategorize")}),e.jsx(m,{variant:"danger",size:"sm",onClick:()=>He(!0),children:o("transactions.deleteSelected","Delete")})]})]})}),e.jsx(re,{isOpen:!!Oe,onClose:()=>qe(null),transaction:Oe}),e.jsx(K,{isOpen:Ke,onClose:()=>Ue(!1)}),e.jsx(me,{isOpen:!!Ie,onClose:()=>Ye(null),onConfirm:()=>{Ie&&at.mutate(Ie.id)},transaction:Ie,isDeleting:at.isPending}),e.jsx(ge,{isOpen:Qe,onClose:()=>We(!1),onConfirm:e=>rt.mutate(e),selectedCount:Je.size,isLoading:rt.isPending}),e.jsx(he,{isOpen:Ve,onClose:()=>He(!1),onConfirm:()=>st.mutate(),selectedCount:Je.size,isDeleting:st.isPending}),e.jsx(U,{isOpen:Fe,onClose:()=>$e(!1),onScanComplete:e=>{if(!e.amount||!e.category)return;const t=null==F?void 0:F[0],a=(null==t?void 0:t.currency)||"JPY",s=y(Math.abs(e.amount),a);Ge.mutate({date:e.date||(new Date).toISOString().split("T")[0],description:e.merchant||"Receipt Scan",amount:-s,currency:a,category:e.category,source:(null==t?void 0:t.name)||"Unknown",type:"expense"})}}),e.jsx(ue,{})]})}});export{be as Route};
