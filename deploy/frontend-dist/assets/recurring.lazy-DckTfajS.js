import{j as e,e as ae}from"./vendor-router-DONIM_LE.js";import{r as l,a as se}from"./vendor-react-Cwh1aMWO.js";import{b as Y,c as Q,u as ne}from"./vendor-query-B0NEAgzV.js";import{R as le}from"./RecurringTransactionsList-EpHwxdnC.js";import{i as oe,N as ce,X as V,j as b,I as A,B as K,C as ie,P as Z,R as ue}from"./index-q8ZhdUGX.js";import{S as O}from"./Select-BX2cSNjs.js";import{R as de}from"./RecurringOptions-BKWtt6DF.js";import{d as me}from"./useCategories-BEgXmcdj.js";import{c as ge,u as xe,d as ye,f as fe}from"./recurring-service-CIfHa8Jb.js";import{u as z}from"./vendor-i18n-CNDlYvyf.js";import{L as he}from"./lightbulb-DhGY60Xd.js";import{C as pe}from"./chevron-up-DqQod2kw.js";import{C as be}from"./chevron-down-CvGBm_XV.js";import"./vendor-charts-D-N8xF42.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],ve=oe("arrow-left-right",je);function ke({isOpen:d,onClose:o,editItem:s,initialSuggestion:n}){const{t:a}=z("common"),m=Y(),{data:u}=ce(),{data:c}=me(),y=(t=[])=>t.flatMap(x=>[{name:x.name},...x.children.map(re=>({name:re.name}))]),P=y(c==null?void 0:c.expense),L=y(c==null?void 0:c.income),[N,f]=l.useState(""),[r,g]=l.useState(""),[B,w]=l.useState(""),[j,S]=l.useState(null),[C,h]=l.useState(!1),[i,p]=l.useState(!1),[v,_]=l.useState(null),[E,D]=l.useState(""),[k,q]=l.useState("monthly"),[H,R]=l.useState(0),[J,M]=l.useState(1),[U,F]=l.useState(7),[W,T]=l.useState(new Date().toISOString().split("T")[0]);l.useEffect(()=>{var t;d&&s?(f(s.description),g(Math.abs(s.amount).toString()),w(s.category),S(s.account_id),h(s.is_income),p(s.is_transfer),_(s.to_account_id),D(((t=s.transfer_fee_amount)==null?void 0:t.toString())??""),q(s.frequency),R(s.day_of_week??0),M(s.day_of_month??1),F(s.interval_days??7),T(s.next_run_date)):d&&n?(f(n.description),g(n.amount.toString()),w(n.category),S(null),h(n.is_income),p(!1),_(null),D(""),q(n.frequency),R(n.day_of_week??0),M(n.day_of_month??new Date().getDate()),F(n.interval_days??14),T(new Date().toISOString().split("T")[0])):d&&(f(""),g(""),w(""),S(null),h(!1),p(!1),_(null),D(""),q("monthly"),R(0),M(new Date().getDate()),F(7),T(new Date().toISOString().split("T")[0]))},[d,s,n]);const X=Q({mutationFn:ge,onSuccess:()=>{m.invalidateQueries({queryKey:["recurring-transactions"]}),o()}}),G=Q({mutationFn:({id:t,data:x})=>xe(t,x),onSuccess:()=>{m.invalidateQueries({queryKey:["recurring-transactions"]}),o()}}),$=t=>{t.preventDefault();const x={description:N,amount:parseInt(r,10),category:i?"Transfer":B,account_id:j,is_income:i?!1:C,is_transfer:i,to_account_id:i?v:null,transfer_fee_amount:i&&E?parseInt(E,10):null,frequency:k,day_of_week:k==="weekly"?H:null,day_of_month:k==="monthly"?J:null,interval_days:k==="custom"?U:null,start_date:W};s?G.mutate({id:s.id,data:x}):X.mutate(x)},ee=i?[]:C?L:P,I=X.isPending||G.isPending;if(!d)return null;const te=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:o}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-lg max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a(s?"recurring.edit":"recurring.add")}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:$,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("transaction.type")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),p(!1)},className:b("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",!C&&!i?"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:a("transaction.expense")}),e.jsx("button",{type:"button",onClick:()=>{h(!0),p(!1)},className:b("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",C&&!i?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:a("transaction.income")}),e.jsxs("button",{type:"button",onClick:()=>{p(!0),h(!1)},className:b("flex-1 py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-1",i?"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:[e.jsx(ve,{className:"w-4 h-4"}),a("recurring.transfer","Transfer")]})]})]}),e.jsx(A,{label:a("transaction.description"),value:N,onChange:t=>f(t.target.value),placeholder:a("recurring.descriptionPlaceholder","e.g., Monthly rent"),required:!0}),e.jsx(A,{label:a("transaction.amount"),type:"number",value:r,onChange:t=>g(t.target.value),placeholder:"0",min:"1",required:!0}),!i&&e.jsx(O,{label:a("transaction.category"),value:B,onChange:t=>w(t.target.value),options:[{value:"",label:a("transaction.selectCategory")},...ee.map(t=>({value:t.name,label:t.name}))],required:!0}),e.jsx(O,{label:i?a("recurring.fromAccount","From Account"):a("transaction.account"),value:(j==null?void 0:j.toString())??"",onChange:t=>S(t.target.value?parseInt(t.target.value,10):null),options:[{value:"",label:a("transaction.selectAccount","Select account")},...(u==null?void 0:u.filter(t=>t.id!==v).map(t=>({value:t.id.toString(),label:t.name})))??[]],required:i}),i&&e.jsxs(e.Fragment,{children:[e.jsx(O,{label:a("recurring.toAccount","To Account"),value:(v==null?void 0:v.toString())??"",onChange:t=>_(t.target.value?parseInt(t.target.value,10):null),options:[{value:"",label:a("recurring.selectDestAccount","Select destination")},...(u==null?void 0:u.filter(t=>t.id!==j).map(t=>({value:t.id.toString(),label:t.name})))??[]],required:!0}),e.jsx(A,{label:a("recurring.transferFee","Transfer Fee (optional)"),type:"number",value:E,onChange:t=>D(t.target.value),placeholder:"0",min:"0"})]}),e.jsx(de,{frequency:k,setFrequency:q,dayOfWeek:H,setDayOfWeek:R,dayOfMonth:J,setDayOfMonth:M,intervalDays:U,setIntervalDays:F}),e.jsx(A,{label:a("recurring.startDate"),type:"date",value:W,onChange:t=>T(t.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(K,{type:"button",variant:"outline",onClick:o,className:"flex-1",children:a("button.cancel")}),e.jsx(K,{type:"submit",disabled:I,className:"flex-1",children:I?a("button.saving","Saving..."):a("button.save")})]})]})]})]});return typeof document>"u"?null:se.createPortal(te,document.body)}const Ne={JPY:"Â¥"};function we({onCreateFromSuggestion:d}){const{t:o}=z("common"),s=Y(),[n,a]=l.useState(!0),[m,u]=l.useState(null),{data:c,isLoading:y}=ne({queryKey:["recurring-suggestions"],queryFn:()=>fe(3),staleTime:5*60*1e3}),P=Q({mutationFn:ye,onSuccess:()=>{s.invalidateQueries({queryKey:["recurring-suggestions"]}),u(null)},onError:()=>{u(null)}}),L=(r,g)=>{g.stopPropagation(),u(r),P.mutate(r)},N=r=>{switch(r.frequency){case"weekly":return o("recurring.weekly");case"monthly":return o("recurring.monthly");case"custom":return o("recurring.everyNDays",{n:r.interval_days??14});default:return r.frequency}},f=r=>r>=80?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":r>=60?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300";return y||!c||c.length===0?null:e.jsxs(ie,{className:"mb-6 border-l-4 border-l-amber-400 bg-amber-50/50 dark:bg-amber-950/20",children:[e.jsxs("button",{onClick:()=>a(!n),className:"w-full flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/50 rounded-lg",children:e.jsx(he,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o("recurring.suggestions.title","Detected Patterns")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:o("recurring.suggestions.subtitle","{{count}} potential recurring transactions found",{count:c.length})})]})]}),n?e.jsx(pe,{className:"w-5 h-5 text-gray-400"}):e.jsx(be,{className:"w-5 h-5 text-gray-400"})]}),n&&e.jsx("div",{className:"mt-4 space-y-3",children:c.map(r=>e.jsx("div",{className:b("p-4 rounded-lg border bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700","transition-opacity",m===r.hash&&"opacity-50"),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:r.description}),e.jsxs("span",{className:b("px-2 py-0.5 text-xs font-medium rounded-full",f(r.confidence)),children:[r.confidence,"%"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:b("font-numbers",r.is_income?"text-income-600 dark:text-income-300":"text-expense-600 dark:text-expense-300"),children:[r.is_income?"+":"-",Ne.JPY,r.amount.toLocaleString()]}),e.jsx("span",{children:r.category}),e.jsx("span",{children:N(r)}),e.jsx("span",{className:"text-xs",children:o("recurring.suggestions.occurrences","{{count}} times",{count:r.occurrences})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(K,{size:"sm",variant:"primary",onClick:()=>d(r),className:"gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),o("button.create")]}),e.jsx("button",{onClick:g=>L(r.hash,g),disabled:m===r.hash,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:o("recurring.suggestions.dismiss","Dismiss"),children:e.jsx(V,{className:"w-4 h-4"})})]})]})},r.hash))})]})}function Se(){const{t:d}=z("common"),o=Y(),[s,n]=l.useState(!1),[a,m]=l.useState(null),u=y=>{m(y),n(!0)},c=()=>{n(!1),m(null),o.invalidateQueries({queryKey:["recurring-suggestions"]})};return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d("recurring.pageTitle","Recurring Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:d("recurring.pageSubtitle","Automate your regular income and expenses")})]})]}),e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Z,{className:"w-5 h-5"}),d("recurring.add","Add Recurring")]})]}),e.jsx(we,{onCreateFromSuggestion:u}),e.jsx(le,{}),e.jsx(ke,{isOpen:s,onClose:c,initialSuggestion:a})]})}const Ke=ae("/recurring")({component:Se});export{Ke as Route};
