import{k as $,F as o,u as S,r as v,j as t,aL as T,l as y,P as _,I as M,B as P,Y as E,J as F,K as L,z as q,a6 as R}from"./index-Df5i9fLp.js";import{d as J,e as A}from"./useCategories-CfItLRJ8.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],K=$("external-link",D);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Q=$("rotate-ccw",U);async function W(e){return(await o.post("/api/receipts/scan",e)).data}async function G(e){const a=new FormData;return a.append("file",e),(await o.post("/api/receipts/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function O(e){return e||null}function X({selected:e,onSelect:a,isIncome:n=!1}){const{t:u}=S("common"),{data:i,isLoading:C}=J(),w=A(),[s,b]=v.useState(null),[h,d]=v.useState(!1),[g,x]=v.useState(""),[l,f]=v.useState("ðŸ“");if(C||!i)return t.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const j=n?i.income:i.expense,p=r=>{for(const c of j)if(c.children.some(I=>I.name===r))return c;return null},m=r=>{b(r),d(!1)},k=r=>{s&&a(r.name,s.name)},B=()=>{b(null),d(!1)},N=async()=>{!s||!g.trim()||(await w.mutateAsync({name:g.trim(),icon:l,parent_id:s.id,type:n?"income":"expense"}),a(g.trim(),s.name),x(""),d(!1))};return s?t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:B,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[t.jsx(T,{className:"w-4 h-4"}),s.icon," ",s.name]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.children.map(r=>t.jsxs("button",{type:"button",onClick:()=>k(r),className:y("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",e===r.name?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[t.jsx("span",{className:"text-2xl mb-1",children:r.icon}),t.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:r.name})]},r.id)),t.jsxs("button",{type:"button",onClick:()=>d(!0),className:y("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[t.jsx(_,{className:"w-6 h-6 mb-1 text-gray-400"}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:u("category.addCustom","Add")})]})]}),h&&t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(M,{value:l,onChange:r=>f(r.target.value),className:"w-16 text-center text-xl",maxLength:2}),t.jsx(M,{value:g,onChange:r=>x(r.target.value),placeholder:u("category.namePlaceholder","Category name"),className:"flex-1"})]}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsx(P,{variant:"outline",size:"sm",onClick:()=>d(!1),children:u("cancel","Cancel")}),t.jsx(P,{size:"sm",onClick:N,disabled:!g.trim()||w.isPending,children:u("create","Create")})]})]})]}):t.jsx("div",{className:"grid grid-cols-3 gap-2",children:j.map(r=>{var c;return t.jsxs("button",{type:"button",onClick:()=>m(r),className:y("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((c=p(e))==null?void 0:c.id)===r.id?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[t.jsx("span",{className:"text-2xl mb-1",children:r.icon}),t.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:r.name})]},r.id)})})}async function Z(e){return(await o.post("/api/budgets/generate",e)).data}async function ee(e,a){return(await o.post(`/api/budgets/${e}/regenerate`,a)).data}async function te(e){return(await o.get(`/api/budgets/${e}`)).data}async function Y(e){return(await o.get("/api/budgets/tracking/current",{params:e?{month:e}:void 0})).data}async function ae(){return(await o.get("/api/budgets/suggestions")).data}async function re(e,a,n){return(await o.patch(`/api/budgets/${e}/allocations/${encodeURIComponent(a)}`,{amount:n})).data}async function se(e,a){return(await o.delete(`/api/budgets/${e}/allocations/${encodeURIComponent(a)}`)).data}async function ne(e){return(await o.post("/api/budgets/copy",e)).data}async function oe(e,a){return(await o.get("/api/budgets/copy/preview",{params:{source_month:e,target_month:a}})).data}async function ce(e){return(await o.get(`/api/budgets/${e}/versions`)).data}async function ie(e){return(await o.post(`/api/budgets/${e}/restore`)).data}function z(e,a,n){if(a==="JPY"||!n[a])return e;const u=n[a];if(u===0)return e;const i=a==="USD"?e/100:e;return Math.round(i/u)}function de({parentCategory:e,transactionAmount:a,isExpense:n,transactionCurrency:u="JPY"}){var r;const{t:i}=S("common"),{currency:C}=E(),{isPrivacyMode:w}=F(),{data:s}=L(),b=v.useMemo(()=>{const c=new Date;return`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`},[]),{data:h}=q({queryKey:["budget","tracking",b],queryFn:()=>Y(b),staleTime:2*60*1e3,retry:!1}),d=c=>R(c,C,(s==null?void 0:s.rates)||{},!0,w);if(!n)return null;const g=(r=h==null?void 0:h.categories)==null?void 0:r.find(c=>c.category===e);if(!g)return null;const{spent:x,budgeted:l}=g,f=l>0?x/l*100:0,j=z(a,u,(s==null?void 0:s.rates)||{}),p=x+j,m=l>0?p/l*100:0,k=p>l,B=()=>m>=100?"bg-red-500":m>=80?"bg-amber-500":"bg-green-500",N=()=>k?"text-red-600 dark:text-red-400":m>=80?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400";return t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 truncate",children:i("budget.insight.countsToward",{category:e})}),t.jsx("span",{className:y("text-xs font-semibold whitespace-nowrap",N()),children:k?i("budget.insight.over",{amount:d(p-l)}):i("budget.insight.left",{amount:d(l-p)})})]}),t.jsx("div",{className:"mt-1.5",children:t.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:t.jsxs("div",{className:"h-full rounded-full relative overflow-hidden",children:[t.jsx("div",{className:y("h-full rounded-full transition-all duration-300",B()),style:{width:`${Math.min(m,100)}%`}}),a>0&&t.jsx("div",{className:"absolute top-0 h-full opacity-50 rounded-r-full",style:{left:`${Math.min(f,100)}%`,width:`${Math.min(m-f,100-Math.min(f,100))}%`,background:"repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.4) 2px, rgba(255,255,255,0.4) 4px)"}})]})})}),t.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[i("budget.budgetContext.progress",{spent:d(x),budgeted:d(l)}),a>0&&t.jsxs("span",{className:y("ml-1",N()),children:["â†’ ",d(p)]})]}),k&&a>0&&t.jsx("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mt-1",children:i("budget.insight.willExceed")})]})}export{de as B,K as E,X as H,Q as R,ie as a,te as b,ne as c,se as d,Y as e,ae as f,Z as g,ce as h,O as i,G as j,oe as p,ee as r,W as s,re as u};
