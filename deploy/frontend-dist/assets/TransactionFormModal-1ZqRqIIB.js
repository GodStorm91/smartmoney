import{J as ie,a3 as _,bk as Ne,bl as se,u as E,r as t,z as we,j as e,l as w,bm as Ce,aV as W,X as K,g as oe,U as Se,aA as Re,v as le,a1 as Ie,bn as De,aO as Ee,R as Pe,B as ne,ad as Te,ae as Oe}from"./index-CqkF-9Du.js";import{c as Fe}from"./recurring-service-DRysxgtb.js";import{R as Le,s as ze,H as Ae,u as Me}from"./HierarchicalCategoryPicker-BiiqqkZC.js";import{R as Ue}from"./RecurringOptions-DeQ2BUHS.js";import{u as qe}from"./useXPGain-DX6Gl6aa.js";function _e(d,h){const c=ie(),{entityType:a,operationType:o,getEntityId:p=()=>0,invalidateKeys:g=[],onSuccess:s,onError:i}=h;return _({mutationFn:async n=>{if(!navigator.onLine){const l=p(n);return await se(o,a,l,n),null}try{const l=await d(n);for(const b of g)c.invalidateQueries({queryKey:b});return l}catch(l){if(l instanceof TypeError&&l.message.includes("fetch")){const b=p(n);return await se(o,a,b,n),null}throw l}},onSuccess:n=>{navigator.onLine&&Ne(),s==null||s(n)},onError:n=>{i==null||i(n)}})}function We(d,h,c){return _e(d,{entityType:h,operationType:"CREATE",invalidateKeys:c})}function Ke({value:d,onChange:h,onSuggestionSelect:c,placeholder:a,className:o,error:p}){const{t:g}=E("common"),[s,i]=t.useState(!1),[n,l]=t.useState(""),b=t.useRef(null),u=t.useRef(null);t.useEffect(()=>{const m=setTimeout(()=>{l(d)},300);return()=>clearTimeout(m)},[d]);const{data:f=[]}=we({queryKey:["transaction-suggestions",n],queryFn:()=>Ce(n),enabled:n.length>=2,staleTime:3e4});t.useEffect(()=>{i(f.length>0&&d.length>=2)},[f,d]),t.useEffect(()=>{const m=x=>{u.current&&!u.current.contains(x.target)&&i(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const y=t.useCallback(m=>{var x;m.key==="Escape"&&(i(!1),(x=b.current)==null||x.blur())},[]),C=m=>{h(m.description),i(!1),c==null||c(m)},S=m=>Math.abs(m).toLocaleString();return e.jsxs("div",{ref:u,className:"relative",children:[e.jsx("input",{ref:b,type:"text",value:d,onChange:m=>h(m.target.value),onKeyDown:y,onFocus:()=>f.length>0&&i(!0),placeholder:a,className:w("w-full h-12 px-4 border rounded-lg text-base","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400",p?"border-red-500":"border-gray-300",o)}),s&&f.length>0&&e.jsx("div",{className:w("absolute top-full left-0 right-0 z-50 mt-1","bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700","max-h-60 overflow-y-auto"),children:f.map((m,x)=>e.jsxs("button",{type:"button",onClick:()=>C(m),className:w("w-full px-4 py-3 flex items-center justify-between text-left","hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors","border-b border-gray-100 dark:border-gray-700 last:border-0"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:m.description}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:m.category}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"•"}),e.jsxs("span",{className:"text-gray-400",children:[m.count,"x ",g("autocomplete.used","used")]})]})]}),e.jsx("div",{className:"ml-4 text-right shrink-0",children:e.jsxs("div",{className:w("font-medium font-numbers",m.is_income?"text-green-600":"text-gray-900 dark:text-gray-100"),children:["¥",S(m.amount)]})})]},`${m.description}-${x}`))})]})}function Qe({onCapture:d,onCancel:h}){const{t:c}=E(),a=t.useRef(null),o=t.useRef(null),[p,g]=t.useState(null),[s,i]=t.useState(null),[n,l]=t.useState(null),[b,u]=t.useState(!0),f=t.useCallback(async()=>{u(!0),l(null);try{const x=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});a.current&&(a.current.srcObject=x,g(x))}catch(x){console.error("Camera error:",x),l(c("receipt.cameraError","Could not access camera"))}finally{u(!1)}},[c]),y=t.useCallback(()=>{p&&(p.getTracks().forEach(x=>x.stop()),g(null))},[p]),C=t.useCallback(()=>{if(!a.current||!o.current)return;const x=a.current,v=o.current,I=v.getContext("2d");if(!I)return;v.width=x.videoWidth,v.height=x.videoHeight,I.drawImage(x,0,0);const k=v.toDataURL("image/jpeg",.8);i(k),y()},[y]),S=t.useCallback(()=>{i(null),f()},[f]),m=t.useCallback(()=>{s&&d(s)},[s,d]);return t.useEffect(()=>(f(),()=>{p&&p.getTracks().forEach(x=>x.stop())}),[]),n?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(W,{size:48,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-red-400 mb-6",children:n}),e.jsx("button",{onClick:h,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:c("close","Close")})]}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/50 absolute top-0 left-0 right-0 z-10",children:[e.jsx("button",{onClick:h,className:"text-white p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":c("close","Close"),children:e.jsx(K,{size:24})}),e.jsx("span",{className:"text-white font-medium",children:c("receipt.scanReceipt","Scan Receipt")}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 min-h-0 relative flex items-center justify-center bg-black overflow-hidden",children:[b&&!s&&e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"}),e.jsx("p",{className:"text-white",children:c("receipt.startingCamera","Starting camera...")})]}),s?e.jsx("img",{src:s,alt:"Captured receipt",className:"max-w-full max-h-full object-contain"}):e.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",onLoadedMetadata:()=>u(!1)}),e.jsx("canvas",{ref:o,className:"hidden"})]}),e.jsx("div",{className:"flex-shrink-0 p-6 bg-black/50 flex justify-center gap-8 safe-area-bottom",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[e.jsx(Le,{size:20}),c("receipt.retake","Retake")]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(oe,{size:20}),c("receipt.usePhoto","Use Photo")]})]}):e.jsx("button",{onClick:C,disabled:b,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center disabled:opacity-50 transition-opacity","aria-label":c("receipt.takePhoto","Take Photo"),children:e.jsx("div",{className:"w-14 h-14 rounded-full border-4 border-black"})})})]})}async function Be(d,h=1024,c=1024,a=.8){return new Promise((o,p)=>{const g=new Image,s=document.createElement("canvas"),i=s.getContext("2d");if(!i){p(new Error("Failed to get canvas context"));return}g.onload=()=>{let{width:n,height:l}=g;if(n>h||l>c){const u=Math.min(h/n,c/l);n=Math.round(n*u),l=Math.round(l*u)}s.width=n,s.height=l,i.drawImage(g,0,0,n,l);const b=s.toDataURL("image/jpeg",a);URL.revokeObjectURL(g.src),o(b)},g.onerror=()=>{URL.revokeObjectURL(g.src),p(new Error("Failed to load image"))},g.src=URL.createObjectURL(d)})}function Ve({onImageSelect:d,className:h}){const{t:c}=E(),[a,o]=t.useState(!1),[p,g]=t.useState(!1),s=t.useCallback(async u=>{if(!u.type.startsWith("image/")){alert(c("receipt.invalidFile","Please select an image file"));return}g(!0);try{const f=await Be(u);d(f)}catch{alert(c("receipt.processError","Failed to process image"))}finally{g(!1)}},[d,c]),i=t.useCallback(u=>{u.preventDefault(),o(!1);const f=u.dataTransfer.files[0];f&&s(f)},[s]),n=t.useCallback(u=>{u.preventDefault(),o(!0)},[]),l=t.useCallback(()=>{o(!1)},[]),b=t.useCallback(u=>{var y;const f=(y=u.target.files)==null?void 0:y[0];f&&s(f)},[s]);return e.jsxs("div",{onDrop:i,onDragOver:n,onDragLeave:l,className:w("border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500",p&&"opacity-50 pointer-events-none",h),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:b,className:"hidden",id:"receipt-file-input"}),e.jsx("label",{htmlFor:"receipt-file-input",className:"cursor-pointer",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:c("receipt.processing","Processing...")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(Se,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:c("receipt.dropOrClick","Drop image here or click to upload")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:c("receipt.supportedFormats","JPG, PNG, HEIC supported")})]})]})})})]})}function He({isOpen:d,onClose:h,onScanComplete:c}){const{t:a}=E(),[o,p]=t.useState("select"),[g,s]=t.useState(null),i=_({mutationFn:ze,onSuccess:y=>{c(y.data),n()}}),n=t.useCallback(()=>{p("select"),s(null),i.reset(),h()},[h,i]),l=t.useCallback(y=>{s(y),p("preview")},[]),b=t.useCallback(()=>{g&&i.mutate({image:g})},[g,i]),u=t.useCallback(()=>{s(null),p("select")},[]);if(!d)return null;if(o==="camera")return e.jsx(Qe,{onCapture:l,onCancel:()=>p("select")});const f=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",onClick:y=>{y.target===y.currentTarget&&n()},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:n}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("receipt.scanReceipt","Scan Receipt")}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("close","Close"),children:e.jsx(K,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-4",children:[o==="select"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>p("camera"),className:"w-full h-14 flex items-center justify-center gap-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(W,{size:24}),a("receipt.takePhoto","Take Photo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("or","or")}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx(Ve,{onImageSelect:l})]}),o==="preview"&&g&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:e.jsx("img",{src:g,alt:"Receipt preview",className:"w-full max-h-64 object-contain"})}),i.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a("receipt.analyzing","Analyzing receipt with AI...")})]}),i.isError&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:[e.jsx(Re,{size:20}),e.jsx("span",{children:a("receipt.scanError","Failed to scan receipt. Please try again.")})]}),!i.isPending&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:u,className:"flex-1 h-12 flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("receipt.retake","Retake")}),e.jsxs("button",{onClick:b,disabled:i.isPending,className:"flex-1 h-12 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(oe,{size:20}),a("receipt.scan","Scan")]})]})]})]})]})]});return typeof document>"u"?null:le.createPortal(f,document.body)}const ce={JPY:"¥",USD:"$",VND:"₫"};function q(d){const h=d.replace(/[^\d]/g,"");return h?parseInt(h).toLocaleString():""}function Je(d){return d.replace(/[^\d]/g,"")}function et({isOpen:d,onClose:h,defaultAccountId:c}){const{t:a}=E("common"),{data:o}=Ie(),p=ie(),g=De(),[s,i]=t.useState(!1),[n,l]=t.useState(new Date().toISOString().split("T")[0]),[b,u]=t.useState(""),[f,y]=t.useState(""),[C,S]=t.useState(""),[m,x]=t.useState(""),[v,I]=t.useState(null),[k,Q]=t.useState({}),[de,L]=t.useState(!1),[B,z]=t.useState(null),[P,A]=t.useState(null),[ue,V]=t.useState(!1),T=t.useRef(null),[H,J]=t.useState(!1),[O,Y]=t.useState(!1),[D,G]=t.useState("monthly"),[X,$]=t.useState(0),[Z,ee]=t.useState(25),[te,re]=t.useState(7),N=t.useMemo(()=>(o==null?void 0:o.find(r=>r.id===v))||null,[o,v]),me=N!=null&&N.currency?ce[N.currency]||N.currency:"¥",{showTransactionXP:ge}=qe();t.useEffect(()=>{var r;d&&(i(!1),l(new Date().toISOString().split("T")[0]),u(""),y(""),S(""),x(""),I(c??((r=o==null?void 0:o[0])==null?void 0:r.id)??null),Q({}),z(null),A(null),J(!1),Y(!1),G("monthly"),$(0),ee(25),re(7))},[d,o,c]),t.useEffect(()=>{x("")},[s]);const M=We(Oe,"transaction",[["transactions"],["analytics"]]),U=_({mutationFn:Fe,onSuccess:()=>{p.invalidateQueries({queryKey:["recurring-transactions"]})}}),xe=r=>{const j=Je(r.target.value);u(j),y(q(j))},he=r=>{const j=r.amount.toString();u(j),y(q(j)),i(r.is_income),r.category&&x(r.category)},pe=r=>{if(r.amount!==null){const j=Math.abs(r.amount).toString();u(j),y(q(j)),i(!1)}r.date&&l(r.date),r.merchant&&S(r.merchant),r.category&&x(r.category),L(!1)},fe=r=>{var R;const j=(R=r.target.files)==null?void 0:R[0];if(!j||!j.type.startsWith("image/"))return;z(j);const F=URL.createObjectURL(j);A(F)},be=()=>{z(null),P&&(URL.revokeObjectURL(P),A(null)),T.current&&(T.current.value="")},ye=()=>{const r={};return(!b||parseInt(b)<=0)&&(r.amount=a("transaction.errors.amountRequired","Amount is required")),C.trim()||(r.description=a("transaction.errors.descriptionRequired","Description is required")),m||(r.category=a("transaction.errors.categoryRequired","Category is required")),v||(r.source=a("transaction.errors.sourceRequired","Account is required")),Q(r),Object.keys(r).length===0},je=async r=>{if(r.preventDefault(),!ye())return;const j=m||"Other",F=(N==null?void 0:N.currency)||"JPY",R=Te(parseInt(b),F);try{let ae;if(B){V(!0);try{ae=await Me(B)}finally{V(!1)}}await M.mutateAsync({date:n,description:C.trim(),amount:s?R:-R,currency:F,category:j,source:(N==null?void 0:N.name)||"",type:s?"income":"expense",account_id:v,receipt_url:ae,is_adjustment:H}),O&&await U.mutateAsync({description:C.trim(),amount:R,category:j,account_id:v,is_income:s,frequency:D,day_of_week:D==="weekly"?X:null,day_of_month:D==="monthly"?Z:null,interval_days:D==="custom"?te:null,start_date:n}),ge(),h(),g.success(a("transaction.saved","Transaction saved!"))}catch{}},ke=r=>{r.target===r.currentTarget&&h()};if(!d)return null;const ve=e.jsxs("div",{className:"fixed inset-0 z-[100002] bg-black/50 flex items-end sm:items-center justify-center animate-modal-backdrop",onClick:ke,children:[e.jsxs("div",{className:w("w-full sm:max-w-md","bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl shadow-2xl","max-h-[90vh] overflow-y-auto","animate-modal-in"),children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 dark:text-gray-100",children:a("transaction.addTransaction","Add Transaction")})}),e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[e.jsxs("button",{type:"button",onClick:()=>L(!0),className:"w-full h-12 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium transition-all shadow-md hover:shadow-lg",children:[e.jsx(Ee,{size:20}),a("receipt.scanReceipt","Scan Receipt")]}),e.jsx("input",{ref:T,type:"file",accept:"image/*",capture:"environment",onChange:fe,className:"hidden"}),P?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:P,alt:"Receipt preview",className:"w-full h-24 object-cover"}),e.jsx("button",{type:"button",onClick:be,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(K,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var r;return(r=T.current)==null?void 0:r.click()},className:"w-full h-12 flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 text-gray-500 dark:text-gray-400 rounded-lg font-medium transition-colors",children:[e.jsx(W,{size:20}),a("receipt.attachReceipt","Attach Receipt Photo")]})]}),e.jsxs("form",{onSubmit:je,className:"px-4 pb-8 space-y-4",children:[e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:w("flex-1 py-3 rounded-md text-sm font-medium transition-colors",s?"text-gray-600 dark:text-gray-300":"bg-red-500 text-white"),children:a("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>i(!0),className:w("flex-1 py-3 rounded-md text-sm font-medium transition-colors",s?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:a("transaction.income","Income")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.date","Date")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:n,onChange:r=>l(r.target.value),className:"flex-1 h-12 px-4 border border-gray-300 rounded-lg text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"}),e.jsx("button",{type:"button",onClick:()=>l(new Date().toISOString().split("T")[0]),className:"px-4 h-12 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:a("today","Today")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.amount","Amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-lg font-medium text-gray-500 dark:text-gray-400",children:me}),e.jsx("input",{type:"text",inputMode:"numeric",value:f,onChange:xe,placeholder:"0",className:w("w-full h-12 pl-10 pr-4 border rounded-lg text-base text-right font-numbers","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",k.amount?"border-red-500":"border-gray-300")})]}),k.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:k.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.description","Description")}),e.jsx(Ke,{value:C,onChange:S,onSuggestionSelect:he,placeholder:a("transaction.descriptionPlaceholder","What was this for?"),error:!!k.description}),k.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:k.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("transaction.category","Category")}),e.jsx(Ae,{selected:m,onSelect:r=>x(r),isIncome:s}),k.category&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:k.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.source","Account")}),e.jsxs("select",{value:v||"",onChange:r=>I(r.target.value?parseInt(r.target.value):null),className:w("w-full h-12 px-4 border rounded-lg text-base","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",k.source?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:a("transaction.selectAccount","Select account")}),o==null?void 0:o.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",ce[r.currency]||r.currency,")"]},r.id))]}),k.source&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:k.source})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer py-2",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:r=>J(r.target.checked),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:a("transaction.balanceAdjustment","Balance adjustment")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("transaction.balanceAdjustmentHint","Won't count toward budget")})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:r=>Y(r.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx(Pe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:a("recurring.makeRecurring")})]}),O&&e.jsx(Ue,{frequency:D,setFrequency:G,dayOfWeek:X,setDayOfWeek:$,dayOfMonth:Z,setDayOfMonth:ee,intervalDays:te,setIntervalDays:re})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(ne,{type:"button",variant:"outline",onClick:h,className:"flex-1 h-12",children:a("cancel","Cancel")}),e.jsx(ne,{type:"submit",loading:M.isPending||U.isPending||ue,className:w("flex-1 h-12",O?"bg-blue-500 hover:bg-blue-600":s?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:a("save","Save")})]}),(M.isError||U.isError)&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:a("transaction.errors.createFailed","Failed to create transaction")})]})]}),e.jsx(He,{isOpen:de,onClose:()=>L(!1),onScanComplete:pe})]});return typeof document>"u"?null:le.createPortal(ve,document.body)}export{He as R,et as T,We as u};
