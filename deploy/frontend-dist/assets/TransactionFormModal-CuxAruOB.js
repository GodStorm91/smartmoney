import{a as ve,x as ie,u as P,r as t,j as e,aF as Ne,A as v,$ as we,I as se,B as O,y as le,H as W,b7 as Ce,b8 as ne,g as Se,b9 as Re,M as B,X as G,q as de,U as Ie,N as ce,ar as De,G as Pe,ba as Ee,E as Te,R as Fe,ad as Le,ae as Me}from"./index-CeIjqT8j.js";import{c as Oe}from"./recurring-service-DtzLohSz.js";import{d as ze,e as Ae}from"./useCategories-De2iPPdj.js";import{R as Ue}from"./RecurringOptions-BNugIcyt.js";import{u as qe}from"./useXPGain-DwfXP-ew.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ke=ve("rotate-ccw",_e);async function Qe(n){return(await ie.post("/api/receipts/scan",n)).data}async function We(n){const m=new FormData;return m.append("file",n),(await ie.post("/api/receipts/upload",m,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function ct(n){return n||null}function Be({selected:n,onSelect:m,isIncome:c=!1}){const{t:a}=P("common"),{data:u,isLoading:y}=ze(),h=Ae(),[s,o]=t.useState(null),[i,l]=t.useState(!1),[b,g]=t.useState(""),[f,j]=t.useState("ðŸ“");if(y||!u)return e.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const w=c?u.income:u.expense,S=d=>{for(const R of w)if(R.children.some(z=>z.name===d))return R;return null},x=d=>{o(d),l(!1)},p=d=>{s&&m(d.name,s.name)},N=()=>{o(null),l(!1)},I=async()=>{!s||!b.trim()||(await h.mutateAsync({name:b.trim(),icon:f,parent_id:s.id,type:c?"income":"expense"}),m(b.trim(),s.name),g(""),l(!1))};return s?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:N,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(Ne,{className:"w-4 h-4"}),s.icon," ",s.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.children.map(d=>e.jsxs("button",{type:"button",onClick:()=>p(d),className:v("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",n===d.name?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:d.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:d.name})]},d.id)),e.jsxs("button",{type:"button",onClick:()=>l(!0),className:v("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(we,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("category.addCustom","Add")})]})]}),i&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{value:f,onChange:d=>j(d.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(se,{value:b,onChange:d=>g(d.target.value),placeholder:a("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(O,{variant:"outline",size:"sm",onClick:()=>l(!1),children:a("cancel","Cancel")}),e.jsx(O,{size:"sm",onClick:I,disabled:!b.trim()||h.isPending,children:a("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:w.map(d=>{var R;return e.jsxs("button",{type:"button",onClick:()=>x(d),className:v("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((R=S(n))==null?void 0:R.id)===d.id?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:d.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:d.name})]},d.id)})})}function Ge(n,m){const c=le(),{entityType:a,operationType:u,getEntityId:y=()=>0,invalidateKeys:h=[],onSuccess:s,onError:o}=m;return W({mutationFn:async i=>{if(!navigator.onLine){const l=y(i);return await ne(u,a,l,i),null}try{const l=await n(i);for(const b of h)c.invalidateQueries({queryKey:b});return l}catch(l){if(l instanceof TypeError&&l.message.includes("fetch")){const b=y(i);return await ne(u,a,b,i),null}throw l}},onSuccess:i=>{navigator.onLine&&Ce(),s==null||s(i)},onError:i=>{o==null||o(i)}})}function He(n,m,c){return Ge(n,{entityType:m,operationType:"CREATE",invalidateKeys:c})}function Ve({value:n,onChange:m,onSuggestionSelect:c,placeholder:a,className:u,error:y}){const{t:h}=P("common"),[s,o]=t.useState(!1),[i,l]=t.useState(""),b=t.useRef(null),g=t.useRef(null);t.useEffect(()=>{const x=setTimeout(()=>{l(n)},300);return()=>clearTimeout(x)},[n]);const{data:f=[]}=Se({queryKey:["transaction-suggestions",i],queryFn:()=>Re(i),enabled:i.length>=2,staleTime:3e4});t.useEffect(()=>{o(f.length>0&&n.length>=2)},[f,n]),t.useEffect(()=>{const x=p=>{g.current&&!g.current.contains(p.target)&&o(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const j=t.useCallback(x=>{var p;x.key==="Escape"&&(o(!1),(p=b.current)==null||p.blur())},[]),w=x=>{m(x.description),o(!1),c==null||c(x)},S=x=>Math.abs(x).toLocaleString();return e.jsxs("div",{ref:g,className:"relative",children:[e.jsx("input",{ref:b,type:"text",value:n,onChange:x=>m(x.target.value),onKeyDown:j,onFocus:()=>f.length>0&&o(!0),placeholder:a,className:v("w-full h-12 px-4 border rounded-lg text-base","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400",y?"border-red-500":"border-gray-300",u)}),s&&f.length>0&&e.jsx("div",{className:v("absolute top-full left-0 right-0 z-50 mt-1","bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700","max-h-60 overflow-y-auto"),children:f.map((x,p)=>e.jsxs("button",{type:"button",onClick:()=>w(x),className:v("w-full px-4 py-3 flex items-center justify-between text-left","hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors","border-b border-gray-100 dark:border-gray-700 last:border-0"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:x.description}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:x.category}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"â€¢"}),e.jsxs("span",{className:"text-gray-400",children:[x.count,"x ",h("autocomplete.used","used")]})]})]}),e.jsx("div",{className:"ml-4 text-right shrink-0",children:e.jsxs("div",{className:v("font-medium font-numbers",x.is_income?"text-green-600":"text-gray-900 dark:text-gray-100"),children:["Â¥",S(x.amount)]})})]},`${x.description}-${p}`))})]})}function Ye({onCapture:n,onCancel:m}){const{t:c}=P(),a=t.useRef(null),u=t.useRef(null),[y,h]=t.useState(null),[s,o]=t.useState(null),[i,l]=t.useState(null),[b,g]=t.useState(!0),f=t.useCallback(async()=>{g(!0),l(null);try{const p=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});a.current&&(a.current.srcObject=p,h(p))}catch(p){console.error("Camera error:",p),l(c("receipt.cameraError","Could not access camera"))}finally{g(!1)}},[c]),j=t.useCallback(()=>{y&&(y.getTracks().forEach(p=>p.stop()),h(null))},[y]),w=t.useCallback(()=>{if(!a.current||!u.current)return;const p=a.current,N=u.current,I=N.getContext("2d");if(!I)return;N.width=p.videoWidth,N.height=p.videoHeight,I.drawImage(p,0,0);const d=N.toDataURL("image/jpeg",.8);o(d),j()},[j]),S=t.useCallback(()=>{o(null),f()},[f]),x=t.useCallback(()=>{s&&n(s)},[s,n]);return t.useEffect(()=>(f(),()=>{y&&y.getTracks().forEach(p=>p.stop())}),[]),i?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(B,{size:48,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-red-400 mb-6",children:i}),e.jsx("button",{onClick:m,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:c("close","Close")})]}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/50 absolute top-0 left-0 right-0 z-10",children:[e.jsx("button",{onClick:m,className:"text-white p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":c("close","Close"),children:e.jsx(G,{size:24})}),e.jsx("span",{className:"text-white font-medium",children:c("receipt.scanReceipt","Scan Receipt")}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-black",children:[b&&!s&&e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"}),e.jsx("p",{className:"text-white",children:c("receipt.startingCamera","Starting camera...")})]}),s?e.jsx("img",{src:s,alt:"Captured receipt",className:"max-w-full max-h-full object-contain"}):e.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",onLoadedMetadata:()=>g(!1)}),e.jsx("canvas",{ref:u,className:"hidden"})]}),e.jsx("div",{className:"p-6 bg-black/50 flex justify-center gap-8 absolute bottom-0 left-0 right-0 safe-area-bottom",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[e.jsx(Ke,{size:20}),c("receipt.retake","Retake")]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(de,{size:20}),c("receipt.usePhoto","Use Photo")]})]}):e.jsx("button",{onClick:w,disabled:b,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center disabled:opacity-50 transition-opacity","aria-label":c("receipt.takePhoto","Take Photo"),children:e.jsx("div",{className:"w-14 h-14 rounded-full border-4 border-black"})})})]})}async function $e(n,m=1024,c=1024,a=.8){return new Promise((u,y)=>{const h=new Image,s=document.createElement("canvas"),o=s.getContext("2d");if(!o){y(new Error("Failed to get canvas context"));return}h.onload=()=>{let{width:i,height:l}=h;if(i>m||l>c){const g=Math.min(m/i,c/l);i=Math.round(i*g),l=Math.round(l*g)}s.width=i,s.height=l,o.drawImage(h,0,0,i,l);const b=s.toDataURL("image/jpeg",a);URL.revokeObjectURL(h.src),u(b)},h.onerror=()=>{URL.revokeObjectURL(h.src),y(new Error("Failed to load image"))},h.src=URL.createObjectURL(n)})}function Je({onImageSelect:n,className:m}){const{t:c}=P(),[a,u]=t.useState(!1),[y,h]=t.useState(!1),s=t.useCallback(async g=>{if(!g.type.startsWith("image/")){alert(c("receipt.invalidFile","Please select an image file"));return}h(!0);try{const f=await $e(g);n(f)}catch{alert(c("receipt.processError","Failed to process image"))}finally{h(!1)}},[n,c]),o=t.useCallback(g=>{g.preventDefault(),u(!1);const f=g.dataTransfer.files[0];f&&s(f)},[s]),i=t.useCallback(g=>{g.preventDefault(),u(!0)},[]),l=t.useCallback(()=>{u(!1)},[]),b=t.useCallback(g=>{var j;const f=(j=g.target.files)==null?void 0:j[0];f&&s(f)},[s]);return e.jsxs("div",{onDrop:o,onDragOver:i,onDragLeave:l,className:v("border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500",y&&"opacity-50 pointer-events-none",m),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:b,className:"hidden",id:"receipt-file-input"}),e.jsx("label",{htmlFor:"receipt-file-input",className:"cursor-pointer",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:c("receipt.processing","Processing...")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(Ie,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:c("receipt.dropOrClick","Drop image here or click to upload")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:c("receipt.supportedFormats","JPG, PNG, HEIC supported")})]})]})})})]})}function Xe({isOpen:n,onClose:m,onScanComplete:c}){const{t:a}=P(),[u,y]=t.useState("select"),[h,s]=t.useState(null),o=W({mutationFn:Qe,onSuccess:j=>{c(j.data),i()}}),i=t.useCallback(()=>{y("select"),s(null),o.reset(),m()},[m,o]),l=t.useCallback(j=>{s(j),y("preview")},[]),b=t.useCallback(()=>{h&&o.mutate({image:h})},[h,o]),g=t.useCallback(()=>{s(null),y("select")},[]);if(!n)return null;if(u==="camera"){const j=e.jsx(Ye,{onCapture:l,onCancel:()=>y("select")});return typeof document>"u"?null:ce.createPortal(j,document.body)}const f=e.jsx("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",onClick:j=>{j.target===j.currentTarget&&i()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("receipt.scanReceipt","Scan Receipt")}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("close","Close"),children:e.jsx(G,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-4",children:[u==="select"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>y("camera"),className:"w-full h-14 flex items-center justify-center gap-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(B,{size:24}),a("receipt.takePhoto","Take Photo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("or","or")}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx(Je,{onImageSelect:l})]}),u==="preview"&&h&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:e.jsx("img",{src:h,alt:"Receipt preview",className:"w-full max-h-64 object-contain"})}),o.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a("receipt.analyzing","Analyzing receipt with AI...")})]}),o.isError&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:[e.jsx(De,{size:20}),e.jsx("span",{children:a("receipt.scanError","Failed to scan receipt. Please try again.")})]}),!o.isPending&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:g,className:"flex-1 h-12 flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("receipt.retake","Retake")}),e.jsxs("button",{onClick:b,disabled:o.isPending,className:"flex-1 h-12 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(de,{size:20}),a("receipt.scan","Scan")]})]})]})]})]})});return typeof document>"u"?null:ce.createPortal(f,document.body)}const oe={JPY:"Â¥",USD:"$",VND:"â‚«"};function Q(n){const m=n.replace(/[^\d]/g,"");return m?parseInt(m).toLocaleString():""}function Ze(n){return n.replace(/[^\d]/g,"")}function ot({isOpen:n,onClose:m,defaultAccountId:c}){const{t:a}=P("common"),{data:u}=Pe(),y=le(),h=Ee(),[s,o]=t.useState(!1),[i,l]=t.useState(new Date().toISOString().split("T")[0]),[b,g]=t.useState(""),[f,j]=t.useState(""),[w,S]=t.useState(""),[x,p]=t.useState(""),[N,I]=t.useState(null),[d,R]=t.useState({}),[z,A]=t.useState(!1),[H,U]=t.useState(null),[T,q]=t.useState(null),[ue,V]=t.useState(!1),F=t.useRef(null),[L,Y]=t.useState(!1),[E,$]=t.useState("monthly"),[J,X]=t.useState(0),[Z,ee]=t.useState(25),[te,re]=t.useState(7),C=t.useMemo(()=>(u==null?void 0:u.find(r=>r.id===N))||null,[u,N]),me=C!=null&&C.currency?oe[C.currency]||C.currency:"Â¥",{showTransactionXP:ge}=qe();t.useEffect(()=>{var r;n&&(o(!1),l(new Date().toISOString().split("T")[0]),g(""),j(""),S(""),p(""),I(c??((r=u==null?void 0:u[0])==null?void 0:r.id)??null),R({}),U(null),q(null),Y(!1),$("monthly"),X(0),ee(25),re(7))},[n,u,c]),t.useEffect(()=>{p("")},[s]);const _=He(Me,"transaction",[["transactions"],["analytics"]]),K=W({mutationFn:Oe,onSuccess:()=>{y.invalidateQueries({queryKey:["recurring-transactions"]})}}),xe=r=>{const k=Ze(r.target.value);g(k),j(Q(k))},he=r=>{const k=r.amount.toString();g(k),j(Q(k)),o(r.is_income),r.category&&p(r.category)},pe=r=>{if(r.amount!==null){const k=Math.abs(r.amount).toString();g(k),j(Q(k)),o(!1)}r.date&&l(r.date),r.merchant&&S(r.merchant),r.category&&p(r.category),A(!1)},ye=r=>{var D;const k=(D=r.target.files)==null?void 0:D[0];if(!k||!k.type.startsWith("image/"))return;U(k);const M=URL.createObjectURL(k);q(M)},be=()=>{U(null),T&&(URL.revokeObjectURL(T),q(null)),F.current&&(F.current.value="")},fe=()=>{const r={};return(!b||parseInt(b)<=0)&&(r.amount=a("transaction.errors.amountRequired","Amount is required")),w.trim()||(r.description=a("transaction.errors.descriptionRequired","Description is required")),x||(r.category=a("transaction.errors.categoryRequired","Category is required")),N||(r.source=a("transaction.errors.sourceRequired","Account is required")),R(r),Object.keys(r).length===0},je=async r=>{if(r.preventDefault(),!fe())return;const k=x||"Other",M=(C==null?void 0:C.currency)||"JPY",D=Le(parseInt(b),M);try{let ae;if(H){V(!0);try{ae=await We(H)}finally{V(!1)}}await _.mutateAsync({date:i,description:w.trim(),amount:s?D:-D,currency:M,category:k,source:(C==null?void 0:C.name)||"",type:s?"income":"expense",account_id:N,receipt_url:ae}),L&&await K.mutateAsync({description:w.trim(),amount:D,category:k,account_id:N,is_income:s,frequency:E,day_of_week:E==="weekly"?J:null,day_of_month:E==="monthly"?Z:null,interval_days:E==="custom"?te:null,start_date:i}),ge(),m(),h.success(a("transaction.saved","Transaction saved!"))}catch{}},ke=r=>{r.target===r.currentTarget&&m()};return n?e.jsxs("div",{className:"fixed inset-0 z-[100002] bg-black/50 animate-modal-backdrop",onClick:ke,children:[e.jsxs("div",{className:v("fixed inset-x-0 bottom-0 z-[100002]","bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl","max-h-[90vh] overflow-y-auto","animate-modal-in"),children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 dark:text-gray-100",children:a("transaction.addTransaction","Add Transaction")})}),e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[e.jsxs("button",{type:"button",onClick:()=>A(!0),className:"w-full h-12 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium transition-all shadow-md hover:shadow-lg",children:[e.jsx(Te,{size:20}),a("receipt.scanReceipt","Scan Receipt")]}),e.jsx("input",{ref:F,type:"file",accept:"image/*",capture:"environment",onChange:ye,className:"hidden"}),T?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:T,alt:"Receipt preview",className:"w-full h-24 object-cover"}),e.jsx("button",{type:"button",onClick:be,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(G,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var r;return(r=F.current)==null?void 0:r.click()},className:"w-full h-12 flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 text-gray-500 dark:text-gray-400 rounded-lg font-medium transition-colors",children:[e.jsx(B,{size:20}),a("receipt.attachReceipt","Attach Receipt Photo")]})]}),e.jsxs("form",{onSubmit:je,className:"px-4 pb-8 space-y-4",children:[e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:v("flex-1 py-3 rounded-md text-sm font-medium transition-colors",s?"text-gray-600 dark:text-gray-300":"bg-red-500 text-white"),children:a("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>o(!0),className:v("flex-1 py-3 rounded-md text-sm font-medium transition-colors",s?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:a("transaction.income","Income")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.date","Date")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:i,onChange:r=>l(r.target.value),className:"flex-1 h-12 px-4 border border-gray-300 rounded-lg text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"}),e.jsx("button",{type:"button",onClick:()=>l(new Date().toISOString().split("T")[0]),className:"px-4 h-12 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:a("today","Today")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.amount","Amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-lg font-medium text-gray-500 dark:text-gray-400",children:me}),e.jsx("input",{type:"text",inputMode:"numeric",value:f,onChange:xe,placeholder:"0",className:v("w-full h-12 pl-10 pr-4 border rounded-lg text-base text-right font-numbers","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",d.amount?"border-red-500":"border-gray-300")})]}),d.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.description","Description")}),e.jsx(Ve,{value:w,onChange:S,onSuggestionSelect:he,placeholder:a("transaction.descriptionPlaceholder","What was this for?"),error:!!d.description}),d.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("transaction.category","Category")}),e.jsx(Be,{selected:x,onSelect:r=>p(r),isIncome:s}),d.category&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transaction.source","Account")}),e.jsxs("select",{value:N||"",onChange:r=>I(r.target.value?parseInt(r.target.value):null),className:v("w-full h-12 px-4 border rounded-lg text-base","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",d.source?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:a("transaction.selectAccount","Select account")}),u==null?void 0:u.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",oe[r.currency]||r.currency,")"]},r.id))]}),d.source&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.source})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:r=>Y(r.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx(Fe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:a("recurring.makeRecurring")})]}),L&&e.jsx(Ue,{frequency:E,setFrequency:$,dayOfWeek:J,setDayOfWeek:X,dayOfMonth:Z,setDayOfMonth:ee,intervalDays:te,setIntervalDays:re})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(O,{type:"button",variant:"outline",onClick:m,className:"flex-1 h-12",children:a("cancel","Cancel")}),e.jsx(O,{type:"submit",loading:_.isPending||K.isPending||ue,className:v("flex-1 h-12",L?"bg-blue-500 hover:bg-blue-600":s?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:a("save","Save")})]}),(_.isError||K.isError)&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:a("transaction.errors.createFailed","Failed to create transaction")})]})]}),e.jsx(Xe,{isOpen:z,onClose:()=>A(!1),onScanComplete:pe})]}):null}export{Be as H,Xe as R,ot as T,He as a,ct as g,We as u};
