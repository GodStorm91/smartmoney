import{j as e,a as $e,e as rt}from"./vendor-router-DONIM_LE.js";import{r as m}from"./vendor-react-Cwh1aMWO.js";import{b as ke,c as le,u as ge}from"./vendor-query-B0NEAgzV.js";import{i as xe,K as Y,C as Q,B as V,I as ve,o as Ye,s as Ge,W as Ke,S as Ce,F as nt,j,X as ue,aD as Fe,P as ce,aE as Ne,y as Z,z as G,Y as J,aj as he,aF as lt,an as ie,f as Se,n as ot,al as Ee,m as te,aG as Xe,aH as dt,L as we,g as Be,aI as ye,t as ct,am as qe,a5 as Le,J as Ze,T as it,aJ as xt,aK as ut,aL as gt,aM as mt,a7 as ht,aN as bt,aO as yt,aP as pt,aQ as ft,aR as Ve,aS as jt,aT as vt,aU as Nt,aV as wt}from"./index-C27mG4zb.js";import{u as K}from"./vendor-i18n-CNDlYvyf.js";import{C as Oe,Z as kt}from"./zap-D4g0fgPk.js";import{d as Me,e as Ct}from"./useCategories-Bf9HBK3k.js";import{C as Ie}from"./chevron-down-DEqb1tFR.js";import{R as St,E as Ue}from"./BudgetInsightWidget-BzEuSg9e.js";import{T as ae}from"./triangle-alert-CbQMrZzZ.js";import{R as Mt,P as Dt,a as _t,C as Pt,S as At}from"./vendor-charts-D-N8xF42.js";import{R as Tt}from"./ResponsiveModal-BDhAIhXZ.js";import{S as zt}from"./Switch-BfYpPkqu.js";import{g as Et,a as Bt,A as Lt,b as $t}from"./ai-categorization-service-YnniqA7o.js";import{S as Ft,a as Rt}from"./square-C6ORz6Cp.js";import{P as Kt}from"./pencil-BPnCKGlI.js";import{T as qt}from"./TransactionEditModal-BRcUdLT5.js";import{u as Vt}from"./useXPGain-DiSt0EFb.js";import{D as Ot}from"./download-Dl1HbdK2.js";import"./Select-DQfA9096.js";import"./zoom-out-BFYrrnZq.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Ht=xe("calendar-days",Ut);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Qt=xe("ellipsis",Wt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Yt=xe("history",Jt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Xt=xe("layout-grid",Gt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],It=xe("list",Zt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],ta=xe("shield-alert",ea);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],sa=xe("shield-check",aa);function je(t,a=0){if(!t&&t!==0)return"";const r=typeof t=="string"?parseFloat(t):t;return isNaN(r)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:a,maximumFractionDigits:a}).format(r)}function ra(t){if(!t)return 0;const a=t.replace(/,/g,""),r=parseFloat(a);return isNaN(r)?0:r}function na(t){return{JPY:"Â¥",USD:"$",VND:"â‚«",EUR:"â‚¬",GBP:"Â£"}[t]||t}function la(t){return["VND"].includes(t)?"suffix":"prefix"}function oa(t){return{JPY:0,VND:0,KRW:0,USD:2,EUR:2,GBP:2}[t]??0}function da({onGenerate:t,isLoading:a,error:r,suggestions:s}){const{t:i}=K("common"),{currency:n}=Y(),[l,c]=m.useState(""),[x,d]=m.useState(!1),o=na(n),u=la(n),h=oa(n);m.useEffect(()=>{if(s!=null&&s.previous_income&&!x&&!l){const M=s.previous_income/Math.pow(10,h);c(je(M,h)),d(!0)}},[s,x,l,h]);const g=M=>{const f=M.target.value.replace(/[^\d.]/g,"");if(f){const N=parseFloat(f);isNaN(N)||c(je(N,h))}else c("")},p=M=>{M.preventDefault();const y=ra(l),f=Math.round(y*Math.pow(10,h));f>0&&(t(f),c(""))},b=()=>{s!=null&&s.previous_income&&t(s.previous_income)},C=M=>{const[y,f]=M.split("-");return new Date(parseInt(y),parseInt(f)-1).toLocaleDateString(Ye(),{month:"long",year:"numeric"})};return e.jsxs("div",{className:"space-y-4",children:[(s==null?void 0:s.has_previous)&&s.previous_month&&e.jsx(Q,{className:"p-6 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:i("budget.previousBudgetFound",{month:C(s.previous_month)})}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:i("budget.cloneDescription")}),e.jsx(V,{onClick:b,loading:a,className:"w-full sm:w-auto",children:i("budget.clonePreviousMonth")})]})]})}),(s==null?void 0:s.has_previous)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:i("budget.orCreateNew")})})]}),e.jsxs(Q,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:i("budget.generateTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:i("budget.generateDescription")}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("budget.monthlyIncome")}),e.jsxs("div",{className:"relative",children:[u==="prefix"&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:o})}),e.jsx(ve,{type:"text",inputMode:"decimal",value:l,onChange:g,placeholder:je(5e5,h),required:!0,disabled:a,className:u==="prefix"?"pl-8":"pr-10"}),u==="suffix"&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:o})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[i("budget.incomeHint"),(s==null?void 0:s.previous_income)&&e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400",children:["(",i("budget.previousIncome"),": ",o,je(s.previous_income/Math.pow(10,h),h),")"]})]})]}),e.jsx(V,{type:"submit",loading:a,disabled:!l,className:"w-full",children:i("budget.generateButton")}),r&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:i("budget.generateError")})]})]})]})}function ca({copyPreview:t,isCopyPreviewLoading:a,suggestions:r,selectedMonth:s,formatCurrency:i,formatMonth:n,onCopy:l,onGenerate:c,onStartEmpty:x,isCopyLoading:d,isGenerateLoading:o,generateError:u}){const{t:h}=K("common"),[g,p]=m.useState("choose");if(a)return e.jsx(Q,{className:"p-8 flex items-center justify-center",children:e.jsx(Ge,{})});if(g==="generate")return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>p("choose"),className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors p-1 -ml-1",children:[e.jsx(Ke,{className:"w-4 h-4"}),h("common.back")]}),e.jsx(da,{onGenerate:c,isLoading:o,error:u,suggestions:r})]});if(g==="copy"&&t)return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>p("choose"),className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors p-1 -ml-1",children:[e.jsx(Ke,{className:"w-4 h-4"}),h("common.back")]}),e.jsxs(Q,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:h("budget.copyFromPrevious",{month:n(t.source_budget.month)})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:h("budget.wizard.copyDescription")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h("budget.totalBudgeted")}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i(t.spending_summary.reduce((f,N)=>f+N.budgeted,0))})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h("budget.categories")}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:t.spending_summary.length})]})]}),e.jsxs(V,{onClick:l,loading:d,className:"w-full",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),h("budget.copyAndEdit")]})]})]});const C=[...!!t?[{id:"copy",icon:Oe,title:h("budget.wizard.copyTitle"),description:h("budget.wizard.copyHint",{month:n(t.source_budget.month)}),accent:"blue"}]:[],{id:"generate",icon:Ce,title:h("budget.wizard.aiTitle"),description:h("budget.wizard.aiHint"),accent:"purple"},{id:"empty",icon:nt,title:h("budget.wizard.emptyTitle"),description:h("budget.wizard.emptyHint"),accent:"gray"}],M={blue:"border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700",purple:"border-purple-200 dark:border-purple-800 bg-purple-50/50 dark:bg-purple-900/20 hover:border-purple-300 dark:hover:border-purple-700",gray:"border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 hover:border-gray-300 dark:hover:border-gray-600"},y={blue:"bg-blue-100 dark:bg-blue-800 text-blue-600 dark:text-blue-300",purple:"bg-purple-100 dark:bg-purple-800 text-purple-600 dark:text-purple-300",gray:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:h("budget.wizard.title",{month:n(s)})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:h("budget.wizard.subtitle")})]}),e.jsx("div",{className:"space-y-3",children:C.map(f=>{const N=f.icon;return e.jsxs("button",{onClick:()=>{f.id==="empty"?x():p(f.id)},className:j("w-full flex items-start gap-4 p-4 rounded-xl border-2 transition-all text-left","focus:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2","active:scale-[0.98]",M[f.accent]),children:[e.jsx("div",{className:j("p-2.5 rounded-xl flex-shrink-0",y[f.accent]),children:e.jsx(N,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:f.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:f.description})]})]},f.id)})})]})}function ia({onSubmit:t,onCancel:a,isLoading:r}){const{t:s}=K("common"),[i,n]=m.useState(""),l=c=>{c.preventDefault(),i.trim()&&(t(i.trim()),n(""))};return e.jsxs(Q,{className:"p-6 border-blue-200 bg-blue-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:s("budget.feedbackTitle")}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsx("textarea",{value:i,onChange:c=>n(c.target.value),placeholder:s("budget.feedbackPlaceholder"),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 min-h-[100px]",disabled:r,required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{type:"submit",disabled:r||!i.trim(),children:s(r?"budget.regenerating":"budget.submitFeedback")}),e.jsx(V,{type:"button",variant:"outline",onClick:a,children:s("cancel")})]})]})]})}function xa({budget:t,onClose:a,onAdd:r}){const{t:s}=K("common"),{data:i}=Me(),n=Ct(),[l,c]=m.useState(null),[x,d]=m.useState(""),[o,u]=m.useState(""),[h,g]=m.useState(!1),[p,b]=m.useState(""),[C,M]=m.useState("ðŸ“"),y=m.useMemo(()=>new Set(t.allocations.map(_=>_.category)),[t.allocations]),f=m.useMemo(()=>{const _=t.allocations.reduce(($,U)=>$+U.amount,0);return t.monthly_income-(t.savings_target||0)-_},[t]),N=(i==null?void 0:i.expense)||[],S=_=>{_.children.filter(U=>!y.has(U.name)).length===0&&!y.has(_.name)?d(_.name):c(_),g(!1)},R=_=>{d(_.name)},z=()=>{c(null),d(""),g(!1)},D=async()=>{!l||!p.trim()||(await n.mutateAsync({name:p.trim(),icon:C,parent_id:l.id,type:"expense"}),d(p.trim()),b(""),g(!1))},E=_=>{_.preventDefault(),!(!x||parseInt(o)<=0)&&r(x,parseInt(o))},T=Math.floor(f/3);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(Q,{className:"w-full max-w-md animate-in fade-in zoom-in duration-200 max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("budget.addCategory")}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:E,className:"p-4 space-y-4 overflow-y-auto flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:s("budget.category")}),x?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[e.jsx("span",{className:"flex-1 font-medium text-blue-700 dark:text-blue-300",children:x}),e.jsx("button",{type:"button",onClick:()=>{d(""),c(null)},className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",children:s("change","Change")})]}):l?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:z,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(Fe,{className:"w-4 h-4"}),l.icon," ",l.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[l.children.map(_=>{const $=y.has(_.name);return e.jsxs("button",{type:"button",onClick:()=>!$&&R(_),disabled:$,className:j("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",$?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:_.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:_.name}),$&&e.jsx("span",{className:"text-[10px] text-gray-400",children:s("budget.alreadyAdded","Added")})]},_.id)}),e.jsxs("button",{type:"button",onClick:()=>g(!0),className:j("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(ce,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("category.addCustom","Add")})]})]}),h&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ve,{value:C,onChange:_=>M(_.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(ve,{value:p,onChange:_=>b(_.target.value),placeholder:s("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(V,{type:"button",variant:"outline",size:"sm",onClick:()=>g(!1),children:s("cancel","Cancel")}),e.jsx(V,{type:"button",size:"sm",onClick:D,disabled:!p.trim()||n.isPending,children:s("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.map(_=>{const $=_.children.filter(F=>!y.has(F.name)),U=$.length===0&&y.has(_.name);return e.jsxs("button",{type:"button",onClick:()=>!U&&S(_),disabled:U,className:j("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",U?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:_.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:_.name}),$.length>0&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:[$.length," ",s("budget.available","available")]})]},_.id)})})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:s("budget.amount")}),e.jsx(ve,{type:"number",value:o,onChange:_=>u(_.target.value),placeholder:Ne(0),min:1,autoFocus:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s("budget.remainingBudget"),": ",Ne(f)]})]}),T>0&&e.jsx("button",{type:"button",onClick:()=>u(String(T)),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:s("budget.suggestAmount",{amount:Ne(T)})})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(V,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:s("cancel")}),e.jsxs(V,{type:"submit",disabled:!x||parseInt(o)<=0,className:"flex-1",children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),s("budget.add")]})]})]})]})})}function ua({isOpen:t,onConfirm:a,onCancel:r,monthlyIncome:s,totalAllocated:i,savingsTarget:n,categoryCount:l,isLoading:c=!1}){const{t:x}=K("common"),{currency:d}=Y(),{isPrivacyMode:o}=Z(),{data:u}=G(),h=b=>J(b,d,(u==null?void 0:u.rates)||{},!1,o);if(!t)return null;const g=s-i-n,p=g<0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:r,"aria-hidden":"true"}),e.jsxs("div",{className:j("fixed z-50 bg-white dark:bg-gray-800 shadow-xl","inset-x-0 bottom-0 rounded-t-2xl","lg:inset-auto lg:left-1/2 lg:top-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2","lg:rounded-xl lg:max-w-md lg:w-full"),role:"dialog","aria-modal":"true","aria-labelledby":"confirm-dialog-title",children:[e.jsx("div",{className:"lg:hidden flex justify-center pt-3 pb-1",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("h2",{id:"confirm-dialog-title",className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:x("budget.confirmDialog.title")}),e.jsx("button",{onClick:r,className:"p-2 -mr-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":x("button.close"),children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:x("budget.monthlyIncome")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:h(s)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:x("budget.totalAllocated")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:h(i)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:x("budget.savingsTarget")}),e.jsx("span",{className:"font-semibold text-income-600 dark:text-income-300",children:h(n)})]}),e.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:x(p?"budget.overAllocated":"budget.confirmDialog.unallocated")}),e.jsx("span",{className:j("font-semibold",p?"text-expense-600 dark:text-expense-300":"text-gray-900 dark:text-gray-100"),children:p?`-${h(Math.abs(g))}`:h(g)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(he,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:x("budget.confirmDialog.categoriesConfigured",{count:l})})]}),p&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-400",children:x("budget.confirmDialog.overAllocatedWarning")})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(V,{variant:"outline",onClick:r,className:"flex-1",disabled:c,children:x("button.cancel")}),e.jsx(V,{onClick:a,className:"flex-1",disabled:c,children:x(c?"budget.saving":"budget.save")})]})]})]})}const me=[{id:"overview",labelKey:"budget.tabs.overview",icon:Xt},{id:"categories",labelKey:"budget.tabs.categories",icon:It},{id:"transactions",labelKey:"budget.tabs.transactions",icon:lt},{id:"forecast",labelKey:"budget.tabs.forecast",icon:ie}];function ga({activeTab:t,onTabChange:a,children:r,className:s,alertTabs:i=[]}){const{t:n}=K("common"),l=m.useRef(null),c=m.useRef(null);m.useEffect(()=>{if(c.current&&l.current){const d=l.current,o=c.current,u=o.offsetLeft-d.offsetWidth/2+o.offsetWidth/2;d.scrollTo({left:u,behavior:"smooth"})}},[t]);const x=(d,o)=>{let u=o;d.key==="ArrowLeft"?(d.preventDefault(),u=o>0?o-1:me.length-1):d.key==="ArrowRight"?(d.preventDefault(),u=o<me.length-1?o+1:0):d.key==="Home"?(d.preventDefault(),u=0):d.key==="End"&&(d.preventDefault(),u=me.length-1),u!==o&&a(me[u].id)};return e.jsxs("div",{className:j("flex flex-col",s),children:[e.jsx("div",{className:"hidden md:flex items-center gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg mb-4",role:"tablist","aria-label":n("budget.tabs.navigation"),children:me.map((d,o)=>{const u=d.icon,h=t===d.id,g=i.includes(d.id);return e.jsxs("button",{role:"tab","aria-selected":h,"aria-controls":`tabpanel-${d.id}`,tabIndex:h?0:-1,onClick:()=>a(d.id),onKeyDown:p=>x(p,o),className:j("relative flex items-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-all","focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2",h?"bg-white dark:bg-gray-900 text-primary-600 dark:text-primary-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"),children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:n(d.labelKey)}),g&&e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]},d.id)})}),e.jsx("div",{ref:l,className:"md:hidden flex gap-2 overflow-x-auto scrollbar-hide pb-1 mb-4 -mx-1 px-1",role:"tablist","aria-label":n("budget.tabs.navigation"),children:me.map((d,o)=>{const u=d.icon,h=t===d.id,g=i.includes(d.id);return e.jsxs("button",{ref:h?c:void 0,role:"tab","aria-selected":h,"aria-controls":`tabpanel-${d.id}`,tabIndex:h?0:-1,onClick:()=>a(d.id),onKeyDown:p=>x(p,o),className:j("relative flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium whitespace-nowrap transition-all flex-shrink-0","focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500","min-h-[44px]",h?"bg-primary-600 text-white shadow-sm":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"),children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:n(d.labelKey)}),g&&e.jsx("span",{className:j("absolute top-1 right-1 w-2 h-2 rounded-full",h?"bg-white":"bg-red-500")})]},d.id)})}),e.jsx("div",{id:`tabpanel-${t}`,role:"tabpanel","aria-labelledby":`tab-${t}`,tabIndex:0,children:r})]})}function ma({versions:t,currentVersion:a,formatCurrency:r,onRestore:s,isRestoring:i}){const{t:n}=K("common"),[l,c]=m.useState(!1);if(t.length<=1)return null;const x=d=>new Date(d).toLocaleDateString(Ye(),{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>c(!l),className:j("flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-colors","text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800",l&&"bg-gray-100 dark:bg-gray-800"),children:[e.jsx(Yt,{className:"w-4 h-4"}),e.jsxs("span",{children:["v",a]}),e.jsx(Ie,{className:j("w-3.5 h-3.5 transition-transform",l&&"rotate-180")})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:n("budget.versionHistory")})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.map(d=>e.jsxs("div",{className:j("px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700/50",d.is_active&&"bg-blue-50 dark:bg-blue-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-sm",children:["v",d.version]}),d.is_active&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(Se,{className:"w-3 h-3"}),n("budget.current")]}),d.copied_from_id&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",n("budget.copied"),")"]})]}),!d.is_active&&e.jsxs("button",{onClick:()=>{s(d.id),c(!1)},disabled:i,className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",children:[e.jsx(St,{className:"w-3 h-3"}),n("budget.restore")]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:x(d.created_at)}),e.jsx("span",{className:"mx-1",children:"Â·"}),e.jsx("span",{children:r(d.total_allocated)})]})]},d.id))})]})]})]})}function ha({totalBudget:t,totalSpent:a,totalAllocated:r,month:s,className:i}){const{t:n}=K("common"),{currency:l}=Y(),{isPrivacyMode:c}=Z(),{data:x}=G(),d=N=>J(N,l,(x==null?void 0:x.rates)||{},!0,c),o=N=>J(N,l,(x==null?void 0:x.rates)||{},!1,c),u=t-a,h=r>0?a/r*100:0,g=t>0?Math.max(0,u/t*100):0,{daysRemaining:p,dailyRate:b,safeDaily:C,status:M}=m.useMemo(()=>{const[N,S]=s.split("-").map(Number),R=new Date(N,S,0).getDate(),z=new Date().getDate(),D=Math.max(1,z),E=Math.max(0,R-z),T=a/D,_=t-a,$=E>0?_/E:0,U=a+T*E,F=t>0?U/t*100:0;let v="good";return F>100?v="danger":F>90&&(v="warning"),{daysRemaining:E,dailyRate:T,safeDaily:$,status:v}},[s,a,t]),y=m.useMemo(()=>a>r?{label:n("budget.health.overBudgetStatus"),status:"danger",color:"text-expense-600 dark:text-expense-300",bg:"bg-expense-50 dark:bg-expense-900/20",ring:"ring-expense-300 dark:ring-expense-900"}:h>95?{label:n("budget.health.almostFull"),status:"warning",color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-50 dark:bg-amber-900/30",ring:"ring-amber-200 dark:ring-amber-800"}:h>85?{label:n("budget.health.warningNearLimit"),status:"caution",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/30",ring:"ring-yellow-200 dark:ring-yellow-800"}:{label:n("budget.health.onTrack"),status:"good",color:"text-income-600 dark:text-income-300",bg:"bg-income-50 dark:bg-income-900/20",ring:"ring-income-300 dark:ring-income-900"},[a,r,h,n]),f=b>C&&C>0;return e.jsxs("div",{className:j("rounded-2xl ring-1 overflow-hidden",y.bg,y.ring,i),children:[e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium opacity-60 uppercase tracking-wider",children:n("budget.availableToSpend")}),e.jsxs("div",{className:j("flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold",y.status==="danger"?"bg-red-500 text-white":y.status==="warning"?"bg-amber-500 text-white":y.status==="caution"?"bg-yellow-500 text-gray-900":"bg-primary-500 text-white"),children:[y.status==="danger"?e.jsx(ae,{className:"w-3.5 h-3.5"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),y.label]})]}),e.jsxs("p",{className:j("text-4xl font-extrabold tracking-tight",u<0?"text-expense-600 dark:text-expense-300":y.color),children:[u<0&&"âˆ’",d(Math.abs(u))]}),e.jsx("div",{className:"mt-3 h-2.5 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-[width] duration-700 ease-out",u<0?"bg-expense-600":g<20?"bg-amber-500":g<40?"bg-yellow-500":"bg-income-600"),style:{width:`${Math.min(100,Math.max(0,g))}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs opacity-70 mt-1.5",children:[e.jsxs("span",{children:[o(a)," ",n("budget.spent")]}),e.jsx("span",{children:n("budget.ofTotalBudget",{total:o(t)})})]})]}),e.jsxs("div",{className:"px-4 py-3 bg-black/5 dark:bg-white/5 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:n("budget.projection.currentPace")}),e.jsxs("p",{className:j("text-lg font-bold leading-tight",f?"text-amber-600 dark:text-amber-400":""),children:[o(b),e.jsx("span",{className:"text-[10px] font-normal opacity-50",children:n("budget.pulse.perDay")})]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:n("budget.projection.safePace")}),e.jsxs("p",{className:"text-lg font-bold leading-tight text-income-600 dark:text-income-300",children:[C>0?o(C):"â€”",C>0&&e.jsx("span",{className:"text-[10px] font-normal opacity-50",children:n("budget.pulse.perDay")})]})]}),e.jsxs("div",{className:"min-w-0 text-right",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:n("budget.daysLeft")}),e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(ot,{className:"w-3.5 h-3.5 opacity-50"}),e.jsx("p",{className:"text-lg font-bold leading-tight",children:p})]})]})]})]})}function ba({income:t,allocated:a,savings:r,formatCurrency:s,className:i}){const{t:n}=K("common"),l=t>0?Math.min(100,a/t*100):0,c=t>0?Math.min(100,r/t*100):0,x=Math.max(0,100-l-c);return e.jsxs("div",{className:j("rounded-xl bg-gray-50 dark:bg-gray-800/50 p-4",i),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(De,{label:n("budget.flow.income"),value:s(t),color:"text-green-600 dark:text-green-400"}),e.jsx(Ee,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0 mx-1"}),e.jsx(De,{label:n("budget.flow.allocated"),value:s(a),color:"text-blue-600 dark:text-blue-400"}),e.jsx(Ee,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0 mx-1"}),e.jsx(De,{label:n("budget.flow.saved"),value:s(r),color:"text-pink-600 dark:text-pink-400"})]}),e.jsxs("div",{className:"h-3 rounded-full overflow-hidden flex bg-gray-200 dark:bg-gray-700",children:[l>0&&e.jsx("div",{className:"bg-blue-500 transition-all duration-500",style:{width:`${l}%`},title:`${n("budget.flow.allocated")}: ${Math.round(l)}%`}),c>0&&e.jsx("div",{className:"bg-pink-500 transition-all duration-500",style:{width:`${c}%`},title:`${n("budget.flow.saved")}: ${Math.round(c)}%`}),x>0&&e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 transition-all duration-500",style:{width:`${x}%`}})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-[10px] text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),Math.round(l),"% ",n("budget.flow.allocated").toLowerCase()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-pink-500"}),Math.round(c),"% ",n("budget.flow.saved").toLowerCase()]}),x>1&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600"}),Math.round(x),"% ",n("budget.flow.unallocated").toLowerCase()]})]})]})}function De({label:t,value:a,color:r}){return e.jsxs("div",{className:"text-center min-w-0 flex-1",children:[e.jsx("p",{className:"text-[10px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate",children:t}),e.jsx("p",{className:j("text-sm font-bold truncate",r),children:a})]})}const _e=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#6b7280"];function ya({allocations:t,totalBudget:a,totalAllocated:r,compact:s=!1,className:i}){const{t:n}=K("common"),{currency:l}=Y(),{isPrivacyMode:c}=Z(),{data:x}=G(),[d,o]=m.useState(null),u=y=>J(y,l,(x==null?void 0:x.rates)||{},!1,c),h=m.useMemo(()=>{if(!t.length)return[];const y=[...t].sort((z,D)=>D.amount-z.amount),f=y.slice(0,5),S=y.slice(5).reduce((z,D)=>z+D.amount,0),R=f.map((z,D)=>({name:z.category,value:z.amount,percentage:r>0?z.amount/r*100:0,color:_e[D%_e.length]}));return S>0&&R.push({name:n("budget.donutChart.other"),value:S,percentage:r>0?S/r*100:0,color:_e[7]}),R},[t,r,n]),g=a-r,p=y=>{const{cx:f,cy:N,innerRadius:S,outerRadius:R,startAngle:z,endAngle:D,fill:E,payload:T}=y;return e.jsxs("g",{children:[e.jsx(At,{cx:f,cy:N,innerRadius:S-2,outerRadius:R+4,startAngle:z,endAngle:D,fill:E}),e.jsx("text",{x:f,y:N-6,textAnchor:"middle",className:"fill-gray-500 dark:fill-gray-400 text-[10px]",children:T.name}),e.jsx("text",{x:f,y:N+10,textAnchor:"middle",className:"fill-gray-900 dark:fill-gray-100 text-xs font-bold",children:u(T.value)})]})};if(!t.length)return null;const b=s?120:200,C=s?36:55,M=s?52:80;return e.jsxs("div",{className:j(s?"flex items-center gap-4":"flex flex-col items-center",i),children:[e.jsxs("div",{className:"relative flex-shrink-0",style:{width:b,height:b},children:[e.jsx(Mt,{width:"100%",height:"100%",children:e.jsx(Dt,{children:e.jsx(_t,{data:h,cx:"50%",cy:"50%",innerRadius:C,outerRadius:M,paddingAngle:2,dataKey:"value",activeIndex:d??void 0,activeShape:d!==null?p:void 0,onMouseEnter:(y,f)=>o(f),onMouseLeave:()=>o(null),children:h.map((y,f)=>e.jsx(Pt,{fill:y.color,className:"cursor-pointer transition-opacity hover:opacity-80"},`cell-${f}`))})})}),d===null&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("span",{className:j("text-gray-500 dark:text-gray-400",s?"text-[9px]":"text-xs"),children:g>=0?n("budget.donutChart.remaining"):n("budget.overAllocated")}),e.jsx("span",{className:j("font-bold",s?"text-xs":"text-lg",g>=0?"text-gray-900 dark:text-gray-100":"text-red-600 dark:text-red-400"),children:g>=0?u(g):`âˆ’${u(Math.abs(g))}`})]})]}),e.jsx("div",{className:j("grid gap-y-1 gap-x-4",s?"grid-cols-1 flex-1 min-w-0":"grid-cols-2 mt-4 w-full max-w-xs"),children:h.map((y,f)=>e.jsxs("button",{className:j("flex items-center gap-2 text-left p-1 rounded transition-colors min-w-0",d===f&&"bg-gray-100 dark:bg-gray-800"),onMouseEnter:()=>o(f),onMouseLeave:()=>o(null),onFocus:()=>o(f),onBlur:()=>o(null),children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:y.color},"aria-hidden":"true"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:y.name}),e.jsxs("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 ml-auto flex-shrink-0",children:[Math.round(y.percentage),"%"]})]},f))})]})}function pa({categories:t,daysRemaining:a,onViewCategory:r,className:s}){const{t:i}=K("common"),{currency:n}=Y(),{isPrivacyMode:l}=Z(),{data:c}=G(),[x,d]=m.useState(new Set),o=b=>J(b,n,(c==null?void 0:c.rates)||{},!1,l),g=(()=>{const b=[],C=t.filter(N=>N.status==="red"),M=t.filter(N=>N.status==="orange"),y=t.filter(N=>N.status==="green"||N.status==="yellow");C.slice(0,2).forEach(N=>{const S=Math.abs(N.remaining);b.push({type:"exceeded",category:N.category,message:i("budget.alerts.exceededBy",{category:N.category,amount:o(S)}),action:i("budget.alerts.cutToStay",{category:N.category,amount:o(S)})})});const f=C.length>0?1:2;return M.slice(0,f).forEach(N=>{const S=a>0?N.remaining/a:0;b.push({type:"warning",category:N.category,message:i("budget.alerts.approaching",{category:N.category,amount:o(N.remaining),days:a}),action:a>0?i("budget.alerts.reduceDaily",{category:N.category,amount:o(S)}):void 0})}),C.length===0&&M.length===0&&y.length>0&&b.push({type:"onTrack",message:i("budget.alerts.allOnTrack",{count:y.length})}),b})().filter(b=>!x.has(b.category||"onTrack"));if(g.length===0)return null;const p=b=>{switch(b){case"exceeded":return{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-400",icon:Xe};case"warning":return{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",text:"text-amber-700 dark:text-amber-400",icon:ae};case"onTrack":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-400",icon:he}}};return e.jsx("div",{className:j("space-y-2",s),children:g.slice(0,2).map((b,C)=>{const M=p(b.type),y=M.icon;return e.jsxs("div",{className:j("flex items-start gap-3 p-3 rounded-lg border",M.bg,M.border),role:"alert",children:[e.jsx(y,{className:j("w-5 h-5 flex-shrink-0 mt-0.5",M.text),"aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:j("text-sm font-medium",M.text),children:b.message}),b.action&&e.jsx("p",{className:j("text-xs mt-0.5 opacity-80",M.text),children:b.action})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[b.category&&r&&e.jsx("button",{onClick:()=>r(b.category),className:j("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5",M.text),"aria-label":i("viewDetails"),children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const f=b.category||"onTrack";d(N=>new Set([...N,f]))},className:j("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5",M.text),"aria-label":i("button.close"),children:e.jsx(ue,{className:"w-4 h-4"})})]})]},b.category||`alert-${C}`)})})}function et({amount:t,transactions:a,month:r,className:s,aiState:i="idle",onAiCategorize:n}){const{t:l}=K("common"),c=$e(),{currency:x}=Y(),{isPrivacyMode:d}=Z(),{data:o}=G(),[u,h]=m.useState(!1),g=y=>J(y,x,(o==null?void 0:o.rates)||{},!1,d);if(u||t<=0)return null;const p=(a==null?void 0:a.length)||0,b=i==="loading",C=i==="success",M=()=>{c({to:"/transactions",search:{month:r||void 0}})};return e.jsxs("div",{className:j("flex items-start gap-3 p-3 rounded-xl border transition-all duration-300 ease-out",b&&"animate-shimmer",C?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",s),role:"alert",children:[C?e.jsx(dt,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5 animate-success-pop","aria-hidden":"true"}):e.jsx(ae,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:j("text-sm font-medium transition-colors duration-300",C?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"),children:C?l("budget.uncategorized.aiSuccess","Categories suggested!"):l("budget.uncategorized.title")}),e.jsx("p",{className:j("text-xs mt-0.5 transition-colors duration-300",C?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"),children:b?l("budget.uncategorized.aiProcessing","Analyzing transactions..."):C?l("budget.uncategorized.aiSuccessDescription","Review and apply the suggested categories below"):l("budget.uncategorized.description",{amount:g(t),count:p})}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[n&&!C&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:n,disabled:b,className:j("h-7 px-2.5 text-xs font-medium","bg-purple-50 dark:bg-purple-900/30","text-purple-700 dark:text-purple-300","hover:bg-purple-100 dark:hover:bg-purple-800/40","border border-purple-200 dark:border-purple-700","disabled:opacity-60"),children:[b?e.jsx(we,{className:"w-3.5 h-3.5 mr-1 animate-spin"}):e.jsx(Ce,{className:"w-3.5 h-3.5 mr-1"}),b?l("budget.uncategorized.aiProcessingBtn","Analyzing..."):l("budget.uncategorized.aiCategorizeCta","AI Categorize")]}),!b&&!C&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:M,className:"h-7 px-2 text-xs font-medium text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-800/40",children:[l("budget.uncategorized.reviewCta"),e.jsx(Ee,{className:"w-3.5 h-3.5 ml-1"})]})]})]}),e.jsx("button",{onClick:()=>h(!0),className:j("p-1.5 rounded-full transition-colors duration-200",C?"hover:bg-green-100 dark:hover:bg-green-800/40 text-green-500":"hover:bg-amber-100 dark:hover:bg-amber-800/40 text-amber-500"),"aria-label":l("button.close"),children:e.jsx(ue,{className:"w-4 h-4"})})]})}function fa({confidence:t}){const{t:a}=K("common"),r=Math.round(t*100),s=t>=.8?"success":t>=.6?"warning":"error";return e.jsxs(Be,{variant:s,className:"text-[10px] px-1.5 py-0.5",children:[r,"% ",a("ai.confidence")]})}function ja({suggestion:t,isSelected:a,editedCategory:r,categories:s,categoryMatchesBudget:i,onToggle:n,onCategoryChange:l}){const{currency:c}=Y(),{data:x}=G(),{t:d}=K("common");return e.jsxs("div",{className:j("group flex items-center gap-3 p-3 rounded-xl border transition-all duration-200","cursor-pointer select-none",a?"border-primary-500 bg-primary-50/60 dark:bg-primary-900/20 shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800/50"),onClick:()=>n(t.transaction_id),role:"checkbox","aria-checked":a,tabIndex:0,onKeyDown:o=>{(o.key===" "||o.key==="Enter")&&(o.preventDefault(),n(t.transaction_id))},children:[e.jsx("div",{className:j("flex-shrink-0 w-5 h-5 rounded-md border-2 flex items-center justify-center transition-all duration-200",a?"bg-primary-500 border-primary-500 text-white":"border-gray-300 dark:border-gray-600 group-hover:border-primary-400"),children:a&&e.jsx(Se,{className:"w-3.5 h-3.5",strokeWidth:3})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:t.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:Ne(Math.abs(t.amount),c,(x==null?void 0:x.rates)||{},!1)})]}),e.jsx(fa,{confidence:t.confidence})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 flex-shrink-0",children:t.current_category}),e.jsx("span",{className:"text-xs text-gray-400","aria-hidden":"true",children:"â†’"}),e.jsxs("div",{className:"relative flex-1 max-w-[180px]",children:[e.jsx("select",{value:r,onChange:o=>{o.stopPropagation(),l(t.transaction_id,o.target.value)},onClick:o=>o.stopPropagation(),className:j("w-full text-xs py-1 pl-2 pr-7 rounded-lg border appearance-none","focus:outline-none focus:ring-2 focus:border-transparent transition-colors duration-150",i?"bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-200 border-green-300 dark:border-green-700 focus:ring-green-500":"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-200 dark:border-gray-600 focus:ring-primary-500"),"aria-label":d("budget.aiCategorize.selectCategory"),children:s.map(o=>e.jsx("option",{value:o.value,children:o.matchesBudget?`${o.label}`:o.label},o.value))}),e.jsx(Ie,{className:j("absolute right-2 top-1/2 -translate-y-1/2 w-3 h-3 pointer-events-none",i?"text-green-500":"text-gray-400")})]}),i&&e.jsx(Be,{variant:"success",className:"text-[10px] px-1.5 py-0.5",children:d("budget.aiCategorize.budgetMatch","Budget")}),t.is_new_category&&!i&&e.jsx(Be,{variant:"info",className:"text-[10px] px-1.5 py-0.5",children:d("ai.newCategory")})]})]})]})}function va({createRules:t,onCreateRulesChange:a,selectedCount:r,noneSelected:s,isApplying:i,applyError:n,onApply:l,onClose:c}){const{t:x}=K("common");return e.jsxs("div",{className:j("mt-4 pt-4 border-t border-gray-200 dark:border-gray-700","flex flex-col gap-3"),children:[e.jsxs("label",{className:"flex items-center justify-between gap-3 cursor-pointer",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:x("ai.createRulesAuto")}),e.jsx(zt,{checked:t,onChange:a})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(V,{variant:"outline",size:"sm",onClick:c,disabled:i,children:x("cancel")}),e.jsxs(V,{size:"sm",onClick:l,disabled:s||i,loading:i,children:[e.jsx(Ce,{className:"w-4 h-4"}),x("budget.aiCategorize.apply",{count:r})]})]}),n&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-right",children:x("ai.applyError")})]})}function Na(){return e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((t,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(ye,{className:"w-5 h-5 rounded-md"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(ye,{className:"w-36 h-4"}),e.jsx(ye,{className:"w-14 h-5 rounded-full"})]}),e.jsx(ye,{className:"w-20 h-3"}),e.jsx(ye,{className:"w-28 h-6 rounded-lg"})]})]},a))})}function wa(t){if(!t)return[];const a=[];for(const r of t.expense){a.push(r.name);for(const s of r.children)a.push(s.name)}return a}function ka(t){if(!t)return{};const a={};for(const r of t.expense)a[r.name]=r.children.map(s=>s.name);return a}function He(t,a,r){const s=t.toLowerCase();for(const i of a){if(i.toLowerCase()===s)return!0;const n=r[i];if(n!=null&&n.some(l=>l.toLowerCase()===s))return!0}return!1}function Ca(t,a,r,s,i){const{t:n,i18n:l}=K("common"),c=ke(),{data:x}=Me(),[d,o]=m.useState(null),[u,h]=m.useState(new Map),[g,p]=m.useState(new Map),[b,C]=m.useState(!0),M=m.useMemo(()=>ka(x),[x]),y=m.useMemo(()=>new Set(r.map(v=>v.toLowerCase())),[r]),f=m.useMemo(()=>{const v=new Set(r);return wa(x).forEach(w=>v.add(w)),d==null||d.new_categories_suggested.forEach(w=>v.add(w)),Array.from(v).sort((w,B)=>{const O=y.has(w.toLowerCase())?0:1,k=y.has(B.toLowerCase())?0:1;return O!==k?O-k:w.localeCompare(B)}).map(w=>({value:w,label:w,matchesBudget:He(w,r,M)}))},[r,y,d,x,M]),N=le({mutationFn:()=>Et(a,50,l.language),onSuccess:v=>{o(v);const w=new Map,B=new Map;v.suggestions.forEach(O=>{B.set(O.transaction_id,O.suggested_category),O.confidence>=.7&&w.set(O.transaction_id,O.suggested_category)}),h(w),p(B)}}),S=le({mutationFn:()=>Bt({approved:Array.from(u.entries()).map(([v,w])=>({transaction_id:v,category:w})),create_rules:b}),onSuccess:()=>{c.invalidateQueries({queryKey:["budget","tracking"]}),c.invalidateQueries({queryKey:["transactions"]}),ct.success(n("ai.applySuccess")),s(),i()}});m.useEffect(()=>{t&&(o(null),h(new Map),p(new Map),C(!0),N.mutate())},[t]);const R=m.useCallback(v=>{h(w=>{const B=new Map(w);return B.has(v)?B.delete(v):B.set(v,g.get(v)||""),B})},[g]),z=m.useCallback((v,w)=>{p(B=>new Map(B).set(v,w)),h(B=>B.has(v)?new Map(B).set(v,w):B)},[]),D=m.useCallback(()=>{if(!d)return;const v=new Map;d.suggestions.forEach(w=>v.set(w.transaction_id,g.get(w.transaction_id)||w.suggested_category)),h(v)},[d,g]),E=m.useCallback(()=>h(new Map),[]),T=m.useMemo(()=>d?[...d.suggestions].sort((v,w)=>w.confidence-v.confidence):[],[d]),_=d?u.size===d.suggestions.length:!1,$=m.useCallback(()=>{S.isPending||i()},[S.isPending,i]);return{suggestions:d,selectedItems:u,editedCategories:g,createRules:b,setCreateRules:C,categoryOptions:f,fetchMutation:N,applyMutation:S,sortedSuggestions:T,allSelected:_,handleToggle:R,handleCategoryChange:z,handleSelectAll:D,handleDeselectAll:E,handleClose:$,getEditedCategory:(v,w)=>g.get(v)||w,checkBudgetMatch:v=>He(v,r,M)}}function Sa({open:t,onClose:a,month:r,budgetCategories:s,onSuccess:i}){const{t:n}=K("common"),{suggestions:l,categoryOptions:c,fetchMutation:x,applyMutation:d,sortedSuggestions:o,allSelected:u,selectedItems:h,createRules:g,setCreateRules:p,handleToggle:b,handleCategoryChange:C,handleSelectAll:M,handleDeselectAll:y,handleClose:f,getEditedCategory:N,checkBudgetMatch:S}=Ca(t,r,s,i,a);return e.jsxs(Tt,{isOpen:t,onClose:f,title:n("budget.aiCategorize.title"),size:"lg",children:[x.isPending&&e.jsx(Na,{}),x.isError&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:n("ai.analyzeError")}),e.jsx(V,{variant:"outline",onClick:()=>x.mutate(),children:n("budget.aiCategorize.retry")})]}),l&&l.suggestions.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-10 h-10 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("ai.noSuggestions")})]}),l&&l.suggestions.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("budget.aiCategorize.summary",{shown:l.suggestions.length,total:l.total_other_count})}),e.jsxs("button",{onClick:u?y:M,className:"flex items-center gap-1.5 text-xs font-medium text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors",children:[u?e.jsx(Ft,{className:"w-3.5 h-3.5"}):e.jsx(Rt,{className:"w-3.5 h-3.5"}),n(u?"ai.deselectAll":"ai.selectAll")]})]}),e.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto -mx-1 px-1 pb-1",children:o.map(R=>{const z=N(R.transaction_id,R.suggested_category);return e.jsx(ja,{suggestion:R,isSelected:h.has(R.transaction_id),editedCategory:z,categories:c,categoryMatchesBudget:S(z),onToggle:b,onCategoryChange:C},R.transaction_id)})}),e.jsx(va,{createRules:g,onCreateRulesChange:p,selectedCount:h.size,noneSelected:h.size===0,isApplying:d.isPending,applyError:d.isError,onApply:()=>d.mutate(),onClose:f})]})]})}function Ma({tracking:t,className:a}){const{t:r}=K("common"),s=m.useMemo(()=>{const l=t.uncategorized_spending||0,c=t.total_spent+l;return c<=0?100:Math.round(t.total_spent/c*100)},[t]),i=(t.uncategorized_spending||0)>0,n=s>=90;return i?e.jsxs("div",{className:j("flex items-center gap-2 px-3 py-2 rounded-lg",a),children:[n?e.jsx(sa,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(ta,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-[width] duration-500",n?"bg-green-500":"bg-amber-500"),style:{width:`${s}%`}})}),e.jsxs("span",{className:j("text-xs font-semibold tabular-nums flex-shrink-0",n?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"),children:[s,"%"]})]}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-0.5",children:r("budget.coverage.label")})]})]}):null}function Da(t,a,r,s){const{category:i,budgeted:n,spent:l}=t,c=Math.max(1,r),x=l/c,d=n-l,o=a>0?d/a:0,u=l+x*a,h=Math.max(0,u-n);let g;r>=15?g="high":r>=7?g="medium":g="low";const p=n>0?u/n*100:0;let b;return p>100?b="danger":p>85?b="warning":b="safe",{category:i,predictedTotal:u,budgetAmount:n,exceededBy:h,confidence:g,status:b,dailyPace:x,safeDailyPace:o,anomalyDetected:!1,anomalyDescription:void 0,daysRemaining:a,daysElapsed:r}}function _a(t,a,r){const{days_remaining:s}=a,n=30-s;return a.categories.map(l=>Da(l,s,n)).filter(l=>l.status!=="safe"||l.anomalyDetected).sort((l,c)=>{const x={danger:0,warning:1,safe:2};return x[l.status]!==x[c.status]?x[l.status]-x[c.status]:c.exceededBy-l.exceededBy})}function tt(t){const a=t.total_spent,r=t.total_budgeted,s=t.days_remaining,n=Math.max(1,30-s),l=a/n,c=a+l*s,x=r>0?c/r*100:0;let d;return x>100?d="danger":x>85?d="warning":d="safe",{totalPredicted:c,totalBudget:r,overallStatus:d,overallPercent:x}}function Pa({budget:t,tracking:a,previousMonthData:r,selectedMonth:s,onViewCategory:i}){const{t:n}=K("common"),l=ke(),{currency:c}=Y(),{isPrivacyMode:x}=Z(),{data:d}=G(),o=z=>J(z,c,(d==null?void 0:d.rates)||{},!1,x),u=t.allocations.reduce((z,D)=>z+D.amount,0),h=t.monthly_income-(t.savings_target||0),g=(a==null?void 0:a.total_spent)||0,[p,b]=m.useState("idle"),[C,M]=m.useState(!1),y=m.useMemo(()=>t.allocations.map(z=>z.category),[t.allocations]),f=m.useCallback(()=>{M(!0)},[]),N=m.useCallback(()=>{b("success"),l.invalidateQueries({queryKey:["budget","tracking"]}),l.invalidateQueries({queryKey:["budget","month"]})},[l]),S=m.useMemo(()=>a?tt(a):null,[a]),R=()=>{const z=new URL(window.location.href);z.searchParams.set("tab","forecast"),window.history.pushState({},"",z.toString()),window.dispatchEvent(new PopStateEvent("popstate"))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ha,{totalBudget:h,totalSpent:g,totalAllocated:u,month:s}),S&&e.jsxs("button",{onClick:R,className:j("w-full flex items-center gap-3 p-3 rounded-xl border text-left transition-colors",S.overallStatus==="danger"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":S.overallStatus==="warning"?"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30"),children:[S.overallStatus==="danger"?e.jsx(ae,{className:"w-5 h-5 text-red-500 flex-shrink-0"}):S.overallStatus==="warning"?e.jsx(ie,{className:"w-5 h-5 text-amber-500 flex-shrink-0"}):e.jsx(he,{className:"w-5 h-5 text-green-500 flex-shrink-0"}),e.jsx("p",{className:j("flex-1 text-sm font-medium",S.overallStatus==="danger"?"text-red-700 dark:text-red-300":S.overallStatus==="warning"?"text-amber-700 dark:text-amber-300":"text-green-700 dark:text-green-300"),children:S.overallStatus==="danger"?n("budget.forecastAlert.exceedBy",{amount:o(S.totalPredicted-S.totalBudget)}):S.overallStatus==="warning"?n("budget.forecastAlert.nearLimit",{percent:Math.round(S.overallPercent)}):n("budget.forecastAlert.onTrackSave",{amount:o(S.totalBudget-S.totalPredicted)})}),e.jsxs("span",{className:j("text-xs font-medium flex items-center gap-0.5 flex-shrink-0",S.overallStatus==="danger"?"text-red-500 dark:text-red-400":S.overallStatus==="warning"?"text-amber-500 dark:text-amber-400":"text-green-500 dark:text-green-400"),children:[n("budget.forecastAlert.seeDetails"),e.jsx(te,{className:"w-3.5 h-3.5"})]})]}),(a==null?void 0:a.uncategorized_spending)!=null&&a.uncategorized_spending>0&&e.jsx(et,{amount:a.uncategorized_spending,transactions:a.uncategorized_transactions,month:s,aiState:p,onAiCategorize:f}),e.jsx(Sa,{open:C,onClose:()=>M(!1),month:s,budgetCategories:y,onSuccess:N}),a&&e.jsx(Ma,{tracking:a}),a&&a.categories&&a.categories.length>0&&e.jsx(pa,{categories:a.categories,daysRemaining:a.days_remaining,onViewCategory:i}),e.jsx(ba,{income:t.monthly_income,allocated:u,savings:t.savings_target||0,formatCurrency:o}),t.allocations.length>0&&e.jsxs(Q,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:n("budget.donutChart.title")}),e.jsx(ya,{allocations:t.allocations,totalBudget:h,totalAllocated:u,compact:!0})]})]})}function at(t){return t>=95?"exceeded":t>=80?"warning":"on_track"}const Aa={on_track:{icon:he,bgColor:"bg-green-100 dark:bg-green-900/30",iconColor:"text-green-600 dark:text-green-400",label:"On Track",ariaLabel:"Budget on track"},warning:{icon:ae,bgColor:"bg-yellow-100 dark:bg-yellow-900/30",iconColor:"text-yellow-600 dark:text-yellow-400",label:"Warning",ariaLabel:"Budget warning - approaching limit"},exceeded:{icon:Xe,bgColor:"bg-red-100 dark:bg-red-900/30",iconColor:"text-red-600 dark:text-red-400",label:"Exceeded",ariaLabel:"Budget exceeded"}};function st({status:t,className:a}){const r=Aa[t],s=r.icon;return e.jsx("div",{className:j("flex-shrink-0",a),role:"status","aria-label":r.ariaLabel,children:e.jsx(s,{className:j("w-3.5 h-3.5",r.iconColor),"aria-hidden":"true"})})}function Ta({allocations:t,trackingItems:a,selectedCategory:r,onSelectCategory:s,isDraft:i,onAddCategory:n,className:l}){const{t:c}=K("common"),{currency:x}=Y(),{isPrivacyMode:d}=Z(),{data:o}=G(),u=m.useRef(null),h=m.useRef([]),[g,p]=m.useState(()=>{const y=t.findIndex(f=>f.category===r);return y>=0?y:0});m.useEffect(()=>{const y=t.findIndex(f=>f.category===r);y>=0&&p(y)},[r,t]),m.useEffect(()=>{const y=h.current[g];y==null||y.scrollIntoView({block:"nearest",behavior:"smooth"})},[g]);const b=y=>J(y,x,(o==null?void 0:o.rates)||{},!0,d),C=y=>a==null?void 0:a.find(f=>f.category===y),M=y=>{if(t.length!==0)switch(y.key){case"ArrowDown":y.preventDefault(),p(f=>f<t.length-1?f+1:0);break;case"ArrowUp":y.preventDefault(),p(f=>f>0?f-1:t.length-1);break;case"Home":y.preventDefault(),p(0);break;case"End":y.preventDefault(),p(t.length-1);break;case"Enter":case" ":y.preventDefault(),s(t[g].category);break}};return e.jsxs("div",{className:j("flex flex-col h-full",l),children:[i&&n&&e.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs(V,{variant:"outline",size:"sm",onClick:n,className:"w-full",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),c("budget.addCategory")]})}),e.jsxs("div",{ref:u,className:"flex-1 overflow-y-auto scrollbar-hide focus:outline-none",role:"listbox",tabIndex:0,"aria-label":c("budget.allocations"),"aria-activedescendant":t.length>0?`category-${g}`:void 0,onKeyDown:M,children:[t.map((y,f)=>{const N=C(y.category),S=(N==null?void 0:N.percentage)||0,R=(N==null?void 0:N.spent)||0,z=at(S),D=r===y.category,E=g===f;return e.jsxs("button",{ref:T=>{h.current[f]=T},id:`category-${f}`,role:"option","aria-selected":D,tabIndex:-1,onClick:()=>{p(f),s(y.category)},className:j("w-full flex items-center justify-between px-4 py-3","text-left transition-all","hover:bg-gray-50 dark:hover:bg-gray-800",E&&"ring-2 ring-inset ring-primary-500",D&&"bg-primary-50 dark:bg-primary-900/20 border-l-3 border-primary-500"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:y.category}),e.jsx(st,{status:z})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[b(R)," / ",b(y.amount)]}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:[Math.round(S),"%"]})]})]}),e.jsx(te,{className:j("w-4 h-4 text-gray-400 flex-shrink-0 transition-transform",D&&"text-green-500")})]},y.category)}),t.length===0&&e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:c("budget.noAllocations")})]})]})}function We(t,a,r){if(a==="JPY")return t;const s=r[a];return!s||s===0?t:Math.round(t/s)}function Qe({category:t,month:a,trackingItem:r,isOpen:s,onClose:i,mode:n="overlay",className:l}){const{t:c}=K("common"),x=$e(),{currency:d}=Y(),{isPrivacyMode:o}=Z(),{data:u}=G(),{data:h}=Me(),[g,p]=m.useState([]),[b,C]=m.useState(!1),[M,y]=m.useState(null),[f,N]=m.useState(null),S=v=>J(v,d,(u==null?void 0:u.rates)||{},!0,o),R=(v,w)=>J(v,w||d,(u==null?void 0:u.rates)||{},!0,o),z=m.useMemo(()=>{const v=new Map;return h&&(h.expense.forEach(w=>{const B=w.children.map(O=>O.name);v.set(w.name,B)}),h.income.forEach(w=>{const B=w.children.map(O=>O.name);v.set(w.name,B)})),v},[h]),D=m.useMemo(()=>{const v=z.get(t)||[];return[t,...v]},[t,z]),E=m.useMemo(()=>{if(!h)return null;for(const v of[...h.expense,...h.income])if(v.children.some(w=>w.name===t))return v.name;return null},[t,h]);m.useEffect(()=>{if(!s)return;let v=!0;async function w(){C(!0),y(null);try{const[B,O]=a.split("-").map(Number),k=new Date(B,O,0).getDate(),L=`${B}-${String(O).padStart(2,"0")}-01`,q=`${B}-${String(O).padStart(2,"0")}-${String(k).padStart(2,"0")}`,W=await Le({categories:D,start_date:L,end_date:q,type:"expense"});if(v){const se=(u==null?void 0:u.rates)||{},ee=W.filter(A=>!A.is_transfer).map(A=>({...A,amountJpy:We(Math.abs(A.amount),A.currency||"JPY",se)})).sort((A,I)=>I.amountJpy-A.amountJpy);p(ee.slice(0,10).map(({amountJpy:A,...I})=>I))}}catch{v&&y("Failed to load transactions")}finally{v&&C(!1)}}return w(),()=>{v=!1}},[t,a,s,D]),m.useEffect(()=>{if(!s)return;let v=!0;async function w(){try{const[B,O]=a.split("-").map(Number);let k=B,L=O-1;L<1&&(L=12,k-=1);const[q,W]=[k,L],se=new Date(q,W,0).getDate(),oe=`${q}-${String(W).padStart(2,"0")}-01`,ee=`${q}-${String(W).padStart(2,"0")}-${String(se).padStart(2,"0")}`,A=await Le({categories:D,start_date:oe,end_date:ee,type:"expense"});if(v){const I=(u==null?void 0:u.rates)||{},pe=A.filter(be=>!be.is_transfer).reduce((be,fe)=>{const P=We(Math.abs(fe.amount),fe.currency||"JPY",I);return be+P},0);N(pe)}}catch{}}return w(),()=>{v=!1}},[t,a,s,D]),m.useEffect(()=>{if(n!=="overlay"||!s)return;const v=w=>{w.key==="Escape"&&i()};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[s,n,i]);const T=v=>Ze(v,"MMM d"),_=()=>{i(),x({to:"/transactions",search:{categories:t,month:a}})},$=()=>{i()},U=(r==null?void 0:r.spent)||0,F=f?Math.round((U-f)/f*100):null;return s?n==="inline"?e.jsxs("div",{className:j("flex flex-col h-full",l),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("nav",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:c("budget.title","Budget")}),e.jsx(te,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:c("budget.categories","Categories")}),E&&e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:E})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S((r==null?void 0:r.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S(U)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:j("h-full rounded-full transition-[width] duration-500",(r==null?void 0:r.status)==="red"?"bg-red-500":(r==null?void 0:r.status)==="orange"?"bg-orange-500":(r==null?void 0:r.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(r==null?void 0:r.percentage)||0)}%`}})}),F!==null&&e.jsxs("div",{className:j("flex items-center gap-2 text-sm",F>0?"text-red-600 dark:text-red-400":F<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[F>0?e.jsx(ie,{className:"w-4 h-4"}):F<0?e.jsx(qe,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[F>0?"+":"",F,"% vs last month (",S(f||0),")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:c("dashboard.recentTransactions")}),b?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(we,{className:"w-6 h-6 animate-spin text-gray-400"})}):M?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:M})]}):g.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:c("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[g.map(v=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:v.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:T(v.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:R(v.amount,v.currency)})]},v.id)),g.length>=10&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:_,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:c("dashboard.viewAllCategories")}),e.jsx(Ue,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(V,{onClick:$,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:c("transaction.addTransaction")})]}),e.jsx(V,{variant:"outline",onClick:_,className:"w-full",children:e.jsx("span",{children:c("transactions.viewAll")})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 dark:bg-black/50 z-40 lg:hidden",onClick:i}),e.jsxs("div",{className:j("fixed right-0 top-0 h-full w-full sm:w-96 bg-white dark:bg-gray-900 shadow-xl z-50","flex flex-col transform transition-transform duration-300 ease-out",s?"translate-x-0":"translate-x-full",l),children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("nav",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:c("budget.title","Budget")}),e.jsx(te,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:c("budget.categories","Categories")}),E&&e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-3 h-3 mx-1"}),e.jsx("span",{className:"truncate",children:E})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:t})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors flex-shrink-0 ml-2",children:e.jsx(ue,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S((r==null?void 0:r.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S(U)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:j("h-full rounded-full transition-[width] duration-500",(r==null?void 0:r.status)==="red"?"bg-red-500":(r==null?void 0:r.status)==="orange"?"bg-orange-500":(r==null?void 0:r.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(r==null?void 0:r.percentage)||0)}%`}})}),F!==null&&e.jsxs("div",{className:j("flex items-center gap-2 text-sm",F>0?"text-red-600 dark:text-red-400":F<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[F>0?e.jsx(ie,{className:"w-4 h-4"}):F<0?e.jsx(qe,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[F>0?"+":"",F,"% vs last month (",S(f||0),")"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:c("dashboard.recentTransactions")}),b?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(we,{className:"w-6 h-6 animate-spin text-gray-400"})}):M?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:M})]}):g.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:c("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[g.map(v=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:v.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:T(v.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:R(v.amount,v.currency)})]},v.id)),g.length>=10&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:_,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:c("dashboard.viewAllCategories")}),e.jsx(Ue,{className:"w-3 h-3"})]})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(V,{onClick:$,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:c("transaction.addTransaction")})]}),e.jsx(V,{variant:"outline",onClick:_,className:"w-full",children:e.jsx("span",{children:c("transactions.viewAll")})})]})]})]}):null}function za({isDraft:t,onEdit:a,onDelete:r,onQuickAdjust:s}){const{t:i}=K("common"),[n,l]=m.useState(!1),[c,x]=m.useState(!1),d=m.useRef(null);m.useEffect(()=>{if(!n)return;const g=p=>{d.current&&!d.current.contains(p.target)&&(l(!1),x(!1))};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[n]);const o=g=>{g.stopPropagation(),l(!n),x(!1)},u=(g,p)=>{g.stopPropagation(),p(),l(!1)},h=g=>{g.stopPropagation(),c?(r(),l(!1),x(!1)):x(!0)};return e.jsxs("div",{ref:d,className:"relative",children:[e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":i("budget.cardActions","Actions"),"aria-expanded":n,children:e.jsx(Qt,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"})}),n&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-20 py-1",children:[e.jsxs("button",{onClick:g=>u(g,a),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(Kt,{className:"w-4 h-4"}),i("budget.editAmount")]}),t&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:g=>u(g,()=>s(5e3)),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(Lt,{className:"w-4 h-4"}),"+5,000"]}),e.jsxs("button",{onClick:g=>u(g,()=>s(-5e3)),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx($t,{className:"w-4 h-4"}),"-5,000"]}),e.jsxs("button",{onClick:g=>u(g,()=>s("percent")),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("span",{className:"w-4 h-4 text-center text-xs font-bold",children:"%"}),"+10%"]})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700 my-1"}),e.jsxs("button",{onClick:h,className:j("w-full flex items-center gap-2 px-3 py-2.5 text-sm transition-colors",c?"text-white bg-red-600 hover:bg-red-700":"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20"),children:[e.jsx(it,{className:"w-4 h-4"}),i(c?"budget.deleteConfirm":"delete")]})]})]})}function Ea({currentAmount:t,onSave:a,onCancel:r}){const{t:s}=K("common"),i=m.useRef(null),[n,l]=m.useState(t.toLocaleString());m.useEffect(()=>{var o,u;(o=i.current)==null||o.focus(),(u=i.current)==null||u.select()},[]);const c=o=>{const u=o.replace(/[^\d]/g,"");return u?parseInt(u,10).toLocaleString():""},x=o=>parseInt(o.replace(/[^\d]/g,""),10)||0,d=()=>{const o=x(n);o!==t?a(o):r()};return e.jsxs("div",{className:"flex items-center gap-1",onClick:o=>o.stopPropagation(),children:[e.jsx("input",{ref:i,type:"text",inputMode:"numeric",value:n,onChange:o=>l(c(o.target.value)),onKeyDown:o=>{o.key==="Enter"?d():o.key==="Escape"&&r()},className:"w-28 text-right text-lg font-bold border-2 border-primary-400 rounded px-2 py-1 dark:bg-gray-700 dark:border-primary-500 dark:text-gray-100 focus:outline-none focus:border-primary-500","aria-label":s("budget.editAmount")}),e.jsx("button",{onClick:d,className:"p-1.5 bg-primary-100 dark:bg-primary-900/40 hover:bg-primary-200 dark:hover:bg-primary-900/60 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":s("save"),children:e.jsx(Se,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),e.jsx("button",{onClick:r,className:"p-1.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":s("cancel"),children:e.jsx(ue,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})})]})}function Ba(t,a,r,s,i,n){if(s<=0)return null;const l=s-r;if(r>s){const c=r-s;return{text:t("budget.nudge.overTapToAdjust",{amount:a(c)}),className:"text-red-600 dark:text-red-400"}}if(i>=80){const c=Math.round(r-s*.75);return{text:t("budget.nudge.reduceToStaySafe",{amount:a(Math.max(c,0))}),className:"text-amber-600 dark:text-amber-400"}}if(n&&n>0&&l>0){const c=Math.round(l/n);return{text:t("budget.nudge.safeToSpend",{amount:a(c)}),className:"text-green-600 dark:text-green-400"}}return null}function La({allocation:t,trackingItem:a,daysRemaining:r,isDraft:s,isUpdating:i,isDeleting:n,formatCurrency:l,onAmountChange:c,onDelete:x,onCategoryClick:d,onQuickAdjust:o}){const{t:u}=K("common"),[h,g]=m.useState(!1),p=(a==null?void 0:a.spent)||0,b=(a==null?void 0:a.budgeted)||t.amount,C=b>0?p/b*100:0,M=at(C),y=()=>C>=100?"bg-red-500":C>=80?"bg-amber-500":"bg-green-500",f=a?Ba(u,l,p,b,C,r):null,N=()=>{!s&&!h&&d()};return e.jsxs(Q,{className:j("p-3 sm:p-4 transition-all",s?"border-dashed border-primary-300 dark:border-primary-700":"cursor-pointer hover:shadow-md hover:border-primary-300 dark:hover:border-primary-600",(i||n)&&"opacity-50 pointer-events-none"),onClick:N,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:t.category}),a&&e.jsx(st,{status:M})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:h?e.jsx(Ea,{currentAmount:t.amount,onSave:S=>{c(S),g(!1)},onCancel:()=>g(!1)}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-base font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap",children:l(t.amount)}),e.jsx(za,{isDraft:s,onEdit:()=>g(!0),onDelete:x,onQuickAdjust:s?o:void 0})]})})]}),a&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[l(p)," / ",l(b)]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-[width] duration-500 ease-out",y()),style:{width:`${Math.min(C,100)}%`}})}),C>100&&e.jsx("div",{className:"h-1 bg-red-200 dark:bg-red-900/50 rounded-full mt-0.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500 rounded-full",style:{width:`${Math.min((p-b)/b*100,100)}%`}})})]}),f&&e.jsx("p",{className:j("text-xs font-medium mt-1.5",f.className),children:f.text})]})}function $a({budgetId:t,allocations:a,totalBudget:r,tracking:s,month:i,daysRemaining:n,isDraft:l,onAddCategory:c,onAllocationChange:x}){const{t:d}=K("common"),o=$e(),u=ke(),{data:h}=Me(),{currency:g}=Y(),{isPrivacyMode:p}=Z(),{data:b}=G(),C=D=>J(D,g,(b==null?void 0:b.rates)||{},!0,p),M=m.useMemo(()=>{const D=new Map;if(!h)return D;for(const E of[...h.expense,...h.income])D.set(E.name,E.children.map(T=>T.name));return D},[h]),y=m.useMemo(()=>{var E;const D=new Map;return(E=s==null?void 0:s.categories)==null||E.forEach(T=>D.set(T.category,T)),D},[s]),f=m.useMemo(()=>[...a].sort((D,E)=>{const T=y.get(D.category),_=y.get(E.category),$=(T==null?void 0:T.spent)||0,U=(_==null?void 0:_.spent)||0,F=(T==null?void 0:T.budgeted)||D.amount,v=(_==null?void 0:_.budgeted)||E.amount,w=$-F,B=U-v;if(w>0&&B<=0)return-1;if(B>0&&w<=0)return 1;const O=F>0?$/F:0;return(v>0?U/v:0)-O}),[a,y]),N=le({mutationFn:({category:D,amount:E})=>xt(t,D,E),onSuccess:()=>u.invalidateQueries({queryKey:["budget"]})}),S=le({mutationFn:D=>ut(t,D),onSuccess:()=>u.invalidateQueries({queryKey:["budget"]})}),R=D=>{const E=M.get(D)||[];o({to:"/transactions",search:{categories:[D,...E].join(","),month:i||void 0}})},z=(D,E)=>{if(!l||!x)return;const T=a[D],_=E==="percent"?Math.floor(T.amount*1.1):Math.max(0,T.amount+E),$=[...a];$[D]={...T,amount:_},x($)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:d("budget.allocations")}),c&&e.jsxs(V,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),d("budget.addCategory")]})]}),l&&x&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:d("budget.tapToEdit")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:f.map(D=>{const E=a.findIndex(T=>T.category===D.category);return e.jsx(La,{allocation:D,totalBudget:r,trackingItem:y.get(D.category),daysRemaining:n,isDraft:l,isUpdating:N.isPending,isDeleting:S.isPending,formatCurrency:C,onAmountChange:T=>{if(l&&x){const _=[...a];_[E]={...D,amount:T},x(_)}else N.mutate({category:D.category,amount:T})},onDelete:()=>{l&&x?x(a.filter((T,_)=>_!==E)):S.mutate(D.category)},onCategoryClick:()=>R(D.category),onQuickAdjust:T=>z(E,T)},D.category)})}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:d("budget.noAllocations")})]})}function Fa({budget:t,tracking:a,isDraft:r,selectedMonth:s,onAddCategory:i,onAllocationChange:n}){const{t:l}=K("common"),[c,x]=m.useState(null),d=t.monthly_income-(t.savings_target||0),o=m.useCallback(u=>{var h;return(h=a==null?void 0:a.categories)==null?void 0:h.find(g=>g.category===u)},[a]);return e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.uncategorized_spending)!=null&&a.uncategorized_spending>0&&e.jsx(et,{amount:a.uncategorized_spending,transactions:a.uncategorized_transactions,month:s}),e.jsxs("div",{className:"hidden lg:grid lg:grid-cols-[280px_1fr] lg:gap-4 lg:min-h-[500px]",children:[e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:e.jsx(Ta,{allocations:t.allocations,trackingItems:a==null?void 0:a.categories,selectedCategory:c,onSelectCategory:x,isDraft:r,onAddCategory:i})}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:c?e.jsx(Qe,{category:c,month:s,trackingItem:o(c),isOpen:!0,onClose:()=>x(null),mode:"inline"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400 p-8",children:l("budget.selectCategoryHint")})})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx($a,{budgetId:t.id,allocations:t.allocations,totalBudget:d,tracking:a,month:s,daysRemaining:a==null?void 0:a.days_remaining,isDraft:r,onAddCategory:i,onAllocationChange:n})}),e.jsx("div",{className:"lg:hidden",children:e.jsx(Qe,{category:c||"",month:s,trackingItem:c?o(c):void 0,isOpen:!!c,onClose:()=>x(null),mode:"overlay"})})]})}const Pe=20;function Ra({allocations:t,month:a,onEditTransaction:r}){const{t:s}=K("common"),{currency:i}=Y(),{isPrivacyMode:n}=Z(),{data:l}=G(),[c,x]=m.useState([]),[d,o]=m.useState(!0),[u,h]=m.useState(null),[g,p]=m.useState("all"),[b,C]=m.useState(""),[M,y]=m.useState("date"),[f,N]=m.useState("desc"),[S,R]=m.useState(1),z=k=>J(k,i,(l==null?void 0:l.rates)||{},!1,n),D=(k,L)=>J(k,L||i,(l==null?void 0:l.rates)||{},!0,n),E=m.useMemo(()=>["all",...t.map(k=>k.category)],[t]),T=m.useMemo(()=>{const k=new Map;return t.forEach(L=>k.set(L.category,L.amount)),k},[t]),_=m.useMemo(()=>{const k=new Map;return c.forEach(L=>{const q=L.category||"";k.set(q,(k.get(q)||0)+Math.abs(L.amount))}),k},[c]);m.useEffect(()=>{let k=!0;async function L(){o(!0);try{const[q,W]=a.split("-").map(Number),se=new Date(q,W,0).getDate(),oe=await Le({start_date:`${q}-${String(W).padStart(2,"0")}-01`,end_date:`${q}-${String(W).padStart(2,"0")}-${String(se).padStart(2,"0")}`,type:"expense"});k&&x(oe.filter(ee=>!ee.is_transfer))}catch{k&&h("Failed to load")}finally{k&&o(!1)}}return L(),()=>{k=!1}},[a]);const $=m.useMemo(()=>{let k=[...c];if(g!=="all"&&(k=k.filter(L=>L.category===g)),b.trim()){const L=b.toLowerCase();k=k.filter(q=>{var W;return q.description.toLowerCase().includes(L)||((W=q.category)==null?void 0:W.toLowerCase().includes(L))})}return k.sort((L,q)=>{const W=M==="date"?new Date(L.date).getTime()-new Date(q.date).getTime():Math.abs(L.amount)-Math.abs(q.amount);return f==="desc"?-W:W}),k},[c,g,b,M,f]),U=Math.ceil($.length/Pe),F=$.slice((S-1)*Pe,S*Pe);if(m.useEffect(()=>{R(1)},[g,b,M,f]),d)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(we,{className:"w-6 h-6 animate-spin text-gray-400"})});if(u)return e.jsx(Q,{className:"p-6 text-center text-red-500",children:u});const v=g!=="all"?T.get(g):void 0,w=g!=="all"?_.get(g)||0:void 0,B=v&&v>0?Math.round(w/v*100):void 0,O=k=>{const L=T.get(k);return L!==void 0&&L>0&&(_.get(k)||0)>L};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("select",{value:g,onChange:k=>p(k.target.value),className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:E.map(k=>e.jsx("option",{value:k,children:k==="all"?s("transactions.allCategories"):k},k))}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:b,onChange:k=>C(k.target.value),placeholder:s("transactions.search"),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm"})]}),e.jsxs("select",{value:`${M}-${f}`,onChange:k=>{const[L,q]=k.target.value.split("-");y(L),N(q)},className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"date-desc",children:s("transactions.sortDateDesc")}),e.jsx("option",{value:"date-asc",children:s("transactions.sortDateAsc")}),e.jsx("option",{value:"amount-desc",children:s("transactions.sortAmountDesc")}),e.jsx("option",{value:"amount-asc",children:s("transactions.sortAmountAsc")})]})]}),v!==void 0&&w!==void 0&&e.jsxs("div",{className:"px-3 py-2.5 rounded-lg bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:g}),e.jsxs("span",{className:j("text-sm font-semibold",B>100?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:[s("budget.budgetContext.progress",{spent:z(w),budgeted:z(v)})," ","(",B,"%)"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-[width]",B>100?"bg-red-500":B>85?"bg-amber-500":"bg-green-500"),style:{width:`${Math.min(100,B)}%`}})})]}),e.jsx(Q,{className:"divide-y divide-gray-100 dark:divide-gray-800 overflow-hidden",children:F.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:s("transactions.noData")}):F.map(k=>{const L=T.get(k.category||""),q=L&&L>0?Math.round(Math.abs(k.amount)/L*100):0,W=O(k.category||"");return e.jsxs("button",{onClick:()=>r==null?void 0:r(k),className:j("w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",W&&"border-l-3 border-l-red-400 dark:border-l-red-500"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:k.description}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Ze(k.date,"MMM d")," â€¢ ",k.category||s("category.other")]})]}),e.jsxs("div",{className:"text-right ml-4 flex-shrink-0",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:D(k.amount,k.currency)}),q>10&&e.jsx("p",{className:j("text-[10px] font-medium mt-0.5",q>30?"text-red-500":q>20?"text-amber-500":"text-gray-400"),children:s("budget.budgetContext.impact",{percent:q})})]})]},k.id)})}),U>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500",children:s("transactions.showingCount",{shown:F.length,total:$.length})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(k=>Math.max(1,k-1)),disabled:S===1,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm",children:[S," / ",U]}),e.jsx("button",{onClick:()=>R(k=>Math.min(U,k+1)),disabled:S===U,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(te,{className:"w-5 h-5"})})]})]})]})}function Ka({predictions:t,onViewCategory:a,onAdjustBudget:r,onDismiss:s,maxAlerts:i=3,className:n}){const{t:l}=K("common"),{currency:c}=Y(),{isPrivacyMode:x}=Z(),{data:d}=G(),o=p=>J(p,c,(d==null?void 0:d.rates)||{},!0,x),u=t.slice(0,i);if(u.length===0)return null;const h=p=>p.anomalyDetected?{icon:kt,bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200 dark:border-purple-800",iconBg:"bg-purple-100 dark:bg-purple-900/50",iconColor:"text-purple-600 dark:text-purple-400",textColor:"text-purple-800 dark:text-purple-200"}:p.status==="danger"?{icon:ae,bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",iconBg:"bg-red-100 dark:bg-red-900/50",iconColor:"text-red-600 dark:text-red-400",textColor:"text-red-800 dark:text-red-200"}:{icon:ie,bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",iconBg:"bg-amber-100 dark:bg-amber-900/50",iconColor:"text-amber-600 dark:text-amber-400",textColor:"text-amber-800 dark:text-amber-200"},g=p=>l(`budget.forecast.confidence.${p}`);return e.jsxs("div",{className:j("space-y-3",n),children:[u.map(p=>{const b=h(p),C=b.icon;return e.jsx(Q,{className:j("p-4 border",b.bg,b.border),role:"alert",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:j("p-2 rounded-lg flex-shrink-0",b.iconBg),children:e.jsx(C,{className:j("w-5 h-5",b.iconColor)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:j("font-semibold",b.textColor),children:p.anomalyDetected?l("budget.forecast.anomalyDetected"):p.status==="danger"?l("budget.forecast.predictedOverspend"):l("budget.forecast.approachingLimit")}),e.jsx("p",{className:j("text-sm mt-0.5",b.textColor,"opacity-90"),children:p.anomalyDetected?`${p.category}: ${p.anomalyDescription}`:`${p.category} ${l("budget.forecast.willExceedBy")} ${o(p.exceededBy)}`})]}),s&&e.jsx("button",{onClick:()=>s(p.category),className:j("p-1 rounded hover:bg-black/5 dark:hover:bg-white/5",b.textColor),"aria-label":l("button.close"),children:e.jsx(ue,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:j("flex items-center gap-4 mt-2 text-xs",b.textColor,"opacity-80"),children:[e.jsxs("span",{children:[l("budget.forecast.currentPace"),": ",o(p.dailyPace),"/day"]}),e.jsxs("span",{children:[l("budget.forecast.safePace"),": ",o(p.safeDailyPace),"/day"]}),e.jsxs("span",{children:[p.daysRemaining," ",l("budget.daysLeft")]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:j("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",p.confidence==="high"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":p.confidence==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:[l("budget.forecast.confidenceLabel"),": ",g(p.confidence)]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(V,{variant:"ghost",size:"sm",onClick:()=>a(p.category),className:b.textColor,children:[e.jsx(mt,{className:"w-4 h-4 mr-1"}),l("viewDetails")]}),r&&e.jsxs(V,{variant:"ghost",size:"sm",onClick:()=>r(p.category),className:b.textColor,children:[e.jsx(ht,{className:"w-4 h-4 mr-1"}),l("budget.forecast.adjustBudget")]})]})]})]})},p.category)}),t.length>i&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:l("budget.forecast.moreAlerts",{count:t.length-i})})]})}function qa({budget:t,tracking:a,selectedMonth:r,onViewCategory:s,onAdjustBudget:i}){const{t:n}=K("common"),{currency:l}=Y(),{isPrivacyMode:c}=Z(),{data:x}=G(),d=g=>J(g,l,(x==null?void 0:x.rates)||{},!0,c),o=m.useMemo(()=>a?_a(t.allocations,a):[],[t.allocations,a]),u=m.useMemo(()=>a?tt(a):null,[a]);if(!a)return e.jsx(Q,{className:"p-8 text-center text-gray-500",children:n("budget.forecast.noData")});const h=o.length>0;return e.jsxs("div",{className:"space-y-6",children:[u&&e.jsx(Q,{className:j("p-6 border-2",u.overallStatus==="danger"?"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/20":u.overallStatus==="warning"?"border-amber-300 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20":"border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-900/20"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:j("w-14 h-14 rounded-full flex items-center justify-center",u.overallStatus==="danger"?"bg-red-500":u.overallStatus==="warning"?"bg-amber-500":"bg-green-500"),children:u.overallStatus==="danger"?e.jsx(ae,{className:"w-7 h-7 text-white"}):u.overallStatus==="warning"?e.jsx(ie,{className:"w-7 h-7 text-white"}):e.jsx(he,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:j("text-lg font-bold",u.overallStatus==="danger"?"text-red-800 dark:text-red-200":u.overallStatus==="warning"?"text-amber-800 dark:text-amber-200":"text-green-800 dark:text-green-200"),children:u.overallStatus==="danger"?n("budget.forecast.overBudgetProjected"):u.overallStatus==="warning"?n("budget.forecast.approachingLimit"):n("budget.forecast.onTrack")}),e.jsx("p",{className:j("text-sm mt-0.5",u.overallStatus==="danger"?"text-red-700 dark:text-red-300":u.overallStatus==="warning"?"text-amber-700 dark:text-amber-300":"text-green-700 dark:text-green-300"),children:n("budget.forecast.projectedSpending",{amount:d(u.totalPredicted),budget:d(u.totalBudget)})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:j("text-3xl font-bold",u.overallStatus==="danger"?"text-red-600 dark:text-red-400":u.overallStatus==="warning"?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400"),children:[Math.round(u.overallPercent),"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:n("budget.forecast.ofBudget")})]})]})}),h?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:n("budget.forecast.predictedWarnings")}),e.jsx(Ka,{predictions:o,onViewCategory:s,onAdjustBudget:i,maxAlerts:5})]}):e.jsxs(Q,{className:"p-6 text-center bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsx(he,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:n("budget.forecast.allClear")}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:n("budget.forecast.allClearDescription")})]}),e.jsxs(Q,{className:"overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:n("budget.forecast.categoryForecasts")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:a.categories.map(g=>{const p=o.find(M=>M.category===g.category),b=(p==null?void 0:p.predictedTotal)||g.spent,C=g.budgeted>0?b/g.budgeted*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:g.category}),e.jsxs("p",{className:"text-sm text-gray-500",children:[d(g.spent)," â†’ ",d(b)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:j("font-semibold",C>100?"text-red-600":C>85?"text-amber-600":"text-green-600"),children:[Math.round(C),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/ ",d(g.budgeted)]})]})]},g.category)})})]})]})}const Je="budget-active-tab",Va=["overview","categories","transactions","forecast"];function Ae(t){return t!==null&&Va.includes(t)}function Oa(t="overview"){const[a,r]=m.useState(()=>{if(typeof window<"u"){const n=new URLSearchParams(window.location.search).get("tab");if(Ae(n))return n;const l=localStorage.getItem(Je);if(Ae(l))return l}return t}),s=m.useCallback(i=>{if(r(i),typeof window<"u"){const n=new URL(window.location.href);n.searchParams.set("tab",i),window.history.replaceState({},"",n.toString()),localStorage.setItem(Je,i)}},[]);return m.useEffect(()=>{const i=()=>{const l=new URLSearchParams(window.location.search).get("tab");Ae(l)&&r(l)};return window.addEventListener("popstate",i),()=>window.removeEventListener("popstate",i)},[]),{activeTab:a,setActiveTab:s}}const Te=()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`},ze=t=>{const[a,r]=t.split("-").map(Number),s=r-1<1?12:r-1;return`${r-1<1?a-1:a}-${String(s).padStart(2,"0")}`};function Ua(){const{t,i18n:a}=K("common"),r=ke(),{currency:s}=Y(),{isPrivacyMode:i}=Z(),{data:n}=G(),[l,c]=m.useState(!1),[x,d]=m.useState(null),[o,u]=m.useState(Te),[h,g]=m.useState([]),[p,b]=m.useState(!1),[C,M]=m.useState(!1),[y,f]=m.useState(null),{activeTab:N,setActiveTab:S}=Oa("overview"),{showBudgetCreatedXP:R}=Vt(),z=P=>J(P,s,(n==null?void 0:n.rates)||{},!0,i),D=P=>{const[H,X]=P.split("-");return new Date(parseInt(H),parseInt(X)-1).toLocaleDateString(a.language,{month:"long",year:"numeric"})},E=o===Te(),T=m.useCallback(P=>{u(H=>{const[X,re]=H.split("-").map(Number);let ne=X,de=re;return P==="prev"?(de-=1,de<1&&(de=12,ne-=1)):(de+=1,de>12&&(de=1,ne+=1)),`${ne}-${String(de).padStart(2,"0")}`})},[]),_=m.useCallback(()=>u(Te()),[]),{data:$,isLoading:U,error:F}=ge({queryKey:["budget","month",o],queryFn:async()=>{var P;try{return await Ve(o)}catch(H){if(((P=H==null?void 0:H.response)==null?void 0:P.status)===404)return null;throw H}},retry:!1}),{data:v}=ge({queryKey:["budget","previous-month",o],queryFn:async()=>{try{return await Ve(ze(o))}catch{return null}},enabled:!!$,staleTime:5*60*1e3}),{data:w}=ge({queryKey:["budget","tracking",o],queryFn:async()=>{var P;try{return await jt(o)}catch(H){if(((P=H==null?void 0:H.response)==null?void 0:P.status)===404)return null;throw H}},retry:!1,enabled:!!$}),{data:B}=ge({queryKey:["budget","suggestions"],queryFn:vt,enabled:!$&&!U}),{data:O,isLoading:k}=ge({queryKey:["budget","copy-preview",o],queryFn:()=>Nt(ze(o),o),enabled:!$&&!U&&!x,retry:!1}),{data:L}=ge({queryKey:["budget","versions",o],queryFn:()=>wt(o),enabled:!!$}),q=le({mutationFn:P=>bt({monthly_income:P,language:a.language}),onSuccess:P=>{d(P),ee("generate",P),R()}}),W=le({mutationFn:P=>yt((x||$).id,{feedback:P,language:a.language}),onSuccess:P=>{d(P),c(!1),ee("regenerate",P)}}),se=le({mutationFn:()=>pt({source_month:ze(o),target_month:o}),onSuccess:P=>{d(P),r.invalidateQueries({queryKey:["budget"]})}}),oe=le({mutationFn:P=>ft(P),onSuccess:()=>{r.invalidateQueries({queryKey:["budget"]})}}),ee=m.useCallback((P,H)=>{g(X=>[...X.slice(-9),{action:P,data:H}])},[]),A=x||$,I=!!x,Re=(A==null?void 0:A.allocations.reduce((P,H)=>P+H.amount,0))||0,pe=m.useMemo(()=>{if(!w)return null;const P=w.total_spent/(w.total_budgeted||1);return P>1?"bg-red-500":P>.85?"bg-amber-500":"bg-green-500"},[w]),be=m.useMemo(()=>{if(!w)return[];const P=[];return w.categories.some(X=>X.status==="red")&&P.push("categories"),w.total_spent/(w.total_budgeted||1)>1&&P.push("forecast"),P},[w]),fe=m.useCallback(()=>{if(!A)return;const P=`${t("budget.title")} - ${A.month}
${t("budget.monthlyIncome")}: ${z(A.monthly_income)}
${t("budget.savingsTarget")}: ${z(A.savings_target||0)}

${t("budget.allocations")}:
${A.allocations.map(ne=>`- ${ne.category}: ${z(ne.amount)}`).join(`
`)}

${t("budget.aiAdvice")}: ${A.advice||"-"}
`,H=new Blob([P],{type:"text/plain"}),X=URL.createObjectURL(H),re=document.createElement("a");re.href=X,re.download=`budget-${A.month}.txt`,re.click(),URL.revokeObjectURL(X)},[A,t]);return U?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ge,{})}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:()=>T("prev"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:D(o)}),pe&&e.jsx("span",{className:j("w-2.5 h-2.5 rounded-full flex-shrink-0",pe),title:t("budget.health.title")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!E&&e.jsx("button",{onClick:_,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center text-green-600 dark:text-green-400",title:t("common.today"),children:e.jsx(Ht,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>T("next"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",disabled:o>=new Date().toISOString().slice(0,7),children:e.jsx(te,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:t("budget.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("budget.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&L.length>1&&A&&e.jsx(ma,{versions:L,currentVersion:A.version||1,formatCurrency:z,onRestore:P=>oe.mutate(P),isRestoring:oe.isPending}),A&&e.jsx("button",{onClick:fe,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",title:t("export"),children:e.jsx(Ot,{className:"w-5 h-5"})})]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 space-y-4",children:[!A&&!F&&e.jsx(ca,{copyPreview:O,isCopyPreviewLoading:k,suggestions:B,selectedMonth:o,formatCurrency:z,formatMonth:D,onCopy:()=>se.mutate(),onGenerate:P=>q.mutate(P),onStartEmpty:()=>{var P;d({id:0,month:o,monthly_income:((P=O==null?void 0:O.source_budget)==null?void 0:P.monthly_income)||0,allocations:[],created_at:new Date().toISOString()})},isCopyLoading:se.isPending,isGenerateLoading:q.isPending,generateError:q.isError}),A&&e.jsxs(ga,{activeTab:N,onTabChange:S,alertTabs:be,children:[N==="overview"&&e.jsx(Pa,{budget:A,tracking:w||void 0,previousMonthData:v,selectedMonth:o,onViewCategory:()=>S("categories")}),N==="categories"&&e.jsx(Fa,{budget:A,tracking:w||void 0,isDraft:I,selectedMonth:o,onAddCategory:()=>b(!0),onAllocationChange:P=>{I&&d({...A,allocations:P})}}),N==="transactions"&&e.jsx(Ra,{allocations:A.allocations,month:o,onEditTransaction:f}),N==="forecast"&&e.jsx(qa,{budget:A,tracking:w||void 0,selectedMonth:o,onViewCategory:()=>S("categories")}),I&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(V,{variant:"outline",onClick:()=>c(!l),className:"flex-1",children:[e.jsx(Ha,{className:"w-4 h-4 mr-2"}),t("budget.regenerate")]}),e.jsxs(V,{onClick:()=>M(!0),className:"flex-1",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),t("budget.save")]})]}),l&&e.jsx(ia,{onSubmit:P=>W.mutate(P),onCancel:()=>c(!1),isLoading:W.isPending})]}),F&&e.jsx(Q,{className:"p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:F instanceof Error?F.message:t("budget.generateError")})}),p&&A&&e.jsx(xa,{budget:A,onClose:()=>b(!1),onAdd:(P,H)=>{const X=[...A.allocations,{category:P,amount:H}];d({...A,allocations:X,savings_target:Math.max(0,A.monthly_income-X.reduce((re,ne)=>re+ne.amount,0))}),b(!1),ee("add-category",A)}})]}),A&&I&&e.jsx("div",{className:"fixed bottom-20 right-4 sm:hidden",children:e.jsx(V,{size:"lg",className:"rounded-full shadow-lg",onClick:()=>b(!0),children:e.jsx(ce,{className:"w-6 h-6"})})}),y&&e.jsx(qt,{transaction:y,isOpen:!!y,onClose:()=>{f(null),r.invalidateQueries({queryKey:["budget","tracking"]})}}),e.jsx(ua,{isOpen:C,onConfirm:async()=>{await r.refetchQueries({queryKey:["budget"]}),d(null),M(!1)},onCancel:()=>M(!1),monthlyIncome:(A==null?void 0:A.monthly_income)||0,totalAllocated:Re,savingsTarget:(A==null?void 0:A.savings_target)||0,categoryCount:(A==null?void 0:A.allocations.length)||0})]})}function Ha({className:t}){return e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}const gs=rt("/budget")({component:Ua});export{gs as Route};
