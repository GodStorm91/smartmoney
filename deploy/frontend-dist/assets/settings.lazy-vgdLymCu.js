import{c as e,u as t,k as a,j as s,m as r}from"./vendor-tanstack-CNAyyoyW.js";import{r as n,a as l}from"./vendor-react-Bx4JnVfy.js";import{a as i,C as d,L as c,B as o,c as m,w as g,x,y as u,z as y,A as h,I as b,D as p,F as j,G as f,H as v}from"./index-CL4Qiyvp.js";import{C as k,a as N}from"./crypto-F1TRPE0c.js";import{S as w}from"./Select-DzXIKsm6.js";import{R as C}from"./RecurringTransactionsList-Dg-tCdOO.js";import{u as S}from"./vendor-i18n-BrrOrGm_.js";import{a7 as _,a8 as D,P as q,v as P,a9 as F,N as R,X as z,D as K,u as E}from"./vendor-icons-BP-EQ_TG.js";import{u as Q,a as T,b as L,c as A}from"./recurring-service-DFZkC56R.js";import"./vendor-recharts-BrNIwK9z.js";import"./vendor-date-BkGg5e1q.js";async function O(){return(await i.get("/api/category-rules/")).data.rules}async function I(e){return(await i.post("/api/category-rules/",e)).data}async function W(e){await i.delete(`/api/category-rules/${e}`)}async function U(){return(await i.get("/api/category-rules/suggest")).data.suggestions}async function $(){return(await i.post("/api/category-rules/seed-defaults")).data}const H={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},J=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function Y(){const{t:r}=S("common"),l=e(),[g,x]=n.useState(null),[u,y]=n.useState(!1),[h,b]=n.useState(!1),[p,j]=n.useState(null),[f,v]=n.useState(""),[N,w]=n.useState("Other"),[C,z]=n.useState("contains"),{data:K,isLoading:E}=t({queryKey:["category-rules"],queryFn:O}),{data:Q,isLoading:T}=t({queryKey:["category-rules-suggestions"],queryFn:U,enabled:h}),L=a({mutationFn:W,onSuccess:()=>{l.invalidateQueries({queryKey:["category-rules"]}),x(null)}}),A=a({mutationFn:I,onSuccess:()=>{l.invalidateQueries({queryKey:["category-rules"]}),v(""),w("Other"),z("contains"),y(!1)}}),Y=a({mutationFn:$,onSuccess:()=>{l.invalidateQueries({queryKey:["category-rules"]})}}),G=a({mutationFn:e=>async function(e=!0){return(await i.post("/api/category-rules/apply",{dry_run:e})).data}(e),onSuccess:(e,t)=>{t?j({count:e.affected_count,applied:!1}):(l.invalidateQueries({queryKey:["transactions"]}),l.invalidateQueries({queryKey:["analytics"]}),j({count:e.affected_count,applied:!0}))}});return E?s.jsxs(d,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(_,{className:"w-5 h-5 text-purple-500"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("categoryRules.title")})]}),s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(c,{size:"md"})})]}):s.jsxs(k,{title:r("categoryRules.title"),badge:(null==K?void 0:K.length)||0,children:[s.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!K||0===K.length)&&s.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Y.mutate(),disabled:Y.isPending,children:[s.jsx(D,{className:"w-4 h-4 mr-1"}),Y.isPending?r("common.loading"):r("categoryRules.seedDefaults")]}),s.jsxs(o,{variant:"outline",size:"sm",onClick:()=>y(!u),children:[s.jsx(q,{className:"w-4 h-4 mr-1"}),r("categoryRules.addRule")]})]}),u&&s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[s.jsx("input",{type:"text",placeholder:r("categoryRules.keyword"),value:f,onChange:e=>v(e.target.value),className:m("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),s.jsx("select",{value:N,onChange:e=>w(e.target.value),className:m("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:J.map(e=>s.jsx("option",{value:e,children:e},e))}),s.jsxs("select",{value:C,onChange:e=>z(e.target.value),className:m("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[s.jsx("option",{value:"contains",children:r("categoryRules.contains")}),s.jsx("option",{value:"starts_with",children:r("categoryRules.startsWith")}),s.jsx("option",{value:"exact",children:r("categoryRules.exact")})]})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>y(!1),children:r("common.cancel")}),s.jsx(o,{size:"sm",onClick:()=>{f.trim()&&A.mutate({keyword:f.trim(),category:N,match_type:C,priority:10})},disabled:!f.trim()||A.isPending,children:A.isPending?r("common.saving"):r("common.save")})]})]}),K&&K.length>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"space-y-2 mb-6",children:K.map(e=>s.jsxs("div",{className:m("flex items-center justify-between p-3 rounded-lg border",e.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:e.keyword}),s.jsx("span",{className:"text-gray-400",children:"â†’"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:e.category}),s.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",r(H[e.match_type]),")"]})]}),s.jsx("button",{onClick:()=>{return t=e.id,void(confirm(r("common.confirmDelete"))&&(x(t),L.mutate(t)));var t},disabled:g===e.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:g===e.id?s.jsx(c,{size:"sm"}):s.jsx(P,{className:"w-4 h-4"})})]},e.id))}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r("categoryRules.applyDescription")}),p&&s.jsx("p",{className:m("text-sm mt-1",p.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:p.applied?r("categoryRules.appliedCount",{count:p.count}):r("categoryRules.previewCount",{count:p.count})})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>G.mutate(!0),disabled:G.isPending,children:G.isPending?r("common.loading"):r("categoryRules.preview")}),s.jsxs(o,{size:"sm",onClick:()=>G.mutate(!1),disabled:G.isPending||0===(null==p?void 0:p.count),children:[s.jsx(F,{className:"w-4 h-4 mr-1"}),r("categoryRules.applyNow")]})]})]})})]}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(_,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r("categoryRules.noRules")}),s.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:r("categoryRules.noRulesDescription")})]}),s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[s.jsx("button",{onClick:()=>b(!h),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:r(h?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),h&&s.jsx("div",{className:"mt-4 space-y-2",children:T?s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(c,{size:"sm"})}):Q&&Q.length>0?Q.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:e.keyword}),s.jsx("span",{className:"text-gray-400",children:"â†’"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.suggested_category}),s.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.count,"x)"]})]}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>(e=>{A.mutate({keyword:e.keyword,category:e.suggested_category,match_type:"contains",priority:10})})(e),disabled:A.isPending,children:s.jsx(R,{className:"w-4 h-4"})})]},t)):s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:r("categoryRules.noSuggestions")})})]})]})}const G=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function M({isOpen:e,onClose:t,defaultType:a="expense",onCreated:r}){const{t:i}=S("common"),d=Q(),[c,o]=n.useState(""),[g,x]=n.useState("ðŸ“"),[u,y]=n.useState(a),[h,b]=n.useState(""),p=()=>{o(""),x("ðŸ“"),y(a),b(""),t()};if(!e)return null;const j=s.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:p}),s.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i("category.createTitle","Create Category")}),s.jsx("button",{onClick:p,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:s.jsx(z,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),s.jsxs("form",{onSubmit:async e=>{var t,a;e.preventDefault(),b("");const s=c.trim();if(s)try{const e=`custom_${(await d.mutateAsync({name:s,icon:g,type:u})).id}`;null==r||r(e),p()}catch(n){b((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.detail)||i("category.errors.createFailed","Failed to create category"))}else b(i("category.errors.nameRequired","Name is required"))},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.name","Category Name")}),s.jsx("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:i("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.icon","Icon")}),s.jsx("div",{className:"grid grid-cols-10 gap-1",children:G.map(e=>s.jsx("button",{type:"button",onClick:()=>x(e),className:m("w-8 h-8 text-lg rounded flex items-center justify-center",g===e?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:e},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.type","Type")}),s.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[s.jsx("button",{type:"button",onClick:()=>y("expense"),className:m("flex-1 py-2 rounded-md text-sm font-medium transition-colors","expense"===u?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:i("transaction.expense","Expense")}),s.jsx("button",{type:"button",onClick:()=>y("income"),className:m("flex-1 py-2 rounded-md text-sm font-medium transition-colors","income"===u?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:i("transaction.income","Income")})]})]}),h&&s.jsx("p",{className:"text-sm text-red-500",children:h}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:p,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:i("common.cancel","Cancel")}),s.jsx("button",{type:"submit",disabled:d.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:d.isPending?"...":i("common.create","Create")})]})]})]})]});return"undefined"==typeof document?null:l.createPortal(j,document.body)}const V=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function B({isOpen:t,onClose:r,category:i}){const{t:d}=S("common"),c=e(),[o,g]=n.useState(""),[x,u]=n.useState("ðŸ“"),[y,h]=n.useState(""),[b,p]=n.useState(null);n.useEffect(()=>{i&&(g(i.name),u(i.icon),h(""),p(null))},[i]);const j=a({mutationFn:e=>T(i.id,e),onSuccess:e=>{p(e.affected_transactions),c.invalidateQueries({queryKey:["categories"]}),c.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{f()},1500)},onError:e=>{var t,a;h((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.detail)||d("category.errors.updateFailed","Failed to update category"))}}),f=()=>{g(""),u("ðŸ“"),h(""),p(null),r()};if(!t||!i)return null;const v=o.trim()!==i.name,k=s.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:f}),s.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:d("category.editTitle","Edit Category")}),s.jsx("button",{onClick:f,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:s.jsx(z,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),null!==b&&s.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:s.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[d("category.updateSuccess","Category updated!"),b>0&&s.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:d("category.transactionsUpdated","{{count}} transactions updated",{count:b})})]})}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),h("");const t=o.trim();if(!t)return void h(d("category.errors.nameRequired","Name is required"));const a={};t!==(null==i?void 0:i.name)&&(a.name=t),x!==(null==i?void 0:i.icon)&&(a.icon=x),0!==Object.keys(a).length?j.mutate(a):f()},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("category.name","Category Name")}),s.jsx("input",{type:"text",value:o,onChange:e=>g(e.target.value),placeholder:d("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),v&&s.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[s.jsx(K,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),s.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:d("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("category.icon","Icon")}),s.jsx("div",{className:"grid grid-cols-10 gap-1",children:V.map(e=>s.jsx("button",{type:"button",onClick:()=>u(e),className:m("w-8 h-8 text-lg rounded flex items-center justify-center",x===e?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:e},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("category.type","Type")}),s.jsx("div",{className:m("h-10 px-3 flex items-center rounded-lg text-sm font-medium","expense"===i.type?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:"expense"===i.type?d("transaction.expense","Expense"):d("transaction.income","Income")})]}),y&&s.jsx("p",{className:"text-sm text-red-500",children:y}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:f,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:d("common.cancel","Cancel")}),s.jsx("button",{type:"submit",disabled:j.isPending||null!==b,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:j.isPending?"...":d("common.save","Save")})]})]})]})]});return"undefined"==typeof document?null:l.createPortal(k,document.body)}function X(){const{t:e}=S("common"),{data:t=[],isLoading:a}=L(),r=A(),[l,i]=n.useState(!1),[d,c]=n.useState(null),[m,g]=n.useState(null),x=async e=>{try{await r.mutateAsync(e),g(null)}catch(t){}},u=t.filter(e=>"expense"===e.type),y=t.filter(e=>"income"===e.type);return s.jsxs(s.Fragment,{children:[s.jsxs(k,{title:e("settings.categoryManagement"),badge:t.length,children:[a?s.jsx("div",{className:"py-4 text-center text-gray-400",children:e("common.loading")}):0===t.length?s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:e("settings.noCategories")}):s.jsxs("div",{className:"space-y-4",children:[u.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:e("transaction.expense","Expense")}),s.jsx("div",{className:"space-y-2",children:u.map(e=>s.jsx(Z,{category:e,onEdit:()=>c(e),onDelete:()=>g(e.id),isDeleting:r.isPending&&m===e.id,showDeleteConfirm:m===e.id,onConfirmDelete:()=>x(e.id),onCancelDelete:()=>g(null)},e.id))})]}),y.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:e("transaction.income","Income")}),s.jsx("div",{className:"space-y-2",children:y.map(e=>s.jsx(Z,{category:e,onEdit:()=>c(e),onDelete:()=>g(e.id),isDeleting:r.isPending&&m===e.id,showDeleteConfirm:m===e.id,onConfirmDelete:()=>x(e.id),onCancelDelete:()=>g(null)},e.id))})]})]}),s.jsx("div",{className:"mt-4",children:s.jsx(o,{variant:"outline",onClick:()=>i(!0),children:e("settings.addCategory")})})]}),s.jsx(M,{isOpen:l,onClose:()=>i(!1)}),s.jsx(B,{isOpen:!!d,onClose:()=>c(null),category:d})]})}function Z({category:e,onEdit:t,onDelete:a,isDeleting:r,showDeleteConfirm:n,onConfirmDelete:l,onCancelDelete:i}){const{t:d}=S("common");return n?s.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[s.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:d("category.deleteConfirm","Delete this category?")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:i,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:d("common.cancel")}),s.jsx("button",{onClick:l,disabled:r,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:r?"...":d("common.delete")})]})]}):s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-xl",children:e.icon}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:t,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:d("common.edit"),children:s.jsx(E,{size:16})}),s.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:d("common.delete"),children:s.jsx(P,{size:16})})]})]})}const ee=["eth","bsc","polygon"];function te(){const{t:r}=S("common"),l=e(),[i,m]=n.useState(!1),[f,v]=n.useState(""),[k,w]=n.useState(""),[C,_]=n.useState(["eth","bsc","polygon"]),[D,q]=n.useState(!1),[P,F]=n.useState("polygon"),[R,z]=n.useState(""),[K,E]=n.useState(""),[Q,T]=n.useState(""),[L,A]=n.useState(null),{data:O,isLoading:I}=t({queryKey:["crypto-wallets"],queryFn:p}),{data:W,isLoading:U}=t({queryKey:["reward-contracts"],queryFn:j}),$=a({mutationFn:g,onSuccess:()=>{l.invalidateQueries({queryKey:["crypto-wallets"]}),m(!1),M()}}),H=a({mutationFn:x,onSuccess:()=>{l.invalidateQueries({queryKey:["crypto-wallets"]})}}),J=a({mutationFn:u,onSuccess:()=>{l.invalidateQueries({queryKey:["crypto-wallets"]}),l.invalidateQueries({queryKey:["dashboard-summary"]}),A(null)},onError:()=>{A(null)}}),Y=a({mutationFn:y,onSuccess:()=>{l.invalidateQueries({queryKey:["reward-contracts"]}),q(!1),V()}}),G=a({mutationFn:h,onSuccess:()=>{l.invalidateQueries({queryKey:["reward-contracts"]})}}),M=()=>{v(""),w(""),_(["eth","bsc","polygon"])},V=()=>{F("polygon"),z(""),E(""),T("")};return I||U?s.jsx(d,{children:s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(c,{})})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs(d,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("crypto.wallets")}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>m(!i),children:r(i?"common.cancel":"crypto.addWallet")})]}),i&&s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[s.jsx(b,{label:r("crypto.walletAddress"),placeholder:"0x...",value:f,onChange:e=>v(e.target.value)}),s.jsx(b,{label:r("crypto.walletLabel"),placeholder:r("crypto.labelPlaceholder"),value:k,onChange:e=>w(e.target.value)}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("crypto.chains")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{_(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(C.includes(e)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:[N[e].icon," ",N[e].name]},e))})]}),s.jsx(o,{onClick:()=>{f&&f.match(/^0x[a-fA-F0-9]{40}$/)?$.mutate({wallet_address:f,label:k||void 0,chains:C}):alert(r("crypto.invalidAddress"))},disabled:$.isPending,className:"w-full",children:$.isPending?r("common.loading"):r("crypto.addWallet")})]}),s.jsx("div",{className:"space-y-3",children:O&&O.length>0?O.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.label||r("crypto.unnamedWallet")}),s.jsx("div",{className:"flex gap-1",children:e.chains.map(e=>s.jsx("span",{title:N[e].name,children:N[e].icon},e))})]}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:e.wallet_address})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>{return t=e.id,A(t),void J.mutate(t);var t},disabled:L===e.id,children:L===e.id?s.jsx(c,{size:"sm"}):r("crypto.sync")}),s.jsx("button",{onClick:()=>{confirm(r("crypto.confirmDeleteWallet"))&&H.mutate(e.id)},className:"text-red-600 hover:text-red-700 text-sm",children:r("common.delete")})]})]},e.id)):s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:r("crypto.noWallets")})})]}),s.jsxs(d,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("crypto.rewardContracts")}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("crypto.rewardContractsDescription")})]}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>q(!D),children:r(D?"common.cancel":"crypto.addContract")})]}),D&&s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("crypto.chain")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map(e=>s.jsxs("button",{type:"button",onClick:()=>F(e),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(P===e?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:[N[e].icon," ",N[e].name]},e))})]}),s.jsx(b,{label:r("crypto.contractAddress"),placeholder:"0x...",value:R,onChange:e=>z(e.target.value)}),s.jsx(b,{label:r("crypto.contractLabel"),placeholder:r("crypto.contractLabelPlaceholder"),value:K,onChange:e=>E(e.target.value)}),s.jsx(b,{label:r("crypto.tokenSymbol"),placeholder:"STEER",value:Q,onChange:e=>T(e.target.value)}),s.jsx(o,{onClick:()=>{R&&R.match(/^0x[a-fA-F0-9]{40}$/)?Y.mutate({chain_id:P,contract_address:R,label:K||void 0,token_symbol:Q||void 0}):alert(r("crypto.invalidAddress"))},disabled:Y.isPending,className:"w-full",children:Y.isPending?r("common.loading"):r("crypto.addContract")})]}),s.jsx("div",{className:"space-y-3",children:W&&W.length>0?W.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{title:N[e.chain_id].name,children:N[e.chain_id].icon}),s.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.label||r("crypto.unnamedContract")}),e.token_symbol&&s.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:e.token_symbol})]}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:e.contract_address})]}),s.jsx("button",{onClick:()=>{confirm(r("crypto.confirmDeleteContract"))&&G.mutate(e.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:r("common.delete")})]},e.id)):s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:r("crypto.noContracts")})})]})]})}const ae=r("/settings")({component:function(){var r,l;const{t:i}=S("common"),m=e(),{data:g,isLoading:x}=t({queryKey:["settings"],queryFn:v}),[u,y]=n.useState("JPY"),[h,p]=n.useState(25),[j,N]=n.useState(!1),[_,D]=n.useState(!0),[q,P]=n.useState(1e6);n.useEffect(()=>{g&&(y(g.currency),p(g.base_date),N(g.budget_carry_over),D(g.budget_email_alerts),P(g.large_transaction_threshold))},[g]);const F=a({mutationFn:f,onSuccess:()=>{m.invalidateQueries({queryKey:["settings"]}),m.invalidateQueries({queryKey:["dashboard-summary"]}),m.invalidateQueries({queryKey:["transactions"]}),m.invalidateQueries({queryKey:["analytics"]}),alert(i("settings.saveSuccess"))},onError:e=>{alert(i("settings.saveFailed"))}}),R=()=>{F.mutate({currency:u,base_date:h,budget_carry_over:j,budget_email_alerts:_,large_transaction_threshold:q})};return x?s.jsx("div",{className:"flex justify-center py-12",children:s.jsx(c,{size:"lg"})}):s.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:i("settings.title")}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:i("settings.subtitle")})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(d,{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:i("settings.general")}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(w,{label:i("settings.currency"),value:u,onChange:e=>y(e.target.value),options:[{value:"JPY",label:i("settings.currencyJPY")},{value:"USD",label:i("settings.currencyUSD")},{value:"VND",label:i("settings.currencyVND")}]}),s.jsx(b,{type:"number",label:i("settings.payday"),value:h,onChange:e=>p(parseInt(e.target.value,10)),min:1,max:31})]}),s.jsx("div",{className:"mt-6",children:s.jsx(o,{onClick:R,disabled:F.isPending,children:F.isPending?i("common.loading"):i("settings.saveSettings")})})]}),s.jsxs(d,{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:i("settings.budgetSettings")}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:i("settings.budgetCarryOver")}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("settings.budgetCarryOverDescription")})]}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[s.jsx("input",{type:"checkbox",checked:j,onChange:e=>N(e.target.checked),className:"sr-only peer"}),s.jsx("div",{className:"w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:i("settings.budgetEmailAlerts")}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("settings.budgetEmailAlertsDescription")})]}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[s.jsx("input",{type:"checkbox",checked:_,onChange:e=>D(e.target.checked),className:"sr-only peer"}),s.jsx("div",{className:"w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),s.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:i("settings.largeTransactionThreshold")}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:i("settings.largeTransactionThresholdDescription")}),s.jsx(b,{type:"number",value:q,onChange:e=>P(parseInt(e.target.value,10)||0),min:0,step:1e5,placeholder:"1000000"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:i("settings.largeTransactionThresholdHint")})]})]}),s.jsx("div",{className:"mt-6",children:s.jsx(o,{onClick:R,disabled:F.isPending,children:F.isPending?i("common.loading"):i("settings.saveSettings")})})]}),s.jsx(X,{}),s.jsxs(k,{title:i("settings.paymentSourceManagement"),badge:(null==(r=null==g?void 0:g.sources)?void 0:r.length)||0,children:[s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:(null==(l=null==g?void 0:g.sources)?void 0:l.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e}),s.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:i("settings.delete")})]},t)))||s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:i("settings.noSources")})}),s.jsx("div",{className:"mt-4",children:s.jsx(o,{variant:"outline",children:i("settings.addSource")})})]}),s.jsx(Y,{}),s.jsx(C,{}),s.jsx(te,{})]})]})}});export{ae as Route};
