import{k as z,F as P,u as E,G as O,r as g,z as I,a1 as R,j as e,C as M,D as K,B as S,P as be,l as p,T as se,g as re,X as ne,v as Y,I as D,af as fe,ag as X,ah as je,ai as H,aj as ke,ak as ie,R as ve,al as Ne,am as we,an as Ce,ao as _e,ap as Se,aq as le,Q as Pe,ar as Te,as as qe,i as Re}from"./index-DrTfRdV3.js";import{C as G,c as De,d as Me,s as Ee,a as Fe,b as Ae,e as A,f as Ke,g as Le}from"./crypto-CFz7qVxa.js";import{S as ce}from"./Select-BSWSmIql.js";import{P as Ie,R as ze}from"./RecurringTransactionsList-B1uz3QGk.js";import{T as J}from"./tag-DvKz_Tsw.js";import{u as Oe,a as We,b as Qe,c as $e}from"./useCategories-BKA-Gn9_.js";import{T as Z}from"./triangle-alert-CHUJdtF_.js";import{P as He}from"./pencil-BTWMSF3G.js";import{M as Ue}from"./mail-BHd0UTbk.js";import{C as Ve}from"./crown-B5LO3kdA.js";import{Z as Be}from"./zap-8Ioml4b1.js";import"./chevron-down-B4MNf48x.js";import"./recurring-service-B3-45yzn.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Ye=z("monitor",Je);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],oe=z("palette",Ge);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],Xe=z("repeat",Ze);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],tt=z("save",et);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],st=z("smartphone",at);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],nt=z("wand-sparkles",rt);async function it(){return(await P.get("/api/category-rules/")).data.rules}async function lt(t){return(await P.post("/api/category-rules/",t)).data}async function ct(t){await P.delete(`/api/category-rules/${t}`)}async function ot(t=!0){return(await P.post("/api/category-rules/apply",{dry_run:t})).data}async function dt(){return(await P.get("/api/category-rules/suggest")).data.suggestions}async function gt(){return(await P.post("/api/category-rules/seed-defaults")).data}const mt={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},ut=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function xt(){const{t}=E("common"),r=O(),[a,i]=g.useState(null),[x,h]=g.useState(!1),[s,y]=g.useState(!1),[m,c]=g.useState(null),[u,k]=g.useState(""),[l,o]=g.useState("Other"),[n,b]=g.useState("contains"),{data:f,isLoading:C}=I({queryKey:["category-rules"],queryFn:it}),{data:v,isLoading:T}=I({queryKey:["category-rules-suggestions"],queryFn:dt,enabled:s}),w=R({mutationFn:ct,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]}),i(null)}}),_=R({mutationFn:lt,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]}),k(""),o("Other"),b("contains"),h(!1)}}),q=R({mutationFn:gt,onSuccess:()=>{r.invalidateQueries({queryKey:["category-rules"]})}}),N=R({mutationFn:j=>ot(j),onSuccess:(j,$)=>{$?c({count:j.affected_count,applied:!1}):(r.invalidateQueries({queryKey:["transactions"]}),r.invalidateQueries({queryKey:["analytics"]}),c({count:j.affected_count,applied:!0}))}}),F=j=>{confirm(t("confirmDelete"))&&(i(j),w.mutate(j))},W=()=>{u.trim()&&_.mutate({keyword:u.trim(),category:l,match_type:n,priority:10})},Q=j=>{_.mutate({keyword:j.keyword,category:j.suggested_category,match_type:"contains",priority:10})};return C?e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("categoryRules.title")})]}),e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{size:"md"})})]}):e.jsxs(G,{title:t("categoryRules.title"),badge:(f==null?void 0:f.length)||0,children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!f||f.length===0)&&e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>q.mutate(),disabled:q.isPending,children:[e.jsx(nt,{className:"w-4 h-4 mr-1"}),q.isPending?t("loading"):t("categoryRules.seedDefaults")]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>h(!x),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),t("categoryRules.addRule")]})]}),x&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:t("categoryRules.keyword"),value:u,onChange:j=>k(j.target.value),className:p("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),e.jsx("select",{value:l,onChange:j=>o(j.target.value),className:p("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:ut.map(j=>e.jsx("option",{value:j,children:j},j))}),e.jsxs("select",{value:n,onChange:j=>b(j.target.value),className:p("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[e.jsx("option",{value:"contains",children:t("categoryRules.contains")}),e.jsx("option",{value:"starts_with",children:t("categoryRules.startsWith")}),e.jsx("option",{value:"exact",children:t("categoryRules.exact")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>h(!1),children:t("cancel")}),e.jsx(S,{size:"sm",onClick:W,disabled:!u.trim()||_.isPending,children:_.isPending?t("saving"):t("save")})]})]}),f&&f.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-6",children:f.map(j=>e.jsxs("div",{className:p("flex items-center justify-between p-3 rounded-lg border",j.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:j.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:j.category}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",t(mt[j.match_type]),")"]})]}),e.jsx("button",{onClick:()=>F(j.id),disabled:a===j.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:a===j.id?e.jsx(K,{size:"sm"}):e.jsx(se,{className:"w-4 h-4"})})]},j.id))}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("categoryRules.applyDescription")}),m&&e.jsx("p",{className:p("text-sm mt-1",m.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:m.applied?t("categoryRules.appliedCount",{count:m.count}):t("categoryRules.previewCount",{count:m.count})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>N.mutate(!0),disabled:N.isPending,children:N.isPending?t("loading"):t("categoryRules.preview")}),e.jsxs(S,{size:"sm",onClick:()=>N.mutate(!1),disabled:N.isPending||(m==null?void 0:m.count)===0,children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),t("categoryRules.applyNow")]})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("categoryRules.noRules")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("categoryRules.noRulesDescription")})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[e.jsx("button",{onClick:()=>y(!s),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:t(s?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),s&&e.jsx("div",{className:"mt-4 space-y-2",children:T?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(K,{size:"sm"})}):v&&v.length>0?v.map((j,$)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:j.keyword}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:j.suggested_category}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",j.count,"x)"]})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>Q(j),disabled:_.isPending,children:e.jsx(re,{className:"w-4 h-4"})})]},$)):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:t("categoryRules.noSuggestions")})})]})]})}const yt=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function pt({isOpen:t,onClose:r,defaultType:a="expense",onCreated:i}){const{t:x}=E("common"),h=Oe(),[s,y]=g.useState(""),[m,c]=g.useState("ðŸ“"),[u,k]=g.useState(a),[l,o]=g.useState(""),n=async C=>{var T,w;C.preventDefault(),o("");const v=s.trim();if(!v){o(x("category.errors.nameRequired","Name is required"));return}try{const q=`custom_${(await h.mutateAsync({name:v,icon:m,type:u})).id}`;i==null||i(q),b()}catch(_){o(((w=(T=_.response)==null?void 0:T.data)==null?void 0:w.detail)||x("category.errors.createFailed","Failed to create category"))}},b=()=>{y(""),c("ðŸ“"),k(a),o(""),r()};if(!t)return null;const f=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:b}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:x("category.createTitle","Create Category")}),e.jsx("button",{onClick:b,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ne,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("category.name","Category Name")}),e.jsx("input",{type:"text",value:s,onChange:C=>y(C.target.value),placeholder:x("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:yt.map(C=>e.jsx("button",{type:"button",onClick:()=>c(C),className:p("w-8 h-8 text-lg rounded flex items-center justify-center",m===C?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:C},C))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("category.type","Type")}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>k("expense"),className:p("flex-1 py-2 rounded-md text-sm font-medium transition-colors",u==="expense"?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:x("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>k("income"),className:p("flex-1 py-2 rounded-md text-sm font-medium transition-colors",u==="income"?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:x("transaction.income","Income")})]})]}),l&&e.jsx("p",{className:"text-sm text-red-500",children:l}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:b,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:x("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:h.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:h.isPending?"...":x("create","Create")})]})]})]})]});return typeof document>"u"?null:Y.createPortal(f,document.body)}const ht=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function bt({isOpen:t,onClose:r,category:a}){const{t:i}=E("common"),x=O(),[h,s]=g.useState(""),[y,m]=g.useState("ðŸ“"),[c,u]=g.useState(""),[k,l]=g.useState(null);g.useEffect(()=>{a&&(s(a.name),m(a.icon),u(""),l(null))},[a]);const o=R({mutationFn:v=>We(a.id,v),onSuccess:v=>{l(v.affected_transactions),x.invalidateQueries({queryKey:["categories"]}),x.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{b()},1500)},onError:v=>{var w,_;u(((_=(w=v.response)==null?void 0:w.data)==null?void 0:_.detail)||i("category.errors.updateFailed","Failed to update category"))}}),n=async v=>{v.preventDefault(),u("");const T=h.trim();if(!T){u(i("category.errors.nameRequired","Name is required"));return}const w={};if(T!==(a==null?void 0:a.name)&&(w.name=T),y!==(a==null?void 0:a.icon)&&(w.icon=y),Object.keys(w).length===0){b();return}o.mutate(w)},b=()=>{s(""),m("ðŸ“"),u(""),l(null),r()};if(!t||!a)return null;const f=h.trim()!==a.name,C=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:b}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i("category.editTitle","Edit Category")}),e.jsx("button",{onClick:b,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ne,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),k!==null&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[i("category.updateSuccess","Category updated!"),k>0&&e.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:i("category.transactionsUpdated","{{count}} transactions updated",{count:k})})]})}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.name","Category Name")}),e.jsx("input",{type:"text",value:h,onChange:v=>s(v.target.value),placeholder:i("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),f&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[e.jsx(Z,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:i("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.icon","Icon")}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:ht.map(v=>e.jsx("button",{type:"button",onClick:()=>m(v),className:p("w-8 h-8 text-lg rounded flex items-center justify-center",y===v?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:v},v))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.type","Type")}),e.jsx("div",{className:p("h-10 px-3 flex items-center rounded-lg text-sm font-medium",a.type==="expense"?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:a.type==="expense"?i("transaction.expense","Expense"):i("transaction.income","Income")})]}),c&&e.jsx("p",{className:"text-sm text-red-500",children:c}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:b,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:i("cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:o.isPending||k!==null,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:o.isPending?"...":i("save","Save")})]})]})]})]});return typeof document>"u"?null:Y.createPortal(C,document.body)}function ft(){const{t}=E("common"),{data:r=[],isLoading:a}=Qe(),i=$e(),[x,h]=g.useState(!1),[s,y]=g.useState(null),[m,c]=g.useState(null),u=async o=>{try{await i.mutateAsync(o),c(null)}catch(n){console.error("Failed to delete category:",n)}},k=r.filter(o=>o.type==="expense"),l=r.filter(o=>o.type==="income");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{title:t("settings.categoryManagement"),badge:r.length,children:[a?e.jsx("div",{className:"py-4 text-center text-gray-400",children:t("loading")}):r.length===0?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noCategories")}):e.jsxs("div",{className:"space-y-4",children:[k.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.expense","Expense")}),e.jsx("div",{className:"space-y-2",children:k.map(o=>e.jsx(ee,{category:o,onEdit:()=>y(o),onDelete:()=>c(o.id),isDeleting:i.isPending&&m===o.id,showDeleteConfirm:m===o.id,onConfirmDelete:()=>u(o.id),onCancelDelete:()=>c(null)},o.id))})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t("transaction.income","Income")}),e.jsx("div",{className:"space-y-2",children:l.map(o=>e.jsx(ee,{category:o,onEdit:()=>y(o),onDelete:()=>c(o.id),isDeleting:i.isPending&&m===o.id,showDeleteConfirm:m===o.id,onConfirmDelete:()=>u(o.id),onCancelDelete:()=>c(null)},o.id))})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",onClick:()=>h(!0),children:t("settings.addCategory")})})]}),e.jsx(pt,{isOpen:x,onClose:()=>h(!1)}),e.jsx(bt,{isOpen:!!s,onClose:()=>y(null),category:s})]})}function ee({category:t,onEdit:r,onDelete:a,isDeleting:i,showDeleteConfirm:x,onConfirmDelete:h,onCancelDelete:s}){const{t:y}=E("common");return x?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:y("category.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:y("cancel")}),e.jsx("button",{onClick:h,disabled:i,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:i?"...":y("delete")})]})]}):e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:y("edit"),children:e.jsx(He,{size:16})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:y("delete"),children:e.jsx(se,{size:16})})]})]})}const te=["eth","bsc","polygon"];function jt(){const{t}=E("common"),r=O(),[a,i]=g.useState(!1),[x,h]=g.useState(""),[s,y]=g.useState(""),[m,c]=g.useState(["eth","bsc","polygon"]),[u,k]=g.useState(!1),[l,o]=g.useState("polygon"),[n,b]=g.useState(""),[f,C]=g.useState(""),[v,T]=g.useState(""),[w,_]=g.useState(null),{data:q,isLoading:N}=I({queryKey:["crypto-wallets"],queryFn:Ke}),{data:F,isLoading:W}=I({queryKey:["reward-contracts"],queryFn:Le}),Q=R({mutationFn:De,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),i(!1),ge()}}),j=R({mutationFn:Me,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]})}}),$=R({mutationFn:Ee,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),r.invalidateQueries({queryKey:["dashboard-summary"]}),_(null)},onError:()=>{_(null)}}),U=R({mutationFn:Fe,onSuccess:()=>{r.invalidateQueries({queryKey:["reward-contracts"]}),k(!1),me()}}),de=R({mutationFn:Ae,onSuccess:()=>{r.invalidateQueries({queryKey:["reward-contracts"]})}}),ge=()=>{h(""),y(""),c(["eth","bsc","polygon"])},me=()=>{o("polygon"),b(""),C(""),T("")},ue=()=>{if(!x||!x.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}Q.mutate({wallet_address:x,label:s||void 0,chains:m})},xe=d=>{_(d),$.mutate(d)},ye=()=>{if(!n||!n.match(/^0x[a-fA-F0-9]{40}$/)){alert(t("crypto.invalidAddress"));return}U.mutate({chain_id:l,contract_address:n,label:f||void 0,token_symbol:v||void 0})},pe=d=>{c(L=>L.includes(d)?L.filter(he=>he!==d):[...L,d])};return N||W?e.jsx(M,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.wallets")}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>i(!a),children:t(a?"cancel":"crypto.addWallet")})]}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(D,{label:t("crypto.walletAddress"),placeholder:"0x...",value:x,onChange:d=>h(d.target.value)}),e.jsx(D,{label:t("crypto.walletLabel"),placeholder:t("crypto.labelPlaceholder"),value:s,onChange:d=>y(d.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:te.map(d=>e.jsxs("button",{type:"button",onClick:()=>pe(d),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${m.includes(d)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[d].icon," ",A[d].name]},d))})]}),e.jsx(S,{onClick:ue,disabled:Q.isPending,className:"w-full",children:Q.isPending?t("loading"):t("crypto.addWallet")})]}),e.jsx("div",{className:"space-y-3",children:q&&q.length>0?q.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:d.label||t("crypto.unnamedWallet")}),e.jsx("div",{className:"flex gap-1",children:d.chains.map(L=>e.jsx("span",{title:A[L].name,children:A[L].icon},L))})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:d.wallet_address})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>xe(d.id),disabled:w===d.id,children:w===d.id?e.jsx(K,{size:"sm"}):t("crypto.sync")}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteWallet"))&&j.mutate(d.id)},className:"text-red-600 hover:text-red-700 text-sm",children:t("delete")})]})]},d.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noWallets")})})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("crypto.rewardContracts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("crypto.rewardContractsDescription")})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>k(!u),children:t(u?"cancel":"crypto.addContract")})]}),u&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.chain")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:te.map(d=>e.jsxs("button",{type:"button",onClick:()=>o(d),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${l===d?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[A[d].icon," ",A[d].name]},d))})]}),e.jsx(D,{label:t("crypto.contractAddress"),placeholder:"0x...",value:n,onChange:d=>b(d.target.value)}),e.jsx(D,{label:t("crypto.contractLabel"),placeholder:t("crypto.contractLabelPlaceholder"),value:f,onChange:d=>C(d.target.value)}),e.jsx(D,{label:t("crypto.tokenSymbol"),placeholder:"STEER",value:v,onChange:d=>T(d.target.value)}),e.jsx(S,{onClick:ye,disabled:U.isPending,className:"w-full",children:U.isPending?t("loading"):t("crypto.addContract")})]}),e.jsx("div",{className:"space-y-3",children:F&&F.length>0?F.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{title:A[d.chain_id].name,children:A[d.chain_id].icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:d.label||t("crypto.unnamedContract")}),d.token_symbol&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:d.token_symbol})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:d.contract_address})]}),e.jsx("button",{onClick:()=>{confirm(t("crypto.confirmDeleteContract"))&&de.mutate(d.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:t("delete")})]},d.id)):e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("crypto.noContracts")})})]})]})}const kt=({checked:t,defaultChecked:r=!1,onChange:a,disabled:i=!1,className:x})=>{const[h,s]=fe.useState(r),y=t!==void 0,m=y?t:h,c=()=>{if(i)return;const u=!m;y||s(u),a==null||a(u)};return e.jsx("button",{type:"button",role:"switch","aria-checked":m,disabled:i,onClick:c,className:X("relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",m?"bg-blue-600":"bg-gray-200 dark:bg-gray-700",i&&"opacity-50 cursor-not-allowed",x),children:e.jsx("span",{className:X("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-sm",m?"translate-x-6":"translate-x-1")})})};function vt(){const{t}=E("common"),r=O(),{data:a,isLoading:i,error:x}=I({queryKey:["anomalyConfig"],queryFn:ke}),h=R({mutationFn:l=>je(l),onSuccess:()=>{r.invalidateQueries({queryKey:["anomalyConfig"]})}}),[s,y]=g.useState({sensitivity:"medium",large_transaction_threshold:1e4,unusual_spending_percent:50,recurring_change_percent:20,duplicate_charge_hours:24,enabled_types:["large_transaction","category_shift","duplicate"]});g.useEffect(()=>{a&&y({sensitivity:a.sensitivity,large_transaction_threshold:a.large_transaction_threshold,unusual_spending_percent:a.unusual_spending_percent,recurring_change_percent:a.recurring_change_percent,duplicate_charge_hours:a.duplicate_charge_hours,enabled_types:a.enabled_types||["large_transaction","category_shift","duplicate"]})},[a]);const m=()=>{h.mutate(s)},c=l=>{y(o=>{const n=o.enabled_types||[],b=n.includes(l)?n.filter(f=>f!==l):[...n,l];return{...o,enabled_types:b}})},u=[{key:"large_transaction",label:t("anomaly.type.large_transaction")},{key:"category_shift",label:t("anomaly.type.category_shift")},{key:"duplicate",label:t("anomaly.type.duplicate")},{key:"recurring_change",label:t("anomaly.type.recurring_change")},{key:"ml_detected",label:t("anomaly.type.ml_detected")}],k=[{value:"low",label:t("anomaly.config.sensitivityOptions.low")},{value:"medium",label:t("anomaly.config.sensitivityOptions.medium")},{value:"high",label:t("anomaly.config.sensitivityOptions.high")}];return i?e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded"})]})}):x?e.jsxs(M,{className:"p-6 text-center text-gray-500",children:[e.jsx(Z,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:t("common.noData")})]}):e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(H,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:t("anomaly.config.title")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{label:t("anomaly.config.sensitivity"),value:s.sensitivity,onChange:l=>y({...s,sensitivity:l.target.value}),options:k}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(D,{type:"number",label:t("anomaly.config.largeTransactionThreshold"),value:s.large_transaction_threshold,onChange:l=>y({...s,large_transaction_threshold:parseInt(l.target.value)||0})}),e.jsx(D,{type:"number",label:t("anomaly.config.unusualSpendingPercent"),value:s.unusual_spending_percent,onChange:l=>y({...s,unusual_spending_percent:parseInt(l.target.value)||0})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(D,{type:"number",label:t("anomaly.config.recurringChangePercent"),value:s.recurring_change_percent,onChange:l=>y({...s,recurring_change_percent:parseInt(l.target.value)||0})}),e.jsx(D,{type:"number",label:t("anomaly.config.duplicateChargeHours"),value:s.duplicate_charge_hours,onChange:l=>y({...s,duplicate_charge_hours:parseInt(l.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:t("anomaly.config.enabledTypes")}),e.jsx("div",{className:"space-y-3",children:u.map(l=>{const o=(s.enabled_types||[]).includes(l.key);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l.label}),e.jsx(kt,{checked:o,onChange:()=>c(l.key)})]},l.key)})})]}),e.jsx(S,{onClick:m,disabled:h.isPending,className:"w-full",children:h.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"â³"}),t("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4"}),t("anomaly.config.save")]})}),h.isSuccess&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 text-center",children:t("anomaly.config.saved")})]})]})}const V={async getNotifications(t){const r=new URLSearchParams;return t!=null&&t.unreadOnly&&r.append("unread_only","true"),t!=null&&t.limit&&r.append("limit",String(t.limit)),t!=null&&t.offset&&r.append("offset",String(t.offset)),t!=null&&t.type&&r.append("type",t.type),(await P.get(`/api/notifications?${r}`)).data},async getUnreadCount(){return(await P.get("/api/notifications/unread/count")).data},async markAsRead(t){return(await P.put(`/api/notifications/${t}/read`,{})).data},async markAllAsRead(){return(await P.put("/api/notifications/read-all",{})).data},async deleteNotification(t){return(await P.delete(`/api/notifications/${t}`)).data},async cleanupOldNotifications(t=30){return(await P.post("/api/notifications/cleanup",{days_old:t})).data},async getPreferences(){return(await P.get("/api/notifications/preferences")).data},async updatePreference(t,r,a){return(await P.put(`/api/notifications/preferences/${t}`,{enabled:r,settings:a})).data},async subscribePush(t){return(await P.post("/api/notifications/push/subscribe",t)).data},async unsubscribePush(){return(await P.post("/api/notifications/push/unsubscribe",{})).data}};function Nt(){return typeof window>"u"?!1:"serviceWorker"in navigator&&"PushManager"in window}async function wt(){return typeof window>"u"?"denied":await Notification.requestPermission()}function Ct(){return""}function _t(){const{t}=E("common"),r=O(),[a,i]=g.useState(!1),[x,h]=g.useState(!1),{data:s,isLoading:y}=I({queryKey:["notification-preferences"],queryFn:V.getPreferences}),m=R({mutationFn:({channel:n,enabled:b,settings:f})=>V.updatePreference(n,b,f),onSuccess:()=>{r.invalidateQueries({queryKey:["notification-preferences"]})}}),c=(s==null?void 0:s.preferences)||[];g.useEffect(()=>{(async()=>{if(Nt()){const b=await Notification.permission;i(b==="granted")}})()},[]);const u=(n,b)=>{m.mutate({channel:n,enabled:!b})},k=async()=>{h(!0);try{if(await wt()==="granted"&&(i(!0),"serviceWorker"in navigator&&"PushManager"in window)){const f=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ct()});await V.subscribePush(f.toJSON())}}catch(n){console.error("Failed to enable push notifications:",n)}finally{h(!1)}},l=n=>c.find(b=>b.channel===n),o=[{id:"push",icon:st,label:t("notifications.channels.push"),description:t("notifications.channels.pushDescription"),getEnabled:()=>a,onToggle:k},{id:"email",icon:Ue,label:t("notifications.channels.email"),description:t("notifications.channels.emailDescription"),getEnabled:()=>{var n;return((n=l("email"))==null?void 0:n.enabled)??!0},onToggle:()=>{var n;return u("email",((n=l("email"))==null?void 0:n.enabled)??!0)}},{id:"in_app",icon:ie,label:t("notifications.channels.inApp"),description:t("notifications.channels.inAppDescription"),getEnabled:()=>{var n;return((n=l("in_app"))==null?void 0:n.enabled)??!0},onToggle:()=>{var n;return u("in_app",((n=l("in_app"))==null?void 0:n.enabled)??!0)}}];return y?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{size:"lg"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(H,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t("notifications.channels.title")})]}),e.jsx("div",{className:"space-y-4",children:o.map(n=>{const b=n.icon,f=n.getEnabled();return e.jsxs("div",{className:p("flex items-center justify-between p-3 rounded-lg border transition-colors",f?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:p("p-2 rounded-lg",f?"bg-green-100 dark:bg-green-900/50":"bg-gray-200 dark:bg-gray-600"),children:e.jsx(b,{className:p("w-5 h-5",f?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n.label}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n.description})]})]}),e.jsx("button",{onClick:n.onToggle,disabled:n.id==="push"&&x,className:p("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",f?"bg-green-500":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:p("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",f?"translate-x-6":"translate-x-1")})})]},n.id)})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.types.title")}),e.jsx("div",{className:"space-y-3",children:[{key:"budget_alert",label:t("notifications.types.budget")},{key:"bill_reminder",label:t("notifications.types.bills")},{key:"anomaly_detected",label:t("notifications.types.anomalies")},{key:"goal_milestone",label:t("notifications.types.goals")},{key:"savings_tip",label:t("notifications.types.savings")},{key:"burn_rate_warning",label:t("notifications.types.burnRate")}].map(n=>{const b=l(n.key),f=(b==null?void 0:b.enabled)??!0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:n.label}),e.jsx("button",{onClick:()=>u(n.key,!f),className:p("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",f?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:p("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",f?"translate-x-6":"translate-x-1")})})]},n.key)})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t("notifications.quietHours.title")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("notifications.quietHours.description")})}),e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),t("notifications.quietHours.configure")]})]})]})]})}function St(){const{t}=E("common"),{theme:r,setTheme:a,accentColor:i,setAccentColor:x,tier:h,setTier:s}=Ne(),y=[{id:"light",icon:we,label:t("appearance.light","Light")},{id:"dark",icon:Ce,label:t("appearance.dark","Dark")},{id:"system",icon:Ye,label:t("appearance.system","System")}],m=[{id:"pro",icon:Ve,label:t("appearance.pro","Pro"),desc:t("appearance.proDesc","Full access, all items visible")},{id:"lite",icon:Be,label:t("appearance.lite","Lite"),desc:t("appearance.liteDesc","Simplified view, fewer items per page")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.themeMode","Theme Mode")}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:y.map(({id:c,icon:u,label:k})=>e.jsxs("button",{onClick:()=>a(c),className:p("flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all",r===c?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsx(u,{className:p("w-5 h-5",r===c?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400")}),e.jsx("span",{className:p("text-xs font-medium",r===c?"text-primary-700 dark:text-primary-300":"text-gray-600 dark:text-gray-400"),children:k})]},c))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.accentColor","Accent Color")}),e.jsx("div",{className:"flex flex-wrap gap-3",children:_e.map(c=>e.jsxs("button",{onClick:()=>x(c.id),className:"group flex flex-col items-center gap-1.5",title:c.label,children:[e.jsx("div",{className:p("w-10 h-10 rounded-full transition-all ring-offset-2 ring-offset-white dark:ring-offset-gray-900",i===c.id?"ring-2 ring-gray-900 dark:ring-white scale-110":"ring-1 ring-gray-200 dark:ring-gray-700 group-hover:scale-105"),style:{backgroundColor:c.preview}}),e.jsx("span",{className:p("text-[10px] font-medium",i===c.id?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-500"),children:c.label})]},c.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t("appearance.displayMode","Display Mode")}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:m.map(({id:c,icon:u,label:k,desc:l})=>e.jsxs("button",{onClick:()=>s(c),className:p("flex flex-col items-start gap-2 p-4 rounded-xl border-2 transition-all text-left",h===c?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:p("w-4 h-4",h===c?"text-primary-600 dark:text-primary-400":"text-gray-500")}),e.jsx("span",{className:p("text-sm font-semibold",h===c?"text-primary-700 dark:text-primary-300":"text-gray-700 dark:text-gray-300"),children:k})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:l})]},c))})]})]})}const Pt=[{id:"appearance",labelKey:"settings.sections.appearance",icon:oe},{id:"general",labelKey:"settings.sections.general",icon:H},{id:"budget",labelKey:"settings.sections.budget",icon:le},{id:"categories",labelKey:"settings.sections.categories",icon:J},{id:"sources",labelKey:"settings.sections.sources",icon:Pe},{id:"recurring",labelKey:"settings.sections.recurring",icon:Xe},{id:"notifications",labelKey:"settings.sections.notifications",icon:ie},{id:"crypto",labelKey:"settings.sections.crypto",icon:Te},{id:"anomaly",labelKey:"anomaly.title",icon:Z}];function Tt(){var _,q;const{t}=E("common"),r=O(),[a,i]=g.useState("appearance"),[x,h]=g.useState(!1),{data:s,isLoading:y}=I({queryKey:["settings"],queryFn:qe}),[m,c]=g.useState("JPY"),[u,k]=g.useState(25),[l,o]=g.useState(!1),[n,b]=g.useState(!0),[f,C]=g.useState(1e6);g.useEffect(()=>{s&&(c(s.currency),k(s.base_date),o(s.budget_carry_over),b(s.budget_email_alerts),C(s.large_transaction_threshold))},[s]),g.useEffect(()=>{if(s){const N=m!==s.currency||u!==s.base_date||l!==s.budget_carry_over||n!==s.budget_email_alerts||f!==s.large_transaction_threshold;h(N)}},[m,u,l,n,f,s]);const v=R({mutationFn:Se,onSuccess:()=>{r.invalidateQueries({queryKey:["settings"]}),r.invalidateQueries({queryKey:["dashboard-summary"]}),r.invalidateQueries({queryKey:["transactions"]}),r.invalidateQueries({queryKey:["analytics"]}),h(!1)},onError:N=>{console.error("Failed to save settings:",N)}}),T=()=>{v.mutate({currency:m,base_date:u,budget_carry_over:l,budget_email_alerts:n,large_transaction_threshold:f})};if(y)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(K,{size:"lg"})});const w={JPY:t("settings.currencyJPY"),USD:t("settings.currencyUSD"),VND:t("settings.currencyVND")};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-primary-600"}),t("settings.title")]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:t("settings.subtitle")})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto py-2 scrollbar-hide -mb-2",children:Pt.map(N=>{const F=N.icon,W=a===N.id;return e.jsxs("button",{onClick:()=>i(N.id),className:p("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",W?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(F,{className:"w-3.5 h-3.5"}),t(N.labelKey)]},N.id)})})})})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx("div",{className:p("space-y-4",a!=="appearance"&&"hidden"),children:e.jsx(B,{icon:oe,title:t("appearance.title","Appearance"),description:t("appearance.subtitle","Theme, colors, and display preferences"),children:e.jsx(St,{})})}),e.jsx("div",{className:p("space-y-4",a!=="general"&&"hidden"),children:e.jsx(B,{icon:H,title:t("settings.general"),description:"Currency and basic preferences",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{label:t("settings.currency"),value:m,onChange:N=>c(N.target.value),options:[{value:"JPY",label:w.JPY},{value:"USD",label:w.USD},{value:"VND",label:w.VND}]}),e.jsx(D,{type:"number",label:t("settings.payday"),value:u,onChange:N=>k(parseInt(N.target.value,10)),min:1,max:31}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 -mt-2",children:t("settings.paydayDescription")})]})})}),e.jsx("div",{className:p("space-y-4",a!=="budget"&&"hidden"),children:e.jsx(B,{icon:le,title:t("settings.budgetSettings"),description:"Budget behavior and alerts",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{label:t("settings.budgetCarryOver"),description:t("settings.budgetCarryOverDescription"),checked:l,onChange:o}),e.jsx(ae,{label:t("settings.budgetEmailAlerts"),description:t("settings.budgetEmailAlertsDescription"),checked:n,onChange:b}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block mb-2",children:t("settings.largeTransactionThreshold")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t("settings.largeTransactionThresholdDescription")}),e.jsx(D,{type:"number",value:f,onChange:N=>C(parseInt(N.target.value,10)||0),min:0,step:1e5}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:t("settings.largeTransactionThresholdHint")})]})]})})}),e.jsx("div",{className:p("space-y-4",a!=="categories"&&"hidden"),children:e.jsx(ft,{})}),e.jsx("div",{className:p("space-y-4",a!=="sources"&&"hidden"),children:e.jsxs(G,{title:t("settings.paymentSourceManagement"),badge:((_=s==null?void 0:s.sources)==null?void 0:_.length)||0,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:((q=s==null?void 0:s.sources)==null?void 0:q.map((N,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:N}),e.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:t("settings.delete")})]},F)))||e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:t("settings.noSources")})}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{variant:"outline",children:t("settings.addSource")})})]})}),e.jsx("div",{className:p("space-y-4",a!=="recurring"&&"hidden"),children:e.jsx(ze,{})}),e.jsx("div",{className:p("space-y-4",a!=="notifications"&&"hidden"),children:e.jsx(_t,{})}),e.jsx("div",{className:p("space-y-4",a!=="crypto"&&"hidden"),children:e.jsx(jt,{})}),e.jsx("div",{className:p("space-y-4",a!=="anomaly"&&"hidden"),children:e.jsx(vt,{})}),e.jsx(xt,{})]}),x&&typeof document<"u"&&Y.createPortal(e.jsx("div",{className:"fixed bottom-20 left-0 right-0 p-4 bg-white/90 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-gray-700 z-40",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(S,{onClick:T,disabled:v.isPending,className:"w-full",size:"lg",children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:"sm",className:"mr-2"}),t("saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),t("settings.saveSettings")]})})})}),document.body)]})}function B({icon:t,title:r,description:a,children:i,className:x}){return e.jsxs(M,{className:p("",x),children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:e.jsx(t,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r}),a&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]})]}),i]})}function ae({label:t,description:r,checked:a,onChange:i}){return e.jsxs("div",{className:"flex items-start justify-between py-1",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white block",children:t}),r&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:r})]}),e.jsx("button",{onClick:()=>i(!a),className:p("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",a?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("span",{className:p("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",a?"translate-x-6":"translate-x-1")})})]})}const Qt=Re("/settings")({component:Tt});export{Qt as Route};
