import{a as ie,j as e,A as b,S as xt,r as l,R as mt,u as K,E as gt,X as Ne,y as Ue,G as Be,H as he,J as ht,K as He,B as f,I as ce,M as yt,N as de,O as we,P as pt,Q as ft,V as bt,W as Ce,Y as jt,_ as vt,$ as kt,a0 as Ee,a1 as ke,C as Q,s as Ve,a2 as We,a3 as Nt,a4 as wt,a5 as Ct,g as St,a6 as Mt,a7 as Dt,a8 as Ae,a9 as Tt,aa as Rt,ab as Lt,ac as Pt,ad as zt,ae as At,af as Et,c as _t}from"./index-CeIjqT8j.js";import{S as ye}from"./Select-z5aRGWvn.js";import{g as Qe,H as Ot,u as Ft,a as It,T as $t,R as Yt}from"./TransactionFormModal-CuxAruOB.js";import{D as qt}from"./download-DVB9cqDE.js";import{T as Ut}from"./tag-DlFf8neF.js";import{E as Bt}from"./external-link-BW6ihPEf.js";import{C as Ht}from"./chevron-down-NxYWKU8k.js";import"./recurring-service-DtzLohSz.js";import"./useCategories-De2iPPdj.js";import"./RecurringOptions-BNugIcyt.js";import"./useXPGain-DwfXP-ew.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Wt=ie("arrow-left",Vt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Kt=ie("file-text",Qt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Xt=ie("funnel",Jt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Gt=ie("square-pen",Zt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ta=ie("zoom-in",ea);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],sa=ie("zoom-out",aa);function ra({icon:t,title:i,description:o,action:r,className:c,compact:s=!1}){return e.jsxs("div",{className:b("flex flex-col items-center justify-center px-4",s?"py-6":"py-12",c),children:[t?e.jsx("div",{className:b("flex items-center justify-center rounded-2xl bg-gray-100 dark:bg-gray-800",s?"w-12 h-12 mb-3":"w-16 h-16 mb-4"),children:e.jsx("div",{className:b("text-gray-400 dark:text-gray-500",s?"[&>svg]:w-6 [&>svg]:h-6":"[&>svg]:w-8 [&>svg]:h-8"),children:t})}):e.jsx("div",{className:b("flex items-center justify-center rounded-2xl bg-gray-100 dark:bg-gray-800",s?"w-12 h-12 mb-3":"w-16 h-16 mb-4"),children:e.jsx(xt,{className:b("text-gray-400 dark:text-gray-500",s?"w-6 h-6":"w-8 h-8")})}),e.jsx("h3",{className:b("font-semibold text-gray-700 dark:text-gray-300 text-center",s?"text-sm mb-1.5":"text-base mb-2"),children:i}),o&&e.jsx("p",{className:b("text-gray-500 dark:text-gray-400 text-center max-w-sm",s?"text-xs mb-4":"text-sm mb-6"),children:o}),r&&e.jsx("div",{children:r})]})}function na({label:t,options:i,selected:o,onChange:r,placeholder:c}){const[s,m]=l.useState(!1),u=l.useRef(null);l.useEffect(()=>{function h(C){u.current&&!u.current.contains(C.target)&&m(!1)}return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const y=h=>{o.includes(h)?r(o.filter(C=>C!==h)):r([...o,h])},g=o.length>0?`${o.length} selected`:c||"Select...";return e.jsxs("div",{ref:u,className:"relative w-full",children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t}),e.jsxs("button",{type:"button",onClick:()=>m(!s),className:b("w-full px-4 py-2 border rounded-lg text-left flex justify-between items-center","bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"),children:[e.jsx("span",{className:o.length===0?"text-gray-500":"",children:g}),e.jsx("svg",{className:b("w-4 h-4 transition-transform",s&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:i.map(h=>e.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.includes(h.value),onChange:()=>y(h.value),className:"mr-3 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:h.label})]},h.value))})]})}function la({onRefresh:t,threshold:i=80,disabled:o=!1}){const[r,c]=l.useState(0),[s,m]=l.useState(!1),[u,y]=l.useState(!1),g=l.useRef(0),h=l.useRef(0),C=l.useCallback(M=>{o||s||M.currentTarget.scrollTop>0||(g.current=M.touches[0].clientY,y(!0))},[o,s]),k=l.useCallback(M=>{if(!u||o||s)return;h.current=M.touches[0].clientY;const N=h.current-g.current;N>0&&c(Math.min(N*.4,i*1.5))},[u,o,s,i]),S=l.useCallback(async()=>{if(!(!u||o))if(y(!1),r>=i&&!s){m(!0),c(i);try{await t()}finally{m(!1),c(0)}}else c(0)},[u,o,r,i,s,t]);return l.useEffect(()=>()=>{c(0),m(!1),y(!1)},[]),{pullDistance:r,isRefreshing:s,isPulling:u,handlers:{onTouchStart:C,onTouchMove:k,onTouchEnd:S}}}function oa({children:t,onRefresh:i,disabled:o=!1,className:r}){const{pullDistance:c,isRefreshing:s,handlers:m}=la({onRefresh:i,threshold:80,disabled:o}),u=Math.min(c/80,1),y=c>10||s;return e.jsxs("div",{className:b("relative overflow-auto",r),...m,children:[e.jsx("div",{className:b("absolute left-1/2 -translate-x-1/2 z-10 transition-opacity duration-200",y?"opacity-100":"opacity-0"),style:{top:Math.max(c-40,8)},children:e.jsx("div",{className:b("flex items-center justify-center w-10 h-10 rounded-full","bg-white dark:bg-gray-800 shadow-lg","border border-gray-200 dark:border-gray-700"),children:e.jsx(mt,{size:20,className:b("text-primary-600 transition-transform",s&&"animate-spin"),style:{transform:s?void 0:`rotate(${u*360}deg)`}})})}),e.jsx("div",{style:{transform:`translateY(${c}px)`,transition:c===0?"transform 0.2s ease-out":"none"},children:t})]})}function ca({receiptUrl:t,onClose:i}){const{t:o}=K(),[r,c]=l.useState(1),s=Qe(t);if(!s)return null;const m=()=>c(g=>Math.min(g+.25,3)),u=()=>c(g=>Math.max(g-.25,.5)),y=()=>{const g=document.createElement("a");g.href=s,g.download=`receipt-${Date.now()}.jpg`,g.click()};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:g=>{g.target===g.currentTarget&&i()},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsxs("h2",{className:"text-white font-medium flex items-center gap-2",children:[e.jsx(gt,{size:20}),o("receipt.viewReceipt","View Receipt")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:u,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":o("zoomOut","Zoom out"),children:e.jsx(sa,{size:20})}),e.jsxs("span",{className:"text-white text-sm w-12 text-center",children:[Math.round(r*100),"%"]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":o("zoomIn","Zoom in"),children:e.jsx(ta,{size:20})}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":o("download","Download"),children:e.jsx(qt,{size:20})}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":o("close","Close"),children:e.jsx(Ne,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center p-4",children:e.jsx("img",{src:s,alt:"Receipt",className:"max-w-full max-h-full object-contain transition-transform duration-200",style:{transform:`scale(${r})`}})})]})}function ia({isOpen:t,onClose:i,transaction:o}){const{t:r}=K("common"),c=Ue(),{data:s=[]}=Be(),[m,u]=l.useState(""),[y,g]=l.useState(""),[h,C]=l.useState(""),[k,S]=l.useState(""),[M,N]=l.useState("JPY"),[w,D]=l.useState(""),[T,L]=l.useState(null),[R,J]=l.useState("expense"),[ae,X]=l.useState(!1),[I,U]=l.useState(null),[Z,$]=l.useState(null),[B,P]=l.useState(null),[p,O]=l.useState(!1),[se,H]=l.useState(!1),z=l.useRef(null),A=[{value:"JPY",label:"¥ JPY"},{value:"USD",label:"$ USD"},{value:"VND",label:"₫ VND"}],ue=x=>{const j=x.replace(/[^\d]/g,"");return j?Number(j).toLocaleString():""},Y=x=>{const j=x.target.value.replace(/[^\d]/g,"");C(j),S(ue(j))},G=he({mutationFn:x=>ht(o.id,x),onSuccess:()=>{c.invalidateQueries({queryKey:["transactions"]}),c.invalidateQueries({queryKey:["dashboard"]}),c.invalidateQueries({queryKey:["analytics"]}),i()}}),V=he({mutationFn:()=>He(o.id),onSuccess:()=>{c.invalidateQueries({queryKey:["transactions"]}),c.invalidateQueries({queryKey:["dashboard"]}),c.invalidateQueries({queryKey:["analytics"]}),i()}});l.useEffect(()=>{if(o&&t){u(o.date),g(o.description);const x=Math.abs(o.amount).toString();C(x),S(ue(x)),N(o.currency||"JPY"),D(o.category),L(o.account_id??null),J(o.type),X(!1),U(o.receipt_url||null),$(null),P(null)}},[o==null?void 0:o.id,t]);const pe=x=>{var E;const j=(E=x.target.files)==null?void 0:E[0];!j||!j.type.startsWith("image/")||($(j),P(URL.createObjectURL(j)))},fe=()=>{$(null),B&&(URL.revokeObjectURL(B),P(null)),U(null),z.current&&(z.current.value="")};l.useEffect(()=>{if(T){const x=s.find(j=>j.id===T);x!=null&&x.currency&&N(x.currency)}},[T,s]);const re=async x=>{x.preventDefault();const j=parseFloat(h);if(isNaN(j))return;const E=s.find(Me=>Me.id===T),be=(E==null?void 0:E.name)||(o==null?void 0:o.source)||"";let ne=I;if(Z){H(!0);try{ne=await Ft(Z)}finally{H(!1)}}G.mutate({date:m,description:y,amount:Math.round(R==="expense"?-Math.abs(j):Math.abs(j)),currency:M,category:w||"Other",source:be,type:R,account_id:T,receipt_url:ne})},ee=()=>{V.mutate()};if(l.useEffect(()=>(t&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[t]),!t||!o)return null;const Se=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:i}),e.jsx("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md max-h-[90dvh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:r("transaction.editTitle")}),ae?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:r("transaction.deleteConfirm")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:o.description}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(f,{variant:"outline",onClick:()=>X(!1),className:"flex-1",children:r("button.cancel")}),e.jsx(f,{variant:"secondary",onClick:ee,disabled:V.isPending,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:V.isPending?"...":r("button.delete")})]})]}):e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsx(ce,{label:r("transaction.date"),type:"date",value:m,onChange:x=>u(x.target.value),required:!0}),e.jsx(ce,{label:r("transaction.description"),value:y,onChange:x=>g(x.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ce,{label:r("transaction.amount"),type:"text",inputMode:"numeric",value:k,onChange:Y,required:!0})}),e.jsx("div",{className:"w-28",children:e.jsx(ye,{label:r("transaction.currency","Currency"),value:M,onChange:x=>N(x.target.value),options:A})})]}),e.jsx(ye,{label:r("transaction.type"),value:R,onChange:x=>J(x.target.value),options:[{value:"income",label:r("transaction.typeIncome")},{value:"expense",label:r("transaction.typeExpense")}]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("transaction.category")}),e.jsx(Ot,{selected:w,onSelect:x=>D(x),isIncome:R==="income"})]}),e.jsx(ye,{label:r("account.account"),value:(T==null?void 0:T.toString())||"",onChange:x=>L(x.target.value?Number(x.target.value):null),options:[{value:"",label:r("account.selectAccount")},...s.map(x=>({value:x.id.toString(),label:x.name}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("receipt.receipt","Receipt")}),e.jsx("input",{ref:z,type:"file",accept:"image/*",capture:"environment",onChange:pe,className:"hidden"}),B||I?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:B||Qe(I)||"",alt:"Receipt",className:"w-full h-20 object-cover cursor-pointer",onClick:()=>!B&&O(!0)}),e.jsx("button",{type:"button",onClick:fe,className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(Ne,{size:14})})]}):e.jsxs("button",{type:"button",onClick:()=>{var x;return(x=z.current)==null?void 0:x.click()},className:"w-full h-10 flex items-center justify-center gap-2 border border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 text-gray-500 dark:text-gray-400 rounded-lg text-sm",children:[e.jsx(yt,{size:16}),r("receipt.attachReceipt","Attach Receipt")]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:i,className:"flex-1",children:r("button.cancel")}),e.jsx(f,{type:"submit",disabled:G.isPending||se,className:"flex-1",children:se?r("receipt.uploading","Uploading..."):G.isPending?"...":r("button.save")})]}),e.jsx("button",{type:"button",onClick:()=>X(!0),className:b("w-full text-center text-sm text-red-600 hover:text-red-700","py-2 transition-colors"),children:r("transaction.deleteTransaction")})]})]})}),p&&I&&e.jsx(ca,{receiptUrl:I,onClose:()=>O(!1)})]});return typeof document<"u"?de.createPortal(Se,document.body):null}function da({transaction:t,isOpen:i,onClose:o,onEdit:r,onDelete:c}){const{t:s}=K("common"),{isPrivacyMode:m}=we(),{data:u}=pt(),[y,g]=l.useState(!1),h=(u==null?void 0:u.rates)||{};if(!i||!t)return null;const C=t.currency||"JPY",k=ft(Math.abs(t.amount),C,h,!0,m),S=()=>{c&&c(t),o()},M=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 animate-in fade-in",onClick:o}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-in zoom-in-95 duration-200",onClick:N=>{N.target===N.currentTarget&&o()},children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-xl shadow-xl w-full max-w-md max-h-[80dvh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-900 z-10",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s("transactions.transactionDetails")}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(Ne,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"text-center py-2",children:[e.jsxs("p",{className:b("text-3xl font-bold font-numbers",t.type==="income"?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"),children:[t.type==="income"?"+":"-",m?"****":k]}),e.jsx("p",{className:b("text-sm font-medium mt-1",t.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:t.type==="income"?s("transactions.income"):s("transactions.expense")})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Kt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("transactions.description")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.description||"-"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Ut,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("transactions.category")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.category})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(bt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("transactions.date")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:Ce(t.date,"MMMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(jt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("transactions.source")}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.source||"-"})]})]})]}),t.receipt_url&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:s("transactions.receipt")}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.receipt_url,alt:"Receipt",className:"w-full h-48 object-cover rounded-lg bg-gray-100 dark:bg-gray-800"}),e.jsx("a",{href:t.receipt_url,target:"_blank",rel:"noopener noreferrer",className:"absolute bottom-2 right-2 p-2 bg-black/50 rounded-lg hover:bg-black/70 transition-colors",children:e.jsx(Bt,{className:"w-4 h-4 text-white"})})]})]})]}),y?e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-3 sticky bottom-0 bg-white dark:bg-gray-900",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 text-center",children:s("transactions.deleteConfirm")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{variant:"outline",className:"flex-1",onClick:()=>g(!1),children:s("cancel")}),e.jsx(f,{variant:"danger",className:"flex-1",onClick:S,children:s("delete")})]})]}):e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 sticky bottom-0 bg-white dark:bg-gray-900",children:[e.jsxs(f,{variant:"outline",className:"flex-1",onClick:()=>r==null?void 0:r(t),children:[e.jsx(Gt,{className:"w-4 h-4 mr-2"}),s("edit")]}),e.jsxs(f,{variant:"danger",className:"flex-1",onClick:()=>g(!0),children:[e.jsx(vt,{className:"w-4 h-4 mr-2"}),s("delete")]})]})]})})]});return de.createPortal(M,document.body)}function ua({onClick:t}){const{t:i}=K("common");return de.createPortal(e.jsx("button",{onClick:t,className:b("fixed bottom-20 right-4 sm:bottom-6 sm:right-6 z-50","w-14 h-14 rounded-full","bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600","text-white shadow-lg","flex items-center justify-center","active:scale-95 transition-all","md:hidden"),"aria-label":i("transaction.addTransaction","Add Transaction"),children:e.jsx(kt,{size:28})}),document.body)}function Ye({transaction:t,onViewDetail:i,onEdit:o,onDelete:r}){const{isPrivacyMode:c}=we(),s=Ee(),[m,u]=l.useState(0),[y,g]=l.useState(!1),[h,C]=l.useState(0),[k,S]=l.useState(!1),M=l.useRef(null),N=l.useRef(null),w=80,D=40,T=500,L=l.useRef(null),R=l.useRef(!1),J=l.useRef(0),ae=p=>{C(p.touches[0].clientX),J.current=p.touches[0].clientY,g(!0),R.current=!1,L.current=setTimeout(()=>{R.current=!0,S(!0)},T)},X=p=>{if(!y)return;const O=p.touches[0].clientX,se=p.touches[0].clientY,H=Math.abs(se-J.current);if(R.current)return;if(H>10){U();return}const z=h-O;z>0?u(Math.min(z,w)):u(Math.max(z,-20))},I=()=>{if(g(!1),R.current){u(0);return}U(),m>D?u(w):u(0)},U=l.useCallback(()=>{L.current&&(clearTimeout(L.current),L.current=null),R.current=!1},[]),Z=()=>{if(R.current){S(!1);return}m>D||i(t)},$=p=>{p.stopPropagation(),r(t)},B=p=>{p.preventDefault(),S(!0)},P=l.useCallback(()=>{S(!1)},[]);return l.useEffect(()=>{const p=O=>{N.current&&!N.current.contains(O.target)&&P()};if(k)return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[k,P]),l.useEffect(()=>{const p=O=>{M.current&&!M.current.contains(O.target)&&u(0)};if(m>0)return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[m]),e.jsxs("div",{ref:M,className:"relative overflow-hidden",children:[k&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:P,children:e.jsx("div",{ref:N,className:"absolute bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden animate-in fade-in zoom-in-95 duration-150 select-none",style:{left:"50%",bottom:"20px",transform:"translateX(-50%)",maxWidth:"280px",width:"calc(100% - 32px)"},onClick:p=>p.stopPropagation(),children:e.jsxs("div",{className:"py-2",children:[e.jsxs("button",{onClick:()=>{o(t),P()},className:"w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-blue-600 dark:text-blue-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Edit"})]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(`${t.description}: ${ke(t.amount,t.type,t.currency||"JPY",s,!1,!1)}`),P()},className:"w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"})}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Copy"})]}),e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsxs("button",{onClick:()=>{r(t),P()},className:"w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-red-600 dark:text-red-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Delete"})]})]})})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center justify-center bg-red-600",style:{width:`${w}px`},children:e.jsxs("button",{onClick:$,className:"h-full w-full flex flex-col items-center justify-center text-white transition-opacity",style:{opacity:m>0?1:0},"aria-label":"Delete transaction",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 mb-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),e.jsx("span",{className:"text-xs font-medium",children:"削除"})]})}),e.jsx("div",{className:"relative",style:{transform:`translateX(-${m}px)`,transition:y?"none":"transform 250ms ease-out"},onTouchStart:ae,onTouchMove:X,onTouchEnd:I,onTouchCancel:U,onClick:Z,onContextMenu:B,children:e.jsxs(Q,{className:"cursor-pointer active:scale-[0.98] transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-50",children:t.description}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Ce(t.date)})]}),e.jsx("p",{className:`text-lg font-bold font-numbers ${t.is_transfer?"text-blue-500 dark:text-blue-400":t.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ke(t.amount,t.type,t.currency||"JPY",s,!0,c)})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(Ve,{children:t.category}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.source})]})]})})]})}function xa({isOpen:t,onClose:i,onConfirm:o,transaction:r,isDeleting:c=!1}){const{t:s}=K("common"),{currency:m}=We(),{isPrivacyMode:u}=we(),y=Ee();if(!t||!r)return null;const g=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:i}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:s("transaction.deleteConfirm","取引を削除しますか？")}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6 space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.description}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:Ce(r.date)}),e.jsx("span",{className:`font-bold font-numbers ${r.type==="income"?"text-green-600":"text-red-600"}`,children:ke(r.amount,r.type,m,y,!1,u)})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:r.category}),e.jsx("span",{children:"-"}),e.jsx("span",{children:r.source})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:s("transaction.deleteWarning","この操作は取り消せません。本当に削除しますか？")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{variant:"outline",onClick:i,disabled:c,className:"flex-1",children:s("button.cancel","キャンセル")}),e.jsx(f,{onClick:o,disabled:c,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:c?"削除中...":s("button.delete","削除")})]})]})]});return typeof document<"u"?de.createPortal(g,document.body):null}function ma({isOpen:t,onClose:i,onConfirm:o,selectedCount:r,isLoading:c}){const{t:s}=K("common"),[m,u]=l.useState(""),y=[{value:"",label:s("transactions.selectCategory","Select category...")},{value:"食費",label:s("category.food","Food")},{value:"住宅",label:s("category.housing","Housing")},{value:"交通",label:s("category.transport","Transport")},{value:"娯楽",label:s("category.entertainment","Entertainment")},{value:"通信",label:s("category.communication","Communication")},{value:"日用品",label:s("category.daily","Daily Necessities")},{value:"医療",label:s("category.medical","Medical")},{value:"教育",label:s("category.education","Education")},{value:"その他",label:s("category.other","Other")}],g=()=>{m&&(o(m),u(""))};if(!t)return null;const h=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:i}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:s("transactions.recategorizeTitle","Change Category")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:s("transactions.recategorizeDescription","Update category for {{count}} transactions",{count:r})}),e.jsx(ye,{label:s("transactions.newCategory","New Category"),value:m,onChange:C=>u(C.target.value),options:y}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(f,{variant:"outline",onClick:i,className:"flex-1",children:s("button.cancel","Cancel")}),e.jsx(f,{onClick:g,disabled:!m||c,className:"flex-1",children:c?s("button.saving","Saving..."):s("button.apply","Apply")})]})]})]});return typeof document<"u"?de.createPortal(h,document.body):null}function ga({isOpen:t,onClose:i,onConfirm:o,selectedCount:r,isDeleting:c}){const{t:s}=K("common");if(!t)return null;const m=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:i}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:s("transactions.bulkDeleteTitle","Delete Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:s("transactions.bulkDeleteConfirm","Are you sure you want to delete {{count}} transactions? This cannot be undone.",{count:r})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{variant:"outline",onClick:i,className:"flex-1",children:s("button.cancel","Cancel")}),e.jsx(f,{variant:"danger",onClick:o,disabled:c,className:"flex-1",children:c?s("button.deleting","Deleting..."):s("button.delete","Delete")})]})]})]});return typeof document<"u"?de.createPortal(m,document.body):null}function ha(t){const i=["Date","Description","Amount","Type","Category","Source"],o=t.map(r=>[r.date,`"${r.description.replace(/"/g,'""')}"`,r.amount.toString(),r.type,r.category,r.source]);return[i.join(","),...o.map(r=>r.join(","))].join(`
`)}function ya(t,i){const o=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(o),c=document.createElement("a");c.href=r,c.download=i,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)}function pa(t,i,o){const r=ha(t),c=i&&o?`${i}_to_${o}`:new Date().toISOString().split("T")[0];ya(r,`smartmoney_transactions_${c}.csv`)}function fa(t,i){const[o,r]=l.useState(t);return l.useEffect(()=>{const c=setTimeout(()=>r(t),i);return()=>clearTimeout(c)},[t,i]),o}function qe(t){const[i,o]=t.split("-").map(Number),r=`${i}-${String(o).padStart(2,"0")}-01`,c=new Date(i,o,0).getDate(),s=`${i}-${String(o).padStart(2,"0")}-${String(c).padStart(2,"0")}`;return{start:r,end:s}}function ba(){const{t}=K("common"),{currency:i}=We(),{isPrivacyMode:o}=we(),r=Ee(),c=Ue(),s=Nt(),m=wt(),{data:u}=Be(),{categories:y,month:g,accountId:h,fromAccounts:C,type:k,action:S}=Ct({from:"/transactions"}),M=y?y.split(",").filter(Boolean):[],N=g?qe(g):m,[w,D]=l.useState({start_date:N.start,end_date:N.end,categories:M,source:"",type:k||"all"}),[T,L]=l.useState(""),R=fa(T,300),[J,ae]=l.useState(""),[X,I]=l.useState(""),[U,Z]=l.useState("thisMonth"),[$,B]=l.useState(!1),P=a=>{const n=new Date;let d,F=n;switch(a){case"today":d=n;break;case"thisWeek":d=new Date(n),d.setDate(n.getDay()-n.getDay());break;case"thisMonth":d=new Date(n.getFullYear(),n.getMonth(),1);break;case"lastMonth":d=new Date(n.getFullYear(),n.getMonth()-1,1),F=new Date(n.getFullYear(),n.getMonth(),0);break;case"last3Months":d=new Date(n.getFullYear(),n.getMonth()-3,1);break;default:d=new Date(n.getFullYear(),n.getMonth(),1)}return{start:d.toISOString().split("T")[0],end:F.toISOString().split("T")[0]}},p=a=>{if(Z(a),a!=="custom"){const n=P(a);D(d=>({...d,start_date:n.start,end_date:n.end}))}},O=(a,n)=>{const d=n?parseFloat(n):void 0;a==="min"?(ae(n),D(F=>({...F,min_amount:d}))):(I(n),D(F=>({...F,max_amount:d})))},se=a=>{D(n=>{const d={...n};return L(""),d.search=void 0,d})},H=a=>{const n=w[a];return a==="categories"?!!(n&&n.length>0):a==="type"?n!=="all":a==="source"?!!n:a==="min_amount"||a==="max_amount"?n!==void 0:!!n},z=[H("categories"),H("source"),H("min_amount"),H("max_amount"),U!=="thisMonth"].filter(Boolean).length,[A,ue]=l.useState("date"),[Y,G]=l.useState("desc"),[V,pe]=l.useState(50),[fe,re]=l.useState(!1),ee=a=>{re(!0),A===a?G(n=>n==="asc"?"desc":"asc"):(ue(a),G("desc")),setTimeout(()=>re(!1),150)},Se=a=>{re(!0);const[n,d]=a.split("-");ue(n),G(d),setTimeout(()=>re(!1),150)};l.useEffect(()=>{D(a=>({...a,search:R||void 0}))},[R]),l.useEffect(()=>{if(y||g||k!==void 0){const a=g?qe(g):m,n=y?y.split(",").filter(Boolean):[];D(d=>({...d,categories:n.length>0?n:d.categories,start_date:a.start,end_date:a.end,type:k||"all"}))}},[y,g,k]);const x=a=>{const n=k===a?void 0:a;s({to:"/transactions",search:d=>({...d,type:n})})},[j,E]=l.useState(null),[be,ne]=l.useState(null),[Me,xe]=l.useState(!1),[je,le]=l.useState(null),[Ke,De]=l.useState(!1),[W,te]=l.useState(new Set),[Je,Te]=l.useState(!1),[Xe,Re]=l.useState(!1),{data:v,isLoading:_e}=St({queryKey:["transactions",w],queryFn:()=>Et(w)});l.useEffect(()=>{te(new Set)},[v]),l.useEffect(()=>{S==="add-transaction"?(xe(!0),s({to:"/transactions",search:a=>({...a,action:void 0})})):S==="scan-receipt"&&(De(!0),s({to:"/transactions",search:a=>({...a,action:void 0})}))},[S,s]),l.useEffect(()=>{const a=()=>{xe(!0)},n=()=>{De(!0)};return window.addEventListener("open-add-transaction-modal",a),window.addEventListener("open-receipt-scanner",n),()=>{window.removeEventListener("open-add-transaction-modal",a),window.removeEventListener("open-receipt-scanner",n)}},[]);const Ze=It(At,"transaction",[["transactions"],["analytics"]]),Ge=a=>{if(!a.amount||!a.category)return;const n=u==null?void 0:u[0],d=(n==null?void 0:n.currency)||"JPY",F=zt(Math.abs(a.amount),d);Ze.mutate({date:a.date||new Date().toISOString().split("T")[0],description:a.merchant||"Receipt Scan",amount:-F,currency:d,category:a.category,source:(n==null?void 0:n.name)||"Unknown",type:"expense"})},et=[{value:"食費",label:t("category.food","Food")},{value:"住宅",label:t("category.housing","Housing")},{value:"交通",label:t("category.transport","Transport")},{value:"娯楽",label:t("category.entertainment","Entertainment")},{value:"通信",label:t("category.communication","Communication")},{value:"日用品",label:t("category.daily","Daily Necessities")},{value:"医療",label:t("category.medical","Medical")},{value:"教育",label:t("category.education","Education")},{value:"その他",label:t("category.other","Other")}],Oe=v&&v.length>0&&v.every(a=>W.has(a.id)),tt=()=>{te(Oe?new Set:new Set((v==null?void 0:v.map(a=>a.id))||[]))},at=a=>{const n=new Set(W);n.has(a)?n.delete(a):n.add(a),te(n)},Fe=he({mutationFn:a=>He(a),onSuccess:()=>{c.invalidateQueries({queryKey:["transactions"]}),c.invalidateQueries({queryKey:["dashboard"]}),c.invalidateQueries({queryKey:["analytics"]}),le(null)}}),Ie=he({mutationFn:()=>Mt(Array.from(W)),onSuccess:()=>{c.invalidateQueries({queryKey:["transactions"]}),c.invalidateQueries({queryKey:["dashboard"]}),c.invalidateQueries({queryKey:["analytics"]}),te(new Set),Re(!1)}}),$e=he({mutationFn:a=>Dt(Array.from(W),a),onSuccess:()=>{c.invalidateQueries({queryKey:["transactions"]}),te(new Set),Te(!1)}}),st=()=>{je&&Fe.mutate(je.id)},rt=()=>{D({start_date:m.start,end_date:m.end,categories:[],source:"",type:"all"}),L(""),Z("thisMonth"),ae(""),I(""),s({to:"/transactions",search:{}})},nt=async()=>{await c.invalidateQueries({queryKey:["transactions"]}),await c.invalidateQueries({queryKey:["dashboard"]}),await c.invalidateQueries({queryKey:["analytics"]})},me=l.useMemo(()=>{if(!v)return[];if(!h)return v;const a=Number(h);return v.filter(n=>n.account_id!=null&&Number(n.account_id)===a)},[v,h]),ge=l.useMemo(()=>!h||!u?null:u.find(a=>a.id===Number(h))||null,[h,u]),Le=(ge==null?void 0:ge.currency)||i,lt={JPY:1,USD:.00667,VND:167},{income:ot,expense:ct,net:it}=l.useMemo(()=>{const a=me,n=(_,q)=>{if(ge)return _;const ut=Pt[q]??0,Pe=_/Math.pow(10,ut);if(q==="JPY")return Pe;const ze=r[q]??lt[q];return!ze||ze===0?Pe:Pe/ze},d=a.filter(_=>_.type==="income"&&!_.is_transfer).reduce((_,q)=>_+n(q.amount,q.currency||"JPY"),0),F=a.filter(_=>_.type==="expense"&&!_.is_transfer).reduce((_,q)=>_+n(Math.abs(q.amount),q.currency||"JPY"),0);return{income:d,expense:F,net:d-F}},[me,ge,r]),ve=l.useMemo(()=>me.length?[...me].sort((a,n)=>{let d=0;switch(A){case"date":d=a.date.localeCompare(n.date);break;case"description":d=a.description.localeCompare(n.description);break;case"category":d=a.category.localeCompare(n.category);break;case"source":d=a.source.localeCompare(n.source);break;case"amount":d=a.amount-n.amount;break}return Y==="asc"?d:-d}):[],[me,A,Y]),oe=l.useMemo(()=>V==="all"?ve:ve.slice(0,V),[ve,V]),dt=l.useMemo(()=>{if(!oe.length)return[];const a=[];let n="";return oe.forEach(d=>{d.date!==n?(n=d.date,a.push({date:d.date,transactions:[d]})):a[a.length-1].transactions.push(d)}),a},[oe]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-6 pb-28",children:[C&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>s({to:"/accounts"}),className:"mb-4 -ml-2",children:[e.jsx(Wt,{className:"w-4 h-4 mr-2"}),t("backToAccounts")]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:t("transactions.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("transactions.subtitle")})]}),e.jsx(Q,{className:"mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ce,{placeholder:t("transactions.searchPlaceholder","Search transactions..."),value:T,onChange:a=>L(a.target.value),className:"h-11"}),T&&e.jsx("button",{onClick:()=>{L(""),se()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>B(!$),className:b("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",$||z>0?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[e.jsx(Xt,{className:"w-4 h-4"}),t("button.filter","Filter"),z>0&&e.jsx("span",{className:"bg-primary-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:z}),e.jsx(Ht,{className:b("w-4 h-4 transition-transform",$&&"rotate-180")})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide flex-1",children:[{key:"today",label:t("date.today","Today")},{key:"thisWeek",label:t("date.thisWeek","This Week")},{key:"thisMonth",label:t("date.thisMonth","This Month")}].map(({key:a,label:n})=>e.jsx("button",{onClick:()=>p(a),className:b("px-3 py-2 text-xs sm:text-sm font-medium rounded-lg whitespace-nowrap transition-colors",U===a?"bg-primary-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:n},a))})]}),$&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-600 space-y-3 animate-slide-up",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(ce,{type:"number",placeholder:t("transactions.minAmount","Min"),value:J,onChange:a=>O("min",a.target.value),className:"h-10"}),e.jsx(ce,{type:"number",placeholder:t("transactions.maxAmount","Max"),value:X,onChange:a=>O("max",a.target.value),className:"h-10"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx(na,{label:t("transactions.category","Category"),options:et,selected:w.categories||[],onChange:a=>D({...w,categories:a}),placeholder:t("transactions.allCategories","All")})}),e.jsx(ye,{label:t("transactions.source","Source"),value:w.source||"",onChange:a=>D({...w,source:a.target.value}),options:[{value:"",label:t("transactions.all","All")},...(u==null?void 0:u.map(a=>({value:a.name,label:a.name})))||[]]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:rt,children:t("button.reset","Reset")}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>v&&pa(v,w.start_date,w.end_date),disabled:!v||v.length===0,children:t("transactions.export","Export")})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs(Q,{onClick:()=>x("income"),className:`cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] ${k==="income"?"ring-2 ring-green-500 dark:ring-green-400 bg-green-50/50 dark:bg-green-900/20":""}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.income")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-green-600 dark:text-green-400",children:Ae(ot,Le,r,!0,o)})]}),e.jsxs(Q,{onClick:()=>x("expense"),className:`cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] ${k==="expense"?"ring-2 ring-red-500 dark:ring-red-400 bg-red-50/50 dark:bg-red-900/20":""}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.expense")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-red-600 dark:text-red-400",children:Ae(ct,Le,r,!0,o)})]}),e.jsxs(Q,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.difference")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-blue-600 dark:text-blue-400",children:Ae(it,Le,r,!0,o)})]})]}),!_e&&v&&v.length>0&&e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("transactions.show","Show"),":"]}),e.jsx("div",{className:"hidden md:flex gap-1",children:[50,100,"all"].map(a=>e.jsx("button",{onClick:()=>pe(a),className:`px-3 py-1 text-sm rounded-md transition-colors ${V===a?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:a==="all"?t("transactions.showAll","All"):a},a))}),e.jsxs("select",{value:V,onChange:a=>pe(a.target.value==="all"?"all":Number(a.target.value)),className:"md:hidden px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"all",children:t("transactions.showAll","All")})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("transactions.sort","Sort"),":"]}),e.jsxs("select",{value:`${A}-${Y}`,onChange:a=>Se(a.target.value),className:"px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"date-desc",children:t("transactions.sortDateDesc","Date ↓")}),e.jsx("option",{value:"date-asc",children:t("transactions.sortDateAsc","Date ↑")}),e.jsx("option",{value:"amount-desc",children:t("transactions.sortAmountDesc","Amount ↓")}),e.jsx("option",{value:"amount-asc",children:t("transactions.sortAmountAsc","Amount ↑")})]}),fe&&e.jsxs("svg",{className:"animate-spin h-4 w-4 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("transactions.showingCount","Showing {{shown}} of {{total}}",{shown:oe.length,total:ve.length})})]}),_e?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.date")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.description")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.category")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.source")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.amount")}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:t("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:[...Array(5)].map((a,n)=>e.jsx(Tt,{},n))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:[...Array(5)].map((a,n)=>e.jsx(Rt,{},n))})]}):v&&v.length>0?e.jsxs("div",{className:`transition-opacity duration-150 ${fe?"opacity-50":"opacity-100"}`,children:[e.jsx(Q,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12",children:e.jsx("input",{type:"checkbox",checked:Oe,onChange:tt,className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>ee("date"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.date"),A==="date"&&e.jsx("span",{className:"text-blue-600",children:Y==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>ee("description"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.description"),A==="description"&&e.jsx("span",{className:"text-blue-600",children:Y==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>ee("category"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.category"),A==="category"&&e.jsx("span",{className:"text-blue-600",children:Y==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>ee("source"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.source"),A==="source"&&e.jsx("span",{className:"text-blue-600",children:Y==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>ee("amount"),children:e.jsxs("span",{className:"flex items-center justify-end gap-1",children:[t("transactions.amount"),A==="amount"&&e.jsx("span",{className:"text-blue-600",children:Y==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:t("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:oe.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:W.has(a.id),onChange:()=>at(a.id),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:Ce(a.date)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:a.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Ve,{variant:a.type==="income"?"info":"default",children:a.category})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-300",children:a.source}),e.jsx("td",{className:`px-6 py-4 text-sm font-semibold font-numbers text-right ${a.is_transfer?"text-blue-500 dark:text-blue-400":a.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ke(a.amount,a.type,a.currency||"JPY",r,!0,o)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>E(a),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors","aria-label":t("button.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})})}),e.jsx("button",{onClick:()=>le(a),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors","aria-label":t("button.delete"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-red-600 dark:text-red-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]})})]},a.id))})]})}),e.jsx(oa,{onRefresh:nt,className:"md:hidden",children:e.jsx("div",{className:"space-y-6 pb-20",children:A==="date"?dt.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:Lt(a.date)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx("div",{className:"space-y-3",children:a.transactions.map(n=>e.jsx(Ye,{transaction:n,onViewDetail:ne,onEdit:E,onDelete:le},n.id))})]},a.date)):e.jsx("div",{className:"space-y-3",children:oe.map(a=>e.jsx(Ye,{transaction:a,onViewDetail:ne,onEdit:E,onDelete:le},a.id))})})})]}):e.jsx(Q,{children:e.jsx(ra,{icon:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),title:t("transactions.noData"),description:t("transactions.noDataDescription","Upload a CSV file or add transactions manually to get started."),action:e.jsx(f,{onClick:()=>xe(!0),children:t("transaction.addTransaction")})})}),W.size>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg p-4 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("transactions.selectedCount","{{count}} selected",{count:W.size})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>te(new Set),children:t("button.clearSelection","Clear")}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Te(!0),children:t("transactions.recategorize","Recategorize")}),e.jsx(f,{variant:"danger",size:"sm",onClick:()=>Re(!0),children:t("transactions.deleteSelected","Delete")})]})]})}),e.jsx(ia,{isOpen:!!j,onClose:()=>E(null),transaction:j}),e.jsx(da,{isOpen:!!be,onClose:()=>ne(null),transaction:be,onEdit:E,onDelete:le}),e.jsx($t,{isOpen:Me,onClose:()=>xe(!1),defaultAccountId:h?Number(h):null}),e.jsx(xa,{isOpen:!!je,onClose:()=>le(null),onConfirm:st,transaction:je,isDeleting:Fe.isPending}),e.jsx(ma,{isOpen:Je,onClose:()=>Te(!1),onConfirm:a=>$e.mutate(a),selectedCount:W.size,isLoading:$e.isPending}),e.jsx(ga,{isOpen:Xe,onClose:()=>Re(!1),onConfirm:()=>Ie.mutate(),selectedCount:W.size,isDeleting:Ie.isPending}),e.jsx(Yt,{isOpen:Ke,onClose:()=>De(!1),onScanComplete:Ge}),e.jsx(ua,{onClick:()=>xe(!0)})]})}const La=_t("/transactions")({component:ba});export{La as Route};
