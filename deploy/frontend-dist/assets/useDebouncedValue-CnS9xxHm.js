import{j as e}from"./vendor-router-DONIM_LE.js";import{r as t,a as ue}from"./vendor-react-Cwh1aMWO.js";import{b as me,c as B,u as Re}from"./vendor-query-B0NEAgzV.js";import{bm as De,bn as ie,j as v,bo as Ie,b4 as K,X as Q,f as ge,h as Te,aC as Ee,aO as Pe,O as Oe,bp as Fe,au as Me,n as Le,R as ze,B as le,a4 as Ae,a5 as Ue}from"./index-8QQOl6s4.js";import{R as qe,s as _e,H as We,B as Ve,u as Be}from"./BudgetInsightWidget-DWu6Mges.js";import{u as S}from"./vendor-i18n-CNDlYvyf.js";import{R as Ke}from"./RecurringOptions-B90hBlcx.js";import{u as Qe}from"./useXPGain-CWScU3DM.js";function Ye(n,l){const s=me(),{entityType:r,operationType:o,getEntityId:m=()=>0,invalidateKeys:u=[],onSuccess:c,onError:d}=l;return B({mutationFn:async i=>{if(!navigator.onLine){const g=m(i);return await ie(o,r,g,i),null}try{const g=await n(i);for(const f of u)s.invalidateQueries({queryKey:f});return g}catch(g){if(g instanceof TypeError&&g.message.includes("fetch")){const f=m(i);return await ie(o,r,f,i),null}throw g}},onSuccess:i=>{navigator.onLine&&De(),c==null||c(i)},onError:i=>{d==null||d(i)}})}function He(n,l,s){return Ye(n,{entityType:l,operationType:"CREATE",invalidateKeys:s})}const de={JPY:"¥",USD:"$",VND:"₫"};function V(n){const l=n.startsWith("-"),s=n.replace(/[^\d.]/g,"");if(!s)return"";const r=s.split(".");return r[0]=parseInt(r[0]).toLocaleString(),(l?"-":"")+r.join(".")}function Je(n){const l=n.startsWith("-"),s=n.replace(/[^\d.]/g,"");return(l?"-":"")+s}function Ge({value:n,onChange:l,onSuggestionSelect:s,placeholder:r,className:o,error:m}){const{t:u}=S("common"),[c,d]=t.useState(!1),[i,g]=t.useState(""),f=t.useRef(null),p=t.useRef(null);t.useEffect(()=>{const x=setTimeout(()=>{g(n)},300);return()=>clearTimeout(x)},[n]);const{data:y=[]}=Re({queryKey:["transaction-suggestions",i],queryFn:()=>Ie(i),enabled:i.length>=2,staleTime:3e4});t.useEffect(()=>{d(y.length>0&&n.length>=2)},[y,n]),t.useEffect(()=>{const x=h=>{p.current&&!p.current.contains(h.target)&&d(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const b=t.useCallback(x=>{var h;x.key==="Escape"&&(d(!1),(h=f.current)==null||h.blur())},[]),w=x=>{l(x.description),d(!1),s==null||s(x)},R=x=>Math.abs(x).toLocaleString();return e.jsxs("div",{ref:p,className:"relative",children:[e.jsx("input",{ref:f,type:"text",value:n,onChange:x=>l(x.target.value),onKeyDown:b,onFocus:()=>y.length>0&&d(!0),placeholder:r,className:v("w-full h-12 px-4 border rounded-lg text-base","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400",m?"border-red-500":"border-gray-300",o)}),c&&y.length>0&&e.jsx("div",{className:v("absolute top-full left-0 right-0 z-50 mt-1","bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700","max-h-60 overflow-y-auto"),children:y.map((x,h)=>e.jsxs("button",{type:"button",onClick:()=>w(x),className:v("w-full px-4 py-3 flex items-center justify-between text-left","hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors","border-b border-gray-100 dark:border-gray-700 last:border-0"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:x.description}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:x.category}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"•"}),e.jsxs("span",{className:"text-gray-400",children:[x.count,"x ",u("autocomplete.used","used")]})]})]}),e.jsx("div",{className:"ml-4 text-right shrink-0",children:e.jsxs("div",{className:v("font-medium font-numbers",x.is_income?"text-green-600":"text-gray-900 dark:text-gray-100"),children:["¥",R(x.amount)]})})]},`${x.description}-${h}`))})]})}function Xe({onCapture:n,onCancel:l}){const{t:s}=S(),r=t.useRef(null),o=t.useRef(null),[m,u]=t.useState(null),[c,d]=t.useState(null),[i,g]=t.useState(null),[f,p]=t.useState(!0),y=t.useCallback(async()=>{p(!0),g(null);try{const h=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});r.current&&(r.current.srcObject=h,u(h))}catch(h){console.error("Camera error:",h),g(s("receipt.cameraError","Could not access camera"))}finally{p(!1)}},[s]),b=t.useCallback(()=>{m&&(m.getTracks().forEach(h=>h.stop()),u(null))},[m]),w=t.useCallback(()=>{if(!r.current||!o.current)return;const h=r.current,D=o.current,I=D.getContext("2d");if(!I)return;D.width=h.videoWidth,D.height=h.videoHeight,I.drawImage(h,0,0);const C=D.toDataURL("image/jpeg",.8);d(C),b()},[b]),R=t.useCallback(()=>{d(null),y()},[y]),x=t.useCallback(()=>{c&&n(c)},[c,n]);return t.useEffect(()=>(y(),()=>{m&&m.getTracks().forEach(h=>h.stop())}),[]),i?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(K,{size:48,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-red-400 mb-6",children:i}),e.jsx("button",{onClick:l,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:s("close","Close")})]}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/50 absolute top-0 left-0 right-0 z-10",children:[e.jsx("button",{onClick:l,className:"text-white p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":s("close","Close"),children:e.jsx(Q,{size:24})}),e.jsx("span",{className:"text-white font-medium",children:s("receipt.scanReceipt","Scan Receipt")}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 min-h-0 relative flex items-center justify-center bg-black overflow-hidden",children:[f&&!c&&e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"}),e.jsx("p",{className:"text-white",children:s("receipt.startingCamera","Starting camera...")})]}),c?e.jsx("img",{src:c,alt:"Captured receipt",className:"max-w-full max-h-full object-contain"}):e.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",onLoadedMetadata:()=>p(!1)}),e.jsx("canvas",{ref:o,className:"hidden"})]}),e.jsx("div",{className:"flex-shrink-0 p-6 bg-black/50 flex justify-center gap-8 safe-area-bottom",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[e.jsx(qe,{size:20}),s("receipt.retake","Retake")]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(ge,{size:20}),s("receipt.usePhoto","Use Photo")]})]}):e.jsx("button",{onClick:w,disabled:f,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center disabled:opacity-50 transition-opacity","aria-label":s("receipt.takePhoto","Take Photo"),children:e.jsx("div",{className:"w-14 h-14 rounded-full border-4 border-black"})})})]})}async function $e(n,l=1024,s=1024,r=.8){return new Promise((o,m)=>{const u=new Image,c=document.createElement("canvas"),d=c.getContext("2d");if(!d){m(new Error("Failed to get canvas context"));return}u.onload=()=>{let{width:i,height:g}=u;if(i>l||g>s){const p=Math.min(l/i,s/g);i=Math.round(i*p),g=Math.round(g*p)}c.width=i,c.height=g,d.drawImage(u,0,0,i,g);const f=c.toDataURL("image/jpeg",r);URL.revokeObjectURL(u.src),o(f)},u.onerror=()=>{URL.revokeObjectURL(u.src),m(new Error("Failed to load image"))},u.src=URL.createObjectURL(n)})}function Ze({onImageSelect:n,className:l}){const{t:s}=S(),[r,o]=t.useState(!1),[m,u]=t.useState(!1),c=t.useCallback(async p=>{if(!p.type.startsWith("image/")){alert(s("receipt.invalidFile","Please select an image file"));return}u(!0);try{const y=await $e(p);n(y)}catch{alert(s("receipt.processError","Failed to process image"))}finally{u(!1)}},[n,s]),d=t.useCallback(p=>{p.preventDefault(),o(!1);const y=p.dataTransfer.files[0];y&&c(y)},[c]),i=t.useCallback(p=>{p.preventDefault(),o(!0)},[]),g=t.useCallback(()=>{o(!1)},[]),f=t.useCallback(p=>{var b;const y=(b=p.target.files)==null?void 0:b[0];y&&c(y)},[c]);return e.jsxs("div",{onDrop:d,onDragOver:i,onDragLeave:g,className:v("border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",r?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500",m&&"opacity-50 pointer-events-none",l),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:f,className:"hidden",id:"receipt-file-input"}),e.jsx("label",{htmlFor:"receipt-file-input",className:"cursor-pointer",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("receipt.processing","Processing...")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(Te,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:s("receipt.dropOrClick","Drop image here or click to upload")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s("receipt.supportedFormats","JPG, PNG, HEIC supported")})]})]})})})]})}function et({isOpen:n,onClose:l,onScanComplete:s}){const{t:r}=S(),[o,m]=t.useState("select"),[u,c]=t.useState(null),d=B({mutationFn:_e,onSuccess:b=>{s(b.data),i()}}),i=t.useCallback(()=>{m("select"),c(null),d.reset(),l()},[l,d]),g=t.useCallback(b=>{c(b),m("preview")},[]),f=t.useCallback(()=>{u&&d.mutate({image:u})},[u,d]),p=t.useCallback(()=>{c(null),m("select")},[]);if(!n)return null;if(o==="camera")return e.jsx(Xe,{onCapture:g,onCancel:()=>m("select")});const y=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",onClick:b=>{b.target===b.currentTarget&&i()},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:i}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("receipt.scanReceipt","Scan Receipt")}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":r("close","Close"),children:e.jsx(Q,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-4",children:[o==="select"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>m("camera"),className:"w-full h-14 flex items-center justify-center gap-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(K,{size:24}),r("receipt.takePhoto","Take Photo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("or","or")}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx(Ze,{onImageSelect:g})]}),o==="preview"&&u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:e.jsx("img",{src:u,alt:"Receipt preview",className:"w-full max-h-64 object-contain"})}),d.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("receipt.analyzing","Analyzing receipt with AI...")})]}),d.isError&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:[e.jsx(Ee,{size:20}),e.jsx("span",{children:r("receipt.scanError","Failed to scan receipt. Please try again.")})]}),!d.isPending&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,className:"flex-1 h-12 flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:r("receipt.retake","Retake")}),e.jsxs("button",{onClick:f,disabled:d.isPending,className:"flex-1 h-12 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(ge,{size:20}),r("receipt.scan","Scan")]})]})]})]})]})]});return typeof document>"u"?null:ue.createPortal(y,document.body)}function tt({isIncome:n,onToggle:l}){const{t:s}=S("common");return e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>l(!1),className:v("flex-1 py-3 rounded-md text-sm font-medium transition-colors",n?"text-gray-600 dark:text-gray-300":"bg-red-500 text-white"),children:s("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>l(!0),className:v("flex-1 py-3 rounded-md text-sm font-medium transition-colors",n?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:s("transaction.income","Income")})]})}function rt({value:n,displayValue:l,currencySymbol:s,onChange:r,error:o,autoFocus:m}){const{t:u}=S("common"),c=d=>{const i=Je(d.target.value);r(i,V(i))};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("transaction.amount","Amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-lg font-medium text-gray-500 dark:text-gray-400",children:s}),e.jsx("input",{type:"text",inputMode:"numeric",value:l,onChange:c,placeholder:"0",autoFocus:m,className:v("w-full h-14 pl-10 pr-4 border rounded-lg text-xl text-right font-numbers","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",o?"border-red-500":"border-gray-300")})]}),o&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o})]})}function at({onScanClick:n,receiptPreview:l,onReceiptSelect:s,onRemoveReceipt:r,fileInputRef:o}){const{t:m}=S("common");return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:n,className:"w-full h-12 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium transition-all shadow-md hover:shadow-lg",children:[e.jsx(Pe,{size:20}),m("receipt.scanReceipt","Scan Receipt")]}),e.jsx("input",{ref:o,type:"file",accept:"image/*",capture:"environment",onChange:s,className:"hidden"}),l?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:l,alt:"Receipt preview",className:"w-full h-24 object-cover"}),e.jsx("button",{type:"button",onClick:r,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(Q,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var u;return(u=o.current)==null?void 0:u.click()},className:"w-full h-12 flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-primary-400 dark:hover:border-primary-500 text-gray-500 dark:text-gray-400 rounded-lg font-medium transition-colors",children:[e.jsx(K,{size:20}),m("receipt.attachReceipt","Attach Receipt Photo")]})]})}function mt({isOpen:n,onClose:l,defaultAccountId:s}){const{t:r}=S("common"),{data:o}=Oe(),m=me(),u=Fe(),[c,d]=t.useState(!1),[i,g]=t.useState(new Date().toISOString().split("T")[0]),[f,p]=t.useState(""),[y,b]=t.useState(""),[w,R]=t.useState(""),[x,h]=t.useState(""),[D,I]=t.useState(""),[C,Y]=t.useState(null),[N,H]=t.useState({}),[xe,O]=t.useState(!1),[J,F]=t.useState(null),[M,L]=t.useState(null),[pe,G]=t.useState(!1),z=t.useRef(null),[A,X]=t.useState(!1),[U,$]=t.useState(!1),[P,Z]=t.useState(!1),[T,ee]=t.useState("monthly"),[te,re]=t.useState(0),[ae,se]=t.useState(25),[ne,oe]=t.useState(7),k=t.useMemo(()=>(o==null?void 0:o.find(a=>a.id===C))||null,[o,C]),he=k!=null&&k.currency?de[k.currency]||k.currency:"¥",{showTransactionXP:fe}=Qe();t.useEffect(()=>{var a;n&&(d(!1),g(new Date().toISOString().split("T")[0]),p(""),b(""),R(""),h(""),I(""),Y(s??((a=o==null?void 0:o[0])==null?void 0:a.id)??null),H({}),F(null),L(null),$(!1),Z(!1),ee("monthly"),re(0),se(25),oe(7),X(!1))},[n,o,s]),t.useEffect(()=>{h(""),I("")},[c]);const q=He(Ue,"transaction",[["transactions"],["analytics"]]),_=B({mutationFn:Me,onSuccess:()=>{m.invalidateQueries({queryKey:["recurring-transactions"]})}}),ye=(a,j)=>{p(a),b(j)},be=a=>{const j=a.amount.toString();p(j),b(V(j)),d(a.is_income),a.category&&h(a.category)},je=a=>{if(a.amount!==null){const j=Math.abs(a.amount).toString();p(j),b(V(j)),d(!1)}a.date&&g(a.date),a.merchant&&R(a.merchant),a.category&&h(a.category),O(!1)},ke=a=>{var E;const j=(E=a.target.files)==null?void 0:E[0];!j||!j.type.startsWith("image/")||(F(j),L(URL.createObjectURL(j)))},ve=()=>{F(null),M&&(URL.revokeObjectURL(M),L(null)),z.current&&(z.current.value="")},Ne=()=>{const a={};return(!f||parseInt(f)<=0)&&(a.amount=r("transaction.errors.amountRequired","Amount is required")),w.trim()||(a.description=r("transaction.errors.descriptionRequired","Description is required")),x||(a.category=r("transaction.errors.categoryRequired","Category is required")),C||(a.source=r("transaction.errors.sourceRequired","Account is required")),H(a),Object.keys(a).length===0},we=async a=>{if(a.preventDefault(),!Ne())return;const j=x||"Other",E=(k==null?void 0:k.currency)||"JPY",W=Ae(parseInt(f),E);try{let ce;if(J){G(!0);try{ce=await Be(J)}finally{G(!1)}}await q.mutateAsync({date:i,description:w.trim(),amount:c?W:-W,currency:E,category:j,source:(k==null?void 0:k.name)||"",type:c?"income":"expense",account_id:C,receipt_url:ce,is_adjustment:U}),P&&await _.mutateAsync({description:w.trim(),amount:W,category:j,account_id:C,is_income:c,frequency:T,day_of_week:T==="weekly"?te:null,day_of_month:T==="monthly"?ae:null,interval_days:T==="custom"?ne:null,start_date:i}),fe(),l(),u.success(r("transaction.saved","Transaction saved!"))}catch{}},Ce=a=>{a.target===a.currentTarget&&l()};if(!n)return null;const Se=e.jsxs("div",{className:"fixed inset-0 z-[100002] bg-black/50 flex items-end sm:items-center justify-center animate-modal-backdrop",onClick:Ce,children:[e.jsxs("div",{className:v("w-full sm:max-w-md","bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl shadow-2xl","max-h-[90vh] overflow-y-auto","animate-modal-in"),children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 dark:text-gray-100",children:r("transaction.addTransaction","Add Transaction")})}),e.jsxs("form",{onSubmit:we,className:"px-4 pb-8 space-y-4",children:[e.jsx(tt,{isIncome:c,onToggle:d}),e.jsx(rt,{value:f,displayValue:y,currencySymbol:he,onChange:ye,error:N.amount,autoFocus:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transaction.description","Description")}),e.jsx(Ge,{value:w,onChange:R,onSuggestionSelect:be,placeholder:r("transaction.descriptionPlaceholder","What was this for?"),error:!!N.description}),N.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("transaction.category","Category")}),e.jsx(We,{selected:x,onSelect:(a,j)=>{h(a),I(j)},isIncome:c}),N.category&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.category}),x&&!U&&e.jsx(Ve,{parentCategory:D||x,transactionAmount:parseInt(f)||0,isExpense:!c,transactionCurrency:(k==null?void 0:k.currency)||"JPY"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transaction.source","Account")}),e.jsxs("select",{value:C||"",onChange:a=>Y(a.target.value?parseInt(a.target.value):null),className:v("w-full h-12 px-4 border rounded-lg text-base","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",N.source?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transaction.selectAccount","Select account")}),o==null?void 0:o.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",de[a.currency]||a.currency,")"]},a.id))]}),N.source&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.source})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsxs("button",{type:"button",onClick:()=>X(!A),className:"flex items-center justify-between w-full py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 transition-colors",children:[e.jsx("span",{children:r("transaction.moreOptions","More Options")}),e.jsx(Le,{size:18,className:v("transition-transform duration-200",A&&"rotate-180")})]}),A&&e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transaction.date","Date")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:i,onChange:a=>g(a.target.value),className:"flex-1 h-12 px-4 border border-gray-300 rounded-lg text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"}),e.jsx("button",{type:"button",onClick:()=>g(new Date().toISOString().split("T")[0]),className:"px-4 h-12 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:r("today","Today")})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer py-2",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:a=>$(a.target.checked),className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:r("transaction.balanceAdjustment","Balance adjustment")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("transaction.balanceAdjustmentHint","Won't count toward budget")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:a=>Z(a.target.checked),className:"w-5 h-5 rounded border-gray-300 text-primary-500 focus:ring-primary-500"}),e.jsx(ze,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:r("recurring.makeRecurring")})]}),P&&e.jsx(Ke,{frequency:T,setFrequency:ee,dayOfWeek:te,setDayOfWeek:re,dayOfMonth:ae,setDayOfMonth:se,intervalDays:ne,setIntervalDays:oe})]}),e.jsx(at,{onScanClick:()=>O(!0),receiptPreview:M,onReceiptSelect:ke,onRemoveReceipt:ve,fileInputRef:z})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(le,{type:"button",variant:"outline",onClick:l,className:"flex-1 h-12",children:r("cancel","Cancel")}),e.jsx(le,{type:"submit",loading:q.isPending||_.isPending||pe,className:v("flex-1 h-12",P?"bg-blue-500 hover:bg-blue-600":c?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:r("save","Save")})]}),(q.isError||_.isError)&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:r("transaction.errors.createFailed","Failed to create transaction")})]})]}),e.jsx(et,{isOpen:xe,onClose:()=>O(!1),onScanComplete:je})]});return typeof document>"u"?null:ue.createPortal(Se,document.body)}function gt(n,l){const[s,r]=t.useState(n);return t.useEffect(()=>{const o=setTimeout(()=>r(n),l);return()=>clearTimeout(o)},[n,l]),s}export{et as R,mt as T,He as a,V as f,Je as p,gt as u};
