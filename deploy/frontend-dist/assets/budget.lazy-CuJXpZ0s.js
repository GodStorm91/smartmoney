import{j as e,u as E,e as Q,c as K,k as A,m as G}from"./vendor-tanstack-DOuiVnRb.js";import{r as k}from"./vendor-react-B9eo89kj.js";import{p as H,C as M,B as F,I as W,Y as v,c as S,Z as Y,_ as z,$ as J,a0 as Z,L as X,a1 as ee,a2 as te,a3 as ae}from"./index-C4UxDUME.js";import{u as _}from"./vendor-i18n-CtQU9zWU.js";import{C as re,A as se,aa as ne,r as de,u as le,z as oe,s as ce,t as ie}from"./vendor-icons-Boynwk5e.js";import{l as me,u as xe}from"./recurring-service-BNpQv5m2.js";import"./vendor-recharts-BfEtinVu.js";import"./vendor-date-fteVm545.js";function D(t,o=0){if(!t&&t!==0)return"";const n=typeof t=="string"?parseFloat(t):t;return isNaN(n)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:o,maximumFractionDigits:o}).format(n)}function ge(t){if(!t)return 0;const o=t.replace(/,/g,""),n=parseFloat(o);return isNaN(n)?0:n}function ue(t){return{JPY:"¥",USD:"$",VND:"₫",EUR:"€",GBP:"£"}[t]||t}function he(t){return["VND"].includes(t)?"suffix":"prefix"}function be(t){return{JPY:0,VND:0,KRW:0,USD:2,EUR:2,GBP:2}[t]??0}function pe({onGenerate:t,isLoading:o,error:n,suggestions:a}){const{t:r}=_("common"),{currency:g}=H(),[d,m]=k.useState(""),[j,x]=k.useState(!1),p=ue(g),y=he(g),h=be(g);k.useEffect(()=>{if(a!=null&&a.previous_income&&!j&&!d){const i=a.previous_income/Math.pow(10,h);m(D(i,h)),x(!0)}},[a,j,d,h]);const N=i=>{const s=i.target.value.replace(/[^\d.]/g,"");if(s){const b=parseFloat(s);isNaN(b)||m(D(b,h))}else m("")},w=i=>{i.preventDefault();const u=ge(d),s=Math.round(u*Math.pow(10,h));s>0&&(t(s),m(""))},c=()=>{a!=null&&a.previous_income&&t(a.previous_income)},l=i=>{const[u,s]=i.split("-");return new Date(parseInt(u),parseInt(s)-1).toLocaleDateString(void 0,{month:"long",year:"numeric"})};return e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.has_previous)&&a.previous_month&&e.jsx(M,{className:"p-6 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:r("budget.previousBudgetFound",{month:l(a.previous_month)})}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:r("budget.cloneDescription")}),e.jsx(F,{onClick:c,loading:o,className:"w-full sm:w-auto",children:r("budget.clonePreviousMonth")})]})]})}),(a==null?void 0:a.has_previous)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:r("budget.orCreateNew")})})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:r("budget.generateTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:r("budget.generateDescription")}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("budget.monthlyIncome")}),e.jsxs("div",{className:"relative",children:[y==="prefix"&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:p})}),e.jsx(W,{type:"text",inputMode:"decimal",value:d,onChange:N,placeholder:D(5e5,h),required:!0,disabled:o,className:y==="prefix"?"pl-8":"pr-10"}),y==="suffix"&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:p})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[r("budget.incomeHint"),(a==null?void 0:a.previous_income)&&e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400",children:["(",r("budget.previousIncome"),": ",p,D(a.previous_income/Math.pow(10,h),h),")"]})]})]}),e.jsx(F,{type:"submit",loading:o,disabled:!d,className:"w-full",children:r("budget.generateButton")}),n&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:r("budget.generateError")})]})]})]})}function ye({budget:t,totalAllocated:o,isDraft:n,onRegenerateClick:a,onSaveClick:r,isSaving:g}){const{t:d,i18n:m}=_("common"),j=t.language||"ja",x=m.language,p=t.advice&&j!==x;return e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:d("budget.currentBudget")}),n&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-amber-100 text-amber-800 rounded",children:d("budget.draft")})]}),e.jsx("p",{className:"text-sm text-gray-500",children:t.month})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{variant:"outline",onClick:a,children:d("budget.regenerate")}),n&&e.jsx(F,{onClick:r,disabled:g,children:d(g?"budget.saving":"budget.save")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:d("budget.monthlyIncome")}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:v(t.monthly_income)})]}),t.savings_target!==void 0&&t.savings_target>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:d("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:v(t.savings_target)})]}),t.carry_over!==void 0&&t.carry_over!==0&&e.jsxs("div",{className:`p-4 rounded-lg ${t.carry_over>0?"bg-teal-50 dark:bg-teal-900/30":"bg-orange-50 dark:bg-orange-900/30"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:d("budget.carryOver")}),e.jsxs("p",{className:`text-2xl font-bold ${t.carry_over>0?"text-teal-600 dark:text-teal-400":"text-orange-600 dark:text-orange-400"}`,children:[t.carry_over>0?"+":"",v(t.carry_over)]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:d("budget.totalAllocated")}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:v(o)})]})]}),t.advice&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-300 mb-1",children:d("budget.aiAdvice")}),e.jsx("p",{className:"text-amber-700 dark:text-amber-400",children:t.advice}),p&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-amber-200 dark:border-amber-700 flex items-start gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:d("budget.languageMismatchNotice")})]})]})]})}function je({onSubmit:t,onCancel:o,isLoading:n}){const{t:a}=_("common"),[r,g]=k.useState(""),d=m=>{m.preventDefault(),r.trim()&&(t(r.trim()),g(""))};return e.jsxs(M,{className:"p-6 border-blue-200 bg-blue-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:a("budget.feedbackTitle")}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("textarea",{value:r,onChange:m=>g(m.target.value),placeholder:a("budget.feedbackPlaceholder"),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 min-h-[100px]",disabled:n,required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"submit",disabled:n||!r.trim(),children:a(n?"budget.regenerating":"budget.submitFeedback")}),e.jsx(F,{type:"button",variant:"outline",onClick:o,children:a("common.cancel")})]})]})]})}function fe({budget:t,tracking:o}){const{t:n}=_("common"),{data:a}=E({queryKey:["recurring-monthly-summary",t.month],queryFn:()=>me(t.month),staleTime:5*60*1e3}),r=k.useMemo(()=>{const[g,d]=t.month.split("-").map(Number),m=new Date(g,d,0).getDate(),j=m-o.days_remaining,x=Math.round(j/m*100),p=(a==null?void 0:a.paid_this_month)??0,y=(a==null?void 0:a.upcoming_this_month)??0,h=(a==null?void 0:a.upcoming_count)??0;if(j<=0)return{daysInMonth:m,daysElapsed:0,progressPercent:0,dailyAvg:0,variableSpending:0,variableProjection:0,upcomingBills:y,upcomingCount:h,projectedSpending:y,projectedSavings:t.monthly_income-y,isOnTrack:t.monthly_income-y>=(t.savings_target||0)};const N=Math.max(0,o.total_spent-p),c=N/j*o.days_remaining,l=N+c,i=l+y,u=o.total_spent/j,s=t.monthly_income-i;return{daysInMonth:m,daysElapsed:j,progressPercent:x,dailyAvg:Math.round(u),variableSpending:Math.round(N),variableProjection:Math.round(l),upcomingBills:y,upcomingCount:h,projectedSpending:Math.round(i),projectedSavings:Math.round(s),isOnTrack:s>=(t.savings_target||0)}},[t,o,a]);return e.jsxs(M,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-gray-500"}),n("budget.projection.title","Spending Projection")]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:n("budget.projection.monthProgress","Month Progress")}),e.jsxs("span",{className:"font-medium",children:[r.daysElapsed," / ",r.daysInMonth," ",n("budget.projection.days","days")]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-500",style:{width:`${r.progressPercent}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-right",children:[r.progressPercent,"% ",n("budget.projection.elapsed","elapsed")]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:n("budget.projection.spentSoFar","Spent so far")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:v(o.total_spent)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:n("budget.projection.dailyAvg","Daily average")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:v(r.dailyAvg)})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:n("budget.projection.projectedByMonthEnd","Projected by month end")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:n("budget.projection.variableSpending","Variable spending")}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:v(r.variableProjection)})]}),r.upcomingBills>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4"}),n("budget.projection.upcomingBills","Upcoming bills"),e.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-1.5 py-0.5 rounded",children:r.upcomingCount})]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:v(r.upcomingBills)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:n("budget.projection.totalProjected","Total projected")}),e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:v(r.projectedSpending)})]}),e.jsxs("div",{className:S("flex justify-between items-center p-3 rounded-lg",r.isOnTrack?"bg-green-50 dark:bg-green-900/30":"bg-red-50 dark:bg-red-900/30"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[r.isOnTrack?e.jsx(de,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(le,{className:"w-5 h-5 text-red-600 dark:text-red-400"}),e.jsx("span",{className:S("font-medium",r.isOnTrack?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:n("budget.projection.projectedSavings","Projected savings")})]}),e.jsxs("span",{className:S("text-xl font-bold",r.isOnTrack?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[r.projectedSavings>=0?"+":"",v(r.projectedSavings)]})]}),t.savings_target&&t.savings_target>0&&e.jsx("p",{className:S("text-sm text-center",r.isOnTrack?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:r.isOnTrack?n("budget.projection.onTrack","On track to meet your savings goal!"):n("budget.projection.offTrack","At risk of missing savings goal by {{amount}}",{amount:v(Math.abs(r.projectedSavings-t.savings_target))})})]})]})]})}function ve({budgetId:t,allocations:o,totalBudget:n,tracking:a,month:r,isDraft:g,onAllocationChange:d}){const{t:m}=_("common"),j=Q(),x=K(),{data:p}=xe(),y=k.useMemo(()=>{const l=new Map;return p&&(p.expense.forEach(i=>{const u=i.children.map(s=>s.name);l.set(i.name,u)}),p.income.forEach(i=>{const u=i.children.map(s=>s.name);l.set(i.name,u)})),l},[p]),h=new Map;a!=null&&a.categories&&a.categories.forEach(l=>{h.set(l.category,l)});const N=A({mutationFn:({category:l,amount:i})=>Y(t,l,i),onSuccess:()=>{x.invalidateQueries({queryKey:["budget"]})}}),w=A({mutationFn:l=>z(t,l),onSuccess:()=>{x.invalidateQueries({queryKey:["budget"]})}}),c=l=>{const i=y.get(l)||[],u=[l,...i].join(",");j({to:"/transactions",search:{categories:u,month:r||void 0}})};return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:m("budget.allocations")}),g&&d&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:m("budget.tapToEdit","Tap amount to edit")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map((l,i)=>e.jsx(Ne,{allocation:l,totalBudget:n,trackingItem:h.get(l.category),isDraft:g,isUpdating:N.isPending,isDeleting:w.isPending,onAmountChange:u=>{if(g&&d){const s=[...o];s[i]={...l,amount:u},d(s)}else N.mutate({category:l.category,amount:u})},onDelete:()=>{if(g&&d){const u=o.filter((s,b)=>b!==i);d(u)}else w.mutate(l.category)},onCategoryClick:()=>c(l.category)},i))})]})}function Ne({allocation:t,totalBudget:o,trackingItem:n,isDraft:a,isUpdating:r,isDeleting:g,onAmountChange:d,onDelete:m,onCategoryClick:j}){const{t:x}=_("common"),[p,y]=k.useState(!1),[h,N]=k.useState(""),[w,c]=k.useState(!1),l=k.useRef(null),i=f=>{f.stopPropagation(),N(String(t.amount)),y(!0),setTimeout(()=>{var O;return(O=l.current)==null?void 0:O.focus()},0)},u=()=>{const f=parseInt(h)||0;f!==t.amount&&d(f),y(!1)},s=f=>{f.key==="Enter"?u():f.key==="Escape"&&y(!1)},b=f=>{f.stopPropagation(),c(!0)},q=f=>{f.stopPropagation(),m(),c(!1)},V=f=>{f.stopPropagation(),c(!1)},B=o>0?t.amount/o*100:0,P=(n==null?void 0:n.spent)||0,C=(n==null?void 0:n.budgeted)||t.amount,L=C-P,R=C>0?Math.min(P/C*100,100):0,T=P>C,U=P-C,$=()=>T?"bg-red-500":R>=80?"bg-orange-500":R>=60?"bg-yellow-500":"bg-green-500",I=()=>{!a&&!w&&j()};return e.jsxs(M,{className:S("p-4 transition-all",a?"border-dashed border-blue-300 dark:border-blue-700":"cursor-pointer hover:shadow-md hover:border-blue-300 dark:hover:border-blue-600",(r||g)&&"opacity-50 pointer-events-none"),onClick:I,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold dark:text-gray-100",children:t.category}),n&&T&&e.jsx(oe,{className:"w-4 h-4 text-red-500","aria-label":x("budget.overBudget")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[p?e.jsx("input",{ref:l,type:"number",value:h,onChange:f=>N(f.target.value),onBlur:u,onKeyDown:s,onClick:f=>f.stopPropagation(),className:"w-28 text-right text-lg font-bold border rounded px-2 py-1 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"}):e.jsx("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:v(t.amount)}),!p&&e.jsx("button",{onClick:i,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":x("budget.editAmount","Edit amount"),children:e.jsx(ce,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),e.jsx("button",{onClick:b,className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors","aria-label":x("budget.deleteAllocation","Delete"),children:e.jsx(ie,{className:"w-4 h-4 text-gray-400 hover:text-red-500 dark:text-gray-500 dark:hover:text-red-400"})})]})]}),w&&e.jsxs("div",{className:"mb-3 p-2 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mb-2",children:x("budget.deleteConfirm","Delete this category?")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:V,className:"flex-1 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:x("common.cancel")}),e.jsx("button",{onClick:q,className:"flex-1 py-1.5 text-sm text-white bg-red-600 hover:bg-red-700 rounded transition-colors",children:x("common.delete")})]})]}),t.reasoning&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.reasoning}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-500 ease-out",style:{width:`${Math.min(B,100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[B.toFixed(1),"% ",x("budget.ofTotal")]})]}),n&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[v(P)," / ",v(C)]}),e.jsx("span",{className:S("font-medium",T?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:T?e.jsx(e.Fragment,{children:x("budget.overBy",{amount:v(U)})}):e.jsxs(e.Fragment,{children:[v(L)," ",x("budget.remaining")]})})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:S("h-full transition-all",$()),style:{width:`${Math.min(R,100)}%`}})}),T&&e.jsx("div",{className:"h-1 bg-red-200 dark:bg-red-900/50 rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500",style:{width:`${Math.min((P-C)/C*100,100)}%`}})})]})]})}function ke(){const{t,i18n:o}=_("common"),n=K(),[a,r]=k.useState(!1),[g,d]=k.useState(null),{data:m,isLoading:j,error:x}=E({queryKey:["budget","current"],queryFn:async()=>{var s;try{return await ee()}catch(b){if(((s=b==null?void 0:b.response)==null?void 0:s.status)===404)return null;throw b}},retry:!1}),{data:p}=E({queryKey:["budget","tracking"],queryFn:async()=>{var s;try{return await te()}catch(b){if(((s=b==null?void 0:b.response)==null?void 0:s.status)===404)return null;throw b}},retry:!1,enabled:!!m}),{data:y}=E({queryKey:["budget","suggestions"],queryFn:ae,enabled:!m&&!j}),h=A({mutationFn:s=>J({monthly_income:s,language:o.language}),onSuccess:s=>{d(s)}}),N=A({mutationFn:s=>Z((g||m).id,{feedback:s,language:o.language}),onSuccess:s=>{d(s),r(!1)}}),w=async()=>{await n.refetchQueries({queryKey:["budget"]}),d(null)},c=g||m,l=!!g,i=(c==null?void 0:c.allocations.reduce((s,b)=>s+b.amount,0))||0,u=((c==null?void 0:c.monthly_income)||0)-((c==null?void 0:c.savings_target)||0);return j?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(X,{})}):e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:t("budget.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("budget.subtitle")})]}),!c&&!x&&e.jsx(pe,{onGenerate:s=>h.mutate(s),isLoading:h.isPending,error:h.isError,suggestions:y}),c&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(ye,{budget:c,totalAllocated:i,isDraft:l,onRegenerateClick:()=>r(!a),onSaveClick:w,isSaving:!1}),a&&e.jsx(je,{onSubmit:s=>N.mutate(s),onCancel:()=>r(!1),isLoading:N.isPending}),!l&&p&&e.jsx(fe,{budget:c,tracking:p}),e.jsx(ve,{budgetId:c.id,allocations:c.allocations,totalBudget:u,tracking:p||void 0,month:c.month,isDraft:l,onAllocationChange:s=>{if(c){const b=s.reduce((V,B)=>V+B.amount,0),q=Math.max(0,c.monthly_income-b);d({...c,allocations:s,savings_target:q})}}})]}),x&&e.jsx(M,{className:"p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:x instanceof Error?x.message:t("budget.generateError")})})]})}const Be=G("/budget")({component:ke});export{Be as Route};
