import{e,j as t,c as r,u as a,k as s,o as n,m as l}from"./vendor-tanstack-CNAyyoyW.js";import{r as d,a as i}from"./vendor-react-Bx4JnVfy.js";import{a0 as o,i as c,C as x,c as m,p as u,a3 as g,a4 as y,a5 as h,g as p,l as b,w as j,x as v,y as f,L as N,I as k,B as w,D as _,a6 as S,a7 as C,a8 as F,a9 as $,aa as D,ab as A,ac as P,ad as q,ae as L,af as M,a as B,b as z,ag as T,ah as R,ai as K,aj as E,ak as I,al as V,U as O,u as Q,t as U}from"./index-CL4Qiyvp.js";import{u as H}from"./vendor-i18n-BrrOrGm_.js";import{C as W,a as Y}from"./crypto-F1TRPE0c.js";import{W as J,ah as X,z as G,O as Z,a0 as ee,v as te,P as re,ai as ae,y as se,T as ne,w as le,N as de,F as ie,R as oe,j as ce,X as xe,aj as me,ak as ue,C as ge,D as ye,h as he,al as pe,am as be,an as je,ao as ve,ap as fe,V as Ne,aq as ke}from"./vendor-icons-BP-EQ_TG.js";import{R as we,L as _e,C as Se,X as Ce,Y as Fe,T as $e,a as De}from"./vendor-recharts-BrNIwK9z.js";import{T as Ae,R as Pe}from"./TransactionFormModal-EYiyEx2R.js";import"./vendor-date-BkGg5e1q.js";import"./recurring-service-DFZkC56R.js";import"./RecurringOptions-gBFqGXKW.js";const qe={bank:{icon:"ðŸ¦",color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/30"},cash:{icon:"ðŸ’µ",color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/30"},credit_card:{icon:"ðŸ’³",color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/30"},investment:{icon:"ðŸ“ˆ",color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/30"},receivable:{icon:"ðŸ’°",color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/30"},savings:{icon:"ðŸ·",color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/30"},crypto:{icon:"â‚¿",color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/30"},other:{icon:"ðŸ“",color:"text-gray-600",bgColor:"bg-gray-50 dark:bg-gray-700"}};function Le({account:r,onEdit:a}){const{t:s}=H("common"),n=e(),{data:l}=o(),{isPrivacyMode:d}=c(),i=qe[r.type],g=r.current_balance>=0;return t.jsxs(x,{className:"relative hover:shadow-md transition-shadow cursor-pointer",onClick:()=>{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`;n({to:"/transactions",search:{accountId:r.id,month:t,fromAccounts:!0}})},children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:m("p-3 rounded-lg",i.bgColor),children:t.jsx("span",{className:"text-2xl",children:i.icon})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-gray-100",children:r.name}),t.jsx("p",{className:m("text-sm",i.color),children:s(`account.type.${r.type}`)})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[a&&t.jsx("button",{onClick:e=>{e.stopPropagation(),a(r.id)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":s("account.edit"),children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),!r.is_active&&t.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:s("account.inactive")})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:s("account.currentBalance")}),t.jsx("p",{className:m("text-3xl font-bold font-mono",g?"text-green-600":"text-red-600"),children:u(r.current_balance,r.currency,(null==l?void 0:l.rates)||{},!0,d)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("account.initialBalance")}),t.jsx("p",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:u(r.initial_balance,r.currency,(null==l?void 0:l.rates)||{},!0,d)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("account.transactions")}),t.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:r.transaction_count})]})]}),r.notes&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:s("account.notes")}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r.notes})]})]})}const Me=e=>{const t=e.startsWith("-"),r=e.replace(/[^\d.]/g,"").split(".");return r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),(t?"-":"")+r.join(".")},Be=e=>(e.startsWith("-")?"-":"")+e.replace(/[^\d.]/g,""),ze=e=>"USD"===e?100:1;function Te({isOpen:e,onClose:r,editingAccountId:a}){const{t:s}=H("common"),n=g(),l=y(),{data:o}=h(a||void 0),x=p(),{isPrivacyMode:b}=c(),[j,v]=d.useState(""),[f,N]=d.useState("bank"),[k,w]=d.useState(""),[_,S]=d.useState(""),[C,F]=d.useState("JPY"),[$,D]=d.useState(""),[A,P]=d.useState({}),[q,L]=d.useState(""),[M,B]=d.useState(!1),z=o&&o.transaction_count>0,T=(()=>{if(!o||!q)return null;const e=ze(o.currency);return parseFloat(q)*e-o.current_balance})();d.useEffect(()=>{if(e){if(a&&o)if(v(o.name),N(o.type),D(o.notes||""),F(o.currency),z)L(""),B(!1);else{const e=ze(o.currency);w((o.initial_balance/e).toString()),S(o.initial_balance_date)}else v(""),N("bank"),w("0"),S((new Date).toISOString().split("T")[0]),F("JPY"),D(""),L(""),B(!1);P({})}},[e,a,o,z]);if(!e)return null;const R=t.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[t.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:s(a?"account.editAccount":"account.createAccount")}),t.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return j.trim()||(e.name=s("account.errors.nameRequired")),a?a&&!z&&(_||(e.initialBalanceDate=s("account.errors.dateRequired"))):_||(e.initialBalanceDate=s("account.errors.dateRequired")),P(e),0===Object.keys(e).length})())if(a&&z&&q&&!M)B(!0);else try{if(a){const e={name:j.trim(),type:f,notes:$.trim()||void 0};if(!z&&o){const t=ze(o.currency);e.initial_balance=Math.round(parseFloat(k||"0")*t),e.initial_balance_date=_}if(z&&q&&o){const t=ze(o.currency);e.desired_current_balance=Math.round(parseFloat(q)*t)}await l.mutateAsync({id:a,data:e})}else{const e=ze(C),t={name:j.trim(),type:f,initial_balance:Math.round(parseFloat(k||"0")*e),initial_balance_date:_,currency:C,notes:$.trim()||void 0};await n.mutateAsync(t)}r()}catch(t){P({submit:t.message||s("account.errors.submitFailed")})}},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.name")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",id:"name",value:j,onChange:e=>v(e.target.value),className:m("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",A.name?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:s("account.namePlaceholder")}),A.name&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.name})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.accountType")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("select",{id:"type",value:f,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:["bank","cash","credit_card","investment","receivable","savings","other"].map(e=>t.jsx("option",{value:e,children:s(`account.type.${e}`)},e))})]}),!a&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.initialBalance")}),t.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:Me(k),onChange:e=>w(Be(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.initialBalanceDate")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"date",id:"initialBalanceDate",value:_,onChange:e=>S(e.target.value),className:m("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",A.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),A.initialBalanceDate&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.initialBalanceDate})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.currency")}),t.jsxs("select",{id:"currency",value:C,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[t.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),t.jsx("option",{value:"USD",children:"USD ($)"}),t.jsx("option",{value:"VND",children:"VND (â‚«)"})]})]})]}),a&&!z&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.initialBalance")}),t.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:Me(k),onChange:e=>w(Be(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.initialBalanceDate")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"date",id:"initialBalanceDate",value:_,onChange:e=>S(e.target.value),className:m("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",A.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),A.initialBalanceDate&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.initialBalanceDate})]})]}),a&&z&&o&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:"Current Balance"}),t.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-200",children:u(o.current_balance,o.currency,x,!0,b)})]}),t.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:[o.transaction_count," transactions"]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"desiredBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Desired Current Balance"}),t.jsx("input",{type:"text",inputMode:"decimal",id:"desiredBalance",value:Me(q),onChange:e=>{L(Be(e.target.value)),B(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"Enter the actual balance"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the actual balance from your bank/wallet to reconcile"})]}),null!==T&&0!==T&&t.jsx("div",{className:m("border rounded-lg p-4",T>0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:m("text-sm font-medium",T>0?"text-green-900":"text-red-900"),children:"Adjustment Amount"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:m("text-lg font-bold",T>0?"text-green-900":"text-red-900"),children:T>0?"â†‘":"â†“"}),t.jsx("span",{className:m("text-lg font-bold",T>0?"text-green-900":"text-red-900"),children:u(Math.abs(T),o.currency,x,!0,b)})]})]})}),M&&null!==T&&0!==T&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("svg",{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-medium text-yellow-900",children:"Confirm Balance Adjustment"}),t.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["This will create a balance adjustment transaction of"," ",t.jsx("span",{className:"font-semibold",children:u(Math.abs(T),o.currency,x,!0,b)})," ","to reconcile your account balance."]})]})]})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.notes")}),t.jsx("textarea",{id:"notes",value:$,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:s("account.notesPlaceholder")})]}),A.submit&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:t.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:A.submit})}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[M&&t.jsx("button",{type:"button",onClick:()=>{B(!1),L("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel Adjustment"}),!M&&t.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:s("common.cancel")}),t.jsx("button",{type:"submit",disabled:n.isPending||l.isPending,className:m("flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",M?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:n.isPending||l.isPending?s("common.saving"):M?"Confirm Adjustment":s(a?"common.update":"common.create")})]})]})]})]});return"undefined"==typeof document?null:i.createPortal(R,document.body)}const Re=["eth","bsc","polygon"];function Ke({token:e,isPrivacyMode:r}){return t.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.logo_url?t.jsx("img",{src:e.logo_url,alt:e.symbol,className:"w-5 h-5 rounded-full",onError:e=>{e.target.style.display="none"}}):t.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-[10px] font-medium",children:e.symbol.slice(0,2)}),t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate",children:e.symbol})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:r?"***":Number(e.balance)<1e-4?"<0.0001":Number(e.balance).toFixed(4)}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r?"$***":`$${Number(e.balance_usd).toFixed(2)}`})]})]})}function Ee(){const{t:e}=H("common"),n=r(),{currency:l}=b(),{isPrivacyMode:i}=c(),o=p(),[x,m]=d.useState(!1),[g,y]=d.useState(""),[h,F]=d.useState(""),[$,D]=d.useState(["eth","bsc","polygon"]),[A,P]=d.useState(null),[q,L]=d.useState(null),{data:M,isLoading:B}=a({queryKey:["crypto-wallets"],queryFn:_}),{data:z}=a({queryKey:["crypto-wallets-balance",null==M?void 0:M.map(e=>e.id)],queryFn:async()=>M&&0!==M.length?Promise.all(M.map(e=>S(e.id))):[],enabled:!!M&&M.length>0}),{data:T,isLoading:R}=a({queryKey:["crypto-portfolio",q],queryFn:()=>C(q),enabled:!!q}),K=s({mutationFn:j,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),m(!1),y(""),F(""),D(["eth","bsc","polygon"])}}),E=s({mutationFn:v,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),n.invalidateQueries({queryKey:["crypto-wallets-balance"]})}}),I=s({mutationFn:f,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),n.invalidateQueries({queryKey:["crypto-wallets-balance"]}),n.invalidateQueries({queryKey:["dashboard-summary"]}),P(null)},onError:()=>{P(null)}}),V=e=>`${e.slice(0,6)}...${e.slice(-4)}`,O=(e,t)=>{const r={eth:`https://etherscan.io/address/${e}`,bsc:`https://bscscan.com/address/${e}`,polygon:`https://polygonscan.com/address/${e}`,arbitrum:`https://arbiscan.io/address/${e}`,optimism:`https://optimistic.etherscan.io/address/${e}`};return r[t]||r.eth},Q=(null==z?void 0:z.reduce((e,t)=>e+Number(t.total_balance_usd||0),0))||0,U=1/((null==o?void 0:o.USD)||.00667),ae=Math.round(Q*U);return B?t.jsx(W,{title:e("crypto.wallets"),badge:0,children:t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(N,{size:"md"})})}):t.jsxs(W,{title:e("crypto.wallets"),badge:(null==M?void 0:M.length)||0,defaultOpen:M&&M.length>0,children:[z&&z.length>0&&t.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg",children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e("crypto.totalBalance")}),t.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:u(ae,l,o,!1,i)})]}),z&&z.length>0?t.jsx("div",{className:"space-y-3 mb-4",children:z.map(r=>{var a,s;return t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:t.jsx(J,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:r.label||V(r.wallet_address)}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[t.jsx("code",{className:"text-xs",children:V(r.wallet_address)}),t.jsx("a",{href:O(r.wallet_address,"eth"),target:"_blank",rel:"noopener noreferrer",className:"hover:text-purple-500",children:t.jsx(X,{className:"w-3 h-3"})})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i?"$***":`$${Number(r.total_balance_usd||0).toFixed(2)}`}),t.jsx("div",{className:"flex gap-1 mt-1",children:null==(a=r.chains)?void 0:a.map(e=>{var r;return t.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",title:null==(r=Y[e])?void 0:r.name,children:e.toUpperCase()},e)})})]})]}),t.jsxs("button",{onClick:()=>{return e=r.id,void L(t=>t===e?null:e);var e},className:"flex items-center gap-2 mt-3 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors",children:[q===r.id?t.jsx(G,{className:"w-4 h-4"}):t.jsx(Z,{className:"w-4 h-4"}),e("crypto.tokens")]}),q===r.id&&t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:R?t.jsx("div",{className:"flex justify-center py-4",children:t.jsx(N,{size:"sm"})}):(null==T?void 0:T.chains)&&T.chains.length>0?t.jsx("div",{className:"space-y-4",children:T.chains.filter(e=>e.tokens.length>0||e.native_balance).sort((e,t)=>Number(t.total_usd)-Number(e.total_usd)).map(e=>t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:e.chain_name}),t.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:i?"$***":`$${Number(e.total_usd).toFixed(2)}`})]}),t.jsxs("div",{className:"space-y-1",children:[e.native_balance&&Number(e.native_balance.balance)>0&&t.jsx(Ke,{token:e.native_balance,isPrivacyMode:i}),e.tokens.filter(e=>Number(e.balance_usd)>=1).sort((e,t)=>Number(t.balance_usd)-Number(e.balance_usd)).map(e=>t.jsx(Ke,{token:e,isPrivacyMode:i},e.token_address))]})]},e.chain_id))}):t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-2",children:e("crypto.noTokens")})}),t.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:(null==(s=r.sync_statuses)?void 0:s.some(e=>e.last_sync_at))?e("crypto.lastSync",{time:new Date(Math.max(...r.sync_statuses.filter(e=>e.last_sync_at).map(e=>new Date(e.last_sync_at).getTime()))).toLocaleString()}):e("crypto.neverSynced")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{return e=r.id,P(e),void I.mutate(e);var e},disabled:A===r.id,className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg transition-colors",title:e("crypto.sync"),children:A===r.id?t.jsx(N,{size:"sm"}):t.jsx(ee,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{return t=r.id,void(confirm(e("common.confirmDelete"))&&E.mutate(t));var t},className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:e("common.delete"),children:t.jsx(te,{className:"w-4 h-4"})})]})]})]},r.id)})}):x?null:t.jsxs("div",{className:"text-center py-6",children:[t.jsx(J,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:e("crypto.noWallets")}),t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:e("crypto.addWalletDescription")})]}),x?t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[t.jsx(k,{label:e("crypto.walletAddress"),placeholder:"0x...",value:g,onChange:e=>y(e.target.value)}),t.jsx(k,{label:e("crypto.walletLabel"),placeholder:e("crypto.walletLabelPlaceholder"),value:h,onChange:e=>F(e.target.value)}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("crypto.selectChains")}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Re.map(e=>{var r;return t.jsx("button",{type:"button",onClick:()=>(e=>{D(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:"px-3 py-1.5 rounded-lg text-sm font-medium transition-colors "+($.includes(e)?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:(null==(r=Y[e])?void 0:r.name)||e.toUpperCase()},e)})})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[t.jsx(w,{variant:"outline",onClick:()=>m(!1),children:e("common.cancel")}),t.jsx(w,{onClick:()=>{g.trim()&&K.mutate({wallet_address:g.trim(),label:h.trim()||void 0,chains:$})},disabled:!g.trim()||0===$.length||K.isPending,children:K.isPending?e("common.saving"):e("crypto.addWallet")})]})]}):t.jsxs(w,{variant:"outline",onClick:()=>m(!0),className:"w-full",children:[t.jsx(re,{className:"w-4 h-4 mr-2"}),e("crypto.addWallet")]})]})}function Ie({snapshots:e}){const{resolvedTheme:r}=F(),a="dark"===r,s=a?"#374151":"#E5E7EB",n=a?"#9CA3AF":"#6B7280",l=a?"#1F2937":"#FFFFFF",i=a?"#374151":"#E5E7EB",o="#6366F1",c=d.useMemo(()=>[...e].sort((e,t)=>new Date(e.snapshot_date).getTime()-new Date(t.snapshot_date).getTime()).map(e=>({date:e.snapshot_date,value:Number(e.balance_usd),formattedDate:new Date(e.snapshot_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})),[e]),[x,m]=d.useMemo(()=>{const e=c.map(e=>e.value),t=Math.min(...e),r=Math.max(...e),a=.1*(r-t)||10;return[Math.max(0,t-a),r+a]},[c]);return 0===c.length?t.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No historical data available"}):t.jsx(we,{width:"100%",height:"100%",children:t.jsxs(_e,{data:c,margin:{top:5,right:10,left:0,bottom:5},children:[t.jsx(Se,{strokeDasharray:"3 3",stroke:s,vertical:!1}),t.jsx(Ce,{dataKey:"formattedDate",tick:{fill:n,fontSize:11},tickLine:!1,axisLine:{stroke:s},interval:"preserveStartEnd"}),t.jsx(Fe,{domain:[x,m],tick:{fill:n,fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`$${e.toFixed(0)}`,width:50}),t.jsx($e,{contentStyle:{backgroundColor:l,border:`1px solid ${i}`,borderRadius:"8px",fontSize:"12px"},labelStyle:{color:n,fontWeight:"bold"},formatter:e=>[`$${e.toFixed(2)}`,"Value"]}),t.jsx(De,{type:"monotone",dataKey:"value",stroke:o,strokeWidth:2,dot:c.length<=10,activeDot:{r:6,fill:o}})]})})}function Ve(e){return`${e>=0?"+":""}${e.toFixed(2)}%`}function Oe({positionIds:e}){const{t:r}=H("common"),[s,n]=d.useState(!1),{data:l,isLoading:i,error:o}=a({queryKey:["hodl-scenarios",e],queryFn:()=>$(e),enabled:e.length>=2,staleTime:3e5});if(e.length<2)return null;if(i)return t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:t.jsx("div",{className:"flex items-center justify-center py-4",children:t.jsx(N,{size:"sm"})})});if(o||!l)return null;const c=l.scenarios.find(e=>"lp"===e.type),x=l.scenarios[0],m=Number(null==x?void 0:x.value_usd)||0;return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[t.jsxs("button",{onClick:()=>n(!s),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ae,{className:"w-5 h-5 text-amber-500"}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r("crypto.hodlScenarios.title")})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:(()=>{if(!x||!c)return"";if("lp"===x.type)return r("crypto.hodlScenarios.lpWinning",{pct:Ve(Number(x.return_pct))});const e=Number(x.value_usd)-Number(c.value_usd);return r("crypto.hodlScenarios.alternativeBetter",{name:x.name,diff:e.toFixed(2)})})()}),s?t.jsx(se,{className:"w-5 h-5 text-gray-400"}):t.jsx(G,{className:"w-5 h-5 text-gray-400"})]})]}),s&&t.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[t.jsx("div",{className:"space-y-3",children:l.scenarios.map((e,r)=>t.jsx(Qe,{scenario:e,maxValue:m,isWinner:0===r,isLp:"lp"===e.type},e.name))}),t.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[t.jsxs("span",{children:[r("crypto.hodlScenarios.initialValue"),": $",Number(l.initial_value_usd).toFixed(2)]}),t.jsxs("span",{children:[r("crypto.hodlScenarios.period"),": ",l.days_held," ",r("crypto.days")]})]}),x&&"lp"!==x.type&&c&&t.jsxs("p",{className:"mt-2 text-sm text-amber-600 dark:text-amber-400",children:["ðŸ’¡ ",r("crypto.hodlScenarios.insight",{name:x.name,diff:Math.abs(Number(l.winner_vs_lp_usd)).toFixed(2)})]}),x&&"lp"===x.type&&t.jsxs("p",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:["âœ“ ",r("crypto.hodlScenarios.lpOptimal")]})]})]})]})}function Qe({scenario:e,maxValue:r,isWinner:a,isLp:s}){const n=function(e,t){return t<=0?0:Math.min(100,e/t*100)}(Number(e.value_usd),r),l=(d=Number(e.return_pct))>0?"text-green-600 dark:text-green-400":d<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";var d;return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),a&&t.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded",children:"Best"}),s&&!a&&t.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:"LP"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["$",Number(e.value_usd).toFixed(2)]}),t.jsxs("span",{className:`flex items-center gap-0.5 text-sm ${l}`,children:[Number(e.return_pct)>=0?t.jsx(ne,{className:"w-3 h-3"}):t.jsx(le,{className:"w-3 h-3"}),Ve(Number(e.return_pct))]})]})]}),t.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-300 "+(s?"bg-indigo-500":"hodl_balanced"===e.type?"bg-purple-500":"bg-blue-500"),style:{width:`${n}%`}})})]})}function Ue({positionId:e}){var n,l;const{t:i}=H(),o=r(),[c,x]=d.useState(null),[m,u]=d.useState(!1),[g,y]=d.useState(null),[h,p]=d.useState(null),[b,j]=d.useState(null),{data:v,isLoading:f}=a({queryKey:["position-roi",e],queryFn:()=>q(e)}),{data:N=[]}=a({queryKey:["position-rewards-list",e],queryFn:()=>L(e)}),k=s({mutationFn:()=>D(90),onSuccess:e=>{x({scanned:e.scanned_claims,new:e.new_claims}),o.invalidateQueries({queryKey:["position-roi"]}),o.invalidateQueries({queryKey:["position-rewards-list"]}),o.invalidateQueries({queryKey:["unattributed-rewards"]}),setTimeout(()=>x(null),5e3)}}),w=s({mutationFn:e=>A(e),onSuccess:e=>{p(i("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:e.amount_usd.toFixed(2)})),o.invalidateQueries({queryKey:["position-rewards-list"]}),o.invalidateQueries({queryKey:["transactions"]}),y(null),setTimeout(()=>p(null),5e3)},onError:e=>{j(e.message||i("crypto.transactionCreateError","Failed to create transaction")),y(null),setTimeout(()=>j(null),5e3)}}),_=s({mutationFn:e=>P(e),onSuccess:e=>{const t=i("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:e.created,total:e.total_usd.toFixed(2),skipped:e.skipped});p(t),o.invalidateQueries({queryKey:["position-rewards-list"]}),o.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>p(null),8e3)},onError:e=>{j(e.message||i("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>j(null),5e3)}}),S=N.filter(e=>!e.transaction_id),C=(null==(n=null==v?void 0:v.rewards_by_token)?void 0:n.filter(e=>Number(e.amount_usd)>=1))||[],F=(null==(l=null==v?void 0:v.rewards_by_month)?void 0:l.filter(e=>Number(e.amount_usd)>=1))||[],$=N.filter(e=>Number(e.reward_usd||0)>=1),M=C.reduce((e,t)=>e+Number(t.amount_usd||0),0);if(f)return t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const B=e=>{if(null==e)return null;const t=Number(e);return isNaN(t)?null:`$${t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},z=e=>{const[t,r]=e.split("-");return new Date(Number(t),Number(r)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},T=e=>Number(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[t.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:i("crypto.scanRewardsHint","Scan blockchain for claimed rewards")}),t.jsx("button",{onClick:()=>k.mutate(),disabled:k.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:k.isPending?t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"h-4 w-4 animate-spin"}),i("crypto.scanning","Scanning...")]}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"h-4 w-4"}),i("crypto.scanRewards","Scan Rewards")]})})]}),c&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(de,{className:"h-4 w-4"}),i("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",c)]}),v&&t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[t.jsx(ne,{className:"h-4 w-4"}),i("crypto.roiSummary","ROI Summary")]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:i("crypto.totalRewards","Total Rewards")}),C.length>0?t.jsx("div",{className:"space-y-1",children:C.map(e=>{const r=B(e.amount_usd);return t.jsxs("div",{children:[t.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[T(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",r]})]},e.symbol)})}):t.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:B(M)||"-"}),t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[$.length," ",i("crypto.claims","claims")]})]}),null!==v.cost_basis_usd&&null!==v.simple_roi_pct&&t.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-green-200 dark:border-green-800",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:i("crypto.costBasis","Cost Basis")}),t.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:B(v.cost_basis_usd)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:i("crypto.roi","ROI")}),t.jsx("div",{className:"text-lg font-semibold "+(v.simple_roi_pct>=0?"text-green-800 dark:text-green-200":"text-red-600 dark:text-red-400"),children:(e=>{if(null===e)return"-";const t=Number(e);return`${t>=0?"+":""}${t.toFixed(2)}%`})(v.simple_roi_pct)}),v.days_held&&t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[v.days_held," ",i("crypto.daysHeld","days")]})]})]})]})]}),v&&F.length>0&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[t.jsx(ie,{className:"h-4 w-4"}),i("crypto.monthlyBreakdown","Monthly Breakdown")]}),t.jsx("div",{className:"space-y-2",children:F.map(e=>{const r=B(e.amount_usd);return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:z(e.month)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.count," ",i("crypto.claims","claims")]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[T(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",r]})]})]},`${e.month}-${e.symbol}`)})})]}),$.length>0&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-2 font-medium text-gray-900 dark:text-gray-100 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[t.jsx(oe,{className:"h-4 w-4"}),i("crypto.allRewards","All Rewards")," (",$.length,")",m?t.jsx(se,{className:"h-4 w-4"}):t.jsx(G,{className:"h-4 w-4"})]}),S.length>0&&t.jsxs("button",{type:"button",onClick:()=>_.mutate(S.map(e=>e.id)),disabled:_.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 rounded-lg transition-colors",children:[_.isPending?t.jsx(ce,{className:"h-3.5 w-3.5 animate-spin"}):t.jsx(re,{className:"h-3.5 w-3.5"}),i("crypto.createAllTransactions","Create All Txns")," (",S.length,")"]})]}),m&&t.jsxs(t.Fragment,{children:[h&&t.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(de,{className:"h-4 w-4"}),h]}),b&&t.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[t.jsx(xe,{className:"h-4 w-4"}),b]}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:$.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Number(e.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})," ",e.reward_token_symbol||"tokens"]}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[new Date(e.claimed_at).toLocaleDateString()," via ",e.source,e.reward_usd&&t.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(e.reward_usd).toFixed(2)]})]})]}),e.reward_usd&&Number(e.reward_usd)>0&&t.jsx("div",{className:"flex-shrink-0 ml-3",children:e.transaction_id?t.jsxs("a",{href:`/transactions?id=${e.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[t.jsx(X,{className:"h-3 w-3"}),i("crypto.viewTransaction","View Txn")]}):t.jsxs("button",{type:"button",onClick:()=>{y(e.id),w.mutate(e.id)},disabled:g===e.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[g===e.id?t.jsx(ce,{className:"h-3 w-3 animate-spin"}):t.jsx(oe,{className:"h-3 w-3"}),i("crypto.createTransaction","Create Txn")]})})]},e.id))})]})]}),v&&0===$.length&&t.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[t.jsx(me,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),M<1?i("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:1}):i("crypto.noRewards","No rewards claimed for this position yet.")]})]})}function He({source:e="symbiotic"}){var n,l;const{t:i}=H(),o=r(),[c,x]=d.useState(null),{data:m,isLoading:u}=a({queryKey:["staking-rewards",e],queryFn:()=>M(e)}),g=s({mutationFn:()=>D(90),onSuccess:e=>{x({scanned:e.scanned_claims,new:e.new_claims}),o.invalidateQueries({queryKey:["staking-rewards"]}),setTimeout(()=>x(null),5e3)}});if(u)return t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const y=e=>{if(null==e)return null;const t=Number(e);return isNaN(t)?null:`$${t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},h=e=>{const[t,r]=e.split("-");return new Date(Number(t),Number(r)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},p=e=>Number(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4}),b="symbiotic"===e?"Symbiotic":e,j=(null==(n=null==m?void 0:m.rewards_by_token)?void 0:n.filter(e=>Number(e.amount_usd)>=1))||[],v=(null==(l=null==m?void 0:m.rewards_by_month)?void 0:l.filter(e=>Number(e.amount_usd)>=1))||[],f=j.reduce((e,t)=>e+Number(t.amount_usd||0),0);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[t.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:i("crypto.scanStakingRewardsHint","Scan blockchain for claimed staking rewards")}),t.jsx("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:g.isPending?t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"h-4 w-4 animate-spin"}),i("crypto.scanning","Scanning...")]}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"h-4 w-4"}),i("crypto.scanRewards","Scan Rewards")]})})]}),c&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(de,{className:"h-4 w-4"}),i("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",c)]}),m&&j.length>0&&t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[t.jsx(ne,{className:"h-4 w-4"}),i("crypto.stakingRewardsSummary","{{source}} Rewards Summary",{source:b})]}),t.jsx("div",{className:"space-y-3",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:i("crypto.totalRewards","Total Rewards")}),j.length>0?t.jsx("div",{className:"space-y-1",children:j.map(e=>{const r=y(e.amount_usd);return t.jsxs("div",{children:[t.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[p(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",r]})]},e.symbol)})}):t.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:y(f)||"-"}),t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[v.reduce((e,t)=>e+t.count,0)," ",i("crypto.claims","claims")]})]})})]}),m&&v.length>0&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[t.jsx(ie,{className:"h-4 w-4"}),i("crypto.monthlyBreakdown","Monthly Breakdown")]}),t.jsx("div",{className:"space-y-2",children:v.map(e=>{const r=y(e.amount_usd);return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:h(e.month)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.count," ",i("crypto.claims","claims")]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[p(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",r]})]})]},`${e.month}-${e.symbol}`)})})]}),m&&0===j.length&&t.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[t.jsx(me,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:f<1?i("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:1}):i("crypto.noStakingRewards","No staking rewards found")}),t.jsx("p",{className:"text-sm",children:i("crypto.noStakingRewardsHint",'Click "Scan Rewards" to search for claimed rewards on the blockchain.')})]})]})}async function We(){return(await B.get("/api/crypto/positions/closed")).data}function Ye({group:e,lastSnapshotValueUsd:n,costBasisUsd:l,totalRewardsUsd:c,onClose:x,onSuccess:m}){var u;const{t:g}=H("common"),{data:y}=o(),h=(null==(u=null==y?void 0:y.rates)?void 0:u.USD)||150,p=r(),[b,j]=d.useState((new Date).toISOString().slice(0,16)),[v,f]=d.useState(n),[N,k]=d.useState(Math.round(n*h)),[w,_]=d.useState(null),[S,C]=d.useState(`LP Exit: ${e.protocol} ${e.name}`),[F,$]=d.useState("");d.useEffect(()=>{k(Math.round(v*h))},[v,h]);const{data:D}=a({queryKey:["accounts"],queryFn:()=>z()}),A=(null==D?void 0:D.filter(e=>e.is_active&&("bank"===e.type||"savings"===e.type)))||[],P=null!==l?v-l+(c||0):null,q=l&&null!==P?P/l*100:null,L=e.tokens[0],M=(null==L?void 0:L.id)||"",T=(null==L?void 0:L.wallet_address)||"",R=s({mutationFn:()=>{if(!w)throw new Error(g("crypto.selectAccount","Select destination account"));const t={exit_date:new Date(b).toISOString(),exit_value_usd:v,exit_value_jpy:N,destination_account_id:w,note:S||void 0,tx_hash:F||void 0,wallet_address:T,chain_id:e.chain_id,protocol:e.protocol,symbol:e.name};return async function(e,t){return(await B.post(`/api/crypto/positions/${encodeURIComponent(e)}/close`,t)).data}(M,t)},onSuccess:()=>{p.invalidateQueries({queryKey:["closed-positions"]}),p.invalidateQueries({queryKey:["defi-positions"]}),p.invalidateQueries({queryKey:["accounts"]}),m(),x()}}),K=t.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-hidden",style:{touchAction:"pan-y"},children:[t.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:x}),t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:g("crypto.closePosition","Close Position")}),t.jsx("button",{onClick:x,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:t.jsx(xe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[t.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.protocol," - ",e.name]}),t.jsx("p",{className:"text-xs text-gray-500",children:e.chain_id.toUpperCase()})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t.jsx(ie,{className:"w-4 h-4 inline mr-1"}),g("crypto.exitDate","Exit Date")]}),t.jsx("input",{type:"datetime-local",value:b,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t.jsx(ue,{className:"w-4 h-4 inline mr-1"}),g("crypto.exitValue","Exit Value")," (USD)"]}),t.jsx("input",{type:"number",step:"0.01",value:v,onChange:e=>f(parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[g("crypto.exitValue","Exit Value")," (JPY)"]}),t.jsx("input",{type:"number",value:N,onChange:e=>k(parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t.jsx(J,{className:"w-4 h-4 inline mr-1"}),g("crypto.destinationAccount","Destination Account")]}),t.jsxs("select",{value:w||"",onChange:e=>_(parseInt(e.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:g("common.select","Select...")}),A.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:g("common.note","Note")}),t.jsx("input",{type:"text",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["TX Hash (",g("common.optional","optional"),")"]}),t.jsx("input",{type:"text",value:F,onChange:e=>$(e.target.value),placeholder:"0x...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-sm"})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:g("crypto.pnlPreview","P&L Preview")}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:g("crypto.costBasis","Cost Basis")}),t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:null!==l?`$${l.toFixed(2)}`:"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:g("crypto.totalRewards","Total Rewards")}),t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:c?`$${c.toFixed(2)}`:"$0.00"})]}),t.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("p",{className:"text-gray-500",children:g("crypto.realizedPnl","Realized P&L")}),t.jsx("p",{className:"text-lg font-bold "+(null!==P?P>=0?"text-green-600":"text-red-600":"text-gray-400"),children:null!==P?`${P>=0?"+":""}$${P.toFixed(2)} (${null==q?void 0:q.toFixed(1)}%)`:"N/A"})]})]})]}),R.error&&t.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[t.jsx(ge,{className:"w-4 h-4"}),R.error.message]})]}),t.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:x,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",children:g("common.cancel","Cancel")}),t.jsx("button",{onClick:()=>R.mutate(),disabled:!w||R.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:R.isPending?g("common.loading","Loading..."):g("crypto.confirmClose","Confirm Close")})]})]})]});return"undefined"==typeof document?null:i.createPortal(K,document.body)}function Je(e,t=2){const r=Number(e);return`${r>=0?"+":""}${r.toFixed(t)}`}function Xe({level:e}){const r={low:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",medium:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",high:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"};return t.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${r[e]||r.medium}`,children:e.toUpperCase()})}function Ge({performance:e}){const{t:r}=H("common"),a=Number(e.total_return_pct)>=0;return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:r("crypto.performance")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.totalReturn")}),t.jsxs("p",{className:"text-lg font-bold "+(a?"text-green-600":"text-red-600"),children:[Je(e.total_return_pct),"%"]}),t.jsxs("p",{className:"text-xs text-gray-500",children:["$",Je(e.total_return_usd)]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.annualized")}),null!==e.annualized_return_pct?t.jsxs("p",{className:"text-lg font-bold "+(Number(e.annualized_return_pct)>=0?"text-green-600":"text-red-600"),children:[Je(e.annualized_return_pct),"%"]}):t.jsx("p",{className:"text-lg font-bold text-gray-400",children:"N/A"}),t.jsxs("p",{className:"text-xs text-gray-500",children:[e.days_held," ",r("crypto.days")]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.currentValue")}),t.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["$",Number(e.current_value_usd).toFixed(2)]}),t.jsxs("p",{className:"text-xs text-gray-500",children:[r("crypto.from")," $",Number(e.start_value_usd).toFixed(2)]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.currentApy")}),t.jsx("p",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:null!=e.current_apy?`${Number(e.current_apy).toFixed(2)}%`:"N/A"}),t.jsxs("p",{className:"text-xs text-gray-500",children:[e.snapshot_count," ",r("crypto.snapshots")]})]})]})]})}function Ze({performance:e}){const{t:r}=H("common");if(null==e.il_percentage)return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:r("crypto.impermanentLoss")}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:r("crypto.ilNotAvailable")})]});const a=Number(e.il_percentage)<0;return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:r("crypto.impermanentLoss")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.ilPercentage")}),t.jsxs("p",{className:"text-lg font-bold "+(a?"text-red-600":"text-green-600"),children:[Number(e.il_percentage).toFixed(2),"%"]}),t.jsxs("p",{className:"text-xs text-gray-500",children:["$",null!=e.il_usd?Number(e.il_usd).toFixed(2):"0.00"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.hodlValue")}),t.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["$",null!=e.hodl_value_usd?Number(e.hodl_value_usd).toFixed(2):"N/A"]})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.lpVsHodl")}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.lp_outperformed_hodl?t.jsxs(t.Fragment,{children:[t.jsx(ne,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-green-600 font-medium",children:r("crypto.lpOutperformed")})]}):t.jsxs(t.Fragment,{children:[t.jsx(le,{className:"w-4 h-4 text-red-600"}),t.jsx("span",{className:"text-red-600 font-medium",children:r("crypto.hodlOutperformed")})]}),t.jsxs("span",{className:"text-gray-500 text-sm",children:["($",Math.abs(Number(e.lp_vs_hodl_usd)||0).toFixed(2),")"]})]})]}),null!=e.estimated_yield_pct&&t.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("crypto.estimatedYield")}),t.jsxs("p",{className:"text-green-600 font-bold",children:[Je(e.estimated_yield_pct),"%",t.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["($",null!=e.estimated_yield_usd?Number(e.estimated_yield_usd).toFixed(2):"0.00",")"]})]})]})]})]})}function et({insights:e,isLoading:r}){const{t:a}=H("common"),[s,n]=d.useState(!1);return r?t.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg border border-indigo-200 dark:border-indigo-800 p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(he,{className:"w-4 h-4 text-indigo-600"}),t.jsx("h3",{className:"text-sm font-medium text-indigo-700 dark:text-indigo-300",children:a("crypto.aiInsights")})]}),t.jsx("div",{className:"flex justify-center py-4",children:t.jsx(N,{size:"sm"})})]}):e?t.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg border border-indigo-200 dark:border-indigo-800 p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(he,{className:"w-4 h-4 text-indigo-600"}),t.jsx("h3",{className:"text-sm font-medium text-indigo-700 dark:text-indigo-300",children:a("crypto.aiInsights")})]}),t.jsx(Xe,{level:e.risk_level})]}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3",children:e.summary}),e.il_analysis&&t.jsxs("div",{className:"bg-white/50 dark:bg-gray-800/50 rounded p-2 mb-3",children:[t.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:a("crypto.ilAnalysis")}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e.il_analysis})]}),t.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[t.jsx(ye,{className:"w-4 h-4 text-amber-500 mt-0.5 flex-shrink-0"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e.observation})]}),(e.scenario_up||e.scenario_down)&&t.jsxs("button",{onClick:()=>n(!s),className:"flex items-center gap-1 text-indigo-600 dark:text-indigo-400 text-sm hover:underline",children:[s?t.jsx(se,{className:"w-4 h-4"}):t.jsx(G,{className:"w-4 h-4"}),a("crypto.viewScenarios")]}),s&&t.jsxs("div",{className:"mt-3 space-y-2",children:[e.scenario_up&&t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded p-2",children:[t.jsx("p",{className:"text-xs font-medium text-green-700 dark:text-green-400",children:a("crypto.priceUp20")}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e.scenario_up})]}),e.scenario_down&&t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded p-2",children:[t.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-400",children:a("crypto.priceDown20")}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e.scenario_down})]})]}),e.recommendation&&t.jsx("div",{className:"mt-3 pt-3 border-t border-indigo-200 dark:border-indigo-700",children:t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs italic",children:e.recommendation})}),t.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-500",children:a("crypto.insightsDisclaimer")})]}):null}function tt({group:e,onClose:r}){const{t:s,i18n:l}=H("common");b();const o=Y[e.chain_id],[c,x]=d.useState("overview"),[m,u]=d.useState(!1),g=e.tokens[0],y=n({queries:e.tokens.map(e=>({queryKey:["position-history",e.id],queryFn:()=>T(e.id,30),retry:!1}))}),h=y.some(e=>e.isLoading),p=y.every(e=>e.isError),j=d.useMemo(()=>{const e=y.filter(e=>{var t;return null==(t=e.data)?void 0:t.snapshots}).flatMap(e=>e.data.snapshots);if(0===e.length)return null;const t=new Map;for(const r of e){const e=t.get(r.snapshot_date)||0;t.set(r.snapshot_date,e+Number(r.balance_usd))}return{snapshots:Array.from(t.entries()).map(([e,t])=>({snapshot_date:e,balance_usd:t}))}},[y]),v=n({queries:e.tokens.map(e=>({queryKey:["position-performance",e.id],queryFn:()=>R(e.id),retry:!1}))}),f=v.some(e=>e.isLoading),k=v.every(e=>e.isError),w=v.every(e=>!e.isLoading),_=d.useMemo(()=>{if(!w)return null;const t=v.filter(e=>e.data);if(0===t.length)return null;const r=t[0].data;if(1===t.length)return r;let a=0,s=0,n=0,l=0,d=0,i=!1,o=0,c=0;for(const e of t){const t=e.data;a+=Number(t.start_value_usd),s+=Number(t.current_value_usd),n+=Number(t.total_return_usd),l=Math.max(l,t.days_held),d+=t.snapshot_count,null!=t.il_usd&&(i=!0,o+=Number(t.il_usd)),null!=t.hodl_value_usd&&(c+=Number(t.hodl_value_usd))}const x=a>0?n/a*100:0;let m=null;if(l>=7&&a>0){const e=100*((s/a)**(365/l)-1);Math.abs(e)<=500&&(m=e)}return{position_id:r.position_id,protocol:r.protocol,symbol:e.name,days_held:l,start_value_usd:a,current_value_usd:s,total_return_usd:n,total_return_pct:x,annualized_return_pct:m,current_apy:r.current_apy,snapshot_count:d,il_percentage:i&&a>0?o/a*100:null,il_usd:i?o:null,hodl_value_usd:i?c:null,lp_vs_hodl_usd:i?s-c:null,lp_outperformed_hodl:i?s>c:void 0}},[v,e.name,w]),{data:S,isLoading:C}=a({queryKey:["position-insights",g.id,l.language],queryFn:()=>K(g.id,l.language),enabled:!!_&&!k,retry:!1}),{data:F}=a({queryKey:["position-roi",g.id],queryFn:()=>q(g.id),retry:!1}),$=h||f,D=p||k,A=e=>{const t=Number(e.balance);return t<1e-4?"<0.0001":t<1?t.toFixed(4):t.toFixed(2)},P=t.jsxs("div",{className:"fixed inset-0 z-[100001]",children:[t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),t.jsxs("div",{className:"fixed inset-0 z-[100002] flex items-center justify-center p-4 overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[t.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90dvh] my-auto",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[t.jsx("div",{className:"relative flex -space-x-2",children:e.tokens.slice(0,3).map((r,a)=>r.logo_url?t.jsx("img",{src:r.logo_url,alt:r.symbol,className:"w-10 h-10 rounded-full border-2 border-white dark:border-gray-900",style:{zIndex:e.tokens.length-a},onError:e=>{e.target.style.display="none"}},r.id):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs border-2 border-white dark:border-gray-900",style:{zIndex:e.tokens.length-a},children:r.symbol.slice(0,2)},r.id))}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white truncate",children:[e.protocol," - ",e.name]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[o&&t.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded",children:[o.icon," ",e.chain_id.toUpperCase()]}),t.jsx("span",{children:e.position_type})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.jsx("button",{onClick:()=>u(!0),className:"px-3 py-1.5 text-sm bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50",children:s("crypto.closePosition","Close Position")}),t.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:t.jsx(xe,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:()=>x("overview"),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors "+("overview"===c?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:s("crypto.overview","Overview")}),t.jsxs("button",{onClick:()=>x("rewards"),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2 "+("rewards"===c?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:[t.jsx(me,{className:"w-4 h-4"}),s("crypto.rewards","Rewards")]})]}),t.jsx("div",{className:"p-4 space-y-4",children:$?t.jsx("div",{className:"flex justify-center py-12",children:t.jsx(N,{size:"lg"})}):t.jsxs(t.Fragment,{children:["overview"===c&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-center py-4",children:[t.jsx("p",{className:"text-sm text-gray-500",children:s("crypto.currentValue")}),t.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["$",e.total_usd.toFixed(2)]}),t.jsx("div",{className:"text-sm text-gray-500 mt-1",children:e.tokens.map((e,r)=>t.jsxs("span",{children:[r>0&&" + ",A(e)," ",e.symbol]},e.id))})]}),e.tokens.length>1&&t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:s("crypto.tokenBreakdown","Token Breakdown")}),t.jsx("div",{className:"space-y-2",children:e.tokens.map(e=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[e.logo_url?t.jsx("img",{src:e.logo_url,alt:e.symbol,className:"w-6 h-6 rounded-full"}):t.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold",children:e.symbol.slice(0,2)}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.symbol})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:A(e)}),t.jsxs("p",{className:"text-xs text-gray-500",children:["$",Number(e.balance_usd).toFixed(2)]})]})]},e.id))})]}),D&&t.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(ye,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-300",children:s("crypto.noHistoricalDataTitle")}),t.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-1",children:s("crypto.noHistoricalDataMessage")})]})]})}),j&&j.snapshots.length>0&&t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:[s("crypto.valueHistory")," (",s("crypto.combinedValue","Combined Value"),")"]}),t.jsx("div",{className:"h-48",children:t.jsx(Ie,{snapshots:j.snapshots})})]}),_&&(()=>{const r=e.total_usd,a=Number(_.start_value_usd),s=r-a,n=a>0?s/a*100:0,l=_.days_held||1;let d=null;if(l>=7&&a>0){const e=100*((r/a)**(365/l)-1);d=Math.abs(e)<=500?e:null}return t.jsx(Ge,{performance:{..._,current_value_usd:r,total_return_usd:s,total_return_pct:n,annualized_return_pct:d}})})(),_&&t.jsx(Ze,{performance:_}),e.tokens.length>=2&&t.jsx(Oe,{positionIds:e.tokens.map(e=>e.id)}),!D&&t.jsx(et,{insights:S,isLoading:C})]}),"rewards"===c&&("staked"===e.protocol_module?t.jsx(He,{source:"symbiotic"}):t.jsx(Ue,{positionId:g.id}))]})})]}),m&&t.jsx(Ye,{group:e,lastSnapshotValueUsd:e.total_usd,costBasisUsd:(null==F?void 0:F.cost_basis_usd)??null,totalRewardsUsd:(null==F?void 0:F.total_rewards_usd)??null,onClose:()=>u(!1),onSuccess:()=>{u(!1),r()}})]})]});return"undefined"==typeof document?null:i.createPortal(P,document.body)}function rt({walletId:e}){const{t:n}=H(),l=r(),[i,o]=d.useState(new Set),[c,x]=d.useState(""),{data:m=[]}=a({queryKey:["unattributed-rewards"],queryFn:I}),{data:u}=a({queryKey:["defi-positions",e],queryFn:()=>V(e),enabled:!!e}),g=s({mutationFn:({rewardIds:e,positionId:t})=>E(e,t),onSuccess:()=>{l.invalidateQueries({queryKey:["unattributed-rewards"]}),l.invalidateQueries({queryKey:["position-rewards"]}),o(new Set),x("")}}),[y,h]=d.useState(null),[p,b]=d.useState(null),[j,v]=d.useState(null),f=s({mutationFn:e=>A(e),onSuccess:e=>{b(n("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:e.amount_usd.toFixed(2)})),l.invalidateQueries({queryKey:["unattributed-rewards"]}),l.invalidateQueries({queryKey:["transactions"]}),h(null),setTimeout(()=>b(null),5e3)},onError:e=>{v(e.message||n("crypto.transactionCreateError","Failed to create transaction")),h(null),setTimeout(()=>v(null),5e3)}});if(0===m.length)return null;const N=m.filter(e=>Number(e.reward_usd||0)>=1);if(0===N.length)return null;const k=(null==u?void 0:u.positions)||[],w=e=>`${Number(e.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})} ${e.reward_token_symbol||"tokens"}`,_=N.length>0&&i.size===N.length,S=i.size>0;return t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(ye,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),t.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:n("crypto.unattributedRewards",{count:N.length})})]}),t.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:n("crypto.unattributedRewardsDesc","These rewards need to be assigned to a position for ROI tracking.")}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-yellow-100 dark:border-gray-700",children:[t.jsxs("button",{type:"button",onClick:()=>{i.size===N.length?o(new Set):o(new Set(N.map(e=>e.id)))},className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[_?t.jsx(pe,{className:"h-4 w-4 text-primary-600"}):t.jsx(be,{className:"h-4 w-4"}),_?n("common.deselectAll","Deselect All"):n("common.selectAll","Select All")]}),t.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[t.jsxs("select",{value:c,onChange:e=>x(e.target.value),disabled:!S,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx("option",{value:"",children:n("crypto.selectPosition","Select position...")}),k.map(e=>t.jsxs("option",{value:e.id,children:[e.protocol," - ",e.symbol]},e.id))]}),t.jsxs("button",{type:"button",onClick:()=>{0!==i.size&&c&&g.mutate({rewardIds:Array.from(i),positionId:c})},disabled:!S||!c||g.isPending,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-md transition-colors disabled:cursor-not-allowed",children:[t.jsx(je,{className:"h-4 w-4"}),g.isPending?n("common.assigning","Assigning..."):n("crypto.assignSelected","Assign {{count}} Selected",{count:i.size})]})]})]}),p&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(de,{className:"h-4 w-4"}),p]}),j&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[t.jsx(xe,{className:"h-4 w-4"}),j]}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.map(e=>{return t.jsxs("div",{onClick:()=>(e=>{const t=new Set(i);t.has(e)?t.delete(e):t.add(e),o(t)})(e.id),className:"flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-colors "+(i.has(e.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700":"bg-white dark:bg-gray-800 border-yellow-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"),children:[t.jsx("div",{className:"flex-shrink-0",children:i.has(e.id)?t.jsx(pe,{className:"h-5 w-5 text-primary-600"}):t.jsx(be,{className:"h-5 w-5 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:w(e)}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(r=e.claimed_at,new Date(r).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}))," via ",e.source,e.reward_usd&&t.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(e.reward_usd).toFixed(2)]})]})]}),e.reward_usd&&e.reward_usd>0&&t.jsx("div",{className:"flex-shrink-0",onClick:e=>e.stopPropagation(),children:e.transaction_id?t.jsxs("a",{href:`/transactions?id=${e.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[t.jsx(X,{className:"h-3 w-3"}),n("crypto.viewTransaction","View Txn")]}):t.jsxs("button",{type:"button",onClick:()=>{h(e.id),f.mutate(e.id)},disabled:y===e.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[y===e.id?t.jsx(ce,{className:"h-3 w-3 animate-spin"}):t.jsx(oe,{className:"h-3 w-3"}),n("crypto.createTransaction","Create Txn")]})})]},e.id);var r})}),S&&t.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200 dark:border-gray-700 text-sm text-yellow-700 dark:text-yellow-300",children:n("crypto.selectedRewards","{{count}} reward(s) selected",{count:i.size})})]})}const at={deposit:"ðŸ’°",stake:"ðŸ”’",borrow:"ðŸ’¸",reward:"ðŸŽ",liquidity:"ðŸ’§"},st={liquidity_pool:"LP",staking:"Staking",lending:"Lending",farming:"Farming",vault:"Vault"};function nt({group:e,onClick:r,isPrivacyMode:a}){const s=e.chain_id,n=Y[s],l=e.tokens[0],d=a?e.tokens.map(e=>`*** ${e.symbol}`).join(" + "):e.tokens.map(e=>{const t=Number(e.balance);return`${t<1e-4?"<0.0001":t<1?t.toFixed(4):t.toFixed(2)} ${e.symbol}`}).join(" + ");return t.jsxs("button",{onClick:()=>r(e),className:"w-full flex items-center justify-between py-3 px-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors text-left group",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("div",{className:"relative flex-shrink-0",children:e.tokens.length>1?t.jsxs("div",{className:"flex -space-x-2",children:[e.tokens.slice(0,3).map((r,a)=>r.logo_url?t.jsx("img",{src:r.logo_url,alt:r.symbol,className:"w-7 h-7 rounded-full border-2 border-white dark:border-gray-800",style:{zIndex:e.tokens.length-a},onError:e=>{e.target.style.display="none"}},r.id):t.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border-2 border-white dark:border-gray-800",style:{zIndex:e.tokens.length-a},children:r.symbol.slice(0,2)},r.id)),e.tokens.length>3&&t.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",e.tokens.length-3]})]}):l.logo_url?t.jsx("img",{src:l.logo_url,alt:l.symbol,className:"w-8 h-8 rounded-full",onError:e=>{e.target.style.display="none"}}):t.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:at[e.position_type]||"ðŸ“ˆ"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.protocol}),t.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:st[e.protocol_module]||e.protocol_module})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[t.jsx("span",{className:"truncate",children:e.name}),n&&t.jsxs("span",{className:"text-xs px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:[n.icon," ",s.toUpperCase()]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a?"$***":`$${e.total_usd.toFixed(2)}`}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[180px] truncate",children:d})]}),t.jsx(Z,{className:"w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors"})]})]})}function lt(){const{t:e}=H("common"),{currency:r}=b(),{isPrivacyMode:s}=c(),[n,l]=d.useState(null),i=p(),{data:o,isLoading:x}=a({queryKey:["crypto-wallets"],queryFn:_}),{data:m=[]}=a({queryKey:["unattributed-rewards"],queryFn:I}),{data:g,isLoading:y,refetch:h}=a({queryKey:["crypto-defi-positions",null==o?void 0:o.map(e=>e.id)],queryFn:async()=>{if(!o||0===o.length)return[];return await Promise.all(o.map(e=>V(e.id).catch(()=>({wallet_address:e.wallet_address,total_value_usd:0,positions:[],last_sync_at:null}))))},enabled:!!o&&o.length>0}),j=(null==g?void 0:g.flatMap(e=>e.positions))||[],v=function(e){const t={};for(const r of e){const e=`${r.protocol}-${r.chain_id}-${r.name||r.token_name}-${r.position_type}`;t[e]||(t[e]={key:e,name:r.name||r.token_name,protocol:r.protocol,protocol_module:r.protocol_module,position_type:r.position_type,chain_id:r.chain_id,tokens:[],total_usd:0}),t[e].tokens.push(r),t[e].total_usd+=Number(r.balance_usd)}return Object.values(t)}(j),f=(null==g?void 0:g.reduce((e,t)=>e+Number(t.total_value_usd||0),0))||0,k=1/((null==i?void 0:i.USD)||.00667),w=Math.round(f*k),S=v.reduce((e,t)=>{const r=t.protocol;return e[r]||(e[r]=[]),e[r].push(t),e},{});if(x||y)return t.jsx(W,{title:e("crypto.defiPositions"),badge:0,children:t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(N,{size:"md"})})});if(!o||0===o.length)return null;const C=m.length>0?`${v.length} Â· ${m.length} âš `:v.length;return t.jsxs(W,{title:e("crypto.defiPositions"),badge:C,defaultOpen:v.length>0,children:[j.length>0&&t.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e("crypto.totalDefiValue")}),t.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:u(w,r,i,!1,s)})]}),t.jsx("button",{onClick:()=>h(),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors",title:e("crypto.refresh"),children:t.jsx(ee,{className:"w-5 h-5"})})]})}),o[0]&&t.jsx("div",{className:"mb-4",children:t.jsx(rt,{walletId:o[0].id})}),v.length>0?t.jsx("div",{className:"space-y-4",children:Object.entries(S).sort(([,e],[,t])=>{const r=e.reduce((e,t)=>e+t.total_usd,0);return t.reduce((e,t)=>e+t.total_usd,0)-r}).map(([e,r])=>t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[t.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:e}),t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:s?"$***":`$${r.reduce((e,t)=>e+t.total_usd,0).toFixed(2)}`})]})}),t.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:r.sort((e,t)=>t.total_usd-e.total_usd).map(e=>t.jsx(nt,{group:e,onClick:l,isPrivacyMode:s},e.key))})]},e))}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ve,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e("crypto.noDefiPositions")}),t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:e("crypto.noDefiPositionsDescription")})]}),n&&t.jsx(tt,{group:n,onClose:()=>l(null)})]})}function dt(){const{t:e}=H("common"),[r,s]=d.useState(!1),{data:n,isLoading:l}=a({queryKey:["closed-positions"],queryFn:We});return l||!n||0===n.total_closed?null:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[t.jsxs("button",{onClick:()=>s(!r),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-xl",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(fe,{className:"w-5 h-5 text-gray-500"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:e("crypto.closedPositions","Closed Positions")}),t.jsxs("p",{className:"text-sm text-gray-500",children:[n.total_closed," ",e("crypto.positions","positions")]})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[null!==n.total_realized_pnl_jpy&&t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-xs text-gray-500",children:e("crypto.totalPnl","Total P&L")}),t.jsxs("p",{className:"font-medium "+(n.total_realized_pnl_jpy>=0?"text-green-600":"text-red-600"),children:[n.total_realized_pnl_jpy>=0?"+":"",O(n.total_realized_pnl_jpy,"JPY")]})]}),r?t.jsx(se,{className:"w-5 h-5 text-gray-500"}):t.jsx(G,{className:"w-5 h-5 text-gray-500"})]})]}),r&&t.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 space-y-3",children:n.positions.map(e=>{const r=Y[e.chain_id],a=null!==e.realized_pnl_jpy&&e.realized_pnl_jpy>=0;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[e.protocol," - ",e.symbol]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[r&&t.jsx("span",{children:r.icon}),t.jsx("span",{children:new Date(e.exit_date).toLocaleDateString()})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:O(e.exit_value_jpy,"JPY")}),null!==e.realized_pnl_jpy&&t.jsxs("div",{className:"flex items-center justify-end gap-1 text-sm "+(a?"text-green-600":"text-red-600"),children:[a?t.jsx(ne,{className:"w-3 h-3"}):t.jsx(le,{className:"w-3 h-3"}),a?"+":"",O(e.realized_pnl_jpy,"JPY"),null!==e.realized_pnl_pct&&t.jsxs("span",{className:"text-xs",children:["(",e.realized_pnl_pct.toFixed(1),"%)"]})]})]})]},e.id)})})]})}async function it(e){return(await B.post("/api/transfers/",e)).data}const ot={JPY:"Â¥",USD:"$",VND:"â‚«"};function ct(e){const t=e.replace(/[^\d]/g,"");return t?parseInt(t).toLocaleString("en-US"):""}function xt(e){return parseInt(e.replace(/[,.\s]/g,""),10)||0}function mt({isOpen:e,onClose:a}){const{t:n}=H("common"),l=r(),{data:o}=Q(),c=p(),[x,u]=d.useState(null),[g,y]=d.useState(null),[h,b]=d.useState(""),[j,v]=d.useState(""),[f,N]=d.useState(""),[k,_]=d.useState((new Date).toISOString().split("T")[0]),[S,C]=d.useState(""),[F,$]=d.useState({}),D=d.useMemo(()=>null==o?void 0:o.find(e=>e.id===x),[o,x]),A=d.useMemo(()=>null==o?void 0:o.find(e=>e.id===g),[o,g]),P=d.useMemo(()=>(null==o?void 0:o.filter(e=>e.id!==x))||[],[o,x]);d.useEffect(()=>{if(!(D&&A&&h&&c))return;const e=xt(h);if(e<=0)return;if(D.currency===A.currency)return void v(ct(e.toString()));const t=c[D.currency]||1,r=c[A.currency]||1,a=e/t,s=Math.round(a*r);v(ct(s.toString()))},[D,A,h,c]),d.useEffect(()=>{var t;e&&(u((null==(t=null==o?void 0:o[0])?void 0:t.id)||null),y(null),b(""),v(""),N(""),_((new Date).toISOString().split("T")[0]),C(""),$({}))},[e,o]);const q=s({mutationFn:it,onSuccess:()=>{l.invalidateQueries({queryKey:["accounts"]}),l.invalidateQueries({queryKey:["transactions"]}),l.invalidateQueries({queryKey:["transfers"]}),l.invalidateQueries({queryKey:["analytics"]}),a()}});if(!e)return null;const L=t.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/50 animate-modal-backdrop",onClick:a}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:n("transfer.title")}),t.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:t.jsx(xe,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return x||(e.fromAccount=n("transfer.errors.fromRequired")),g||(e.toAccount=n("transfer.errors.toRequired")),x&&g&&x===g&&(e.toAccount=n("transfer.errors.sameAccount")),(!h||xt(h)<=0)&&(e.fromAmount=n("transfer.errors.amountRequired")),(!j||xt(j)<=0)&&(e.toAmount=n("transfer.errors.amountRequired")),$(e),0===Object.keys(e).length})())return;const t=(null==D?void 0:D.currency)||"JPY",r=(null==A?void 0:A.currency)||"JPY",a={from_account_id:x,to_account_id:g,from_amount:U(xt(h),t),to_amount:U(xt(j),r),fee_amount:U(xt(f)||0,t),date:k,description:S.trim()||void 0};D&&A&&D.currency!==A.currency&&(a.exchange_rate=xt(j)/xt(h)),q.mutate(a)},className:"p-6 space-y-5",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.fromAccount")}),t.jsxs("select",{value:x||"",onChange:e=>u(e.target.value?parseInt(e.target.value):null),className:m("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",F.fromAccount?"border-red-500":"border-gray-300"),children:[t.jsx("option",{value:"",children:n("transfer.selectAccount")}),null==o?void 0:o.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",ot[e.currency]||e.currency,")"]},e.id))]}),F.fromAccount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:F.fromAccount})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(Ne,{className:"w-6 h-6 text-gray-400"})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.toAccount")}),t.jsxs("select",{value:g||"",onChange:e=>y(e.target.value?parseInt(e.target.value):null),className:m("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",F.toAccount?"border-red-500":"border-gray-300"),children:[t.jsx("option",{value:"",children:n("transfer.selectAccount")}),P.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",ot[e.currency]||e.currency,")"]},e.id))]}),F.toAccount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:F.toAccount})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.amount")}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:D?ot[D.currency]||D.currency:"Â¥"}),t.jsx("input",{type:"text",inputMode:"numeric",value:h,onChange:e=>b(ct(e.target.value)),className:m("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",F.fromAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),F.fromAmount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:F.fromAmount})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.convertedAmount")}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:A?ot[A.currency]||A.currency:"Â¥"}),t.jsx("input",{type:"text",inputMode:"numeric",value:j,onChange:e=>v(ct(e.target.value)),className:m("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",F.toAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),F.toAmount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:F.toAmount})]})]}),D&&A&&D.currency!==A.currency&&h&&j&&t.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["1 ",D.currency," â‰ˆ ",(xt(j)/xt(h)).toFixed(4)," ",A.currency]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("transfer.fee")," (",n("common.optional"),")"]}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:D?ot[D.currency]||D.currency:"Â¥"}),t.jsx("input",{type:"text",inputMode:"numeric",value:f,onChange:e=>N(ct(e.target.value)),className:"w-full h-12 pl-10 pr-4 border border-gray-300 rounded-lg text-right dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:"0"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.date")}),t.jsx("input",{type:"date",value:k,onChange:e=>_(e.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("transfer.description")," (",n("common.optional"),")"]}),t.jsx("input",{type:"text",value:S,onChange:e=>C(e.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:n("transfer.descriptionPlaceholder")})]}),q.isError&&t.jsx("p",{className:"text-sm text-red-500 text-center",children:n("transfer.error")}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx(w,{type:"button",variant:"outline",onClick:a,className:"flex-1 h-12",children:n("common.cancel")}),t.jsx(w,{type:"submit",loading:q.isPending,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700",children:n("transfer.create")})]})]})]})]});return"undefined"==typeof document?null:i.createPortal(L,document.body)}const ut="accounts_collapsed_sections";const gt=l("/accounts")({component:function(){const{t:e}=H("common"),[r,a]=d.useState(!1),[s,n]=d.useState(!1),[l,i]=d.useState(!1),[o,c]=d.useState(!1),[x,m]=d.useState(!1),[u,g]=d.useState(null),[y,h]=d.useState(()=>function(){try{const e=localStorage.getItem(ut);if(e)return new Set(JSON.parse(e))}catch{}return new Set}());d.useEffect(()=>{var e;e=y,localStorage.setItem(ut,JSON.stringify([...e]))},[y]),d.useEffect(()=>{const e=()=>{c(!0)},t=()=>{m(!0)};return window.addEventListener("open-add-transaction-modal",e),window.addEventListener("open-receipt-scanner",t),()=>{window.removeEventListener("open-add-transaction-modal",e),window.removeEventListener("open-receipt-scanner",t)}},[]);const p=d.useCallback(e=>{h(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),{data:b,isLoading:j,error:v}=Q(r),f=()=>{g(null),n(!0)},N=e=>{g(e),n(!0)},k=null==b?void 0:b.reduce((e,t)=>{const r=t.type;return e[r]||(e[r]=[]),e[r].push(t),e},{});return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:e("account.accounts")}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:e("account.manageYourAccounts")})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(ke,{className:"w-5 h-5"}),e("transfer.title")]}),t.jsxs("button",{onClick:f,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),e("account.createAccount")]})]})]}),t.jsx("div",{className:"mt-4 flex items-center gap-4",children:t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r,onChange:e=>a(e.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 dark:bg-gray-700"}),e("account.showInactive")]})})]}),j&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),v&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:t.jsxs("p",{className:"text-red-700 dark:text-red-400",children:[e("account.errors.loadFailed"),": ",v.message]})}),!j&&!v&&(!b||0===b.length)&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-700 mb-4",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-gray-400",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z"})})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:e("account.noAccounts")}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:e("account.createFirstAccount")}),t.jsxs("button",{onClick:f,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),e("account.createAccount")]})]}),!j&&!v&&b&&b.length>0&&t.jsxs("div",{className:"space-y-8",children:[["bank","savings","cash","credit_card","investment","crypto","receivable","other"].map(r=>{const a=null==k?void 0:k[r];if(!a||0===a.length)return null;const s=y.has(r);return t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:()=>p(r),className:"w-full flex items-center justify-between mb-4 group cursor-pointer",children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e(`account.type.${r}`),t.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",a.length,")"]})]}),t.jsx(G,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform duration-200 "+(s?"-rotate-90":"")})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 transition-all duration-200 ease-in-out "+(s?"max-h-0 opacity-0 overflow-hidden":"max-h-[2000px] opacity-100"),children:a.map(e=>t.jsx(Le,{account:e,onEdit:N},e.id))})]},r)}),t.jsx(Ee,{}),t.jsx(lt,{}),t.jsx(dt,{})]}),!j&&!v&&(!b||0===b.length)&&t.jsxs("div",{className:"mt-8 space-y-6",children:[t.jsx(Ee,{}),t.jsx(lt,{}),t.jsx(dt,{})]}),t.jsx(Te,{isOpen:s,onClose:()=>{n(!1),g(null)},editingAccountId:u}),t.jsx(mt,{isOpen:l,onClose:()=>i(!1)}),t.jsx(Ae,{isOpen:o,onClose:()=>c(!1)}),t.jsx(Pe,{isOpen:x,onClose:()=>m(!1),onScanComplete:()=>m(!1)})]})}});export{gt as Route};
