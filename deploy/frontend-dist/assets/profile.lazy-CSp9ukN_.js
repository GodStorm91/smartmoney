import{u as V,a as W,b as C,c as q,d as K,e as O,f as Q,r as n,j as e,C as A,g as U,I as Y,B as d,h as Z,U as P,T as z,X as ee,L as v,t as r,i as se}from"./index-Cl0A3kUX.js";import{P as ae,S as te,i as le,c as ie}from"./heic-converter-DPiwhpWY.js";import{U as S}from"./user-cuHi2Yqw.js";import{C as re}from"./crown-CZVtmO8E.js";const ne={common:"bg-gray-100 text-gray-700 border-gray-300 dark:bg-gray-800 dark:text-gray-300",rare:"bg-blue-100 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-300",epic:"bg-purple-100 text-purple-700 border-purple-300 dark:bg-purple-900/30 dark:text-purple-300",legendary:"bg-yellow-100 text-yellow-700 border-yellow-400 dark:bg-yellow-900/30 dark:text-yellow-300"},ce=()=>{const{t:i}=V("common"),{data:a}=W(),{data:c}=C?C():{data:null},{data:E=[]}=q(1),{mutate:I,isPending:_}=K(),{mutate:F,isPending:b,isSuccess:N}=O(),{mutate:D,isPending:m}=Q(),[T,h]=n.useState(!1),[H,B]=n.useState((a==null?void 0:a.display_name)||""),[L,x]=n.useState(!1),[y,p]=n.useState(!1),[f,u]=n.useState(null),g=n.useRef(null),w=(c==null?void 0:c.current_level)||(a==null?void 0:a.level)||1,M=(c==null?void 0:c.total_xp)||(a==null?void 0:a.total_xp)||0,j=a==null?void 0:a.active_avatar;n.useEffect(()=>{N&&x(!1)},[N]);const R=()=>{r.success(i("common.saving")+"..."),h(!1)},$=s=>{_||I(s,{onSuccess:()=>r.success(i("gamification.profile.avatarSelected")||"Avatar selected!"),onError:()=>r.error(i("gamification.profile.avatarError")||"Failed to select avatar")})},G=()=>{!f||m||D(f.id,{onSuccess:()=>u(null)})},X=async s=>{var o;const t=(o=s.target.files)==null?void 0:o[0];if(t){console.log("[Avatar Upload] File selected:",t.name,t.type,t.size),g.current&&(g.current.value="");try{let l=t;if(le(t)&&(console.log("[Avatar Upload] Detected HEIC file, starting conversion..."),p(!0),r.info("Converting HEIC image..."),l=await ie(t),p(!1),console.log("[Avatar Upload] HEIC conversion complete:",l.name,l.type,l.size),r.success("HEIC image converted successfully!")),console.log("[Avatar Upload] Validating file type:",l.type),!l.type.startsWith("image/")){r.error("Please select a valid image file");return}if(console.log("[Avatar Upload] Validating file size:",l.size),l.size>5*1024*1024){r.error("Image must be less than 5MB");return}console.log("[Avatar Upload] Starting upload..."),F(l)}catch(l){p(!1),console.error("[Avatar Upload] Error:",l),r.error("Failed to process image. Please try a different file.")}}};return e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-green-500 to-teal-500",children:e.jsx(S,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Profile & Customization"}),e.jsx("p",{className:"text-gray-500",children:"Personalize your experience"})]})]}),e.jsxs(A,{className:"overflow-hidden",children:[e.jsx("div",{className:"h-24 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"}),e.jsxs("div",{className:"relative px-6 pb-6",children:[e.jsx("div",{className:"absolute -top-12 left-6",children:e.jsx("div",{className:"h-24 w-24 rounded-full bg-white dark:bg-gray-800 p-1 shadow-xl",children:e.jsxs("div",{className:"h-full w-full rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center relative",children:[e.jsx("span",{className:"text-4xl",children:(j==null?void 0:j.emoji)||"ðŸ˜Š"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-white dark:bg-gray-800 rounded-full p-0.5",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(U,{className:"w-3 h-3 text-white"})})})]})})}),e.jsx("div",{className:"absolute top-4 right-6",children:e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-full px-4 py-2 shadow-lg",children:[e.jsx(re,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"font-bold text-lg",children:i("gamification.levelProgress",{level:w})})]})}),e.jsxs("div",{className:"mt-14",children:[T?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Y,{value:H,onChange:s=>B(s.target.value),placeholder:i("gamification.profile.displayNamePlaceholder")||"Display Name",className:"max-w-xs"}),e.jsx(d,{onClick:R,size:"sm",children:i("button.save")}),e.jsx(d,{onClick:()=>h(!1),variant:"outline",size:"sm",children:i("button.cancel")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:(a==null?void 0:a.display_name)||i("gamification.profile.newUser")}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>h(!0),children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-4 w-4 text-yellow-500"}),M.toLocaleString()," XP"]}),(a==null?void 0:a.title)&&e.jsx(Z,{variant:"default",className:"bg-yellow-100 text-yellow-800",children:a.title})]})]})]})]}),e.jsx(A,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(S,{className:"h-5 w-5 text-blue-500"}),"Select Avatar"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>x(!0),className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),"Upload Custom"]})]}),e.jsx("div",{className:"grid grid-cols-5 sm:grid-cols-8 gap-3",children:E.map(s=>{var k;const t=s.unlock_level<=w,o=s.id===((k=a==null?void 0:a.active_avatar)==null?void 0:k.id),l=s.rarity==="custom";return e.jsxs("div",{className:`aspect-square rounded-xl flex items-center justify-center text-3xl cursor-pointer transition-all relative group ${t?ne[s.rarity]||"bg-pink-100 text-pink-700 border-pink-300":"opacity-50 bg-gray-100"} ${o?"ring-2 ring-green-500 ring-offset-2":""}`,title:t?`${s.name} - ${o?"Selected":"Click to select"}`:`Unlock at level ${s.unlock_level}`,children:[e.jsx("div",{onClick:()=>t&&$(s.id),className:"w-full h-full flex items-center justify-center",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover rounded-xl"}):s.emoji||"ðŸ˜Š"}),o&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-green-500 text-white rounded-full p-0.5",children:e.jsx(U,{className:"w-3 h-3"})}),!t&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/60 dark:bg-gray-900/60 rounded-xl",children:e.jsxs("span",{className:"text-xs font-medium",children:["Lv",s.unlock_level]})}),l&&t&&e.jsx("button",{onClick:J=>{J.stopPropagation(),u({id:s.id,name:s.name})},className:"absolute -top-1 -left-1 bg-red-500 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete avatar",children:e.jsx(z,{className:"w-3 h-3"})})]},s.id)})})]})}),L&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 animate-in fade-in",onClick:()=>x(!1)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Upload Custom Avatar"}),e.jsx("button",{onClick:()=>x(!1),className:"p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 text-center",children:[e.jsx("input",{type:"file",ref:g,onChange:X,accept:"image/*,.heic,.heif",className:"hidden"}),e.jsx("button",{onClick:()=>{var s;return(s=g.current)==null?void 0:s.click()},disabled:b||y,className:"flex flex-col items-center gap-2 mx-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-10 h-10 text-blue-500 animate-spin"}),e.jsx("span",{className:"text-sm text-blue-500",children:"Converting HEIC..."})]}):b?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-10 h-10 text-gray-400 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-10 h-10 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Click to upload image"})]})})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[e.jsx("p",{children:"Supported formats: JPG, PNG, GIF, WebP, HEIC"}),e.jsx("p",{children:"Maximum file size: 5MB"})]})]})]})})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 animate-in fade-in",onClick:()=>u(null)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-in zoom-in-95 duration-200",children:e.jsx("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl shadow-xl w-full max-w-sm p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mb-4",children:e.jsx(z,{className:"w-6 h-6 text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Delete Avatar?"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"This will permanently delete your custom avatar. This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{variant:"outline",className:"flex-1",onClick:()=>u(null),disabled:m,children:"Cancel"}),e.jsx(d,{variant:"danger",className:"flex-1",onClick:G,disabled:m,children:m?e.jsx(v,{className:"w-4 h-4 animate-spin"}):"Delete"})]})]})})})]})]})},ue=se("/profile")({component:ce});export{ue as Route};
