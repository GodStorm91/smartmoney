import{j as e,c as De,k as ye,u as at,e as wt,n as Ct,m as St}from"./vendor-tanstack-DOuiVnRb.js";import{r as a,a as xe}from"./vendor-react-B9eo89kj.js";import{c as A,a as rt,I as fe,B as F,u as Te,d as Rt,e as st,t as Dt,g as Ze,h as Tt,i as Mt,j as Fe,k as Ue,l as Me,m as qe,C as pe,n as Ye,o as $e,p as nt,q as Pt,r as Et,s as It,v as Ae,S as Lt,w as At,x as Ot,E as _t,y as zt,z as Ft}from"./index-Cyepc-vJ.js";import{S as Ce}from"./Select-BuxQOdGm.js";import{B as ot}from"./Badge-48IvP9fE.js";import{u as Z}from"./vendor-i18n-CtQU9zWU.js";import{u as Ut,a as qt,c as Yt}from"./recurring-service-CZDZgyPV.js";import{$ as $t,P as lt,R as Ke,a0 as Kt,a1 as Bt,a2 as Jt,X as J,F as Pe,a3 as Vt,J as ct,i as Wt,C as Qt,_ as Ht,h as Xt,a4 as Zt,a5 as Gt,j as ea,Q as ta}from"./vendor-icons-Boynwk5e.js";import{R as aa}from"./RecurringOptions-Cm24qQcQ.js";import"./vendor-recharts-BfEtinVu.js";import"./vendor-date-fteVm545.js";function ra({startDate:t,endDate:l,onRangeChange:s}){const{t:r}=Z("common"),i=c=>{const h=new Date,d=h.getFullYear(),x=h.getMonth();switch(c){case"thisMonth":{const f=new Date(d,x,1),p=new Date(d,x+1,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"lastMonth":{const f=new Date(d,x-1,1),p=new Date(d,x,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"last3Months":{const f=new Date(d,x-2,1),p=new Date(d,x+1,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"last6Months":{const f=new Date(d,x-5,1),p=new Date(d,x+1,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"thisYear":return{start:`${d}-01-01`,end:`${d}-12-31`};case"allTime":return{start:"2020-01-01",end:new Date().toISOString().split("T")[0]}}},o=[{key:"thisMonth",label:r("dateRange.thisMonth")},{key:"lastMonth",label:r("dateRange.lastMonth")},{key:"last3Months",label:r("dateRange.last3Months")},{key:"last6Months",label:r("dateRange.last6Months")},{key:"thisYear",label:r("dateRange.thisYear")},{key:"allTime",label:r("dateRange.allTime")}],m=c=>{const h=i(c);return t===h.start&&l===h.end};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map(({key:c,label:h})=>e.jsx("button",{onClick:()=>{const d=i(c);s(d.start,d.end)},className:A("px-3 py-1.5 text-sm rounded-lg border transition-colors",m(c)?"bg-primary-500 text-white border-primary-500":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-primary-500 hover:text-primary-600 dark:hover:text-primary-400"),children:h},c))}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("input",{type:"date",value:t,onChange:c=>s(c.target.value,l),className:"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"~"}),e.jsx("input",{type:"date",value:l,onChange:c=>s(t,c.target.value),className:"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]})}function sa({label:t,options:l,selected:s,onChange:r,placeholder:i}){const[o,m]=a.useState(!1),c=a.useRef(null);a.useEffect(()=>{function x(f){c.current&&!c.current.contains(f.target)&&m(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const h=x=>{s.includes(x)?r(s.filter(f=>f!==x)):r([...s,x])},d=s.length>0?`${s.length} selected`:i||"Select...";return e.jsxs("div",{ref:c,className:"relative w-full",children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t}),e.jsxs("button",{type:"button",onClick:()=>m(!o),className:A("w-full px-4 py-2 border rounded-lg text-left flex justify-between items-center","bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"),children:[e.jsx("span",{className:s.length===0?"text-gray-500":"",children:d}),e.jsx("svg",{className:A("w-4 h-4 transition-transform",o&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:l.map(x=>e.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.includes(x.value),onChange:()=>h(x.value),className:"mr-3 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:x.label})]},x.value))})]})}async function na(t){return(await rt.post("/api/receipts/scan",t)).data}async function it(t){const l=new FormData;return l.append("file",t),(await rt.post("/api/receipts/upload",l,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function dt(t){return t||null}function ut({selected:t,onSelect:l,isIncome:s=!1}){const{t:r}=Z("common"),{data:i,isLoading:o}=Ut(),m=qt(),[c,h]=a.useState(null),[d,x]=a.useState(!1),[f,p]=a.useState(""),[C,S]=a.useState("ğŸ“");if(o||!i)return e.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const N=s?i.income:i.expense,R=k=>{for(const P of N)if(P.children.some(_=>_.name===k))return P;return null},b=k=>{h(k),x(!1)},j=k=>{c&&l(k.name,c.name)},M=()=>{h(null),x(!1)},D=async()=>{!c||!f.trim()||(await m.mutateAsync({name:f.trim(),icon:C,parent_id:c.id,type:s?"income":"expense"}),l(f.trim(),c.name),p(""),x(!1))};return c?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:M,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx($t,{className:"w-4 h-4"}),c.icon," ",c.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[c.children.map(k=>e.jsxs("button",{type:"button",onClick:()=>j(k),className:A("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",t===k.name?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:k.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:k.name})]},k.id)),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:A("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(lt,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("category.addCustom","Add")})]})]}),d&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(fe,{value:C,onChange:k=>S(k.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(fe,{value:f,onChange:k=>p(k.target.value),placeholder:r("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>x(!1),children:r("common.cancel","Cancel")}),e.jsx(F,{size:"sm",onClick:D,disabled:!f.trim()||m.isPending,children:r("common.create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.map(k=>{var P;return e.jsxs("button",{type:"button",onClick:()=>b(k),className:A("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((P=R(t))==null?void 0:P.id)===k.id?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:k.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:k.name})]},k.id)})})}function oa({receiptUrl:t,onClose:l}){const{t:s}=Z(),[r,i]=a.useState(1),o=dt(t);if(!o)return null;const m=()=>i(d=>Math.min(d+.25,3)),c=()=>i(d=>Math.max(d-.25,.5)),h=()=>{const d=document.createElement("a");d.href=o,d.download=`receipt-${Date.now()}.jpg`,d.click()};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:d=>{d.target===d.currentTarget&&l()},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsxs("h2",{className:"text-white font-medium flex items-center gap-2",children:[e.jsx(Ke,{size:20}),s("receipt.viewReceipt","View Receipt")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomOut","Zoom out"),children:e.jsx(Kt,{size:20})}),e.jsxs("span",{className:"text-white text-sm w-12 text-center",children:[Math.round(r*100),"%"]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomIn","Zoom in"),children:e.jsx(Bt,{size:20})}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.download","Download"),children:e.jsx(Jt,{size:20})}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.close","Close"),children:e.jsx(J,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center p-4",children:e.jsx("img",{src:o,alt:"Receipt",className:"max-w-full max-h-full object-contain transition-transform duration-200",style:{transform:`scale(${r})`}})})]})}function la({isOpen:t,onClose:l,transaction:s}){const{t:r}=Z("common"),i=De(),{data:o=[]}=Te(),[m,c]=a.useState(""),[h,d]=a.useState(""),[x,f]=a.useState(""),[p,C]=a.useState(""),[S,N]=a.useState("JPY"),[R,b]=a.useState(""),[j,M]=a.useState(null),[D,k]=a.useState("expense"),[P,_]=a.useState(!1),[U,V]=a.useState(null),[W,Q]=a.useState(null),[q,K]=a.useState(null),[Y,T]=a.useState(!1),[se,z]=a.useState(!1),G=a.useRef(null),te=[{value:"JPY",label:"Â¥ JPY"},{value:"USD",label:"$ USD"},{value:"VND",label:"â‚« VND"}],ie=w=>{const O=w.replace(/[^\d]/g,"");return O?Number(O).toLocaleString():""},ne=w=>{const O=w.target.value.replace(/[^\d]/g,"");f(O),C(ie(O))},H=ye({mutationFn:w=>Rt(s.id,w),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),l()}}),X=ye({mutationFn:()=>st(s.id),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),l()}});a.useEffect(()=>{if(s&&t){c(s.date),d(s.description);const w=Math.abs(s.amount).toString();f(w),C(ie(w)),N(s.currency||"JPY"),b(s.category),M(s.account_id??null),k(s.type),_(!1),V(s.receipt_url||null),Q(null),K(null)}},[s==null?void 0:s.id,t]);const ue=w=>{var B;const O=(B=w.target.files)==null?void 0:B[0];!O||!O.type.startsWith("image/")||(Q(O),K(URL.createObjectURL(O)))},$=()=>{Q(null),q&&(URL.revokeObjectURL(q),K(null)),V(null),G.current&&(G.current.value="")};a.useEffect(()=>{if(j){const w=o.find(O=>O.id===j);w!=null&&w.currency&&N(w.currency)}},[j,o]);const he=async w=>{w.preventDefault();const O=parseFloat(x);if(isNaN(O))return;const B=o.find(g=>g.id===j),be=(B==null?void 0:B.name)||(s==null?void 0:s.source)||"";let de=U;if(W){z(!0);try{de=await it(W)}finally{z(!1)}}H.mutate({date:m,description:h,amount:Math.round(D==="expense"?-Math.abs(O):Math.abs(O)),currency:S,category:R||"Other",source:be,type:D,account_id:j,receipt_url:de})},ee=()=>{X.mutate()};if(a.useEffect(()=>(t&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[t]),!t||!s)return null;const me=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:l}),e.jsx("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md max-h-[90dvh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:r("transaction.editTitle")}),P?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:r("transaction.deleteConfirm")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.description}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(F,{variant:"outline",onClick:()=>_(!1),className:"flex-1",children:r("button.cancel")}),e.jsx(F,{variant:"secondary",onClick:ee,disabled:X.isPending,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:X.isPending?"...":r("button.delete")})]})]}):e.jsxs("form",{onSubmit:he,className:"space-y-4",children:[e.jsx(fe,{label:r("transaction.date"),type:"date",value:m,onChange:w=>c(w.target.value),required:!0}),e.jsx(fe,{label:r("transaction.description"),value:h,onChange:w=>d(w.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(fe,{label:r("transaction.amount"),type:"text",inputMode:"numeric",value:p,onChange:ne,required:!0})}),e.jsx("div",{className:"w-28",children:e.jsx(Ce,{label:r("transaction.currency","Currency"),value:S,onChange:w=>N(w.target.value),options:te})})]}),e.jsx(Ce,{label:r("transaction.type"),value:D,onChange:w=>k(w.target.value),options:[{value:"income",label:r("transaction.typeIncome")},{value:"expense",label:r("transaction.typeExpense")}]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("transaction.category")}),e.jsx(ut,{selected:R,onSelect:w=>b(w),isIncome:D==="income"})]}),e.jsx(Ce,{label:r("account.account"),value:(j==null?void 0:j.toString())||"",onChange:w=>M(w.target.value?Number(w.target.value):null),options:[{value:"",label:r("account.selectAccount")},...o.map(w=>({value:w.id.toString(),label:w.name}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("receipt.receipt","Receipt")}),e.jsx("input",{ref:G,type:"file",accept:"image/*",capture:"environment",onChange:ue,className:"hidden"}),q||U?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:q||dt(U)||"",alt:"Receipt",className:"w-full h-20 object-cover cursor-pointer",onClick:()=>!q&&T(!0)}),e.jsx("button",{type:"button",onClick:$,className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(J,{size:14})})]}):e.jsxs("button",{type:"button",onClick:()=>{var w;return(w=G.current)==null?void 0:w.click()},className:"w-full h-10 flex items-center justify-center gap-2 border border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 text-gray-500 dark:text-gray-400 rounded-lg text-sm",children:[e.jsx(Pe,{size:16}),r("receipt.attachReceipt","Attach Receipt")]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:l,className:"flex-1",children:r("button.cancel")}),e.jsx(F,{type:"submit",disabled:H.isPending||se,className:"flex-1",children:se?r("receipt.uploading","Uploading..."):H.isPending?"...":r("button.save")})]}),e.jsx("button",{type:"button",onClick:()=>_(!0),className:A("w-full text-center text-sm text-red-600 hover:text-red-700","py-2 transition-colors"),children:r("transaction.deleteTransaction")})]})]})}),Y&&U&&e.jsx(oa,{receiptUrl:U,onClose:()=>T(!1)})]});return typeof document<"u"?xe.createPortal(me,document.body):null}function ca(t,l){const s=De(),{entityType:r,operationType:i,getEntityId:o=()=>0,invalidateKeys:m=[],onSuccess:c,onError:h}=l;return ye({mutationFn:async d=>{if(!navigator.onLine){const x=o(d);return await Ze(i,r,x,d),null}try{const x=await t(d);for(const f of m)s.invalidateQueries({queryKey:f});return x}catch(x){if(x instanceof TypeError&&x.message.includes("fetch")){const f=o(d);return await Ze(i,r,f,d),null}throw x}},onSuccess:d=>{navigator.onLine&&Dt(),c==null||c(d)},onError:d=>{h==null||h(d)}})}function Be(t,l,s){return ca(t,{entityType:l,operationType:"CREATE",invalidateKeys:s})}function ia({value:t,onChange:l,onSuggestionSelect:s,placeholder:r,className:i,error:o}){const{t:m}=Z("common"),[c,h]=a.useState(!1),[d,x]=a.useState(""),f=a.useRef(null),p=a.useRef(null);a.useEffect(()=>{const b=setTimeout(()=>{x(t)},300);return()=>clearTimeout(b)},[t]);const{data:C=[]}=at({queryKey:["transaction-suggestions",d],queryFn:()=>Tt(d),enabled:d.length>=2,staleTime:3e4});a.useEffect(()=>{h(C.length>0&&t.length>=2)},[C,t]),a.useEffect(()=>{const b=j=>{p.current&&!p.current.contains(j.target)&&h(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const S=a.useCallback(b=>{var j;b.key==="Escape"&&(h(!1),(j=f.current)==null||j.blur())},[]),N=b=>{l(b.description),h(!1),s==null||s(b)},R=b=>Math.abs(b).toLocaleString();return e.jsxs("div",{ref:p,className:"relative",children:[e.jsx("input",{ref:f,type:"text",value:t,onChange:b=>l(b.target.value),onKeyDown:S,onFocus:()=>C.length>0&&h(!0),placeholder:r,className:A("w-full h-12 px-4 border rounded-lg text-base","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400",o?"border-red-500":"border-gray-300",i)}),c&&C.length>0&&e.jsx("div",{className:A("absolute top-full left-0 right-0 z-50 mt-1","bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700","max-h-60 overflow-y-auto"),children:C.map((b,j)=>e.jsxs("button",{type:"button",onClick:()=>N(b),className:A("w-full px-4 py-3 flex items-center justify-between text-left","hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors","border-b border-gray-100 dark:border-gray-700 last:border-0"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:b.description}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:b.category}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"â€¢"}),e.jsxs("span",{className:"text-gray-400",children:[b.count,"x ",m("autocomplete.used","used")]})]})]}),e.jsx("div",{className:"ml-4 text-right shrink-0",children:e.jsxs("div",{className:A("font-medium font-numbers",b.is_income?"text-green-600":"text-gray-900 dark:text-gray-100"),children:["Â¥",R(b.amount)]})})]},`${b.description}-${j}`))})]})}function da({onCapture:t,onCancel:l}){const{t:s}=Z(),r=a.useRef(null),i=a.useRef(null),[o,m]=a.useState(null),[c,h]=a.useState(null),[d,x]=a.useState(null),[f,p]=a.useState(!0),C=a.useCallback(async()=>{p(!0),x(null);try{const j=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});r.current&&(r.current.srcObject=j,m(j))}catch(j){console.error("Camera error:",j),x(s("receipt.cameraError","Could not access camera"))}finally{p(!1)}},[s]),S=a.useCallback(()=>{o&&(o.getTracks().forEach(j=>j.stop()),m(null))},[o]),N=a.useCallback(()=>{if(!r.current||!i.current)return;const j=r.current,M=i.current,D=M.getContext("2d");if(!D)return;M.width=j.videoWidth,M.height=j.videoHeight,D.drawImage(j,0,0);const k=M.toDataURL("image/jpeg",.8);h(k),S()},[S]),R=a.useCallback(()=>{h(null),C()},[C]),b=a.useCallback(()=>{c&&t(c)},[c,t]);return a.useEffect(()=>(C(),()=>{o&&o.getTracks().forEach(j=>j.stop())}),[]),d?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Pe,{size:48,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-red-400 mb-6",children:d}),e.jsx("button",{onClick:l,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:s("common.close","Close")})]}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/50 absolute top-0 left-0 right-0 z-10",children:[e.jsx("button",{onClick:l,className:"text-white p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":s("common.close","Close"),children:e.jsx(J,{size:24})}),e.jsx("span",{className:"text-white font-medium",children:s("receipt.scanReceipt","Scan Receipt")}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-black",children:[f&&!c&&e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"}),e.jsx("p",{className:"text-white",children:s("receipt.startingCamera","Starting camera...")})]}),c?e.jsx("img",{src:c,alt:"Captured receipt",className:"max-w-full max-h-full object-contain"}):e.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",onLoadedMetadata:()=>p(!1)}),e.jsx("canvas",{ref:i,className:"hidden"})]}),e.jsx("div",{className:"p-6 bg-black/50 flex justify-center gap-8 absolute bottom-0 left-0 right-0 safe-area-bottom",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[e.jsx(Vt,{size:20}),s("receipt.retake","Retake")]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(ct,{size:20}),s("receipt.usePhoto","Use Photo")]})]}):e.jsx("button",{onClick:N,disabled:f,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center disabled:opacity-50 transition-opacity","aria-label":s("receipt.takePhoto","Take Photo"),children:e.jsx("div",{className:"w-14 h-14 rounded-full border-4 border-black"})})})]})}async function ua(t,l=1024,s=1024,r=.8){return new Promise((i,o)=>{const m=new Image,c=document.createElement("canvas"),h=c.getContext("2d");if(!h){o(new Error("Failed to get canvas context"));return}m.onload=()=>{let{width:d,height:x}=m;if(d>l||x>s){const p=Math.min(l/d,s/x);d=Math.round(d*p),x=Math.round(x*p)}c.width=d,c.height=x,h.drawImage(m,0,0,d,x);const f=c.toDataURL("image/jpeg",r);URL.revokeObjectURL(m.src),i(f)},m.onerror=()=>{URL.revokeObjectURL(m.src),o(new Error("Failed to load image"))},m.src=URL.createObjectURL(t)})}function ma({onImageSelect:t,className:l}){const{t:s}=Z(),[r,i]=a.useState(!1),[o,m]=a.useState(!1),c=a.useCallback(async p=>{if(!p.type.startsWith("image/")){alert(s("receipt.invalidFile","Please select an image file"));return}m(!0);try{const C=await ua(p);t(C)}catch{alert(s("receipt.processError","Failed to process image"))}finally{m(!1)}},[t,s]),h=a.useCallback(p=>{p.preventDefault(),i(!1);const C=p.dataTransfer.files[0];C&&c(C)},[c]),d=a.useCallback(p=>{p.preventDefault(),i(!0)},[]),x=a.useCallback(()=>{i(!1)},[]),f=a.useCallback(p=>{var S;const C=(S=p.target.files)==null?void 0:S[0];C&&c(C)},[c]);return e.jsxs("div",{onDrop:h,onDragOver:d,onDragLeave:x,className:A("border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",r?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500",o&&"opacity-50 pointer-events-none",l),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:f,className:"hidden",id:"receipt-file-input"}),e.jsx("label",{htmlFor:"receipt-file-input",className:"cursor-pointer",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("receipt.processing","Processing...")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(Wt,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:s("receipt.dropOrClick","Drop image here or click to upload")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s("receipt.supportedFormats","JPG, PNG, HEIC supported")})]})]})})})]})}function mt({isOpen:t,onClose:l,onScanComplete:s}){const{t:r}=Z(),[i,o]=a.useState("select"),[m,c]=a.useState(null),h=ye({mutationFn:na,onSuccess:S=>{s(S.data),d()}}),d=a.useCallback(()=>{o("select"),c(null),h.reset(),l()},[l,h]),x=a.useCallback(S=>{c(S),o("preview")},[]),f=a.useCallback(()=>{m&&h.mutate({image:m})},[m,h]),p=a.useCallback(()=>{c(null),o("select")},[]);if(!t)return null;if(i==="camera"){const S=e.jsx(da,{onCapture:x,onCancel:()=>o("select")});return typeof document>"u"?null:xe.createPortal(S,document.body)}const C=e.jsx("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",onClick:S=>{S.target===S.currentTarget&&d()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("receipt.scanReceipt","Scan Receipt")}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":r("common.close","Close"),children:e.jsx(J,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-4",children:[i==="select"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>o("camera"),className:"w-full h-14 flex items-center justify-center gap-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(Pe,{size:24}),r("receipt.takePhoto","Take Photo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("common.or","or")}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx(ma,{onImageSelect:x})]}),i==="preview"&&m&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:e.jsx("img",{src:m,alt:"Receipt preview",className:"w-full max-h-64 object-contain"})}),h.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("receipt.analyzing","Analyzing receipt with AI...")})]}),h.isError&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:[e.jsx(Qt,{size:20}),e.jsx("span",{children:r("receipt.scanError","Failed to scan receipt. Please try again.")})]}),!h.isPending&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,className:"flex-1 h-12 flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:r("receipt.retake","Retake")}),e.jsxs("button",{onClick:f,disabled:h.isPending,className:"flex-1 h-12 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(ct,{size:20}),r("receipt.scan","Scan")]})]})]})]})]})});return typeof document>"u"?null:xe.createPortal(C,document.body)}const Ge={JPY:"Â¥",USD:"$",VND:"â‚«"};function Oe(t){const l=t.replace(/[^\d]/g,"");return l?parseInt(l).toLocaleString():""}function ga(t){return t.replace(/[^\d]/g,"")}function xa({isOpen:t,onClose:l}){const{t:s}=Z("common"),{data:r}=Te(),i=De(),o=Mt(),[m,c]=a.useState(!1),[h,d]=a.useState(new Date().toISOString().split("T")[0]),[x,f]=a.useState(""),[p,C]=a.useState(""),[S,N]=a.useState(""),[R,b]=a.useState(""),[j,M]=a.useState(null),[D,k]=a.useState({}),[P,_]=a.useState(!1),[U,V]=a.useState(null),[W,Q]=a.useState(null),[q,K]=a.useState(!1),Y=a.useRef(null),[T,se]=a.useState(!1),[z,G]=a.useState("monthly"),[te,ie]=a.useState(0),[ne,H]=a.useState(25),[X,ue]=a.useState(7),$=a.useMemo(()=>(r==null?void 0:r.find(y=>y.id===j))||null,[r,j]),he=$!=null&&$.currency?Ge[$.currency]||$.currency:"Â¥";a.useEffect(()=>{var y;t&&(c(!1),d(new Date().toISOString().split("T")[0]),f(""),C(""),N(""),b(""),M(((y=r==null?void 0:r[0])==null?void 0:y.id)||null),k({}),V(null),Q(null),se(!1),G("monthly"),ie(0),H(25),ue(7))},[t,r]),a.useEffect(()=>{b("")},[m]);const ee=Be(Ue,"transaction",[["transactions"],["analytics"]]),me=ye({mutationFn:Yt,onSuccess:()=>{i.invalidateQueries({queryKey:["recurring-transactions"]})}}),w=y=>{const I=ga(y.target.value);f(I),C(Oe(I))},O=y=>{const I=y.amount.toString();f(I),C(Oe(I)),c(y.is_income),y.category&&b(y.category)},B=y=>{if(y.amount!==null){const I=Math.abs(y.amount).toString();f(I),C(Oe(I)),c(!1)}y.date&&d(y.date),y.merchant&&N(y.merchant),y.category&&b(y.category),_(!1)},be=y=>{var oe;const I=(oe=y.target.files)==null?void 0:oe[0];if(!I||!I.type.startsWith("image/"))return;V(I);const L=URL.createObjectURL(I);Q(L)},de=()=>{V(null),W&&(URL.revokeObjectURL(W),Q(null)),Y.current&&(Y.current.value="")},g=()=>{const y={};return(!x||parseInt(x)<=0)&&(y.amount=s("transaction.errors.amountRequired","Amount is required")),S.trim()||(y.description=s("transaction.errors.descriptionRequired","Description is required")),R||(y.category=s("transaction.errors.categoryRequired","Category is required")),j||(y.source=s("transaction.errors.sourceRequired","Account is required")),k(y),Object.keys(y).length===0},E=async y=>{if(y.preventDefault(),!g())return;const I=R||"Other",L=($==null?void 0:$.currency)||"JPY",oe=Fe(parseInt(x),L);try{let je;if(U){K(!0);try{je=await it(U)}finally{K(!1)}}await ee.mutateAsync({date:h,description:S.trim(),amount:m?oe:-oe,currency:L,category:I,source:($==null?void 0:$.name)||"",type:m?"income":"expense",account_id:j,receipt_url:je}),T&&await me.mutateAsync({description:S.trim(),amount:oe,category:I,account_id:j,is_income:m,frequency:z,day_of_week:z==="weekly"?te:null,day_of_month:z==="monthly"?ne:null,interval_days:z==="custom"?X:null,start_date:h}),l(),o.success(s("transaction.saved","Transaction saved!"))}catch{}},ge=y=>{y.target===y.currentTarget&&l()};if(!t)return null;const ae=e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/50 animate-modal-backdrop",onClick:ge,children:[e.jsxs("div",{className:A("fixed inset-x-0 bottom-0 z-50","bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl","max-h-[90vh] overflow-y-auto","animate-modal-in"),children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 dark:text-gray-100",children:s("transaction.addTransaction","Add Transaction")})}),e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[e.jsxs("button",{type:"button",onClick:()=>_(!0),className:"w-full h-12 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium transition-all shadow-md hover:shadow-lg",children:[e.jsx(Ke,{size:20}),s("receipt.scanReceipt","Scan Receipt")]}),e.jsx("input",{ref:Y,type:"file",accept:"image/*",capture:"environment",onChange:be,className:"hidden"}),W?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:W,alt:"Receipt preview",className:"w-full h-24 object-cover"}),e.jsx("button",{type:"button",onClick:de,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(J,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var y;return(y=Y.current)==null?void 0:y.click()},className:"w-full h-12 flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 text-gray-500 dark:text-gray-400 rounded-lg font-medium transition-colors",children:[e.jsx(Pe,{size:20}),s("receipt.attachReceipt","Attach Receipt Photo")]})]}),e.jsxs("form",{onSubmit:E,className:"px-4 pb-8 space-y-4",children:[e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:A("flex-1 py-3 rounded-md text-sm font-medium transition-colors",m?"text-gray-600 dark:text-gray-300":"bg-red-500 text-white"),children:s("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>c(!0),className:A("flex-1 py-3 rounded-md text-sm font-medium transition-colors",m?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:s("transaction.income","Income")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.date","Date")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:h,onChange:y=>d(y.target.value),className:"flex-1 h-12 px-4 border border-gray-300 rounded-lg text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"}),e.jsx("button",{type:"button",onClick:()=>d(new Date().toISOString().split("T")[0]),className:"px-4 h-12 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:s("common.today","Today")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.amount","Amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-lg font-medium text-gray-500 dark:text-gray-400",children:he}),e.jsx("input",{type:"text",inputMode:"numeric",value:p,onChange:w,placeholder:"0",className:A("w-full h-12 pl-10 pr-4 border rounded-lg text-base text-right font-numbers","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",D.amount?"border-red-500":"border-gray-300")})]}),D.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:D.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.description","Description")}),e.jsx(ia,{value:S,onChange:N,onSuggestionSelect:O,placeholder:s("transaction.descriptionPlaceholder","What was this for?"),error:!!D.description}),D.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:D.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:s("transaction.category","Category")}),e.jsx(ut,{selected:R,onSelect:y=>b(y),isIncome:m}),D.category&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:D.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.source","Account")}),e.jsxs("select",{value:j||"",onChange:y=>M(y.target.value?parseInt(y.target.value):null),className:A("w-full h-12 px-4 border rounded-lg text-base","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",D.source?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:s("transaction.selectAccount","Select account")}),r==null?void 0:r.map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",Ge[y.currency]||y.currency,")"]},y.id))]}),D.source&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:D.source})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:y=>se(y.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx(Ht,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:s("recurring.makeRecurring")})]}),T&&e.jsx(aa,{frequency:z,setFrequency:G,dayOfWeek:te,setDayOfWeek:ie,dayOfMonth:ne,setDayOfMonth:H,intervalDays:X,setIntervalDays:ue})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:l,className:"flex-1 h-12",children:s("common.cancel","Cancel")}),e.jsx(F,{type:"submit",loading:ee.isPending||me.isPending||q,className:A("flex-1 h-12",T?"bg-blue-500 hover:bg-blue-600":m?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:s("common.save","Save")})]}),(ee.isError||me.isError)&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:s("transaction.errors.createFailed","Failed to create transaction")})]})]}),e.jsx(mt,{isOpen:P,onClose:()=>_(!1),onScanComplete:B})]});return typeof document<"u"?xe.createPortal(ae,document.body):null}function ha(t={}){const{language:l="ja-JP",onResult:s,onError:r}=t,[i,o]=a.useState("idle"),[m,c]=a.useState(""),[h,d]=a.useState(null),[x,f]=a.useState(!1),p=a.useRef(null),C=a.useRef("idle"),S=a.useRef(s),N=a.useRef(r),R=a.useRef(!1),b=a.useRef(!1);a.useEffect(()=>{C.current=i},[i]),a.useEffect(()=>{S.current=s,N.current=r},[s,r]),a.useEffect(()=>{const k=window.SpeechRecognition||window.webkitSpeechRecognition;f(!!k)},[]),a.useEffect(()=>{const k=window.SpeechRecognition||window.webkitSpeechRecognition;if(!k)return;const P=new k;return P.continuous=!0,P.interimResults=!0,P.lang=l,P.onstart=()=>{R.current=!1,d(null)},P.onresult=_=>{const U=_.results,W=U[U.length-1][0].transcript;c(W)},P.onerror=_=>{var V;if(R.current=!1,_.error==="aborted")return;const U=_.error==="no-speech"?"No speech detected":_.error==="audio-capture"?"Microphone not found":_.error==="not-allowed"?"Microphone access denied":`Error: ${_.error}`;d(U),o("error"),(V=N.current)==null||V.call(N,U)},P.onend=()=>{R.current=!1,!b.current&&C.current==="listening"&&o("idle")},p.current=P,()=>{P.abort()}},[l]);const j=a.useCallback(()=>{if(p.current&&!(R.current||C.current==="listening")){R.current=!0,b.current=!0,c(""),d(null),o("listening");try{p.current.start()}catch(k){console.warn("Speech recognition start error:",k),R.current=!1}}},[]),M=a.useCallback(()=>{var k;if(b.current=!1,!!p.current&&C.current==="listening"){try{p.current.stop()}catch(P){console.warn("Speech recognition stop error:",P)}m?(o("processing"),(k=S.current)==null||k.call(S,m)):o("idle")}},[m]),D=a.useCallback(()=>{c(""),d(null),o("idle")},[]);return{status:i,transcript:m,isSupported:x,startListening:j,stopListening:M,resetTranscript:D,error:h}}const pa={food:["ã”é£¯","ã”ã¯ã‚“","ãƒ©ãƒ³ãƒ","ãƒ‡ã‚£ãƒŠãƒ¼","æ˜¼é£Ÿ","å¤•é£Ÿ","æœé£Ÿ","å¼å½“","ã‚³ãƒ¼ãƒ’ãƒ¼","ã‚«ãƒ•ã‚§","ã‚¹ã‚¿ãƒ","ãƒãƒƒã‚¯","ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰","ã™ãå®¶","å‰é‡å®¶","ãƒ©ãƒ¼ãƒ¡ãƒ³","å¯¿å¸","ã™ã—","ã†ã©ã‚“","ãã°","ã‚«ãƒ¬ãƒ¼","ãƒ‘ãƒ³","ã‚±ãƒ¼ã‚­","ã‚»ãƒ–ãƒ³","ãƒ•ã‚¡ãƒŸãƒ","ãƒ­ãƒ¼ã‚½ãƒ³","ã‚³ãƒ³ãƒ“ãƒ‹","ã‚¹ãƒ¼ãƒ‘ãƒ¼","coffee","cafe","lunch","dinner","breakfast","food","restaurant","starbucks","mcdonalds","ramen","sushi","curry","bread","cake","konbini","supermarket","gohan","ko-hi-","kohi"],transport:["é›»è»Š","ã§ã‚“ã—ã‚ƒ","ãƒã‚¹","ã‚¿ã‚¯ã‚·ãƒ¼","åœ°ä¸‹é‰„","JR","æ–°å¹¹ç·š","ã‚¬ã‚½ãƒªãƒ³","é§è»Šå ´","Suica","PASMO","ãƒ‘ã‚¹ãƒ¢","ã‚¹ã‚¤ã‚«","train","bus","taxi","subway","gas","parking","uber","lyft"],shopping:["è²·ã„ç‰©","ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°","æœ","ãµã","é´","ãã¤","ã‚¢ãƒã‚¾ãƒ³","æ¥½å¤©","é›‘è²¨","ãƒ¦ãƒ‹ã‚¯ãƒ­","GU","ç„¡å°","shopping","clothes","shoes","amazon","uniqlo","muji"],entertainment:["æ˜ ç”»","ãˆã„ãŒ","ã‚²ãƒ¼ãƒ ","ã‚«ãƒ©ã‚ªã‚±","ãƒœã‚¦ãƒªãƒ³ã‚°","æœ¬","ã»ã‚“","Netflix","ãƒãƒƒãƒˆãƒ•ãƒªãƒƒã‚¯ã‚¹","Spotify","ã‚¹ãƒãƒ†ã‚£ãƒ•ã‚¡ã‚¤","movie","game","karaoke","bowling","book","netflix","spotify"],utilities:["é›»æ°—","ã§ã‚“ã","ã‚¬ã‚¹","æ°´é“","ã™ã„ã©ã†","ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ","Wi-Fi","electric","electricity","water","internet","wifi"],communication:["æºå¸¯","ã‘ã„ãŸã„","ã‚¹ãƒãƒ›","é›»è©±","ã§ã‚“ã‚","phone","mobile","cell"],health:["ç—…é™¢","ã³ã‚‡ã†ã„ã‚“","è–¬","ãã™ã‚Š","åŒ»è€…","ã„ã—ã‚ƒ","æ­¯åŒ»è€…","ã‚¸ãƒ ","ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹","hospital","medicine","doctor","dentist","gym","fitness"],housing:["å®¶è³ƒ","ã‚„ã¡ã‚“","å…‰ç†±è²»","rent","mortgage"]};function ya(t){const l=t.toLowerCase();for(const[s,r]of Object.entries(pa))for(const i of r)if(l.includes(i.toLowerCase()))return s}function fa(t){if(!t||t.trim().length===0)return null;const l=t.trim(),s=l.match(/[\d,]+/);if(!s)return null;const r=s[0].replace(/,/g,""),i=parseInt(r,10);if(isNaN(i)||i<=0)return null;let o="JPY";const m=l.toLowerCase();/dollar|dollars|usd|\$|ãƒ‰ãƒ«/.test(m)?o="USD":/dong|vnd|Ä‘á»“ng|ãƒ‰ãƒ³/.test(m)?o="VND":/yen|å††|Â¥|ãˆã‚“/.test(m)&&(o="JPY");let c=l.replace(/[\d,]+/,"").replace(/yen|å††|Â¥|dollar|dollars|usd|\$|dong|vnd|Ä‘á»“ng|ãƒ‰ãƒ«|ãƒ‰ãƒ³|ãˆã‚“/gi,"").trim();c||(c="Voice entry");const h=ya(l);return{amount:i,currency:o,description:c,suggestedCategoryId:h}}const _e=[{id:"food",labelKey:"category.food",icon:"ğŸ½ï¸",value:"Food"},{id:"housing",labelKey:"category.housing",icon:"ğŸ ",value:"Housing"},{id:"transport",labelKey:"category.transport",icon:"ğŸš—",value:"Transportation"},{id:"utilities",labelKey:"category.utilities",icon:"ğŸ’¡",value:"Utilities"},{id:"communication",labelKey:"category.communication",icon:"ğŸ“±",value:"Communication"},{id:"entertainment",labelKey:"category.entertainment",icon:"ğŸ¬",value:"Entertainment"},{id:"shopping",labelKey:"category.shopping",icon:"ğŸ›ï¸",value:"Shopping"},{id:"health",labelKey:"category.health",icon:"ğŸ¥",value:"Health"},{id:"proxy_purchase",labelKey:"category.proxy_purchase",icon:"ğŸ›’",value:"Proxy Purchase"},{id:"other",labelKey:"category.other",icon:"ğŸ“¦",value:"Other"}],Re={JPY:"Â¥",USD:"$",VND:"â‚«"},ze=["JPY","USD","VND"],ba=["1","2","3","4","5","6","7","8","9","00","0","DEL"];function ja(){var de;const{t}=Z("common"),{data:l}=Te(),s=Me(),[r,i]=a.useState("closed"),[o,m]=a.useState(""),[c,h]=a.useState(""),[d,x]=a.useState(null),[f,p]=a.useState("JPY"),[C,S]=a.useState(""),[N,R]=a.useState(""),b=a.useRef(null),j=a.useRef(!1),[M,D]=a.useState(!1),[k,P]=a.useState(0),{status:_,transcript:U,isSupported:V,startListening:W,stopListening:Q}=ha({language:"ja-JP",onResult:g=>{const E=fa(g);E&&(m(E.amount.toString()),p(E.currency),S(E.description),E.suggestedCategoryId?(h(E.suggestedCategoryId),(l==null?void 0:l.length)===1?setTimeout(()=>{ne(E.suggestedCategoryId)},100):i("account")):i("category"))}}),q=l==null?void 0:l.find(g=>g.id===d),K=a.useMemo(()=>{if(!l)return[];if(!N.trim())return l;const g=N.toLowerCase();return l.filter(E=>E.name.toLowerCase().includes(g))},[l,N]);a.useEffect(()=>{if(l!=null&&l.length&&!d){x(l[0].id);const g=l[0].currency;ze.includes(g)&&p(g)}},[l,d]),a.useEffect(()=>{if(q){const g=q.currency;ze.includes(g)&&p(g)}},[q]);const Y=Re[f]||f,T=a.useMemo(()=>{if(!o||!q)return null;const g=q.currency;if(f===g)return null;const E=parseInt(o);if(isNaN(E))return null;const ge=s[f]||1,ae=s[g]||1,y=E/ge,I=Math.round(y*ae);return{value:I,formatted:I.toLocaleString(),currency:g,symbol:Re[g]||g}},[o,f,q,s]),se=Be(Ue,"transaction",[["transactions"],["analytics"]]),z=o?parseInt(o).toLocaleString():"0",G=g=>{g==="DEL"?m(E=>E.slice(0,-1)):o.length<10&&m(E=>E+g)},te=g=>{h(g),(l==null?void 0:l.length)===1?ne(g):i("account")},ie=g=>{x(g),ne(c,g)},ne=async(g,E)=>{const ge=g||c,ae=E||d,y=_e.find(ke=>ke.id===ge),I=l==null?void 0:l.find(ke=>ke.id===ae);if(!o||!y||!I)return;const L=I.currency||"JPY",oe=(T==null?void 0:T.value)??parseInt(o),je=Fe(oe,L);try{await se.mutateAsync({date:new Date().toISOString().split("T")[0],description:C||y.value,amount:-je,currency:L,category:y.value,source:I.name,type:"expense"}),H()}catch{}},H=()=>{i("closed"),m(""),h(""),S(""),R("")},X=()=>{i("amount"),m(""),h(""),R("")},ue=()=>{H()},$=()=>{r==="amount"&&o&&i("category")},he=()=>{r==="category"?i("amount"):r==="account"&&i("category")},ee=600,me=()=>{j.current=!1,P(0);const g=Date.now();b.current=setTimeout(()=>{j.current=!0,D(!0),P(100)},ee);const E=setInterval(()=>{const ge=Date.now()-g,ae=Math.min(ge/ee*100,100);P(ae),ae>=100&&clearInterval(E)},16)},w=()=>{b.current&&(clearTimeout(b.current),b.current=null),P(0),j.current||X()},O=()=>{b.current&&(clearTimeout(b.current),b.current=null),P(0),j.current=!1},B=g=>{D(!1),j.current=!1,g==="transaction"?window.dispatchEvent(new CustomEvent("open-add-transaction-modal")):g==="receipt"&&window.dispatchEvent(new CustomEvent("open-receipt-scanner"))},be=1+k/100*.15;return r==="closed"?xe.createPortal(e.jsxs(e.Fragment,{children:[M&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>D(!1)}),M&&e.jsxs("div",{className:"fixed bottom-32 right-4 z-50 flex flex-col-reverse gap-2 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("button",{onClick:()=>B("receipt"),className:"flex items-center gap-3 pl-4 pr-5 py-3 rounded-full bg-purple-500 hover:bg-purple-600 text-white shadow-lg",children:[e.jsx(Ke,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:t("receipt.scanReceipt","Scan Receipt")})]}),e.jsxs("button",{onClick:()=>B("transaction"),className:"flex items-center gap-3 pl-4 pr-5 py-3 rounded-full bg-green-500 hover:bg-green-600 text-white shadow-lg",children:[e.jsx(Xt,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:t("transaction.addTransaction","Add Transaction")})]})]}),e.jsx("button",{onPointerDown:me,onPointerUp:w,onPointerLeave:O,onPointerCancel:O,className:A("fixed bottom-24 right-4 sm:bottom-6 sm:right-6 z-50","w-14 h-14 rounded-full","bg-gradient-to-r from-blue-500 to-purple-500","text-white shadow-lg","flex items-center justify-center","transition-transform duration-75",M&&"rotate-45"),style:{transform:`scale(${be})`},"aria-label":t("quickEntry.add","Quick Add"),children:e.jsx(lt,{size:28})})]}),document.body):xe.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:ue,children:e.jsxs("div",{className:A("fixed inset-x-0 bottom-0 z-50","bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl","transform transition-transform duration-300","max-h-[85vh] overflow-hidden"),onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:r==="amount"?ue:he,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(J,{size:20,className:"text-gray-500"})}),e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[r==="amount"&&t("quickEntry.enterAmount","Enter Amount"),r==="category"&&t("quickEntry.selectCategory","Select Category"),r==="account"&&t("quickEntry.selectAccount","Select Account")]}),e.jsx("div",{className:"w-9"})," "]}),r==="amount"&&e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:ze.map(g=>e.jsxs("button",{onClick:()=>p(g),className:A("px-4 py-2 rounded-full text-sm font-medium transition-all",f===g?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[Re[g]," ",g]},g))}),e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("div",{className:"text-4xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[Y,z]}),T&&e.jsxs("div",{className:"text-lg text-blue-500 dark:text-blue-400 mt-2 font-numbers",children:["â‰ˆ ",T.symbol,T.formatted]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:t("quickEntry.expense","Expense")})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-w-xs mx-auto",children:ba.map(g=>e.jsx("button",{onClick:()=>G(g),className:A("h-14 rounded-xl text-xl font-medium transition-colors",g==="DEL"?"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-600"),children:g==="DEL"?e.jsx(Zt,{size:20,className:"mx-auto"}):g},g))}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[V&&e.jsx("button",{onMouseDown:W,onMouseUp:Q,onMouseLeave:_==="listening"?Q:void 0,onTouchStart:W,onTouchEnd:Q,onTouchCancel:Q,className:A("h-14 w-14 rounded-xl flex items-center justify-center transition-all select-none touch-none",_==="listening"?"bg-red-500 text-white animate-pulse scale-110":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),title:t("voiceInput.holdToTalk","Hold to talk"),children:e.jsx(Gt,{size:24})}),e.jsx("button",{onClick:$,disabled:!o,className:A("flex-1 h-14 rounded-xl font-medium text-white transition-all",o?"bg-blue-500 hover:bg-blue-600":"bg-gray-300 dark:bg-gray-600 cursor-not-allowed"),children:t("common.next","Next")})]}),_==="listening"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/30 rounded-lg border-2 border-red-300 dark:border-red-700",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center font-medium",children:U||t("voiceInput.listening","Listening...")})})]}),r==="category"&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-center py-2 mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[Y,z]}),T&&e.jsxs("span",{className:"text-lg text-blue-500 dark:text-blue-400 ml-2 font-numbers",children:["â†’ ",T.symbol,T.formatted]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:_e.map(g=>e.jsxs("button",{onClick:()=>te(g.id),className:A("flex flex-col items-center p-4 rounded-xl transition-all","bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600","active:scale-95"),children:[e.jsx("span",{className:"text-2xl mb-1",children:g.icon}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-300 text-center",children:t(g.labelKey,g.value)})]},g.id))})]}),r==="account"&&e.jsxs("div",{className:"p-4 overflow-x-hidden",children:[e.jsxs("div",{className:"text-center py-2 mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[Y,z]}),T&&e.jsxs("span",{className:"text-lg text-blue-500 dark:text-blue-400 ml-2 font-numbers",children:["â†’ ",T.symbol,T.formatted]}),e.jsx("span",{className:"ml-2 text-gray-500",children:(de=_e.find(g=>g.id===c))==null?void 0:de.icon})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(ea,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:N,onChange:g=>R(g.target.value),placeholder:t("account.searchPlaceholder","Search accounts..."),className:A("w-full h-10 pl-9 pr-4 rounded-lg text-sm","bg-gray-100 dark:bg-gray-700 border-0","text-gray-900 dark:text-gray-100","placeholder:text-gray-400 dark:placeholder:text-gray-500","focus:outline-none focus:ring-2 focus:ring-blue-500"),autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto overflow-x-hidden",children:[K.map(g=>e.jsxs("button",{onClick:()=>ie(g.id),className:A("w-full flex items-center justify-between p-4 rounded-xl transition-all","bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600","active:scale-[0.98]"),children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:g.name}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:Re[g.currency]||g.currency})]},g.id)),K.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:t("account.noResults","No accounts found")})]}),se.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),e.jsx("span",{children:t("common.saving","Saving...")})]})]})]})}),document.body)}function et({transaction:t,onEdit:l,onDelete:s}){const{isPrivacyMode:r}=qe(),i=Me(),[o,m]=a.useState(0),[c,h]=a.useState(!1),[d,x]=a.useState(0),f=a.useRef(null),p=80,C=40,S=M=>{x(M.touches[0].clientX),h(!0)},N=M=>{if(!c)return;const D=M.touches[0].clientX,k=d-D;k>0?m(Math.min(k,p)):m(Math.max(k,-20))},R=()=>{h(!1),o>C?m(p):m(0)},b=()=>{o>0?m(0):l(t)},j=M=>{M.stopPropagation(),s(t)};return a.useEffect(()=>{const M=D=>{f.current&&!f.current.contains(D.target)&&m(0)};if(o>0)return document.addEventListener("mousedown",M),()=>document.removeEventListener("mousedown",M)},[o]),e.jsxs("div",{ref:f,className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center justify-center bg-red-600",style:{width:`${p}px`},children:e.jsxs("button",{onClick:j,className:"h-full w-full flex flex-col items-center justify-center text-white transition-opacity",style:{opacity:o>0?1:0},"aria-label":"Delete transaction",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 mb-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),e.jsx("span",{className:"text-xs font-medium",children:"å‰Šé™¤"})]})}),e.jsx("div",{className:"relative",style:{transform:`translateX(-${o}px)`,transition:c?"none":"transform 250ms ease-out"},onTouchStart:S,onTouchMove:N,onTouchEnd:R,onClick:b,children:e.jsxs(pe,{className:"cursor-pointer active:scale-[0.98] transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-50",children:t.description}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Ye(t.date)})]}),e.jsx("p",{className:`text-lg font-bold font-numbers ${t.is_transfer?"text-blue-500 dark:text-blue-400":t.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:$e(t.amount,t.type,t.currency||"JPY",i,!0,r)})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(ot,{children:t.category}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.source})]})]})})]})}function va({isOpen:t,onClose:l,onConfirm:s,transaction:r,isDeleting:i=!1}){const{t:o}=Z("common"),{currency:m}=nt(),{isPrivacyMode:c}=qe(),h=Me();if(!t||!r)return null;const d=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:l}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:o("transaction.deleteConfirm","å–å¼•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6 space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.description}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:Ye(r.date)}),e.jsx("span",{className:`font-bold font-numbers ${r.type==="income"?"text-green-600":"text-red-600"}`,children:$e(r.amount,r.type,m,h,!1,c)})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:r.category}),e.jsx("span",{children:"-"}),e.jsx("span",{children:r.source})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:o("transaction.deleteWarning","ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",onClick:l,disabled:i,className:"flex-1",children:o("button.cancel","ã‚­ãƒ£ãƒ³ã‚»ãƒ«")}),e.jsx(F,{onClick:s,disabled:i,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:i?"å‰Šé™¤ä¸­...":o("button.delete","å‰Šé™¤")})]})]})]});return typeof document<"u"?xe.createPortal(d,document.body):null}function ka({isOpen:t,onClose:l,onConfirm:s,selectedCount:r,isLoading:i}){const{t:o}=Z("common"),[m,c]=a.useState(""),h=[{value:"",label:o("transactions.selectCategory","Select category...")},{value:"é£Ÿè²»",label:o("category.food","Food")},{value:"ä½å®…",label:o("category.housing","Housing")},{value:"äº¤é€š",label:o("category.transport","Transport")},{value:"å¨¯æ¥½",label:o("category.entertainment","Entertainment")},{value:"é€šä¿¡",label:o("category.communication","Communication")},{value:"æ—¥ç”¨å“",label:o("category.daily","Daily Necessities")},{value:"åŒ»ç™‚",label:o("category.medical","Medical")},{value:"æ•™è‚²",label:o("category.education","Education")},{value:"ãã®ä»–",label:o("category.other","Other")}],d=()=>{m&&(s(m),c(""))};if(!t)return null;const x=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:l}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:o("transactions.recategorizeTitle","Change Category")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:o("transactions.recategorizeDescription","Update category for {{count}} transactions",{count:r})}),e.jsx(Ce,{label:o("transactions.newCategory","New Category"),value:m,onChange:f=>c(f.target.value),options:h}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(F,{variant:"outline",onClick:l,className:"flex-1",children:o("button.cancel","Cancel")}),e.jsx(F,{onClick:d,disabled:!m||i,className:"flex-1",children:i?o("button.saving","Saving..."):o("button.apply","Apply")})]})]})]});return typeof document<"u"?xe.createPortal(x,document.body):null}function Na({isOpen:t,onClose:l,onConfirm:s,selectedCount:r,isDeleting:i}){const{t:o}=Z("common");if(!t)return null;const m=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:l}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:o("transactions.bulkDeleteTitle","Delete Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:o("transactions.bulkDeleteConfirm","Are you sure you want to delete {{count}} transactions? This cannot be undone.",{count:r})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",onClick:l,className:"flex-1",children:o("button.cancel","Cancel")}),e.jsx(F,{variant:"danger",onClick:s,disabled:i,className:"flex-1",children:i?o("button.deleting","Deleting..."):o("button.delete","Delete")})]})]})]});return typeof document<"u"?xe.createPortal(m,document.body):null}function wa(t){const l=["Date","Description","Amount","Type","Category","Source"],s=t.map(r=>[r.date,`"${r.description.replace(/"/g,'""')}"`,r.amount.toString(),r.type,r.category,r.source]);return[l.join(","),...s.map(r=>r.join(","))].join(`
`)}function Ca(t,l){const s=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=l,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}function Sa(t,l,s){const r=wa(t),i=l&&s?`${l}_to_${s}`:new Date().toISOString().split("T")[0];Ca(r,`smartmoney_transactions_${i}.csv`)}function Ra(t,l){const[s,r]=a.useState(t);return a.useEffect(()=>{const i=setTimeout(()=>r(t),l);return()=>clearTimeout(i)},[t,l]),s}function tt(t){const[l,s]=t.split("-").map(Number),r=`${l}-${String(s).padStart(2,"0")}-01`,i=new Date(l,s,0).getDate(),o=`${l}-${String(s).padStart(2,"0")}-${String(i).padStart(2,"0")}`;return{start:r,end:o}}function Da(){var He,Xe;const{t}=Z("common"),{currency:l}=nt(),{isPrivacyMode:s}=qe(),r=Me(),i=De(),o=wt(),m=Pt(),{data:c}=Te(),{categories:h,month:d,accountId:x,fromAccounts:f,type:p}=Ct({from:"/transactions"}),C=h?h.split(",").filter(Boolean):[],S=d?tt(d):m,[N,R]=a.useState({start_date:S.start,end_date:S.end,categories:C,source:"",type:p||"all"}),[b,j]=a.useState(""),M=Ra(b,300),[D,k]=a.useState(""),[P,_]=a.useState(""),[U,V]=a.useState("thisMonth"),W=n=>{const u=new Date;let v,le=u;switch(n){case"today":v=u;break;case"thisWeek":v=new Date(u),v.setDate(u.getDate()-u.getDay());break;case"thisMonth":v=new Date(u.getFullYear(),u.getMonth(),1);break;case"lastMonth":v=new Date(u.getFullYear(),u.getMonth()-1,1),le=new Date(u.getFullYear(),u.getMonth(),0);break;case"last3Months":v=new Date(u.getFullYear(),u.getMonth()-3,1);break;default:v=new Date(u.getFullYear(),u.getMonth(),1)}return{start:v.toISOString().split("T")[0],end:le.toISOString().split("T")[0]}},Q=n=>{if(V(n),n!=="custom"){const u=W(n);R(v=>({...v,start_date:u.start,end_date:u.end}))}},q=(n,u)=>{const v=u?parseFloat(u):void 0;n==="min"?(k(u),R(le=>({...le,min_amount:v}))):(_(u),R(le=>({...le,max_amount:v})))},K=n=>{R(u=>{const v={...u};return n==="categories"?v.categories=[]:n==="source"?v.source="":n==="type"?v.type="all":n==="search"?(j(""),v.search=void 0):n==="min_amount"?(k(""),v.min_amount=void 0):n==="max_amount"?(_(""),v.max_amount=void 0):delete v[n],v})},Y=n=>{const u=N[n];return n==="categories"?!!(u&&u.length>0):n==="type"?u!=="all":n==="source"?!!u:n==="min_amount"||n==="max_amount"?u!==void 0:!!u},[T,se]=a.useState("date"),[z,G]=a.useState("desc"),[te,ie]=a.useState(50),[ne,H]=a.useState(!1),X=n=>{H(!0),T===n?G(u=>u==="asc"?"desc":"asc"):(se(n),G("desc")),setTimeout(()=>H(!1),150)},ue=n=>{H(!0);const[u,v]=n.split("-");se(u),G(v),setTimeout(()=>H(!1),150)};a.useEffect(()=>{R(n=>({...n,search:M||void 0}))},[M]),a.useEffect(()=>{if(h||d||p!==void 0){const n=d?tt(d):m,u=h?h.split(",").filter(Boolean):[];R(v=>({...v,categories:u.length>0?u:v.categories,start_date:n.start,end_date:n.end,type:p||"all"}))}},[h,d,p]);const $=n=>{const u=p===n?void 0:n;o({to:"/transactions",search:v=>({...v,type:u})})},[he,ee]=a.useState(null),[me,w]=a.useState(!1),[O,B]=a.useState(null),[be,de]=a.useState(!1),[g,E]=a.useState(new Set),[ge,ae]=a.useState(!1),[y,I]=a.useState(!1),{data:L,isLoading:oe}=at({queryKey:["transactions",N],queryFn:()=>Ft(N)});a.useEffect(()=>{E(new Set)},[L]),a.useEffect(()=>{const n=()=>{w(!0)},u=()=>{de(!0)};return window.addEventListener("open-add-transaction-modal",n),window.addEventListener("open-receipt-scanner",u),()=>{window.removeEventListener("open-add-transaction-modal",n),window.removeEventListener("open-receipt-scanner",u)}},[]);const je=Be(Ue,"transaction",[["transactions"],["analytics"]]),ke=n=>{if(!n.amount||!n.category)return;const u=c==null?void 0:c[0],v=(u==null?void 0:u.currency)||"JPY",le=Fe(Math.abs(n.amount),v);je.mutate({date:n.date||new Date().toISOString().split("T")[0],description:n.merchant||"Receipt Scan",amount:-le,currency:v,category:n.category,source:(u==null?void 0:u.name)||"Unknown",type:"expense"})},gt=[{value:"é£Ÿè²»",label:t("category.food","Food")},{value:"ä½å®…",label:t("category.housing","Housing")},{value:"äº¤é€š",label:t("category.transport","Transport")},{value:"å¨¯æ¥½",label:t("category.entertainment","Entertainment")},{value:"é€šä¿¡",label:t("category.communication","Communication")},{value:"æ—¥ç”¨å“",label:t("category.daily","Daily Necessities")},{value:"åŒ»ç™‚",label:t("category.medical","Medical")},{value:"æ•™è‚²",label:t("category.education","Education")},{value:"ãã®ä»–",label:t("category.other","Other")}],Je=L&&L.length>0&&L.every(n=>g.has(n.id)),xt=()=>{E(Je?new Set:new Set((L==null?void 0:L.map(n=>n.id))||[]))},ht=n=>{const u=new Set(g);u.has(n)?u.delete(n):u.add(n),E(u)},Ve=ye({mutationFn:n=>st(n),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),B(null)}}),We=ye({mutationFn:()=>Et(Array.from(g)),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),E(new Set),I(!1)}}),Qe=ye({mutationFn:n=>It(Array.from(g),n),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),E(new Set),ae(!1)}}),pt=()=>{O&&Ve.mutate(O.id)},yt=()=>{R({start_date:m.start,end_date:m.end,categories:[],source:"",type:"all"}),j(""),o({to:"/transactions",search:{}})},Ne=a.useMemo(()=>{if(!L)return[];if(!x)return L;const n=Number(x);return L.filter(u=>u.account_id!=null&&Number(u.account_id)===n)},[L,x]),we=a.useMemo(()=>!x||!c?null:c.find(n=>n.id===Number(x))||null,[x,c]),Ee=(we==null?void 0:we.currency)||l,ft={JPY:1,USD:.00667,VND:167},{income:bt,expense:jt,net:vt}=a.useMemo(()=>{const n=Ne,u=(re,ce)=>{if(we)return re;const Nt=zt[ce]??0,Ie=re/Math.pow(10,Nt);if(ce==="JPY")return Ie;const Le=r[ce]??ft[ce];return!Le||Le===0?(console.warn(`No exchange rate found for currency: ${ce}, treating as JPY`),Ie):Ie/Le},v=n.filter(re=>re.type==="income"&&!re.is_transfer).reduce((re,ce)=>re+u(ce.amount,ce.currency||"JPY"),0),le=n.filter(re=>re.type==="expense"&&!re.is_transfer).reduce((re,ce)=>re+u(Math.abs(ce.amount),ce.currency||"JPY"),0);return{income:v,expense:le,net:v-le}},[Ne,we,r]),Se=a.useMemo(()=>Ne.length?[...Ne].sort((n,u)=>{let v=0;switch(T){case"date":v=n.date.localeCompare(u.date);break;case"description":v=n.description.localeCompare(u.description);break;case"category":v=n.category.localeCompare(u.category);break;case"source":v=n.source.localeCompare(u.source);break;case"amount":v=n.amount-u.amount;break}return z==="asc"?v:-v}):[],[Ne,T,z]),ve=a.useMemo(()=>te==="all"?Se:Se.slice(0,te),[Se,te]),kt=a.useMemo(()=>{if(!ve.length)return[];const n=[];let u="";return ve.forEach(v=>{v.date!==u?(u=v.date,n.push({date:v.date,transactions:[v]})):n[n.length-1].transactions.push(v)}),n},[ve]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-24",children:[f&&e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>o({to:"/accounts"}),className:"mb-4 -ml-2",children:[e.jsx(ta,{className:"w-4 h-4 mr-2"}),t("common.backToAccounts")]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:t("transactions.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("transactions.subtitle")})]}),e.jsxs(pe,{className:"mb-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{label:t("transactions.search","Search"),placeholder:t("transactions.searchPlaceholder","Search by description..."),value:b,onChange:n=>j(n.target.value)}),b&&e.jsx("button",{onClick:()=>{j(""),K("search")},className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Clear search",children:e.jsx(J,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("transactions.dateRange","Date Range")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"thisWeek",label:t("date.thisWeek","This Week")},{key:"thisMonth",label:t("date.thisMonth","This Month")},{key:"lastMonth",label:t("date.lastMonth","Last Month")},{key:"last3Months",label:t("date.last3Months","Last 3 Months")},{key:"custom",label:t("date.custom","Custom")}].map(({key:n,label:u})=>e.jsx("button",{onClick:()=>Q(n),className:`px-3 py-1.5 text-sm rounded-md transition-colors ${U===n?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:u},n))})]}),U==="custom"&&e.jsx("div",{className:"mb-4",children:e.jsx(ra,{startDate:N.start_date||"",endDate:N.end_date||"",onRangeChange:(n,u)=>{R({...N,start_date:n,end_date:u})}})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("transactions.amountRange","Amount Range")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{type:"number",placeholder:t("transactions.minAmount","Min"),value:D,onChange:n=>q("min",n.target.value)}),D&&e.jsx("button",{onClick:()=>q("min",""),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600","aria-label":"Clear min",children:e.jsx(J,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{type:"number",placeholder:t("transactions.maxAmount","Max"),value:P,onChange:n=>q("max",n.target.value)}),P&&e.jsx("button",{onClick:()=>q("max",""),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600","aria-label":"Clear max",children:e.jsx(J,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(sa,{label:t("transactions.category","Category"),options:gt,selected:N.categories||[],onChange:n=>R({...N,categories:n}),placeholder:t("transactions.allCategories","All categories")}),(((He=N.categories)==null?void 0:He.length)??0)>0&&e.jsx("button",{onClick:()=>K("categories"),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600","aria-label":"Clear categories",children:e.jsx(J,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{label:t("transactions.source","Source"),value:N.source||"",onChange:n=>R({...N,source:n.target.value}),options:[{value:"",label:t("transactions.all","All")},...(c==null?void 0:c.map(n=>({value:n.name,label:n.name})))||[]]}),N.source&&e.jsx("button",{onClick:()=>K("source"),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600","aria-label":"Clear source",children:e.jsx(J,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[(Y("categories")||Y("source")||Y("min_amount")||Y("max_amount"))&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Y("categories")&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full",children:[t("filter.category"),": ",(Xe=N.categories)==null?void 0:Xe.length,e.jsx("button",{onClick:()=>K("categories"),className:"hover:text-blue-900",children:e.jsx(J,{className:"w-3 h-3"})})]}),Y("source")&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full",children:[t("filter.source"),": ",N.source,e.jsx("button",{onClick:()=>K("source"),className:"hover:text-green-900",children:e.jsx(J,{className:"w-3 h-3"})})]}),Y("min_amount")&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full",children:[t("filter.min"),": ",N.min_amount,e.jsx("button",{onClick:()=>K("min_amount"),className:"hover:text-purple-900",children:e.jsx(J,{className:"w-3 h-3"})})]}),Y("max_amount")&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full",children:[t("filter.max"),": ",N.max_amount,e.jsx("button",{onClick:()=>K("max_amount"),className:"hover:text-purple-900",children:e.jsx(J,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex gap-3 ml-auto",children:[e.jsx(F,{variant:"outline",onClick:yt,children:t("button.reset","Reset")}),e.jsx(F,{variant:"outline",onClick:()=>L&&Sa(L,N.start_date,N.end_date),disabled:!L||L.length===0,children:t("transactions.export","Export")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs(pe,{onClick:()=>$("income"),className:`cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] ${p==="income"?"ring-2 ring-green-500 dark:ring-green-400 bg-green-50/50 dark:bg-green-900/20":""}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.income")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-green-600 dark:text-green-400",children:Ae(bt,Ee,r,!0,s)})]}),e.jsxs(pe,{onClick:()=>$("expense"),className:`cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] ${p==="expense"?"ring-2 ring-red-500 dark:ring-red-400 bg-red-50/50 dark:bg-red-900/20":""}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.expense")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-red-600 dark:text-red-400",children:Ae(jt,Ee,r,!0,s)})]}),e.jsxs(pe,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.difference")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-blue-600 dark:text-blue-400",children:Ae(vt,Ee,r,!0,s)})]})]}),!oe&&L&&L.length>0&&e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("transactions.show","Show"),":"]}),e.jsx("div",{className:"hidden md:flex gap-1",children:[50,100,"all"].map(n=>e.jsx("button",{onClick:()=>ie(n),className:`px-3 py-1 text-sm rounded-md transition-colors ${te===n?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:n==="all"?t("transactions.showAll","All"):n},n))}),e.jsxs("select",{value:te,onChange:n=>ie(n.target.value==="all"?"all":Number(n.target.value)),className:"md:hidden px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"all",children:t("transactions.showAll","All")})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("transactions.sort","Sort"),":"]}),e.jsxs("select",{value:`${T}-${z}`,onChange:n=>ue(n.target.value),className:"px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"date-desc",children:t("transactions.sortDateDesc","Date â†“")}),e.jsx("option",{value:"date-asc",children:t("transactions.sortDateAsc","Date â†‘")}),e.jsx("option",{value:"amount-desc",children:t("transactions.sortAmountDesc","Amount â†“")}),e.jsx("option",{value:"amount-asc",children:t("transactions.sortAmountAsc","Amount â†‘")})]}),ne&&e.jsxs("svg",{className:"animate-spin h-4 w-4 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("transactions.showingCount","Showing {{shown}} of {{total}}",{shown:ve.length,total:Se.length})})]}),oe?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.date")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.description")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.category")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.source")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.amount")}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:t("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:[...Array(5)].map((n,u)=>e.jsx(Lt,{},u))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:[...Array(5)].map((n,u)=>e.jsx(At,{},u))})]}):L&&L.length>0?e.jsxs("div",{className:`transition-opacity duration-150 ${ne?"opacity-50":"opacity-100"}`,children:[e.jsx(pe,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12",children:e.jsx("input",{type:"checkbox",checked:Je,onChange:xt,className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>X("date"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.date"),T==="date"&&e.jsx("span",{className:"text-blue-600",children:z==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>X("description"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.description"),T==="description"&&e.jsx("span",{className:"text-blue-600",children:z==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>X("category"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.category"),T==="category"&&e.jsx("span",{className:"text-blue-600",children:z==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>X("source"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.source"),T==="source"&&e.jsx("span",{className:"text-blue-600",children:z==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>X("amount"),children:e.jsxs("span",{className:"flex items-center justify-end gap-1",children:[t("transactions.amount"),T==="amount"&&e.jsx("span",{className:"text-blue-600",children:z==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:t("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:ve.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:g.has(n.id),onChange:()=>ht(n.id),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:Ye(n.date)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:n.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(ot,{variant:n.type==="income"?"info":"default",children:n.category})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-300",children:n.source}),e.jsx("td",{className:`px-6 py-4 text-sm font-semibold font-numbers text-right ${n.is_transfer?"text-blue-500 dark:text-blue-400":n.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:$e(n.amount,n.type,n.currency||"JPY",r,!0,s)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>ee(n),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors","aria-label":t("button.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})})}),e.jsx("button",{onClick:()=>B(n),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors","aria-label":t("button.delete"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-red-600 dark:text-red-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]})})]},n.id))})]})}),e.jsx("div",{className:"md:hidden space-y-6",children:T==="date"?kt.map(n=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:Ot(n.date)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx("div",{className:"space-y-3",children:n.transactions.map(u=>e.jsx(et,{transaction:u,onEdit:ee,onDelete:B},u.id))})]},n.date)):e.jsx("div",{className:"space-y-3",children:ve.map(n=>e.jsx(et,{transaction:n,onEdit:ee,onDelete:B},n.id))})})]}):e.jsx(pe,{children:e.jsx(_t,{icon:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),title:t("transactions.noData"),description:t("transactions.noDataDescription","Upload a CSV file or add transactions manually to get started."),action:e.jsx(F,{onClick:()=>w(!0),children:t("transaction.addTransaction")})})}),g.size>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg p-4 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("transactions.selectedCount","{{count}} selected",{count:g.size})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>E(new Set),children:t("button.clearSelection","Clear")}),e.jsx(F,{variant:"outline",size:"sm",onClick:()=>ae(!0),children:t("transactions.recategorize","Recategorize")}),e.jsx(F,{variant:"danger",size:"sm",onClick:()=>I(!0),children:t("transactions.deleteSelected","Delete")})]})]})}),e.jsx(la,{isOpen:!!he,onClose:()=>ee(null),transaction:he}),e.jsx(xa,{isOpen:me,onClose:()=>w(!1)}),e.jsx(va,{isOpen:!!O,onClose:()=>B(null),onConfirm:pt,transaction:O,isDeleting:Ve.isPending}),e.jsx(ka,{isOpen:ge,onClose:()=>ae(!1),onConfirm:n=>Qe.mutate(n),selectedCount:g.size,isLoading:Qe.isPending}),e.jsx(Na,{isOpen:y,onClose:()=>I(!1),onConfirm:()=>We.mutate(),selectedCount:g.size,isDeleting:We.isPending}),e.jsx(mt,{isOpen:be,onClose:()=>de(!1),onScanComplete:ke}),e.jsx(ja,{})]})}const Ua=St("/transactions")({component:Da});export{Ua as Route};
