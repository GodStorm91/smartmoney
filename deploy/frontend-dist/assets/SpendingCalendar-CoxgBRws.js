import{r as x,j as e}from"./vendor-react-CezGY3Eh.js";import{u as V}from"./vendor-query-Dt5Hl5qC.js";import{be as S,bf as D,bg as H,bh as R,J as $,x as U,E as X,bi as Z,b4 as N,bj as ee,C as te,j as y,n as I,aB as re,a$ as ae,m as se,ak as ne,W as de,a3 as oe}from"./index-BaDR0x1b.js";import{u as le}from"./vendor-i18n-DHVoooz2.js";import{b as ce,e as ie,s as xe,a as ge}from"./subMonths-ZEi45hCm.js";import{D as me}from"./dollar-sign-Cx3UAe9h.js";import"./vendor-charts-Co6UKelL.js";import"./vendor-router-CjTheb1B.js";function ue(s){return S(s,Date.now())}function q(s,r,n){const[o,l]=D(n==null?void 0:n.in,s,r);return+H(o)==+H(l)}function he(s,r){const[n,o]=D(s,r.start,r.end);return{start:n,end:o}}function ye(s,r){const{start:n,end:o}=he(r==null?void 0:r.in,s);let l=+n>+o;const f=l?+n:+o,i=l?o:n;i.setHours(0,0,0,0);let c=1;const m=[];for(;+i<=f;)m.push(S(n,i)),i.setDate(i.getDate()+c),i.setHours(0,0,0,0);return l?m.reverse():m}function fe(s,r){const n=r==null?void 0:r.weekStartsOn,o=R(s,r==null?void 0:r.in),l=o.getDay(),f=(l<n?-7:0)+6-(l-n);return o.setDate(o.getDate()+f),o.setHours(23,59,59,999),o}function W(s,r){return R(s,r==null?void 0:r.in).getDate()}function M(s,r,n){const[o,l]=D(n==null?void 0:n.in,s,r);return o.getFullYear()===l.getFullYear()&&o.getMonth()===l.getMonth()}function pe(s,r){return q(S(s,s),ue(s))}const J=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=[{threshold:0,color:"bg-gray-50 dark:bg-gray-800",border:"border-gray-100 dark:border-gray-700",text:"text-gray-400"},{threshold:1e3,color:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-600 dark:text-green-400"},{threshold:5e3,color:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-600 dark:text-yellow-400"},{threshold:1e4,color:"bg-orange-50 dark:bg-orange-900/20",border:"border-orange-200 dark:border-orange-800",text:"text-orange-600 dark:text-orange-400"},{threshold:2e4,color:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-600 dark:text-red-400"},{threshold:5e4,color:"bg-red-100 dark:bg-red-900/30",border:"border-red-300 dark:border-red-700",text:"text-red-700 dark:text-red-300"}];function be(s){return s===0?g[0]:s<1e3?g[1]:s<5e3?g[2]:s<1e4?g[3]:s<2e4?g[4]:g[5]}function Ce({className:s,onDayClick:r}){const{t:n,i18n:o}=le("common"),{currency:l}=$(),{isPrivacyMode:f}=U(),i=X(),[c,m]=x.useState(new Date),[C,E]=x.useState(null),P=Z(),z=J.map(t=>{const a=new Date;return a.setDate(J.indexOf(t)+1),N(a,"EEE",{locale:P})}),O=ce(c),k=ie(O),T=ee(O,{weekStartsOn:0}),_=fe(k,{weekStartsOn:0}),{data:v,isLoading:A}=V({queryKey:["transactions-calendar",N(c,"yyyy-MM")],queryFn:async()=>await oe()}),p=x.useMemo(()=>{if(!v)return new Map;const t=new Map;return v.forEach(a=>{var F;if(a.type==="income"||a.is_transfer||a.is_adjustment||a.category==="Proxy Purchase"||a.category==="Proxy Income"||(F=a.transfer_type)!=null&&F.startsWith("proxy_"))return;const d=N(new Date(a.date),"yyyy-MM-dd"),u=t.get(d)||{date:new Date(a.date),totalSpending:0,transactionCount:0,transactions:[]},j=a.currency||"JPY",h=i[j]||1,Q=a.amount/h;u.totalSpending+=Math.abs(Q),u.transactionCount+=1,u.transactions.push(a),t.set(d,u)}),t},[v,i]),K=x.useMemo(()=>ye({start:T,end:_}),[T,_]),b=t=>de(t,l,i,!1,f),w=x.useMemo(()=>{let t=0;return p.forEach(a=>{M(a.date,c)&&(t+=a.totalSpending)}),t},[p,c]),Y=x.useMemo(()=>{const t=W(k);return t>0?w/t:0},[w,k]),L=x.useMemo(()=>{let t=0,a=null;return p.forEach(d=>{M(d.date,c)&&d.totalSpending>t&&(t=d.totalSpending,a=d)}),a},[p,c]),B=()=>m(xe(c,1)),G=()=>m(ge(c,1));return e.jsxs(te,{className:y("p-4",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-primary-500"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("spendingCalendar.title","Spending Calendar")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:B,className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(re,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 min-w-[100px] text-center",children:ae(c)}),e.jsx("button",{onClick:G,className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(se,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-expense-50 dark:bg-expense-900/20 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(ne,{className:"w-3.5 h-3.5 text-expense-600 dark:text-expense-300"}),e.jsx("span",{className:"text-xs text-expense-600 dark:text-expense-300",children:n("spendingCalendar.monthlyTotal","Monthly")})]}),e.jsx("p",{className:"text-sm font-bold text-expense-600 dark:text-expense-300 font-numbers",children:b(w)})]}),e.jsxs("div",{className:"bg-net-50 dark:bg-net-900/20 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(me,{className:"w-3.5 h-3.5 text-net-600 dark:text-net-300"}),e.jsx("span",{className:"text-xs text-net-600 dark:text-net-300",children:n("spendingCalendar.dailyAvg","Daily Avg")})]}),e.jsx("p",{className:"text-sm font-bold text-net-600 dark:text-net-300 font-numbers",children:b(Y)})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(I,{className:"w-3.5 h-3.5 text-purple-500"}),e.jsx("span",{className:"text-xs text-purple-600 dark:text-purple-400",children:n("spendingCalendar.highestDay","Highest")})]}),e.jsx("p",{className:"text-sm font-bold text-purple-700 dark:text-purple-300 font-numbers",children:L?b(L.totalSpending):"-"})]})]}),A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-7 mb-2",children:z.map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-gray-500 dark:text-gray-400 py-1",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:K.map(t=>{const a=N(t,"yyyy-MM-dd"),d=p.get(a),u=M(t,c),j=pe(t),h=be((d==null?void 0:d.totalSpending)||0);return e.jsxs("div",{className:y("relative aspect-square p-1 rounded-lg border cursor-pointer transition-all duration-200",h.color,h.border,u?"opacity-100":"opacity-40",j&&"ring-2 ring-primary-500 ring-offset-1 dark:ring-offset-gray-800",r&&"hover:scale-105 hover:shadow-md"),onMouseEnter:()=>E(t),onMouseLeave:()=>E(null),onClick:()=>r==null?void 0:r(t,(d==null?void 0:d.transactions)||[]),children:[e.jsxs("div",{className:y("w-full h-full flex flex-col items-center justify-center",j&&"font-bold"),children:[e.jsx("span",{className:y("text-xs",j?"text-primary-600 dark:text-primary-400":h.text),children:W(t)}),d&&d.totalSpending>0&&e.jsx("span",{className:y("text-[10px] font-medium mt-0.5",h.text),children:b(d.totalSpending)})]}),C&&q(t,C)&&d&&e.jsxs("div",{className:"absolute z-10 bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 dark:bg-gray-700 text-white text-xs rounded-lg shadow-lg whitespace-nowrap",children:[e.jsx("div",{className:"font-medium mb-1",children:N(t,"PPP",{locale:P})}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{children:n("spendingCalendar.transactionCount","{{count}} transactions",{count:d.transactionCount})}),e.jsxs("span",{className:"font-bold text-red-300",children:["-",b(d.totalSpending)]})]}),e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1 w-2 h-2 bg-gray-900 dark:bg-gray-700 rotate-45"})]})]},a)})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500",children:n("spendingCalendar.legend","Less")}),g.slice(0,5).map((t,a)=>e.jsx("div",{className:y("w-4 h-4 rounded",t.color,"border",a===4&&"ring-1 ring-gray-400")},a)),e.jsx("span",{className:"text-xs text-gray-500",children:n("spendingCalendar.legendMore","More")})]})]})]})}export{Ce as SpendingCalendar,Ce as default};
