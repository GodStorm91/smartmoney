import{$ as Vt,N as Kt,M as yn,u as tt,aW as Ve,j as a,a8 as be,as as $,l as Y,ah as Wt,r as N,z as Lt,C as Z,E as Rt,aX as Ke,H as He,J as xn,a3 as ve,B as J,x as bn,aY as vn,ar as St,a0 as _n,aZ as Qt,a_ as Dt,a$ as wn,aK as Sn,i as kn}from"./index-D4jnuRad.js";import{B as jn,a as Pt,M as En,I as Tn,C as In}from"./IncomeExpenseBarChart-D65onRLs.js";import{R as $e,B as Ye,E as Cn,F as Nn,H as An,s as Mn}from"./generateCategoricalChart-jyvHPnEp.js";import{L as Dn}from"./LineChart-KHv3-KCW.js";import{C as Pn,X as Ue,Y as Ge,L as On}from"./YAxis-BFlQe59X.js";const _e={income:"#4CAF50",expense:"#F44336",net:"#2196F3"};function Ln({data:n,dataKey:t}){const{currency:e}=Vt(),{data:s}=Kt(),{isPrivacyMode:r}=yn(),{t:i}=tt("common"),{resolvedTheme:o}=Ve(),c=o==="dark",u=c?"#45475a":"#E5E7EB",l=c?"#a6adc8":"#6B7280",d=c?"#1e1e2e":"#fff",f=c?"#45475a":"#E5E7EB",h=c?"#cdd6f4":"#374151",y={income:i("chart.income"),expense:i("chart.expense"),net:i("chart.net")};return a.jsx($e,{width:"100%",height:"100%",children:a.jsxs(Dn,{data:n,margin:{top:5,right:30,left:20,bottom:5},children:[a.jsx(Pn,{strokeDasharray:"3 3",stroke:u}),a.jsx(Ue,{dataKey:"month",stroke:l,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),a.jsx(Ge,{stroke:l,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:p=>be(p,e,(s==null?void 0:s.rates)||{},!1,r)}),a.jsx(Ye,{contentStyle:{backgroundColor:d,border:`1px solid ${f}`,borderRadius:"8px",fontSize:"14px",color:h},formatter:p=>[be(p,e,(s==null?void 0:s.rates)||{},!1,r),y[t]]}),a.jsx(Cn,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:h}}),a.jsx(On,{type:"monotone",dataKey:t,stroke:_e[t],strokeWidth:2,dot:{fill:_e[t],r:4},activeDot:{r:6},name:y[t],isAnimationActive:!0,animationBegin:0,animationDuration:1200,animationEasing:"ease-out"})]})})}function Bn({data:n,savingsGoal:t}){const{t:e}=tt("common"),{currency:s}=Vt(),{data:r}=Kt(),{resolvedTheme:i}=Ve(),o=i==="dark",c=o?"#1e1e2e":"#fff",u=o?"#45475a":"#E5E7EB",l=o?"#cdd6f4":"#374151",d=n.length>0?n[n.length-1]:null,f=(d==null?void 0:d.net)||0,h=n.length>1?n.slice(0,-1):n,y=h.length>0?h.reduce((b,_)=>b+_.net,0)/h.length:f,p=[{name:e("analytics.thisMonth"),value:f,color:f>=0?"#4CAF50":"#F44336"},{name:e("analytics.average"),value:y,color:"#9E9E9E"}],g=y!==0?(f-y)/Math.abs(y)*100:0,x=g>=0,m=t&&t>0?Math.min(f/t*100,100):null;return n.length===1?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-8",children:[a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:e("analytics.netCashFlow")}),a.jsx("p",{className:Y("text-3xl font-bold",f>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:$(f,s,(r==null?void 0:r.rates)||{},!1)}),f>=0&&a.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:e("analytics.positiveCashFlow")}),t&&t>0&&a.jsxs("div",{className:"mt-4 w-full max-w-xs",children:[a.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[a.jsx("span",{children:e("analytics.savingsGoal")}),a.jsxs("span",{children:[(m??0).toFixed(0),"%"]})]}),a.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:a.jsx("div",{className:Y("h-full rounded-full transition-all duration-700 ease-out",m&&m>=100?"bg-green-500":"bg-primary-500"),style:{width:`${m||0}%`}})}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:[$(t,s,(r==null?void 0:r.rates)||{},!1)," ",e("analytics.target")]})]})]}):a.jsxs("div",{className:"w-full h-full flex flex-col",children:[a.jsx("div",{className:"flex-1 min-h-[150px]",children:a.jsx($e,{width:"100%",height:"100%",children:a.jsxs(jn,{data:p,layout:"vertical",margin:{top:10,right:60,left:10,bottom:10},children:[a.jsx(Ue,{type:"number",hide:!0}),a.jsx(Ge,{type:"category",dataKey:"name",width:80,tick:{fill:l,fontSize:12},axisLine:!1,tickLine:!1}),a.jsx(Ye,{contentStyle:{backgroundColor:c,border:`1px solid ${u}`,borderRadius:"8px",fontSize:"14px",color:l},formatter:b=>[$(b,s,(r==null?void 0:r.rates)||{},!1),e("analytics.netCashFlow")]}),t&&t>0&&a.jsx(Nn,{x:t,stroke:"#9C27B0",strokeDasharray:"3 3",label:{value:e("analytics.goal"),position:"top",fill:"#9C27B0",fontSize:10}}),a.jsx(An,{dataKey:"value",radius:[0,4,4,0],maxBarSize:32,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:p.map((b,_)=>a.jsx(Mn,{fill:b.color},`cell-${_}`))})]})})}),a.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 border-t border-gray-100 dark:border-gray-800",children:[a.jsxs("span",{className:Y("text-sm font-medium",x?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[x?"â–²":"â–¼"," ",Math.abs(g).toFixed(1),"%"]}),a.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("analytics.vsAverage")})]}),t&&t>0&&a.jsxs("div",{className:"px-4 pb-2",children:[a.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[a.jsx("span",{children:e("analytics.savingsGoal")}),a.jsxs("span",{children:[$(f,s,(r==null?void 0:r.rates)||{},!1)," / ",$(t,s,(r==null?void 0:r.rates)||{},!1)]})]}),a.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:a.jsx("div",{className:Y("h-full rounded-full transition-all duration-700 ease-out",m&&m>=100?"bg-green-500":"bg-primary-500"),style:{width:`${m||0}%`}})})]})]})}function Rn(n,t,e){return Math.max(t,Math.min(n,e))}const M={toVector(n,t){return n===void 0&&(n=t),Array.isArray(n)?n:[n,n]},add(n,t){return[n[0]+t[0],n[1]+t[1]]},sub(n,t){return[n[0]-t[0],n[1]-t[1]]},addTo(n,t){n[0]+=t[0],n[1]+=t[1]},subTo(n,t){n[0]-=t[0],n[1]-=t[1]}};function we(n,t,e){return t===0||Math.abs(t)===1/0?Math.pow(n,e*5):n*t*e/(t+e*n)}function Se(n,t,e,s=.15){return s===0?Rn(n,t,e):n<t?-we(t-n,e-t,s)+t:n>e?+we(n-e,e-t,s)+e:n}function zn(n,[t,e],[s,r]){const[[i,o],[c,u]]=n;return[Se(t,i,o,s),Se(e,c,u,r)]}function Fn(n,t){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Vn(n){var t=Fn(n,"string");return typeof t=="symbol"?t:String(t)}function R(n,t,e){return t=Vn(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function ke(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),e.push.apply(e,s)}return e}function L(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ke(Object(e),!0).forEach(function(s){R(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ke(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}const qe={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function je(n){return n?n[0].toUpperCase()+n.slice(1):""}const Kn=["enter","leave"];function Hn(n=!1,t){return n&&!Kn.includes(t)}function $n(n,t="",e=!1){const s=qe[n],r=s&&s[t]||t;return"on"+je(n)+je(r)+(Hn(e,r)?"Capture":"")}const Yn=["gotpointercapture","lostpointercapture"];function Un(n){let t=n.substring(2).toLowerCase();const e=!!~t.indexOf("passive");e&&(t=t.replace("passive",""));const s=Yn.includes(t)?"capturecapture":"capture",r=!!~t.indexOf(s);return r&&(t=t.replace("capture","")),{device:t,capture:r,passive:e}}function Gn(n,t=""){const e=qe[n],s=e&&e[t]||t;return n+s}function Ht(n){return"touches"in n}function Xe(n){return Ht(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function qn(n){return Array.from(n.touches).filter(t=>{var e,s;return t.target===n.currentTarget||((e=n.currentTarget)===null||e===void 0||(s=e.contains)===null||s===void 0?void 0:s.call(e,t.target))})}function Xn(n){return n.type==="touchend"||n.type==="touchcancel"?n.changedTouches:n.targetTouches}function We(n){return Ht(n)?Xn(n)[0]:n}function te(n,t){try{const e=t.clientX-n.clientX,s=t.clientY-n.clientY,r=(t.clientX+n.clientX)/2,i=(t.clientY+n.clientY)/2,o=Math.hypot(e,s);return{angle:-(Math.atan2(e,s)*180)/Math.PI,distance:o,origin:[r,i]}}catch{}return null}function Wn(n){return qn(n).map(t=>t.identifier)}function Ee(n,t){const[e,s]=Array.from(n.touches).filter(r=>t.includes(r.identifier));return te(e,s)}function Jt(n){const t=We(n);return Ht(n)?t.identifier:t.pointerId}function xt(n){const t=We(n);return[t.clientX,t.clientY]}const Te=40,Ie=800;function Qe(n){let{deltaX:t,deltaY:e,deltaMode:s}=n;return s===1?(t*=Te,e*=Te):s===2&&(t*=Ie,e*=Ie),[t,e]}function Qn(n){var t,e;const{scrollX:s,scrollY:r,scrollLeft:i,scrollTop:o}=n.currentTarget;return[(t=s??i)!==null&&t!==void 0?t:0,(e=r??o)!==null&&e!==void 0?e:0]}function Jn(n){const t={};if("buttons"in n&&(t.buttons=n.buttons),"shiftKey"in n){const{shiftKey:e,altKey:s,metaKey:r,ctrlKey:i}=n;Object.assign(t,{shiftKey:e,altKey:s,metaKey:r,ctrlKey:i})}return t}function zt(n,...t){return typeof n=="function"?n(...t):n}function Zn(){}function ts(...n){return n.length===0?Zn:n.length===1?n[0]:function(){let t;for(const e of n)t=e.apply(this,arguments)||t;return t}}function Ce(n,t){return Object.assign({},t,n||{})}const es=32;let Je=class{constructor(t,e,s){this.ctrl=t,this.args=e,this.key=s,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:e,ingKey:s,args:r}=this;e[s]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=r,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const e=this.state,s=this.config;e._active||(this.reset(),this.computeInitial(),e._active=!0,e.target=t.target,e.currentTarget=t.currentTarget,e.lastOffset=s.from?zt(s.from,e):e.offset,e.offset=e.lastOffset,e.startTime=e.timeStamp=t.timeStamp)}computeValues(t){const e=this.state;e._values=t,e.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:e,config:s,shared:r}=this;e.args=this.args;let i=0;if(t&&(e.event=t,s.preventDefault&&t.cancelable&&e.event.preventDefault(),e.type=t.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,Jn(t)),r.down=r.pressed=r.buttons%2===1||r.touches>0,i=t.timeStamp-e.timeStamp,e.timeStamp=t.timeStamp,e.elapsedTime=e.timeStamp-e.startTime),e._active){const j=e._delta.map(Math.abs);M.addTo(e._distance,j)}this.axisIntent&&this.axisIntent(t);const[o,c]=e._movement,[u,l]=s.threshold,{_step:d,values:f}=e;if(s.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=u&&f[0]),d[1]===!1&&(d[1]=Math.abs(c)>=l&&f[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=u&&Math.sign(o)*u),d[1]===!1&&(d[1]=Math.abs(c)>=l&&Math.sign(c)*l)),e.intentional=d[0]!==!1||d[1]!==!1,!e.intentional)return;const h=[0,0];if(s.hasCustomTransform){const[j,v]=f;h[0]=d[0]!==!1?j-d[0]:0,h[1]=d[1]!==!1?v-d[1]:0}else h[0]=d[0]!==!1?o-d[0]:0,h[1]=d[1]!==!1?c-d[1]:0;this.restrictToAxis&&!e._blocked&&this.restrictToAxis(h);const y=e.offset,p=e._active&&!e._blocked||e.active;p&&(e.first=e._active&&!e.active,e.last=!e._active&&e.active,e.active=r[this.ingKey]=e._active,t&&(e.first&&("bounds"in s&&(e._bounds=zt(s.bounds,e)),this.setup&&this.setup()),e.movement=h,this.computeOffset()));const[g,x]=e.offset,[[m,b],[_,E]]=e._bounds;e.overflow=[g<m?-1:g>b?1:0,x<_?-1:x>E?1:0],e._movementBound[0]=e.overflow[0]?e._movementBound[0]===!1?e._movement[0]:e._movementBound[0]:!1,e._movementBound[1]=e.overflow[1]?e._movementBound[1]===!1?e._movement[1]:e._movementBound[1]:!1;const I=e._active?s.rubberband||[0,0]:[0,0];if(e.offset=zn(e._bounds,e.offset,I),e.delta=M.sub(e.offset,y),this.computeMovement(),p&&(!e.last||i>es)){e.delta=M.sub(e.offset,y);const j=e.delta.map(Math.abs);M.addTo(e.distance,j),e.direction=e.delta.map(Math.sign),e._direction=e._delta.map(Math.sign),!e.first&&i>0&&(e.velocity=[j[0]/i,j[1]/i],e.timeDelta=i)}}emit(){const t=this.state,e=this.shared,s=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!s.triggerAllEvents)return;const r=this.handler(L(L(L({},e),t),{},{[this.aliasKey]:t.values}));r!==void 0&&(t.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};function ns([n,t],e){const s=Math.abs(n),r=Math.abs(t);if(s>r&&s>e)return"x";if(r>s&&r>e)return"y"}class Ct extends Je{constructor(...t){super(...t),R(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=M.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=M.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const e=this.state,s=this.config;if(!e.axis&&t){const r=typeof s.axisThreshold=="object"?s.axisThreshold[Xe(t)]:s.axisThreshold;e.axis=ns(e._movement,r)}e._blocked=(s.lockDirection||!!s.axis)&&!e.axis||!!s.axis&&s.axis!==e.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const ss=n=>n,Ne=.15,Ze={enabled(n=!0){return n},eventOptions(n,t,e){return L(L({},e.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[Ne,Ne];case!1:return[0,0];default:return M.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return M.toVector(n)},transform(n,t,e){const s=n||e.shared.transform;return this.hasCustomTransform=!!s,s||ss},threshold(n){return M.toVector(n,0)}},rs=0,ft=L(L({},Ze),{},{axis(n,t,{axis:e}){if(this.lockDirection=e==="lock",!this.lockDirection)return e},axisThreshold(n=rs){return n},bounds(n={}){if(typeof n=="function")return i=>ft.bounds(n(i));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:t=-1/0,right:e=1/0,top:s=-1/0,bottom:r=1/0}=n;return[[t,e],[s,r]]}}),Ae={ArrowRight:(n,t=1)=>[n*t,0],ArrowLeft:(n,t=1)=>[-1*n*t,0],ArrowUp:(n,t=1)=>[0,-1*n*t],ArrowDown:(n,t=1)=>[0,n*t]};class is extends Ct{constructor(...t){super(...t),R(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const e=t._bounds.getBoundingClientRect(),s=t.currentTarget.getBoundingClientRect(),r={left:e.left-s.left+t.offset[0],right:e.right-s.right+t.offset[0],top:e.top-s.top+t.offset[1],bottom:e.bottom-s.bottom+t.offset[1]};t._bounds=ft.bounds(r)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const e=this.config,s=this.state;if(t.buttons!=null&&(Array.isArray(e.pointerButtons)?!e.pointerButtons.includes(t.buttons):e.pointerButtons!==-1&&e.pointerButtons!==t.buttons))return;const r=this.ctrl.setEventIds(t);e.pointerCapture&&t.target.setPointerCapture(t.pointerId),!(r&&r.size>1&&s._pointerActive)&&(this.start(t),this.setupPointer(t),s._pointerId=Jt(t),s._pointerActive=!0,this.computeValues(xt(t)),this.computeInitial(),e.preventScrollAxis&&Xe(t)!=="mouse"?(s._active=!1,this.setupScrollPrevention(t)):e.delay>0?(this.setupDelayTrigger(t),e.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const e=this.state;e._active=!0,e._preventScroll=!0,e._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const e=this.state,s=this.config;if(!e._pointerActive)return;const r=Jt(t);if(e._pointerId!==void 0&&r!==e._pointerId)return;const i=xt(t);if(document.pointerLockElement===t.target?e._delta=[t.movementX,t.movementY]:(e._delta=M.sub(i,e._values),this.computeValues(i)),M.addTo(e._movement,e._delta),this.compute(t),e._delayed&&e.intentional){this.timeoutStore.remove("dragDelay"),e.active=!1,this.startPointerDrag(t);return}if(s.preventScrollAxis&&!e._preventScroll)if(e.axis)if(e.axis===s.preventScrollAxis||s.preventScrollAxis==="xy"){e._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(t);return}else return;this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch{}const e=this.state,s=this.config;if(!e._active||!e._pointerActive)return;const r=Jt(t);if(e._pointerId!==void 0&&r!==e._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[i,o]=e._distance;if(e.tap=i<=s.tapsThreshold&&o<=s.tapsThreshold,e.tap&&s.filterTaps)e._force=!0;else{const[c,u]=e._delta,[l,d]=e._movement,[f,h]=s.swipe.velocity,[y,p]=s.swipe.distance,g=s.swipe.duration;if(e.elapsedTime<g){const x=Math.abs(c/e.timeDelta),m=Math.abs(u/e.timeDelta);x>f&&Math.abs(l)>y&&(e.swipe[0]=Math.sign(c)),m>h&&Math.abs(d)>p&&(e.swipe[1]=Math.sign(u))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const e=this.config,s=e.device;e.pointerLock&&t.currentTarget.requestPointerLock(),e.pointerCapture||(this.eventStore.add(this.sharedConfig.window,s,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,s,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,s,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,os(t);const e=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",e),this.eventStore.add(this.sharedConfig.window,"touch","cancel",e),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const e=Ae[t.key];if(e){const s=this.state,r=t.shiftKey?10:t.altKey?.1:1;this.start(t),s._delta=e(this.config.keyboardDisplacement,r),s._keyboardActive=!0,M.addTo(s._movement,s._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Ae&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const e=this.config.device;t(e,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(e,"change",this.pointerMove.bind(this)),t(e,"end",this.pointerUp.bind(this)),t(e,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function os(n){"persist"in n&&typeof n.persist=="function"&&n.persist()}const Nt=typeof window<"u"&&window.document&&window.document.createElement;function tn(){return Nt&&"ontouchstart"in window}function as(){return tn()||Nt&&window.navigator.maxTouchPoints>1}function cs(){return Nt&&"onpointerdown"in window}function ls(){return Nt&&"exitPointerLock"in window.document}function us(){try{return"constructor"in GestureEvent}catch{return!1}}const H={isBrowser:Nt,gesture:us(),touch:tn(),touchscreen:as(),pointer:cs(),pointerLock:ls()},ds=250,fs=180,hs=.5,ms=50,ps=250,gs=10,Me={mouse:0,touch:0,pen:8},ys=L(L({},ft),{},{device(n,t,{pointer:{touch:e=!1,lock:s=!1,mouse:r=!1}={}}){return this.pointerLock=s&&H.pointerLock,H.touch&&e?"touch":this.pointerLock?"mouse":H.pointer&&!r?"pointer":H.touch?"touch":"mouse"},preventScrollAxis(n,t,{preventScroll:e}){if(this.preventScrollDelay=typeof e=="number"?e:e||e===void 0&&n?ds:void 0,!(!H.touchscreen||e===!1))return n||(e!==void 0?"y":void 0)},pointerCapture(n,t,{pointer:{capture:e=!0,buttons:s=1,keys:r=!0}={}}){return this.pointerButtons=s,this.keys=r,!this.pointerLock&&this.device==="pointer"&&e},threshold(n,t,{filterTaps:e=!1,tapsThreshold:s=3,axis:r=void 0}){const i=M.toVector(n,e?s:r?1:0);return this.filterTaps=e,this.tapsThreshold=s,i},swipe({velocity:n=hs,distance:t=ms,duration:e=ps}={}){return{velocity:this.transform(M.toVector(n)),distance:this.transform(M.toVector(t)),duration:e}},delay(n=0){switch(n){case!0:return fs;case!1:return 0;default:return n}},axisThreshold(n){return n?L(L({},Me),n):Me},keyboardDisplacement(n=gs){return n}});function en(n){const[t,e]=n.overflow,[s,r]=n._delta,[i,o]=n._direction;(t<0&&s>0&&i<0||t>0&&s<0&&i>0)&&(n._movement[0]=n._movementBound[0]),(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(n._movement[1]=n._movementBound[1])}const xs=30,bs=100;class vs extends Je{constructor(...t){super(...t),R(this,"ingKey","pinching"),R(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:e,lastOffset:s}=this.state;t==="wheel"?this.state.offset=M.add(e,s):this.state.offset=[(1+e[0])*s[0],e[1]+s[1]]}computeMovement(){const{offset:t,lastOffset:e}=this.state;this.state.movement=[t[0]/e[0],t[1]-e[1]]}axisIntent(){const t=this.state,[e,s]=t._movement;if(!t.axis){const r=Math.abs(e)*xs-Math.abs(s);r<0?t.axis="angle":r>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&(this.state.axis==="scale"?t[1]=0:this.state.axis==="angle"&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const e=this.state,s=this.ctrl.touchIds;if(e._active&&e._touchIds.every(i=>s.has(i))||s.size<2)return;this.start(t),e._touchIds=Array.from(s).slice(0,2);const r=Ee(t,e._touchIds);r&&this.pinchStart(t,r)}pointerStart(t){if(t.buttons!=null&&t.buttons%2!==1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const e=this.state,s=e._pointerEvents,r=this.ctrl.pointerIds;if(e._active&&Array.from(s.keys()).every(o=>r.has(o))||(s.size<2&&s.set(t.pointerId,t),e._pointerEvents.size<2))return;this.start(t);const i=te(...Array.from(s.values()));i&&this.pinchStart(t,i)}pinchStart(t,e){const s=this.state;s.origin=e.origin,this.computeValues([e.distance,e.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const e=Ee(t,this.state._touchIds);e&&this.pinchMove(t,e)}pointerMove(t){const e=this.state._pointerEvents;if(e.has(t.pointerId)&&e.set(t.pointerId,t),!this.state._active)return;const s=te(...Array.from(e.values()));s&&this.pinchMove(t,s)}pinchMove(t,e){const s=this.state,r=s._values[1],i=e.angle-r;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([e.distance,e.angle-360*o]),s.origin=e.origin,s.turns=o,s._movement=[s._values[0]/s._initial[0]-1,s._values[1]-s._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const e=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch{}e._pointerEvents.has(t.pointerId)&&e._pointerEvents.delete(t.pointerId),e._active&&e._pointerEvents.size<2&&(e._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const e=this.state;e._active||(this.start(t),this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const e=this.state;this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY];const s=e._movement;e._movement=[t.scale-1,t.rotation],e._delta=M.sub(e._movement,s),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const e=this.config.modifierKey;e&&(Array.isArray(e)?!e.find(s=>t[s]):!t[e])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const s=this.state;s._delta=[-Qe(t)[1]/bs*s.offset[0],0],M.addTo(s._movement,s._delta),en(s),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const e=this.config.device;e&&(t(e,"start",this[e+"Start"].bind(this)),t(e,"change",this[e+"Move"].bind(this)),t(e,"end",this[e+"End"].bind(this)),t(e,"cancel",this[e+"End"].bind(this)),t("lostPointerCapture","",this[e+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}}const _s=L(L({},Ze),{},{device(n,t,{shared:e,pointer:{touch:s=!1}={}}){if(e.target&&!H.touch&&H.gesture)return"gesture";if(H.touch&&s)return"touch";if(H.touchscreen){if(H.pointer)return"pointer";if(H.touch)return"touch"}},bounds(n,t,{scaleBounds:e={},angleBounds:s={}}){const r=o=>{const c=Ce(zt(e,o),{min:-1/0,max:1/0});return[c.min,c.max]},i=o=>{const c=Ce(zt(s,o),{min:-1/0,max:1/0});return[c.min,c.max]};return typeof e!="function"&&typeof s!="function"?[r(),i()]:o=>[r(o),i(o)]},threshold(n,t,e){return this.lockDirection=e.axis==="lock",M.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});class ws extends Ct{constructor(...t){super(...t),R(this,"ingKey","moving")}move(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues(xt(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const e=xt(t),s=this.state;s._delta=M.sub(e,s._values),M.addTo(s._movement,s._delta),this.computeValues(e),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}}const Ss=L(L({},ft),{},{mouseOnly:(n=!0)=>n});class ks extends Ct{constructor(...t){super(...t),R(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const e=this.state,s=Qn(t);e._delta=M.sub(s,e._values),M.addTo(e._movement,e._delta),this.computeValues(s),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}}const js=ft;class Es extends Ct{constructor(...t){super(...t),R(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const e=this.state;e._delta=Qe(t),M.addTo(e._movement,e._delta),en(e),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}}const Ts=ft;class Is extends Ct{constructor(...t){super(...t),R(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.start(t),this.computeValues(xt(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&t.pointerType!=="mouse")return;const e=this.state;if(!e._active)return;e._active=!1;const s=xt(t);e._movement=e._delta=M.sub(s,e._values),this.computeValues(s),this.compute(t),e.delta=e.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}}const Cs=L(L({},ft),{},{mouseOnly:(n=!0)=>n}),re=new Map,ee=new Map;function Ns(n){re.set(n.key,n.engine),ee.set(n.key,n.resolver)}const As={key:"drag",engine:is,resolver:ys},Ms={key:"hover",engine:Is,resolver:Cs},Ds={key:"move",engine:ws,resolver:Ss},Ps={key:"pinch",engine:vs,resolver:_s},Os={key:"scroll",engine:ks,resolver:js},Ls={key:"wheel",engine:Es,resolver:Ts};function Bs(n,t){if(n==null)return{};var e={},s=Object.keys(n),r,i;for(i=0;i<s.length;i++)r=s[i],!(t.indexOf(r)>=0)&&(e[r]=n[r]);return e}function Rs(n,t){if(n==null)return{};var e=Bs(n,t),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(e[s]=n[s])}return e}const zs={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=H.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:t=!1}={}){return{passive:n,capture:t}},transform(n){return n}},Fs=["target","eventOptions","window","enabled","transform"];function Bt(n={},t){const e={};for(const[s,r]of Object.entries(t))switch(typeof r){case"function":e[s]=r.call(e,n[s],s,n);break;case"object":e[s]=Bt(n[s],r);break;case"boolean":r&&(e[s]=n[s]);break}return e}function Vs(n,t,e={}){const s=n,{target:r,eventOptions:i,window:o,enabled:c,transform:u}=s,l=Rs(s,Fs);if(e.shared=Bt({target:r,eventOptions:i,window:o,enabled:c,transform:u},zs),t){const d=ee.get(t);e[t]=Bt(L({shared:e.shared},l),d)}else for(const d in l){const f=ee.get(d);f&&(e[d]=Bt(L({shared:e.shared},l[d]),f))}return e}let nn=class{constructor(t,e){R(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=e}add(t,e,s,r,i){const o=this._listeners,c=Gn(e,s),u=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=L(L({},u),i);t.addEventListener(c,r,l);const d=()=>{t.removeEventListener(c,r,l),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}};class Ks{constructor(){R(this,"_timeouts",new Map)}add(t,e,s=140,...r){this.remove(t),this._timeouts.set(t,window.setTimeout(e,s,...r))}remove(t){const e=this._timeouts.get(t);e&&window.clearTimeout(e)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class Hs{constructor(t){R(this,"gestures",new Set),R(this,"_targetEventStore",new nn(this)),R(this,"gestureEventStores",{}),R(this,"gestureTimeoutStores",{}),R(this,"handlers",{}),R(this,"config",{}),R(this,"pointerIds",new Set),R(this,"touchIds",new Set),R(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),$s(this,t)}setEventIds(t){if(Ht(t))return this.touchIds=new Set(Wn(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,e){this.handlers=t,this.nativeHandlers=e}applyConfig(t,e){this.config=Vs(t,e,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const e=this.config.shared,s={};let r;if(!(e.target&&(r=e.target(),!r))){if(e.enabled){for(const o of this.gestures){const c=this.config[o],u=De(s,c.eventOptions,!!r);if(c.enabled){const l=re.get(o);new l(this,t,o).bind(u)}}const i=De(s,e.eventOptions,!!r);for(const o in this.nativeHandlers)i(o,"",c=>this.nativeHandlers[o](L(L({},this.state.shared),{},{event:c,args:t})),void 0,!0)}for(const i in s)s[i]=ts(...s[i]);if(!r)return s;for(const i in s){const{device:o,capture:c,passive:u}=Un(i);this._targetEventStore.add(r,o,"",s[i],{capture:c,passive:u})}}}}function gt(n,t){n.gestures.add(t),n.gestureEventStores[t]=new nn(n,t),n.gestureTimeoutStores[t]=new Ks}function $s(n,t){t.drag&&gt(n,"drag"),t.wheel&&gt(n,"wheel"),t.scroll&&gt(n,"scroll"),t.move&&gt(n,"move"),t.pinch&&gt(n,"pinch"),t.hover&&gt(n,"hover")}const De=(n,t,e)=>(s,r,i,o={},c=!1)=>{var u,l;const d=(u=o.capture)!==null&&u!==void 0?u:t.capture,f=(l=o.passive)!==null&&l!==void 0?l:t.passive;let h=c?s:$n(s,r,d);e&&f&&(h+="Passive"),n[h]=n[h]||[],n[h].push(i)},Ys=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Us(n){const t={},e={},s=new Set;for(let r in n)Ys.test(r)?(s.add(RegExp.lastMatch),e[r]=n[r]):t[r]=n[r];return[e,t,s]}function yt(n,t,e,s,r,i){if(!n.has(e)||!re.has(s))return;const o=e+"Start",c=e+"End",u=l=>{let d;return l.first&&o in t&&t[o](l),e in t&&(d=t[e](l)),l.last&&c in t&&t[c](l),d};r[s]=u,i[s]=i[s]||{}}function Gs(n,t){const[e,s,r]=Us(n),i={};return yt(r,e,"onDrag","drag",i,t),yt(r,e,"onWheel","wheel",i,t),yt(r,e,"onScroll","scroll",i,t),yt(r,e,"onPinch","pinch",i,t),yt(r,e,"onMove","move",i,t),yt(r,e,"onHover","hover",i,t),{handlers:i,config:t,nativeHandlers:s}}function qs(n,t={},e,s){const r=Wt.useMemo(()=>new Hs(n),[]);if(r.applyHandlers(n,s),r.applyConfig(t,e),Wt.useEffect(r.effect.bind(r)),Wt.useEffect(()=>r.clean.bind(r),[]),t.target===void 0)return r.bind.bind(r)}function Xs(n){return n.forEach(Ns),function(e,s){const{handlers:r,nativeHandlers:i,config:o}=Gs(e,s||{});return qs(r,o,void 0,i)}}function Ws(n,t){return Xs([As,Ps,Os,Ls,Ds,Ms])(n,t||{})}function Zt({children:n,className:t="",minScale:e=1,maxScale:s=3}){const r=N.useRef(null),[i,o]=N.useState(1),[c,u]=N.useState({x:0,y:0}),l=N.useCallback(()=>{o(1),u({x:0,y:0})},[]);return Ws({onPinch:({offset:[d],memo:f})=>{const h=Math.min(s,Math.max(e,d));return o(h),h<=1&&u({x:0,y:0}),f},onDrag:({offset:[d,f],pinching:h})=>{if(i>1&&!h){const y=(i-1)*100/2;u({x:Math.min(y,Math.max(-y,d)),y:Math.min(y,Math.max(-y,f))})}},onWheel:({delta:[,d],event:f})=>{f.preventDefault();const h=Math.min(s,Math.max(e,i-d*.01));o(h),h<=1&&u({x:0,y:0})}},{target:r,pinch:{scaleBounds:{min:e,max:s}},drag:{filterTaps:!0},wheel:{preventDefault:!0}}),a.jsxs("div",{className:`relative overflow-hidden touch-none ${t}`,children:[a.jsx("div",{ref:r,style:{transform:`scale(${i}) translate(${c.x}px, ${c.y}px)`,transformOrigin:"center center",transition:"transform 0.1s ease-out"},className:"w-full h-full",children:n}),i>1&&a.jsxs("button",{onClick:l,className:"absolute bottom-2 right-2 px-2 py-1 text-xs bg-gray-800/70 text-white rounded-md hover:bg-gray-700/70 transition-colors",children:[Math.round(i*100),"% - Tap to reset"]})]})}const Qs={spike:"ðŸ“ˆ",trend:"ðŸ“Š",unusual:"ðŸ”",budget:"ðŸ’°",saving:"âœ¨"},Js={info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"},Zs={info:"text-blue-700 dark:text-blue-300",warning:"text-amber-700 dark:text-amber-300",success:"text-green-700 dark:text-green-300"};function tr({insight:n}){const{currency:t}=Vt(),{data:e}=Kt();return a.jsx("div",{className:`p-4 rounded-lg border ${Js[n.severity]} transition-all hover:shadow-sm`,children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("span",{className:"text-2xl",children:Qs[n.type]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:`font-medium ${Zs[n.severity]}`,children:n.title}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:n.message}),n.amount&&a.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-2",children:$(n.amount,t,(e==null?void 0:e.rates)||{},!1)})]}),n.percentage_change!==void 0&&a.jsxs("span",{className:`text-sm font-medium px-2 py-1 rounded ${n.percentage_change>0?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400":"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"}`,children:[n.percentage_change>0?"+":"",n.percentage_change.toFixed(0),"%"]})]})})}function er(){const{t:n}=tt("common"),{data:t,isLoading:e,error:s}=Lt({queryKey:["spending-insights"],queryFn:Ke,staleTime:5*60*1e3});if(e)return a.jsxs(Z,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.spendingInsights","Spending Insights")}),a.jsx("div",{className:"flex justify-center py-8",children:a.jsx(Rt,{size:"md"})})]});if(s)return a.jsxs(Z,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.spendingInsights","Spending Insights")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:n("error","Failed to load insights")})]});const r=(t==null?void 0:t.insights)||[];return a.jsxs(Z,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.spendingInsights","Spending Insights")}),r.length===0?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("span",{className:"text-4xl mb-3 block",children:"ðŸŽ‰"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:n("analytics.noInsights","No notable spending patterns detected")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:n("analytics.insightsHint","Keep tracking to see personalized insights")})]}):a.jsx("div",{className:"space-y-3",children:r.map((i,o)=>a.jsx(tr,{insight:i},`${i.type}-${i.category}-${o}`))})]})}async function Pe(n=50,t="ja"){return(await He.post("/api/ai/categorize/suggestions",{limit:n,language:t})).data}async function Oe(n){return(await He.post("/api/ai/categorize/apply",n)).data}const Ot=50,nr=.5;function sr({suggestion:n,isSelected:t,onToggle:e}){const{currency:s}=Vt(),{data:r}=Kt(),{t:i}=tt("common"),o=n.confidence>=.8?"text-green-600 dark:text-green-400":n.confidence>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return a.jsxs("div",{className:`p-3 rounded-lg border transition-colors cursor-pointer ${t?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>e(n.transaction_id,n.suggested_category),children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:n.description}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:$(n.amount,s,(r==null?void 0:r.rates)||{},!1)})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[n.is_new_category&&a.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:i("ai.newCategory")}),a.jsx("span",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:n.suggested_category})]}),a.jsxs("p",{className:`text-xs mt-1 ${o}`,children:[Math.round(n.confidence*100),"% ",i("ai.confidence")]})]})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 italic",children:n.reason})]})}function rr(){const{t:n,i18n:t}=tt("common"),e=xn(),[s,r]=N.useState(null),[i,o]=N.useState(new Map),[c,u]=N.useState(!0),[l,d]=N.useState(0),[f,h]=N.useState(null),y=N.useRef(!1),p=ve({mutationFn:()=>Pe(Ot,t.language),onSuccess:v=>{r(v),d(v.total_other_count);const S=new Map;v.suggestions.forEach(k=>{k.confidence>=.7&&S.set(k.transaction_id,k.suggested_category)}),o(S)}}),g=ve({mutationFn:()=>Oe({approved:Array.from(i.entries()).map(([v,S])=>({transaction_id:v,category:S})),create_rules:c}),onSuccess:()=>{e.invalidateQueries({queryKey:["analytics"]}),e.invalidateQueries({queryKey:["transactions"]});const v=l-i.size;v>0?(d(v),r(null),o(new Map),setTimeout(()=>p.mutate(),500)):(r(null),o(new Map),d(0))}}),x=N.useCallback(async()=>{y.current=!1;const v=Math.ceil(l/Ot);let S=0;h({isRunning:!0,processed:0,total:l,currentBatch:0,totalBatches:v});for(let k=0;k<v&&!y.current;k++){h(T=>T?{...T,currentBatch:k+1}:null);try{const T=await Pe(Ot,t.language);if(T.suggestions.length===0||y.current)break;const C=T.suggestions.filter(D=>D.confidence>=.7).map(D=>({transaction_id:D.transaction_id,category:D.suggested_category}));C.length>0&&(await Oe({approved:C,create_rules:c}),S+=C.length),h(D=>D?{...D,processed:S}:null),await new Promise(D=>setTimeout(D,300))}catch{break}}h(null),e.invalidateQueries({queryKey:["analytics"]}),e.invalidateQueries({queryKey:["transactions"]}),r(null),d(0)},[l,t.language,c,e]),m=()=>{y.current=!0,h(null)},b=(v,S)=>{o(k=>{const T=new Map(k);return T.has(v)?T.delete(v):T.set(v,S),T})},_=()=>{if(!s)return;const v=new Map;s.suggestions.forEach(S=>{v.set(S.transaction_id,S.suggested_category)}),o(v)},E=()=>{o(new Map)};if(f!=null&&f.isRunning){const v=f.total>0?Math.round(f.processed/f.total*100):0;return a.jsx(Z,{children:a.jsxs("div",{className:"py-8",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 text-center mb-4",children:n("ai.processingAll")}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2",children:a.jsx("div",{className:"bg-primary-500 h-4 rounded-full transition-all duration-300",style:{width:`${v}%`}})}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-4",children:n("ai.processProgress",{processed:f.processed,total:f.total,batch:f.currentBatch,totalBatches:f.totalBatches})}),a.jsx("div",{className:"text-center",children:a.jsx(J,{variant:"outline",onClick:m,children:n("cancel")})})]})})}if(!s){const v=l,S=v>250,k=Math.ceil(v/Ot)*nr;return a.jsxs(Z,{children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:n("ai.categoryCleanup")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("ai.categoryCleanupDesc")}),v>0&&a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:n("ai.remainingOther",{count:v})})]}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsx(J,{onClick:()=>p.mutate(),disabled:p.isPending,children:p.isPending?a.jsxs(a.Fragment,{children:[a.jsx(Rt,{size:"sm",className:"mr-2"}),n("ai.analyzing")]}):n("ai.analyzeOther")}),S&&a.jsx(J,{variant:"outline",onClick:x,disabled:p.isPending,title:n("ai.analyzeAllCredits",{credits:k.toFixed(1)}),children:n("ai.analyzeAll",{count:v})})]})]}),p.isError&&a.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:n("ai.analyzeError")})]})}if(s.suggestions.length===0)return a.jsx(Z,{children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:n("ai.noSuggestions")}),a.jsx(J,{variant:"outline",onClick:()=>r(null),className:"mt-4",children:n("close")})]})});const I=l-s.suggestions.length,j=I>250;return a.jsxs(Z,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:n("ai.categoryCleanup")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("ai.foundSuggestions",{count:s.suggestions.length,total:l})})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(J,{variant:"outline",size:"sm",onClick:_,children:n("ai.selectAll")}),a.jsx(J,{variant:"outline",size:"sm",onClick:E,children:n("ai.deselectAll")})]})]}),s.new_categories_suggested.length>0&&a.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[n("ai.newCategoriesSuggested"),": ",s.new_categories_suggested.join(", ")]})}),a.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.suggestions.map(v=>a.jsx(sr,{suggestion:v,isSelected:i.has(v.transaction_id),onToggle:b},v.transaction_id))}),a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[a.jsx("input",{type:"checkbox",checked:c,onChange:v=>u(v.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),n("ai.createRulesAuto")]}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsx(J,{variant:"outline",onClick:()=>r(null),children:n("cancel")}),j&&a.jsx(J,{variant:"outline",onClick:x,disabled:g.isPending,children:n("ai.analyzeAll",{count:I})}),a.jsx(J,{onClick:()=>g.mutate(),disabled:i.size===0||g.isPending,children:g.isPending?a.jsxs(a.Fragment,{children:[a.jsx(Rt,{size:"sm",className:"mr-2"}),n("ai.applying")]}):n("ai.applySelected",{count:i.size})})]})]}),g.isError&&a.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:n("ai.applyError")})]})]})}function ir({analytics:n,displayCurrency:t="JPY"}){const{t:e}=tt("common"),{total_income:s,total_expense:r,net_cashflow:i,comparison:o,top_category:c}=n,u=()=>o!=null&&o.income_change?o.income_change>0?"positive":"negative":"neutral",l=()=>o!=null&&o.expense_change?o.expense_change<0?"positive":"negative":"neutral",d=()=>o!=null&&o.net_change?o.net_change>0?"positive":"negative":"neutral";return a.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[a.jsx(Pt,{label:e("analytics.heroIncome"),value:$(s,t),change:o==null?void 0:o.income_change,trend:u()}),a.jsx(Pt,{label:e("analytics.heroExpense"),value:$(r,t),change:o==null?void 0:o.expense_change,trend:l()}),a.jsx(Pt,{label:e("analytics.heroNet"),value:$(i,t),change:o==null?void 0:o.net_change,trend:d()}),a.jsx(Pt,{label:e("analytics.heroTopCategory"),value:(c==null?void 0:c.name)||"-",subtitle:c?`${$(c.amount,t)} (${c.percentage}%)`:void 0})]})}function or(n){return Object.prototype.toString.call(n)==="[object Object]"}function Le(n){return or(n)||Array.isArray(n)}function ar(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function ie(n,t){const e=Object.keys(n),s=Object.keys(t);if(e.length!==s.length)return!1;const r=JSON.stringify(Object.keys(n.breakpoints||{})),i=JSON.stringify(Object.keys(t.breakpoints||{}));return r!==i?!1:e.every(o=>{const c=n[o],u=t[o];return typeof c=="function"?`${c}`==`${u}`:!Le(c)||!Le(u)?c===u:ie(c,u)})}function Be(n){return n.concat().sort((t,e)=>t.name>e.name?1:-1).map(t=>t.options)}function cr(n,t){if(n.length!==t.length)return!1;const e=Be(n),s=Be(t);return e.every((r,i)=>{const o=s[i];return ie(r,o)})}function oe(n){return typeof n=="number"}function ne(n){return typeof n=="string"}function $t(n){return typeof n=="boolean"}function Re(n){return Object.prototype.toString.call(n)==="[object Object]"}function O(n){return Math.abs(n)}function ae(n){return Math.sign(n)}function jt(n,t){return O(n-t)}function lr(n,t){if(n===0||t===0||O(n)<=O(t))return 0;const e=jt(O(n),O(t));return O(e/n)}function ur(n){return Math.round(n*100)/100}function Et(n){return Tt(n).map(Number)}function U(n){return n[At(n)]}function At(n){return Math.max(0,n.length-1)}function ce(n,t){return t===At(n)}function ze(n,t=0){return Array.from(Array(n),(e,s)=>t+s)}function Tt(n){return Object.keys(n)}function sn(n,t){return[n,t].reduce((e,s)=>(Tt(s).forEach(r=>{const i=e[r],o=s[r],c=Re(i)&&Re(o);e[r]=c?sn(i,o):o}),e),{})}function se(n,t){return typeof t.MouseEvent<"u"&&n instanceof t.MouseEvent}function dr(n,t){const e={start:s,center:r,end:i};function s(){return 0}function r(u){return i(u)/2}function i(u){return t-u}function o(u,l){return ne(n)?e[n](u):n(t,u,l)}return{measure:o}}function It(){let n=[];function t(r,i,o,c={passive:!0}){let u;if("addEventListener"in r)r.addEventListener(i,o,c),u=()=>r.removeEventListener(i,o,c);else{const l=r;l.addListener(o),u=()=>l.removeListener(o)}return n.push(u),s}function e(){n=n.filter(r=>r())}const s={add:t,clear:e};return s}function fr(n,t,e,s){const r=It(),i=1e3/60;let o=null,c=0,u=0;function l(){r.add(n,"visibilitychange",()=>{n.hidden&&p()})}function d(){y(),r.clear()}function f(x){if(!u)return;o||(o=x,e(),e());const m=x-o;for(o=x,c+=m;c>=i;)e(),c-=i;const b=c/i;s(b),u&&(u=t.requestAnimationFrame(f))}function h(){u||(u=t.requestAnimationFrame(f))}function y(){t.cancelAnimationFrame(u),o=null,c=0,u=0}function p(){o=null,c=0}return{init:l,destroy:d,start:h,stop:y,update:e,render:s}}function hr(n,t){const e=t==="rtl",s=n==="y",r=s?"y":"x",i=s?"x":"y",o=!s&&e?-1:1,c=d(),u=f();function l(p){const{height:g,width:x}=p;return s?g:x}function d(){return s?"top":e?"right":"left"}function f(){return s?"bottom":e?"left":"right"}function h(p){return p*o}return{scroll:r,cross:i,startEdge:c,endEdge:u,measureSize:l,direction:h}}function dt(n=0,t=0){const e=O(n-t);function s(l){return l<n}function r(l){return l>t}function i(l){return s(l)||r(l)}function o(l){return i(l)?s(l)?n:t:l}function c(l){return e?l-e*Math.ceil((l-t)/e):l}return{length:e,max:t,min:n,constrain:o,reachedAny:i,reachedMax:r,reachedMin:s,removeOffset:c}}function rn(n,t,e){const{constrain:s}=dt(0,n),r=n+1;let i=o(t);function o(h){return e?O((r+h)%r):s(h)}function c(){return i}function u(h){return i=o(h),f}function l(h){return d().set(c()+h)}function d(){return rn(n,c(),e)}const f={get:c,set:u,add:l,clone:d};return f}function mr(n,t,e,s,r,i,o,c,u,l,d,f,h,y,p,g,x,m,b){const{cross:_,direction:E}=n,I=["INPUT","SELECT","TEXTAREA"],j={passive:!1},v=It(),S=It(),k=dt(50,225).constrain(y.measure(20)),T={mouse:300,touch:400},C={mouse:500,touch:600},D=p?43:25;let G=!1,q=0,X=0,ct=!1,ot=!1,et=!1,nt=!1;function bt(w){if(!b)return;function A(F){($t(b)||b(w,F))&&_t(F)}const B=t;v.add(B,"dragstart",F=>F.preventDefault(),j).add(B,"touchmove",()=>{},j).add(B,"touchend",()=>{}).add(B,"touchstart",A).add(B,"mousedown",A).add(B,"touchcancel",z).add(B,"contextmenu",z).add(B,"click",rt,!0)}function W(){v.clear(),S.clear()}function ht(){const w=nt?e:t;S.add(w,"touchmove",V,j).add(w,"touchend",z).add(w,"mousemove",V,j).add(w,"mouseup",z)}function mt(w){const A=w.nodeName||"";return I.includes(A)}function st(){return(p?C:T)[nt?"mouse":"touch"]}function vt(w,A){const B=f.add(ae(w)*-1),F=d.byDistance(w,!p).distance;return p||O(w)<k?F:x&&A?F*.5:d.byIndex(B.get(),0).distance}function _t(w){const A=se(w,s);nt=A,et=p&&A&&!w.buttons&&G,G=jt(r.get(),o.get())>=2,!(A&&w.button!==0)&&(mt(w.target)||(ct=!0,i.pointerDown(w),l.useFriction(0).useDuration(0),r.set(o),ht(),q=i.readPoint(w),X=i.readPoint(w,_),h.emit("pointerDown")))}function V(w){if(!se(w,s)&&w.touches.length>=2)return z(w);const B=i.readPoint(w),F=i.readPoint(w,_),Q=jt(B,q),it=jt(F,X);if(!ot&&!nt&&(!w.cancelable||(ot=Q>it,!ot)))return z(w);const lt=i.pointerMove(w);Q>g&&(et=!0),l.useFriction(.3).useDuration(.75),c.start(),r.add(E(lt)),w.preventDefault()}function z(w){const B=d.byDistance(0,!1).index!==f.get(),F=i.pointerUp(w)*st(),Q=vt(E(F),B),it=lr(F,Q),lt=D-10*it,at=m+it/50;ot=!1,ct=!1,S.clear(),l.useDuration(lt).useFriction(at),u.distance(Q,!p),nt=!1,h.emit("pointerUp")}function rt(w){et&&(w.stopPropagation(),w.preventDefault(),et=!1)}function K(){return ct}return{init:bt,destroy:W,pointerDown:K}}function pr(n,t){let s,r;function i(f){return f.timeStamp}function o(f,h){const p=`client${(h||n.scroll)==="x"?"X":"Y"}`;return(se(f,t)?f:f.touches[0])[p]}function c(f){return s=f,r=f,o(f)}function u(f){const h=o(f)-o(r),y=i(f)-i(s)>170;return r=f,y&&(s=f),h}function l(f){if(!s||!r)return 0;const h=o(r)-o(s),y=i(f)-i(s),p=i(f)-i(r)>170,g=h/y;return y&&!p&&O(g)>.1?g:0}return{pointerDown:c,pointerMove:u,pointerUp:l,readPoint:o}}function gr(){function n(e){const{offsetTop:s,offsetLeft:r,offsetWidth:i,offsetHeight:o}=e;return{top:s,right:r+i,bottom:s+o,left:r,width:i,height:o}}return{measure:n}}function yr(n){function t(s){return n*(s/100)}return{measure:t}}function xr(n,t,e,s,r,i,o){const c=[n].concat(s);let u,l,d=[],f=!1;function h(x){return r.measureSize(o.measure(x))}function y(x){if(!i)return;l=h(n),d=s.map(h);function m(b){for(const _ of b){if(f)return;const E=_.target===n,I=s.indexOf(_.target),j=E?l:d[I],v=h(E?n:s[I]);if(O(v-j)>=.5){x.reInit(),t.emit("resize");break}}}u=new ResizeObserver(b=>{($t(i)||i(x,b))&&m(b)}),e.requestAnimationFrame(()=>{c.forEach(b=>u.observe(b))})}function p(){f=!0,u&&u.disconnect()}return{init:y,destroy:p}}function br(n,t,e,s,r,i){let o=0,c=0,u=r,l=i,d=n.get(),f=0;function h(){const j=s.get()-n.get(),v=!u;let S=0;return v?(o=0,e.set(s),n.set(s),S=j):(e.set(n),o+=j/u,o*=l,d+=o,n.add(o),S=d-f),c=ae(S),f=d,I}function y(){const j=s.get()-t.get();return O(j)<.001}function p(){return u}function g(){return c}function x(){return o}function m(){return _(r)}function b(){return E(i)}function _(j){return u=j,I}function E(j){return l=j,I}const I={direction:g,duration:p,velocity:x,seek:h,settled:y,useBaseFriction:b,useBaseDuration:m,useFriction:E,useDuration:_};return I}function vr(n,t,e,s,r){const i=r.measure(10),o=r.measure(50),c=dt(.1,.99);let u=!1;function l(){return!(u||!n.reachedAny(e.get())||!n.reachedAny(t.get()))}function d(y){if(!l())return;const p=n.reachedMin(t.get())?"min":"max",g=O(n[p]-t.get()),x=e.get()-t.get(),m=c.constrain(g/o);e.subtract(x*m),!y&&O(x)<i&&(e.set(n.constrain(e.get())),s.useDuration(25).useBaseFriction())}function f(y){u=!y}return{shouldConstrain:l,constrain:d,toggleActive:f}}function _r(n,t,e,s,r){const i=dt(-t+n,0),o=f(),c=d(),u=h();function l(p,g){return jt(p,g)<=1}function d(){const p=o[0],g=U(o),x=o.lastIndexOf(p),m=o.indexOf(g)+1;return dt(x,m)}function f(){return e.map((p,g)=>{const{min:x,max:m}=i,b=i.constrain(p),_=!g,E=ce(e,g);return _?m:E||l(x,b)?x:l(m,b)?m:b}).map(p=>parseFloat(p.toFixed(3)))}function h(){if(t<=n+r)return[i.max];if(s==="keepSnaps")return o;const{min:p,max:g}=c;return o.slice(p,g)}return{snapsContained:u,scrollContainLimit:c}}function wr(n,t,e){const s=t[0],r=e?s-n:U(t);return{limit:dt(r,s)}}function Sr(n,t,e,s){const i=t.min+.1,o=t.max+.1,{reachedMin:c,reachedMax:u}=dt(i,o);function l(h){return h===1?u(e.get()):h===-1?c(e.get()):!1}function d(h){if(!l(h))return;const y=n*(h*-1);s.forEach(p=>p.add(y))}return{loop:d}}function kr(n){const{max:t,length:e}=n;function s(i){const o=i-t;return e?o/-e:0}return{get:s}}function jr(n,t,e,s,r){const{startEdge:i,endEdge:o}=n,{groupSlides:c}=r,u=f().map(t.measure),l=h(),d=y();function f(){return c(s).map(g=>U(g)[o]-g[0][i]).map(O)}function h(){return s.map(g=>e[i]-g[i]).map(g=>-O(g))}function y(){return c(l).map(g=>g[0]).map((g,x)=>g+u[x])}return{snaps:l,snapsAligned:d}}function Er(n,t,e,s,r,i){const{groupSlides:o}=r,{min:c,max:u}=s,l=d();function d(){const h=o(i),y=!n||t==="keepSnaps";return e.length===1?[i]:y?h:h.slice(c,u).map((p,g,x)=>{const m=!g,b=ce(x,g);if(m){const _=U(x[0])+1;return ze(_)}if(b){const _=At(i)-U(x)[0]+1;return ze(_,U(x)[0])}return p})}return{slideRegistry:l}}function Tr(n,t,e,s,r){const{reachedAny:i,removeOffset:o,constrain:c}=s;function u(p){return p.concat().sort((g,x)=>O(g)-O(x))[0]}function l(p){const g=n?o(p):c(p),x=t.map((b,_)=>({diff:d(b-g,0),index:_})).sort((b,_)=>O(b.diff)-O(_.diff)),{index:m}=x[0];return{index:m,distance:g}}function d(p,g){const x=[p,p+e,p-e];if(!n)return p;if(!g)return u(x);const m=x.filter(b=>ae(b)===g);return m.length?u(m):U(x)-e}function f(p,g){const x=t[p]-r.get(),m=d(x,g);return{index:p,distance:m}}function h(p,g){const x=r.get()+p,{index:m,distance:b}=l(x),_=!n&&i(x);if(!g||_)return{index:m,distance:p};const E=t[m]-b,I=p+d(E,0);return{index:m,distance:I}}return{byDistance:h,byIndex:f,shortcut:d}}function Ir(n,t,e,s,r,i,o){function c(f){const h=f.distance,y=f.index!==t.get();i.add(h),h&&(s.duration()?n.start():(n.update(),n.render(1),n.update())),y&&(e.set(t.get()),t.set(f.index),o.emit("select"))}function u(f,h){const y=r.byDistance(f,h);c(y)}function l(f,h){const y=t.clone().set(f),p=r.byIndex(y.get(),h);c(p)}return{distance:u,index:l}}function Cr(n,t,e,s,r,i,o,c){const u={passive:!0,capture:!0};let l=0;function d(y){if(!c)return;function p(g){if(new Date().getTime()-l>10)return;o.emit("slideFocusStart"),n.scrollLeft=0;const b=e.findIndex(_=>_.includes(g));oe(b)&&(r.useDuration(0),s.index(b,0),o.emit("slideFocus"))}i.add(document,"keydown",f,!1),t.forEach((g,x)=>{i.add(g,"focus",m=>{($t(c)||c(y,m))&&p(x)},u)})}function f(y){y.code==="Tab"&&(l=new Date().getTime())}return{init:d}}function kt(n){let t=n;function e(){return t}function s(u){t=o(u)}function r(u){t+=o(u)}function i(u){t-=o(u)}function o(u){return oe(u)?u:u.get()}return{get:e,set:s,add:r,subtract:i}}function on(n,t){const e=n.scroll==="x"?o:c,s=t.style;let r=null,i=!1;function o(h){return`translate3d(${h}px,0px,0px)`}function c(h){return`translate3d(0px,${h}px,0px)`}function u(h){if(i)return;const y=ur(n.direction(h));y!==r&&(s.transform=e(y),r=y)}function l(h){i=!h}function d(){i||(s.transform="",t.getAttribute("style")||t.removeAttribute("style"))}return{clear:d,to:u,toggleActive:l}}function Nr(n,t,e,s,r,i,o,c,u){const d=Et(r),f=Et(r).reverse(),h=m().concat(b());function y(v,S){return v.reduce((k,T)=>k-r[T],S)}function p(v,S){return v.reduce((k,T)=>y(k,S)>0?k.concat([T]):k,[])}function g(v){return i.map((S,k)=>({start:S-s[k]+.5+v,end:S+t-.5+v}))}function x(v,S,k){const T=g(S);return v.map(C=>{const D=k?0:-e,G=k?e:0,q=k?"end":"start",X=T[C][q];return{index:C,loopPoint:X,slideLocation:kt(-1),translate:on(n,u[C]),target:()=>c.get()>X?D:G}})}function m(){const v=o[0],S=p(f,v);return x(S,e,!1)}function b(){const v=t-o[0]-1,S=p(d,v);return x(S,-e,!0)}function _(){return h.every(({index:v})=>{const S=d.filter(k=>k!==v);return y(S,t)<=.1})}function E(){h.forEach(v=>{const{target:S,translate:k,slideLocation:T}=v,C=S();C!==T.get()&&(k.to(C),T.set(C))})}function I(){h.forEach(v=>v.translate.clear())}return{canLoop:_,clear:I,loop:E,loopPoints:h}}function Ar(n,t,e){let s,r=!1;function i(u){if(!e)return;function l(d){for(const f of d)if(f.type==="childList"){u.reInit(),t.emit("slidesChanged");break}}s=new MutationObserver(d=>{r||($t(e)||e(u,d))&&l(d)}),s.observe(n,{childList:!0})}function o(){s&&s.disconnect(),r=!0}return{init:i,destroy:o}}function Mr(n,t,e,s){const r={};let i=null,o=null,c,u=!1;function l(){c=new IntersectionObserver(p=>{u||(p.forEach(g=>{const x=t.indexOf(g.target);r[x]=g}),i=null,o=null,e.emit("slidesInView"))},{root:n.parentElement,threshold:s}),t.forEach(p=>c.observe(p))}function d(){c&&c.disconnect(),u=!0}function f(p){return Tt(r).reduce((g,x)=>{const m=parseInt(x),{isIntersecting:b}=r[m];return(p&&b||!p&&!b)&&g.push(m),g},[])}function h(p=!0){if(p&&i)return i;if(!p&&o)return o;const g=f(p);return p&&(i=g),p||(o=g),g}return{init:l,destroy:d,get:h}}function Dr(n,t,e,s,r,i){const{measureSize:o,startEdge:c,endEdge:u}=n,l=e[0]&&r,d=p(),f=g(),h=e.map(o),y=x();function p(){if(!l)return 0;const b=e[0];return O(t[c]-b[c])}function g(){if(!l)return 0;const b=i.getComputedStyle(U(s));return parseFloat(b.getPropertyValue(`margin-${u}`))}function x(){return e.map((b,_,E)=>{const I=!_,j=ce(E,_);return I?h[_]+d:j?h[_]+f:E[_+1][c]-b[c]}).map(O)}return{slideSizes:h,slideSizesWithGaps:y,startGap:d,endGap:f}}function Pr(n,t,e,s,r,i,o,c,u){const{startEdge:l,endEdge:d,direction:f}=n,h=oe(e);function y(m,b){return Et(m).filter(_=>_%b===0).map(_=>m.slice(_,_+b))}function p(m){return m.length?Et(m).reduce((b,_,E)=>{const I=U(b)||0,j=I===0,v=_===At(m),S=r[l]-i[I][l],k=r[l]-i[_][d],T=!s&&j?f(o):0,C=!s&&v?f(c):0,D=O(k-C-(S+T));return E&&D>t+u&&b.push(_),v&&b.push(m.length),b},[]).map((b,_,E)=>{const I=Math.max(E[_-1]||0);return m.slice(I,b)}):[]}function g(m){return h?y(m,e):p(m)}return{groupSlides:g}}function Or(n,t,e,s,r,i,o){const{align:c,axis:u,direction:l,startIndex:d,loop:f,duration:h,dragFree:y,dragThreshold:p,inViewThreshold:g,slidesToScroll:x,skipSnaps:m,containScroll:b,watchResize:_,watchSlides:E,watchDrag:I,watchFocus:j}=i,v=2,S=gr(),k=S.measure(t),T=e.map(S.measure),C=hr(u,l),D=C.measureSize(k),G=yr(D),q=dr(c,D),X=!f&&!!b,ct=f||!!b,{slideSizes:ot,slideSizesWithGaps:et,startGap:nt,endGap:bt}=Dr(C,k,T,e,ct,r),W=Pr(C,D,x,f,k,T,nt,bt,v),{snaps:ht,snapsAligned:mt}=jr(C,q,k,T,W),st=-U(ht)+U(et),{snapsContained:vt,scrollContainLimit:_t}=_r(D,st,mt,b,v),V=X?vt:mt,{limit:z}=wr(st,V,f),rt=rn(At(V),d,f),K=rt.clone(),P=Et(e),w=({dragHandler:pt,scrollBody:qt,scrollBounds:Xt,options:{loop:Mt}})=>{Mt||Xt.constrain(pt.pointerDown()),qt.seek()},A=({scrollBody:pt,translate:qt,location:Xt,offsetLocation:Mt,previousLocation:ln,scrollLooper:un,slideLooper:dn,dragHandler:fn,animation:hn,eventHandler:he,scrollBounds:mn,options:{loop:me}},pe)=>{const ge=pt.settled(),pn=!mn.shouldConstrain(),ye=me?ge:ge&&pn,xe=ye&&!fn.pointerDown();xe&&hn.stop();const gn=Xt.get()*pe+ln.get()*(1-pe);Mt.set(gn),me&&(un.loop(pt.direction()),dn.loop()),qt.to(Mt.get()),xe&&he.emit("settle"),ye||he.emit("scroll")},B=fr(s,r,()=>w(Gt),pt=>A(Gt,pt)),F=.68,Q=V[rt.get()],it=kt(Q),lt=kt(Q),at=kt(Q),ut=kt(Q),wt=br(it,at,lt,ut,h,F),Yt=Tr(f,V,st,z,ut),Ut=Ir(B,rt,K,wt,Yt,ut,o),ue=kr(z),de=It(),an=Mr(t,e,o,g),{slideRegistry:fe}=Er(X,b,V,_t,W,P),cn=Cr(n,e,fe,Ut,wt,de,o,j),Gt={ownerDocument:s,ownerWindow:r,eventHandler:o,containerRect:k,slideRects:T,animation:B,axis:C,dragHandler:mr(C,n,s,r,ut,pr(C,r),it,B,Ut,wt,Yt,rt,o,G,y,p,m,F,I),eventStore:de,percentOfView:G,index:rt,indexPrevious:K,limit:z,location:it,offsetLocation:at,previousLocation:lt,options:i,resizeHandler:xr(t,o,r,e,C,_,S),scrollBody:wt,scrollBounds:vr(z,at,ut,wt,G),scrollLooper:Sr(st,z,at,[it,at,lt,ut]),scrollProgress:ue,scrollSnapList:V.map(ue.get),scrollSnaps:V,scrollTarget:Yt,scrollTo:Ut,slideLooper:Nr(C,D,st,ot,et,ht,V,at,e),slideFocus:cn,slidesHandler:Ar(t,o,E),slidesInView:an,slideIndexes:P,slideRegistry:fe,slidesToScroll:W,target:ut,translate:on(C,t)};return Gt}function Lr(){let n={},t;function e(l){t=l}function s(l){return n[l]||[]}function r(l){return s(l).forEach(d=>d(t,l)),u}function i(l,d){return n[l]=s(l).concat([d]),u}function o(l,d){return n[l]=s(l).filter(f=>f!==d),u}function c(){n={}}const u={init:e,emit:r,off:o,on:i,clear:c};return u}const Br={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Rr(n){function t(i,o){return sn(i,o||{})}function e(i){const o=i.breakpoints||{},c=Tt(o).filter(u=>n.matchMedia(u).matches).map(u=>o[u]).reduce((u,l)=>t(u,l),{});return t(i,c)}function s(i){return i.map(o=>Tt(o.breakpoints||{})).reduce((o,c)=>o.concat(c),[]).map(n.matchMedia)}return{mergeOptions:t,optionsAtMedia:e,optionsMediaQueries:s}}function zr(n){let t=[];function e(i,o){return t=o.filter(({options:c})=>n.optionsAtMedia(c).active!==!1),t.forEach(c=>c.init(i,n)),o.reduce((c,u)=>Object.assign(c,{[u.name]:u}),{})}function s(){t=t.filter(i=>i.destroy())}return{init:e,destroy:s}}function Ft(n,t,e){const s=n.ownerDocument,r=s.defaultView,i=Rr(r),o=zr(i),c=It(),u=Lr(),{mergeOptions:l,optionsAtMedia:d,optionsMediaQueries:f}=i,{on:h,off:y,emit:p}=u,g=C;let x=!1,m,b=l(Br,Ft.globalOptions),_=l(b),E=[],I,j,v;function S(){const{container:P,slides:w}=_;j=(ne(P)?n.querySelector(P):P)||n.children[0];const B=ne(w)?j.querySelectorAll(w):w;v=[].slice.call(B||j.children)}function k(P){const w=Or(n,j,v,s,r,P,u);if(P.loop&&!w.slideLooper.canLoop()){const A=Object.assign({},P,{loop:!1});return k(A)}return w}function T(P,w){x||(b=l(b,P),_=d(b),E=w||E,S(),m=k(_),f([b,...E.map(({options:A})=>A)]).forEach(A=>c.add(A,"change",C)),_.active&&(m.translate.to(m.location.get()),m.animation.init(),m.slidesInView.init(),m.slideFocus.init(K),m.eventHandler.init(K),m.resizeHandler.init(K),m.slidesHandler.init(K),m.options.loop&&m.slideLooper.loop(),j.offsetParent&&v.length&&m.dragHandler.init(K),I=o.init(K,E)))}function C(P,w){const A=W();D(),T(l({startIndex:A},P),w),u.emit("reInit")}function D(){m.dragHandler.destroy(),m.eventStore.clear(),m.translate.clear(),m.slideLooper.clear(),m.resizeHandler.destroy(),m.slidesHandler.destroy(),m.slidesInView.destroy(),m.animation.destroy(),o.destroy(),c.clear()}function G(){x||(x=!0,c.clear(),D(),u.emit("destroy"),u.clear())}function q(P,w,A){!_.active||x||(m.scrollBody.useBaseFriction().useDuration(w===!0?0:_.duration),m.scrollTo.index(P,A||0))}function X(P){const w=m.index.add(1).get();q(w,P,-1)}function ct(P){const w=m.index.add(-1).get();q(w,P,1)}function ot(){return m.index.add(1).get()!==W()}function et(){return m.index.add(-1).get()!==W()}function nt(){return m.scrollSnapList}function bt(){return m.scrollProgress.get(m.offsetLocation.get())}function W(){return m.index.get()}function ht(){return m.indexPrevious.get()}function mt(){return m.slidesInView.get()}function st(){return m.slidesInView.get(!1)}function vt(){return I}function _t(){return m}function V(){return n}function z(){return j}function rt(){return v}const K={canScrollNext:ot,canScrollPrev:et,containerNode:z,internalEngine:_t,destroy:G,off:y,on:h,emit:p,plugins:vt,previousScrollSnap:ht,reInit:g,rootNode:V,scrollNext:X,scrollPrev:ct,scrollProgress:bt,scrollSnapList:nt,scrollTo:q,selectedScrollSnap:W,slideNodes:rt,slidesInView:mt,slidesNotInView:st};return T(t,e),setTimeout(()=>u.emit("init"),0),K}Ft.globalOptions=void 0;function le(n={},t=[]){const e=N.useRef(n),s=N.useRef(t),[r,i]=N.useState(),[o,c]=N.useState(),u=N.useCallback(()=>{r&&r.reInit(e.current,s.current)},[r]);return N.useEffect(()=>{ie(e.current,n)||(e.current=n,u())},[n,u]),N.useEffect(()=>{cr(s.current,t)||(s.current=t,u())},[t,u]),N.useEffect(()=>{if(ar()&&o){Ft.globalOptions=le.globalOptions;const l=Ft(o,e.current,s.current);return i(l),()=>l.destroy()}else i(void 0)},[o,i]),[c,r]}le.globalOptions=void 0;const Fr={spike:"âš ï¸",trend:"ðŸ“ˆ",unusual:"ðŸ“Š",budget:"ðŸ’°",saving:"ðŸŽ‰"},Fe={warning:"border-l-amber-500 bg-amber-50 dark:bg-amber-900/20",success:"border-l-green-500 bg-green-50 dark:bg-green-900/20",info:"border-l-blue-500 bg-blue-50 dark:bg-blue-900/20"};function Vr({insight:n,displayCurrency:t="JPY",onScrollToChart:e}){const{t:s}=tt("common"),r=bn(),i=()=>{n.category?r({to:"/transactions",search:{categories:n.category}}):(n.type==="trend"||n.type==="unusual")&&(e==null||e())},o=()=>n.category?s("analytics.viewTransactions",{category:n.category}):n.type==="trend"||n.type==="unusual"?s("analytics.viewBreakdown"):s("analytics.learnMore");return a.jsx("div",{className:Y("rounded-xl p-4 border-l-4 min-w-0","bg-white dark:bg-gray-800","shadow-sm",Fe[n.severity]||Fe.info),children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("span",{className:"text-2xl flex-shrink-0",children:Fr[n.type]||"ðŸ’¡"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:n.title}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:n.message}),n.amount&&a.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-1",children:[$(n.amount,t),n.percentage_change&&a.jsxs("span",{className:Y("ml-2",n.percentage_change>0?"text-red-600":"text-green-600"),children:[n.percentage_change>0?"+":"",n.percentage_change,"%"]})]}),a.jsxs(J,{variant:"ghost",className:"mt-2 p-0 h-auto text-sm text-primary-600 hover:text-primary-700",onClick:i,children:[o()," â†’"]})]})]})})}function Kr({insights:n,displayCurrency:t="JPY",onScrollToChart:e}){const{t:s}=tt("common"),[r,i]=N.useState(0),[o,c]=le({loop:!1,align:"start",containScroll:"trimSnaps"}),u=N.useCallback(()=>{c&&i(c.selectedScrollSnap())},[c]);return N.useEffect(()=>{if(c)return u(),c.on("select",u),()=>{c.off("select",u)}},[c,u]),!n||n.length===0?null:a.jsxs("div",{className:"relative",children:[n.length>1&&a.jsx("p",{className:"text-xs text-gray-400 text-center mb-2",children:s("analytics.swipeHint")}),a.jsx("div",{className:"overflow-hidden",ref:o,children:a.jsx("div",{className:"flex gap-3",children:n.map((l,d)=>a.jsx("div",{className:"flex-shrink-0 w-full min-w-0",children:a.jsx(Vr,{insight:l,displayCurrency:t,onScrollToChart:e})},`${l.type}-${l.category||d}`))})}),n.length>1&&a.jsx("div",{className:"flex justify-center gap-1.5 mt-3",children:n.map((l,d)=>a.jsx("button",{"aria-label":`Go to insight ${d+1}`,className:Y("w-2 h-2 rounded-full transition-all",d===r?"bg-primary-600 w-4":"bg-gray-300 dark:bg-gray-600"),onClick:()=>c==null?void 0:c.scrollTo(d)},d))})]})}const Hr=[{value:"current-month",labelKey:"analytics.currentMonth"},{value:"3-months",labelKey:"analytics.3months"},{value:"6-months",labelKey:"analytics.6months"},{value:"1-year",labelKey:"analytics.1year"}];function $r({selected:n,onChange:t,className:e}){const{t:s}=tt("common");return a.jsx("div",{className:Y("inline-flex rounded-lg bg-gray-100 dark:bg-gray-800 p-1",e),children:Hr.map(({value:r,labelKey:i})=>a.jsx("button",{onClick:()=>t(r),className:Y("px-3 py-1.5 text-sm font-medium rounded-md transition-all",r===n?"bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:s(i)},r))})}function Yr(n,t){const e=vn(t),s=St(e>new Date?new Date:e,"yyyy-MM-dd");switch(n){case"current-month":return{start:St(Dt(t),"yyyy-MM-dd"),end:s};case"3-months":return{start:St(Qt(Dt(t),2),"yyyy-MM-dd"),end:s};case"6-months":return{start:St(Qt(Dt(t),5),"yyyy-MM-dd"),end:s};case"1-year":return{start:St(Qt(Dt(t),11),"yyyy-MM-dd"),end:s};default:return _n()}}function Ur(){const{t:n}=tt("common"),t=N.useRef(null),[e,s]=N.useState(new Date),[r,i]=N.useState("current-month"),[o,c]=N.useState(!1),u=Yr(r,e),{data:l,isLoading:d}=Lt({queryKey:["analytics",u],queryFn:()=>wn(u)}),{data:f}=Lt({queryKey:["insights"],queryFn:Ke}),{data:h}=Lt({queryKey:["goals"],queryFn:Sn}),y=h&&h.length>0?Math.round(h[0].target_amount/(h[0].years*12)):null,p=m=>{i(m)},g=m=>{s(m)},x=N.useCallback(()=>{var m;(m=t.current)==null||m.scrollIntoView({behavior:"smooth"})},[]);return a.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100",children:n("analytics.title")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:n("analytics.subtitle")})]}),a.jsxs("div",{className:"mb-6 space-y-3",children:[a.jsx(En,{selectedMonth:e,onChange:g,className:"justify-center"}),a.jsx("div",{className:"flex justify-center",children:a.jsx($r,{selected:r,onChange:p})})]}),d?a.jsx("div",{className:"flex justify-center py-12",children:a.jsx(Rt,{size:"lg"})}):a.jsxs("div",{className:"space-y-6",children:[l&&a.jsx(ir,{analytics:l}),(f==null?void 0:f.insights)&&f.insights.length>0&&a.jsx(Kr,{insights:f.insights,onScrollToChart:x}),a.jsxs("div",{ref:t,className:"space-y-6",children:[a.jsxs(Z,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.incomeVsExpense")}),a.jsx(Zt,{className:"h-64 sm:h-80",children:l!=null&&l.monthly_trends&&l.monthly_trends.length>0?a.jsx(Tn,{data:l.monthly_trends}):a.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("analytics.noData")})})]}),a.jsxs(Z,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.categoryBreakdown")}),a.jsx(Zt,{className:"h-64 sm:h-80",children:l!=null&&l.category_breakdown&&l.category_breakdown.length>0?a.jsx(In,{data:l.category_breakdown}):a.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("analytics.noData")})})]}),a.jsxs(Z,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("analytics.monthlyCashFlow")}),a.jsx("div",{className:"h-64 sm:h-80",children:l!=null&&l.monthly_trends&&l.monthly_trends.length>0?l.monthly_trends.length<3?a.jsx(Bn,{data:l.monthly_trends,savingsGoal:y}):a.jsx(Zt,{className:"h-full",children:a.jsx(Ln,{data:l.monthly_trends,dataKey:"net"})}):a.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("analytics.noData")})})]})]}),a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[a.jsxs("button",{onClick:()=>c(!o),className:Y("w-full px-4 py-3 flex items-center justify-between","bg-gray-50 dark:bg-gray-800","text-left font-medium text-gray-900 dark:text-gray-100"),children:[a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{children:"ðŸ¤–"}),n("analytics.aiTools")]}),a.jsx("span",{className:Y("transform transition-transform",o?"rotate-180":""),children:"â–¼"})]}),o&&a.jsxs("div",{className:"p-4 space-y-4 bg-white dark:bg-gray-900",children:[a.jsx(rr,{}),a.jsx(er,{})]})]})]})]})}const ti=kn("/analytics")({component:Ur});export{ti as Route};
