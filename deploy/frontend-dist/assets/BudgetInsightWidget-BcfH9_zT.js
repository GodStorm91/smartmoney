import{k as $,G as o,u as S,r as v,j as t,aN as T,l as y,P as _,I as B,B as P,$ as E,K as q,M as F,A as L,a8 as R}from"./index-LxrS-5__.js";import{d as A,e as D}from"./useCategories-BaBBmXS0.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],K=$("external-link",J);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],G=$("rotate-ccw",U);async function Q(e){return(await o.post("/api/receipts/scan",e)).data}async function W(e){const a=new FormData;return a.append("file",e),(await o.post("/api/receipts/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function O(e){return e||null}function X({selected:e,onSelect:a,isIncome:n=!1}){const{t:g}=S("common"),{data:c,isLoading:C}=A(),w=D(),[s,h]=v.useState(null),[f,d]=v.useState(!1),[u,x]=v.useState(""),[l,b]=v.useState("ðŸ“");if(C||!c)return t.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const j=n?c.income:c.expense,p=r=>{for(const i of j)if(i.children.some(I=>I.name===r))return i;return null},m=r=>{h(r),d(!1)},k=r=>{s&&a(r.name,s.name)},M=()=>{h(null),d(!1)},N=async()=>{!s||!u.trim()||(await w.mutateAsync({name:u.trim(),icon:l,parent_id:s.id,type:n?"income":"expense"}),a(u.trim(),s.name),x(""),d(!1))};return s?t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:M,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[t.jsx(T,{className:"w-4 h-4"}),s.icon," ",s.name]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.children.map(r=>t.jsxs("button",{type:"button",onClick:()=>k(r),className:y("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",e===r.name?"bg-primary-100 border-2 border-primary-500 dark:bg-primary-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[t.jsx("span",{className:"text-2xl mb-1",children:r.icon}),t.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:r.name})]},r.id)),t.jsxs("button",{type:"button",onClick:()=>d(!0),className:y("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[t.jsx(_,{className:"w-6 h-6 mb-1 text-gray-400"}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:g("category.addCustom","Add")})]})]}),f&&t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(B,{value:l,onChange:r=>b(r.target.value),className:"w-16 text-center text-xl",maxLength:2}),t.jsx(B,{value:u,onChange:r=>x(r.target.value),placeholder:g("category.namePlaceholder","Category name"),className:"flex-1"})]}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsx(P,{variant:"outline",size:"sm",onClick:()=>d(!1),children:g("cancel","Cancel")}),t.jsx(P,{size:"sm",onClick:N,disabled:!u.trim()||w.isPending,children:g("create","Create")})]})]})]}):t.jsx("div",{className:"grid grid-cols-3 gap-2",children:j.map(r=>{var i;return t.jsxs("button",{type:"button",onClick:()=>m(r),className:y("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((i=p(e))==null?void 0:i.id)===r.id?"bg-primary-100 border-2 border-primary-500 dark:bg-primary-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[t.jsx("span",{className:"text-2xl mb-1",children:r.icon}),t.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:r.name})]},r.id)})})}async function Z(e){return(await o.post("/api/budgets/generate",e)).data}async function ee(e,a){return(await o.post(`/api/budgets/${e}/regenerate`,a)).data}async function te(e){return(await o.get(`/api/budgets/${e}`)).data}async function H(e){return(await o.get("/api/budgets/tracking/current",{params:e?{month:e}:void 0})).data}async function ae(){return(await o.get("/api/budgets/suggestions")).data}async function re(e,a,n){return(await o.patch(`/api/budgets/${e}/allocations/${encodeURIComponent(a)}`,{amount:n})).data}async function se(e,a){return(await o.delete(`/api/budgets/${e}/allocations/${encodeURIComponent(a)}`)).data}async function ne(e){return(await o.post("/api/budgets/copy",e)).data}async function oe(e,a){return(await o.get("/api/budgets/copy/preview",{params:{source_month:e,target_month:a}})).data}async function ie(e){return(await o.get(`/api/budgets/${e}/versions`)).data}async function ce(e){return(await o.post(`/api/budgets/${e}/restore`)).data}function V(e,a,n){if(a==="JPY"||!n[a])return e;const g=n[a];if(g===0)return e;const c=a==="USD"?e/100:e;return Math.round(c/g)}function de({parentCategory:e,transactionAmount:a,isExpense:n,transactionCurrency:g="JPY"}){var r;const{t:c}=S("common"),{currency:C}=E(),{isPrivacyMode:w}=q(),{data:s}=F(),h=v.useMemo(()=>{const i=new Date;return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`},[]),{data:f}=L({queryKey:["budget","tracking",h],queryFn:()=>H(h),staleTime:2*60*1e3,retry:!1}),d=i=>R(i,C,(s==null?void 0:s.rates)||{},!0,w);if(!n)return null;const u=(r=f==null?void 0:f.categories)==null?void 0:r.find(i=>i.category===e);if(!u)return null;const{spent:x,budgeted:l}=u,b=l>0?x/l*100:0,j=V(a,g,(s==null?void 0:s.rates)||{}),p=x+j,m=l>0?p/l*100:0,k=p>l,M=()=>m>=100?"bg-red-500":m>=80?"bg-amber-500":"bg-green-500",N=()=>k?"text-red-600 dark:text-red-400":m>=80?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400";return t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 truncate",children:c("budget.insight.countsToward",{category:e})}),t.jsx("span",{className:y("text-xs font-semibold whitespace-nowrap",N()),children:k?c("budget.insight.over",{amount:d(p-l)}):c("budget.insight.left",{amount:d(l-p)})})]}),t.jsx("div",{className:"mt-1.5",children:t.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:t.jsxs("div",{className:"h-full rounded-full relative overflow-hidden",children:[t.jsx("div",{className:y("h-full rounded-full transition-all duration-300",M()),style:{width:`${Math.min(m,100)}%`}}),a>0&&t.jsx("div",{className:"absolute top-0 h-full opacity-50 rounded-r-full",style:{left:`${Math.min(b,100)}%`,width:`${Math.min(m-b,100-Math.min(b,100))}%`,background:"repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.4) 2px, rgba(255,255,255,0.4) 4px)"}})]})})}),t.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[c("budget.budgetContext.progress",{spent:d(x),budgeted:d(l)}),a>0&&t.jsxs("span",{className:y("ml-1",N()),children:["â†’ ",d(p)]})]}),k&&a>0&&t.jsx("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mt-1",children:c("budget.insight.willExceed")})]})}export{de as B,K as E,X as H,G as R,ce as a,te as b,ne as c,se as d,H as e,ae as f,Z as g,ie as h,O as i,W as j,oe as p,ee as r,Q as s,re as u};
