import{j as e,e as xe}from"./vendor-router-DONIM_LE.js";import{r as u,a as ye}from"./vendor-react-Cwh1aMWO.js";import{b as z,c as Q,u as U}from"./vendor-query-B0NEAgzV.js";import{i as he,O as be,au as pe,av as fe,X as W,j as f,I as K,B as _,aw as se,C,ao as je,n as ke,P as J,ax as ae,M as ne,z as ie,A as ce,G as re,Z as le,K as ve,ay as Ne,R as we}from"./index-8QQOl6s4.js";import{R as Se}from"./RecurringTransactionsList-BAPUeFV8.js";import{S as B}from"./Select-VOr_uKjK.js";import{R as Ce}from"./RecurringOptions-B90hBlcx.js";import{b as _e}from"./useCategories-CcWulFHo.js";import{u as q}from"./vendor-i18n-CNDlYvyf.js";import{L as oe}from"./lightbulb-BmCJTyV-.js";import"./vendor-charts-BwEA5mzu.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],De=he("arrow-left-right",qe);function Me({isOpen:t,onClose:c,editItem:i,initialSuggestion:l}){const{t:n}=q("common"),g=z(),{data:d}=be(),{data:o}=_e(),x=(a=[])=>a.flatMap(j=>[{name:j.name},...j.children.map(ge=>({name:ge.name}))]),p=x(o==null?void 0:o.expense),r=x(o==null?void 0:o.income),[y,m]=u.useState(""),[s,h]=u.useState(""),[G,D]=u.useState(""),[N,M]=u.useState(null),[T,k]=u.useState(!1),[b,v]=u.useState(!1),[w,R]=u.useState(null),[Y,F]=u.useState(""),[S,A]=u.useState("monthly"),[I,P]=u.useState(0),[X,L]=u.useState(1),[Z,E]=u.useState(7),[V,O]=u.useState(new Date().toISOString().split("T")[0]);u.useEffect(()=>{var a;t&&i?(m(i.description),h(Math.abs(i.amount).toString()),D(i.category),M(i.account_id),k(i.is_income),v(i.is_transfer),R(i.to_account_id),F(((a=i.transfer_fee_amount)==null?void 0:a.toString())??""),A(i.frequency),P(i.day_of_week??0),L(i.day_of_month??1),E(i.interval_days??7),O(i.next_run_date)):t&&l?(m(l.description),h(l.amount.toString()),D(l.category),M(null),k(l.is_income),v(!1),R(null),F(""),A(l.frequency),P(l.day_of_week??0),L(l.day_of_month??new Date().getDate()),E(l.interval_days??14),O(new Date().toISOString().split("T")[0])):t&&(m(""),h(""),D(""),M(null),k(!1),v(!1),R(null),F(""),A("monthly"),P(0),L(new Date().getDate()),E(7),O(new Date().toISOString().split("T")[0]))},[t,i,l]);const $=Q({mutationFn:pe,onSuccess:()=>{g.invalidateQueries({queryKey:["recurring-transactions"]}),c()}}),ee=Q({mutationFn:({id:a,data:j})=>fe(a,j),onSuccess:()=>{g.invalidateQueries({queryKey:["recurring-transactions"]}),c()}}),de=a=>{a.preventDefault();const j={description:y,amount:parseInt(s,10),category:b?"Transfer":G,account_id:N,is_income:b?!1:T,is_transfer:b,to_account_id:b?w:null,transfer_fee_amount:b&&Y?parseInt(Y,10):null,frequency:S,day_of_week:S==="weekly"?I:null,day_of_month:S==="monthly"?X:null,interval_days:S==="custom"?Z:null,start_date:V};i?ee.mutate({id:i.id,data:j}):$.mutate(j)},ue=b?[]:T?r:p,te=$.isPending||ee.isPending;if(!t)return null;const me=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:c}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-lg max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:n(i?"recurring.edit":"recurring.add")}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:de,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("transaction.type")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),v(!1)},className:f("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",!T&&!b?"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:n("transaction.expense")}),e.jsx("button",{type:"button",onClick:()=>{k(!0),v(!1)},className:f("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",T&&!b?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:n("transaction.income")}),e.jsxs("button",{type:"button",onClick:()=>{v(!0),k(!1)},className:f("flex-1 py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-1",b?"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:[e.jsx(De,{className:"w-4 h-4"}),n("recurring.transfer","Transfer")]})]})]}),e.jsx(K,{label:n("transaction.description"),value:y,onChange:a=>m(a.target.value),placeholder:n("recurring.descriptionPlaceholder","e.g., Monthly rent"),required:!0}),e.jsx(K,{label:n("transaction.amount"),type:"number",value:s,onChange:a=>h(a.target.value),placeholder:"0",min:"1",required:!0}),!b&&e.jsx(B,{label:n("transaction.category"),value:G,onChange:a=>D(a.target.value),options:[{value:"",label:n("transaction.selectCategory")},...ue.map(a=>({value:a.name,label:a.name}))],required:!0}),e.jsx(B,{label:b?n("recurring.fromAccount","From Account"):n("transaction.account"),value:(N==null?void 0:N.toString())??"",onChange:a=>M(a.target.value?parseInt(a.target.value,10):null),options:[{value:"",label:n("transaction.selectAccount","Select account")},...(d==null?void 0:d.filter(a=>a.id!==w).map(a=>({value:a.id.toString(),label:a.name})))??[]],required:b}),b&&e.jsxs(e.Fragment,{children:[e.jsx(B,{label:n("recurring.toAccount","To Account"),value:(w==null?void 0:w.toString())??"",onChange:a=>R(a.target.value?parseInt(a.target.value,10):null),options:[{value:"",label:n("recurring.selectDestAccount","Select destination")},...(d==null?void 0:d.filter(a=>a.id!==N).map(a=>({value:a.id.toString(),label:a.name})))??[]],required:!0}),e.jsx(K,{label:n("recurring.transferFee","Transfer Fee (optional)"),type:"number",value:Y,onChange:a=>F(a.target.value),placeholder:"0",min:"0"})]}),e.jsx(Ce,{frequency:S,setFrequency:A,dayOfWeek:I,setDayOfWeek:P,dayOfMonth:X,setDayOfMonth:L,intervalDays:Z,setIntervalDays:E}),e.jsx(K,{label:n("recurring.startDate"),type:"date",value:V,onChange:a=>O(a.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(_,{type:"button",variant:"outline",onClick:c,className:"flex-1",children:n("button.cancel")}),e.jsx(_,{type:"submit",disabled:te,className:"flex-1",children:te?n("button.saving","Saving..."):n("button.save")})]})]})]})]});return typeof document>"u"?null:ye.createPortal(me,document.body)}const Te={JPY:"Â¥"};function Re({onCreateFromSuggestion:t}){const{t:c}=q("common"),i=z(),[l,n]=u.useState(!0),[g,d]=u.useState(null),{data:o,isLoading:x}=U({queryKey:["recurring-suggestions"],queryFn:()=>ae(3),staleTime:5*60*1e3}),p=Q({mutationFn:se,onSuccess:()=>{i.invalidateQueries({queryKey:["recurring-suggestions"]}),d(null)},onError:()=>{d(null)}}),r=(s,h)=>{h.stopPropagation(),d(s),p.mutate(s)},y=s=>{switch(s.frequency){case"weekly":return c("recurring.weekly");case"monthly":return c("recurring.monthly");case"custom":return c("recurring.everyNDays",{n:s.interval_days??14});default:return s.frequency}},m=s=>s>=80?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":s>=60?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300";return x||!o||o.length===0?null:e.jsxs(C,{className:"mb-6 border-l-4 border-l-amber-400 bg-amber-50/50 dark:bg-amber-950/20",children:[e.jsxs("button",{onClick:()=>n(!l),className:"w-full flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/50 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:c("recurring.suggestions.title","Detected Patterns")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:c("recurring.suggestions.subtitle","{{count}} potential recurring transactions found",{count:o.length})})]})]}),l?e.jsx(je,{className:"w-5 h-5 text-gray-400"}):e.jsx(ke,{className:"w-5 h-5 text-gray-400"})]}),l&&e.jsx("div",{className:"mt-4 space-y-3",children:o.map(s=>e.jsx("div",{className:f("p-4 rounded-lg border bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700","transition-opacity",g===s.hash&&"opacity-50"),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:s.description}),e.jsxs("span",{className:f("px-2 py-0.5 text-xs font-medium rounded-full",m(s.confidence)),children:[s.confidence,"%"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:f("font-numbers",s.is_income?"text-income-600 dark:text-income-300":"text-expense-600 dark:text-expense-300"),children:[s.is_income?"+":"-",Te.JPY,s.amount.toLocaleString()]}),e.jsx("span",{children:s.category}),e.jsx("span",{children:y(s)}),e.jsx("span",{className:"text-xs",children:c("recurring.suggestions.occurrences","{{count}} times",{count:s.occurrences})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(_,{size:"sm",variant:"primary",onClick:()=>t(s),className:"gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),c("button.create")]}),e.jsx("button",{onClick:h=>r(s.hash,h),disabled:g===s.hash,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:c("recurring.suggestions.dismiss","Dismiss"),children:e.jsx(W,{className:"w-4 h-4"})})]})]})},s.hash))})]})}function H(t,c){switch(c){case"daily":return t*30;case"weekly":return t*4.33;case"biweekly":return t*2.17;case"monthly":return t;case"yearly":return t/12;default:return t}}const Fe={daily:"recurring.daily",weekly:"recurring.weekly",biweekly:"recurring.biweekly",monthly:"recurring.monthly",yearly:"recurring.yearly"};function Ae(){const{t}=q("common"),{currency:c}=ne(),{isPrivacyMode:i}=ie(),{data:l}=ce(),{data:n,isLoading:g}=U({queryKey:["recurring-transactions",!0],queryFn:()=>Ne(!0),staleTime:5*60*1e3}),d=r=>le(r,c,(l==null?void 0:l.rates)||{},!1,i),o=(n||[]).filter(r=>!r.is_income&&!r.is_transfer),x=o.reduce((r,y)=>r+H(y.amount,y.frequency),0),p=o.reduce((r,y)=>{const m=y.category||t("subscriptions.uncategorized","Other");return(r[m]||(r[m]=[])).push(y),r},{});return g?e.jsx("div",{className:"h-40 rounded-xl bg-gray-100 dark:bg-gray-800 animate-pulse"}):o.length===0?e.jsxs(C,{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:t("subscriptions.empty","No active subscriptions")})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(C,{children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-3",children:[e.jsx("div",{className:"p-1.5 rounded-xl bg-blue-100 dark:bg-blue-900/30",children:e.jsx(re,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-base font-extrabold text-gray-900 dark:text-gray-100 tracking-tight",children:t("subscriptions.title","Subscriptions")})]}),e.jsxs("div",{className:"flex items-baseline gap-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white font-numbers",children:[d(x),e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["/",t("subscriptions.mo","mo")]})]})}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[d(x*12),e.jsxs("span",{children:["/",t("subscriptions.yr","yr")]})]})]})]}),Object.entries(p).map(([r,y])=>{const m=y.reduce((s,h)=>s+H(h.amount,h.frequency),0);return e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:r}),e.jsxs("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 font-numbers",children:[d(m),"/",t("subscriptions.mo","mo")]})]}),e.jsx("div",{className:"space-y-1",children:y.map((s,h)=>e.jsxs("div",{className:"flex items-center justify-between py-2.5 border-b border-gray-100 dark:border-gray-700 last:border-0 animate-stagger-in",style:{"--stagger-index":h},children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:f("px-1.5 py-0.5 text-[10px] font-medium rounded-full","bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300"),children:t(Fe[s.frequency]||"recurring.monthly",s.frequency)}),e.jsxs("span",{className:"text-xs text-gray-400",children:[t("subscriptions.next","Next"),": ",ve(s.next_run_date,"MM/dd")]})]})]}),e.jsxs("span",{className:"text-sm font-bold text-gray-900 dark:text-gray-100 font-numbers shrink-0 ml-3",children:[d(H(s.amount,s.frequency)),"/",t("subscriptions.mo","mo")]})]},s.id))})]},r)})]})}function Pe(t){return t>=.8||t>=80?{label:"High",key:"subscriptions.high",cls:"bg-income-100 text-income-600 dark:bg-income-900/20 dark:text-income-300"}:t>=.5||t>=50?{label:"Medium",key:"subscriptions.medium",cls:"bg-amber-100 text-amber-600 dark:bg-amber-900/20 dark:text-amber-400"}:{label:"Low",key:"subscriptions.low",cls:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300"}}function Le({onCreateFromSuggestion:t}){const{t:c}=q("common"),i=z(),{currency:l}=ne(),{isPrivacyMode:n}=ie(),{data:g}=ce(),d=r=>le(r,l,(g==null?void 0:g.rates)||{},!1,n),{data:o}=U({queryKey:["recurring-suggestions"],queryFn:()=>ae(3),staleTime:5*60*1e3}),x=Q({mutationFn:se,onSuccess:()=>i.invalidateQueries({queryKey:["recurring-suggestions"]})}),p=(o||[]).filter(r=>!r.is_income);return p.length===0?null:e.jsxs(C,{className:"border-l-4 border-l-amber-400 bg-amber-50/50 dark:bg-amber-950/20",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx("div",{className:"p-1.5 rounded-xl bg-amber-100 dark:bg-amber-900/20",children:e.jsx(oe,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-extrabold text-gray-900 dark:text-gray-100 tracking-tight",children:c("subscriptions.suggestionsTitle","We detected these recurring charges")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:c("subscriptions.suggestionsSubtitle","Confirm to track them as subscriptions")})]})]}),e.jsx("div",{className:"space-y-2",children:p.map((r,y)=>{const m=Pe(r.confidence);return e.jsx("div",{className:f("p-3 rounded-lg border bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 animate-stagger-in",x.isPending&&x.variables===r.hash&&"opacity-50"),style:{"--stagger-index":y},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:r.description}),e.jsx("span",{className:f("px-2 py-0.5 text-xs font-medium rounded-full",m.cls),children:c(m.key,m.label)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"font-numbers text-expense-600 dark:text-expense-300",children:["-",d(r.amount)]}),e.jsx("span",{children:r.frequency})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(_,{size:"sm",variant:"primary",onClick:()=>t(r),className:"gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),c("button.create")]}),e.jsx("button",{onClick:()=>x.mutate(r.hash),disabled:x.isPending,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:c("recurring.suggestions.dismiss","Dismiss"),children:e.jsx(W,{className:"w-4 h-4"})})]})]})},r.hash)})})]})}function Ee(){return new URLSearchParams(window.location.search).get("tab")==="subscriptions"?"subscriptions":"all"}function Oe(){const{t}=q("common"),c=z(),[i,l]=u.useState(Ee),[n,g]=u.useState(!1),[d,o]=u.useState(null),x=r=>{o(r),g(!0)},p=()=>{g(!1),o(null),c.invalidateQueries({queryKey:["recurring-suggestions"]})};return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"w-8 h-8 text-primary-600 dark:text-primary-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("recurring.pageTitle","Recurring Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t("recurring.pageSubtitle","Automate your regular income and expenses")})]})]}),e.jsxs(_,{variant:"primary",size:"sm",onClick:()=>g(!0),children:[e.jsx(J,{className:"w-5 h-5"}),t("recurring.add","Add Recurring")]})]}),e.jsx("div",{className:"flex gap-1 mb-6 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg w-fit",children:["all","subscriptions"].map(r=>e.jsx("button",{onClick:()=>l(r),className:f("px-4 py-1.5 text-sm font-medium rounded-md transition-colors",i===r?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:r==="all"?t("recurring.tabAll","All"):t("recurring.tabSubscriptions","Subscriptions")},r))}),i==="all"?e.jsxs(e.Fragment,{children:[e.jsx(Re,{onCreateFromSuggestion:x}),e.jsx(Se,{})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ae,{}),e.jsx(Le,{onCreateFromSuggestion:x})]}),e.jsx(Me,{isOpen:n,onClose:p,initialSuggestion:d})]})}const Xe=xe("/recurring")({component:Oe});export{Xe as Route};
