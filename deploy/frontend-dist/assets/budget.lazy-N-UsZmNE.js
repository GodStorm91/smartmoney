import{l as he,u as K,a0 as Z,r as b,j as e,C as J,B as U,I as qe,s as Ut,F as Wt,a8 as kt,S as Ze,Q as mr,m as w,X as ke,aR as yt,P as we,aS as Ue,M as te,N as X,a9 as Y,aF as Oe,aT as gr,ay as Ne,g as Xe,q as xr,aw as mt,aU as xe,aV as I,v as Ht,p as oe,aW as Qt,z as vt,aX as hr,L as Qe,h as gt,aY as Re,J as et,a4 as ge,t as fr,ax as Ct,ah as xt,$ as Gt,T as pr,aZ as br,a_ as yr,a$ as vr,b0 as jr,aj as wr,D as Ce,b1 as Nr,b2 as kr,b3 as Cr,b4 as Sr,b5 as St,b6 as Ar,b7 as Pr,b8 as _r,b9 as Mr,k as Tr}from"./index-ZT26ts1x.js";import{d as tt,e as Or}from"./useCategories-Cv4S1u56.js";import{C as Jt}from"./chevron-down-Ch5zQZlk.js";import{R as Dr,E as At}from"./BudgetInsightWidget-DZW_51At.js";import{T as le}from"./triangle-alert-BEhEOqK5.js";import{f as G,_ as Yt,a as Er,b as Zt,c as Lr,i as ve,T as jt,p as ie,L as ae,g as Xt,d as wt,e as er,D as $r,C as Rr,h as Te,j as Ae,S as Br,A as zr,k as Fr,l as Pt,m as Ir,n as Pe,o as Kr,u as Vr,G as qr,q as We,r as Ur,s as tr,t as Wr,v as Ke,w as _t,x as Hr,y as Qr,R as Gr,z as Jr}from"./generateCategoricalChart-CIRb66dC.js";import{R as Yr}from"./ResponsiveModal-B-BPmg3E.js";import{S as Zr}from"./Switch-CMyfDrcU.js";import{g as Xr,a as ea,A as ta,b as ra}from"./ai-categorization-service-B48dgEsX.js";import{S as aa,a as sa}from"./square-C10ShIEM.js";import{P as na}from"./pencil-DkKPRVHt.js";import{Z as oa}from"./zap-BtoPMabJ.js";import{T as ia}from"./TransactionEditModal-iZdofgq6.js";import{u as la}from"./useXPGain-CG8b_NRB.js";import{D as ca}from"./download-BgbJmLPW.js";import"./Select-D_i4ZWRT.js";import"./zoom-out-Ddz0e80u.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ua=he("calendar-days",da);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Mt=he("copy",ma);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],xa=he("ellipsis",ga);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],fa=he("history",ha);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],ba=he("layout-grid",pa);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],va=he("list",ya);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],wa=he("shield-alert",ja);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ka=he("shield-check",Na);function Ve(t,r=0){if(!t&&t!==0)return"";const s=typeof t=="string"?parseFloat(t):t;return isNaN(s)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:r,maximumFractionDigits:r}).format(s)}function Ca(t){if(!t)return 0;const r=t.replace(/,/g,""),s=parseFloat(r);return isNaN(s)?0:s}function Sa(t){return{JPY:"Â¥",USD:"$",VND:"â‚«",EUR:"â‚¬",GBP:"Â£"}[t]||t}function Aa(t){return["VND"].includes(t)?"suffix":"prefix"}function Pa(t){return{JPY:0,VND:0,KRW:0,USD:2,EUR:2,GBP:2}[t]??0}function _a({onGenerate:t,isLoading:r,error:s,suggestions:a}){const{t:n}=K("common"),{currency:i}=Z(),[o,d]=b.useState(""),[u,l]=b.useState(!1),c=Sa(i),m=Aa(i),h=Pa(i);b.useEffect(()=>{if(a!=null&&a.previous_income&&!u&&!o){const N=a.previous_income/Math.pow(10,h);d(Ve(N,h)),l(!0)}},[a,u,o,h]);const x=N=>{const y=N.target.value.replace(/[^\d.]/g,"");if(y){const k=parseFloat(y);isNaN(k)||d(Ve(k,h))}else d("")},f=N=>{N.preventDefault();const p=Ca(o),y=Math.round(p*Math.pow(10,h));y>0&&(t(y),d(""))},g=()=>{a!=null&&a.previous_income&&t(a.previous_income)},v=N=>{const[p,y]=N.split("-");return new Date(parseInt(p),parseInt(y)-1).toLocaleDateString(Ut(),{month:"long",year:"numeric"})};return e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.has_previous)&&a.previous_month&&e.jsx(J,{className:"p-6 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("budget.previousBudgetFound",{month:v(a.previous_month)})}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:n("budget.cloneDescription")}),e.jsx(U,{onClick:g,loading:r,className:"w-full sm:w-auto",children:n("budget.clonePreviousMonth")})]})]})}),(a==null?void 0:a.has_previous)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:n("budget.orCreateNew")})})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("budget.generateTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:n("budget.generateDescription")}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("budget.monthlyIncome")}),e.jsxs("div",{className:"relative",children:[m==="prefix"&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:c})}),e.jsx(qe,{type:"text",inputMode:"decimal",value:o,onChange:x,placeholder:Ve(5e5,h),required:!0,disabled:r,className:m==="prefix"?"pl-8":"pr-10"}),m==="suffix"&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:c})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[n("budget.incomeHint"),(a==null?void 0:a.previous_income)&&e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400",children:["(",n("budget.previousIncome"),": ",c,Ve(a.previous_income/Math.pow(10,h),h),")"]})]})]}),e.jsx(U,{type:"submit",loading:r,disabled:!o,className:"w-full",children:n("budget.generateButton")}),s&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:n("budget.generateError")})]})]})]})}function Ma({copyPreview:t,isCopyPreviewLoading:r,suggestions:s,selectedMonth:a,formatCurrency:n,formatMonth:i,onCopy:o,onGenerate:d,onStartEmpty:u,isCopyLoading:l,isGenerateLoading:c,generateError:m}){const{t:h}=K("common"),[x,f]=b.useState("choose");if(r)return e.jsx(J,{className:"p-8 flex items-center justify-center",children:e.jsx(Wt,{})});if(x==="generate")return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>f("choose"),className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors p-1 -ml-1",children:[e.jsx(kt,{className:"w-4 h-4"}),h("common.back")]}),e.jsx(_a,{onGenerate:d,isLoading:c,error:m,suggestions:s})]});if(x==="copy"&&t)return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>f("choose"),className:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors p-1 -ml-1",children:[e.jsx(kt,{className:"w-4 h-4"}),h("common.back")]}),e.jsxs(J,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:h("budget.copyFromPrevious",{month:i(t.source_budget.month)})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:h("budget.wizard.copyDescription")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h("budget.totalBudgeted")}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:n(t.spending_summary.reduce((y,k)=>y+k.budgeted,0))})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h("budget.categories")}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:t.spending_summary.length})]})]}),e.jsxs(U,{onClick:o,loading:l,className:"w-full",children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"}),h("budget.copyAndEdit")]})]})]});const v=[...!!t?[{id:"copy",icon:Mt,title:h("budget.wizard.copyTitle"),description:h("budget.wizard.copyHint",{month:i(t.source_budget.month)}),accent:"blue"}]:[],{id:"generate",icon:Ze,title:h("budget.wizard.aiTitle"),description:h("budget.wizard.aiHint"),accent:"purple"},{id:"empty",icon:mr,title:h("budget.wizard.emptyTitle"),description:h("budget.wizard.emptyHint"),accent:"gray"}],N={blue:"border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700",purple:"border-purple-200 dark:border-purple-800 bg-purple-50/50 dark:bg-purple-900/20 hover:border-purple-300 dark:hover:border-purple-700",gray:"border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 hover:border-gray-300 dark:hover:border-gray-600"},p={blue:"bg-blue-100 dark:bg-blue-800 text-blue-600 dark:text-blue-300",purple:"bg-purple-100 dark:bg-purple-800 text-purple-600 dark:text-purple-300",gray:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:h("budget.wizard.title",{month:i(a)})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:h("budget.wizard.subtitle")})]}),e.jsx("div",{className:"space-y-3",children:v.map(y=>{const k=y.icon;return e.jsxs("button",{onClick:()=>{y.id==="empty"?u():f(y.id)},className:w("w-full flex items-start gap-4 p-4 rounded-xl border-2 transition-all text-left","focus:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2","active:scale-[0.98]",N[y.accent]),children:[e.jsx("div",{className:w("p-2.5 rounded-xl flex-shrink-0",p[y.accent]),children:e.jsx(k,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:y.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:y.description})]})]},y.id)})})]})}function Ta({onSubmit:t,onCancel:r,isLoading:s}){const{t:a}=K("common"),[n,i]=b.useState(""),o=d=>{d.preventDefault(),n.trim()&&(t(n.trim()),i(""))};return e.jsxs(J,{className:"p-6 border-blue-200 bg-blue-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:a("budget.feedbackTitle")}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx("textarea",{value:n,onChange:d=>i(d.target.value),placeholder:a("budget.feedbackPlaceholder"),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 min-h-[100px]",disabled:s,required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{type:"submit",disabled:s||!n.trim(),children:a(s?"budget.regenerating":"budget.submitFeedback")}),e.jsx(U,{type:"button",variant:"outline",onClick:r,children:a("cancel")})]})]})]})}function Oa({budget:t,onClose:r,onAdd:s}){const{t:a}=K("common"),{data:n}=tt(),i=Or(),[o,d]=b.useState(null),[u,l]=b.useState(""),[c,m]=b.useState(""),[h,x]=b.useState(!1),[f,g]=b.useState(""),[v,N]=b.useState("ðŸ“"),p=b.useMemo(()=>new Set(t.allocations.map(P=>P.category)),[t.allocations]),y=b.useMemo(()=>{const P=t.allocations.reduce((L,F)=>L+F.amount,0);return t.monthly_income-(t.savings_target||0)-P},[t]),k=(n==null?void 0:n.expense)||[],S=P=>{P.children.filter(F=>!p.has(F.name)).length===0&&!p.has(P.name)?l(P.name):d(P),x(!1)},R=P=>{l(P.name)},O=()=>{d(null),l(""),x(!1)},C=async()=>{!o||!f.trim()||(await i.mutateAsync({name:f.trim(),icon:v,parent_id:o.id,type:"expense"}),l(f.trim()),g(""),x(!1))},D=P=>{P.preventDefault(),!(!u||parseInt(c)<=0)&&s(u,parseInt(c))},M=Math.floor(y/3);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(J,{className:"w-full max-w-md animate-in fade-in zoom-in duration-200 max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a("budget.addCategory")}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:D,className:"p-4 space-y-4 overflow-y-auto flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a("budget.category")}),u?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[e.jsx("span",{className:"flex-1 font-medium text-blue-700 dark:text-blue-300",children:u}),e.jsx("button",{type:"button",onClick:()=>{l(""),d(null)},className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",children:a("change","Change")})]}):o?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:O,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(yt,{className:"w-4 h-4"}),o.icon," ",o.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.children.map(P=>{const L=p.has(P.name);return e.jsxs("button",{type:"button",onClick:()=>!L&&R(P),disabled:L,className:w("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",L?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:P.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:P.name}),L&&e.jsx("span",{className:"text-[10px] text-gray-400",children:a("budget.alreadyAdded","Added")})]},P.id)}),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:w("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(we,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("category.addCustom","Add")})]})]}),h&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(qe,{value:v,onChange:P=>N(P.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(qe,{value:f,onChange:P=>g(P.target.value),placeholder:a("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(U,{type:"button",variant:"outline",size:"sm",onClick:()=>x(!1),children:a("cancel","Cancel")}),e.jsx(U,{type:"button",size:"sm",onClick:C,disabled:!f.trim()||i.isPending,children:a("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:k.map(P=>{const L=P.children.filter(z=>!p.has(z.name)),F=L.length===0&&p.has(P.name);return e.jsxs("button",{type:"button",onClick:()=>!F&&S(P),disabled:F,className:w("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",F?"bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:P.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:P.name}),L.length>0&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:[L.length," ",a("budget.available","available")]})]},P.id)})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a("budget.amount")}),e.jsx(qe,{type:"number",value:c,onChange:P=>m(P.target.value),placeholder:Ue(0),min:1,autoFocus:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a("budget.remainingBudget"),": ",Ue(y)]})]}),M>0&&e.jsx("button",{type:"button",onClick:()=>m(String(M)),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:a("budget.suggestAmount",{amount:Ue(M)})})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:a("cancel")}),e.jsxs(U,{type:"submit",disabled:!u||parseInt(c)<=0,className:"flex-1",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),a("budget.add")]})]})]})]})})}function Da({isOpen:t,onConfirm:r,onCancel:s,monthlyIncome:a,totalAllocated:n,savingsTarget:i,categoryCount:o,isLoading:d=!1}){const{t:u}=K("common"),{currency:l}=Z(),{isPrivacyMode:c}=te(),{data:m}=X(),h=g=>Y(g,l,(m==null?void 0:m.rates)||{},!1,c);if(!t)return null;const x=a-n-i,f=x<0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:w("fixed z-50 bg-white dark:bg-gray-800 shadow-xl","inset-x-0 bottom-0 rounded-t-2xl","lg:inset-auto lg:left-1/2 lg:top-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2","lg:rounded-xl lg:max-w-md lg:w-full"),role:"dialog","aria-modal":"true","aria-labelledby":"confirm-dialog-title",children:[e.jsx("div",{className:"lg:hidden flex justify-center pt-3 pb-1",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("h2",{id:"confirm-dialog-title",className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:u("budget.confirmDialog.title")}),e.jsx("button",{onClick:s,className:"p-2 -mr-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":u("button.close"),children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u("budget.monthlyIncome")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:h(a)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u("budget.totalAllocated")}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:h(n)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u("budget.savingsTarget")}),e.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400",children:h(i)})]}),e.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:u(f?"budget.overAllocated":"budget.confirmDialog.unallocated")}),e.jsx("span",{className:w("font-semibold",f?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"),children:f?`-${h(Math.abs(x))}`:h(x)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(Oe,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:u("budget.confirmDialog.categoriesConfigured",{count:o})})]}),f&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-400",children:u("budget.confirmDialog.overAllocatedWarning")})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(U,{variant:"outline",onClick:s,className:"flex-1",disabled:d,children:u("button.cancel")}),e.jsx(U,{onClick:r,className:"flex-1",disabled:d,children:u(d?"budget.saving":"budget.save")})]})]})]})}const Se=[{id:"overview",labelKey:"budget.tabs.overview",icon:ba},{id:"categories",labelKey:"budget.tabs.categories",icon:va},{id:"transactions",labelKey:"budget.tabs.transactions",icon:gr},{id:"forecast",labelKey:"budget.tabs.forecast",icon:Ne}];function Ea({activeTab:t,onTabChange:r,children:s,className:a,alertTabs:n=[]}){const{t:i}=K("common"),o=b.useRef(null),d=b.useRef(null);b.useEffect(()=>{if(d.current&&o.current){const l=o.current,c=d.current,m=c.offsetLeft-l.offsetWidth/2+c.offsetWidth/2;l.scrollTo({left:m,behavior:"smooth"})}},[t]);const u=(l,c)=>{let m=c;l.key==="ArrowLeft"?(l.preventDefault(),m=c>0?c-1:Se.length-1):l.key==="ArrowRight"?(l.preventDefault(),m=c<Se.length-1?c+1:0):l.key==="Home"?(l.preventDefault(),m=0):l.key==="End"&&(l.preventDefault(),m=Se.length-1),m!==c&&r(Se[m].id)};return e.jsxs("div",{className:w("flex flex-col",a),children:[e.jsx("div",{className:"hidden md:flex items-center gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg mb-4",role:"tablist","aria-label":i("budget.tabs.navigation"),children:Se.map((l,c)=>{const m=l.icon,h=t===l.id,x=n.includes(l.id);return e.jsxs("button",{role:"tab","aria-selected":h,"aria-controls":`tabpanel-${l.id}`,tabIndex:h?0:-1,onClick:()=>r(l.id),onKeyDown:f=>u(f,c),className:w("relative flex items-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-all","focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2",h?"bg-white dark:bg-gray-900 text-primary-600 dark:text-primary-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"),children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:i(l.labelKey)}),x&&e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]},l.id)})}),e.jsx("div",{ref:o,className:"md:hidden flex gap-2 overflow-x-auto scrollbar-hide pb-1 mb-4 -mx-1 px-1",role:"tablist","aria-label":i("budget.tabs.navigation"),children:Se.map((l,c)=>{const m=l.icon,h=t===l.id,x=n.includes(l.id);return e.jsxs("button",{ref:h?d:void 0,role:"tab","aria-selected":h,"aria-controls":`tabpanel-${l.id}`,tabIndex:h?0:-1,onClick:()=>r(l.id),onKeyDown:f=>u(f,c),className:w("relative flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium whitespace-nowrap transition-all flex-shrink-0","focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500","min-h-[44px]",h?"bg-primary-600 text-white shadow-sm":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"),children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:i(l.labelKey)}),x&&e.jsx("span",{className:w("absolute top-1 right-1 w-2 h-2 rounded-full",h?"bg-white":"bg-red-500")})]},l.id)})}),e.jsx("div",{id:`tabpanel-${t}`,role:"tabpanel","aria-labelledby":`tab-${t}`,tabIndex:0,children:s})]})}function La({versions:t,currentVersion:r,formatCurrency:s,onRestore:a,isRestoring:n}){const{t:i}=K("common"),[o,d]=b.useState(!1);if(t.length<=1)return null;const u=l=>new Date(l).toLocaleDateString(Ut(),{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>d(!o),className:w("flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-colors","text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800",o&&"bg-gray-100 dark:bg-gray-800"),children:[e.jsx(fa,{className:"w-4 h-4"}),e.jsxs("span",{children:["v",r]}),e.jsx(Jt,{className:w("w-3.5 h-3.5 transition-transform",o&&"rotate-180")})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>d(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:i("budget.versionHistory")})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.map(l=>e.jsxs("div",{className:w("px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700/50",l.is_active&&"bg-blue-50 dark:bg-blue-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-sm",children:["v",l.version]}),l.is_active&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(Xe,{className:"w-3 h-3"}),i("budget.current")]}),l.copied_from_id&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i("budget.copied"),")"]})]}),!l.is_active&&e.jsxs("button",{onClick:()=>{a(l.id),d(!1)},disabled:n,className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",children:[e.jsx(Dr,{className:"w-3 h-3"}),i("budget.restore")]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:u(l.created_at)}),e.jsx("span",{className:"mx-1",children:"Â·"}),e.jsx("span",{children:s(l.total_allocated)})]})]},l.id))})]})]})]})}function $a({totalBudget:t,totalSpent:r,totalAllocated:s,month:a,className:n}){const{t:i}=K("common"),{currency:o}=Z(),{isPrivacyMode:d}=te(),{data:u}=X(),l=k=>Y(k,o,(u==null?void 0:u.rates)||{},!0,d),c=k=>Y(k,o,(u==null?void 0:u.rates)||{},!1,d),m=t-r,h=s>0?r/s*100:0,x=t>0?Math.max(0,m/t*100):0,{daysRemaining:f,dailyRate:g,safeDaily:v,status:N}=b.useMemo(()=>{const[k,S]=a.split("-").map(Number),R=new Date(k,S,0).getDate(),O=new Date().getDate(),C=Math.max(1,O),D=Math.max(0,R-O),M=r/C,P=t-r,L=D>0?P/D:0,F=r+M*D,z=t>0?F/t*100:0;let j="good";return z>100?j="danger":z>90&&(j="warning"),{daysRemaining:D,dailyRate:M,safeDaily:L,status:j}},[a,r,t]),p=b.useMemo(()=>r>s?{label:i("budget.health.overBudgetStatus"),status:"danger",color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/30",ring:"ring-red-200 dark:ring-red-800"}:h>95?{label:i("budget.health.almostFull"),status:"warning",color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-50 dark:bg-amber-900/30",ring:"ring-amber-200 dark:ring-amber-800"}:h>85?{label:i("budget.health.warningNearLimit"),status:"caution",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/30",ring:"ring-yellow-200 dark:ring-yellow-800"}:{label:i("budget.health.onTrack"),status:"good",color:"text-green-600 dark:text-green-400",bg:"bg-green-50 dark:bg-green-900/30",ring:"ring-green-200 dark:ring-green-800"},[r,s,h,i]),y=g>v&&v>0;return e.jsxs("div",{className:w("rounded-2xl ring-1 overflow-hidden",p.bg,p.ring,n),children:[e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium opacity-60 uppercase tracking-wider",children:i("budget.availableToSpend")}),e.jsxs("div",{className:w("flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold",p.status==="danger"?"bg-red-500 text-white":p.status==="warning"?"bg-amber-500 text-white":p.status==="caution"?"bg-yellow-500 text-gray-900":"bg-primary-500 text-white"),children:[p.status==="danger"?e.jsx(le,{className:"w-3.5 h-3.5"}):e.jsx(Ne,{className:"w-3.5 h-3.5"}),p.label]})]}),e.jsxs("p",{className:w("text-4xl font-extrabold tracking-tight",m<0?"text-red-600 dark:text-red-400":p.color),children:[m<0&&"âˆ’",l(Math.abs(m))]}),e.jsx("div",{className:"mt-3 h-2.5 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-700 ease-out",m<0?"bg-red-500":x<20?"bg-amber-500":x<40?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,Math.max(0,x))}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs opacity-70 mt-1.5",children:[e.jsxs("span",{children:[c(r)," ",i("budget.spent")]}),e.jsx("span",{children:i("budget.ofTotalBudget",{total:c(t)})})]})]}),e.jsxs("div",{className:"px-4 py-3 bg-black/5 dark:bg-white/5 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:i("budget.projection.currentPace")}),e.jsxs("p",{className:w("text-lg font-bold leading-tight",y?"text-amber-600 dark:text-amber-400":""),children:[c(g),e.jsx("span",{className:"text-[10px] font-normal opacity-50",children:i("budget.pulse.perDay")})]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:i("budget.projection.safePace")}),e.jsxs("p",{className:"text-lg font-bold leading-tight text-green-600 dark:text-green-400",children:[v>0?c(v):"â€”",v>0&&e.jsx("span",{className:"text-[10px] font-normal opacity-50",children:i("budget.pulse.perDay")})]})]}),e.jsxs("div",{className:"min-w-0 text-right",children:[e.jsx("p",{className:"text-[10px] font-medium opacity-50 uppercase tracking-wider truncate",children:i("budget.daysLeft")}),e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(xr,{className:"w-3.5 h-3.5 opacity-50"}),e.jsx("p",{className:"text-lg font-bold leading-tight",children:f})]})]})]})]})}function Ra({income:t,allocated:r,savings:s,formatCurrency:a,className:n}){const{t:i}=K("common"),o=t>0?Math.min(100,r/t*100):0,d=t>0?Math.min(100,s/t*100):0,u=Math.max(0,100-o-d);return e.jsxs("div",{className:w("rounded-xl bg-gray-50 dark:bg-gray-800/50 p-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(ot,{label:i("budget.flow.income"),value:a(t),color:"text-green-600 dark:text-green-400"}),e.jsx(mt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0 mx-1"}),e.jsx(ot,{label:i("budget.flow.allocated"),value:a(r),color:"text-blue-600 dark:text-blue-400"}),e.jsx(mt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0 mx-1"}),e.jsx(ot,{label:i("budget.flow.saved"),value:a(s),color:"text-pink-600 dark:text-pink-400"})]}),e.jsxs("div",{className:"h-3 rounded-full overflow-hidden flex bg-gray-200 dark:bg-gray-700",children:[o>0&&e.jsx("div",{className:"bg-blue-500 transition-all duration-500",style:{width:`${o}%`},title:`${i("budget.flow.allocated")}: ${Math.round(o)}%`}),d>0&&e.jsx("div",{className:"bg-pink-500 transition-all duration-500",style:{width:`${d}%`},title:`${i("budget.flow.saved")}: ${Math.round(d)}%`}),u>0&&e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 transition-all duration-500",style:{width:`${u}%`}})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-[10px] text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),Math.round(o),"% ",i("budget.flow.allocated").toLowerCase()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-pink-500"}),Math.round(d),"% ",i("budget.flow.saved").toLowerCase()]}),u>1&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600"}),Math.round(u),"% ",i("budget.flow.unallocated").toLowerCase()]})]})]})}function ot({label:t,value:r,color:s}){return e.jsxs("div",{className:"text-center min-w-0 flex-1",children:[e.jsx("p",{className:"text-[10px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate",children:t}),e.jsx("p",{className:w("text-sm font-bold truncate",s),children:r})]})}var Ba=["points","className","baseLinePoints","connectNulls"];function _e(){return _e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},_e.apply(this,arguments)}function za(t,r){if(t==null)return{};var s=Fa(t,r),a,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)a=i[n],!(r.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function Fa(t,r){if(t==null)return{};var s={};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){if(r.indexOf(a)>=0)continue;s[a]=t[a]}return s}function Tt(t){return qa(t)||Va(t)||Ka(t)||Ia()}function Ia(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ka(t,r){if(t){if(typeof t=="string")return ht(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ht(t,r)}}function Va(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function qa(t){if(Array.isArray(t))return ht(t)}function ht(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}var Ot=function(r){return r&&r.x===+r.x&&r.y===+r.y},Ua=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=[[]];return r.forEach(function(a){Ot(a)?s[s.length-1].push(a):s[s.length-1].length>0&&s.push([])}),Ot(r[0])&&s[s.length-1].push(r[0]),s[s.length-1].length<=0&&(s=s.slice(0,-1)),s},Be=function(r,s){var a=Ua(r);s&&(a=[a.reduce(function(i,o){return[].concat(Tt(i),Tt(o))},[])]);var n=a.map(function(i){return i.reduce(function(o,d,u){return"".concat(o).concat(u===0?"M":"L").concat(d.x,",").concat(d.y)},"")}).join("");return a.length===1?"".concat(n,"Z"):n},Wa=function(r,s,a){var n=Be(r,a);return"".concat(n.slice(-1)==="Z"?n.slice(0,-1):n,"L").concat(Be(s.reverse(),a).slice(1))},Ha=function(r){var s=r.points,a=r.className,n=r.baseLinePoints,i=r.connectNulls,o=za(r,Ba);if(!s||!s.length)return null;var d=xe("recharts-polygon",a);if(n&&n.length){var u=o.stroke&&o.stroke!=="none",l=Wa(s,n,i);return I.createElement("g",{className:d},I.createElement("path",_e({},G(o,!0),{fill:l.slice(-1)==="Z"?o.fill:"none",stroke:"none",d:l})),u?I.createElement("path",_e({},G(o,!0),{fill:"none",d:Be(s,i)})):null,u?I.createElement("path",_e({},G(o,!0),{fill:"none",d:Be(n,i)})):null)}var c=Be(s,i);return I.createElement("path",_e({},G(o,!0),{fill:c.slice(-1)==="Z"?o.fill:"none",className:d,d:c}))},Qa=Yt,Ga=Er,Ja=Zt;function Ya(t,r){return t&&t.length?Qa(t,Ja(r),Ga):void 0}var Za=Ya;const Xa=Ht(Za);var es=Yt,ts=Zt,rs=Lr;function as(t,r){return t&&t.length?es(t,ts(r),rs):void 0}var ss=as;const ns=Ht(ss);var os=["cx","cy","angle","ticks","axisLine"],is=["ticks","tick","angle","tickFormatter","stroke"];function De(t){"@babel/helpers - typeof";return De=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},De(t)}function ze(){return ze=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},ze.apply(this,arguments)}function Dt(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function be(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Dt(Object(s),!0).forEach(function(a){rt(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Dt(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Et(t,r){if(t==null)return{};var s=ls(t,r),a,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)a=i[n],!(r.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function ls(t,r){if(t==null)return{};var s={};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){if(r.indexOf(a)>=0)continue;s[a]=t[a]}return s}function cs(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Lt(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,ar(a.key),a)}}function ds(t,r,s){return r&&Lt(t.prototype,r),s&&Lt(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function us(t,r,s){return r=Ge(r),ms(t,rr()?Reflect.construct(r,s||[],Ge(t).constructor):r.apply(t,s))}function ms(t,r){if(r&&(De(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gs(t)}function gs(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function rr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rr=function(){return!!t})()}function Ge(t){return Ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Ge(t)}function xs(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&ft(t,r)}function ft(t,r){return ft=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},ft(t,r)}function rt(t,r,s){return r=ar(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function ar(t){var r=hs(t,"string");return De(r)=="symbol"?r:r+""}function hs(t,r){if(De(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(De(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var at=function(t){function r(){return cs(this,r),us(this,r,arguments)}return xs(r,t),ds(r,[{key:"getTickValueCoord",value:function(a){var n=a.coordinate,i=this.props,o=i.angle,d=i.cx,u=i.cy;return ie(d,u,n,o)}},{key:"getTickTextAnchor",value:function(){var a=this.props.orientation,n;switch(a){case"left":n="end";break;case"right":n="start";break;default:n="middle";break}return n}},{key:"getViewBox",value:function(){var a=this.props,n=a.cx,i=a.cy,o=a.angle,d=a.ticks,u=Xa(d,function(c){return c.coordinate||0}),l=ns(d,function(c){return c.coordinate||0});return{cx:n,cy:i,startAngle:o,endAngle:o,innerRadius:l.coordinate||0,outerRadius:u.coordinate||0}}},{key:"renderAxisLine",value:function(){var a=this.props,n=a.cx,i=a.cy,o=a.angle,d=a.ticks,u=a.axisLine,l=Et(a,os),c=d.reduce(function(f,g){return[Math.min(f[0],g.coordinate),Math.max(f[1],g.coordinate)]},[1/0,-1/0]),m=ie(n,i,c[0],o),h=ie(n,i,c[1],o),x=be(be(be({},G(l,!1)),{},{fill:"none"},G(u,!1)),{},{x1:m.x,y1:m.y,x2:h.x,y2:h.y});return I.createElement("line",ze({className:"recharts-polar-radius-axis-line"},x))}},{key:"renderTicks",value:function(){var a=this,n=this.props,i=n.ticks,o=n.tick,d=n.angle,u=n.tickFormatter,l=n.stroke,c=Et(n,is),m=this.getTickTextAnchor(),h=G(c,!1),x=G(o,!1),f=i.map(function(g,v){var N=a.getTickValueCoord(g),p=be(be(be(be({textAnchor:m,transform:"rotate(".concat(90-d,", ").concat(N.x,", ").concat(N.y,")")},h),{},{stroke:"none",fill:l},x),{},{index:v},N),{},{payload:g});return I.createElement(ae,ze({className:xe("recharts-polar-radius-axis-tick",Xt(o)),key:"tick-".concat(g.coordinate)},wt(a.props,g,v)),r.renderTickItem(o,p,u?u(g.value,v):g.value))});return I.createElement(ae,{className:"recharts-polar-radius-axis-ticks"},f)}},{key:"render",value:function(){var a=this.props,n=a.ticks,i=a.axisLine,o=a.tick;return!n||!n.length?null:I.createElement(ae,{className:xe("recharts-polar-radius-axis",this.props.className)},i&&this.renderAxisLine(),o&&this.renderTicks(),er.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(a,n,i){var o;return I.isValidElement(a)?o=I.cloneElement(a,n):ve(a)?o=a(n):o=I.createElement(jt,ze({},n,{className:"recharts-polar-radius-axis-tick-value"}),i),o}}])}(b.PureComponent);rt(at,"displayName","PolarRadiusAxis");rt(at,"axisType","radiusAxis");rt(at,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Ee(t){"@babel/helpers - typeof";return Ee=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ee(t)}function je(){return je=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},je.apply(this,arguments)}function $t(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function ye(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$t(Object(s),!0).forEach(function(a){st(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$t(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function fs(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Rt(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,nr(a.key),a)}}function ps(t,r,s){return r&&Rt(t.prototype,r),s&&Rt(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function bs(t,r,s){return r=Je(r),ys(t,sr()?Reflect.construct(r,s||[],Je(t).constructor):r.apply(t,s))}function ys(t,r){if(r&&(Ee(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vs(t)}function vs(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sr=function(){return!!t})()}function Je(t){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Je(t)}function js(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&pt(t,r)}function pt(t,r){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},pt(t,r)}function st(t,r,s){return r=nr(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function nr(t){var r=ws(t,"string");return Ee(r)=="symbol"?r:r+""}function ws(t,r){if(Ee(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(Ee(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Ns=Math.PI/180,Bt=1e-5,nt=function(t){function r(){return fs(this,r),bs(this,r,arguments)}return js(r,t),ps(r,[{key:"getTickLineCoord",value:function(a){var n=this.props,i=n.cx,o=n.cy,d=n.radius,u=n.orientation,l=n.tickSize,c=l||8,m=ie(i,o,d,a.coordinate),h=ie(i,o,d+(u==="inner"?-1:1)*c,a.coordinate);return{x1:m.x,y1:m.y,x2:h.x,y2:h.y}}},{key:"getTickTextAnchor",value:function(a){var n=this.props.orientation,i=Math.cos(-a.coordinate*Ns),o;return i>Bt?o=n==="outer"?"start":"end":i<-Bt?o=n==="outer"?"end":"start":o="middle",o}},{key:"renderAxisLine",value:function(){var a=this.props,n=a.cx,i=a.cy,o=a.radius,d=a.axisLine,u=a.axisLineType,l=ye(ye({},G(this.props,!1)),{},{fill:"none"},G(d,!1));if(u==="circle")return I.createElement($r,je({className:"recharts-polar-angle-axis-line"},l,{cx:n,cy:i,r:o}));var c=this.props.ticks,m=c.map(function(h){return ie(n,i,o,h.coordinate)});return I.createElement(Ha,je({className:"recharts-polar-angle-axis-line"},l,{points:m}))}},{key:"renderTicks",value:function(){var a=this,n=this.props,i=n.ticks,o=n.tick,d=n.tickLine,u=n.tickFormatter,l=n.stroke,c=G(this.props,!1),m=G(o,!1),h=ye(ye({},c),{},{fill:"none"},G(d,!1)),x=i.map(function(f,g){var v=a.getTickLineCoord(f),N=a.getTickTextAnchor(f),p=ye(ye(ye({textAnchor:N},c),{},{stroke:"none",fill:l},m),{},{index:g,payload:f,x:v.x2,y:v.y2});return I.createElement(ae,je({className:xe("recharts-polar-angle-axis-tick",Xt(o)),key:"tick-".concat(f.coordinate)},wt(a.props,f,g)),d&&I.createElement("line",je({className:"recharts-polar-angle-axis-tick-line"},h,v)),o&&r.renderTickItem(o,p,u?u(f.value,g):f.value))});return I.createElement(ae,{className:"recharts-polar-angle-axis-ticks"},x)}},{key:"render",value:function(){var a=this.props,n=a.ticks,i=a.radius,o=a.axisLine;return i<=0||!n||!n.length?null:I.createElement(ae,{className:xe("recharts-polar-angle-axis",this.props.className)},o&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(a,n,i){var o;return I.isValidElement(a)?o=I.cloneElement(a,n):ve(a)?o=a(n):o=I.createElement(jt,je({},n,{className:"recharts-polar-angle-axis-tick-value"}),i),o}}])}(b.PureComponent);st(nt,"displayName","PolarAngleAxis");st(nt,"axisType","angleAxis");st(nt,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var He;function Le(t){"@babel/helpers - typeof";return Le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Le(t)}function Me(){return Me=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},Me.apply(this,arguments)}function zt(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function W(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?zt(Object(s),!0).forEach(function(a){re(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):zt(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function ks(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Ft(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,ir(a.key),a)}}function Cs(t,r,s){return r&&Ft(t.prototype,r),s&&Ft(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ss(t,r,s){return r=Ye(r),As(t,or()?Reflect.construct(r,s||[],Ye(t).constructor):r.apply(t,s))}function As(t,r){if(r&&(Le(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ps(t)}function Ps(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function or(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(or=function(){return!!t})()}function Ye(t){return Ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Ye(t)}function _s(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&bt(t,r)}function bt(t,r){return bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},bt(t,r)}function re(t,r,s){return r=ir(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function ir(t){var r=Ms(t,"string");return Le(r)=="symbol"?r:r+""}function Ms(t,r){if(Le(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(Le(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ce=function(t){function r(s){var a;return ks(this,r),a=Ss(this,r,[s]),re(a,"pieRef",null),re(a,"sectorRefs",[]),re(a,"id",Vr("recharts-pie-")),re(a,"handleAnimationEnd",function(){var n=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),ve(n)&&n()}),re(a,"handleAnimationStart",function(){var n=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),ve(n)&&n()}),a.state={isAnimationFinished:!s.isAnimationActive,prevIsAnimationActive:s.isAnimationActive,prevAnimationId:s.animationId,sectorToFocus:0},a}return _s(r,t),Cs(r,[{key:"isActiveIndex",value:function(a){var n=this.props.activeIndex;return Array.isArray(n)?n.indexOf(a)!==-1:a===n}},{key:"hasActiveIndex",value:function(){var a=this.props.activeIndex;return Array.isArray(a)?a.length!==0:a||a===0}},{key:"renderLabels",value:function(a){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.label,d=i.labelLine,u=i.dataKey,l=i.valueKey,c=G(this.props,!1),m=G(o,!1),h=G(d,!1),x=o&&o.offsetRadius||20,f=a.map(function(g,v){var N=(g.startAngle+g.endAngle)/2,p=ie(g.cx,g.cy,g.outerRadius+x,N),y=W(W(W(W({},c),g),{},{stroke:"none"},m),{},{index:v,textAnchor:r.getTextAnchor(p.x,g.cx)},p),k=W(W(W(W({},c),g),{},{fill:"none",stroke:g.fill},h),{},{index:v,points:[ie(g.cx,g.cy,g.outerRadius,N),p]}),S=u;return Te(u)&&Te(l)?S="value":Te(u)&&(S=l),I.createElement(ae,{key:"label-".concat(g.startAngle,"-").concat(g.endAngle,"-").concat(g.midAngle,"-").concat(v)},d&&r.renderLabelLineItem(d,k,"line"),r.renderLabelItem(o,y,Ae(g,S)))});return I.createElement(ae,{className:"recharts-pie-labels"},f)}},{key:"renderSectorsStatically",value:function(a){var n=this,i=this.props,o=i.activeShape,d=i.blendStroke,u=i.inactiveShape;return a.map(function(l,c){if((l==null?void 0:l.startAngle)===0&&(l==null?void 0:l.endAngle)===0&&a.length!==1)return null;var m=n.isActiveIndex(c),h=u&&n.hasActiveIndex()?u:null,x=m?o:h,f=W(W({},l),{},{stroke:d?l.fill:l.stroke,tabIndex:-1});return I.createElement(ae,Me({ref:function(v){v&&!n.sectorRefs.includes(v)&&n.sectorRefs.push(v)},tabIndex:-1,className:"recharts-pie-sector"},wt(n.props,l,c),{key:"sector-".concat(l==null?void 0:l.startAngle,"-").concat(l==null?void 0:l.endAngle,"-").concat(l.midAngle,"-").concat(c)}),I.createElement(Br,Me({option:x,isActive:m,shapeType:"sector"},f)))})}},{key:"renderSectorsWithAnimation",value:function(){var a=this,n=this.props,i=n.sectors,o=n.isAnimationActive,d=n.animationBegin,u=n.animationDuration,l=n.animationEasing,c=n.animationId,m=this.state,h=m.prevSectors,x=m.prevIsAnimationActive;return I.createElement(zr,{begin:d,duration:u,isActive:o,easing:l,from:{t:0},to:{t:1},key:"pie-".concat(c,"-").concat(x),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(f){var g=f.t,v=[],N=i&&i[0],p=N.startAngle;return i.forEach(function(y,k){var S=h&&h[k],R=k>0?Fr(y,"paddingAngle",0):0;if(S){var O=Pt(S.endAngle-S.startAngle,y.endAngle-y.startAngle),C=W(W({},y),{},{startAngle:p+R,endAngle:p+O(g)+R});v.push(C),p=C.endAngle}else{var D=y.endAngle,M=y.startAngle,P=Pt(0,D-M),L=P(g),F=W(W({},y),{},{startAngle:p+R,endAngle:p+L+R});v.push(F),p=F.endAngle}}),I.createElement(ae,null,a.renderSectorsStatically(v))})}},{key:"attachKeyboardHandlers",value:function(a){var n=this;a.onkeydown=function(i){if(!i.altKey)switch(i.key){case"ArrowLeft":{var o=++n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[o].focus(),n.setState({sectorToFocus:o});break}case"ArrowRight":{var d=--n.state.sectorToFocus<0?n.sectorRefs.length-1:n.state.sectorToFocus%n.sectorRefs.length;n.sectorRefs[d].focus(),n.setState({sectorToFocus:d});break}case"Escape":{n.sectorRefs[n.state.sectorToFocus].blur(),n.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var a=this.props,n=a.sectors,i=a.isAnimationActive,o=this.state.prevSectors;return i&&n&&n.length&&(!o||!Ir(o,n))?this.renderSectorsWithAnimation():this.renderSectorsStatically(n)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var a=this,n=this.props,i=n.hide,o=n.sectors,d=n.className,u=n.label,l=n.cx,c=n.cy,m=n.innerRadius,h=n.outerRadius,x=n.isAnimationActive,f=this.state.isAnimationFinished;if(i||!o||!o.length||!Pe(l)||!Pe(c)||!Pe(m)||!Pe(h))return null;var g=xe("recharts-pie",d);return I.createElement(ae,{tabIndex:this.props.rootTabIndex,className:g,ref:function(N){a.pieRef=N}},this.renderSectors(),u&&this.renderLabels(o),er.renderCallByParent(this.props,null,!1),(!x||f)&&Kr.renderCallByParent(this.props,o,!1))}}],[{key:"getDerivedStateFromProps",value:function(a,n){return n.prevIsAnimationActive!==a.isAnimationActive?{prevIsAnimationActive:a.isAnimationActive,prevAnimationId:a.animationId,curSectors:a.sectors,prevSectors:[],isAnimationFinished:!0}:a.isAnimationActive&&a.animationId!==n.prevAnimationId?{prevAnimationId:a.animationId,curSectors:a.sectors,prevSectors:n.curSectors,isAnimationFinished:!0}:a.sectors!==n.curSectors?{curSectors:a.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(a,n){return a>n?"start":a<n?"end":"middle"}},{key:"renderLabelLineItem",value:function(a,n,i){if(I.isValidElement(a))return I.cloneElement(a,n);if(ve(a))return a(n);var o=xe("recharts-pie-label-line",typeof a!="boolean"?a.className:"");return I.createElement(Rr,Me({},n,{key:i,type:"linear",className:o}))}},{key:"renderLabelItem",value:function(a,n,i){if(I.isValidElement(a))return I.cloneElement(a,n);var o=i;if(ve(a)&&(o=a(n),I.isValidElement(o)))return o;var d=xe("recharts-pie-label-text",typeof a!="boolean"&&!ve(a)?a.className:"");return I.createElement(jt,Me({},n,{alignmentBaseline:"middle",className:d}),o)}}])}(b.PureComponent);He=ce;re(ce,"displayName","Pie");re(ce,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!qr.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});re(ce,"parseDeltaAngle",function(t,r){var s=We(r-t),a=Math.min(Math.abs(r-t),360);return s*a});re(ce,"getRealPieData",function(t){var r=t.data,s=t.children,a=G(t,!1),n=Ur(s,tr);return r&&r.length?r.map(function(i,o){return W(W(W({payload:i},a),i),n&&n[o]&&n[o].props)}):n&&n.length?n.map(function(i){return W(W({},a),i.props)}):[]});re(ce,"parseCoordinateOfPie",function(t,r){var s=r.top,a=r.left,n=r.width,i=r.height,o=Wr(n,i),d=a+Ke(t.cx,n,n/2),u=s+Ke(t.cy,i,i/2),l=Ke(t.innerRadius,o,0),c=Ke(t.outerRadius,o,o*.8),m=t.maxRadius||Math.sqrt(n*n+i*i)/2;return{cx:d,cy:u,innerRadius:l,outerRadius:c,maxRadius:m}});re(ce,"getComposedData",function(t){var r=t.item,s=t.offset,a=r.type.defaultProps!==void 0?W(W({},r.type.defaultProps),r.props):r.props,n=He.getRealPieData(a);if(!n||!n.length)return null;var i=a.cornerRadius,o=a.startAngle,d=a.endAngle,u=a.paddingAngle,l=a.dataKey,c=a.nameKey,m=a.valueKey,h=a.tooltipType,x=Math.abs(a.minAngle),f=He.parseCoordinateOfPie(a,s),g=He.parseDeltaAngle(o,d),v=Math.abs(g),N=l;Te(l)&&Te(m)?(_t(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),N="value"):Te(l)&&(_t(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),N=m);var p=n.filter(function(C){return Ae(C,N,0)!==0}).length,y=(v>=360?p:p-1)*u,k=v-p*x-y,S=n.reduce(function(C,D){var M=Ae(D,N,0);return C+(Pe(M)?M:0)},0),R;if(S>0){var O;R=n.map(function(C,D){var M=Ae(C,N,0),P=Ae(C,c,D),L=(Pe(M)?M:0)/S,F;D?F=O.endAngle+We(g)*u*(M!==0?1:0):F=o;var z=F+We(g)*((M!==0?x:0)+L*k),j=(F+z)/2,A=(f.innerRadius+f.outerRadius)/2,$=[{name:P,value:M,payload:C,dataKey:N,type:h}],V=ie(f.cx,f.cy,A,j);return O=W(W(W({percent:L,cornerRadius:i,name:P,tooltipPayload:$,midAngle:j,middleRadius:A,tooltipPosition:V},C),f),{},{value:Ae(C,N),startAngle:F,endAngle:z,payload:C,paddingAngle:We(g)*u}),O})}return W(W({},f),{},{sectors:R,data:n})});var Ts=Hr({chartName:"PieChart",GraphicalChild:ce,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:nt},{axisType:"radiusAxis",AxisComp:at}],formatAxisMap:Qr,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const it=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#6b7280"];function Os({allocations:t,totalBudget:r,totalAllocated:s,compact:a=!1,className:n}){const{t:i}=K("common"),{currency:o}=Z(),{isPrivacyMode:d}=te(),{data:u}=X(),[l,c]=b.useState(null),m=p=>Y(p,o,(u==null?void 0:u.rates)||{},!1,d),h=b.useMemo(()=>{if(!t.length)return[];const p=[...t].sort((O,C)=>C.amount-O.amount),y=p.slice(0,5),S=p.slice(5).reduce((O,C)=>O+C.amount,0),R=y.map((O,C)=>({name:O.category,value:O.amount,percentage:s>0?O.amount/s*100:0,color:it[C%it.length]}));return S>0&&R.push({name:i("budget.donutChart.other"),value:S,percentage:s>0?S/s*100:0,color:it[7]}),R},[t,s,i]),x=r-s,f=p=>{const{cx:y,cy:k,innerRadius:S,outerRadius:R,startAngle:O,endAngle:C,fill:D,payload:M}=p;return e.jsxs("g",{children:[e.jsx(Jr,{cx:y,cy:k,innerRadius:S-2,outerRadius:R+4,startAngle:O,endAngle:C,fill:D}),e.jsx("text",{x:y,y:k-6,textAnchor:"middle",className:"fill-gray-500 dark:fill-gray-400 text-[10px]",children:M.name}),e.jsx("text",{x:y,y:k+10,textAnchor:"middle",className:"fill-gray-900 dark:fill-gray-100 text-xs font-bold",children:m(M.value)})]})};if(!t.length)return null;const g=a?120:200,v=a?36:55,N=a?52:80;return e.jsxs("div",{className:w(a?"flex items-center gap-4":"flex flex-col items-center",n),children:[e.jsxs("div",{className:"relative flex-shrink-0",style:{width:g,height:g},children:[e.jsx(Gr,{width:"100%",height:"100%",children:e.jsx(Ts,{children:e.jsx(ce,{data:h,cx:"50%",cy:"50%",innerRadius:v,outerRadius:N,paddingAngle:2,dataKey:"value",activeIndex:l??void 0,activeShape:l!==null?f:void 0,onMouseEnter:(p,y)=>c(y),onMouseLeave:()=>c(null),children:h.map((p,y)=>e.jsx(tr,{fill:p.color,className:"cursor-pointer transition-opacity hover:opacity-80"},`cell-${y}`))})})}),l===null&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("span",{className:w("text-gray-500 dark:text-gray-400",a?"text-[9px]":"text-xs"),children:x>=0?i("budget.donutChart.remaining"):i("budget.overAllocated")}),e.jsx("span",{className:w("font-bold",a?"text-xs":"text-lg",x>=0?"text-gray-900 dark:text-gray-100":"text-red-600 dark:text-red-400"),children:x>=0?m(x):`âˆ’${m(Math.abs(x))}`})]})]}),e.jsx("div",{className:w("grid gap-y-1 gap-x-4",a?"grid-cols-1 flex-1 min-w-0":"grid-cols-2 mt-4 w-full max-w-xs"),children:h.map((p,y)=>e.jsxs("button",{className:w("flex items-center gap-2 text-left p-1 rounded transition-colors min-w-0",l===y&&"bg-gray-100 dark:bg-gray-800"),onMouseEnter:()=>c(y),onMouseLeave:()=>c(null),onFocus:()=>c(y),onBlur:()=>c(null),children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:p.color},"aria-hidden":"true"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:p.name}),e.jsxs("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 ml-auto flex-shrink-0",children:[Math.round(p.percentage),"%"]})]},y))})]})}function Ds({categories:t,daysRemaining:r,onViewCategory:s,className:a}){const{t:n}=K("common"),{currency:i}=Z(),{isPrivacyMode:o}=te(),{data:d}=X(),[u,l]=b.useState(new Set),c=g=>Y(g,i,(d==null?void 0:d.rates)||{},!1,o),x=(()=>{const g=[],v=t.filter(k=>k.status==="red"),N=t.filter(k=>k.status==="orange"),p=t.filter(k=>k.status==="green"||k.status==="yellow");v.slice(0,2).forEach(k=>{const S=Math.abs(k.remaining);g.push({type:"exceeded",category:k.category,message:n("budget.alerts.exceededBy",{category:k.category,amount:c(S)}),action:n("budget.alerts.cutToStay",{category:k.category,amount:c(S)})})});const y=v.length>0?1:2;return N.slice(0,y).forEach(k=>{const S=r>0?k.remaining/r:0;g.push({type:"warning",category:k.category,message:n("budget.alerts.approaching",{category:k.category,amount:c(k.remaining),days:r}),action:r>0?n("budget.alerts.reduceDaily",{category:k.category,amount:c(S)}):void 0})}),v.length===0&&N.length===0&&p.length>0&&g.push({type:"onTrack",message:n("budget.alerts.allOnTrack",{count:p.length})}),g})().filter(g=>!u.has(g.category||"onTrack"));if(x.length===0)return null;const f=g=>{switch(g){case"exceeded":return{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-400",icon:Qt};case"warning":return{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",text:"text-amber-700 dark:text-amber-400",icon:le};case"onTrack":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-400",icon:Oe}}};return e.jsx("div",{className:w("space-y-2",a),children:x.slice(0,2).map((g,v)=>{const N=f(g.type),p=N.icon;return e.jsxs("div",{className:w("flex items-start gap-3 p-3 rounded-lg border",N.bg,N.border),role:"alert",children:[e.jsx(p,{className:w("w-5 h-5 flex-shrink-0 mt-0.5",N.text),"aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:w("text-sm font-medium",N.text),children:g.message}),g.action&&e.jsx("p",{className:w("text-xs mt-0.5 opacity-80",N.text),children:g.action})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[g.category&&s&&e.jsx("button",{onClick:()=>s(g.category),className:w("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5",N.text),"aria-label":n("viewDetails"),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const y=g.category||"onTrack";l(k=>new Set([...k,y]))},className:w("p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/5",N.text),"aria-label":n("button.close"),children:e.jsx(ke,{className:"w-4 h-4"})})]})]},g.category||`alert-${v}`)})})}function lr({amount:t,transactions:r,month:s,className:a,aiState:n="idle",onAiCategorize:i}){const{t:o}=K("common"),d=vt(),{currency:u}=Z(),{isPrivacyMode:l}=te(),{data:c}=X(),[m,h]=b.useState(!1),x=p=>Y(p,u,(c==null?void 0:c.rates)||{},!1,l);if(m||t<=0)return null;const f=(r==null?void 0:r.length)||0,g=n==="loading",v=n==="success",N=()=>{d({to:"/transactions",search:{month:s||void 0}})};return e.jsxs("div",{className:w("flex items-start gap-3 p-3 rounded-xl border transition-all duration-300 ease-out",g&&"animate-shimmer",v?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",a),role:"alert",children:[v?e.jsx(hr,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5 animate-success-pop","aria-hidden":"true"}):e.jsx(le,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:w("text-sm font-medium transition-colors duration-300",v?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"),children:v?o("budget.uncategorized.aiSuccess","Categories suggested!"):o("budget.uncategorized.title")}),e.jsx("p",{className:w("text-xs mt-0.5 transition-colors duration-300",v?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"),children:g?o("budget.uncategorized.aiProcessing","Analyzing transactions..."):v?o("budget.uncategorized.aiSuccessDescription","Review and apply the suggested categories below"):o("budget.uncategorized.description",{amount:x(t),count:f})}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[i&&!v&&e.jsxs(U,{variant:"ghost",size:"sm",onClick:i,disabled:g,className:w("h-7 px-2.5 text-xs font-medium","bg-purple-50 dark:bg-purple-900/30","text-purple-700 dark:text-purple-300","hover:bg-purple-100 dark:hover:bg-purple-800/40","border border-purple-200 dark:border-purple-700","disabled:opacity-60"),children:[g?e.jsx(Qe,{className:"w-3.5 h-3.5 mr-1 animate-spin"}):e.jsx(Ze,{className:"w-3.5 h-3.5 mr-1"}),g?o("budget.uncategorized.aiProcessingBtn","Analyzing..."):o("budget.uncategorized.aiCategorizeCta","AI Categorize")]}),!g&&!v&&e.jsxs(U,{variant:"ghost",size:"sm",onClick:N,className:"h-7 px-2 text-xs font-medium text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-800/40",children:[o("budget.uncategorized.reviewCta"),e.jsx(mt,{className:"w-3.5 h-3.5 ml-1"})]})]})]}),e.jsx("button",{onClick:()=>h(!0),className:w("p-1.5 rounded-full transition-colors duration-200",v?"hover:bg-green-100 dark:hover:bg-green-800/40 text-green-500":"hover:bg-amber-100 dark:hover:bg-amber-800/40 text-amber-500"),"aria-label":o("button.close"),children:e.jsx(ke,{className:"w-4 h-4"})})]})}function Es({confidence:t}){const{t:r}=K("common"),s=Math.round(t*100),a=t>=.8?"success":t>=.6?"warning":"error";return e.jsxs(gt,{variant:a,className:"text-[10px] px-1.5 py-0.5",children:[s,"% ",r("ai.confidence")]})}function Ls({suggestion:t,isSelected:r,editedCategory:s,categories:a,categoryMatchesBudget:n,onToggle:i,onCategoryChange:o}){const{currency:d}=Z(),{data:u}=X(),{t:l}=K("common");return e.jsxs("div",{className:w("group flex items-center gap-3 p-3 rounded-xl border transition-all duration-200","cursor-pointer select-none",r?"border-primary-500 bg-primary-50/60 dark:bg-primary-900/20 shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800/50"),onClick:()=>i(t.transaction_id),role:"checkbox","aria-checked":r,tabIndex:0,onKeyDown:c=>{(c.key===" "||c.key==="Enter")&&(c.preventDefault(),i(t.transaction_id))},children:[e.jsx("div",{className:w("flex-shrink-0 w-5 h-5 rounded-md border-2 flex items-center justify-center transition-all duration-200",r?"bg-primary-500 border-primary-500 text-white":"border-gray-300 dark:border-gray-600 group-hover:border-primary-400"),children:r&&e.jsx(Xe,{className:"w-3.5 h-3.5",strokeWidth:3})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:t.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:Ue(Math.abs(t.amount),d,(u==null?void 0:u.rates)||{},!1)})]}),e.jsx(Es,{confidence:t.confidence})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 flex-shrink-0",children:t.current_category}),e.jsx("span",{className:"text-xs text-gray-400","aria-hidden":"true",children:"â†’"}),e.jsxs("div",{className:"relative flex-1 max-w-[180px]",children:[e.jsx("select",{value:s,onChange:c=>{c.stopPropagation(),o(t.transaction_id,c.target.value)},onClick:c=>c.stopPropagation(),className:w("w-full text-xs py-1 pl-2 pr-7 rounded-lg border appearance-none","focus:outline-none focus:ring-2 focus:border-transparent transition-colors duration-150",n?"bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-200 border-green-300 dark:border-green-700 focus:ring-green-500":"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-200 dark:border-gray-600 focus:ring-primary-500"),"aria-label":l("budget.aiCategorize.selectCategory"),children:a.map(c=>e.jsx("option",{value:c.value,children:c.matchesBudget?`${c.label}`:c.label},c.value))}),e.jsx(Jt,{className:w("absolute right-2 top-1/2 -translate-y-1/2 w-3 h-3 pointer-events-none",n?"text-green-500":"text-gray-400")})]}),n&&e.jsx(gt,{variant:"success",className:"text-[10px] px-1.5 py-0.5",children:l("budget.aiCategorize.budgetMatch","Budget")}),t.is_new_category&&!n&&e.jsx(gt,{variant:"info",className:"text-[10px] px-1.5 py-0.5",children:l("ai.newCategory")})]})]})]})}function $s({createRules:t,onCreateRulesChange:r,selectedCount:s,noneSelected:a,isApplying:n,applyError:i,onApply:o,onClose:d}){const{t:u}=K("common");return e.jsxs("div",{className:w("mt-4 pt-4 border-t border-gray-200 dark:border-gray-700","flex flex-col gap-3"),children:[e.jsxs("label",{className:"flex items-center justify-between gap-3 cursor-pointer",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:u("ai.createRulesAuto")}),e.jsx(Zr,{checked:t,onChange:r})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(U,{variant:"outline",size:"sm",onClick:d,disabled:n,children:u("cancel")}),e.jsxs(U,{size:"sm",onClick:o,disabled:a||n,loading:n,children:[e.jsx(Ze,{className:"w-4 h-4"}),u("budget.aiCategorize.apply",{count:s})]})]}),i&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-right",children:u("ai.applyError")})]})}function Rs(){return e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((t,r)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(Re,{className:"w-5 h-5 rounded-md"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Re,{className:"w-36 h-4"}),e.jsx(Re,{className:"w-14 h-5 rounded-full"})]}),e.jsx(Re,{className:"w-20 h-3"}),e.jsx(Re,{className:"w-28 h-6 rounded-lg"})]})]},r))})}function Bs(t){if(!t)return[];const r=[];for(const s of t.expense){r.push(s.name);for(const a of s.children)r.push(a.name)}return r}function zs(t){if(!t)return{};const r={};for(const s of t.expense)r[s.name]=s.children.map(a=>a.name);return r}function It(t,r,s){const a=t.toLowerCase();for(const n of r){if(n.toLowerCase()===a)return!0;const i=s[n];if(i!=null&&i.some(o=>o.toLowerCase()===a))return!0}return!1}function Fs(t,r,s,a,n){const{t:i,i18n:o}=K("common"),d=et(),{data:u}=tt(),[l,c]=b.useState(null),[m,h]=b.useState(new Map),[x,f]=b.useState(new Map),[g,v]=b.useState(!0),N=b.useMemo(()=>zs(u),[u]),p=b.useMemo(()=>new Set(s.map(j=>j.toLowerCase())),[s]),y=b.useMemo(()=>{const j=new Set(s);return Bs(u).forEach(A=>j.add(A)),l==null||l.new_categories_suggested.forEach(A=>j.add(A)),Array.from(j).sort((A,$)=>{const V=p.has(A.toLowerCase())?0:1,_=p.has($.toLowerCase())?0:1;return V!==_?V-_:A.localeCompare($)}).map(A=>({value:A,label:A,matchesBudget:It(A,s,N)}))},[s,p,l,u,N]),k=ge({mutationFn:()=>Xr(r,50,o.language),onSuccess:j=>{c(j);const A=new Map,$=new Map;j.suggestions.forEach(V=>{$.set(V.transaction_id,V.suggested_category),V.confidence>=.7&&A.set(V.transaction_id,V.suggested_category)}),h(A),f($)}}),S=ge({mutationFn:()=>ea({approved:Array.from(m.entries()).map(([j,A])=>({transaction_id:j,category:A})),create_rules:g}),onSuccess:()=>{d.invalidateQueries({queryKey:["budget","tracking"]}),d.invalidateQueries({queryKey:["transactions"]}),fr.success(i("ai.applySuccess")),a(),n()}});b.useEffect(()=>{t&&(c(null),h(new Map),f(new Map),v(!0),k.mutate())},[t]);const R=b.useCallback(j=>{h(A=>{const $=new Map(A);return $.has(j)?$.delete(j):$.set(j,x.get(j)||""),$})},[x]),O=b.useCallback((j,A)=>{f($=>new Map($).set(j,A)),h($=>$.has(j)?new Map($).set(j,A):$)},[]),C=b.useCallback(()=>{if(!l)return;const j=new Map;l.suggestions.forEach(A=>j.set(A.transaction_id,x.get(A.transaction_id)||A.suggested_category)),h(j)},[l,x]),D=b.useCallback(()=>h(new Map),[]),M=b.useMemo(()=>l?[...l.suggestions].sort((j,A)=>A.confidence-j.confidence):[],[l]),P=l?m.size===l.suggestions.length:!1,L=b.useCallback(()=>{S.isPending||n()},[S.isPending,n]);return{suggestions:l,selectedItems:m,editedCategories:x,createRules:g,setCreateRules:v,categoryOptions:y,fetchMutation:k,applyMutation:S,sortedSuggestions:M,allSelected:P,handleToggle:R,handleCategoryChange:O,handleSelectAll:C,handleDeselectAll:D,handleClose:L,getEditedCategory:(j,A)=>x.get(j)||A,checkBudgetMatch:j=>It(j,s,N)}}function Is({open:t,onClose:r,month:s,budgetCategories:a,onSuccess:n}){const{t:i}=K("common"),{suggestions:o,categoryOptions:d,fetchMutation:u,applyMutation:l,sortedSuggestions:c,allSelected:m,selectedItems:h,createRules:x,setCreateRules:f,handleToggle:g,handleCategoryChange:v,handleSelectAll:N,handleDeselectAll:p,handleClose:y,getEditedCategory:k,checkBudgetMatch:S}=Fs(t,s,a,n,r);return e.jsxs(Yr,{isOpen:t,onClose:y,title:i("budget.aiCategorize.title"),size:"lg",children:[u.isPending&&e.jsx(Rs,{}),u.isError&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:i("ai.analyzeError")}),e.jsx(U,{variant:"outline",onClick:()=>u.mutate(),children:i("budget.aiCategorize.retry")})]}),o&&o.suggestions.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ze,{className:"w-10 h-10 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("ai.noSuggestions")})]}),o&&o.suggestions.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("budget.aiCategorize.summary",{shown:o.suggestions.length,total:o.total_other_count})}),e.jsxs("button",{onClick:m?p:N,className:"flex items-center gap-1.5 text-xs font-medium text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors",children:[m?e.jsx(aa,{className:"w-3.5 h-3.5"}):e.jsx(sa,{className:"w-3.5 h-3.5"}),i(m?"ai.deselectAll":"ai.selectAll")]})]}),e.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto -mx-1 px-1 pb-1",children:c.map(R=>{const O=k(R.transaction_id,R.suggested_category);return e.jsx(Ls,{suggestion:R,isSelected:h.has(R.transaction_id),editedCategory:O,categories:d,categoryMatchesBudget:S(O),onToggle:g,onCategoryChange:v},R.transaction_id)})}),e.jsx($s,{createRules:x,onCreateRulesChange:f,selectedCount:h.size,noneSelected:h.size===0,isApplying:l.isPending,applyError:l.isError,onApply:()=>l.mutate(),onClose:y})]})]})}function Ks({tracking:t,className:r}){const{t:s}=K("common"),a=b.useMemo(()=>{const o=t.uncategorized_spending||0,d=t.total_spent+o;return d<=0?100:Math.round(t.total_spent/d*100)},[t]),n=(t.uncategorized_spending||0)>0,i=a>=90;return n?e.jsxs("div",{className:w("flex items-center gap-2 px-3 py-2 rounded-lg",r),children:[i?e.jsx(ka,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(wa,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500",i?"bg-green-500":"bg-amber-500"),style:{width:`${a}%`}})}),e.jsxs("span",{className:w("text-xs font-semibold tabular-nums flex-shrink-0",i?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"),children:[a,"%"]})]}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-0.5",children:s("budget.coverage.label")})]})]}):null}function Vs(t,r,s,a){const{category:n,budgeted:i,spent:o}=t,d=Math.max(1,s),u=o/d,l=i-o,c=r>0?l/r:0,m=o+u*r,h=Math.max(0,m-i);let x;s>=15?x="high":s>=7?x="medium":x="low";const f=i>0?m/i*100:0;let g;return f>100?g="danger":f>85?g="warning":g="safe",{category:n,predictedTotal:m,budgetAmount:i,exceededBy:h,confidence:x,status:g,dailyPace:u,safeDailyPace:c,anomalyDetected:!1,anomalyDescription:void 0,daysRemaining:r,daysElapsed:s}}function qs(t,r,s){const{days_remaining:a}=r,i=30-a;return r.categories.map(o=>Vs(o,a,i)).filter(o=>o.status!=="safe"||o.anomalyDetected).sort((o,d)=>{const u={danger:0,warning:1,safe:2};return u[o.status]!==u[d.status]?u[o.status]-u[d.status]:d.exceededBy-o.exceededBy})}function cr(t){const r=t.total_spent,s=t.total_budgeted,a=t.days_remaining,i=Math.max(1,30-a),o=r/i,d=r+o*a,u=s>0?d/s*100:0;let l;return u>100?l="danger":u>85?l="warning":l="safe",{totalPredicted:d,totalBudget:s,overallStatus:l,overallPercent:u}}function Us({budget:t,tracking:r,previousMonthData:s,selectedMonth:a,onViewCategory:n}){const{t:i}=K("common"),o=et(),{currency:d}=Z(),{isPrivacyMode:u}=te(),{data:l}=X(),c=O=>Y(O,d,(l==null?void 0:l.rates)||{},!1,u),m=t.allocations.reduce((O,C)=>O+C.amount,0),h=t.monthly_income-(t.savings_target||0),x=(r==null?void 0:r.total_spent)||0,[f,g]=b.useState("idle"),[v,N]=b.useState(!1),p=b.useMemo(()=>t.allocations.map(O=>O.category),[t.allocations]),y=b.useCallback(()=>{N(!0)},[]),k=b.useCallback(()=>{g("success"),o.invalidateQueries({queryKey:["budget","tracking"]}),o.invalidateQueries({queryKey:["budget","month"]})},[o]),S=b.useMemo(()=>r?cr(r):null,[r]),R=()=>{const O=new URL(window.location.href);O.searchParams.set("tab","forecast"),window.history.pushState({},"",O.toString()),window.dispatchEvent(new PopStateEvent("popstate"))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx($a,{totalBudget:h,totalSpent:x,totalAllocated:m,month:a}),S&&e.jsxs("button",{onClick:R,className:w("w-full flex items-center gap-3 p-3 rounded-xl border text-left transition-colors",S.overallStatus==="danger"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":S.overallStatus==="warning"?"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30"),children:[S.overallStatus==="danger"?e.jsx(le,{className:"w-5 h-5 text-red-500 flex-shrink-0"}):S.overallStatus==="warning"?e.jsx(Ne,{className:"w-5 h-5 text-amber-500 flex-shrink-0"}):e.jsx(Oe,{className:"w-5 h-5 text-green-500 flex-shrink-0"}),e.jsx("p",{className:w("flex-1 text-sm font-medium",S.overallStatus==="danger"?"text-red-700 dark:text-red-300":S.overallStatus==="warning"?"text-amber-700 dark:text-amber-300":"text-green-700 dark:text-green-300"),children:S.overallStatus==="danger"?i("budget.forecastAlert.exceedBy",{amount:c(S.totalPredicted-S.totalBudget)}):S.overallStatus==="warning"?i("budget.forecastAlert.nearLimit",{percent:Math.round(S.overallPercent)}):i("budget.forecastAlert.onTrackSave",{amount:c(S.totalBudget-S.totalPredicted)})}),e.jsxs("span",{className:w("text-xs font-medium flex items-center gap-0.5 flex-shrink-0",S.overallStatus==="danger"?"text-red-500 dark:text-red-400":S.overallStatus==="warning"?"text-amber-500 dark:text-amber-400":"text-green-500 dark:text-green-400"),children:[i("budget.forecastAlert.seeDetails"),e.jsx(oe,{className:"w-3.5 h-3.5"})]})]}),(r==null?void 0:r.uncategorized_spending)!=null&&r.uncategorized_spending>0&&e.jsx(lr,{amount:r.uncategorized_spending,transactions:r.uncategorized_transactions,month:a,aiState:f,onAiCategorize:y}),e.jsx(Is,{open:v,onClose:()=>N(!1),month:a,budgetCategories:p,onSuccess:k}),r&&e.jsx(Ks,{tracking:r}),r&&r.categories&&r.categories.length>0&&e.jsx(Ds,{categories:r.categories,daysRemaining:r.days_remaining,onViewCategory:n}),e.jsx(Ra,{income:t.monthly_income,allocated:m,savings:t.savings_target||0,formatCurrency:c}),t.allocations.length>0&&e.jsxs(J,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:i("budget.donutChart.title")}),e.jsx(Os,{allocations:t.allocations,totalBudget:h,totalAllocated:m,compact:!0})]})]})}function dr(t){return t>=95?"exceeded":t>=80?"warning":"on_track"}const Ws={on_track:{icon:Oe,bgColor:"bg-green-100 dark:bg-green-900/30",iconColor:"text-green-600 dark:text-green-400",label:"On Track",ariaLabel:"Budget on track"},warning:{icon:le,bgColor:"bg-yellow-100 dark:bg-yellow-900/30",iconColor:"text-yellow-600 dark:text-yellow-400",label:"Warning",ariaLabel:"Budget warning - approaching limit"},exceeded:{icon:Qt,bgColor:"bg-red-100 dark:bg-red-900/30",iconColor:"text-red-600 dark:text-red-400",label:"Exceeded",ariaLabel:"Budget exceeded"}};function ur({status:t,className:r}){const s=Ws[t],a=s.icon;return e.jsx("div",{className:w("flex-shrink-0",r),role:"status","aria-label":s.ariaLabel,children:e.jsx(a,{className:w("w-3.5 h-3.5",s.iconColor),"aria-hidden":"true"})})}function Hs({allocations:t,trackingItems:r,selectedCategory:s,onSelectCategory:a,isDraft:n,onAddCategory:i,className:o}){const{t:d}=K("common"),{currency:u}=Z(),{isPrivacyMode:l}=te(),{data:c}=X(),m=b.useRef(null),h=b.useRef([]),[x,f]=b.useState(()=>{const p=t.findIndex(y=>y.category===s);return p>=0?p:0});b.useEffect(()=>{const p=t.findIndex(y=>y.category===s);p>=0&&f(p)},[s,t]),b.useEffect(()=>{const p=h.current[x];p==null||p.scrollIntoView({block:"nearest",behavior:"smooth"})},[x]);const g=p=>Y(p,u,(c==null?void 0:c.rates)||{},!0,l),v=p=>r==null?void 0:r.find(y=>y.category===p),N=p=>{if(t.length!==0)switch(p.key){case"ArrowDown":p.preventDefault(),f(y=>y<t.length-1?y+1:0);break;case"ArrowUp":p.preventDefault(),f(y=>y>0?y-1:t.length-1);break;case"Home":p.preventDefault(),f(0);break;case"End":p.preventDefault(),f(t.length-1);break;case"Enter":case" ":p.preventDefault(),a(t[x].category);break}};return e.jsxs("div",{className:w("flex flex-col h-full",o),children:[n&&i&&e.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs(U,{variant:"outline",size:"sm",onClick:i,className:"w-full",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),d("budget.addCategory")]})}),e.jsxs("div",{ref:m,className:"flex-1 overflow-y-auto scrollbar-hide focus:outline-none",role:"listbox",tabIndex:0,"aria-label":d("budget.allocations"),"aria-activedescendant":t.length>0?`category-${x}`:void 0,onKeyDown:N,children:[t.map((p,y)=>{const k=v(p.category),S=(k==null?void 0:k.percentage)||0,R=(k==null?void 0:k.spent)||0,O=dr(S),C=s===p.category,D=x===y;return e.jsxs("button",{ref:M=>{h.current[y]=M},id:`category-${y}`,role:"option","aria-selected":C,tabIndex:-1,onClick:()=>{f(y),a(p.category)},className:w("w-full flex items-center justify-between px-4 py-3","text-left transition-all","hover:bg-gray-50 dark:hover:bg-gray-800",D&&"ring-2 ring-inset ring-primary-500",C&&"bg-primary-50 dark:bg-primary-900/20 border-l-3 border-primary-500"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:p.category}),e.jsx(ur,{status:O})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g(R)," / ",g(p.amount)]}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:[Math.round(S),"%"]})]})]}),e.jsx(oe,{className:w("w-4 h-4 text-gray-400 flex-shrink-0 transition-transform",C&&"text-green-500")})]},p.category)}),t.length===0&&e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:d("budget.noAllocations")})]})]})}function Kt(t,r,s){if(r==="JPY")return t;const a=s[r];return!a||a===0?t:Math.round(t/a)}function Vt({category:t,month:r,trackingItem:s,isOpen:a,onClose:n,mode:i="overlay",className:o}){const{t:d}=K("common"),u=vt(),{currency:l}=Z(),{isPrivacyMode:c}=te(),{data:m}=X(),{data:h}=tt(),[x,f]=b.useState([]),[g,v]=b.useState(!1),[N,p]=b.useState(null),[y,k]=b.useState(null),S=j=>Y(j,l,(m==null?void 0:m.rates)||{},!0,c),R=(j,A)=>Y(j,A||l,(m==null?void 0:m.rates)||{},!0,c),O=b.useMemo(()=>{const j=new Map;return h&&(h.expense.forEach(A=>{const $=A.children.map(V=>V.name);j.set(A.name,$)}),h.income.forEach(A=>{const $=A.children.map(V=>V.name);j.set(A.name,$)})),j},[h]),C=b.useMemo(()=>{const j=O.get(t)||[];return[t,...j]},[t,O]),D=b.useMemo(()=>{if(!h)return null;for(const j of[...h.expense,...h.income])if(j.children.some(A=>A.name===t))return j.name;return null},[t,h]);b.useEffect(()=>{if(!a)return;let j=!0;async function A(){v(!0),p(null);try{const[$,V]=r.split("-").map(Number),_=new Date($,V,0).getDate(),B=`${$}-${String(V).padStart(2,"0")}-01`,q=`${$}-${String(V).padStart(2,"0")}-${String(_).padStart(2,"0")}`,Q=await xt({categories:C,start_date:B,end_date:q,type:"expense"});if(j){const de=(m==null?void 0:m.rates)||{},ne=Q.filter(E=>!E.is_transfer).map(E=>({...E,amountJpy:Kt(Math.abs(E.amount),E.currency||"JPY",de)})).sort((E,se)=>se.amountJpy-E.amountJpy);f(ne.slice(0,10).map(({amountJpy:E,...se})=>se))}}catch{j&&p("Failed to load transactions")}finally{j&&v(!1)}}return A(),()=>{j=!1}},[t,r,a,C]),b.useEffect(()=>{if(!a)return;let j=!0;async function A(){try{const[$,V]=r.split("-").map(Number);let _=$,B=V-1;B<1&&(B=12,_-=1);const[q,Q]=[_,B],de=new Date(q,Q,0).getDate(),fe=`${q}-${String(Q).padStart(2,"0")}-01`,ne=`${q}-${String(Q).padStart(2,"0")}-${String(de).padStart(2,"0")}`,E=await xt({categories:C,start_date:fe,end_date:ne,type:"expense"});if(j){const se=(m==null?void 0:m.rates)||{},Fe=E.filter($e=>!$e.is_transfer).reduce(($e,Ie)=>{const T=Kt(Math.abs(Ie.amount),Ie.currency||"JPY",se);return $e+T},0);k(Fe)}}catch{}}return A(),()=>{j=!1}},[t,r,a,C]),b.useEffect(()=>{if(i!=="overlay"||!a)return;const j=A=>{A.key==="Escape"&&n()};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[a,i,n]);const M=j=>Gt(j,"MMM d"),P=()=>{n(),u({to:"/transactions",search:{categories:t,month:r}})},L=()=>{n()},F=(s==null?void 0:s.spent)||0,z=y?Math.round((F-y)/y*100):null;return a?i==="inline"?e.jsxs("div",{className:w("flex flex-col h-full",o),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("nav",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:d("budget.title","Budget")}),e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:d("budget.categories","Categories")}),D&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:D})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S((s==null?void 0:s.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S(F)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500",(s==null?void 0:s.status)==="red"?"bg-red-500":(s==null?void 0:s.status)==="orange"?"bg-orange-500":(s==null?void 0:s.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(s==null?void 0:s.percentage)||0)}%`}})}),z!==null&&e.jsxs("div",{className:w("flex items-center gap-2 text-sm",z>0?"text-red-600 dark:text-red-400":z<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[z>0?e.jsx(Ne,{className:"w-4 h-4"}):z<0?e.jsx(Ct,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[z>0?"+":"",z,"% vs last month (",S(y||0),")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:d("dashboard.recentTransactions")}),g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Qe,{className:"w-6 h-6 animate-spin text-gray-400"})}):N?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:N})]}):x.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:d("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[x.map(j=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:j.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:M(j.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:R(j.amount,j.currency)})]},j.id)),x.length>=10&&e.jsxs(U,{variant:"ghost",size:"sm",onClick:P,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:d("dashboard.viewAllCategories")}),e.jsx(At,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(U,{onClick:L,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:d("transaction.addTransaction")})]}),e.jsx(U,{variant:"outline",onClick:P,className:"w-full",children:e.jsx("span",{children:d("transactions.viewAll")})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 dark:bg-black/50 z-40 lg:hidden",onClick:n}),e.jsxs("div",{className:w("fixed right-0 top-0 h-full w-full sm:w-96 bg-white dark:bg-gray-900 shadow-xl z-50","flex flex-col transform transition-transform duration-300 ease-out",a?"translate-x-0":"translate-x-full",o),children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("nav",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:d("budget.title","Budget")}),e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{children:d("budget.categories","Categories")}),D&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-3 h-3 mx-1"}),e.jsx("span",{className:"truncate",children:D})]})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:t})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors flex-shrink-0 ml-2",children:e.jsx(ke,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S((s==null?void 0:s.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:S(F)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500",(s==null?void 0:s.status)==="red"?"bg-red-500":(s==null?void 0:s.status)==="orange"?"bg-orange-500":(s==null?void 0:s.status)==="yellow"?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(s==null?void 0:s.percentage)||0)}%`}})}),z!==null&&e.jsxs("div",{className:w("flex items-center gap-2 text-sm",z>0?"text-red-600 dark:text-red-400":z<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[z>0?e.jsx(Ne,{className:"w-4 h-4"}):z<0?e.jsx(Ct,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[z>0?"+":"",z,"% vs last month (",S(y||0),")"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:d("dashboard.recentTransactions")}),g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Qe,{className:"w-6 h-6 animate-spin text-gray-400"})}):N?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:N})]}):x.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:d("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[x.map(j=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:j.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:M(j.date)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:R(j.amount,j.currency)})]},j.id)),x.length>=10&&e.jsxs(U,{variant:"ghost",size:"sm",onClick:P,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:d("dashboard.viewAllCategories")}),e.jsx(At,{className:"w-3 h-3"})]})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(U,{onClick:L,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:d("transaction.addTransaction")})]}),e.jsx(U,{variant:"outline",onClick:P,className:"w-full",children:e.jsx("span",{children:d("transactions.viewAll")})})]})]})]}):null}function Qs({isDraft:t,onEdit:r,onDelete:s,onQuickAdjust:a}){const{t:n}=K("common"),[i,o]=b.useState(!1),[d,u]=b.useState(!1),l=b.useRef(null);b.useEffect(()=>{if(!i)return;const x=f=>{l.current&&!l.current.contains(f.target)&&(o(!1),u(!1))};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[i]);const c=x=>{x.stopPropagation(),o(!i),u(!1)},m=(x,f)=>{x.stopPropagation(),f(),o(!1)},h=x=>{x.stopPropagation(),d?(s(),o(!1),u(!1)):u(!0)};return e.jsxs("div",{ref:l,className:"relative",children:[e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":n("budget.cardActions","Actions"),"aria-expanded":i,children:e.jsx(xa,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"})}),i&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-20 py-1",children:[e.jsxs("button",{onClick:x=>m(x,r),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(na,{className:"w-4 h-4"}),n("budget.editAmount")]}),t&&a&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:x=>m(x,()=>a(5e3)),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(ta,{className:"w-4 h-4"}),"+5,000"]}),e.jsxs("button",{onClick:x=>m(x,()=>a(-5e3)),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(ra,{className:"w-4 h-4"}),"-5,000"]}),e.jsxs("button",{onClick:x=>m(x,()=>a("percent")),className:"w-full flex items-center gap-2 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("span",{className:"w-4 h-4 text-center text-xs font-bold",children:"%"}),"+10%"]})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700 my-1"}),e.jsxs("button",{onClick:h,className:w("w-full flex items-center gap-2 px-3 py-2.5 text-sm transition-colors",d?"text-white bg-red-600 hover:bg-red-700":"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20"),children:[e.jsx(pr,{className:"w-4 h-4"}),n(d?"budget.deleteConfirm":"delete")]})]})]})}function Gs({currentAmount:t,onSave:r,onCancel:s}){const{t:a}=K("common"),n=b.useRef(null),[i,o]=b.useState(t.toLocaleString());b.useEffect(()=>{var c,m;(c=n.current)==null||c.focus(),(m=n.current)==null||m.select()},[]);const d=c=>{const m=c.replace(/[^\d]/g,"");return m?parseInt(m,10).toLocaleString():""},u=c=>parseInt(c.replace(/[^\d]/g,""),10)||0,l=()=>{const c=u(i);c!==t?r(c):s()};return e.jsxs("div",{className:"flex items-center gap-1",onClick:c=>c.stopPropagation(),children:[e.jsx("input",{ref:n,type:"text",inputMode:"numeric",value:i,onChange:c=>o(d(c.target.value)),onKeyDown:c=>{c.key==="Enter"?l():c.key==="Escape"&&s()},className:"w-28 text-right text-lg font-bold border-2 border-primary-400 rounded px-2 py-1 dark:bg-gray-700 dark:border-primary-500 dark:text-gray-100 focus:outline-none focus:border-primary-500","aria-label":a("budget.editAmount")}),e.jsx("button",{onClick:l,className:"p-1.5 bg-primary-100 dark:bg-primary-900/40 hover:bg-primary-200 dark:hover:bg-primary-900/60 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":a("save"),children:e.jsx(Xe,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),e.jsx("button",{onClick:s,className:"p-1.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":a("cancel"),children:e.jsx(ke,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})})]})}function Js(t,r,s,a,n,i){if(a<=0)return null;const o=a-s;if(s>a){const d=s-a;return{text:t("budget.nudge.overTapToAdjust",{amount:r(d)}),className:"text-red-600 dark:text-red-400"}}if(n>=80){const d=Math.round(s-a*.75);return{text:t("budget.nudge.reduceToStaySafe",{amount:r(Math.max(d,0))}),className:"text-amber-600 dark:text-amber-400"}}if(i&&i>0&&o>0){const d=Math.round(o/i);return{text:t("budget.nudge.safeToSpend",{amount:r(d)}),className:"text-green-600 dark:text-green-400"}}return null}function Ys({allocation:t,trackingItem:r,daysRemaining:s,isDraft:a,isUpdating:n,isDeleting:i,formatCurrency:o,onAmountChange:d,onDelete:u,onCategoryClick:l,onQuickAdjust:c}){const{t:m}=K("common"),[h,x]=b.useState(!1),f=(r==null?void 0:r.spent)||0,g=(r==null?void 0:r.budgeted)||t.amount,v=g>0?f/g*100:0,N=dr(v),p=()=>v>=100?"bg-red-500":v>=80?"bg-amber-500":"bg-green-500",y=r?Js(m,o,f,g,v,s):null,k=()=>{!a&&!h&&l()};return e.jsxs(J,{className:w("p-3 sm:p-4 transition-all",a?"border-dashed border-primary-300 dark:border-primary-700":"cursor-pointer hover:shadow-md hover:border-primary-300 dark:hover:border-primary-600",(n||i)&&"opacity-50 pointer-events-none"),onClick:k,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:t.category}),r&&e.jsx(ur,{status:N})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:h?e.jsx(Gs,{currentAmount:t.amount,onSave:S=>{d(S),x(!1)},onCancel:()=>x(!1)}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-base font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap",children:o(t.amount)}),e.jsx(Qs,{isDraft:a,onEdit:()=>x(!0),onDelete:u,onQuickAdjust:a?c:void 0})]})})]}),r&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[o(f)," / ",o(g)]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:w("h-full rounded-full transition-all duration-500 ease-out",p()),style:{width:`${Math.min(v,100)}%`}})}),v>100&&e.jsx("div",{className:"h-1 bg-red-200 dark:bg-red-900/50 rounded-full mt-0.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500 rounded-full",style:{width:`${Math.min((f-g)/g*100,100)}%`}})})]}),y&&e.jsx("p",{className:w("text-xs font-medium mt-1.5",y.className),children:y.text})]})}function Zs({budgetId:t,allocations:r,totalBudget:s,tracking:a,month:n,daysRemaining:i,isDraft:o,onAddCategory:d,onAllocationChange:u}){const{t:l}=K("common"),c=vt(),m=et(),{data:h}=tt(),{currency:x}=Z(),{isPrivacyMode:f}=te(),{data:g}=X(),v=C=>Y(C,x,(g==null?void 0:g.rates)||{},!0,f),N=b.useMemo(()=>{const C=new Map;if(!h)return C;for(const D of[...h.expense,...h.income])C.set(D.name,D.children.map(M=>M.name));return C},[h]),p=b.useMemo(()=>{var D;const C=new Map;return(D=a==null?void 0:a.categories)==null||D.forEach(M=>C.set(M.category,M)),C},[a]),y=b.useMemo(()=>[...r].sort((C,D)=>{const M=p.get(C.category),P=p.get(D.category),L=(M==null?void 0:M.spent)||0,F=(P==null?void 0:P.spent)||0,z=(M==null?void 0:M.budgeted)||C.amount,j=(P==null?void 0:P.budgeted)||D.amount,A=L-z,$=F-j;if(A>0&&$<=0)return-1;if($>0&&A<=0)return 1;const V=z>0?L/z:0;return(j>0?F/j:0)-V}),[r,p]),k=ge({mutationFn:({category:C,amount:D})=>br(t,C,D),onSuccess:()=>m.invalidateQueries({queryKey:["budget"]})}),S=ge({mutationFn:C=>yr(t,C),onSuccess:()=>m.invalidateQueries({queryKey:["budget"]})}),R=C=>{const D=N.get(C)||[];c({to:"/transactions",search:{categories:[C,...D].join(","),month:n||void 0}})},O=(C,D)=>{if(!o||!u)return;const M=r[C],P=D==="percent"?Math.floor(M.amount*1.1):Math.max(0,M.amount+D),L=[...r];L[C]={...M,amount:P},u(L)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:l("budget.allocations")}),d&&e.jsxs(U,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),l("budget.addCategory")]})]}),o&&u&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:l("budget.tapToEdit")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:y.map(C=>{const D=r.findIndex(M=>M.category===C.category);return e.jsx(Ys,{allocation:C,totalBudget:s,trackingItem:p.get(C.category),daysRemaining:i,isDraft:o,isUpdating:k.isPending,isDeleting:S.isPending,formatCurrency:v,onAmountChange:M=>{if(o&&u){const P=[...r];P[D]={...C,amount:M},u(P)}else k.mutate({category:C.category,amount:M})},onDelete:()=>{o&&u?u(r.filter((M,P)=>P!==D)):S.mutate(C.category)},onCategoryClick:()=>R(C.category),onQuickAdjust:M=>O(D,M)},C.category)})}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:l("budget.noAllocations")})]})}function Xs({budget:t,tracking:r,isDraft:s,selectedMonth:a,onAddCategory:n,onAllocationChange:i}){const{t:o}=K("common"),[d,u]=b.useState(null),l=t.monthly_income-(t.savings_target||0),c=b.useCallback(m=>{var h;return(h=r==null?void 0:r.categories)==null?void 0:h.find(x=>x.category===m)},[r]);return e.jsxs("div",{className:"space-y-4",children:[(r==null?void 0:r.uncategorized_spending)!=null&&r.uncategorized_spending>0&&e.jsx(lr,{amount:r.uncategorized_spending,transactions:r.uncategorized_transactions,month:a}),e.jsxs("div",{className:"hidden lg:grid lg:grid-cols-[280px_1fr] lg:gap-4 lg:min-h-[500px]",children:[e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:e.jsx(Hs,{allocations:t.allocations,trackingItems:r==null?void 0:r.categories,selectedCategory:d,onSelectCategory:u,isDraft:s,onAddCategory:n})}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:d?e.jsx(Vt,{category:d,month:a,trackingItem:c(d),isOpen:!0,onClose:()=>u(null),mode:"inline"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400 p-8",children:o("budget.selectCategoryHint")})})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx(Zs,{budgetId:t.id,allocations:t.allocations,totalBudget:l,tracking:r,month:a,daysRemaining:r==null?void 0:r.days_remaining,isDraft:s,onAddCategory:n,onAllocationChange:i})}),e.jsx("div",{className:"lg:hidden",children:e.jsx(Vt,{category:d||"",month:a,trackingItem:d?c(d):void 0,isOpen:!!d,onClose:()=>u(null),mode:"overlay"})})]})}const lt=20;function en({allocations:t,month:r,onEditTransaction:s}){const{t:a}=K("common"),{currency:n}=Z(),{isPrivacyMode:i}=te(),{data:o}=X(),[d,u]=b.useState([]),[l,c]=b.useState(!0),[m,h]=b.useState(null),[x,f]=b.useState("all"),[g,v]=b.useState(""),[N,p]=b.useState("date"),[y,k]=b.useState("desc"),[S,R]=b.useState(1),O=_=>Y(_,n,(o==null?void 0:o.rates)||{},!1,i),C=(_,B)=>Y(_,B||n,(o==null?void 0:o.rates)||{},!0,i),D=b.useMemo(()=>["all",...t.map(_=>_.category)],[t]),M=b.useMemo(()=>{const _=new Map;return t.forEach(B=>_.set(B.category,B.amount)),_},[t]),P=b.useMemo(()=>{const _=new Map;return d.forEach(B=>{const q=B.category||"";_.set(q,(_.get(q)||0)+Math.abs(B.amount))}),_},[d]);b.useEffect(()=>{let _=!0;async function B(){c(!0);try{const[q,Q]=r.split("-").map(Number),de=new Date(q,Q,0).getDate(),fe=await xt({start_date:`${q}-${String(Q).padStart(2,"0")}-01`,end_date:`${q}-${String(Q).padStart(2,"0")}-${String(de).padStart(2,"0")}`,type:"expense"});_&&u(fe.filter(ne=>!ne.is_transfer))}catch{_&&h("Failed to load")}finally{_&&c(!1)}}return B(),()=>{_=!1}},[r]);const L=b.useMemo(()=>{let _=[...d];if(x!=="all"&&(_=_.filter(B=>B.category===x)),g.trim()){const B=g.toLowerCase();_=_.filter(q=>{var Q;return q.description.toLowerCase().includes(B)||((Q=q.category)==null?void 0:Q.toLowerCase().includes(B))})}return _.sort((B,q)=>{const Q=N==="date"?new Date(B.date).getTime()-new Date(q.date).getTime():Math.abs(B.amount)-Math.abs(q.amount);return y==="desc"?-Q:Q}),_},[d,x,g,N,y]),F=Math.ceil(L.length/lt),z=L.slice((S-1)*lt,S*lt);if(b.useEffect(()=>{R(1)},[x,g,N,y]),l)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Qe,{className:"w-6 h-6 animate-spin text-gray-400"})});if(m)return e.jsx(J,{className:"p-6 text-center text-red-500",children:m});const j=x!=="all"?M.get(x):void 0,A=x!=="all"?P.get(x)||0:void 0,$=j&&j>0?Math.round(A/j*100):void 0,V=_=>{const B=M.get(_);return B!==void 0&&B>0&&(P.get(_)||0)>B};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("select",{value:x,onChange:_=>f(_.target.value),className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:D.map(_=>e.jsx("option",{value:_,children:_==="all"?a("transactions.allCategories"):_},_))}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(vr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:_=>v(_.target.value),placeholder:a("transactions.search"),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm"})]}),e.jsxs("select",{value:`${N}-${y}`,onChange:_=>{const[B,q]=_.target.value.split("-");p(B),k(q)},className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"date-desc",children:a("transactions.sortDateDesc")}),e.jsx("option",{value:"date-asc",children:a("transactions.sortDateAsc")}),e.jsx("option",{value:"amount-desc",children:a("transactions.sortAmountDesc")}),e.jsx("option",{value:"amount-asc",children:a("transactions.sortAmountAsc")})]})]}),j!==void 0&&A!==void 0&&e.jsxs("div",{className:"px-3 py-2.5 rounded-lg bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:x}),e.jsxs("span",{className:w("text-sm font-semibold",$>100?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:[a("budget.budgetContext.progress",{spent:O(A),budgeted:O(j)})," ","(",$,"%)"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:w("h-full rounded-full transition-all",$>100?"bg-red-500":$>85?"bg-amber-500":"bg-green-500"),style:{width:`${Math.min(100,$)}%`}})})]}),e.jsx(J,{className:"divide-y divide-gray-100 dark:divide-gray-800 overflow-hidden",children:z.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:a("transactions.noData")}):z.map(_=>{const B=M.get(_.category||""),q=B&&B>0?Math.round(Math.abs(_.amount)/B*100):0,Q=V(_.category||"");return e.jsxs("button",{onClick:()=>s==null?void 0:s(_),className:w("w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",Q&&"border-l-3 border-l-red-400 dark:border-l-red-500"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:_.description}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Gt(_.date,"MMM d")," â€¢ ",_.category||a("category.other")]})]}),e.jsxs("div",{className:"text-right ml-4 flex-shrink-0",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:C(_.amount,_.currency)}),q>10&&e.jsx("p",{className:w("text-[10px] font-medium mt-0.5",q>30?"text-red-500":q>20?"text-amber-500":"text-gray-400"),children:a("budget.budgetContext.impact",{percent:q})})]})]},_.id)})}),F>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500",children:a("transactions.showingCount",{shown:z.length,total:L.length})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(_=>Math.max(1,_-1)),disabled:S===1,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm",children:[S," / ",F]}),e.jsx("button",{onClick:()=>R(_=>Math.min(F,_+1)),disabled:S===F,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50",children:e.jsx(oe,{className:"w-5 h-5"})})]})]})]})}function tn({predictions:t,onViewCategory:r,onAdjustBudget:s,onDismiss:a,maxAlerts:n=3,className:i}){const{t:o}=K("common"),{currency:d}=Z(),{isPrivacyMode:u}=te(),{data:l}=X(),c=f=>Y(f,d,(l==null?void 0:l.rates)||{},!0,u),m=t.slice(0,n);if(m.length===0)return null;const h=f=>f.anomalyDetected?{icon:oa,bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200 dark:border-purple-800",iconBg:"bg-purple-100 dark:bg-purple-900/50",iconColor:"text-purple-600 dark:text-purple-400",textColor:"text-purple-800 dark:text-purple-200"}:f.status==="danger"?{icon:le,bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",iconBg:"bg-red-100 dark:bg-red-900/50",iconColor:"text-red-600 dark:text-red-400",textColor:"text-red-800 dark:text-red-200"}:{icon:Ne,bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",iconBg:"bg-amber-100 dark:bg-amber-900/50",iconColor:"text-amber-600 dark:text-amber-400",textColor:"text-amber-800 dark:text-amber-200"},x=f=>o(`budget.forecast.confidence.${f}`);return e.jsxs("div",{className:w("space-y-3",i),children:[m.map(f=>{const g=h(f),v=g.icon;return e.jsx(J,{className:w("p-4 border",g.bg,g.border),role:"alert",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:w("p-2 rounded-lg flex-shrink-0",g.iconBg),children:e.jsx(v,{className:w("w-5 h-5",g.iconColor)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:w("font-semibold",g.textColor),children:f.anomalyDetected?o("budget.forecast.anomalyDetected"):f.status==="danger"?o("budget.forecast.predictedOverspend"):o("budget.forecast.approachingLimit")}),e.jsx("p",{className:w("text-sm mt-0.5",g.textColor,"opacity-90"),children:f.anomalyDetected?`${f.category}: ${f.anomalyDescription}`:`${f.category} ${o("budget.forecast.willExceedBy")} ${c(f.exceededBy)}`})]}),a&&e.jsx("button",{onClick:()=>a(f.category),className:w("p-1 rounded hover:bg-black/5 dark:hover:bg-white/5",g.textColor),"aria-label":o("button.close"),children:e.jsx(ke,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:w("flex items-center gap-4 mt-2 text-xs",g.textColor,"opacity-80"),children:[e.jsxs("span",{children:[o("budget.forecast.currentPace"),": ",c(f.dailyPace),"/day"]}),e.jsxs("span",{children:[o("budget.forecast.safePace"),": ",c(f.safeDailyPace),"/day"]}),e.jsxs("span",{children:[f.daysRemaining," ",o("budget.daysLeft")]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:w("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",f.confidence==="high"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":f.confidence==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:[o("budget.forecast.confidenceLabel"),": ",x(f.confidence)]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>r(f.category),className:g.textColor,children:[e.jsx(jr,{className:"w-4 h-4 mr-1"}),o("viewDetails")]}),s&&e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>s(f.category),className:g.textColor,children:[e.jsx(wr,{className:"w-4 h-4 mr-1"}),o("budget.forecast.adjustBudget")]})]})]})]})},f.category)}),t.length>n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:o("budget.forecast.moreAlerts",{count:t.length-n})})]})}function rn({budget:t,tracking:r,selectedMonth:s,onViewCategory:a,onAdjustBudget:n}){const{t:i}=K("common"),{currency:o}=Z(),{isPrivacyMode:d}=te(),{data:u}=X(),l=x=>Y(x,o,(u==null?void 0:u.rates)||{},!0,d),c=b.useMemo(()=>r?qs(t.allocations,r):[],[t.allocations,r]),m=b.useMemo(()=>r?cr(r):null,[r]);if(!r)return e.jsx(J,{className:"p-8 text-center text-gray-500",children:i("budget.forecast.noData")});const h=c.length>0;return e.jsxs("div",{className:"space-y-6",children:[m&&e.jsx(J,{className:w("p-6 border-2",m.overallStatus==="danger"?"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/20":m.overallStatus==="warning"?"border-amber-300 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20":"border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-900/20"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:w("w-14 h-14 rounded-full flex items-center justify-center",m.overallStatus==="danger"?"bg-red-500":m.overallStatus==="warning"?"bg-amber-500":"bg-green-500"),children:m.overallStatus==="danger"?e.jsx(le,{className:"w-7 h-7 text-white"}):m.overallStatus==="warning"?e.jsx(Ne,{className:"w-7 h-7 text-white"}):e.jsx(Oe,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:w("text-lg font-bold",m.overallStatus==="danger"?"text-red-800 dark:text-red-200":m.overallStatus==="warning"?"text-amber-800 dark:text-amber-200":"text-green-800 dark:text-green-200"),children:m.overallStatus==="danger"?i("budget.forecast.overBudgetProjected"):m.overallStatus==="warning"?i("budget.forecast.approachingLimit"):i("budget.forecast.onTrack")}),e.jsx("p",{className:w("text-sm mt-0.5",m.overallStatus==="danger"?"text-red-700 dark:text-red-300":m.overallStatus==="warning"?"text-amber-700 dark:text-amber-300":"text-green-700 dark:text-green-300"),children:i("budget.forecast.projectedSpending",{amount:l(m.totalPredicted),budget:l(m.totalBudget)})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:w("text-3xl font-bold",m.overallStatus==="danger"?"text-red-600 dark:text-red-400":m.overallStatus==="warning"?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400"),children:[Math.round(m.overallPercent),"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:i("budget.forecast.ofBudget")})]})]})}),h?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:i("budget.forecast.predictedWarnings")}),e.jsx(tn,{predictions:c,onViewCategory:a,onAdjustBudget:n,maxAlerts:5})]}):e.jsxs(J,{className:"p-6 text-center bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsx(Oe,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:i("budget.forecast.allClear")}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:i("budget.forecast.allClearDescription")})]}),e.jsxs(J,{className:"overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:i("budget.forecast.categoryForecasts")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:r.categories.map(x=>{const f=c.find(N=>N.category===x.category),g=(f==null?void 0:f.predictedTotal)||x.spent,v=x.budgeted>0?g/x.budgeted*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:x.category}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l(x.spent)," â†’ ",l(g)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:w("font-semibold",v>100?"text-red-600":v>85?"text-amber-600":"text-green-600"),children:[Math.round(v),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/ ",l(x.budgeted)]})]})]},x.category)})})]})]})}const qt="budget-active-tab",an=["overview","categories","transactions","forecast"];function ct(t){return t!==null&&an.includes(t)}function sn(t="overview"){const[r,s]=b.useState(()=>{if(typeof window<"u"){const i=new URLSearchParams(window.location.search).get("tab");if(ct(i))return i;const o=localStorage.getItem(qt);if(ct(o))return o}return t}),a=b.useCallback(n=>{if(s(n),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set("tab",n),window.history.replaceState({},"",i.toString()),localStorage.setItem(qt,n)}},[]);return b.useEffect(()=>{const n=()=>{const o=new URLSearchParams(window.location.search).get("tab");ct(o)&&s(o)};return window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]),{activeTab:r,setActiveTab:a}}const dt=()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`},ut=t=>{const[r,s]=t.split("-").map(Number),a=s-1<1?12:s-1;return`${s-1<1?r-1:r}-${String(a).padStart(2,"0")}`};function nn(){const{t,i18n:r}=K("common"),s=et(),{currency:a}=Z(),{isPrivacyMode:n}=te(),{data:i}=X(),[o,d]=b.useState(!1),[u,l]=b.useState(null),[c,m]=b.useState(dt),[h,x]=b.useState([]),[f,g]=b.useState(!1),[v,N]=b.useState(!1),[p,y]=b.useState(null),{activeTab:k,setActiveTab:S}=sn("overview"),{showBudgetCreatedXP:R}=la(),O=T=>Y(T,a,(i==null?void 0:i.rates)||{},!0,n),C=T=>{const[H,ee]=T.split("-");return new Date(parseInt(H),parseInt(ee)-1).toLocaleDateString(r.language,{month:"long",year:"numeric"})},D=c===dt(),M=b.useCallback(T=>{m(H=>{const[ee,ue]=H.split("-").map(Number);let me=ee,pe=ue;return T==="prev"?(pe-=1,pe<1&&(pe=12,me-=1)):(pe+=1,pe>12&&(pe=1,me+=1)),`${me}-${String(pe).padStart(2,"0")}`})},[]),P=b.useCallback(()=>m(dt()),[]),{data:L,isLoading:F,error:z}=Ce({queryKey:["budget","month",c],queryFn:async()=>{var T;try{return await St(c)}catch(H){if(((T=H==null?void 0:H.response)==null?void 0:T.status)===404)return null;throw H}},retry:!1}),{data:j}=Ce({queryKey:["budget","previous-month",c],queryFn:async()=>{try{return await St(ut(c))}catch{return null}},enabled:!!L,staleTime:5*60*1e3}),{data:A}=Ce({queryKey:["budget","tracking",c],queryFn:async()=>{var T;try{return await Ar(c)}catch(H){if(((T=H==null?void 0:H.response)==null?void 0:T.status)===404)return null;throw H}},retry:!1,enabled:!!L}),{data:$}=Ce({queryKey:["budget","suggestions"],queryFn:Pr,enabled:!L&&!F}),{data:V,isLoading:_}=Ce({queryKey:["budget","copy-preview",c],queryFn:()=>_r(ut(c),c),enabled:!L&&!F&&!u,retry:!1}),{data:B}=Ce({queryKey:["budget","versions",c],queryFn:()=>Mr(c),enabled:!!L}),q=ge({mutationFn:T=>Nr({monthly_income:T,language:r.language}),onSuccess:T=>{l(T),ne("generate",T),R()}}),Q=ge({mutationFn:T=>kr((u||L).id,{feedback:T,language:r.language}),onSuccess:T=>{l(T),d(!1),ne("regenerate",T)}}),de=ge({mutationFn:()=>Cr({source_month:ut(c),target_month:c}),onSuccess:T=>{l(T),s.invalidateQueries({queryKey:["budget"]})}}),fe=ge({mutationFn:T=>Sr(T),onSuccess:()=>{s.invalidateQueries({queryKey:["budget"]})}}),ne=b.useCallback((T,H)=>{x(ee=>[...ee.slice(-9),{action:T,data:H}])},[]),E=u||L,se=!!u,Nt=(E==null?void 0:E.allocations.reduce((T,H)=>T+H.amount,0))||0,Fe=b.useMemo(()=>{if(!A)return null;const T=A.total_spent/(A.total_budgeted||1);return T>1?"bg-red-500":T>.85?"bg-amber-500":"bg-green-500"},[A]),$e=b.useMemo(()=>{if(!A)return[];const T=[];return A.categories.some(ee=>ee.status==="red")&&T.push("categories"),A.total_spent/(A.total_budgeted||1)>1&&T.push("forecast"),T},[A]),Ie=b.useCallback(()=>{if(!E)return;const T=`${t("budget.title")} - ${E.month}
${t("budget.monthlyIncome")}: ${O(E.monthly_income)}
${t("budget.savingsTarget")}: ${O(E.savings_target||0)}

${t("budget.allocations")}:
${E.allocations.map(me=>`- ${me.category}: ${O(me.amount)}`).join(`
`)}

${t("budget.aiAdvice")}: ${E.advice||"-"}
`,H=new Blob([T],{type:"text/plain"}),ee=URL.createObjectURL(H),ue=document.createElement("a");ue.href=ee,ue.download=`budget-${E.month}.txt`,ue.click(),URL.revokeObjectURL(ee)},[E,t]);return F?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Wt,{})}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:()=>M("prev"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",children:e.jsx(yt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:C(c)}),Fe&&e.jsx("span",{className:w("w-2.5 h-2.5 rounded-full flex-shrink-0",Fe),title:t("budget.health.title")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!D&&e.jsx("button",{onClick:P,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center text-green-600 dark:text-green-400",title:t("common.today"),children:e.jsx(ua,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>M("next"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",disabled:c>=new Date().toISOString().slice(0,7),children:e.jsx(oe,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:t("budget.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("budget.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[B&&B.length>1&&E&&e.jsx(La,{versions:B,currentVersion:E.version||1,formatCurrency:O,onRestore:T=>fe.mutate(T),isRestoring:fe.isPending}),E&&e.jsx("button",{onClick:Ie,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center",title:t("export"),children:e.jsx(ca,{className:"w-5 h-5"})})]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 space-y-4",children:[!E&&!z&&e.jsx(Ma,{copyPreview:V,isCopyPreviewLoading:_,suggestions:$,selectedMonth:c,formatCurrency:O,formatMonth:C,onCopy:()=>de.mutate(),onGenerate:T=>q.mutate(T),onStartEmpty:()=>{var T;l({id:0,month:c,monthly_income:((T=V==null?void 0:V.source_budget)==null?void 0:T.monthly_income)||0,allocations:[],created_at:new Date().toISOString()})},isCopyLoading:de.isPending,isGenerateLoading:q.isPending,generateError:q.isError}),E&&e.jsxs(Ea,{activeTab:k,onTabChange:S,alertTabs:$e,children:[k==="overview"&&e.jsx(Us,{budget:E,tracking:A||void 0,previousMonthData:j,selectedMonth:c,onViewCategory:()=>S("categories")}),k==="categories"&&e.jsx(Xs,{budget:E,tracking:A||void 0,isDraft:se,selectedMonth:c,onAddCategory:()=>g(!0),onAllocationChange:T=>{se&&l({...E,allocations:T})}}),k==="transactions"&&e.jsx(en,{allocations:E.allocations,month:c,onEditTransaction:y}),k==="forecast"&&e.jsx(rn,{budget:E,tracking:A||void 0,selectedMonth:c,onViewCategory:()=>S("categories")}),se&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(U,{variant:"outline",onClick:()=>d(!o),className:"flex-1",children:[e.jsx(on,{className:"w-4 h-4 mr-2"}),t("budget.regenerate")]}),e.jsxs(U,{onClick:()=>N(!0),className:"flex-1",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),t("budget.save")]})]}),o&&e.jsx(Ta,{onSubmit:T=>Q.mutate(T),onCancel:()=>d(!1),isLoading:Q.isPending})]}),z&&e.jsx(J,{className:"p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:z instanceof Error?z.message:t("budget.generateError")})}),f&&E&&e.jsx(Oa,{budget:E,onClose:()=>g(!1),onAdd:(T,H)=>{const ee=[...E.allocations,{category:T,amount:H}];l({...E,allocations:ee,savings_target:Math.max(0,E.monthly_income-ee.reduce((ue,me)=>ue+me.amount,0))}),g(!1),ne("add-category",E)}})]}),E&&se&&e.jsx("div",{className:"fixed bottom-20 right-4 sm:hidden",children:e.jsx(U,{size:"lg",className:"rounded-full shadow-lg",onClick:()=>g(!0),children:e.jsx(we,{className:"w-6 h-6"})})}),p&&e.jsx(ia,{transaction:p,isOpen:!!p,onClose:()=>{y(null),s.invalidateQueries({queryKey:["budget","tracking"]})}}),e.jsx(Da,{isOpen:v,onConfirm:async()=>{await s.refetchQueries({queryKey:["budget"]}),l(null),N(!1)},onCancel:()=>N(!1),monthlyIncome:(E==null?void 0:E.monthly_income)||0,totalAllocated:Nt,savingsTarget:(E==null?void 0:E.savings_target)||0,categoryCount:(E==null?void 0:E.allocations.length)||0})]})}function on({className:t}){return e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}const Cn=Tr("/budget")({component:nn});export{Cn as Route};
