import{g as e,u as t,k as a,j as s,m as r}from"./vendor-tanstack-DaKcK1QW.js";import{r as n,a as l}from"./vendor-react-Bx4JnVfy.js";import{a as i,C as d,L as c,B as o,d as x,I as g,E as m,F as u}from"./index-DX1XEPIO.js";import{C as y,c as h,d as b,s as p,a as j,b as v,e as f,f as k,g as N}from"./crypto-BYIh_Q_q.js";import{S as w}from"./Select-C9VGBjyK.js";import{R as C}from"./RecurringTransactionsList-B2FadOnj.js";import{u as S}from"./vendor-i18n-BrrOrGm_.js";import{a5 as _,ac as D,P,a8 as q,ad as F,w as R,X as z,ae as K,af as E,h as Q,W as T,i as L,ag as A,G as O}from"./vendor-icons-ALW4ipAx.js";import{u as I,a as W,b as U,c as J}from"./useCategories-D0wiQusU.js";import"./vendor-recharts-CdX2WCa7.js";import"./vendor-date-Be-7Lppd.js";import"./recurring-service-DPFqCjNp.js";async function Y(){return(await i.get("/api/category-rules/")).data.rules}async function V(e){return(await i.post("/api/category-rules/",e)).data}async function $(e){await i.delete(`/api/category-rules/${e}`)}async function B(){return(await i.get("/api/category-rules/suggest")).data.suggestions}async function G(){return(await i.post("/api/category-rules/seed-defaults")).data}const H={contains:"categoryRules.contains",starts_with:"categoryRules.startsWith",exact:"categoryRules.exact"},M=["Food","Shopping","Transportation","Utilities","Entertainment","Healthcare","Education","Groceries","Dining","Cafe","Convenience","Transfer","Investment","Clothing","Other"];function X(){const{t:r}=S("common"),l=e(),[g,m]=n.useState(null),[u,h]=n.useState(!1),[b,p]=n.useState(!1),[j,v]=n.useState(null),[f,k]=n.useState(""),[N,w]=n.useState("Other"),[C,z]=n.useState("contains"),{data:K,isLoading:E}=t({queryKey:["category-rules"],queryFn:Y}),{data:Q,isLoading:T}=t({queryKey:["category-rules-suggestions"],queryFn:B,enabled:b}),L=a({mutationFn:$,onSuccess:()=>{l.invalidateQueries({queryKey:["category-rules"]}),m(null)}}),A=a({mutationFn:V,onSuccess:()=>{l.invalidateQueries({queryKey:["category-rules"]}),k(""),w("Other"),z("contains"),h(!1)}}),O=a({mutationFn:G,onSuccess:()=>{l.invalidateQueries({queryKey:["category-rules"]})}}),I=a({mutationFn:e=>async function(e=!0){return(await i.post("/api/category-rules/apply",{dry_run:e})).data}(e),onSuccess:(e,t)=>{t?v({count:e.affected_count,applied:!1}):(l.invalidateQueries({queryKey:["transactions"]}),l.invalidateQueries({queryKey:["analytics"]}),v({count:e.affected_count,applied:!0}))}});return E?s.jsxs(d,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(_,{className:"w-5 h-5 text-purple-500"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("categoryRules.title")})]}),s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(c,{size:"md"})})]}):s.jsxs(y,{title:r("categoryRules.title"),badge:(null==K?void 0:K.length)||0,children:[s.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[(!K||0===K.length)&&s.jsxs(o,{variant:"outline",size:"sm",onClick:()=>O.mutate(),disabled:O.isPending,children:[s.jsx(D,{className:"w-4 h-4 mr-1"}),O.isPending?r("loading"):r("categoryRules.seedDefaults")]}),s.jsxs(o,{variant:"outline",size:"sm",onClick:()=>h(!u),children:[s.jsx(P,{className:"w-4 h-4 mr-1"}),r("categoryRules.addRule")]})]}),u&&s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[s.jsx("input",{type:"text",placeholder:r("categoryRules.keyword"),value:f,onChange:e=>k(e.target.value),className:x("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300")}),s.jsx("select",{value:N,onChange:e=>w(e.target.value),className:x("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:M.map(e=>s.jsx("option",{value:e,children:e},e))}),s.jsxs("select",{value:C,onChange:e=>z(e.target.value),className:x("h-10 px-3 border rounded-lg text-sm","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100","border-gray-300"),children:[s.jsx("option",{value:"contains",children:r("categoryRules.contains")}),s.jsx("option",{value:"starts_with",children:r("categoryRules.startsWith")}),s.jsx("option",{value:"exact",children:r("categoryRules.exact")})]})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>h(!1),children:r("cancel")}),s.jsx(o,{size:"sm",onClick:()=>{f.trim()&&A.mutate({keyword:f.trim(),category:N,match_type:C,priority:10})},disabled:!f.trim()||A.isPending,children:A.isPending?r("saving"):r("save")})]})]}),K&&K.length>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"space-y-2 mb-6",children:K.map(e=>s.jsxs("div",{className:x("flex items-center justify-between p-3 rounded-lg border",e.is_active?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60"),children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("code",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-sm truncate max-w-[150px]",children:e.keyword}),s.jsx("span",{className:"text-gray-400",children:"â†’"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:e.category}),s.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline",children:["(",r(H[e.match_type]),")"]})]}),s.jsx("button",{onClick:()=>{return t=e.id,void(confirm(r("confirmDelete"))&&(m(t),L.mutate(t)));var t},disabled:g===e.id,className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 transition-colors",children:g===e.id?s.jsx(c,{size:"sm"}):s.jsx(q,{className:"w-4 h-4"})})]},e.id))}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r("categoryRules.applyDescription")}),j&&s.jsx("p",{className:x("text-sm mt-1",j.applied?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"),children:j.applied?r("categoryRules.appliedCount",{count:j.count}):r("categoryRules.previewCount",{count:j.count})})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>I.mutate(!0),disabled:I.isPending,children:I.isPending?r("loading"):r("categoryRules.preview")}),s.jsxs(o,{size:"sm",onClick:()=>I.mutate(!1),disabled:I.isPending||0===(null==j?void 0:j.count),children:[s.jsx(F,{className:"w-4 h-4 mr-1"}),r("categoryRules.applyNow")]})]})]})})]}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(_,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r("categoryRules.noRules")}),s.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:r("categoryRules.noRulesDescription")})]}),s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[s.jsx("button",{onClick:()=>p(!b),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:r(b?"categoryRules.hideSuggestions":"categoryRules.showSuggestions")}),b&&s.jsx("div",{className:"mt-4 space-y-2",children:T?s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(c,{size:"sm"})}):Q&&Q.length>0?Q.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("code",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm truncate max-w-[150px]",children:e.keyword}),s.jsx("span",{className:"text-gray-400",children:"â†’"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.suggested_category}),s.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.count,"x)"]})]}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>(e=>{A.mutate({keyword:e.keyword,category:e.suggested_category,match_type:"contains",priority:10})})(e),disabled:A.isPending,children:s.jsx(R,{className:"w-4 h-4"})})]},t)):s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:r("categoryRules.noSuggestions")})})]})]})}const Z=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function ee({isOpen:e,onClose:t,defaultType:a="expense",onCreated:r}){const{t:i}=S("common"),d=I(),[c,o]=n.useState(""),[g,m]=n.useState("ðŸ“"),[u,y]=n.useState(a),[h,b]=n.useState(""),p=()=>{o(""),m("ðŸ“"),y(a),b(""),t()};if(!e)return null;const j=s.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:p}),s.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i("category.createTitle","Create Category")}),s.jsx("button",{onClick:p,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:s.jsx(z,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),s.jsxs("form",{onSubmit:async e=>{var t,a;e.preventDefault(),b("");const s=c.trim();if(s)try{const e=`custom_${(await d.mutateAsync({name:s,icon:g,type:u})).id}`;null==r||r(e),p()}catch(n){b((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.detail)||i("category.errors.createFailed","Failed to create category"))}else b(i("category.errors.nameRequired","Name is required"))},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.name","Category Name")}),s.jsx("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:i("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.icon","Icon")}),s.jsx("div",{className:"grid grid-cols-10 gap-1",children:Z.map(e=>s.jsx("button",{type:"button",onClick:()=>m(e),className:x("w-8 h-8 text-lg rounded flex items-center justify-center",g===e?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:e},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("category.type","Type")}),s.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[s.jsx("button",{type:"button",onClick:()=>y("expense"),className:x("flex-1 py-2 rounded-md text-sm font-medium transition-colors","expense"===u?"bg-red-500 text-white":"text-gray-600 dark:text-gray-300"),children:i("transaction.expense","Expense")}),s.jsx("button",{type:"button",onClick:()=>y("income"),className:x("flex-1 py-2 rounded-md text-sm font-medium transition-colors","income"===u?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:i("transaction.income","Income")})]})]}),h&&s.jsx("p",{className:"text-sm text-red-500",children:h}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:p,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:i("cancel","Cancel")}),s.jsx("button",{type:"submit",disabled:d.isPending,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:d.isPending?"...":i("create","Create")})]})]})]})]});return"undefined"==typeof document?null:l.createPortal(j,document.body)}const te=["ðŸ“","ðŸ ","ðŸ½ï¸","ðŸš—","ðŸ’¡","ðŸ“±","ðŸŽ¬","ðŸ›ï¸","ðŸ¥","ðŸ“¦","ðŸ’°","ðŸŽ","ðŸ“ˆ","ðŸ’¼","ðŸ”„","âœˆï¸","ðŸŽ“","ðŸ’³","ðŸ¦","ðŸŽ®","â˜•","ðŸ•","ðŸšŒ","â›½","ðŸ’Š","ðŸ‹ï¸","ðŸ•","ðŸ‘¶","ðŸ’…","ðŸ“š"];function ae({isOpen:t,onClose:r,category:i}){const{t:d}=S("common"),c=e(),[o,g]=n.useState(""),[m,u]=n.useState("ðŸ“"),[y,h]=n.useState(""),[b,p]=n.useState(null);n.useEffect(()=>{i&&(g(i.name),u(i.icon),h(""),p(null))},[i]);const j=a({mutationFn:e=>W(i.id,e),onSuccess:e=>{p(e.affected_transactions),c.invalidateQueries({queryKey:["categories"]}),c.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>{v()},1500)},onError:e=>{var t,a;h((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.detail)||d("category.errors.updateFailed","Failed to update category"))}}),v=()=>{g(""),u("ðŸ“"),h(""),p(null),r()};if(!t||!i)return null;const f=o.trim()!==i.name,k=s.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:v}),s.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:d("category.editTitle","Edit Category")}),s.jsx("button",{onClick:v,className:"p-2.5 -mr-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:s.jsx(z,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),null!==b&&s.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:s.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[d("category.updateSuccess","Category updated!"),b>0&&s.jsx("span",{className:"block mt-1 text-green-600 dark:text-green-300",children:d("category.transactionsUpdated","{{count}} transactions updated",{count:b})})]})}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),h("");const t=o.trim();if(!t)return void h(d("category.errors.nameRequired","Name is required"));const a={};t!==(null==i?void 0:i.name)&&(a.name=t),m!==(null==i?void 0:i.icon)&&(a.icon=m),0!==Object.keys(a).length?j.mutate(a):v()},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("category.name","Category Name")}),s.jsx("input",{type:"text",value:o,onChange:e=>g(e.target.value),placeholder:d("category.namePlaceholder","e.g., Subscriptions"),maxLength:50,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-gray-100",autoFocus:!0})]}),f&&s.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[s.jsx(K,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),s.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:d("category.cascadeWarning","All transactions with this category will be updated to the new name.")})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("category.icon","Icon")}),s.jsx("div",{className:"grid grid-cols-10 gap-1",children:te.map(e=>s.jsx("button",{type:"button",onClick:()=>u(e),className:x("w-8 h-8 text-lg rounded flex items-center justify-center",m===e?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"),children:e},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("category.type","Type")}),s.jsx("div",{className:x("h-10 px-3 flex items-center rounded-lg text-sm font-medium","expense"===i.type?"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:"expense"===i.type?d("transaction.expense","Expense"):d("transaction.income","Income")})]}),y&&s.jsx("p",{className:"text-sm text-red-500",children:y}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:v,className:"flex-1 h-10 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300",children:d("cancel","Cancel")}),s.jsx("button",{type:"submit",disabled:j.isPending||null!==b,className:"flex-1 h-10 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:j.isPending?"...":d("save","Save")})]})]})]})]});return"undefined"==typeof document?null:l.createPortal(k,document.body)}function se(){const{t:e}=S("common"),{data:t=[],isLoading:a}=U(),r=J(),[l,i]=n.useState(!1),[d,c]=n.useState(null),[x,g]=n.useState(null),m=async e=>{try{await r.mutateAsync(e),g(null)}catch(t){}},u=t.filter(e=>"expense"===e.type),h=t.filter(e=>"income"===e.type);return s.jsxs(s.Fragment,{children:[s.jsxs(y,{title:e("settings.categoryManagement"),badge:t.length,children:[a?s.jsx("div",{className:"py-4 text-center text-gray-400",children:e("loading")}):0===t.length?s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:e("settings.noCategories")}):s.jsxs("div",{className:"space-y-4",children:[u.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:e("transaction.expense","Expense")}),s.jsx("div",{className:"space-y-2",children:u.map(e=>s.jsx(re,{category:e,onEdit:()=>c(e),onDelete:()=>g(e.id),isDeleting:r.isPending&&x===e.id,showDeleteConfirm:x===e.id,onConfirmDelete:()=>m(e.id),onCancelDelete:()=>g(null)},e.id))})]}),h.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:e("transaction.income","Income")}),s.jsx("div",{className:"space-y-2",children:h.map(e=>s.jsx(re,{category:e,onEdit:()=>c(e),onDelete:()=>g(e.id),isDeleting:r.isPending&&x===e.id,showDeleteConfirm:x===e.id,onConfirmDelete:()=>m(e.id),onCancelDelete:()=>g(null)},e.id))})]})]}),s.jsx("div",{className:"mt-4",children:s.jsx(o,{variant:"outline",onClick:()=>i(!0),children:e("settings.addCategory")})})]}),s.jsx(ee,{isOpen:l,onClose:()=>i(!1)}),s.jsx(ae,{isOpen:!!d,onClose:()=>c(null),category:d})]})}function re({category:e,onEdit:t,onDelete:a,isDeleting:r,showDeleteConfirm:n,onConfirmDelete:l,onCancelDelete:i}){const{t:d}=S("common");return n?s.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[s.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:d("category.deleteConfirm","Delete this category?")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:i,className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:d("cancel")}),s.jsx("button",{onClick:l,disabled:r,className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:r?"...":d("delete")})]})]}):s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-xl",children:e.icon}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:t,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:d("edit"),children:s.jsx(E,{size:16})}),s.jsx("button",{onClick:a,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:d("delete"),children:s.jsx(q,{size:16})})]})]})}const ne=["eth","bsc","polygon"];function le(){const{t:r}=S("common"),l=e(),[i,x]=n.useState(!1),[m,u]=n.useState(""),[y,w]=n.useState(""),[C,_]=n.useState(["eth","bsc","polygon"]),[D,P]=n.useState(!1),[q,F]=n.useState("polygon"),[R,z]=n.useState(""),[K,E]=n.useState(""),[Q,T]=n.useState(""),[L,A]=n.useState(null),{data:O,isLoading:I}=t({queryKey:["crypto-wallets"],queryFn:k}),{data:W,isLoading:U}=t({queryKey:["reward-contracts"],queryFn:N}),J=a({mutationFn:h,onSuccess:()=>{l.invalidateQueries({queryKey:["crypto-wallets"]}),x(!1),G()}}),Y=a({mutationFn:b,onSuccess:()=>{l.invalidateQueries({queryKey:["crypto-wallets"]})}}),V=a({mutationFn:p,onSuccess:()=>{l.invalidateQueries({queryKey:["crypto-wallets"]}),l.invalidateQueries({queryKey:["dashboard-summary"]}),A(null)},onError:()=>{A(null)}}),$=a({mutationFn:j,onSuccess:()=>{l.invalidateQueries({queryKey:["reward-contracts"]}),P(!1),H()}}),B=a({mutationFn:v,onSuccess:()=>{l.invalidateQueries({queryKey:["reward-contracts"]})}}),G=()=>{u(""),w(""),_(["eth","bsc","polygon"])},H=()=>{F("polygon"),z(""),E(""),T("")};return I||U?s.jsx(d,{children:s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(c,{})})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs(d,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("crypto.wallets")}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>x(!i),children:r(i?"cancel":"crypto.addWallet")})]}),i&&s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[s.jsx(g,{label:r("crypto.walletAddress"),placeholder:"0x...",value:m,onChange:e=>u(e.target.value)}),s.jsx(g,{label:r("crypto.walletLabel"),placeholder:r("crypto.labelPlaceholder"),value:y,onChange:e=>w(e.target.value)}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("crypto.chains")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{_(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(C.includes(e)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:[f[e].icon," ",f[e].name]},e))})]}),s.jsx(o,{onClick:()=>{m&&m.match(/^0x[a-fA-F0-9]{40}$/)?J.mutate({wallet_address:m,label:y||void 0,chains:C}):alert(r("crypto.invalidAddress"))},disabled:J.isPending,className:"w-full",children:J.isPending?r("loading"):r("crypto.addWallet")})]}),s.jsx("div",{className:"space-y-3",children:O&&O.length>0?O.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.label||r("crypto.unnamedWallet")}),s.jsx("div",{className:"flex gap-1",children:e.chains.map(e=>s.jsx("span",{title:f[e].name,children:f[e].icon},e))})]}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:e.wallet_address})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>{return t=e.id,A(t),void V.mutate(t);var t},disabled:L===e.id,children:L===e.id?s.jsx(c,{size:"sm"}):r("crypto.sync")}),s.jsx("button",{onClick:()=>{confirm(r("crypto.confirmDeleteWallet"))&&Y.mutate(e.id)},className:"text-red-600 hover:text-red-700 text-sm",children:r("delete")})]})]},e.id)):s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:r("crypto.noWallets")})})]}),s.jsxs(d,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("crypto.rewardContracts")}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("crypto.rewardContractsDescription")})]}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>P(!D),children:r(D?"cancel":"crypto.addContract")})]}),D&&s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("crypto.chain")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(e=>s.jsxs("button",{type:"button",onClick:()=>F(e),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(q===e?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:[f[e].icon," ",f[e].name]},e))})]}),s.jsx(g,{label:r("crypto.contractAddress"),placeholder:"0x...",value:R,onChange:e=>z(e.target.value)}),s.jsx(g,{label:r("crypto.contractLabel"),placeholder:r("crypto.contractLabelPlaceholder"),value:K,onChange:e=>E(e.target.value)}),s.jsx(g,{label:r("crypto.tokenSymbol"),placeholder:"STEER",value:Q,onChange:e=>T(e.target.value)}),s.jsx(o,{onClick:()=>{R&&R.match(/^0x[a-fA-F0-9]{40}$/)?$.mutate({chain_id:q,contract_address:R,label:K||void 0,token_symbol:Q||void 0}):alert(r("crypto.invalidAddress"))},disabled:$.isPending,className:"w-full",children:$.isPending?r("loading"):r("crypto.addContract")})]}),s.jsx("div",{className:"space-y-3",children:W&&W.length>0?W.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{title:f[e.chain_id].name,children:f[e.chain_id].icon}),s.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.label||r("crypto.unnamedContract")}),e.token_symbol&&s.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded",children:e.token_symbol})]}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono truncate",children:e.contract_address})]}),s.jsx("button",{onClick:()=>{confirm(r("crypto.confirmDeleteContract"))&&B.mutate(e.id)},className:"text-red-600 hover:text-red-700 text-sm ml-4",children:r("delete")})]},e.id)):s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:r("crypto.noContracts")})})]})]})}const ie=[{id:"general",label:"General",icon:Q},{id:"budget",label:"Budget",icon:T},{id:"categories",label:"Categories",icon:_},{id:"sources",label:"Sources",icon:L},{id:"recurring",label:"Recurring",icon:A},{id:"crypto",label:"Crypto",icon:O}];function de({icon:e,title:t,description:a,children:r,className:n}){return s.jsxs(d,{className:x("",n),children:[s.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:s.jsx(e,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t}),a&&s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]})]}),r]})}function ce({label:e,description:t,checked:a,onChange:r}){return s.jsxs("div",{className:"flex items-start justify-between py-1",children:[s.jsxs("div",{className:"flex-1 pr-4",children:[s.jsx("label",{className:"font-medium text-gray-900 dark:text-white block",children:e}),t&&s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:t})]}),s.jsx("button",{onClick:()=>r(!a),className:x("relative inline-flex h-7 w-12 items-center rounded-full transition-colors flex-shrink-0",a?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:s.jsx("span",{className:x("inline-block h-5 w-5 transform rounded-full bg-white transition-transform shadow-sm",a?"translate-x-6":"translate-x-1")})})]})}const oe=r("/settings")({component:function(){var r,i;const{t:d}=S("common"),h=e(),[b,p]=n.useState("general"),[j,v]=n.useState(!1),{data:f,isLoading:k}=t({queryKey:["settings"],queryFn:u}),[N,_]=n.useState("JPY"),[D,P]=n.useState(25),[q,F]=n.useState(!1),[z,K]=n.useState(!0),[E,L]=n.useState(1e6);n.useEffect(()=>{f&&(_(f.currency),P(f.base_date),F(f.budget_carry_over),K(f.budget_email_alerts),L(f.large_transaction_threshold))},[f]),n.useEffect(()=>{if(f){const e=N!==f.currency||D!==f.base_date||q!==f.budget_carry_over||z!==f.budget_email_alerts||E!==f.large_transaction_threshold;v(e)}},[N,D,q,z,E,f]);const A=a({mutationFn:m,onSuccess:()=>{h.invalidateQueries({queryKey:["settings"]}),h.invalidateQueries({queryKey:["dashboard-summary"]}),h.invalidateQueries({queryKey:["transactions"]}),h.invalidateQueries({queryKey:["analytics"]}),v(!1)},onError:e=>{}});if(k)return s.jsx("div",{className:"flex justify-center py-12",children:s.jsx(c,{size:"lg"})});const O={JPY:d("settings.currencyJPY"),USD:d("settings.currencyUSD"),VND:d("settings.currencyVND")};return s.jsxs("div",{className:"min-h-screen pb-32",children:[s.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[s.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[s.jsx(Q,{className:"w-5 h-5 text-primary-600"}),d("settings.title")]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:d("settings.subtitle")})]}),s.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800",children:s.jsx("div",{className:"max-w-2xl mx-auto px-4",children:s.jsx("div",{className:"flex gap-1 overflow-x-auto py-2 scrollbar-hide -mb-2",children:ie.map(e=>{const t=e.icon,a=b===e.id;return s.jsxs("button",{onClick:()=>p(e.id),className:x("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",a?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[s.jsx(t,{className:"w-3.5 h-3.5"}),e.label]},e.id)})})})})]}),s.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[s.jsx("div",{className:x("space-y-4","general"!==b&&"hidden"),children:s.jsx(de,{icon:Q,title:d("settings.general"),description:"Currency and basic preferences",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(w,{label:d("settings.currency"),value:N,onChange:e=>_(e.target.value),options:[{value:"JPY",label:O.JPY},{value:"USD",label:O.USD},{value:"VND",label:O.VND}]}),s.jsx(g,{type:"number",label:d("settings.payday"),value:D,onChange:e=>P(parseInt(e.target.value,10)),min:1,max:31}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 -mt-2",children:d("settings.paydayDescription")})]})})}),s.jsx("div",{className:x("space-y-4","budget"!==b&&"hidden"),children:s.jsx(de,{icon:T,title:d("settings.budgetSettings"),description:"Budget behavior and alerts",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(ce,{label:d("settings.budgetCarryOver"),description:d("settings.budgetCarryOverDescription"),checked:q,onChange:F}),s.jsx(ce,{label:d("settings.budgetEmailAlerts"),description:d("settings.budgetEmailAlertsDescription"),checked:z,onChange:K}),s.jsxs("div",{className:"pt-2",children:[s.jsx("label",{className:"font-medium text-gray-900 dark:text-white block mb-2",children:d("settings.largeTransactionThreshold")}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:d("settings.largeTransactionThresholdDescription")}),s.jsx(g,{type:"number",value:E,onChange:e=>L(parseInt(e.target.value,10)||0),min:0,step:1e5}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:d("settings.largeTransactionThresholdHint")})]})]})})}),s.jsx("div",{className:x("space-y-4","categories"!==b&&"hidden"),children:s.jsx(se,{})}),s.jsx("div",{className:x("space-y-4","sources"!==b&&"hidden"),children:s.jsxs(y,{title:d("settings.paymentSourceManagement"),badge:(null==(r=null==f?void 0:f.sources)?void 0:r.length)||0,children:[s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:(null==(i=null==f?void 0:f.sources)?void 0:i.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e}),s.jsx("button",{className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm",children:d("settings.delete")})]},t)))||s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-4",children:d("settings.noSources")})}),s.jsx("div",{className:"mt-4",children:s.jsx(o,{variant:"outline",children:d("settings.addSource")})})]})}),s.jsx("div",{className:x("space-y-4","recurring"!==b&&"hidden"),children:s.jsx(C,{})}),s.jsx("div",{className:x("space-y-4","crypto"!==b&&"hidden"),children:s.jsx(le,{})}),s.jsx(X,{})]}),j&&"undefined"!=typeof document&&l.createPortal(s.jsx("div",{className:"fixed bottom-20 left-0 right-0 p-4 bg-white/90 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-gray-700 z-40",children:s.jsx("div",{className:"max-w-2xl mx-auto",children:s.jsx(o,{onClick:()=>{A.mutate({currency:N,base_date:D,budget_carry_over:q,budget_email_alerts:z,large_transaction_threshold:E})},disabled:A.isPending,className:"w-full",size:"lg",children:A.isPending?s.jsxs(s.Fragment,{children:[s.jsx(c,{size:"sm",className:"mr-2"}),d("saving")]}):s.jsxs(s.Fragment,{children:[s.jsx(R,{className:"w-4 h-4 mr-2"}),d("settings.saveSettings")]})})})}),document.body)]})}});export{oe as Route};
