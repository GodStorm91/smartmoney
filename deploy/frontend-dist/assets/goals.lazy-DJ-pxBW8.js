import{j as e,k as a,u as t,m as r,l as s}from"./vendor-tanstack-C97-WeYN.js";import{r as l,a as o}from"./vendor-react-Bx4JnVfy.js";import{l as n,g as d,e as i,c,z as g,n as m,I as x,A as u,D as y,B as h,E as b,F as p,L as v,G as j,H as f,J as k,K as N}from"./index-DRgdJ_AG.js";import{u as w}from"./vendor-i18n-BrrOrGm_.js";import{q as C,C as S,a5 as D,_,a2 as T,Q as q,e as P,T as A,w as F,P as M}from"./vendor-icons-DsCueGb8.js";import{u as G}from"./useAccounts-B9eRZZRP.js";import"./vendor-recharts-Wt1h5c6F.js";import"./vendor-date-BkGg5e1q.js";function I({goalId:a,goalName:t,achievability:r,targetAmount:s,currentAmount:o,onEdit:x,onDelete:u,topExpenseCategory:y}){const{t:h}=w("common"),{currency:b}=n(),{data:p}=d(),{isPrivacyMode:v}=i(),[j,f]=l.useState(!1),[k,N]=l.useState(!1),P=s>0?Math.min(100,o/s*100):0,A=r.current_monthly_net>=r.required_monthly,F=P>=100,M=F||A?"text-emerald-600 dark:text-emerald-400":"text-amber-600 dark:text-amber-400",G=F||A?"bg-emerald-50 dark:bg-emerald-900/20":"bg-amber-50 dark:bg-amber-900/20",I=F||A?"bg-emerald-500":"bg-amber-500";return e.jsxs("div",{className:c("rounded-xl border overflow-hidden transition-all","bg-white dark:bg-gray-800","border-gray-200 dark:border-gray-700","hover:shadow-md"),children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸŽ¯"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t})]}),e.jsxs("div",{className:c("flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",F||A?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400"),children:[F?"ðŸŽ‰":A?e.jsx(C,{className:"w-3 h-3"}):e.jsx(S,{className:"w-3 h-3"}),h(F?"goal.status.completed":A?"goal.status.onTrack":"goal.status.behind")]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-end mb-1.5",children:[e.jsxs("div",{children:[e.jsxs("span",{className:c("text-2xl font-bold",M),children:[Math.round(P),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[g(o,b,(null==p?void 0:p.rates)||{},!0,v)," / ",g(s,b,(null==p?void 0:p.rates)||{},!0,v)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.months_remaining," ",h("goal.months","months")]}),!F&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:A?h("goal.onTrack","On track"):h("goal.behind","Behind")})]})]}),e.jsx("div",{className:"w-full h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:c("h-full rounded-full transition-all duration-500",I),style:{width:`${Math.min(100,P)}%`}})})]}),e.jsx("div",{className:c("rounded-lg p-2.5",G),children:e.jsxs("p",{className:c("text-xs",M),children:["ðŸ’¡ ",(()=>{if(F)return h("goal.insight.achieved");if(A)return h("goal.insight.onTrackMonths",{months:r.months_remaining});const e=r.monthly_gap;if(e>0){const a=m(e,b,(null==p?void 0:p.rates)||{},!1,v);return h("goal.insight.saveMore",{amount:a})}return h("goal.insight.everyBitCounts")})()]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>f(!j),className:"flex-1 flex items-center justify-center gap-1 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:j?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-3.5 h-3.5"}),h("button.hideDetails","Hide Details")]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3.5 h-3.5"}),h("button.showDetails","Show Details")]})}),x&&e.jsxs("button",{onClick:()=>x(a),className:"flex items-center gap-1 px-3 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(T,{className:"w-3.5 h-3.5"}),h("button.edit","Edit")]}),u&&!k&&e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-1 px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(q,{className:"w-3.5 h-3.5"}),h("button.delete","Delete")]})]}),k&&u&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700 animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-xs text-center text-gray-600 dark:text-gray-400 mb-2",children:h("goal.deleteConfirm")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(!1),className:"flex-1 py-1.5 text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:h("button.cancel","Cancel")}),e.jsx("button",{onClick:()=>{u(a),N(!1)},className:"flex-1 py-1.5 text-xs text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:h("button.delete","Delete")})]})]})]}),j&&e.jsxs("div",{className:"px-4 pb-4 pt-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0.5",children:h("goal.savingNow","Saving now")}),e.jsxs("p",{className:c("text-sm font-semibold",A?"text-emerald-600 dark:text-emerald-400":"text-amber-600 dark:text-amber-400"),children:[g(r.current_monthly_net,b,(null==p?void 0:p.rates)||{},!1,v),e.jsx("span",{className:"text-xs font-normal text-gray-400",children:"/mo"})]})]}),e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0.5",children:h("goal.needed","Needed")}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:[g(r.required_monthly,b,(null==p?void 0:p.rates)||{},!1,v),e.jsx("span",{className:"text-xs font-normal text-gray-400",children:"/mo"})]})]})]}),!A&&!F&&y&&y.monthlyAmount>0&&e.jsx("div",{className:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:["ðŸ’° ",h("goal.insight.topExpenseTip",{category:h(`categories.${y.name}`,{defaultValue:y.name}),amount:m(y.monthlyAmount,b,(null==p?void 0:p.rates)||{},!1,v)})]})})]})]})}function $({years:a,custom:t=!1,disabled:r=!1,onClick:s,className:l}){const{t:o}=w(),n=()=>t?o("goals.card.customPeriod"):o("goals.card.yearGoal",{years:a});return e.jsxs("button",{onClick:s,disabled:r,className:c("relative p-4 rounded-xl border-2 transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1",r?"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 cursor-not-allowed opacity-60":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:shadow-md active:scale-95 cursor-pointer",l),"aria-label":o(r?"goals.card.ariaDisabled":"goals.card.ariaCreate",{label:n()}),"aria-disabled":r,children:[r&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx(C,{className:"w-3 h-3 text-gray-500 dark:text-gray-400"})})}),e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"text-3xl",children:t?"âš™ï¸":"ðŸ“Œ"}),e.jsxs("div",{children:[e.jsx("h3",{className:c("text-sm font-semibold",r?"text-gray-400":"text-gray-900 dark:text-gray-100"),children:n()}),e.jsx("p",{className:c("text-xs mt-0.5",r?"text-gray-400":"text-gray-500 dark:text-gray-400"),children:o(t?"goals.card.customDescription":1===a?"goals.card.shortTerm":3===a?"goals.card.mediumTerm":5===a?"goals.card.mediumLongTerm":10===a?"goals.card.longTerm":"goals.card.createGoal")})]})]})]})}const E=[1,3,5,10];function K({onCreateClick:a,existingGoalYears:t,maxGoals:r}){const{t:s}=w("common"),l=e=>t.includes(e),o=r-t.length;return e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:s("goals.createGoal")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o>0?s("goals.remainingSlots",{count:o}):s("goals.maxGoalsReached",{max:r})})]})}),o>0&&e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-hide",children:[E.map(t=>e.jsx($,{years:t,disabled:l(t),onClick:()=>a(t),className:"flex-shrink-0 w-28"},t)),e.jsx($,{custom:!0,disabled:o<=0,onClick:()=>a(),className:"flex-shrink-0 w-28"})]}),1===o&&t.length===r-1&&e.jsxs("button",{onClick:()=>a(),disabled:o<=0,className:"w-full py-4 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âœ¨"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s("goals.createGoal")})]})]})}function L({selectedOption:a,customDate:t,customDateError:r,onOptionChange:s,onCustomDateChange:l}){const{t:o,i18n:n}=w(),d=new Date((new Date).getFullYear(),(new Date).getMonth()+1,1),i="ja"===n.language?"ja-JP":"vi"===n.language?"vi-VN":"en-US";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:o("goals.form.startDate")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"today",checked:"today"===a,onChange:()=>s("today"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":o("goals.form.startDateTodayAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:o("goals.form.startDateToday")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:(new Date).toLocaleDateString(i)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"month_start",checked:"month_start"===a,onChange:()=>s("month_start"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":o("goals.form.startDateNextMonthAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:o("goals.form.startDateNextMonth")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:d.toLocaleDateString(i)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"custom",checked:"custom"===a,onChange:()=>s("custom"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":o("goals.form.startDateCustomAria")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:o("goals.form.startDateCustom")}),"custom"===a&&e.jsx(x,{type:"date",value:t,onChange:e=>l(e.target.value),error:r,className:"text-sm","aria-label":o("goals.form.startDateCustomAria")})]})]})]})]})}const O={emergency_fund:{icon:"ðŸ›¡ï¸",color:"bg-red-50 border-red-200 hover:bg-red-100"},home_down_payment:{icon:"ðŸ ",color:"bg-blue-50 border-blue-200 hover:bg-blue-100"},vacation_travel:{icon:"âœˆï¸",color:"bg-cyan-50 border-cyan-200 hover:bg-cyan-100"},vehicle:{icon:"ðŸš—",color:"bg-green-50 border-green-200 hover:bg-green-100"},education:{icon:"ðŸ“š",color:"bg-purple-50 border-purple-200 hover:bg-purple-100"},wedding:{icon:"ðŸ’",color:"bg-pink-50 border-pink-200 hover:bg-pink-100"},large_purchase:{icon:"ðŸ›’",color:"bg-orange-50 border-orange-200 hover:bg-orange-100"},debt_payoff:{icon:"ðŸ’³",color:"bg-yellow-50 border-yellow-200 hover:bg-yellow-100"},retirement:{icon:"ðŸ–ï¸",color:"bg-teal-50 border-teal-200 hover:bg-teal-100"},investment:{icon:"ðŸ“ˆ",color:"bg-indigo-50 border-indigo-200 hover:bg-indigo-100"},custom:{icon:"ðŸŽ¯",color:"bg-gray-50 border-gray-200 hover:bg-gray-100"}},Y=["emergency_fund","home_down_payment","vacation_travel","vehicle","education","wedding","large_purchase","debt_payoff","retirement","investment","custom"];function J({selectedType:a,onSelect:t,hasEmergencyFund:r}){const{t:s}=w();return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("goals.selectType")}),!r&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:s("goals.emergencyFundFirst")}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Y.map(l=>{const o=O[l],n=a===l,d=!r&&"emergency_fund"!==l;return e.jsxs("button",{onClick:()=>!d&&t(l),disabled:d,className:`\n                p-4 rounded-lg border-2 text-center transition-all\n                ${n?"ring-2 ring-blue-500 border-blue-500":o.color}\n                ${d?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n              `,children:[e.jsx("span",{className:"text-2xl block mb-1",children:o.icon}),e.jsx("span",{className:"text-xs font-medium text-gray-700 block",children:s(`goals.types.${l}`)})]},l)})})]})}function Q({isOpen:s,onClose:n,preselectedYears:d,editingGoalId:i}){const c=a(),{t:g,i18n:m}=w(),[v,j]=l.useState(1),[f,k]=l.useState(null),[N,C]=l.useState(""),[S,D]=l.useState(d||3),[_,T]=l.useState(""),[q,P]=l.useState("today"),[A,F]=l.useState(""),[M,I]=l.useState("JPY"),[$,E]=l.useState(null),[K,O]=l.useState({}),[Y,Q]=l.useState(""),{data:z=[]}=G(),{data:U=!0}=t({queryKey:["has-emergency-fund"],queryFn:b,enabled:s&&!i}),{data:V}=t({queryKey:["goal",i],queryFn:()=>p(i),enabled:!!i&&s});l.useEffect(()=>{if(s){if(i&&V){j(2),k(V.goal_type||"custom"),C(V.name||""),D(V.years);const e="ja"===m.language?"ja-JP":"vi"===m.language?"vi-VN":"en-US";T(V.target_amount.toLocaleString(e)),V.start_date&&(P("custom"),F(V.start_date)),E(V.account_id||null)}else j(1),k(null),C(""),D(d||3),T(""),P("today"),F(""),I("JPY"),E(null);O({}),Q("")}},[s,d,i,V]);const R=r({mutationFn:async e=>i?u(i,e):y(e),onSuccess:()=>{c.invalidateQueries({queryKey:["goals"]}),c.invalidateQueries({queryKey:["goals-progress-full"]}),c.invalidateQueries({queryKey:["has-emergency-fund"]}),c.invalidateQueries({queryKey:["accounts"]}),n()},onError:()=>{Q(g(i?"goals.errors.updateFailed":"goals.errors.createFailed"))}}),B=()=>{const e=1e4;switch(M){case"JPY":return`Â¥${e.toLocaleString()}`;case"USD":return`$${e.toLocaleString()}`;case"VND":return`${e.toLocaleString()}â‚«`;default:return e.toLocaleString()}},H=e=>{e.preventDefault();const a=function(e,a,t,r,s){const l={};s||(e<1||e>10)&&(l.years="goals.errors.yearsRange");const o=parseInt(a.replace(/[,.\s]/g,""),10);return!a||isNaN(o)?l.targetAmount="goals.errors.amountRequired":o<1e4&&(l.targetAmount="goals.errors.amountMinimum"),"custom"!==t||r||(l.customDate="goals.errors.dateRequired"),l}(S,_,q,A,d),t={};for(const[l,o]of Object.entries(a))o&&(t[l]="goals.errors.amountMinimum"===o?g(o,{amount:B()}):g(o));if(Object.keys(t).length>0)return void O(t);const r=parseInt(_.replace(/[,.\s]/g,""),10),s=function(e,a){if("today"===e)return(new Date).toISOString().split("T")[0];if("month_start"===e){const e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,1).toISOString().split("T")[0]}return a}(q,A);i?R.mutate({name:N||void 0,target_amount:r,start_date:s||void 0,account_id:$||void 0}):R.mutate({goal_type:f||"custom",name:N||void 0,target_amount:r,currency:M,years:S,start_date:s||void 0})};if(!s)return null;const W=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:n}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:g(i?"goals.modal.editTitle":1===v?"goals.modal.createTitle":`goals.types.${f}`)}),!i&&2===v&&e.jsxs("button",{onClick:()=>j(1),className:"text-sm text-blue-600 hover:underline mt-1",children:["â† ",g("common.back")]})]}),e.jsx("div",{className:"p-6",children:1!==v||i?e.jsxs("form",{onSubmit:H,className:"space-y-5",children:[e.jsx(x,{label:g("goals.form.name"),type:"text",value:N,onChange:e=>C(e.target.value),placeholder:g("goals.form.namePlaceholder")}),!d&&!i&&e.jsx(x,{label:g("goals.form.years"),type:"number",min:1,max:10,value:S,onChange:e=>D(parseInt(e.target.value,10)||1),error:K.years,required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:g("goals.form.currency")}),e.jsxs("select",{value:M,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",disabled:!!i,children:[e.jsx("option",{value:"JPY",children:g("currency.JPY")}),e.jsx("option",{value:"USD",children:g("currency.USD")}),e.jsx("option",{value:"VND",children:g("currency.VND")})]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(x,{label:g("goals.form.targetAmount"),type:"text",value:_,onChange:e=>{const a="ja"===m.language?"ja-JP":"vi"===m.language?"vi-VN":"en-US";T(function(e){const a=e.replace(/[,.\s]/g,"");return/^\d*$/.test(a)?a?parseInt(a,10).toLocaleString("en-US"):"":e}(e.target.value,a))},error:K.targetAmount,placeholder:g("goals.form.targetAmountPlaceholder"),required:!0})})]}),e.jsx(L,{selectedOption:q,customDate:A,customDateError:K.customDate,onOptionChange:P,onCustomDateChange:F}),(i||z.length>0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:g("goals.form.linkedAccount")}),e.jsxs("select",{value:$||"",onChange:e=>E(e.target.value?parseInt(e.target.value,10):null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:g("goals.form.autoCreateAccount")}),z.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",g(`account.type.${a.type}`),")"]},a.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:g("goals.form.linkedAccountHint")})]}),Y&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-800 dark:text-red-300",children:Y})]}):e.jsx(J,{selectedType:f,onSelect:e=>{k(e),N||C(g(`goals.types.${e}`)),j(2)},hasEmergencyFund:U})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-6 py-4 flex gap-3 justify-end",children:[e.jsx(h,{variant:"outline",onClick:n,disabled:R.isPending,children:g("common.cancel")}),2===v&&e.jsx(h,{variant:"primary",onClick:H,disabled:R.isPending||!_,children:R.isPending?g("goals.modal.creating"):g(i?"goals.modal.update":"goals.modal.create")})]})]})]});return"undefined"==typeof document?null:o.createPortal(W,document.body)}const z=s("/goals")({component:function(){const{t:s}=w("common"),m=a(),[x,u]=l.useState(!1),[y,h]=l.useState(),[b,p]=l.useState(null),{currency:C}=n(),{data:S}=d(),{isPrivacyMode:D}=i(),{data:_,isLoading:T}=t({queryKey:["goals"],queryFn:f}),{data:q,isLoading:G}=t({queryKey:["goals-progress-full",null==_?void 0:_.map(e=>e.id),3],queryFn:async()=>_&&0!==_.length?Promise.all(_.map(e=>k(e.id,!0,3))):[],enabled:!!_&&_.length>0}),$=new Date,E=new Date;E.setMonth(E.getMonth()-3);const{data:L}=t({queryKey:["category-breakdown-goals",3],queryFn:()=>N({start:E.toISOString().split("T")[0],end:$.toISOString().split("T")[0]}),enabled:!!_&&_.length>0}),O=l.useMemo(()=>{if(!(null==L?void 0:L.length))return;const e=[...L].filter(e=>"transfer"!==e.category.toLowerCase()).sort((e,a)=>a.amount-e.amount);return e[0]?{name:e[0].category,monthlyAmount:e[0].amount/3}:void 0},[L]),Y=r({mutationFn:j,onSuccess:()=>{m.invalidateQueries({queryKey:["goals"]}),m.invalidateQueries({queryKey:["goals-progress-full"]}),m.invalidateQueries({queryKey:["has-emergency-fund"]})}}),J=T||G,z=(null==_?void 0:_.map(e=>e.years))||[],U=z.length<4,V=l.useMemo(()=>{if(!(null==q?void 0:q.length))return null;const e=q.reduce((e,a)=>e+a.target_amount,0),a=q.reduce((e,a)=>e+a.total_saved,0);return{totalTarget:e,totalSaved:a,avgProgress:e>0?a/e*100:0,onTrackCount:q.filter(e=>e.achievability&&e.achievability.current_monthly_net>=e.achievability.required_monthly).length,totalCount:q.length}},[q]),R=e=>{h(e),p(null),u(!0)},B=e=>{p(e),h(void 0),u(!0)},H=e=>{Y.mutate(e)};return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-primary-600"}),s("goals.title")]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(null==q?void 0:q.length)||0,"/",4]})]}),V&&V.totalCount>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:g(V.totalSaved,C,(null==S?void 0:S.rates)||{},!0,D)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-500",children:g(V.totalTarget,C,(null==S?void 0:S.rates)||{},!0,D)})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:c("h-full rounded-full transition-all duration-500",V.avgProgress>=100?"bg-emerald-500":V.avgProgress>=50?"bg-primary-500":"bg-amber-500"),style:{width:`${Math.min(100,V.avgProgress)}%`}})})]}),e.jsxs("div",{className:c("flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full",V.onTrackCount===V.totalCount?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":V.onTrackCount>0?"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400":"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-400"),children:[V.onTrackCount===V.totalCount?e.jsx(A,{className:"w-3.5 h-3.5"}):V.onTrackCount>0?e.jsx(F,{className:"w-3.5 h-3.5"}):null,V.onTrackCount,"/",V.totalCount]})]})]})}),e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:J?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{size:"lg"})}):q&&q.length>0?e.jsxs("div",{className:"space-y-4",children:[q.map(a=>a.achievability&&e.jsx(I,{goalId:a.goal_id,goalName:s("goals.yearGoal",{years:a.years}),achievability:a.achievability,targetAmount:a.target_amount,currentAmount:a.total_saved,onEdit:B,onDelete:H,topExpenseCategory:O},a.goal_id)),U&&e.jsx("div",{className:"mt-6",children:e.jsx(K,{onCreateClick:R,existingGoalYears:z,maxGoals:4})})]}):_&&_.length>0?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{size:"lg"})}):e.jsx(K,{onCreateClick:R,existingGoalYears:[],maxGoals:4})}),U&&"undefined"!=typeof document&&o.createPortal(e.jsx("button",{onClick:()=>R(),className:"fixed bottom-20 right-4 z-50 w-14 h-14 rounded-full bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 text-white shadow-lg flex items-center justify-center active:scale-95 transition-all md:hidden","aria-label":s("goals.createGoal"),children:e.jsx(M,{size:28})}),document.body),e.jsx(Q,{isOpen:x,onClose:()=>{u(!1),h(void 0),p(null)},preselectedYears:y,editingGoalId:b})]})}});export{z as Route};
