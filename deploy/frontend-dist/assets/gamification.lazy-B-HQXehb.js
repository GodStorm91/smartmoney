import{k as G,u as D,j as r,l as v,m as Ee,S as $,n as qe,C as Ye,o as Ve,P as Ke,r as g,X as Pe,p as Je,q as Qe,_ as et,s as j,a as ze,b as tt,c as rt,d as ot,e as at,v as nt,B as ee,L as fe,g as te,I as it,U as st,t as _,w as lt,x as ct,y as dt,z as xe,i as ut}from"./index-Cl0A3kUX.js";import{gamificationService as X}from"./gamification-service-2q7yw7q9.js";import{S as de,P as ht,i as pt,c as mt}from"./heic-converter-DPiwhpWY.js";import{C as ue}from"./crown-CZVtmO8E.js";import{C as gt}from"./chevron-down-geDZ1eWv.js";import{R as ve}from"./ResponsiveModal-DrdZ4wcM.js";import{Z as ft,a as xt}from"./zoom-out-BMUolYcO.js";import{F as vt}from"./funnel-mcKCpHV6.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],bt=G("circle",yt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Ct=G("flame",wt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"M10.5 3 8 9l4 13 4-13-2.5-6",key:"b3dvk1"}],["path",{d:"M17 3a2 2 0 0 1 1.6.8l3 4a2 2 0 0 1 .013 2.382l-7.99 10.986a2 2 0 0 1-3.247 0l-7.99-10.986A2 2 0 0 1 2.4 7.8l2.998-3.997A2 2 0 0 1 7 3z",key:"7w4byz"}],["path",{d:"M2 9h20",key:"16fsjt"}]],Nt=G("gem",jt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],De=G("lock",kt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],_t=G("rotate-cw",St);function Rt({level:a,totalXP:n,xpToNextLevel:e,progressPercent:t,currentStreak:o,badgesUnlocked:i,badgesTotal:l,avatarEmoji:s="ðŸ˜Š",onAvatarClick:d}){const{t:c}=D("common"),u=m=>m>=30?"text-red-400":m>=7?"text-orange-400":m>=3?"text-yellow-400":"text-gray-400";return r.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-blue-600 to-purple-600 p-5 text-white shadow-xl",children:[r.jsx("div",{className:"absolute -right-8 -top-8 h-32 w-32 rounded-full bg-white/10"}),r.jsx("div",{className:"absolute -bottom-4 -left-4 h-24 w-24 rounded-full bg-white/5"}),r.jsxs("div",{className:"relative z-10",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[r.jsxs("button",{onClick:d,className:"group relative flex-shrink-0","aria-label":c("gamification.profile.changeAvatar")||"Change avatar",children:[r.jsx("div",{className:"w-16 h-16 rounded-full bg-white/20 flex items-center justify-center text-3xl shadow-lg ring-2 ring-white/30 group-hover:ring-white/50 transition-all",children:s}),r.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-white/90 flex items-center justify-center shadow",children:r.jsx("span",{className:"text-xs",children:"âœï¸"})})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"flex items-baseline gap-2",children:r.jsx("span",{className:"text-3xl font-bold",children:c("gamification.level",{level:a})||`Level ${a}`})}),r.jsxs("div",{className:"text-sm text-white/80",children:[n.toLocaleString()," XP ",c("gamification.total")||"total"]})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[r.jsx("span",{className:"text-white/80",children:c("gamification.progress")||"Progress"}),r.jsxs("span",{className:"font-medium",children:[Math.round(t),"% â†’ ",c("gamification.levelShort",{level:a+1})||`Lv.${a+1}`]})]}),r.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden",children:r.jsx("div",{className:v("h-full bg-gradient-to-r from-yellow-300 to-yellow-500 rounded-full transition-all duration-500",t>=90&&"animate-pulse"),style:{width:`${Math.min(100,t)}%`}})}),r.jsxs("div",{className:"flex justify-between text-xs text-white/60 mt-1",children:[r.jsxs("span",{children:[(n-n%e).toLocaleString()," XP"]}),r.jsxs("span",{children:[e.toLocaleString()," XP ",c("gamification.xpNeeded")||"needed"]})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ct,{className:v("h-6 w-6",u(o))}),r.jsxs("div",{children:[r.jsx("span",{className:"text-xl font-bold",children:o}),r.jsx("span",{className:"text-sm text-white/80 ml-1",children:c("gamification.dayStreak",{days:o})||"day streak"})]}),o>=7&&r.jsxs("span",{className:"px-2 py-0.5 text-xs bg-orange-500/30 rounded-full",children:["ðŸ”¥ ",c("gamification.onFire")||"On Fire!"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ee,{className:"h-5 w-5 text-yellow-300"}),r.jsxs("span",{className:"text-lg font-semibold",children:[i,"/",l]}),r.jsx("span",{className:"text-sm text-white/80",children:c("gamification.badges")||"badges"})]})]})]})]})}const Et={legendary:"ring-yellow-400/60 shadow-yellow-400/30",epic:"ring-purple-400/60 shadow-purple-400/30",rare:"ring-blue-400/60 shadow-blue-400/30",common:"ring-gray-400/60 shadow-gray-400/30"},Pt={legendary:"bg-gradient-to-br from-yellow-100 to-yellow-200 dark:from-yellow-900/30 dark:to-yellow-800/30",epic:"bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900/30 dark:to-purple-800/30",rare:"bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30",common:"bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700"};function zt({badges:a,onBadgeClick:n}){const{t:e}=D("common");return a.length===0?r.jsxs("div",{className:"py-6",children:[r.jsxs("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3 flex items-center gap-2",children:[r.jsx($,{className:"w-4 h-4"}),e("gamification.recentUnlocks")||"Recent Unlocks"]}),r.jsx("div",{className:"flex items-center justify-center py-8 px-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700",children:r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:e("gamification.noRecentUnlocks")||"Complete actions to earn badges!"})})]}):r.jsxs("div",{className:"py-2",children:[r.jsxs("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3 flex items-center gap-2",children:[r.jsx($,{className:"w-4 h-4"}),e("gamification.recentUnlocks")||"Recent Unlocks"]}),r.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-hide",children:a.map(t=>{const o=t.rarity||"common";return r.jsxs("button",{onClick:()=>n(t),className:v("flex-shrink-0 p-4 rounded-xl ring-2 shadow-lg","hover:scale-105 active:scale-95 transition-all duration-200",Et[o],Pt[o]),children:[r.jsx("div",{className:"w-14 h-14 mx-auto mb-2 rounded-full bg-white/80 dark:bg-gray-800/80 flex items-center justify-center text-3xl shadow-inner",children:t.icon}),r.jsx("p",{className:"text-xs font-semibold text-gray-800 dark:text-gray-200 text-center truncate max-w-[80px]",children:t.name}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center capitalize",children:o})]},t.id)})})]})}const Dt={legendary:"text-yellow-600 dark:text-yellow-400",epic:"text-purple-600 dark:text-purple-400",rare:"text-blue-600 dark:text-blue-400",common:"text-gray-600 dark:text-gray-400"},At={legendary:"bg-yellow-500",epic:"bg-purple-500",rare:"bg-blue-500",common:"bg-gray-500"};function Mt({badges:a,onAddTransaction:n,onBadgeClick:e}){const{t}=D("common");return a.length===0?null:r.jsxs("div",{className:"py-2",children:[r.jsxs("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3 flex items-center gap-2",children:[r.jsx(qe,{className:"w-4 h-4"}),t("gamification.nextToUnlock")||"Next To Unlock"]}),r.jsxs(Ye,{className:"overflow-hidden",children:[r.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:a.map(o=>{const i=o.rarity||"common",l=o.progress>=75;return r.jsxs("button",{onClick:()=>e(o),className:"w-full p-4 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-left",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-2xl flex-shrink-0",children:o.icon}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:o.name}),r.jsx("span",{className:v("text-xs font-medium capitalize",Dt[i]),children:i})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:v("h-full rounded-full transition-all duration-500",At[i],l&&"animate-pulse"),style:{width:`${o.progress}%`}})}),r.jsxs("span",{className:v("text-sm font-semibold min-w-[40px] text-right",l?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"),children:[o.progress,"%"]})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:o.description})]}),r.jsx(Ve,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]},o.id)})}),r.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-100 dark:border-gray-800",children:r.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-colors",children:[r.jsx(Ke,{className:"w-5 h-5"}),t("gamification.addTransaction")||"Add Transaction"]})})]})]})}const Lt={legendary:{icon:ue,label:"Legendary",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",textColor:"text-yellow-800 dark:text-yellow-300",borderColor:"border-yellow-200 dark:border-yellow-800",iconColor:"text-yellow-500"},epic:{icon:Nt,label:"Epic",bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-800 dark:text-purple-300",borderColor:"border-purple-200 dark:border-purple-800",iconColor:"text-purple-500"},rare:{icon:de,label:"Rare",bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-800 dark:text-blue-300",borderColor:"border-blue-200 dark:border-blue-800",iconColor:"text-blue-500"},common:{icon:bt,label:"Common",bgColor:"bg-gray-50 dark:bg-gray-800",textColor:"text-gray-800 dark:text-gray-300",borderColor:"border-gray-200 dark:border-gray-700",iconColor:"text-gray-500"}},ye=["legendary","epic","rare","common"];function Tt({achievements:a,onBadgeClick:n}){const{t:e}=D("common"),[t,o]=g.useState(new Set),i=s=>{o(d=>{const c=new Set(d);return c.has(s)?c.delete(s):c.add(s),c})},l=ye.reduce((s,d)=>{const c=a.filter(u=>(u.rarity||"common")===d);return c.sort((u,m)=>u.unlocked!==m.unlocked?u.unlocked?-1:1:m.xp_reward-u.xp_reward),s[d]=c,s},{});return r.jsxs("div",{className:"py-2",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3",children:e("gamification.allBadges")||"All Badges"}),r.jsx("div",{className:"space-y-2",children:ye.map(s=>{const d=l[s],c=Lt[s],u=c.icon,m=d.filter(h=>h.unlocked).length,x=t.has(s);return r.jsxs("div",{className:v("rounded-xl border overflow-hidden",c.borderColor),children:[r.jsxs("button",{onClick:()=>i(s),className:v("w-full flex items-center justify-between p-4 transition-colors",c.bgColor,"hover:opacity-90"),children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(u,{className:v("w-5 h-5",c.iconColor)}),r.jsx("span",{className:v("font-semibold",c.textColor),children:e(`gamification.rarity.${s}`)||c.label}),r.jsxs("span",{className:v("px-2 py-0.5 text-xs font-medium rounded-full",c.bgColor,c.textColor),children:[m,"/",d.length]})]}),r.jsx(gt,{className:v("w-5 h-5 text-gray-400 transition-transform duration-200",x&&"rotate-180")})]}),r.jsx("div",{className:v("grid transition-all duration-300 ease-out",x?"grid-rows-[1fr]":"grid-rows-[0fr]"),children:r.jsx("div",{className:"overflow-hidden",children:r.jsx("div",{className:"p-4 pt-2 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3",children:d.map(h=>r.jsxs("button",{onClick:()=>n(h),className:v("relative p-3 rounded-xl transition-all duration-200","hover:scale-105 active:scale-95",h.unlocked?"bg-white dark:bg-gray-800 shadow-sm hover:shadow-md":"bg-gray-100 dark:bg-gray-900 opacity-60"),children:[r.jsx("div",{className:v("w-12 h-12 mx-auto mb-2 rounded-full flex items-center justify-center text-2xl",h.unlocked?"bg-gray-100 dark:bg-gray-700":"bg-gray-200 dark:bg-gray-800 grayscale"),children:h.icon}),r.jsx("p",{className:v("text-xs font-medium text-center truncate",h.unlocked?"text-gray-800 dark:text-gray-200":"text-gray-500 dark:text-gray-500"),children:h.name}),r.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["+",h.xp_reward," XP"]}),!h.unlocked&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-xl bg-black/5 dark:bg-black/20",children:r.jsx(De,{className:"w-4 h-4 text-gray-400"})}),!h.unlocked&&h.progress>0&&r.jsx("div",{className:"absolute bottom-1 left-1 right-1",children:r.jsx("div",{className:"h-1 bg-gray-300 dark:bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${h.progress}%`}})})})]},h.id))})})})]},s)})})]})}function Ft({isOpen:a,onClose:n,title:e,children:t,className:o}){const i=g.useRef(null);return g.useEffect(()=>{const l=s=>{s.key==="Escape"&&a&&n()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[a,n]),g.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),a?r.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-black/50 animate-fade-in",onClick:n}),r.jsxs("div",{ref:i,className:v("absolute bottom-0 left-0 right-0 bg-white dark:bg-gray-900","rounded-t-2xl shadow-xl max-h-[90vh] overflow-hidden","animate-slide-up",o),children:[r.jsx("div",{className:"flex justify-center pt-3 pb-2",children:r.jsx("div",{className:"w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e&&r.jsxs("div",{className:"flex items-center justify-between px-4 pb-3 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e}),r.jsx("button",{onClick:n,className:"p-2 -mr-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:r.jsx(Pe,{size:20})})]}),r.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)] p-4",children:t})]})]}):null}const It={legendary:{label:"Legendary",bgColor:"bg-yellow-100 dark:bg-yellow-900/30",textColor:"text-yellow-700 dark:text-yellow-300",borderColor:"border-yellow-400"},epic:{label:"Epic",bgColor:"bg-purple-100 dark:bg-purple-900/30",textColor:"text-purple-700 dark:text-purple-300",borderColor:"border-purple-400"},rare:{label:"Rare",bgColor:"bg-blue-100 dark:bg-blue-900/30",textColor:"text-blue-700 dark:text-blue-300",borderColor:"border-blue-400"},common:{label:"Common",bgColor:"bg-gray-100 dark:bg-gray-800",textColor:"text-gray-700 dark:text-gray-300",borderColor:"border-gray-400"}};function Ut({badge:a,onClose:n}){const{t:e}=D("common");if(!a)return null;const t=a.rarity||"common",o=It[t];return r.jsx(Ft,{isOpen:!!a,onClose:n,title:a.name,children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsxs("div",{className:v("w-24 h-24 rounded-2xl flex items-center justify-center text-5xl shadow-lg border-2",o.bgColor,o.borderColor,!a.unlocked&&"grayscale opacity-60"),children:[a.icon,!a.unlocked&&r.jsx("div",{className:"absolute",children:r.jsx(De,{className:"w-8 h-8 text-gray-500"})})]}),r.jsx("span",{className:v("mt-3 px-3 py-1 text-sm font-semibold rounded-full",o.bgColor,o.textColor),children:e(`gamification.rarity.${t}`)||o.label})]}),r.jsx("div",{className:"text-center",children:r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.description})}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:v("p-4 rounded-xl text-center",o.bgColor),children:[r.jsx(de,{className:v("w-5 h-5 mx-auto mb-1",o.textColor)}),r.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:["+",a.xp_reward]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e("gamification.xpReward")||"XP Reward"})]}),r.jsxs("div",{className:"p-4 rounded-xl bg-gray-100 dark:bg-gray-800 text-center",children:[r.jsx("div",{className:"w-5 h-5 mx-auto mb-1 text-gray-500 flex items-center justify-center",children:"ðŸ“"}),r.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 capitalize",children:a.category}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e("gamification.category")||"Category"})]})]}),a.unlocked?r.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600 dark:text-green-400",children:[r.jsx(Je,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:e("gamification.badge.unlockedOn",{date:a.unlocked_at?new Date(a.unlocked_at).toLocaleDateString():"Unknown"})})]}):a.progress>0?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:e("gamification.progress")||"Progress"}),r.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[a.progress,"%"]})]}),r.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:v("h-full rounded-full transition-all duration-500",a.progress>=75?"bg-green-500 animate-pulse":"bg-blue-500"),style:{width:`${a.progress}%`}})})]}):r.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 text-sm",children:e("gamification.notStarted")||"Not started yet"})]})})}var be=!1,I,re,oe,Y,V,Ae,K,ae,ne,ie,Me,se,le,Le,Te;function N(){if(!be){be=!0;var a=navigator.userAgent,n=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(a),e=/(Mac OS X)|(Windows)|(Linux)/.exec(a);if(se=/\b(iPhone|iP[ao]d)/.exec(a),le=/\b(iP[ao]d)/.exec(a),ie=/Android/i.exec(a),Le=/FBAN\/\w+;/i.exec(a),Te=/Mobile/i.exec(a),Me=!!/Win64/.exec(a),n){I=n[1]?parseFloat(n[1]):n[5]?parseFloat(n[5]):NaN,I&&document&&document.documentMode&&(I=document.documentMode);var t=/(?:Trident\/(\d+.\d+))/.exec(a);Ae=t?parseFloat(t[1])+4:I,re=n[2]?parseFloat(n[2]):NaN,oe=n[3]?parseFloat(n[3]):NaN,Y=n[4]?parseFloat(n[4]):NaN,Y?(n=/(?:Chrome\/(\d+\.\d+))/.exec(a),V=n&&n[1]?parseFloat(n[1]):NaN):V=NaN}else I=re=oe=V=Y=NaN;if(e){if(e[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(a);K=o?parseFloat(o[1].replace("_",".")):!0}else K=!1;ae=!!e[2],ne=!!e[3]}else K=ae=ne=!1}}var ce={ie:function(){return N()||I},ieCompatibilityMode:function(){return N()||Ae>I},ie64:function(){return ce.ie()&&Me},firefox:function(){return N()||re},opera:function(){return N()||oe},webkit:function(){return N()||Y},safari:function(){return ce.webkit()},chrome:function(){return N()||V},windows:function(){return N()||ae},osx:function(){return N()||K},linux:function(){return N()||ne},iphone:function(){return N()||se},mobile:function(){return N()||se||le||ie||Te},nativeApp:function(){return N()||Le},android:function(){return N()||ie},ipad:function(){return N()||le}},Wt=ce,Ot=!!(typeof window<"u"&&window.document&&window.document.createElement),Zt={canUseDOM:Ot},Bt=Zt,Fe=Bt,Ie;Fe.canUseDOM&&(Ie=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function $t(a,n){if(!Fe.canUseDOM||n&&!("addEventListener"in document))return!1;var e="on"+a,t=e in document;if(!t){var o=document.createElement("div");o.setAttribute(e,"return;"),t=typeof o[e]=="function"}return!t&&Ie&&a==="wheel"&&(t=document.implementation.hasFeature("Events.wheel","3.0")),t}var Gt=$t,Ht=Wt,Xt=Gt,we=10,Ce=40,je=800;function Ue(a){var n=0,e=0,t=0,o=0;return"detail"in a&&(e=a.detail),"wheelDelta"in a&&(e=-a.wheelDelta/120),"wheelDeltaY"in a&&(e=-a.wheelDeltaY/120),"wheelDeltaX"in a&&(n=-a.wheelDeltaX/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(n=e,e=0),t=n*we,o=e*we,"deltaY"in a&&(o=a.deltaY),"deltaX"in a&&(t=a.deltaX),(t||o)&&a.deltaMode&&(a.deltaMode==1?(t*=Ce,o*=Ce):(t*=je,o*=je)),t&&!n&&(n=t<1?-1:1),o&&!e&&(e=o<1?-1:1),{spinX:n,spinY:e,pixelX:t,pixelY:o}}Ue.getEventType=function(){return Ht.firefox()?"DOMMouseScroll":Xt("wheel")?"wheel":"mousewheel"};var qt=Ue,Yt=qt;const Vt=Qe(Yt);function Kt(a,n,e,t,o,i){i===void 0&&(i=0);var l=W(a,n,i),s=l.width,d=l.height,c=Math.min(s,e),u=Math.min(d,t);return c>u*o?{width:u*o,height:u}:{width:c,height:c/o}}function Jt(a){return a.width>a.height?a.width/a.naturalWidth:a.height/a.naturalHeight}function B(a,n,e,t,o){o===void 0&&(o=0);var i=W(n.width,n.height,o),l=i.width,s=i.height;return{x:Ne(a.x,l,e.width,t),y:Ne(a.y,s,e.height,t)}}function Ne(a,n,e,t){var o=n*t/2-e/2;return J(a,-o,o)}function ke(a,n){return Math.sqrt(Math.pow(a.y-n.y,2)+Math.pow(a.x-n.x,2))}function Se(a,n){return Math.atan2(n.y-a.y,n.x-a.x)*180/Math.PI}function Qt(a,n,e,t,o,i,l){i===void 0&&(i=0),l===void 0&&(l=!0);var s=l?er:tr,d=W(n.width,n.height,i),c=W(n.naturalWidth,n.naturalHeight,i),u={x:s(100,((d.width-e.width/o)/2-a.x/o)/d.width*100),y:s(100,((d.height-e.height/o)/2-a.y/o)/d.height*100),width:s(100,e.width/d.width*100/o),height:s(100,e.height/d.height*100/o)},m=Math.round(s(c.width,u.width*c.width/100)),x=Math.round(s(c.height,u.height*c.height/100)),h=c.width>=c.height*t,w=h?{width:Math.round(x*t),height:x}:{width:m,height:Math.round(m/t)},y=j(j({},w),{x:Math.round(s(c.width-w.width,u.x*c.width/100)),y:Math.round(s(c.height-w.height,u.y*c.height/100))});return{croppedAreaPercentages:u,croppedAreaPixels:y}}function er(a,n){return Math.min(a,Math.max(0,n))}function tr(a,n){return n}function rr(a,n,e,t,o,i){var l=W(n.width,n.height,e),s=J(t.width/l.width*(100/a.width),o,i),d={x:s*l.width/2-t.width/2-l.width*s*(a.x/100),y:s*l.height/2-t.height/2-l.height*s*(a.y/100)};return{crop:d,zoom:s}}function or(a,n,e){var t=Jt(n);return e.height>e.width?e.height/(a.height*t):e.width/(a.width*t)}function ar(a,n,e,t,o,i){e===void 0&&(e=0);var l=W(n.naturalWidth,n.naturalHeight,e),s=J(or(a,n,t),o,i),d=t.height>t.width?t.height/a.height:t.width/a.width,c={x:((l.width-a.width)/2-a.x)*d,y:((l.height-a.height)/2-a.y)*d};return{crop:c,zoom:s}}function _e(a,n){return{x:(n.x+a.x)/2,y:(n.y+a.y)/2}}function nr(a){return a*Math.PI/180}function W(a,n,e){var t=nr(e);return{width:Math.abs(Math.cos(t)*a)+Math.abs(Math.sin(t)*n),height:Math.abs(Math.sin(t)*a)+Math.abs(Math.cos(t)*n)}}function J(a,n,e){return Math.min(Math.max(a,n),e)}function q(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];return a.filter(function(e){return typeof e=="string"&&e.length>0}).join(" ").trim()}var ir=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,sr=1,lr=3,cr=1,dr=function(a){et(n,a);function n(){var e=a!==null&&a.apply(this,arguments)||this;return e.cropperRef=g.createRef(),e.imageRef=g.createRef(),e.videoRef=g.createRef(),e.containerPosition={x:0,y:0},e.containerRef=null,e.styleRef=null,e.containerRect=null,e.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},e.dragStartPosition={x:0,y:0},e.dragStartCrop={x:0,y:0},e.gestureZoomStart=0,e.gestureRotationStart=0,e.isTouching=!1,e.lastPinchDistance=0,e.lastPinchRotation=0,e.rafDragTimeout=null,e.rafPinchTimeout=null,e.wheelTimer=null,e.currentDoc=typeof document<"u"?document:null,e.currentWindow=typeof window<"u"?window:null,e.resizeObserver=null,e.previousCropSize=null,e.isInitialized=!1,e.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},e.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!e.containerRef)){var t=!0;e.resizeObserver=new window.ResizeObserver(function(o){if(t){t=!1;return}e.computeSizes()}),e.resizeObserver.observe(e.containerRef)}},e.preventZoomSafari=function(t){return t.preventDefault()},e.cleanEvents=function(){e.currentDoc&&(e.currentDoc.removeEventListener("mousemove",e.onMouseMove),e.currentDoc.removeEventListener("mouseup",e.onDragStopped),e.currentDoc.removeEventListener("touchmove",e.onTouchMove),e.currentDoc.removeEventListener("touchend",e.onDragStopped),e.currentDoc.removeEventListener("gesturechange",e.onGestureChange),e.currentDoc.removeEventListener("gestureend",e.onGestureEnd),e.currentDoc.removeEventListener("scroll",e.onScroll))},e.clearScrollEvent=function(){e.containerRef&&e.containerRef.removeEventListener("wheel",e.onWheel),e.wheelTimer&&clearTimeout(e.wheelTimer)},e.onMediaLoad=function(){var t=e.computeSizes();t&&(e.previousCropSize=t,e.emitCropData(),e.setInitialCrop(t),e.isInitialized=!0),e.props.onMediaLoaded&&e.props.onMediaLoaded(e.mediaSize)},e.setInitialCrop=function(t){if(e.props.initialCroppedAreaPercentages){var o=rr(e.props.initialCroppedAreaPercentages,e.mediaSize,e.props.rotation,t,e.props.minZoom,e.props.maxZoom),i=o.crop,l=o.zoom;e.props.onCropChange(i),e.props.onZoomChange&&e.props.onZoomChange(l)}else if(e.props.initialCroppedAreaPixels){var s=ar(e.props.initialCroppedAreaPixels,e.mediaSize,e.props.rotation,t,e.props.minZoom,e.props.maxZoom),i=s.crop,l=s.zoom;e.props.onCropChange(i),e.props.onZoomChange&&e.props.onZoomChange(l)}},e.computeSizes=function(){var t,o,i,l,s,d,c=e.imageRef.current||e.videoRef.current;if(c&&e.containerRef){e.containerRect=e.containerRef.getBoundingClientRect(),e.saveContainerPosition();var u=e.containerRect.width/e.containerRect.height,m=((t=e.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((o=e.videoRef.current)===null||o===void 0?void 0:o.videoWidth)||0,x=((i=e.imageRef.current)===null||i===void 0?void 0:i.naturalHeight)||((l=e.videoRef.current)===null||l===void 0?void 0:l.videoHeight)||0,h=c.offsetWidth<m||c.offsetHeight<x,w=m/x,y=void 0;if(h)switch(e.state.mediaObjectFit){default:case"contain":y=u>w?{width:e.containerRect.height*w,height:e.containerRect.height}:{width:e.containerRect.width,height:e.containerRect.width/w};break;case"horizontal-cover":y={width:e.containerRect.width,height:e.containerRect.width/w};break;case"vertical-cover":y={width:e.containerRect.height*w,height:e.containerRect.height};break}else y={width:c.offsetWidth,height:c.offsetHeight};e.mediaSize=j(j({},y),{naturalWidth:m,naturalHeight:x}),e.props.setMediaSize&&e.props.setMediaSize(e.mediaSize);var k=e.props.cropSize?e.props.cropSize:Kt(e.mediaSize.width,e.mediaSize.height,e.containerRect.width,e.containerRect.height,e.props.aspect,e.props.rotation);return(((s=e.state.cropSize)===null||s===void 0?void 0:s.height)!==k.height||((d=e.state.cropSize)===null||d===void 0?void 0:d.width)!==k.width)&&e.props.onCropSizeChange&&e.props.onCropSizeChange(k),e.setState({cropSize:k},e.recomputeCropPosition),e.props.setCropSize&&e.props.setCropSize(k),k}},e.saveContainerPosition=function(){if(e.containerRef){var t=e.containerRef.getBoundingClientRect();e.containerPosition={x:t.left,y:t.top}}},e.onMouseDown=function(t){e.currentDoc&&(t.preventDefault(),e.currentDoc.addEventListener("mousemove",e.onMouseMove),e.currentDoc.addEventListener("mouseup",e.onDragStopped),e.saveContainerPosition(),e.onDragStart(n.getMousePoint(t)))},e.onMouseMove=function(t){return e.onDrag(n.getMousePoint(t))},e.onScroll=function(t){e.currentDoc&&(t.preventDefault(),e.saveContainerPosition())},e.onTouchStart=function(t){e.currentDoc&&(e.isTouching=!0,!(e.props.onTouchRequest&&!e.props.onTouchRequest(t))&&(e.currentDoc.addEventListener("touchmove",e.onTouchMove,{passive:!1}),e.currentDoc.addEventListener("touchend",e.onDragStopped),e.saveContainerPosition(),t.touches.length===2?e.onPinchStart(t):t.touches.length===1&&e.onDragStart(n.getTouchPoint(t.touches[0]))))},e.onTouchMove=function(t){t.preventDefault(),t.touches.length===2?e.onPinchMove(t):t.touches.length===1&&e.onDrag(n.getTouchPoint(t.touches[0]))},e.onGestureStart=function(t){e.currentDoc&&(t.preventDefault(),e.currentDoc.addEventListener("gesturechange",e.onGestureChange),e.currentDoc.addEventListener("gestureend",e.onGestureEnd),e.gestureZoomStart=e.props.zoom,e.gestureRotationStart=e.props.rotation)},e.onGestureChange=function(t){if(t.preventDefault(),!e.isTouching){var o=n.getMousePoint(t),i=e.gestureZoomStart-1+t.scale;if(e.setNewZoom(i,o,{shouldUpdatePosition:!0}),e.props.onRotationChange){var l=e.gestureRotationStart+t.rotation;e.props.onRotationChange(l)}}},e.onGestureEnd=function(t){e.cleanEvents()},e.onDragStart=function(t){var o,i,l=t.x,s=t.y;e.dragStartPosition={x:l,y:s},e.dragStartCrop=j({},e.props.crop),(i=(o=e.props).onInteractionStart)===null||i===void 0||i.call(o)},e.onDrag=function(t){var o=t.x,i=t.y;e.currentWindow&&(e.rafDragTimeout&&e.currentWindow.cancelAnimationFrame(e.rafDragTimeout),e.rafDragTimeout=e.currentWindow.requestAnimationFrame(function(){if(e.state.cropSize&&!(o===void 0||i===void 0)){var l=o-e.dragStartPosition.x,s=i-e.dragStartPosition.y,d={x:e.dragStartCrop.x+l,y:e.dragStartCrop.y+s},c=e.props.restrictPosition?B(d,e.mediaSize,e.state.cropSize,e.props.zoom,e.props.rotation):d;e.props.onCropChange(c)}}))},e.onDragStopped=function(){var t,o;e.isTouching=!1,e.cleanEvents(),e.emitCropData(),(o=(t=e.props).onInteractionEnd)===null||o===void 0||o.call(t)},e.onWheel=function(t){if(e.currentWindow&&!(e.props.onWheelRequest&&!e.props.onWheelRequest(t))){t.preventDefault();var o=n.getMousePoint(t),i=Vt(t).pixelY,l=e.props.zoom-i*e.props.zoomSpeed/200;e.setNewZoom(l,o,{shouldUpdatePosition:!0}),e.state.hasWheelJustStarted||e.setState({hasWheelJustStarted:!0},function(){var s,d;return(d=(s=e.props).onInteractionStart)===null||d===void 0?void 0:d.call(s)}),e.wheelTimer&&clearTimeout(e.wheelTimer),e.wheelTimer=e.currentWindow.setTimeout(function(){return e.setState({hasWheelJustStarted:!1},function(){var s,d;return(d=(s=e.props).onInteractionEnd)===null||d===void 0?void 0:d.call(s)})},250)}},e.getPointOnContainer=function(t,o){var i=t.x,l=t.y;if(!e.containerRect)throw new Error("The Cropper is not mounted");return{x:e.containerRect.width/2-(i-o.x),y:e.containerRect.height/2-(l-o.y)}},e.getPointOnMedia=function(t){var o=t.x,i=t.y,l=e.props,s=l.crop,d=l.zoom;return{x:(o+s.x)/d,y:(i+s.y)/d}},e.setNewZoom=function(t,o,i){var l=i===void 0?{}:i,s=l.shouldUpdatePosition,d=s===void 0?!0:s;if(!(!e.state.cropSize||!e.props.onZoomChange)){var c=J(t,e.props.minZoom,e.props.maxZoom);if(d){var u=e.getPointOnContainer(o,e.containerPosition),m=e.getPointOnMedia(u),x={x:m.x*c-u.x,y:m.y*c-u.y},h=e.props.restrictPosition?B(x,e.mediaSize,e.state.cropSize,c,e.props.rotation):x;e.props.onCropChange(h)}e.props.onZoomChange(c)}},e.getCropData=function(){if(!e.state.cropSize)return null;var t=e.props.restrictPosition?B(e.props.crop,e.mediaSize,e.state.cropSize,e.props.zoom,e.props.rotation):e.props.crop;return Qt(t,e.mediaSize,e.state.cropSize,e.getAspect(),e.props.zoom,e.props.rotation,e.props.restrictPosition)},e.emitCropData=function(){var t=e.getCropData();if(t){var o=t.croppedAreaPercentages,i=t.croppedAreaPixels;e.props.onCropComplete&&e.props.onCropComplete(o,i),e.props.onCropAreaChange&&e.props.onCropAreaChange(o,i)}},e.emitCropAreaChange=function(){var t=e.getCropData();if(t){var o=t.croppedAreaPercentages,i=t.croppedAreaPixels;e.props.onCropAreaChange&&e.props.onCropAreaChange(o,i)}},e.recomputeCropPosition=function(){var t,o;if(e.state.cropSize){var i=e.props.crop;if(e.isInitialized&&(!((t=e.previousCropSize)===null||t===void 0)&&t.width)&&(!((o=e.previousCropSize)===null||o===void 0)&&o.height)){var l=Math.abs(e.previousCropSize.width-e.state.cropSize.width)>1e-6||Math.abs(e.previousCropSize.height-e.state.cropSize.height)>1e-6;if(l){var s=e.state.cropSize.width/e.previousCropSize.width,d=e.state.cropSize.height/e.previousCropSize.height;i={x:e.props.crop.x*s,y:e.props.crop.y*d}}}var c=e.props.restrictPosition?B(i,e.mediaSize,e.state.cropSize,e.props.zoom,e.props.rotation):i;e.previousCropSize=e.state.cropSize,e.props.onCropChange(c),e.emitCropData()}},e.onKeyDown=function(t){var o,i,l=e.props,s=l.crop,d=l.onCropChange,c=l.keyboardStep,u=l.zoom,m=l.rotation,x=c;if(e.state.cropSize){t.shiftKey&&(x*=.2);var h=j({},s);switch(t.key){case"ArrowUp":h.y-=x,t.preventDefault();break;case"ArrowDown":h.y+=x,t.preventDefault();break;case"ArrowLeft":h.x-=x,t.preventDefault();break;case"ArrowRight":h.x+=x,t.preventDefault();break;default:return}e.props.restrictPosition&&(h=B(h,e.mediaSize,e.state.cropSize,u,m)),t.repeat||(i=(o=e.props).onInteractionStart)===null||i===void 0||i.call(o),d(h)}},e.onKeyUp=function(t){var o,i;switch(t.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":t.preventDefault();break;default:return}e.emitCropData(),(i=(o=e.props).onInteractionEnd)===null||i===void 0||i.call(o)},e}return n.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=ir,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},n.prototype.componentWillUnmount=function(){var e,t;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((t=this.styleRef.parentNode)===null||t===void 0||t.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},n.prototype.componentDidUpdate=function(e){var t,o,i,l,s,d,c,u,m;e.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):e.aspect!==this.props.aspect?this.computeSizes():e.objectFit!==this.props.objectFit?this.computeSizes():e.zoom!==this.props.zoom?this.recomputeCropPosition():((t=e.cropSize)===null||t===void 0?void 0:t.height)!==((o=this.props.cropSize)===null||o===void 0?void 0:o.height)||((i=e.cropSize)===null||i===void 0?void 0:i.width)!==((l=this.props.cropSize)===null||l===void 0?void 0:l.width)?this.computeSizes():(((s=e.crop)===null||s===void 0?void 0:s.x)!==((d=this.props.crop)===null||d===void 0?void 0:d.x)||((c=e.crop)===null||c===void 0?void 0:c.y)!==((u=this.props.crop)===null||u===void 0?void 0:u.y))&&this.emitCropAreaChange(),e.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),e.video!==this.props.video&&((m=this.videoRef.current)===null||m===void 0||m.load());var x=this.getObjectFit();x!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:x},this.computeSizes)},n.prototype.getAspect=function(){var e=this.props,t=e.cropSize,o=e.aspect;return t?t.width/t.height:o},n.prototype.getObjectFit=function(){var e,t,o,i;if(this.props.objectFit==="cover"){var l=this.imageRef.current||this.videoRef.current;if(l&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var s=this.containerRect.width/this.containerRect.height,d=((e=this.imageRef.current)===null||e===void 0?void 0:e.naturalWidth)||((t=this.videoRef.current)===null||t===void 0?void 0:t.videoWidth)||0,c=((o=this.imageRef.current)===null||o===void 0?void 0:o.naturalHeight)||((i=this.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,u=d/c;return u<s?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},n.prototype.onPinchStart=function(e){var t=n.getTouchPoint(e.touches[0]),o=n.getTouchPoint(e.touches[1]);this.lastPinchDistance=ke(t,o),this.lastPinchRotation=Se(t,o),this.onDragStart(_e(t,o))},n.prototype.onPinchMove=function(e){var t=this;if(!(!this.currentDoc||!this.currentWindow)){var o=n.getTouchPoint(e.touches[0]),i=n.getTouchPoint(e.touches[1]),l=_e(o,i);this.onDrag(l),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var s=ke(o,i),d=t.props.zoom*(s/t.lastPinchDistance);t.setNewZoom(d,l,{shouldUpdatePosition:!1}),t.lastPinchDistance=s;var c=Se(o,i),u=t.props.rotation+(c-t.lastPinchRotation);t.props.onRotationChange&&t.props.onRotationChange(u),t.lastPinchRotation=c})}},n.prototype.render=function(){var e=this,t,o=this.props,i=o.image,l=o.video,s=o.mediaProps,d=o.cropperProps,c=o.transform,u=o.crop,m=u.x,x=u.y,h=o.rotation,w=o.zoom,y=o.cropShape,k=o.showGrid,T=o.roundCropAreaPixels,R=o.style,A=R.containerStyle,O=R.cropAreaStyle,E=R.mediaStyle,S=o.classes,P=S.containerClassName,b=S.cropAreaClassName,f=S.mediaClassName,z=(t=this.state.mediaObjectFit)!==null&&t!==void 0?t:this.getObjectFit();return g.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(Z){return e.containerRef=Z},"data-testid":"container",style:A,className:q("reactEasyCrop_Container",P)},i?g.createElement("img",j({alt:"",className:q("reactEasyCrop_Image",z==="contain"&&"reactEasyCrop_Contain",z==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",z==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",f)},s,{src:i,ref:this.imageRef,style:j(j({},E),{transform:c||"translate(".concat(m,"px, ").concat(x,"px) rotate(").concat(h,"deg) scale(").concat(w,")")}),onLoad:this.onMediaLoad})):l&&g.createElement("video",j({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:q("reactEasyCrop_Video",z==="contain"&&"reactEasyCrop_Contain",z==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",z==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",f)},s,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:j(j({},E),{transform:c||"translate(".concat(m,"px, ").concat(x,"px) rotate(").concat(h,"deg) scale(").concat(w,")")}),controls:!1}),(Array.isArray(l)?l:[{src:l}]).map(function(M){return g.createElement("source",j({key:M.src},M))})),this.state.cropSize&&g.createElement("div",j({ref:this.cropperRef,style:j(j({},O),{width:T?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:T?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:q("reactEasyCrop_CropArea",y==="round"&&"reactEasyCrop_CropAreaRound",k&&"reactEasyCrop_CropAreaGrid",b)},d)))},n.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:lr,minZoom:sr,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:cr},n.getMousePoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},n.getTouchPoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},n}(g.Component);const ur={common:"bg-gray-100 border-gray-300 dark:bg-gray-800",rare:"bg-blue-100 border-blue-300 dark:bg-blue-900/30",epic:"bg-purple-100 border-purple-300 dark:bg-purple-900/30",legendary:"bg-yellow-100 border-yellow-400 dark:bg-yellow-900/30"},hr={all:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300",common:"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300",rare:"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300",epic:"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300",legendary:"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-700 dark:text-yellow-300"},pr=a=>new Promise((n,e)=>{const t=new Image;t.addEventListener("load",()=>n(t)),t.addEventListener("error",o=>e(o)),t.setAttribute("crossOrigin","anonymous"),t.src=a});async function mr(a,n){const e=await pr(a),t=document.createElement("canvas"),o=t.getContext("2d");if(!o)throw new Error("No 2d context");const i=256;return t.width=i,t.height=i,o.drawImage(e,n.x,n.y,n.width,n.height,0,0,i,i),new Promise((l,s)=>{t.toBlob(d=>{d?l(d):s(new Error("Canvas toBlob failed"))},"image/jpeg",.9)})}function gr({isOpen:a,onClose:n}){const{t:e}=D("common"),{data:t,refetch:o}=ze(),{data:i}=tt(),{data:l=[]}=rt(1),{mutate:s,isPending:d}=ot(),{mutate:c,isPending:u}=at(),{mutate:m,isPending:x}=nt(),[h,w]=g.useState(!1),[y,k]=g.useState(""),[T,R]=g.useState(!1),[A,O]=g.useState("all"),E=g.useRef(null),[S,P]=g.useState(null),[b,f]=g.useState({x:0,y:0}),[z,M]=g.useState(1),[Z,H]=g.useState(0),[he,We]=g.useState(null),Q=(i==null?void 0:i.current_level)||(t==null?void 0:t.level)||1,Oe=(i==null?void 0:i.total_xp)||(t==null?void 0:t.total_xp)||0,F=t==null?void 0:t.active_avatar,pe=l.filter(p=>A==="all"||p.rarity===A),me=l.reduce((p,C)=>(p[C.rarity]=(p[C.rarity]||0)+1,p),{});g.useEffect(()=>{t!=null&&t.display_name&&k(t.display_name)},[t==null?void 0:t.display_name]),g.useEffect(()=>{a||(P(null),f({x:0,y:0}),M(1),H(0))},[a]);const Ze=g.useCallback((p,C)=>{We(C)},[]),Be=()=>{y.trim()&&m({displayName:y.trim()},{onSuccess:()=>{_.success(e("gamification.profile.nameSaved")||"Profile updated!"),w(!1),o()},onError:()=>_.error(e("gamification.profile.saveError")||"Failed to update profile")})},$e=p=>{d||s(p,{onSuccess:()=>{_.success(e("gamification.profile.avatarSelected")||"Avatar selected!"),o()},onError:()=>_.error(e("gamification.profile.avatarError")||"Failed to select avatar")})},Ge=async p=>{var U;const C=(U=p.target.files)==null?void 0:U[0];if(C){E.current&&(E.current.value="");try{let L=C;if(pt(C)&&(R(!0),_.info("Converting HEIC image..."),L=await mt(C),R(!1)),!L.type.startsWith("image/")){_.error("Please select a valid image file");return}if(L.size>5*1024*1024){_.error("Image must be less than 5MB");return}const Xe=URL.createObjectURL(L);P(Xe)}catch{R(!1),_.error("Failed to process image")}}},He=async()=>{if(!(!S||!he))try{const p=await mr(S,he),C=new File([p],"avatar.jpg",{type:"image/jpeg"});c(C,{onSuccess:()=>{_.success("Avatar uploaded!"),P(null),o()},onError:()=>_.error("Failed to upload avatar")})}catch{_.error("Failed to crop image")}},ge=()=>{S&&URL.revokeObjectURL(S),P(null),f({x:0,y:0}),M(1),H(0)};return S?r.jsx(ve,{isOpen:a,onClose:ge,title:"Crop Avatar",size:"lg",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"relative h-64 sm:h-80 bg-gray-900 rounded-xl overflow-hidden",children:r.jsx(dr,{image:S,crop:b,zoom:z,rotation:Z,aspect:1,cropShape:"round",showGrid:!1,onCropChange:f,onZoomChange:M,onRotationChange:H,onCropComplete:Ze})}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ft,{className:"w-4 h-4 text-gray-500"}),r.jsx("input",{type:"range",min:1,max:3,step:.1,value:z,onChange:p=>M(Number(p.target.value)),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),r.jsx(xt,{className:"w-4 h-4 text-gray-500"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(_t,{className:"w-4 h-4 text-gray-500"}),r.jsx("input",{type:"range",min:0,max:360,step:1,value:Z,onChange:p=>H(Number(p.target.value)),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),r.jsxs("span",{className:"text-xs text-gray-500 w-10",children:[Z,"Â°"]})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(ee,{variant:"outline",className:"flex-1",onClick:ge,children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Cancel"]}),r.jsxs(ee,{className:"flex-1",onClick:He,disabled:u,children:[u?r.jsx(fe,{className:"w-4 h-4 mr-2 animate-spin"}):r.jsx(te,{className:"w-4 h-4 mr-2"}),"Save Avatar"]})]})]})}):r.jsx(ve,{isOpen:a,onClose:n,title:e("gamification.profile.title")||"Profile",size:"lg",children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-4xl shadow-lg overflow-hidden",children:F!=null&&F.image_url?r.jsx("img",{src:F.image_url,alt:"Avatar",className:"w-full h-full object-cover"}):(F==null?void 0:F.emoji)||"ðŸ˜Š"}),r.jsxs("div",{className:"flex-1",children:[h?r.jsxs("div",{className:"flex gap-2",children:[r.jsx(it,{value:y,onChange:p=>k(p.target.value),placeholder:e("gamification.profile.displayNamePlaceholder")||"Display Name",className:"flex-1",autoFocus:!0}),r.jsx(ee,{onClick:Be,size:"sm",disabled:x,children:r.jsx(te,{className:"w-4 h-4"})})]}):r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:(t==null?void 0:t.display_name)||e("gamification.profile.newUser")||"New User"}),r.jsx("button",{onClick:()=>w(!0),className:"p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:r.jsx(ht,{className:"w-4 h-4 text-gray-500"})})]}),r.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(ue,{className:"w-4 h-4 text-yellow-500"}),e("gamification.level",{level:Q})||`Level ${Q}`]}),r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(de,{className:"w-4 h-4 text-yellow-500"}),Oe.toLocaleString()," XP"]})]})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 uppercase",children:e("gamification.profile.selectAvatar")||"Select Avatar"}),r.jsxs("button",{onClick:()=>{var p;return(p=E.current)==null?void 0:p.click()},disabled:u||T,className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",children:[T||u?r.jsx(fe,{className:"w-4 h-4 animate-spin"}):r.jsx(st,{className:"w-4 h-4"}),e("gamification.profile.uploadCustom")||"Upload Custom"]}),r.jsx("input",{type:"file",ref:E,onChange:Ge,accept:"image/*,.heic,.heif",className:"hidden"})]}),r.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:["all","common","rare","epic","legendary"].map(p=>r.jsxs("button",{onClick:()=>O(p),className:v("px-3 py-1 rounded-full text-xs font-medium transition-all",A===p?v(hr[p],"ring-2 ring-offset-1 ring-blue-500"):"bg-gray-100 dark:bg-gray-800 text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700"),children:[p==="all"?"All":p.charAt(0).toUpperCase()+p.slice(1),p!=="all"&&me[p]?` (${me[p]})`:""]},p))}),r.jsx("div",{className:"grid grid-cols-5 sm:grid-cols-6 gap-2",children:pe.map(p=>{var L;const C=p.unlock_level<=Q,U=p.id===((L=t==null?void 0:t.active_avatar)==null?void 0:L.id);return r.jsxs("button",{onClick:()=>C&&$e(p.id),disabled:!C||d,className:v("aspect-square rounded-xl flex items-center justify-center text-2xl relative transition-all","border-2",C?ur[p.rarity]:"opacity-40 bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700",U&&"ring-2 ring-green-500 ring-offset-2 dark:ring-offset-gray-900",C&&!U&&"hover:scale-105 active:scale-95"),children:[p.image_url?r.jsx("img",{src:p.image_url,alt:p.name,className:"w-full h-full object-cover rounded-lg"}):p.emoji||"ðŸ˜Š",U&&r.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center shadow-sm",children:r.jsx(te,{className:"w-3 h-3 text-white"})}),!C&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/70 dark:bg-gray-900/70 rounded-xl backdrop-blur-sm",children:r.jsxs("span",{className:"text-xs font-medium",children:["Lv",p.unlock_level]})})]},p.id)})}),pe.length===0&&r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(vt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),r.jsxs("p",{className:"text-sm",children:["No ",A," avatars available"]})]})]})]})})}const Re=["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6","#14b8a6"];function fr({active:a,duration:n=3e3,pieces:e=50,onComplete:t}){const[o,i]=g.useState([]),[l,s]=g.useState(!1);return g.useEffect(()=>{if(a){const d=Array.from({length:e},(u,m)=>({id:m,x:Math.random()*100,color:Re[Math.floor(Math.random()*Re.length)],delay:Math.random()*.5,duration:2+Math.random()*2,rotation:Math.random()*360}));i(d),s(!0);const c=setTimeout(()=>{s(!1),i([]),t==null||t()},n);return()=>clearTimeout(c)}},[a,n,e,t]),!l||o.length===0?null:lt.createPortal(r.jsx("div",{className:"fixed inset-0 pointer-events-none z-[100] overflow-hidden",children:o.map(d=>r.jsx("div",{className:"absolute top-0 animate-confetti-fall",style:{left:`${d.x}%`,animationDelay:`${d.delay}s`,animationDuration:`${d.duration}s`},children:r.jsx("div",{className:"w-3 h-3 animate-confetti-spin",style:{backgroundColor:d.color,transform:`rotate(${d.rotation}deg)`,borderRadius:Math.random()>.5?"50%":"2px"}})},d.id))}),document.body)}function xr({open:a,newLevel:n,onClose:e}){const{t}=D("common");return g.useEffect(()=>{if(a){const o=setTimeout(e,5e3);return()=>clearTimeout(o)}},[a,e]),g.useEffect(()=>{const o=i=>{i.key==="Escape"&&a&&e()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[a,e]),a?r.jsxs(r.Fragment,{children:[r.jsx(fr,{active:a,duration:3e3,pieces:100}),r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm animate-fade-in",onClick:e,role:"dialog","aria-modal":"true","aria-labelledby":"levelup-title",children:r.jsxs("div",{className:v("relative text-center p-8 rounded-3xl bg-gradient-to-br from-yellow-400 via-orange-500 to-pink-500","shadow-2xl transform transition-all duration-300","animate-bounce-in"),onClick:o=>o.stopPropagation(),children:[r.jsx($,{className:"absolute -top-4 -left-4 w-8 h-8 text-yellow-300 animate-pulse"}),r.jsx($,{className:"absolute -top-2 -right-6 w-6 h-6 text-pink-300 animate-pulse delay-100"}),r.jsx($,{className:"absolute -bottom-3 left-8 w-5 h-5 text-orange-300 animate-pulse delay-200"}),r.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-white/20 flex items-center justify-center",children:r.jsx(ue,{className:"w-12 h-12 text-yellow-100"})}),r.jsx("h2",{id:"levelup-title",className:"text-5xl font-bold text-white mb-2 drop-shadow-lg",children:t("gamification.levelUp",{level:n})||`Level ${n}!`}),r.jsx("p",{className:"text-white/90 text-lg mb-6",children:t("gamification.levelUpMessage")||"Congratulations! Keep up the great work!"}),r.jsx("button",{onClick:e,className:v("px-8 py-3 rounded-full font-bold text-lg","bg-white text-orange-600 hover:bg-orange-50","shadow-lg hover:shadow-xl transition-all","focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-orange-500"),children:t("button.continue")||"Continue"})]})})]}):null}function vr(){var S,P;const{t:a}=D("common"),n=ct(),{addXPGain:e}=dt(),[t,o]=g.useState(!1),[i,l]=g.useState(null),[s,d]=g.useState(new Set),[c,u]=g.useState(null),{data:m,refetch:x}=xe({queryKey:["gamification-stats"],queryFn:()=>X.getStats()}),{data:h,refetch:w}=xe({queryKey:["achievements"],queryFn:()=>X.getAchievements()}),{data:y}=ze();if(g.useEffect(()=>{(async()=>{try{const f=await X.trackLogin();f.streak_updated&&(_.success(a("gamification.badge.dayStreak",{days:f.current_streak,xp:f.xp_earned})),e(f.xp_earned,"Daily check-in"),x(),w()),f.level_up&&u({newLevel:f.level_up.new_level})}catch(f){console.error("Failed to track login:",f)}})()},[]),g.useEffect(()=>{if(!(h!=null&&h.achievements))return;const b=new Set(h.achievements.filter(f=>f.unlocked).map(f=>f.id));h.achievements.forEach(f=>{f.unlocked&&!s.has(f.id)&&(_.success(a("gamification.badge.achievementUnlocked",{name:f.name,xp:f.xp_reward})),e(f.xp_reward,`Achievement: ${f.name}`))}),d(b)},[h,s,e,a]),!m||!h)return r.jsx("div",{className:"flex items-center justify-center py-20",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});const k=X.calculateLevelProgress(m.total_xp,m.current_level,m.xp_to_next_level),T=h.achievements.filter(b=>b.unlocked).length,R=h.achievements.length,A=h.achievements.filter(b=>b.unlocked&&b.unlocked_at).sort((b,f)=>new Date(f.unlocked_at).getTime()-new Date(b.unlocked_at).getTime()).slice(0,3),O=h.achievements.filter(b=>!b.unlocked&&b.progress>0&&b.progress<100).sort((b,f)=>f.progress-b.progress).slice(0,2),E=((S=y==null?void 0:y.active_avatar)==null?void 0:S.emoji)||((P=y==null?void 0:y.active_avatar)==null?void 0:P.icon)||"ðŸ˜Š";return r.jsxs("div",{className:"space-y-6 max-w-3xl mx-auto pb-8",children:[r.jsx(Rt,{level:m.current_level,totalXP:m.total_xp,xpToNextLevel:m.xp_to_next_level,progressPercent:k,currentStreak:m.current_streak,badgesUnlocked:T,badgesTotal:R,avatarEmoji:E,onAvatarClick:()=>o(!0)}),r.jsx(zt,{badges:A,onBadgeClick:l}),r.jsx(Mt,{badges:O,onAddTransaction:()=>n({to:"/transactions"}),onBadgeClick:l}),r.jsx(Tt,{achievements:h.achievements,onBadgeClick:l}),r.jsx(gr,{isOpen:t,onClose:()=>o(!1)}),r.jsx(Ut,{badge:i,onClose:()=>l(null)}),r.jsx(xr,{open:!!c,newLevel:(c==null?void 0:c.newLevel)??0,onClose:()=>u(null)})]})}const yr=()=>{const{t:a}=D("common");return r.jsxs("div",{className:"container mx-auto px-4 py-8",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[r.jsx(Ee,{className:"h-8 w-8 text-yellow-500"}),a("gamification.title")]}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:a("gamification.subtitle")})]}),r.jsx(vr,{})]})},Rr=ut("/gamification")({component:yr});export{Rr as Route};
