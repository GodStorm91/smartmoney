import{k as Mr,aT as T,aS as _e,r as O,$ as Ft,M as zt,u as z,al as we,j as i,aP as I,l as M,az as zn,aA as Lr,K as Br,a8 as fn,A as Tt,C as V,E as It,a$ as Rn,H as $r,a3 as $e,B as rt,y as Fr,b0 as hn,b1 as Kn,b2 as fe,L as zr,h as Vn,aV as Rr,aB as Kr,b3 as Vr,t as Hn,S as Me,R as Hr,ay as Yr,b4 as Ur,b5 as Wr,b6 as Gr,a2 as qr,b7 as Xr,b8 as Wt,a0 as Jr,b9 as oe,ba as Qr,aL as Zr,i as ts}from"./index-CMujLMxZ.js";import{f as ft,L as it,B as ce,n as Ot,C as he,A as Yn,l as st,h as gt,E as es,m as Fe,F as ns,o as Qt,G as Un,j as Ct,H as pe,i as ge,D as rs,u as Wn,S as mn,I as ss,d as is,r as Gn,J as as,K as os,s as Zt,x as qn,M as Dt,N as Xn,R as ke,O as Se,P as Jn,Q as cs}from"./generateCategoricalChart-DengxyUy.js";import{X as Rt,Y as Kt,L as qe,C as Qn,a as ls}from"./LineChart-DpGWtKpa.js";import{c as pn,a as gn,A as us,b as ds}from"./ai-categorization-service-BYEfK8Lx.js";import{D as fs}from"./download-BsoRScS3.js";import{M as hs}from"./mail-CJFjhtMW.js";import{C as ms}from"./chevron-up-K8yL_lhx.js";import{C as ps}from"./chevron-down-BxGI7ueC.js";import{T as ze}from"./triangle-alert-ttKO4DPO.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M5 12h14",key:"1ays0h"}]],ys=Mr("minus",gs);var xs=["layout","type","stroke","connectNulls","isRange","ref"],bs=["key"],Zn;function Mt(e){"@babel/helpers - typeof";return Mt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(e)}function tr(e,t){if(e==null)return{};var n=vs(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function vs(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function jt(){return jt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},jt.apply(this,arguments)}function yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function pt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yn(Object(n),!0).forEach(function(r){at(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function js(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,nr(r.key),r)}}function _s(e,t,n){return t&&xn(e.prototype,t),n&&xn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ws(e,t,n){return t=ye(t),ks(e,er()?Reflect.construct(t,n||[],ye(e).constructor):t.apply(e,n))}function ks(e,t){if(t&&(Mt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ss(e)}function Ss(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function er(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(er=function(){return!!e})()}function ye(e){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ye(e)}function As(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Re(e,t)}function Re(e,t){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Re(e,t)}function at(e,t,n){return t=nr(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nr(e){var t=Ns(e,"string");return Mt(t)=="symbol"?t:t+""}function Ns(e,t){if(Mt(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Mt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wt=function(e){function t(){var n;js(this,t);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return n=ws(this,t,[].concat(s)),at(n,"state",{isAnimationFinished:!0}),at(n,"id",Wn("recharts-area-")),at(n,"handleAnimationEnd",function(){var o=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),ge(o)&&o()}),at(n,"handleAnimationStart",function(){var o=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),ge(o)&&o()}),n}return As(t,e),_s(t,[{key:"renderDots",value:function(r,s,a){var o=this.props.isAnimationActive,l=this.state.isAnimationFinished;if(o&&!l)return null;var c=this.props,u=c.dot,d=c.points,f=c.dataKey,h=ft(this.props,!1),y=ft(u,!0),m=d.map(function(x,g){var b=pt(pt(pt({key:"dot-".concat(g),r:3},h),y),{},{index:g,cx:x.x,cy:x.y,dataKey:f,value:x.value,payload:x.payload,points:d});return t.renderDotItem(u,b)}),p={clipPath:r?"url(#clipPath-".concat(s?"":"dots-").concat(a,")"):null};return T.createElement(it,jt({className:"recharts-area-dots"},p),m)}},{key:"renderHorizontalRect",value:function(r){var s=this.props,a=s.baseLine,o=s.points,l=s.strokeWidth,c=o[0].x,u=o[o.length-1].x,d=r*Math.abs(c-u),f=ce(o.map(function(h){return h.y||0}));return Ot(a)&&typeof a=="number"?f=Math.max(a,f):a&&Array.isArray(a)&&a.length&&(f=Math.max(ce(a.map(function(h){return h.y||0})),f)),Ot(f)?T.createElement("rect",{x:c<u?c:c-d,y:0,width:d,height:Math.floor(f+(l?parseInt("".concat(l),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var s=this.props,a=s.baseLine,o=s.points,l=s.strokeWidth,c=o[0].y,u=o[o.length-1].y,d=r*Math.abs(c-u),f=ce(o.map(function(h){return h.x||0}));return Ot(a)&&typeof a=="number"?f=Math.max(a,f):a&&Array.isArray(a)&&a.length&&(f=Math.max(ce(a.map(function(h){return h.x||0})),f)),Ot(f)?T.createElement("rect",{x:0,y:c<u?c:c-d,width:f+(l?parseInt("".concat(l),10):1),height:Math.floor(d)}):null}},{key:"renderClipRect",value:function(r){var s=this.props.layout;return s==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,s,a,o){var l=this.props,c=l.layout,u=l.type,d=l.stroke,f=l.connectNulls,h=l.isRange;l.ref;var y=tr(l,xs);return T.createElement(it,{clipPath:a?"url(#clipPath-".concat(o,")"):null},T.createElement(he,jt({},ft(y,!0),{points:r,connectNulls:f,type:u,baseLine:s,layout:c,stroke:"none",className:"recharts-area-area"})),d!=="none"&&T.createElement(he,jt({},ft(this.props,!1),{className:"recharts-area-curve",layout:c,type:u,connectNulls:f,fill:"none",points:r})),d!=="none"&&h&&T.createElement(he,jt({},ft(this.props,!1),{className:"recharts-area-curve",layout:c,type:u,connectNulls:f,fill:"none",points:s})))}},{key:"renderAreaWithAnimation",value:function(r,s){var a=this,o=this.props,l=o.points,c=o.baseLine,u=o.isAnimationActive,d=o.animationBegin,f=o.animationDuration,h=o.animationEasing,y=o.animationId,m=this.state,p=m.prevPoints,x=m.prevBaseLine;return T.createElement(Yn,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"area-".concat(y),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(g){var b=g.t;if(p){var v=p.length/l.length,_=l.map(function(S,N){var E=Math.floor(N*v);if(p[E]){var P=p[E],C=st(P.x,S.x),H=st(P.y,S.y);return pt(pt({},S),{},{x:C(b),y:H(b)})}return S}),k;if(Ot(c)&&typeof c=="number"){var w=st(x,c);k=w(b)}else if(gt(c)||es(c)){var j=st(x,0);k=j(b)}else k=c.map(function(S,N){var E=Math.floor(N*v);if(x[E]){var P=x[E],C=st(P.x,S.x),H=st(P.y,S.y);return pt(pt({},S),{},{x:C(b),y:H(b)})}return S});return a.renderAreaStatically(_,k,r,s)}return T.createElement(it,null,T.createElement("defs",null,T.createElement("clipPath",{id:"animationClipPath-".concat(s)},a.renderClipRect(b))),T.createElement(it,{clipPath:"url(#animationClipPath-".concat(s,")")},a.renderAreaStatically(l,c,r,s)))})}},{key:"renderArea",value:function(r,s){var a=this.props,o=a.points,l=a.baseLine,c=a.isAnimationActive,u=this.state,d=u.prevPoints,f=u.prevBaseLine,h=u.totalLength;return c&&o&&o.length&&(!d&&h>0||!Fe(d,o)||!Fe(f,l))?this.renderAreaWithAnimation(r,s):this.renderAreaStatically(o,l,r,s)}},{key:"render",value:function(){var r,s=this.props,a=s.hide,o=s.dot,l=s.points,c=s.className,u=s.top,d=s.left,f=s.xAxis,h=s.yAxis,y=s.width,m=s.height,p=s.isAnimationActive,x=s.id;if(a||!l||!l.length)return null;var g=this.state.isAnimationFinished,b=l.length===1,v=_e("recharts-area",c),_=f&&f.allowDataOverflow,k=h&&h.allowDataOverflow,w=_||k,j=gt(x)?this.id:x,S=(r=ft(o,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},N=S.r,E=N===void 0?3:N,P=S.strokeWidth,C=P===void 0?2:P,H=ns(o)?o:{},W=H.clipDot,G=W===void 0?!0:W,X=E*2+C;return T.createElement(it,{className:v},_||k?T.createElement("defs",null,T.createElement("clipPath",{id:"clipPath-".concat(j)},T.createElement("rect",{x:_?d:d-y/2,y:k?u:u-m/2,width:_?y:y*2,height:k?m:m*2})),!G&&T.createElement("clipPath",{id:"clipPath-dots-".concat(j)},T.createElement("rect",{x:d-X/2,y:u-X/2,width:y+X,height:m+X}))):null,b?null:this.renderArea(w,j),(o||b)&&this.renderDots(w,G,j),(!p||g)&&Qt.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:s.curPoints,prevBaseLine:s.curBaseLine}:r.points!==s.curPoints||r.baseLine!==s.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])}(O.PureComponent);Zn=wt;at(wt,"displayName","Area");at(wt,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Un.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});at(wt,"getBaseValue",function(e,t,n,r){var s=e.layout,a=e.baseValue,o=t.props.baseValue,l=o??a;if(Ot(l)&&typeof l=="number")return l;var c=s==="horizontal"?r:n,u=c.scale.domain();if(c.type==="number"){var d=Math.max(u[0],u[1]),f=Math.min(u[0],u[1]);return l==="dataMin"?f:l==="dataMax"||d<0?d:Math.max(Math.min(u[0],u[1]),0)}return l==="dataMin"?u[0]:l==="dataMax"?u[1]:u[0]});at(wt,"getComposedData",function(e){var t=e.props,n=e.item,r=e.xAxis,s=e.yAxis,a=e.xAxisTicks,o=e.yAxisTicks,l=e.bandSize,c=e.dataKey,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,y=t.layout,m=u&&u.length,p=Zn.getBaseValue(t,n,r,s),x=y==="horizontal",g=!1,b=f.map(function(_,k){var w;m?w=u[d+k]:(w=Ct(_,c),Array.isArray(w)?g=!0:w=[p,w]);var j=w[1]==null||m&&Ct(_,c)==null;return x?{x:pe({axis:r,ticks:a,bandSize:l,entry:_,index:k}),y:j?null:s.scale(w[1]),value:w,payload:_}:{x:j?null:r.scale(w[1]),y:pe({axis:s,ticks:o,bandSize:l,entry:_,index:k}),value:w,payload:_}}),v;return m||g?v=b.map(function(_){var k=Array.isArray(_.value)?_.value[0]:null;return x?{x:_.x,y:k!=null&&_.y!=null?s.scale(k):null}:{x:k!=null?r.scale(k):null,y:_.y}}):v=x?s.scale(p):r.scale(p),pt({points:b,baseLine:v,layout:y,isRange:g},h)});at(wt,"renderDotItem",function(e,t){var n;if(T.isValidElement(e))n=T.cloneElement(e,t);else if(ge(e))n=e(t);else{var r=_e("recharts-area-dot",typeof e!="boolean"?e.className:""),s=t.key,a=tr(t,bs);n=T.createElement(rs,jt({},a,{key:s,className:r}))}return n});function Lt(e){"@babel/helpers - typeof";return Lt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(e)}function Es(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ps(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ir(r.key),r)}}function Os(e,t,n){return t&&Ps(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ts(e,t,n){return t=xe(t),Cs(e,rr()?Reflect.construct(t,n||[],xe(e).constructor):t.apply(e,n))}function Cs(e,t){if(t&&(Lt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Is(e)}function Is(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rr=function(){return!!e})()}function xe(e){return xe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},xe(e)}function Ds(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ke(e,t)}function Ke(e,t){return Ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Ke(e,t)}function sr(e,t,n){return t=ir(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ir(e){var t=Ms(e,"string");return Lt(t)=="symbol"?t:t+""}function Ms(e,t){if(Lt(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Lt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ae=function(e){function t(){return Es(this,t),Ts(this,t,arguments)}return Ds(t,e),Os(t,[{key:"render",value:function(){return null}}])}(O.Component);sr(Ae,"displayName","ZAxis");sr(Ae,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var Ls=["option","isActive"];function qt(){return qt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qt.apply(this,arguments)}function Bs(e,t){if(e==null)return{};var n=$s(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function $s(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function Fs(e){var t=e.option,n=e.isActive,r=Bs(e,Ls);return typeof t=="string"?O.createElement(mn,qt({option:O.createElement(ss,qt({type:t},r)),isActive:n,shapeType:"symbols"},r)):O.createElement(mn,qt({option:t,isActive:n,shapeType:"symbols"},r))}function Bt(e){"@babel/helpers - typeof";return Bt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bt(e)}function Xt(){return Xt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xt.apply(this,arguments)}function bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bn(Object(n),!0).forEach(function(r){yt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bn(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function zs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,or(r.key),r)}}function Rs(e,t,n){return t&&vn(e.prototype,t),n&&vn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ks(e,t,n){return t=be(t),Vs(e,ar()?Reflect.construct(t,n||[],be(e).constructor):t.apply(e,n))}function Vs(e,t){if(t&&(Bt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Hs(e)}function Hs(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ar(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ar=function(){return!!e})()}function be(e){return be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},be(e)}function Ys(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ve(e,t)}function Ve(e,t){return Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Ve(e,t)}function yt(e,t,n){return t=or(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function or(e){var t=Us(e,"string");return Bt(t)=="symbol"?t:t+""}function Us(e,t){if(Bt(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Bt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ne=function(e){function t(){var n;zs(this,t);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return n=Ks(this,t,[].concat(s)),yt(n,"state",{isAnimationFinished:!1}),yt(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0})}),yt(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1})}),yt(n,"id",Wn("recharts-scatter-")),n}return Ys(t,e),Rs(t,[{key:"renderSymbolsStatically",value:function(r){var s=this,a=this.props,o=a.shape,l=a.activeShape,c=a.activeIndex,u=ft(this.props,!1);return r.map(function(d,f){var h=c===f,y=h?l:o,m=Q(Q({},u),d);return T.createElement(it,Xt({className:"recharts-scatter-symbol",key:"symbol-".concat(d==null?void 0:d.cx,"-").concat(d==null?void 0:d.cy,"-").concat(d==null?void 0:d.size,"-").concat(f)},is(s.props,d,f),{role:"img"}),T.createElement(Fs,Xt({option:y,isActive:h,key:"symbol-".concat(f)},m)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,s=this.props,a=s.points,o=s.isAnimationActive,l=s.animationBegin,c=s.animationDuration,u=s.animationEasing,d=s.animationId,f=this.state.prevPoints;return T.createElement(Yn,{begin:l,duration:c,isActive:o,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(d),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(h){var y=h.t,m=a.map(function(p,x){var g=f&&f[x];if(g){var b=st(g.cx,p.cx),v=st(g.cy,p.cy),_=st(g.size,p.size);return Q(Q({},p),{},{cx:b(y),cy:v(y),size:_(y)})}var k=st(0,p.size);return Q(Q({},p),{},{size:k(y)})});return T.createElement(it,null,r.renderSymbolsStatically(m))})}},{key:"renderSymbols",value:function(){var r=this.props,s=r.points,a=r.isAnimationActive,o=this.state.prevPoints;return a&&s&&s.length&&(!o||!Fe(o,s))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(s)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var s=this.props,a=s.points,o=s.xAxis,l=s.yAxis,c=s.children,u=Gn(c,as);return u?u.map(function(d,f){var h=d.props,y=h.direction,m=h.dataKey;return T.cloneElement(d,{key:"".concat(y,"-").concat(m,"-").concat(a[f]),data:a,xAxis:o,yAxis:l,layout:y==="x"?"vertical":"horizontal",dataPointFormatter:function(x,g){return{x:x.cx,y:x.cy,value:y==="x"?+x.node.x:+x.node.y,errorVal:Ct(x,g)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,s=r.points,a=r.line,o=r.lineType,l=r.lineJointType,c=ft(this.props,!1),u=ft(a,!1),d,f;if(o==="joint")d=s.map(function(v){return{x:v.cx,y:v.cy}});else if(o==="fitting"){var h=os(s),y=h.xmin,m=h.xmax,p=h.a,x=h.b,g=function(_){return p*_+x};d=[{x:y,y:g(y)},{x:m,y:g(m)}]}var b=Q(Q(Q({},c),{},{fill:"none",stroke:c&&c.fill},u),{},{points:d});return T.isValidElement(a)?f=T.cloneElement(a,b):ge(a)?f=a(b):f=T.createElement(he,Xt({},b,{type:l})),T.createElement(it,{className:"recharts-scatter-line",key:"recharts-scatter-line"},f)}},{key:"render",value:function(){var r=this.props,s=r.hide,a=r.points,o=r.line,l=r.className,c=r.xAxis,u=r.yAxis,d=r.left,f=r.top,h=r.width,y=r.height,m=r.id,p=r.isAnimationActive;if(s||!a||!a.length)return null;var x=this.state.isAnimationFinished,g=_e("recharts-scatter",l),b=c&&c.allowDataOverflow,v=u&&u.allowDataOverflow,_=b||v,k=gt(m)?this.id:m;return T.createElement(it,{className:g,clipPath:_?"url(#clipPath-".concat(k,")"):null},b||v?T.createElement("defs",null,T.createElement("clipPath",{id:"clipPath-".concat(k)},T.createElement("rect",{x:b?d:d-h/2,y:v?f:f-y/2,width:b?h:h*2,height:v?y:y*2}))):null,o&&this.renderLine(),this.renderErrorBar(),T.createElement(it,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!p||x)&&Qt.renderCallByParent(this.props,a))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:s.curPoints}:r.points!==s.curPoints?{curPoints:r.points}:null}}])}(O.PureComponent);yt(Ne,"displayName","Scatter");yt(Ne,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Un.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});yt(Ne,"getComposedData",function(e){var t=e.xAxis,n=e.yAxis,r=e.zAxis,s=e.item,a=e.displayedData,o=e.xAxisTicks,l=e.yAxisTicks,c=e.offset,u=s.props.tooltipType,d=Gn(s.props.children,Zt),f=gt(t.dataKey)?s.props.dataKey:t.dataKey,h=gt(n.dataKey)?s.props.dataKey:n.dataKey,y=r&&r.dataKey,m=r?r.range:Ae.defaultProps.range,p=m&&m[0],x=t.scale.bandwidth?t.scale.bandwidth():0,g=n.scale.bandwidth?n.scale.bandwidth():0,b=a.map(function(v,_){var k=Ct(v,f),w=Ct(v,h),j=!gt(y)&&Ct(v,y)||"-",S=[{name:gt(t.dataKey)?s.props.name:t.name||t.dataKey,unit:t.unit||"",value:k,payload:v,dataKey:f,type:u},{name:gt(n.dataKey)?s.props.name:n.name||n.dataKey,unit:n.unit||"",value:w,payload:v,dataKey:h,type:u}];j!=="-"&&S.push({name:r.name||r.dataKey,unit:r.unit||"",value:j,payload:v,dataKey:y,type:u});var N=pe({axis:t,ticks:o,bandSize:x,entry:v,index:_,dataKey:f}),E=pe({axis:n,ticks:l,bandSize:g,entry:v,index:_,dataKey:h}),P=j!=="-"?r.scale(j):p,C=Math.sqrt(Math.max(P,0)/Math.PI);return Q(Q({},v),{},{cx:N,cy:E,x:N-C,y:E-C,xAxis:t,yAxis:n,zAxis:r,width:2*C,height:2*C,size:P,node:{x:k,y:w,z:j},tooltipPayload:S,tooltipPosition:{x:N,y:E},payload:v},d&&d[_]&&d[_].props)});return Q({points:b},c)});var cr=qn({chartName:"BarChart",GraphicalChild:Dt,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Rt},{axisType:"yAxis",AxisComp:Kt}],formatAxisMap:Xn}),Ws=qn({chartName:"ComposedChart",GraphicalChild:[qe,wt,Dt,Ne],axisComponents:[{axisType:"xAxis",AxisComp:Rt},{axisType:"yAxis",AxisComp:Kt},{axisType:"zAxis",AxisComp:Ae}],formatAxisMap:Xn});function jn(e,t,n){if(e===0)return"";const r=Math.abs(e);if(t==="VND")return r>=1e6?`${(e/1e6).toFixed(1)}M`:r>=1e3?`${(e/1e3).toFixed(0)}K`:e.toString();if(t==="JPY"){if(r>=1e4){const s=n==="ja"?"万":"W";return`${(e/1e4).toFixed(1)}${s}`}return r>=1e3?`${(e/1e3).toFixed(0)}K`:e.toString()}return r>=1e6?`${(e/1e6).toFixed(1)}M`:r>=1e3?`${(e/1e3).toFixed(0)}K`:e.toString()}function lr({data:e}){const{currency:t}=Ft(),{data:n}=zt(),{t:r,i18n:s}=z("common"),{resolvedTheme:a}=we(),o=s.language,l=a==="dark",c=l?"#45475a":"#E5E7EB",u=l?"#a6adc8":"#6B7280",d=l?"#1e1e2e":"#fff",f=l?"#45475a":"#E5E7EB",h=l?"#cdd6f4":"#374151",y=e.every(p=>p.expenses===0),m=e.map(p=>({...p,net:p.income-p.expenses}));return i.jsx(ke,{width:"100%",height:"100%",children:i.jsxs(Ws,{data:m,margin:{top:20,right:30,left:20,bottom:5},children:[i.jsx(Qn,{strokeDasharray:"3 3",stroke:c}),i.jsx(Rt,{dataKey:"month",stroke:u,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),i.jsx(Kt,{stroke:u,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:p=>I(p,t,(n==null?void 0:n.rates)||{},!1)}),i.jsx(Se,{contentStyle:{backgroundColor:d,border:`1px solid ${f}`,borderRadius:"8px",fontSize:"14px",color:h},formatter:(p,x)=>[I(p,t,(n==null?void 0:n.rates)||{},!1),x],labelFormatter:p=>p}),i.jsx(Jn,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:h}}),i.jsx(Dt,{dataKey:"income",fill:"#4CAF50",name:r("chart.income"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:i.jsx(Qt,{dataKey:"income",position:"top",formatter:p=>jn(p,t,o),style:{fontSize:"10px",fill:"#4CAF50",fontWeight:500}})}),i.jsxs(Dt,{dataKey:"expenses",fill:"#F44336",name:r("chart.expense"),radius:[4,4,0,0],isAnimationActive:!0,animationBegin:200,animationDuration:800,animationEasing:"ease-out",children:[y?m.map((p,x)=>i.jsx(Zt,{fill:"#F4433633"},`cell-${x}`)):m.map((p,x)=>i.jsx(Zt,{fill:p.expenses===0?"#F4433633":"#F44336"},`cell-${x}`)),i.jsx(Qt,{dataKey:"expenses",position:"top",formatter:p=>jn(p,t,o),style:{fontSize:"10px",fill:"#F44336",fontWeight:500}})]}),i.jsx(qe,{type:"monotone",dataKey:"net",name:r("chart.net"),stroke:"#2196F3",strokeWidth:2,dot:{fill:"#2196F3",strokeWidth:2,r:4},activeDot:{r:6},isAnimationActive:!0,animationBegin:400,animationDuration:1e3,animationEasing:"ease-out"})]})})}const le=7,ue=["#4CAF50","#2196F3","#FF9800","#9C27B0","#F44336","#00BCD4","#FFEB3B","#795548","#607D8B"];function Gs({changePercent:e}){if(e==null)return null;const t=e>0,n=Math.abs(e)>=20;return e===0?i.jsxs("span",{className:"inline-flex items-center gap-0.5 text-xs text-gray-500 dark:text-gray-400",children:[i.jsx(ys,{className:"w-3 h-3"}),i.jsx("span",{children:"0%"})]}):i.jsxs("span",{className:M("inline-flex items-center gap-0.5 text-xs font-medium",t?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400",n&&"font-bold"),children:[t?i.jsx(zn,{className:"w-3 h-3"}):i.jsx(Lr,{className:"w-3 h-3"}),i.jsxs("span",{children:[t?"+":"",e.toFixed(0),"%"]})]})}function ur({data:e}){const{t}=z("common"),{currency:n}=Ft(),{data:r}=zt(),{resolvedTheme:s}=we(),a=s==="dark",[o,l]=O.useState(!1),c=a?"#1e1e2e":"#fff",u=a?"#45475a":"#E5E7EB",d=a?"#cdd6f4":"#374151",f=e.reduce((b,v)=>b+v.amount,0),h=[...e].sort((b,v)=>v.amount-b.amount),m=(()=>{if(h.length<=le||o)return h.map((w,j)=>({...w,percentage:f>0?w.amount/f*100:0,color:ue[j%ue.length]}));const b=h.slice(0,le),v=h.slice(le),_=v.reduce((w,j)=>w+j.amount,0),k=b.map((w,j)=>({...w,percentage:f>0?w.amount/f*100:0,color:ue[j%ue.length]}));return v.length>0&&k.push({category:`${t("analytics.otherCategories")} (${v.length})`,amount:_,percentage:f>0?_/f*100:0,color:"#9E9E9E",isOther:!0,otherCount:v.length}),k})(),p=h.length>le,x=b=>{const{x:v,y:_,width:k,height:w,value:j}=b;return i.jsxs("text",{x:v+k+8,y:_+w/2,fill:d,textAnchor:"start",dominantBaseline:"middle",fontSize:12,children:[j.toFixed(1),"%"]})},g=Math.max(200,m.length*32);return i.jsxs("div",{className:"w-full",children:[i.jsx(ke,{width:"100%",height:g,children:i.jsxs(cr,{data:m,layout:"vertical",margin:{top:5,right:60,left:0,bottom:5},children:[i.jsx(Rt,{type:"number",hide:!0,domain:[0,100]}),i.jsx(Kt,{type:"category",dataKey:"category",width:100,tick:{fill:d,fontSize:12},axisLine:!1,tickLine:!1}),i.jsx(Se,{contentStyle:{backgroundColor:c,border:`1px solid ${u}`,borderRadius:"8px",fontSize:"14px",color:d},content:({active:b,payload:v})=>{if(!b||!(v!=null&&v[0]))return null;const _=v[0].payload,k=_.change_percent!==null&&_.change_percent!==void 0;return i.jsxs("div",{className:"p-3 rounded-lg shadow-lg",style:{backgroundColor:c,border:`1px solid ${u}`},children:[i.jsx("p",{className:"font-medium mb-1",children:_.category}),i.jsx("p",{className:"text-sm",children:I(_.amount,n,(r==null?void 0:r.rates)||{},!1)}),k&&i.jsxs("div",{className:"mt-1 pt-1 border-t border-gray-200 dark:border-gray-600",children:[i.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t("analytics.vsPrevious"),": "]}),i.jsx(Gs,{changePercent:_.change_percent})]})]})}}),i.jsxs(Dt,{dataKey:"percentage",radius:[0,4,4,0],maxBarSize:24,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:[m.map((b,v)=>i.jsx(Zt,{fill:b.color},`cell-${v}`)),i.jsx(Qt,{dataKey:"percentage",content:x})]})]})}),p&&i.jsx("button",{onClick:()=>l(!o),className:M("w-full mt-2 py-2 px-4 text-sm font-medium rounded-lg transition-colors","text-primary-600 dark:text-primary-400","hover:bg-primary-50 dark:hover:bg-primary-900/20"),children:o?t("analytics.showLessCategories"):t("analytics.showAllCategories",{count:h.length})})]})}const _n={income:"#4CAF50",expense:"#F44336",net:"#2196F3"};function qs({data:e,dataKey:t}){const{currency:n}=Ft(),{data:r}=zt(),{isPrivacyMode:s}=Br(),{t:a}=z("common"),{resolvedTheme:o}=we(),l=o==="dark",c=l?"#45475a":"#E5E7EB",u=l?"#a6adc8":"#6B7280",d=l?"#1e1e2e":"#fff",f=l?"#45475a":"#E5E7EB",h=l?"#cdd6f4":"#374151",y={income:a("chart.income"),expense:a("chart.expense"),net:a("chart.net")};return i.jsx(ke,{width:"100%",height:"100%",children:i.jsxs(ls,{data:e,margin:{top:5,right:30,left:20,bottom:5},children:[i.jsx(Qn,{strokeDasharray:"3 3",stroke:c}),i.jsx(Rt,{dataKey:"month",stroke:u,style:{fontSize:"12px",fontFamily:"Noto Sans JP, sans-serif"}}),i.jsx(Kt,{stroke:u,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},tickFormatter:m=>fn(m,n,(r==null?void 0:r.rates)||{},!1,s)}),i.jsx(Se,{contentStyle:{backgroundColor:d,border:`1px solid ${f}`,borderRadius:"8px",fontSize:"14px",color:h},formatter:m=>[fn(m,n,(r==null?void 0:r.rates)||{},!1,s),y[t]]}),i.jsx(Jn,{wrapperStyle:{fontSize:"14px",fontFamily:"Noto Sans JP, sans-serif",color:h}}),i.jsx(qe,{type:"monotone",dataKey:t,stroke:_n[t],strokeWidth:2,dot:{fill:_n[t],r:4},activeDot:{r:6},name:y[t],isAnimationActive:!0,animationBegin:0,animationDuration:1200,animationEasing:"ease-out"})]})})}function Xs({data:e,savingsGoal:t}){const{t:n}=z("common"),{currency:r}=Ft(),{data:s}=zt(),{resolvedTheme:a}=we(),o=a==="dark",l=o?"#1e1e2e":"#fff",c=o?"#45475a":"#E5E7EB",u=o?"#cdd6f4":"#374151",d=e.length>0?e[e.length-1]:null,f=(d==null?void 0:d.net)||0,h=e.length>1?e.slice(0,-1):e,y=h.length>0?h.reduce((b,v)=>b+v.net,0)/h.length:f,m=[{name:n("analytics.thisMonth"),value:f,color:f>=0?"#4CAF50":"#F44336"},{name:n("analytics.average"),value:y,color:"#9E9E9E"}],p=y!==0?(f-y)/Math.abs(y)*100:0,x=p>=0,g=t&&t>0?Math.min(f/t*100,100):null;return e.length===1?i.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-8",children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:n("analytics.netCashFlow")}),i.jsx("p",{className:M("text-3xl font-bold",f>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:I(f,r,(s==null?void 0:s.rates)||{},!1)}),f>=0&&i.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:n("analytics.positiveCashFlow")}),t&&t>0&&i.jsxs("div",{className:"mt-4 w-full max-w-xs",children:[i.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[i.jsx("span",{children:n("analytics.savingsGoal")}),i.jsxs("span",{children:[(g??0).toFixed(0),"%"]})]}),i.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:i.jsx("div",{className:M("h-full rounded-full transition-all duration-700 ease-out",g&&g>=100?"bg-green-500":"bg-primary-500"),style:{width:`${g||0}%`}})}),i.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:[I(t,r,(s==null?void 0:s.rates)||{},!1)," ",n("analytics.target")]})]})]}):i.jsxs("div",{className:"w-full h-full flex flex-col",children:[i.jsx("div",{className:"flex-1 min-h-[150px]",children:i.jsx(ke,{width:"100%",height:"100%",children:i.jsxs(cr,{data:m,layout:"vertical",margin:{top:10,right:60,left:10,bottom:10},children:[i.jsx(Rt,{type:"number",hide:!0}),i.jsx(Kt,{type:"category",dataKey:"name",width:80,tick:{fill:u,fontSize:12},axisLine:!1,tickLine:!1}),i.jsx(Se,{contentStyle:{backgroundColor:l,border:`1px solid ${c}`,borderRadius:"8px",fontSize:"14px",color:u},formatter:b=>[I(b,r,(s==null?void 0:s.rates)||{},!1),n("analytics.netCashFlow")]}),t&&t>0&&i.jsx(cs,{x:t,stroke:"#9C27B0",strokeDasharray:"3 3",label:{value:n("analytics.goal"),position:"top",fill:"#9C27B0",fontSize:10}}),i.jsx(Dt,{dataKey:"value",radius:[0,4,4,0],maxBarSize:32,isAnimationActive:!0,animationBegin:0,animationDuration:800,animationEasing:"ease-out",children:m.map((b,v)=>i.jsx(Zt,{fill:b.color},`cell-${v}`))})]})})}),i.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 border-t border-gray-100 dark:border-gray-800",children:[i.jsxs("span",{className:M("text-sm font-medium",x?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[x?"▲":"▼"," ",Math.abs(p).toFixed(1),"%"]}),i.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("analytics.vsAverage")})]}),t&&t>0&&i.jsxs("div",{className:"px-4 pb-2",children:[i.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[i.jsx("span",{children:n("analytics.savingsGoal")}),i.jsxs("span",{children:[I(f,r,(s==null?void 0:s.rates)||{},!1)," / ",I(t,r,(s==null?void 0:s.rates)||{},!1)]})]}),i.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:i.jsx("div",{className:M("h-full rounded-full transition-all duration-700 ease-out",g&&g>=100?"bg-green-500":"bg-primary-500"),style:{width:`${g||0}%`}})})]})]})}function Js(e,t,n){return Math.max(t,Math.min(e,n))}const L={toVector(e,t){return e===void 0&&(e=t),Array.isArray(e)?e:[e,e]},add(e,t){return[e[0]+t[0],e[1]+t[1]]},sub(e,t){return[e[0]-t[0],e[1]-t[1]]},addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function wn(e,t,n){return t===0||Math.abs(t)===1/0?Math.pow(e,n*5):e*t*n/(t+n*e)}function kn(e,t,n,r=.15){return r===0?Js(e,t,n):e<t?-wn(t-e,n-t,r)+t:e>n?+wn(e-n,n-t,r)+n:e}function Qs(e,[t,n],[r,s]){const[[a,o],[l,c]]=e;return[kn(t,a,o,r),kn(n,l,c,s)]}function Zs(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ti(e){var t=Zs(e,"string");return typeof t=="symbol"?t:String(t)}function K(e,t,n){return t=ti(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Sn(Object(n),!0).forEach(function(r){K(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sn(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const dr={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function An(e){return e?e[0].toUpperCase()+e.slice(1):""}const ei=["enter","leave"];function ni(e=!1,t){return e&&!ei.includes(t)}function ri(e,t="",n=!1){const r=dr[e],s=r&&r[t]||t;return"on"+An(e)+An(s)+(ni(n,s)?"Capture":"")}const si=["gotpointercapture","lostpointercapture"];function ii(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=si.includes(t)?"capturecapture":"capture",s=!!~t.indexOf(r);return s&&(t=t.replace("capture","")),{device:t,capture:s,passive:n}}function ai(e,t=""){const n=dr[e],r=n&&n[t]||t;return e+r}function Ee(e){return"touches"in e}function fr(e){return Ee(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function oi(e){return Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||((n=e.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,t.target))})}function ci(e){return e.type==="touchend"||e.type==="touchcancel"?e.changedTouches:e.targetTouches}function hr(e){return Ee(e)?ci(e)[0]:e}function He(e,t){try{const n=t.clientX-e.clientX,r=t.clientY-e.clientY,s=(t.clientX+e.clientX)/2,a=(t.clientY+e.clientY)/2,o=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:o,origin:[s,a]}}catch{}return null}function li(e){return oi(e).map(t=>t.identifier)}function Nn(e,t){const[n,r]=Array.from(e.touches).filter(s=>t.includes(s.identifier));return He(n,r)}function Le(e){const t=hr(e);return Ee(e)?t.identifier:t.pointerId}function $t(e){const t=hr(e);return[t.clientX,t.clientY]}const En=40,Pn=800;function mr(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return r===1?(t*=En,n*=En):r===2&&(t*=Pn,n*=Pn),[t,n]}function ui(e){var t,n;const{scrollX:r,scrollY:s,scrollLeft:a,scrollTop:o}=e.currentTarget;return[(t=r??a)!==null&&t!==void 0?t:0,(n=s??o)!==null&&n!==void 0?n:0]}function di(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:s,ctrlKey:a}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:s,ctrlKey:a})}return t}function ve(e,...t){return typeof e=="function"?e(...t):e}function fi(){}function hi(...e){return e.length===0?fi:e.length===1?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function On(e,t){return Object.assign({},t,e||{})}const mi=32;let pr=class{constructor(t,n,r){this.ctrl=t,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:n,ingKey:r,args:s}=this;n[r]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=s,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=t.target,n.currentTarget=t.currentTarget,n.lastOffset=r.from?ve(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=t.timeStamp)}computeValues(t){const n=this.state;n._values=t,n.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:n,config:r,shared:s}=this;n.args=this.args;let a=0;if(t&&(n.event=t,r.preventDefault&&t.cancelable&&n.event.preventDefault(),n.type=t.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,di(t)),s.down=s.pressed=s.buttons%2===1||s.touches>0,a=t.timeStamp-n.timeStamp,n.timeStamp=t.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const w=n._delta.map(Math.abs);L.addTo(n._distance,w)}this.axisIntent&&this.axisIntent(t);const[o,l]=n._movement,[c,u]=r.threshold,{_step:d,values:f}=n;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=c&&f[0]),d[1]===!1&&(d[1]=Math.abs(l)>=u&&f[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=c&&Math.sign(o)*c),d[1]===!1&&(d[1]=Math.abs(l)>=u&&Math.sign(l)*u)),n.intentional=d[0]!==!1||d[1]!==!1,!n.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[w,j]=f;h[0]=d[0]!==!1?w-d[0]:0,h[1]=d[1]!==!1?j-d[1]:0}else h[0]=d[0]!==!1?o-d[0]:0,h[1]=d[1]!==!1?l-d[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(h);const y=n.offset,m=n._active&&!n._blocked||n.active;m&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=s[this.ingKey]=n._active,t&&(n.first&&("bounds"in r&&(n._bounds=ve(r.bounds,n)),this.setup&&this.setup()),n.movement=h,this.computeOffset()));const[p,x]=n.offset,[[g,b],[v,_]]=n._bounds;n.overflow=[p<g?-1:p>b?1:0,x<v?-1:x>_?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const k=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=Qs(n._bounds,n.offset,k),n.delta=L.sub(n.offset,y),this.computeMovement(),m&&(!n.last||a>mi)){n.delta=L.sub(n.offset,y);const w=n.delta.map(Math.abs);L.addTo(n.distance,w),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&a>0&&(n.velocity=[w[0]/a,w[1]/a],n.timeDelta=a)}}emit(){const t=this.state,n=this.shared,r=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!r.triggerAllEvents)return;const s=this.handler(F(F(F({},n),t),{},{[this.aliasKey]:t.values}));s!==void 0&&(t.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};function pi([e,t],n){const r=Math.abs(e),s=Math.abs(t);if(r>s&&r>n)return"x";if(s>r&&s>n)return"y"}class re extends pr{constructor(...t){super(...t),K(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=L.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=L.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const n=this.state,r=this.config;if(!n.axis&&t){const s=typeof r.axisThreshold=="object"?r.axisThreshold[fr(t)]:r.axisThreshold;n.axis=pi(n._movement,s)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const gi=e=>e,Tn=.15,gr={enabled(e=!0){return e},eventOptions(e,t,n){return F(F({},n.shared.eventOptions),e)},preventDefault(e=!1){return e},triggerAllEvents(e=!1){return e},rubberband(e=0){switch(e){case!0:return[Tn,Tn];case!1:return[0,0];default:return L.toVector(e)}},from(e){if(typeof e=="function")return e;if(e!=null)return L.toVector(e)},transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||gi},threshold(e){return L.toVector(e,0)}},yi=0,kt=F(F({},gr),{},{axis(e,t,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(e=yi){return e},bounds(e={}){if(typeof e=="function")return a=>kt.bounds(e(a));if("current"in e)return()=>e.current;if(typeof HTMLElement=="function"&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:s=1/0}=e;return[[t,n],[r,s]]}}),Cn={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class xi extends re{constructor(...t){super(...t),K(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const n=t._bounds.getBoundingClientRect(),r=t.currentTarget.getBoundingClientRect(),s={left:n.left-r.left+t.offset[0],right:n.right-r.right+t.offset[0],top:n.top-r.top+t.offset[1],bottom:n.bottom-r.bottom+t.offset[1]};t._bounds=kt.bounds(s)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const n=this.config,r=this.state;if(t.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(t.buttons):n.pointerButtons!==-1&&n.pointerButtons!==t.buttons))return;const s=this.ctrl.setEventIds(t);n.pointerCapture&&t.target.setPointerCapture(t.pointerId),!(s&&s.size>1&&r._pointerActive)&&(this.start(t),this.setupPointer(t),r._pointerId=Le(t),r._pointerActive=!0,this.computeValues($t(t)),this.computeInitial(),n.preventScrollAxis&&fr(t)!=="mouse"?(r._active=!1,this.setupScrollPrevention(t)):n.delay>0?(this.setupDelayTrigger(t),n.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const n=this.state,r=this.config;if(!n._pointerActive)return;const s=Le(t);if(n._pointerId!==void 0&&s!==n._pointerId)return;const a=$t(t);if(document.pointerLockElement===t.target?n._delta=[t.movementX,t.movementY]:(n._delta=L.sub(a,n._values),this.computeValues(a)),L.addTo(n._movement,n._delta),this.compute(t),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(t);return}if(r.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===r.preventScrollAxis||r.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(t);return}else return;this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch{}const n=this.state,r=this.config;if(!n._active||!n._pointerActive)return;const s=Le(t);if(n._pointerId!==void 0&&s!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[a,o]=n._distance;if(n.tap=a<=r.tapsThreshold&&o<=r.tapsThreshold,n.tap&&r.filterTaps)n._force=!0;else{const[l,c]=n._delta,[u,d]=n._movement,[f,h]=r.swipe.velocity,[y,m]=r.swipe.distance,p=r.swipe.duration;if(n.elapsedTime<p){const x=Math.abs(l/n.timeDelta),g=Math.abs(c/n.timeDelta);x>f&&Math.abs(u)>y&&(n.swipe[0]=Math.sign(l)),g>h&&Math.abs(d)>m&&(n.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const n=this.config,r=n.device;n.pointerLock&&t.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,bi(t);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const n=Cn[t.key];if(n){const r=this.state,s=t.shiftKey?10:t.altKey?.1:1;this.start(t),r._delta=n(this.config.keyboardDisplacement,s),r._keyboardActive=!0,L.addTo(r._movement,r._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Cn&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const n=this.config.device;t(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(n,"change",this.pointerMove.bind(this)),t(n,"end",this.pointerUp.bind(this)),t(n,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function bi(e){"persist"in e&&typeof e.persist=="function"&&e.persist()}const se=typeof window<"u"&&window.document&&window.document.createElement;function yr(){return se&&"ontouchstart"in window}function vi(){return yr()||se&&window.navigator.maxTouchPoints>1}function ji(){return se&&"onpointerdown"in window}function _i(){return se&&"exitPointerLock"in window.document}function wi(){try{return"constructor"in GestureEvent}catch{return!1}}const Z={isBrowser:se,gesture:wi(),touch:yr(),touchscreen:vi(),pointer:ji(),pointerLock:_i()},ki=250,Si=180,Ai=.5,Ni=50,Ei=250,Pi=10,In={mouse:0,touch:0,pen:8},Oi=F(F({},kt),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:s=!1}={}}){return this.pointerLock=r&&Z.pointerLock,Z.touch&&n?"touch":this.pointerLock?"mouse":Z.pointer&&!s?"pointer":Z.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&e?ki:void 0,!(!Z.touchscreen||n===!1))return e||(n!==void 0?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:s=!0}={}}){return this.pointerButtons=r,this.keys=s,!this.pointerLock&&this.device==="pointer"&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:s=void 0}){const a=L.toVector(e,n?r:s?1:0);return this.filterTaps=n,this.tapsThreshold=r,a},swipe({velocity:e=Ai,distance:t=Ni,duration:n=Ei}={}){return{velocity:this.transform(L.toVector(e)),distance:this.transform(L.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return Si;case!1:return 0;default:return e}},axisThreshold(e){return e?F(F({},In),e):In},keyboardDisplacement(e=Pi){return e}});function xr(e){const[t,n]=e.overflow,[r,s]=e._delta,[a,o]=e._direction;(t<0&&r>0&&a<0||t>0&&r<0&&a>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&s>0&&o<0||n>0&&s<0&&o>0)&&(e._movement[1]=e._movementBound[1])}const Ti=30,Ci=100;class Ii extends pr{constructor(...t){super(...t),K(this,"ingKey","pinching"),K(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:n,lastOffset:r}=this.state;t==="wheel"?this.state.offset=L.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:t,lastOffset:n}=this.state;this.state.movement=[t[0]/n[0],t[1]-n[1]]}axisIntent(){const t=this.state,[n,r]=t._movement;if(!t.axis){const s=Math.abs(n)*Ti-Math.abs(r);s<0?t.axis="angle":s>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&(this.state.axis==="scale"?t[1]=0:this.state.axis==="angle"&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(a=>r.has(a))||r.size<2)return;this.start(t),n._touchIds=Array.from(r).slice(0,2);const s=Nn(t,n._touchIds);s&&this.pinchStart(t,s)}pointerStart(t){if(t.buttons!=null&&t.buttons%2!==1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const n=this.state,r=n._pointerEvents,s=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(o=>s.has(o))||(r.size<2&&r.set(t.pointerId,t),n._pointerEvents.size<2))return;this.start(t);const a=He(...Array.from(r.values()));a&&this.pinchStart(t,a)}pinchStart(t,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const n=Nn(t,this.state._touchIds);n&&this.pinchMove(t,n)}pointerMove(t){const n=this.state._pointerEvents;if(n.has(t.pointerId)&&n.set(t.pointerId,t),!this.state._active)return;const r=He(...Array.from(n.values()));r&&this.pinchMove(t,r)}pinchMove(t,n){const r=this.state,s=r._values[1],a=n.angle-s;let o=0;Math.abs(a)>270&&(o+=Math.sign(a)),this.computeValues([n.distance,n.angle-360*o]),r.origin=n.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const n=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch{}n._pointerEvents.has(t.pointerId)&&n._pointerEvents.delete(t.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const n=this.state;n._active||(this.start(t),this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY];const r=n._movement;n._movement=[t.scale-1,t.rotation],n._delta=L.sub(n._movement,r),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>t[r]):!t[n])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const r=this.state;r._delta=[-mr(t)[1]/Ci*r.offset[0],0],L.addTo(r._movement,r._delta),xr(r),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const n=this.config.device;n&&(t(n,"start",this[n+"Start"].bind(this)),t(n,"change",this[n+"Move"].bind(this)),t(n,"end",this[n+"End"].bind(this)),t(n,"cancel",this[n+"End"].bind(this)),t("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}}const Di=F(F({},gr),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Z.touch&&Z.gesture)return"gesture";if(Z.touch&&r)return"touch";if(Z.touchscreen){if(Z.pointer)return"pointer";if(Z.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const s=o=>{const l=On(ve(n,o),{min:-1/0,max:1/0});return[l.min,l.max]},a=o=>{const l=On(ve(r,o),{min:-1/0,max:1/0});return[l.min,l.max]};return typeof n!="function"&&typeof r!="function"?[s(),a()]:o=>[s(o),a(o)]},threshold(e,t,n){return this.lockDirection=n.axis==="lock",L.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey(e){return e===void 0?"ctrlKey":e},pinchOnWheel(e=!0){return e}});class Mi extends re{constructor(...t){super(...t),K(this,"ingKey","moving")}move(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues($t(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const n=$t(t),r=this.state;r._delta=L.sub(n,r._values),L.addTo(r._movement,r._delta),this.computeValues(n),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}}const Li=F(F({},kt),{},{mouseOnly:(e=!0)=>e});class Bi extends re{constructor(...t){super(...t),K(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const n=this.state,r=ui(t);n._delta=L.sub(r,n._values),L.addTo(n._movement,n._delta),this.computeValues(r),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}}const $i=kt;class Fi extends re{constructor(...t){super(...t),K(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const n=this.state;n._delta=mr(t),L.addTo(n._movement,n._delta),xr(n),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}}const zi=kt;class Ri extends re{constructor(...t){super(...t),K(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.start(t),this.computeValues($t(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&t.pointerType!=="mouse")return;const n=this.state;if(!n._active)return;n._active=!1;const r=$t(t);n._movement=n._delta=L.sub(r,n._values),this.computeValues(r),this.compute(t),n.delta=n.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}}const Ki=F(F({},kt),{},{mouseOnly:(e=!0)=>e}),Xe=new Map,Ye=new Map;function Vi(e){Xe.set(e.key,e.engine),Ye.set(e.key,e.resolver)}const Hi={key:"drag",engine:xi,resolver:Oi},Yi={key:"hover",engine:Ri,resolver:Ki},Ui={key:"move",engine:Mi,resolver:Li},Wi={key:"pinch",engine:Ii,resolver:Di},Gi={key:"scroll",engine:Bi,resolver:$i},qi={key:"wheel",engine:Fi,resolver:zi};function Xi(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function Ji(e,t){if(e==null)return{};var n=Xi(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const Qi={target(e){if(e)return()=>"current"in e?e.current:e},enabled(e=!0){return e},window(e=Z.isBrowser?window:void 0){return e},eventOptions({passive:e=!0,capture:t=!1}={}){return{passive:e,capture:t}},transform(e){return e}},Zi=["target","eventOptions","window","enabled","transform"];function me(e={},t){const n={};for(const[r,s]of Object.entries(t))switch(typeof s){case"function":n[r]=s.call(n,e[r],r,e);break;case"object":n[r]=me(e[r],s);break;case"boolean":s&&(n[r]=e[r]);break}return n}function ta(e,t,n={}){const r=e,{target:s,eventOptions:a,window:o,enabled:l,transform:c}=r,u=Ji(r,Zi);if(n.shared=me({target:s,eventOptions:a,window:o,enabled:l,transform:c},Qi),t){const d=Ye.get(t);n[t]=me(F({shared:n.shared},u),d)}else for(const d in u){const f=Ye.get(d);f&&(n[d]=me(F({shared:n.shared},u[d]),f))}return n}let br=class{constructor(t,n){K(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=n}add(t,n,r,s,a){const o=this._listeners,l=ai(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=F(F({},c),a);t.addEventListener(l,s,u);const d=()=>{t.removeEventListener(l,s,u),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}};class ea{constructor(){K(this,"_timeouts",new Map)}add(t,n,r=140,...s){this.remove(t),this._timeouts.set(t,window.setTimeout(n,r,...s))}remove(t){const n=this._timeouts.get(t);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class na{constructor(t){K(this,"gestures",new Set),K(this,"_targetEventStore",new br(this)),K(this,"gestureEventStores",{}),K(this,"gestureTimeoutStores",{}),K(this,"handlers",{}),K(this,"config",{}),K(this,"pointerIds",new Set),K(this,"touchIds",new Set),K(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),ra(this,t)}setEventIds(t){if(Ee(t))return this.touchIds=new Set(li(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,n){this.handlers=t,this.nativeHandlers=n}applyConfig(t,n){this.config=ta(t,n,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const n=this.config.shared,r={};let s;if(!(n.target&&(s=n.target(),!s))){if(n.enabled){for(const o of this.gestures){const l=this.config[o],c=Dn(r,l.eventOptions,!!s);if(l.enabled){const u=Xe.get(o);new u(this,t,o).bind(c)}}const a=Dn(r,n.eventOptions,!!s);for(const o in this.nativeHandlers)a(o,"",l=>this.nativeHandlers[o](F(F({},this.state.shared),{},{event:l,args:t})),void 0,!0)}for(const a in r)r[a]=hi(...r[a]);if(!s)return r;for(const a in r){const{device:o,capture:l,passive:c}=ii(a);this._targetEventStore.add(s,o,"",r[a],{capture:l,passive:c})}}}}function Et(e,t){e.gestures.add(t),e.gestureEventStores[t]=new br(e,t),e.gestureTimeoutStores[t]=new ea}function ra(e,t){t.drag&&Et(e,"drag"),t.wheel&&Et(e,"wheel"),t.scroll&&Et(e,"scroll"),t.move&&Et(e,"move"),t.pinch&&Et(e,"pinch"),t.hover&&Et(e,"hover")}const Dn=(e,t,n)=>(r,s,a,o={},l=!1)=>{var c,u;const d=(c=o.capture)!==null&&c!==void 0?c:t.capture,f=(u=o.passive)!==null&&u!==void 0?u:t.passive;let h=l?r:ri(r,s,d);n&&f&&(h+="Passive"),e[h]=e[h]||[],e[h].push(a)},sa=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function ia(e){const t={},n={},r=new Set;for(let s in e)sa.test(s)?(r.add(RegExp.lastMatch),n[s]=e[s]):t[s]=e[s];return[n,t,r]}function Pt(e,t,n,r,s,a){if(!e.has(n)||!Xe.has(r))return;const o=n+"Start",l=n+"End",c=u=>{let d;return u.first&&o in t&&t[o](u),n in t&&(d=t[n](u)),u.last&&l in t&&t[l](u),d};s[r]=c,a[r]=a[r]||{}}function aa(e,t){const[n,r,s]=ia(e),a={};return Pt(s,n,"onDrag","drag",a,t),Pt(s,n,"onWheel","wheel",a,t),Pt(s,n,"onScroll","scroll",a,t),Pt(s,n,"onPinch","pinch",a,t),Pt(s,n,"onMove","move",a,t),Pt(s,n,"onHover","hover",a,t),{handlers:a,config:t,nativeHandlers:r}}function oa(e,t={},n,r){const s=T.useMemo(()=>new na(e),[]);if(s.applyHandlers(e,r),s.applyConfig(t,n),T.useEffect(s.effect.bind(s)),T.useEffect(()=>s.clean.bind(s),[]),t.target===void 0)return s.bind.bind(s)}function ca(e){return e.forEach(Vi),function(n,r){const{handlers:s,nativeHandlers:a,config:o}=aa(n,r||{});return oa(s,o,void 0,a)}}function la(e,t){return ca([Hi,Wi,Gi,qi,Ui,Yi])(e,t||{})}function Be({children:e,className:t="",minScale:n=1,maxScale:r=3}){const s=O.useRef(null),[a,o]=O.useState(1),[l,c]=O.useState({x:0,y:0}),u=O.useCallback(()=>{o(1),c({x:0,y:0})},[]);return la({onPinch:({offset:[d],memo:f})=>{const h=Math.min(r,Math.max(n,d));return o(h),h<=1&&c({x:0,y:0}),f},onDrag:({offset:[d,f],pinching:h})=>{if(a>1&&!h){const y=(a-1)*100/2;c({x:Math.min(y,Math.max(-y,d)),y:Math.min(y,Math.max(-y,f))})}},onWheel:({delta:[,d],event:f})=>{f.preventDefault();const h=Math.min(r,Math.max(n,a-d*.01));o(h),h<=1&&c({x:0,y:0})}},{target:s,pinch:{scaleBounds:{min:n,max:r}},drag:{filterTaps:!0},wheel:{preventDefault:!0}}),i.jsxs("div",{className:`relative overflow-hidden touch-none ${t}`,children:[i.jsx("div",{ref:s,style:{transform:`scale(${a}) translate(${l.x}px, ${l.y}px)`,transformOrigin:"center center",transition:"transform 0.1s ease-out"},className:"w-full h-full",children:e}),a>1&&i.jsxs("button",{onClick:u,className:"absolute bottom-2 right-2 px-2 py-1 text-xs bg-gray-800/70 text-white rounded-md hover:bg-gray-700/70 transition-colors",children:[Math.round(a*100),"% - Tap to reset"]})]})}const ua={spike:"📈",trend:"📊",unusual:"🔍",budget:"💰",saving:"✨"},da={info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"},fa={info:"text-blue-700 dark:text-blue-300",warning:"text-amber-700 dark:text-amber-300",success:"text-green-700 dark:text-green-300"};function ha({insight:e}){const{currency:t}=Ft(),{data:n}=zt();return i.jsx("div",{className:`p-4 rounded-lg border ${da[e.severity]} transition-all hover:shadow-sm`,children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-2xl",children:ua[e.type]}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h4",{className:`font-medium ${fa[e.severity]}`,children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&i.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-2",children:I(e.amount,t,(n==null?void 0:n.rates)||{},!1)})]}),e.percentage_change!==void 0&&i.jsxs("span",{className:`text-sm font-medium px-2 py-1 rounded ${e.percentage_change>0?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400":"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"}`,children:[e.percentage_change>0?"+":"",e.percentage_change.toFixed(0),"%"]})]})})}function ma(){const{t:e}=z("common"),{data:t,isLoading:n,error:r}=Tt({queryKey:["spending-insights"],queryFn:Rn,staleTime:5*60*1e3});if(n)return i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),i.jsx("div",{className:"flex justify-center py-8",children:i.jsx(It,{size:"md"})})]});if(r)return i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),i.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:e("error","Failed to load insights")})]});const s=(t==null?void 0:t.insights)||[];return i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("span",{className:"text-4xl mb-3 block",children:"🎉"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:e("analytics.noInsights","No notable spending patterns detected")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:e("analytics.insightsHint","Keep tracking to see personalized insights")})]}):i.jsx("div",{className:"space-y-3",children:s.map((a,o)=>i.jsx(ha,{insight:a},`${a.type}-${a.category}-${o}`))})]})}const de=50,pa=.5;function ga({suggestion:e,isSelected:t,onToggle:n}){const{currency:r}=Ft(),{data:s}=zt(),{t:a}=z("common"),o=e.confidence>=.8?"text-green-600 dark:text-green-400":e.confidence>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return i.jsxs("div",{className:`p-3 rounded-lg border transition-colors cursor-pointer ${t?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>n(e.transaction_id,e.suggested_category),children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:e.description}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:I(e.amount,r,(s==null?void 0:s.rates)||{},!1)})]}),i.jsxs("div",{className:"text-right flex-shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[e.is_new_category&&i.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:a("ai.newCategory")}),i.jsx("span",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:e.suggested_category})]}),i.jsxs("p",{className:`text-xs mt-1 ${o}`,children:[Math.round(e.confidence*100),"% ",a("ai.confidence")]})]})]}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 italic",children:e.reason})]})}function ya(){const{t:e,i18n:t}=z("common"),n=$r(),[r,s]=O.useState(null),[a,o]=O.useState(new Map),[l,c]=O.useState(!0),[u,d]=O.useState(0),[f,h]=O.useState(null),y=O.useRef(!1),m=$e({mutationFn:()=>pn(de,t.language),onSuccess:j=>{s(j),d(j.total_other_count);const S=new Map;j.suggestions.forEach(N=>{N.confidence>=.7&&S.set(N.transaction_id,N.suggested_category)}),o(S)}}),p=$e({mutationFn:()=>gn({approved:Array.from(a.entries()).map(([j,S])=>({transaction_id:j,category:S})),create_rules:l}),onSuccess:()=>{n.invalidateQueries({queryKey:["analytics"]}),n.invalidateQueries({queryKey:["transactions"]});const j=u-a.size;j>0?(d(j),s(null),o(new Map),setTimeout(()=>m.mutate(),500)):(s(null),o(new Map),d(0))}}),x=O.useCallback(async()=>{y.current=!1;const j=Math.ceil(u/de);let S=0;h({isRunning:!0,processed:0,total:u,currentBatch:0,totalBatches:j});for(let N=0;N<j&&!y.current;N++){h(E=>E?{...E,currentBatch:N+1}:null);try{const E=await pn(de,t.language);if(E.suggestions.length===0||y.current)break;const P=E.suggestions.filter(C=>C.confidence>=.7).map(C=>({transaction_id:C.transaction_id,category:C.suggested_category}));P.length>0&&(await gn({approved:P,create_rules:l}),S+=P.length),h(C=>C?{...C,processed:S}:null),await new Promise(C=>setTimeout(C,300))}catch{break}}h(null),n.invalidateQueries({queryKey:["analytics"]}),n.invalidateQueries({queryKey:["transactions"]}),s(null),d(0)},[u,t.language,l,n]),g=()=>{y.current=!0,h(null)},b=(j,S)=>{o(N=>{const E=new Map(N);return E.has(j)?E.delete(j):E.set(j,S),E})},v=()=>{if(!r)return;const j=new Map;r.suggestions.forEach(S=>{j.set(S.transaction_id,S.suggested_category)}),o(j)},_=()=>{o(new Map)};if(f!=null&&f.isRunning){const j=f.total>0?Math.round(f.processed/f.total*100):0;return i.jsx(V,{children:i.jsxs("div",{className:"py-8",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 text-center mb-4",children:e("ai.processingAll")}),i.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2",children:i.jsx("div",{className:"bg-primary-500 h-4 rounded-full transition-all duration-300",style:{width:`${j}%`}})}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-4",children:e("ai.processProgress",{processed:f.processed,total:f.total,batch:f.currentBatch,totalBatches:f.totalBatches})}),i.jsx("div",{className:"text-center",children:i.jsx(rt,{variant:"outline",onClick:g,children:e("cancel")})})]})})}if(!r){const j=u,S=j>250,N=Math.ceil(j/de)*pa;return i.jsxs(V,{children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.categoryCleanupDesc")}),j>0&&i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:e("ai.remainingOther",{count:j})})]}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx(rt,{onClick:()=>m.mutate(),disabled:m.isPending,children:m.isPending?i.jsxs(i.Fragment,{children:[i.jsx(It,{size:"sm",className:"mr-2"}),e("ai.analyzing")]}):e("ai.analyzeOther")}),S&&i.jsx(rt,{variant:"outline",onClick:x,disabled:m.isPending,title:e("ai.analyzeAllCredits",{credits:N.toFixed(1)}),children:e("ai.analyzeAll",{count:j})})]})]}),m.isError&&i.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:e("ai.analyzeError")})]})}if(r.suggestions.length===0)return i.jsx(V,{children:i.jsxs("div",{className:"text-center py-8",children:[i.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e("ai.noSuggestions")}),i.jsx(rt,{variant:"outline",onClick:()=>s(null),className:"mt-4",children:e("close")})]})});const k=u-r.suggestions.length,w=k>250;return i.jsxs(V,{children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.foundSuggestions",{count:r.suggestions.length,total:u})})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(rt,{variant:"outline",size:"sm",onClick:v,children:e("ai.selectAll")}),i.jsx(rt,{variant:"outline",size:"sm",onClick:_,children:e("ai.deselectAll")})]})]}),r.new_categories_suggested.length>0&&i.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:i.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e("ai.newCategoriesSuggested"),": ",r.new_categories_suggested.join(", ")]})}),i.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:r.suggestions.map(j=>i.jsx(ga,{suggestion:j,isSelected:a.has(j.transaction_id),onToggle:b},j.transaction_id))}),i.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[i.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[i.jsx("input",{type:"checkbox",checked:l,onChange:j=>c(j.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),e("ai.createRulesAuto")]}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx(rt,{variant:"outline",onClick:()=>s(null),children:e("cancel")}),w&&i.jsx(rt,{variant:"outline",onClick:x,disabled:p.isPending,children:e("ai.analyzeAll",{count:k})}),i.jsx(rt,{onClick:()=>p.mutate(),disabled:a.size===0||p.isPending,children:p.isPending?i.jsxs(i.Fragment,{children:[i.jsx(It,{size:"sm",className:"mr-2"}),e("ai.applying")]}):e("ai.applySelected",{count:a.size})})]})]}),p.isError&&i.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:e("ai.applyError")})]})]})}function xt({label:e,value:t,change:n,trend:r="neutral",subtitle:s,className:a}){const{t:o}=z("common"),l=()=>r==="positive"?"text-green-600 dark:text-green-400":r==="negative"?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",c=()=>n==null?null:n>0?"↑":n<0?"↓":"→";return i.jsxs("div",{className:M("bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm","border border-gray-100 dark:border-gray-700",a),children:[i.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:e}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 truncate",children:t}),n!=null&&i.jsxs("div",{className:M("flex items-center gap-1 mt-1",l()),children:[i.jsxs("span",{className:"text-sm font-medium",children:[c()," ",Math.abs(n).toFixed(1),"%"]}),i.jsx("span",{className:"text-xs text-gray-400",children:o("analytics.vsLastPeriod")})]}),s&&i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1 truncate",children:s})]})}function xa({analytics:e,displayCurrency:t="JPY"}){const{t:n}=z("common"),{total_income:r,total_expense:s,net_cashflow:a,comparison:o,top_category:l}=e,c=()=>o!=null&&o.income_change?o.income_change>0?"positive":"negative":"neutral",u=()=>o!=null&&o.expense_change?o.expense_change<0?"positive":"negative":"neutral",d=()=>o!=null&&o.net_change?o.net_change>0?"positive":"negative":"neutral";return i.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[i.jsx(xt,{label:n("analytics.heroIncome"),value:I(r,t),change:o==null?void 0:o.income_change,trend:c()}),i.jsx(xt,{label:n("analytics.heroExpense"),value:I(s,t),change:o==null?void 0:o.expense_change,trend:u()}),i.jsx(xt,{label:n("analytics.heroNet"),value:I(a,t),change:o==null?void 0:o.net_change,trend:d()}),i.jsx(xt,{label:n("analytics.heroTopCategory"),value:(l==null?void 0:l.name)||"-",subtitle:l?`${I(l.amount,t)} (${l.percentage}%)`:void 0})]})}function ba(e){return Object.prototype.toString.call(e)==="[object Object]"}function Mn(e){return ba(e)||Array.isArray(e)}function va(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Je(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;const s=JSON.stringify(Object.keys(e.breakpoints||{})),a=JSON.stringify(Object.keys(t.breakpoints||{}));return s!==a?!1:n.every(o=>{const l=e[o],c=t[o];return typeof l=="function"?`${l}`==`${c}`:!Mn(l)||!Mn(c)?l===c:Je(l,c)})}function Ln(e){return e.concat().sort((t,n)=>t.name>n.name?1:-1).map(t=>t.options)}function ja(e,t){if(e.length!==t.length)return!1;const n=Ln(e),r=Ln(t);return n.every((s,a)=>{const o=r[a];return Je(s,o)})}function Qe(e){return typeof e=="number"}function Ue(e){return typeof e=="string"}function Pe(e){return typeof e=="boolean"}function Bn(e){return Object.prototype.toString.call(e)==="[object Object]"}function $(e){return Math.abs(e)}function Ze(e){return Math.sign(e)}function Jt(e,t){return $(e-t)}function _a(e,t){if(e===0||t===0||$(e)<=$(t))return 0;const n=Jt($(e),$(t));return $(n/e)}function wa(e){return Math.round(e*100)/100}function te(e){return ee(e).map(Number)}function tt(e){return e[ie(e)]}function ie(e){return Math.max(0,e.length-1)}function tn(e,t){return t===ie(e)}function $n(e,t=0){return Array.from(Array(e),(n,r)=>t+r)}function ee(e){return Object.keys(e)}function vr(e,t){return[e,t].reduce((n,r)=>(ee(r).forEach(s=>{const a=n[s],o=r[s],l=Bn(a)&&Bn(o);n[s]=l?vr(a,o):o}),n),{})}function We(e,t){return typeof t.MouseEvent<"u"&&e instanceof t.MouseEvent}function ka(e,t){const n={start:r,center:s,end:a};function r(){return 0}function s(c){return a(c)/2}function a(c){return t-c}function o(c,u){return Ue(e)?n[e](c):e(t,c,u)}return{measure:o}}function ne(){let e=[];function t(s,a,o,l={passive:!0}){let c;if("addEventListener"in s)s.addEventListener(a,o,l),c=()=>s.removeEventListener(a,o,l);else{const u=s;u.addListener(o),c=()=>u.removeListener(o)}return e.push(c),r}function n(){e=e.filter(s=>s())}const r={add:t,clear:n};return r}function Sa(e,t,n,r){const s=ne(),a=1e3/60;let o=null,l=0,c=0;function u(){s.add(e,"visibilitychange",()=>{e.hidden&&m()})}function d(){y(),s.clear()}function f(x){if(!c)return;o||(o=x,n(),n());const g=x-o;for(o=x,l+=g;l>=a;)n(),l-=a;const b=l/a;r(b),c&&(c=t.requestAnimationFrame(f))}function h(){c||(c=t.requestAnimationFrame(f))}function y(){t.cancelAnimationFrame(c),o=null,l=0,c=0}function m(){o=null,l=0}return{init:u,destroy:d,start:h,stop:y,update:n,render:r}}function Aa(e,t){const n=t==="rtl",r=e==="y",s=r?"y":"x",a=r?"x":"y",o=!r&&n?-1:1,l=d(),c=f();function u(m){const{height:p,width:x}=m;return r?p:x}function d(){return r?"top":n?"right":"left"}function f(){return r?"bottom":n?"left":"right"}function h(m){return m*o}return{scroll:s,cross:a,startEdge:l,endEdge:c,measureSize:u,direction:h}}function _t(e=0,t=0){const n=$(e-t);function r(u){return u<e}function s(u){return u>t}function a(u){return r(u)||s(u)}function o(u){return a(u)?r(u)?e:t:u}function l(u){return n?u-n*Math.ceil((u-t)/n):u}return{length:n,max:t,min:e,constrain:o,reachedAny:a,reachedMax:s,reachedMin:r,removeOffset:l}}function jr(e,t,n){const{constrain:r}=_t(0,e),s=e+1;let a=o(t);function o(h){return n?$((s+h)%s):r(h)}function l(){return a}function c(h){return a=o(h),f}function u(h){return d().set(l()+h)}function d(){return jr(e,l(),n)}const f={get:l,set:c,add:u,clone:d};return f}function Na(e,t,n,r,s,a,o,l,c,u,d,f,h,y,m,p,x,g,b){const{cross:v,direction:_}=e,k=["INPUT","SELECT","TEXTAREA"],w={passive:!1},j=ne(),S=ne(),N=_t(50,225).constrain(y.measure(20)),E={mouse:300,touch:400},P={mouse:500,touch:600},C=m?43:25;let H=!1,W=0,G=0,X=!1,ht=!1,ot=!1,ct=!1;function Vt(A){if(!b)return;function D(U){(Pe(b)||b(A,U))&&Yt(U)}const R=t;j.add(R,"dragstart",U=>U.preventDefault(),w).add(R,"touchmove",()=>{},w).add(R,"touchend",()=>{}).add(R,"touchstart",D).add(R,"mousedown",D).add(R,"touchcancel",Y).add(R,"contextmenu",Y).add(R,"click",ut,!0)}function et(){j.clear(),S.clear()}function St(){const A=ct?n:t;S.add(A,"touchmove",q,w).add(A,"touchend",Y).add(A,"mousemove",q,w).add(A,"mouseup",Y)}function At(A){const D=A.nodeName||"";return k.includes(D)}function lt(){return(m?P:E)[ct?"mouse":"touch"]}function Ht(A,D){const R=f.add(Ze(A)*-1),U=d.byDistance(A,!m).distance;return m||$(A)<N?U:x&&D?U*.5:d.byIndex(R.get(),0).distance}function Yt(A){const D=We(A,r);ct=D,ot=m&&D&&!A.buttons&&H,H=Jt(s.get(),o.get())>=2,!(D&&A.button!==0)&&(At(A.target)||(X=!0,a.pointerDown(A),u.useFriction(0).useDuration(0),s.set(o),St(),W=a.readPoint(A),G=a.readPoint(A,v),h.emit("pointerDown")))}function q(A){if(!We(A,r)&&A.touches.length>=2)return Y(A);const R=a.readPoint(A),U=a.readPoint(A,v),nt=Jt(R,W),dt=Jt(U,G);if(!ht&&!ct&&(!A.cancelable||(ht=nt>dt,!ht)))return Y(A);const bt=a.pointerMove(A);nt>p&&(ot=!0),u.useFriction(.3).useDuration(.75),l.start(),s.add(_(bt)),A.preventDefault()}function Y(A){const R=d.byDistance(0,!1).index!==f.get(),U=a.pointerUp(A)*lt(),nt=Ht(_(U),R),dt=_a(U,nt),bt=C-10*dt,mt=g+dt/50;ht=!1,X=!1,S.clear(),u.useDuration(bt).useFriction(mt),c.distance(nt,!m),ct=!1,h.emit("pointerUp")}function ut(A){ot&&(A.stopPropagation(),A.preventDefault(),ot=!1)}function J(){return X}return{init:Vt,destroy:et,pointerDown:J}}function Ea(e,t){let r,s;function a(f){return f.timeStamp}function o(f,h){const m=`client${(h||e.scroll)==="x"?"X":"Y"}`;return(We(f,t)?f:f.touches[0])[m]}function l(f){return r=f,s=f,o(f)}function c(f){const h=o(f)-o(s),y=a(f)-a(r)>170;return s=f,y&&(r=f),h}function u(f){if(!r||!s)return 0;const h=o(s)-o(r),y=a(f)-a(r),m=a(f)-a(s)>170,p=h/y;return y&&!m&&$(p)>.1?p:0}return{pointerDown:l,pointerMove:c,pointerUp:u,readPoint:o}}function Pa(){function e(n){const{offsetTop:r,offsetLeft:s,offsetWidth:a,offsetHeight:o}=n;return{top:r,right:s+a,bottom:r+o,left:s,width:a,height:o}}return{measure:e}}function Oa(e){function t(r){return e*(r/100)}return{measure:t}}function Ta(e,t,n,r,s,a,o){const l=[e].concat(r);let c,u,d=[],f=!1;function h(x){return s.measureSize(o.measure(x))}function y(x){if(!a)return;u=h(e),d=r.map(h);function g(b){for(const v of b){if(f)return;const _=v.target===e,k=r.indexOf(v.target),w=_?u:d[k],j=h(_?e:r[k]);if($(j-w)>=.5){x.reInit(),t.emit("resize");break}}}c=new ResizeObserver(b=>{(Pe(a)||a(x,b))&&g(b)}),n.requestAnimationFrame(()=>{l.forEach(b=>c.observe(b))})}function m(){f=!0,c&&c.disconnect()}return{init:y,destroy:m}}function Ca(e,t,n,r,s,a){let o=0,l=0,c=s,u=a,d=e.get(),f=0;function h(){const w=r.get()-e.get(),j=!c;let S=0;return j?(o=0,n.set(r),e.set(r),S=w):(n.set(e),o+=w/c,o*=u,d+=o,e.add(o),S=d-f),l=Ze(S),f=d,k}function y(){const w=r.get()-t.get();return $(w)<.001}function m(){return c}function p(){return l}function x(){return o}function g(){return v(s)}function b(){return _(a)}function v(w){return c=w,k}function _(w){return u=w,k}const k={direction:p,duration:m,velocity:x,seek:h,settled:y,useBaseFriction:b,useBaseDuration:g,useFriction:_,useDuration:v};return k}function Ia(e,t,n,r,s){const a=s.measure(10),o=s.measure(50),l=_t(.1,.99);let c=!1;function u(){return!(c||!e.reachedAny(n.get())||!e.reachedAny(t.get()))}function d(y){if(!u())return;const m=e.reachedMin(t.get())?"min":"max",p=$(e[m]-t.get()),x=n.get()-t.get(),g=l.constrain(p/o);n.subtract(x*g),!y&&$(x)<a&&(n.set(e.constrain(n.get())),r.useDuration(25).useBaseFriction())}function f(y){c=!y}return{shouldConstrain:u,constrain:d,toggleActive:f}}function Da(e,t,n,r,s){const a=_t(-t+e,0),o=f(),l=d(),c=h();function u(m,p){return Jt(m,p)<=1}function d(){const m=o[0],p=tt(o),x=o.lastIndexOf(m),g=o.indexOf(p)+1;return _t(x,g)}function f(){return n.map((m,p)=>{const{min:x,max:g}=a,b=a.constrain(m),v=!p,_=tn(n,p);return v?g:_||u(x,b)?x:u(g,b)?g:b}).map(m=>parseFloat(m.toFixed(3)))}function h(){if(t<=e+s)return[a.max];if(r==="keepSnaps")return o;const{min:m,max:p}=l;return o.slice(m,p)}return{snapsContained:c,scrollContainLimit:l}}function Ma(e,t,n){const r=t[0],s=n?r-e:tt(t);return{limit:_t(s,r)}}function La(e,t,n,r){const a=t.min+.1,o=t.max+.1,{reachedMin:l,reachedMax:c}=_t(a,o);function u(h){return h===1?c(n.get()):h===-1?l(n.get()):!1}function d(h){if(!u(h))return;const y=e*(h*-1);r.forEach(m=>m.add(y))}return{loop:d}}function Ba(e){const{max:t,length:n}=e;function r(a){const o=a-t;return n?o/-n:0}return{get:r}}function $a(e,t,n,r,s){const{startEdge:a,endEdge:o}=e,{groupSlides:l}=s,c=f().map(t.measure),u=h(),d=y();function f(){return l(r).map(p=>tt(p)[o]-p[0][a]).map($)}function h(){return r.map(p=>n[a]-p[a]).map(p=>-$(p))}function y(){return l(u).map(p=>p[0]).map((p,x)=>p+c[x])}return{snaps:u,snapsAligned:d}}function Fa(e,t,n,r,s,a){const{groupSlides:o}=s,{min:l,max:c}=r,u=d();function d(){const h=o(a),y=!e||t==="keepSnaps";return n.length===1?[a]:y?h:h.slice(l,c).map((m,p,x)=>{const g=!p,b=tn(x,p);if(g){const v=tt(x[0])+1;return $n(v)}if(b){const v=ie(a)-tt(x)[0]+1;return $n(v,tt(x)[0])}return m})}return{slideRegistry:u}}function za(e,t,n,r,s){const{reachedAny:a,removeOffset:o,constrain:l}=r;function c(m){return m.concat().sort((p,x)=>$(p)-$(x))[0]}function u(m){const p=e?o(m):l(m),x=t.map((b,v)=>({diff:d(b-p,0),index:v})).sort((b,v)=>$(b.diff)-$(v.diff)),{index:g}=x[0];return{index:g,distance:p}}function d(m,p){const x=[m,m+n,m-n];if(!e)return m;if(!p)return c(x);const g=x.filter(b=>Ze(b)===p);return g.length?c(g):tt(x)-n}function f(m,p){const x=t[m]-s.get(),g=d(x,p);return{index:m,distance:g}}function h(m,p){const x=s.get()+m,{index:g,distance:b}=u(x),v=!e&&a(x);if(!p||v)return{index:g,distance:m};const _=t[g]-b,k=m+d(_,0);return{index:g,distance:k}}return{byDistance:h,byIndex:f,shortcut:d}}function Ra(e,t,n,r,s,a,o){function l(f){const h=f.distance,y=f.index!==t.get();a.add(h),h&&(r.duration()?e.start():(e.update(),e.render(1),e.update())),y&&(n.set(t.get()),t.set(f.index),o.emit("select"))}function c(f,h){const y=s.byDistance(f,h);l(y)}function u(f,h){const y=t.clone().set(f),m=s.byIndex(y.get(),h);l(m)}return{distance:c,index:u}}function Ka(e,t,n,r,s,a,o,l){const c={passive:!0,capture:!0};let u=0;function d(y){if(!l)return;function m(p){if(new Date().getTime()-u>10)return;o.emit("slideFocusStart"),e.scrollLeft=0;const b=n.findIndex(v=>v.includes(p));Qe(b)&&(s.useDuration(0),r.index(b,0),o.emit("slideFocus"))}a.add(document,"keydown",f,!1),t.forEach((p,x)=>{a.add(p,"focus",g=>{(Pe(l)||l(y,g))&&m(x)},c)})}function f(y){y.code==="Tab"&&(u=new Date().getTime())}return{init:d}}function Gt(e){let t=e;function n(){return t}function r(c){t=o(c)}function s(c){t+=o(c)}function a(c){t-=o(c)}function o(c){return Qe(c)?c:c.get()}return{get:n,set:r,add:s,subtract:a}}function _r(e,t){const n=e.scroll==="x"?o:l,r=t.style;let s=null,a=!1;function o(h){return`translate3d(${h}px,0px,0px)`}function l(h){return`translate3d(0px,${h}px,0px)`}function c(h){if(a)return;const y=wa(e.direction(h));y!==s&&(r.transform=n(y),s=y)}function u(h){a=!h}function d(){a||(r.transform="",t.getAttribute("style")||t.removeAttribute("style"))}return{clear:d,to:c,toggleActive:u}}function Va(e,t,n,r,s,a,o,l,c){const d=te(s),f=te(s).reverse(),h=g().concat(b());function y(j,S){return j.reduce((N,E)=>N-s[E],S)}function m(j,S){return j.reduce((N,E)=>y(N,S)>0?N.concat([E]):N,[])}function p(j){return a.map((S,N)=>({start:S-r[N]+.5+j,end:S+t-.5+j}))}function x(j,S,N){const E=p(S);return j.map(P=>{const C=N?0:-n,H=N?n:0,W=N?"end":"start",G=E[P][W];return{index:P,loopPoint:G,slideLocation:Gt(-1),translate:_r(e,c[P]),target:()=>l.get()>G?C:H}})}function g(){const j=o[0],S=m(f,j);return x(S,n,!1)}function b(){const j=t-o[0]-1,S=m(d,j);return x(S,-n,!0)}function v(){return h.every(({index:j})=>{const S=d.filter(N=>N!==j);return y(S,t)<=.1})}function _(){h.forEach(j=>{const{target:S,translate:N,slideLocation:E}=j,P=S();P!==E.get()&&(N.to(P),E.set(P))})}function k(){h.forEach(j=>j.translate.clear())}return{canLoop:v,clear:k,loop:_,loopPoints:h}}function Ha(e,t,n){let r,s=!1;function a(c){if(!n)return;function u(d){for(const f of d)if(f.type==="childList"){c.reInit(),t.emit("slidesChanged");break}}r=new MutationObserver(d=>{s||(Pe(n)||n(c,d))&&u(d)}),r.observe(e,{childList:!0})}function o(){r&&r.disconnect(),s=!0}return{init:a,destroy:o}}function Ya(e,t,n,r){const s={};let a=null,o=null,l,c=!1;function u(){l=new IntersectionObserver(m=>{c||(m.forEach(p=>{const x=t.indexOf(p.target);s[x]=p}),a=null,o=null,n.emit("slidesInView"))},{root:e.parentElement,threshold:r}),t.forEach(m=>l.observe(m))}function d(){l&&l.disconnect(),c=!0}function f(m){return ee(s).reduce((p,x)=>{const g=parseInt(x),{isIntersecting:b}=s[g];return(m&&b||!m&&!b)&&p.push(g),p},[])}function h(m=!0){if(m&&a)return a;if(!m&&o)return o;const p=f(m);return m&&(a=p),m||(o=p),p}return{init:u,destroy:d,get:h}}function Ua(e,t,n,r,s,a){const{measureSize:o,startEdge:l,endEdge:c}=e,u=n[0]&&s,d=m(),f=p(),h=n.map(o),y=x();function m(){if(!u)return 0;const b=n[0];return $(t[l]-b[l])}function p(){if(!u)return 0;const b=a.getComputedStyle(tt(r));return parseFloat(b.getPropertyValue(`margin-${c}`))}function x(){return n.map((b,v,_)=>{const k=!v,w=tn(_,v);return k?h[v]+d:w?h[v]+f:_[v+1][l]-b[l]}).map($)}return{slideSizes:h,slideSizesWithGaps:y,startGap:d,endGap:f}}function Wa(e,t,n,r,s,a,o,l,c){const{startEdge:u,endEdge:d,direction:f}=e,h=Qe(n);function y(g,b){return te(g).filter(v=>v%b===0).map(v=>g.slice(v,v+b))}function m(g){return g.length?te(g).reduce((b,v,_)=>{const k=tt(b)||0,w=k===0,j=v===ie(g),S=s[u]-a[k][u],N=s[u]-a[v][d],E=!r&&w?f(o):0,P=!r&&j?f(l):0,C=$(N-P-(S+E));return _&&C>t+c&&b.push(v),j&&b.push(g.length),b},[]).map((b,v,_)=>{const k=Math.max(_[v-1]||0);return g.slice(k,b)}):[]}function p(g){return h?y(g,n):m(g)}return{groupSlides:p}}function Ga(e,t,n,r,s,a,o){const{align:l,axis:c,direction:u,startIndex:d,loop:f,duration:h,dragFree:y,dragThreshold:m,inViewThreshold:p,slidesToScroll:x,skipSnaps:g,containScroll:b,watchResize:v,watchSlides:_,watchDrag:k,watchFocus:w}=a,j=2,S=Pa(),N=S.measure(t),E=n.map(S.measure),P=Aa(c,u),C=P.measureSize(N),H=Oa(C),W=ka(l,C),G=!f&&!!b,X=f||!!b,{slideSizes:ht,slideSizesWithGaps:ot,startGap:ct,endGap:Vt}=Ua(P,N,E,n,X,s),et=Wa(P,C,x,f,N,E,ct,Vt,j),{snaps:St,snapsAligned:At}=$a(P,W,N,E,et),lt=-tt(St)+tt(ot),{snapsContained:Ht,scrollContainLimit:Yt}=Da(C,lt,At,b,j),q=G?Ht:At,{limit:Y}=Ma(lt,q,f),ut=jr(ie(q),d,f),J=ut.clone(),B=te(n),A=({dragHandler:Nt,scrollBody:Ie,scrollBounds:De,options:{loop:ae}})=>{ae||De.constrain(Nt.pointerDown()),Ie.seek()},D=({scrollBody:Nt,translate:Ie,location:De,offsetLocation:ae,previousLocation:Nr,scrollLooper:Er,slideLooper:Pr,dragHandler:Or,animation:Tr,eventHandler:an,scrollBounds:Cr,options:{loop:on}},cn)=>{const ln=Nt.settled(),Ir=!Cr.shouldConstrain(),un=on?ln:ln&&Ir,dn=un&&!Or.pointerDown();dn&&Tr.stop();const Dr=De.get()*cn+Nr.get()*(1-cn);ae.set(Dr),on&&(Er.loop(Nt.direction()),Pr.loop()),Ie.to(ae.get()),dn&&an.emit("settle"),un||an.emit("scroll")},R=Sa(r,s,()=>A(Ce),Nt=>D(Ce,Nt)),U=.68,nt=q[ut.get()],dt=Gt(nt),bt=Gt(nt),mt=Gt(nt),vt=Gt(nt),Ut=Ca(dt,mt,bt,vt,h,U),Oe=za(f,q,lt,Y,vt),Te=Ra(R,ut,J,Ut,Oe,vt,o),nn=Ba(Y),rn=ne(),Sr=Ya(t,n,o,p),{slideRegistry:sn}=Fa(G,b,q,Yt,et,B),Ar=Ka(e,n,sn,Te,Ut,rn,o,w),Ce={ownerDocument:r,ownerWindow:s,eventHandler:o,containerRect:N,slideRects:E,animation:R,axis:P,dragHandler:Na(P,e,r,s,vt,Ea(P,s),dt,R,Te,Ut,Oe,ut,o,H,y,m,g,U,k),eventStore:rn,percentOfView:H,index:ut,indexPrevious:J,limit:Y,location:dt,offsetLocation:mt,previousLocation:bt,options:a,resizeHandler:Ta(t,o,s,n,P,v,S),scrollBody:Ut,scrollBounds:Ia(Y,mt,vt,Ut,H),scrollLooper:La(lt,Y,mt,[dt,mt,bt,vt]),scrollProgress:nn,scrollSnapList:q.map(nn.get),scrollSnaps:q,scrollTarget:Oe,scrollTo:Te,slideLooper:Va(P,C,lt,ht,ot,St,q,mt,n),slideFocus:Ar,slidesHandler:Ha(t,o,_),slidesInView:Sr,slideIndexes:B,slideRegistry:sn,slidesToScroll:et,target:vt,translate:_r(P,t)};return Ce}function qa(){let e={},t;function n(u){t=u}function r(u){return e[u]||[]}function s(u){return r(u).forEach(d=>d(t,u)),c}function a(u,d){return e[u]=r(u).concat([d]),c}function o(u,d){return e[u]=r(u).filter(f=>f!==d),c}function l(){e={}}const c={init:n,emit:s,off:o,on:a,clear:l};return c}const Xa={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Ja(e){function t(a,o){return vr(a,o||{})}function n(a){const o=a.breakpoints||{},l=ee(o).filter(c=>e.matchMedia(c).matches).map(c=>o[c]).reduce((c,u)=>t(c,u),{});return t(a,l)}function r(a){return a.map(o=>ee(o.breakpoints||{})).reduce((o,l)=>o.concat(l),[]).map(e.matchMedia)}return{mergeOptions:t,optionsAtMedia:n,optionsMediaQueries:r}}function Qa(e){let t=[];function n(a,o){return t=o.filter(({options:l})=>e.optionsAtMedia(l).active!==!1),t.forEach(l=>l.init(a,e)),o.reduce((l,c)=>Object.assign(l,{[c.name]:c}),{})}function r(){t=t.filter(a=>a.destroy())}return{init:n,destroy:r}}function je(e,t,n){const r=e.ownerDocument,s=r.defaultView,a=Ja(s),o=Qa(a),l=ne(),c=qa(),{mergeOptions:u,optionsAtMedia:d,optionsMediaQueries:f}=a,{on:h,off:y,emit:m}=c,p=P;let x=!1,g,b=u(Xa,je.globalOptions),v=u(b),_=[],k,w,j;function S(){const{container:B,slides:A}=v;w=(Ue(B)?e.querySelector(B):B)||e.children[0];const R=Ue(A)?w.querySelectorAll(A):A;j=[].slice.call(R||w.children)}function N(B){const A=Ga(e,w,j,r,s,B,c);if(B.loop&&!A.slideLooper.canLoop()){const D=Object.assign({},B,{loop:!1});return N(D)}return A}function E(B,A){x||(b=u(b,B),v=d(b),_=A||_,S(),g=N(v),f([b,..._.map(({options:D})=>D)]).forEach(D=>l.add(D,"change",P)),v.active&&(g.translate.to(g.location.get()),g.animation.init(),g.slidesInView.init(),g.slideFocus.init(J),g.eventHandler.init(J),g.resizeHandler.init(J),g.slidesHandler.init(J),g.options.loop&&g.slideLooper.loop(),w.offsetParent&&j.length&&g.dragHandler.init(J),k=o.init(J,_)))}function P(B,A){const D=et();C(),E(u({startIndex:D},B),A),c.emit("reInit")}function C(){g.dragHandler.destroy(),g.eventStore.clear(),g.translate.clear(),g.slideLooper.clear(),g.resizeHandler.destroy(),g.slidesHandler.destroy(),g.slidesInView.destroy(),g.animation.destroy(),o.destroy(),l.clear()}function H(){x||(x=!0,l.clear(),C(),c.emit("destroy"),c.clear())}function W(B,A,D){!v.active||x||(g.scrollBody.useBaseFriction().useDuration(A===!0?0:v.duration),g.scrollTo.index(B,D||0))}function G(B){const A=g.index.add(1).get();W(A,B,-1)}function X(B){const A=g.index.add(-1).get();W(A,B,1)}function ht(){return g.index.add(1).get()!==et()}function ot(){return g.index.add(-1).get()!==et()}function ct(){return g.scrollSnapList}function Vt(){return g.scrollProgress.get(g.offsetLocation.get())}function et(){return g.index.get()}function St(){return g.indexPrevious.get()}function At(){return g.slidesInView.get()}function lt(){return g.slidesInView.get(!1)}function Ht(){return k}function Yt(){return g}function q(){return e}function Y(){return w}function ut(){return j}const J={canScrollNext:ht,canScrollPrev:ot,containerNode:Y,internalEngine:Yt,destroy:H,off:y,on:h,emit:m,plugins:Ht,previousScrollSnap:St,reInit:p,rootNode:q,scrollNext:G,scrollPrev:X,scrollProgress:Vt,scrollSnapList:ct,scrollTo:W,selectedScrollSnap:et,slideNodes:ut,slidesInView:At,slidesNotInView:lt};return E(t,n),setTimeout(()=>c.emit("init"),0),J}je.globalOptions=void 0;function en(e={},t=[]){const n=O.useRef(e),r=O.useRef(t),[s,a]=O.useState(),[o,l]=O.useState(),c=O.useCallback(()=>{s&&s.reInit(n.current,r.current)},[s]);return O.useEffect(()=>{Je(n.current,e)||(n.current=e,c())},[e,c]),O.useEffect(()=>{ja(r.current,t)||(r.current=t,c())},[t,c]),O.useEffect(()=>{if(va()&&o){je.globalOptions=en.globalOptions;const u=je(o,n.current,r.current);return a(u),()=>u.destroy()}else a(void 0)},[o,a]),[l,s]}en.globalOptions=void 0;const Za={spike:"⚠️",trend:"📈",unusual:"📊",budget:"💰",saving:"🎉"},Fn={warning:"border-l-amber-500 bg-amber-50 dark:bg-amber-900/20",success:"border-l-green-500 bg-green-50 dark:bg-green-900/20",info:"border-l-blue-500 bg-blue-50 dark:bg-blue-900/20"};function to({insight:e,displayCurrency:t="JPY",onScrollToChart:n}){const{t:r}=z("common"),s=Fr(),a=()=>{e.category?s({to:"/transactions",search:{categories:e.category}}):(e.type==="trend"||e.type==="unusual")&&(n==null||n())},o=()=>e.category?r("analytics.viewTransactions",{category:e.category}):e.type==="trend"||e.type==="unusual"?r("analytics.viewBreakdown"):r("analytics.learnMore");return i.jsx("div",{className:M("rounded-xl p-4 border-l-4 min-w-0","bg-white dark:bg-gray-800","shadow-sm",Fn[e.severity]||Fn.info),children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-2xl flex-shrink-0",children:Za[e.type]||"💡"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&i.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-1",children:[I(e.amount,t),e.percentage_change&&i.jsxs("span",{className:M("ml-2",e.percentage_change>0?"text-red-600":"text-green-600"),children:[e.percentage_change>0?"+":"",e.percentage_change,"%"]})]}),i.jsxs(rt,{variant:"ghost",className:"mt-2 p-0 h-auto text-sm text-primary-600 hover:text-primary-700",onClick:a,children:[o()," →"]})]})]})})}function eo({insights:e,displayCurrency:t="JPY",onScrollToChart:n}){const{t:r}=z("common"),[s,a]=O.useState(0),[o,l]=en({loop:!1,align:"start",containScroll:"trimSnaps"}),c=O.useCallback(()=>{l&&a(l.selectedScrollSnap())},[l]);return O.useEffect(()=>{if(l)return c(),l.on("select",c),()=>{l.off("select",c)}},[l,c]),!e||e.length===0?null:i.jsxs("div",{className:"relative",children:[e.length>1&&i.jsx("p",{className:"text-xs text-gray-400 text-center mb-2",children:r("analytics.swipeHint")}),i.jsx("div",{className:"overflow-hidden",ref:o,children:i.jsx("div",{className:"flex gap-3",children:e.map((u,d)=>i.jsx("div",{className:"flex-shrink-0 w-full min-w-0",children:i.jsx(to,{insight:u,displayCurrency:t,onScrollToChart:n})},`${u.type}-${u.category||d}`))})}),e.length>1&&i.jsx("div",{className:"flex justify-center gap-1.5 mt-3",children:e.map((u,d)=>i.jsx("button",{"aria-label":`Go to insight ${d+1}`,className:M("w-2 h-2 rounded-full transition-all",d===s?"bg-primary-600 w-4":"bg-gray-300 dark:bg-gray-600"),onClick:()=>l==null?void 0:l.scrollTo(d)},d))})]})}function wr({selectedMonth:e,onChange:t,className:n}){const r=()=>{t(fe(e,1))},s=()=>{const o=hn(e,1);o<=new Date&&t(o)},a=hn(e,1)>new Date;return i.jsxs("div",{className:M("flex items-center gap-2",n),children:[i.jsx("button",{onClick:r,className:M("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors"),"aria-label":"Previous month",children:"←"}),i.jsx("span",{className:"min-w-[140px] text-center font-medium text-gray-900 dark:text-gray-100",children:Kn(e)}),i.jsx("button",{onClick:s,disabled:a,className:M("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors",a&&"opacity-50 cursor-not-allowed"),"aria-label":"Next month",children:"→"})]})}const no=[{value:"current-month",labelKey:"analytics.currentMonth"},{value:"3-months",labelKey:"analytics.3months"},{value:"6-months",labelKey:"analytics.6months"},{value:"1-year",labelKey:"analytics.1year"}];function ro({selected:e,onChange:t,className:n}){const{t:r}=z("common");return i.jsx("div",{className:M("inline-flex rounded-lg bg-gray-100 dark:bg-gray-800 p-1",n),children:no.map(({value:s,labelKey:a})=>i.jsx("button",{onClick:()=>t(s),className:M("px-3 py-1.5 text-sm font-medium rounded-md transition-all",s===e?"bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:r(a)},s))})}function so({year:e,month:t,onDownloadPDF:n,isDownloading:r}){const{t:s}=z("common"),a=Kn(new Date(e,t-1));return i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:s("report.title")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:n,disabled:r,className:"p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":s(r?"report.downloading":"report.downloadPDF"),title:s(r?"report.downloading":"report.downloadPDF"),children:r?i.jsx(zr,{size:18,className:"animate-spin"}):i.jsx(fs,{size:18})}),i.jsx("button",{disabled:!0,className:"p-2 rounded-lg text-gray-400 dark:text-gray-600 cursor-not-allowed","aria-label":s("report.sendEmail"),title:s("report.comingSoon"),children:i.jsx(hs,{size:18})})]})]})}function kr({value:e,invertColor:t=!1,className:n}){const{t:r}=z("common");if(e==null)return i.jsx("span",{className:M("inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium","bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400",n),children:r("report.deltaNew")});if(e===0)return i.jsx("span",{className:M("inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium","bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400",n),children:"0%"});const s=e>0,a=t?!s:s,o=s?us:ds;return i.jsxs("span",{className:M("inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-xs font-medium",a?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",n),children:[i.jsx(o,{className:"w-3 h-3"}),Math.abs(e).toFixed(1),"%"]})}const Ge=({value:e,max:t=100,className:n})=>{const r=Math.min(100,Math.max(0,e/t*100));return i.jsx("div",{className:_e("h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",n),children:i.jsx("div",{className:"h-full bg-primary-600 animate-progress-fill",style:{width:`${r}%`}})})};function io(e){switch(e){case"over_budget":return"error";case"threshold_80":return"warning";case"threshold_50":return"info";default:return"success"}}function ao(e,t){switch(e){case"over_budget":return t("report.overBudget");case"threshold_80":return t("report.warning");case"threshold_50":return t("report.caution");default:return t("report.onTrack")}}function oo({data:e}){const{t}=z("common");return i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[i.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[I(Math.abs(e.total_spent))," / ",I(e.total_budget)]}),i.jsxs("span",{className:M("font-medium",e.is_over_budget?"text-red-500":"text-gray-700 dark:text-gray-300"),children:[e.percentage_used.toFixed(1),"%"]})]}),i.jsx(Ge,{value:Math.min(e.percentage_used,100)})]}),i.jsx("div",{className:"space-y-3",children:e.category_status.map(n=>i.jsx("div",{className:"flex items-center justify-between gap-2",children:i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("span",{className:"text-sm font-medium truncate text-gray-900 dark:text-gray-100",children:n.category}),i.jsx(kr,{value:n.spending_change,invertColor:!0,className:"ml-1"}),i.jsx(Vn,{variant:io(n.status),className:"ml-1 text-[10px]",children:ao(n.status,t)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ge,{value:Math.min(n.percentage,100),className:"flex-1"}),i.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-16 text-right",children:[I(Math.abs(n.spent))," / ",I(n.budget_amount)]})]})]})},n.category))})]})}function co({status:e}){switch(e){case"over_budget":return i.jsx(Kr,{className:"w-5 h-5 text-red-500 shrink-0"});case"threshold_80":return i.jsx(ze,{className:"w-5 h-5 text-amber-500 shrink-0"});case"threshold_50":return i.jsx(ze,{className:"w-5 h-5 text-yellow-500 shrink-0"});default:return i.jsx(Rr,{className:"w-5 h-5 text-green-500 shrink-0"})}}function lo(e){switch(e){case"over_budget":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"threshold_80":return"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800";case"threshold_50":return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800";default:return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"}}function uo({focusAreas:e,budgetAdherence:t}){const{t:n}=z("common"),[r,s]=O.useState(!1),a=t.category_status.length;return e.length===0?i.jsx("div",{className:"text-center py-6 text-sm text-gray-500 dark:text-gray-400",children:n("report.noFocusAreas")}):i.jsxs("div",{className:"space-y-3",children:[e.map(o=>i.jsx("div",{className:M("rounded-lg border p-3",lo(o.status)),children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(co,{status:o.status}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:o.category}),i.jsx(kr,{value:o.spending_change,invertColor:!0})]}),i.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:[I(Math.abs(o.spent))," / ",I(o.budget_amount)]}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n(o.suggestion_key,o.suggestion_params)})]})]})},o.category)),a>e.length&&i.jsxs("button",{onClick:()=>s(!r),className:"flex items-center gap-1 text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline w-full justify-center py-2",children:[r?n("report.hideAll"):n("report.seeAll",{count:a}),r?i.jsx(ms,{className:"w-4 h-4"}):i.jsx(ps,{className:"w-4 h-4"})]}),r&&i.jsx(oo,{data:t})]})}function fo(e){const t=e.summary;if(t.total_income===0&&t.total_expense===0)return null;const n=t.expense_change<0?`Expenses decreased by ${Math.abs(t.expense_change).toFixed(1)}%`:t.savings_rate>20?`Savings rate at ${t.savings_rate.toFixed(1)}%`:`Income: ${t.total_income.toLocaleString()}`,r=t.expense_change>10?`Expenses increased by ${t.expense_change.toFixed(1)}%`:t.savings_rate<10?`Low savings rate: ${t.savings_rate.toFixed(1)}%`:"No major concerns this month",s=t.net_change>0?`Net cashflow improved by ${t.net_change.toFixed(1)}%`:t.net_change<0?`Net cashflow decreased by ${Math.abs(t.net_change).toFixed(1)}%`:"Cashflow stable compared to last month";return{year:e.year,month:e.month,win:n,warning:r,trend:s,generated_at:"",is_cached:!1,credits_used:0}}const ho=[{key:"win",Icon:Yr,color:"text-green-600 dark:text-green-400",bg:"bg-green-100 dark:bg-green-900/30"},{key:"warning",Icon:ze,color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-100 dark:bg-amber-900/30"},{key:"trend",Icon:zn,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-100 dark:bg-blue-900/30"}];function mo({year:e,month:t,reportData:n}){const{t:r}=z("common"),{data:s,refetch:a}=Tt({queryKey:["ai-summary",e,t],queryFn:()=>Ur(e,t),staleTime:1/0,retry:!1}),o=$e({mutationFn:d=>Vr(e,t,void 0,d),onSuccess:()=>{a()},onError:()=>{Hn.error(r("report.aiSummaryError"))}}),l=s??fo(n),c=o.isPending,u=!!s;return!l&&!u?i.jsx(V,{className:"p-4",children:i.jsxs("button",{onClick:()=>o.mutate(!1),disabled:c,className:"flex items-center gap-2 w-full justify-center py-2 text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline disabled:opacity-50",children:[i.jsx(Me,{className:"w-4 h-4"}),r("report.generateSummary"),i.jsxs("span",{className:"text-xs text-gray-400",children:["~0.02 ",r("report.credits")]})]})}):i.jsxs(V,{className:"p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-1.5",children:[i.jsx(Me,{className:"w-4 h-4 text-primary-500"}),r("report.smartSummary")]}),i.jsxs("button",{onClick:()=>o.mutate(!0),disabled:c,className:"text-xs text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 flex items-center gap-1 disabled:opacity-50",children:[i.jsx(Hr,{className:`w-3 h-3 ${c?"animate-spin":""}`}),r("report.regenerate")]})]}),c?i.jsx("div",{className:"flex justify-center py-4",children:i.jsx(It,{size:"sm"})}):i.jsxs("div",{className:"space-y-2.5",children:[ho.map(({key:d,Icon:f,color:h,bg:y})=>i.jsxs("div",{className:"flex items-start gap-2.5",children:[i.jsx("div",{className:`p-1 rounded-md ${y} shrink-0`,children:i.jsx(f,{className:`w-3.5 h-3.5 ${h}`})}),i.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-snug",children:l==null?void 0:l[d]})]},d)),!u&&i.jsxs("button",{onClick:()=>o.mutate(!1),className:"text-xs text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1 mt-1",children:[i.jsx(Me,{className:"w-3 h-3"}),r("report.generateAI"),i.jsxs("span",{className:"text-gray-400",children:["~0.02 ",r("report.credits")]})]})]})]})}function po(e){switch(e){case"ahead":return"success";case"on_track":return"info";default:return"warning"}}function go({goal:e}){const{t}=z("common"),n={ahead:t("report.ahead"),on_track:t("report.onTrack"),behind:t("report.behind")}[e.status]||e.status;return i.jsxs("div",{className:"p-4 border rounded-lg border-gray-200 dark:border-gray-700",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:t("report.goalYears",{years:e.years})}),i.jsx(Vn,{variant:po(e.status),children:n})]}),i.jsx(Ge,{value:Math.min(e.progress_percentage,100),className:"mb-2"}),i.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[i.jsxs("span",{children:[I(e.total_saved)," / ",I(e.target_amount)]}),i.jsxs("span",{children:[e.progress_percentage.toFixed(1),"%"]})]}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:t("report.neededPerMonth",{amount:I(e.needed_per_month)})})]})}function yo({accounts:e,totalNetWorth:t}){const{t:n}=z("common");return i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[i.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:n("report.totalNetWorth")}),i.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:I(t)})]}),i.jsx("div",{className:"space-y-2",children:e.map(r=>i.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:r.account_name}),i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.account_type})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:I(r.balance,r.currency,void 0,!0)}),r.currency!=="JPY"&&i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.currency})]})]},r.account_id))})]})}function xo({insights:e}){const{t}=z("common");return e.length===0?null:i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.insights")}),i.jsx("div",{className:"space-y-3",children:e.map((n,r)=>i.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600",children:[i.jsx("div",{className:"flex items-center gap-2 mb-1",children:i.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:n.title})}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n.message})]},r))})]})}function bo({embedded:e=!1}){const{t}=z("common"),[n,r]=O.useState(new Date),[s,a]=O.useState(!1),o=n.getFullYear(),l=n.getMonth()+1,{data:c,isLoading:u,error:d}=Tt({queryKey:["monthly-report",o,l],queryFn:()=>Gr(o,l),staleTime:1e3*60*5}),f=O.useCallback(async()=>{a(!0);try{const y=await Wr(o,l),m=URL.createObjectURL(y),p=document.createElement("a");p.href=m,p.download=`monthly_report_${o}_${String(l).padStart(2,"0")}.pdf`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(m)}catch{Hn.error(t("report.downloadError"))}finally{a(!1)}},[o,l,t]),h=i.jsxs(i.Fragment,{children:[i.jsx(so,{year:o,month:l,onDownloadPDF:f,isDownloading:s}),i.jsx(wr,{selectedMonth:n,onChange:r,className:"mb-6"}),u&&i.jsx("div",{className:"flex justify-center py-20",children:i.jsx(It,{size:"lg"})}),d&&i.jsx(V,{className:"text-center py-10",children:i.jsx("p",{className:"text-red-500",children:t("report.loadError")})}),c&&i.jsxs("div",{className:"space-y-6",children:[i.jsx(mo,{year:o,month:l,reportData:c}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[i.jsx(xt,{label:t("analytics.heroIncome"),value:I(c.summary.total_income),change:c.summary.income_change,trend:c.summary.income_change>0?"positive":c.summary.income_change<0?"negative":"neutral"}),i.jsx(xt,{label:t("analytics.heroExpense"),value:I(c.summary.total_expense),change:c.summary.expense_change,trend:c.summary.expense_change<0?"positive":c.summary.expense_change>0?"negative":"neutral"}),i.jsx(xt,{label:t("analytics.heroNet"),value:I(c.summary.net_cashflow),change:c.summary.net_change,trend:c.summary.net_change>0?"positive":c.summary.net_change<0?"negative":"neutral"}),i.jsx(xt,{label:t("report.savingsRate"),value:`${c.summary.savings_rate.toFixed(1)}%`,subtitle:t("report.savingsRateDesc")})]}),c.budget_adherence&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.budgetAdherence")}),i.jsx(uo,{focusAreas:c.budget_adherence.focus_areas??[],budgetAdherence:c.budget_adherence})]}),c.category_breakdown.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.categoryBreakdown")}),i.jsx(ur,{data:c.category_breakdown})]}),c.spending_trends.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.spendingTrends")}),i.jsx(lr,{data:c.spending_trends})]}),c.goal_progress.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.goalProgress")}),i.jsx("div",{className:"space-y-4",children:c.goal_progress.map(y=>i.jsx(go,{goal:y},y.goal_id))})]}),c.account_summary.length>0&&i.jsxs(V,{children:[i.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.accountSummary")}),i.jsx(yo,{accounts:c.account_summary,totalNetWorth:c.total_net_worth})]}),i.jsx(xo,{insights:c.insights}),c.summary.total_income===0&&c.summary.total_expense===0&&i.jsx(V,{className:"text-center py-10",children:i.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("report.noData")})})]})]});return e?h:i.jsx("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:h})}function vo(e,t){const n=Xr(t),r=Wt(n>new Date?new Date:n,"yyyy-MM-dd");switch(e){case"current-month":return{start:Wt(oe(t),"yyyy-MM-dd"),end:r};case"3-months":return{start:Wt(fe(oe(t),2),"yyyy-MM-dd"),end:r};case"6-months":return{start:Wt(fe(oe(t),5),"yyyy-MM-dd"),end:r};case"1-year":return{start:Wt(fe(oe(t),11),"yyyy-MM-dd"),end:r};default:return Jr()}}function jo(){const{t:e}=z("common"),t=qr({strict:!1}),[n,r]=O.useState((t==null?void 0:t.tab)==="report"?"report":"overview"),s=O.useRef(null),[a,o]=O.useState(new Date),[l,c]=O.useState("current-month"),[u,d]=O.useState(!1),f=vo(l,a),{data:h,isLoading:y}=Tt({queryKey:["analytics",f],queryFn:()=>Qr(f)}),{data:m}=Tt({queryKey:["insights"],queryFn:Rn}),{data:p}=Tt({queryKey:["goals"],queryFn:Zr}),x=p&&p.length>0?Math.round(p[0].target_amount/(p[0].years*12)):null,g=_=>{c(_)},b=_=>{o(_)},v=O.useCallback(()=>{var _;(_=s.current)==null||_.scrollIntoView({behavior:"smooth"})},[]);return i.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100",children:e("analytics.title")}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:e("analytics.subtitle")})]}),i.jsx("div",{className:"flex justify-center mb-6",children:i.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-full p-1 inline-flex",role:"tablist",children:[i.jsx("button",{role:"tab","aria-selected":n==="overview",onClick:()=>r("overview"),className:M("px-4 py-2 text-sm font-medium rounded-full transition-colors",n==="overview"?"bg-primary-500 text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:e("analytics.tabOverview","Overview")}),i.jsx("button",{role:"tab","aria-selected":n==="report",onClick:()=>r("report"),className:M("px-4 py-2 text-sm font-medium rounded-full transition-colors",n==="report"?"bg-primary-500 text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:e("analytics.tabReport","Monthly Report")})]})}),n==="report"?i.jsx(bo,{embedded:!0}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-6 space-y-3",children:[i.jsx(wr,{selectedMonth:a,onChange:b,className:"justify-center"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ro,{selected:l,onChange:g})})]}),y?i.jsx("div",{className:"flex justify-center py-12",children:i.jsx(It,{size:"lg"})}):i.jsxs("div",{className:"space-y-6",children:[h&&i.jsx(xa,{analytics:h}),(m==null?void 0:m.insights)&&m.insights.length>0&&i.jsx(eo,{insights:m.insights,onScrollToChart:v}),i.jsxs("div",{ref:s,className:"space-y-6",children:[i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.incomeVsExpense")}),i.jsx(Be,{className:"h-64 sm:h-80",children:h!=null&&h.monthly_trends&&h.monthly_trends.length>0?i.jsx(lr,{data:h.monthly_trends}):i.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]}),i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.categoryBreakdown")}),i.jsx(Be,{className:"h-64 sm:h-80",children:h!=null&&h.category_breakdown&&h.category_breakdown.length>0?i.jsx(ur,{data:h.category_breakdown}):i.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]}),i.jsxs(V,{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.monthlyCashFlow")}),i.jsx("div",{className:"h-64 sm:h-80",children:h!=null&&h.monthly_trends&&h.monthly_trends.length>0?h.monthly_trends.length<3?i.jsx(Xs,{data:h.monthly_trends,savingsGoal:x}):i.jsx(Be,{className:"h-full",children:i.jsx(qs,{data:h.monthly_trends,dataKey:"net"})}):i.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]})]}),i.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[i.jsxs("button",{onClick:()=>d(!u),className:M("w-full px-4 py-3 flex items-center justify-between","bg-gray-50 dark:bg-gray-800","text-left font-medium text-gray-900 dark:text-gray-100"),children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{children:"🤖"}),e("analytics.aiTools")]}),i.jsx("span",{className:M("transform transition-transform",u?"rotate-180":""),children:"▼"})]}),u&&i.jsxs("div",{className:"p-4 space-y-4 bg-white dark:bg-gray-900",children:[i.jsx(ya,{}),i.jsx(ma,{})]})]})]})]})]})}const Io=ts("/analytics")({component:jo});export{Io as Route};
