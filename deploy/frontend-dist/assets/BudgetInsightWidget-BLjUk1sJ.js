import{k as $,F as s,u as S,r as j,j as t,aN as R,l as h,P as _,I as M,B as P,Y as E,J as F,K as T,z as q,a6 as L}from"./index-DrTfRdV3.js";import{d as A,e as z}from"./useCategories-BKA-Gn9_.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Y=$("external-link",D);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],J=$("rotate-ccw",H);async function Q(e){return(await s.post("/api/receipts/scan",e)).data}async function W(e){const a=new FormData;return a.append("file",e),(await s.post("/api/receipts/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function G(e){return e||null}function O({selected:e,onSelect:a,isIncome:i=!1}){const{t:o}=S("common"),{data:f,isLoading:C}=A(),x=z(),[n,y]=j.useState(null),[p,l]=j.useState(!1),[d,c]=j.useState(""),[b,m]=j.useState("ðŸ“");if(C||!f)return t.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const g=i?f.income:f.expense,k=r=>{for(const w of g)if(w.children.some(I=>I.name===r))return w;return null},B=r=>{y(r),l(!1)},v=r=>{n&&a(r.name,n.name)},N=()=>{y(null),l(!1)},u=async()=>{!n||!d.trim()||(await x.mutateAsync({name:d.trim(),icon:b,parent_id:n.id,type:i?"income":"expense"}),a(d.trim(),n.name),c(""),l(!1))};return n?t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:N,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[t.jsx(R,{className:"w-4 h-4"}),n.icon," ",n.name]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[n.children.map(r=>t.jsxs("button",{type:"button",onClick:()=>v(r),className:h("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",e===r.name?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[t.jsx("span",{className:"text-2xl mb-1",children:r.icon}),t.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:r.name})]},r.id)),t.jsxs("button",{type:"button",onClick:()=>l(!0),className:h("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[t.jsx(_,{className:"w-6 h-6 mb-1 text-gray-400"}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:o("category.addCustom","Add")})]})]}),p&&t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(M,{value:b,onChange:r=>m(r.target.value),className:"w-16 text-center text-xl",maxLength:2}),t.jsx(M,{value:d,onChange:r=>c(r.target.value),placeholder:o("category.namePlaceholder","Category name"),className:"flex-1"})]}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsx(P,{variant:"outline",size:"sm",onClick:()=>l(!1),children:o("cancel","Cancel")}),t.jsx(P,{size:"sm",onClick:u,disabled:!d.trim()||x.isPending,children:o("create","Create")})]})]})]}):t.jsx("div",{className:"grid grid-cols-3 gap-2",children:g.map(r=>{var w;return t.jsxs("button",{type:"button",onClick:()=>B(r),className:h("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((w=k(e))==null?void 0:w.id)===r.id?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[t.jsx("span",{className:"text-2xl mb-1",children:r.icon}),t.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:r.name})]},r.id)})})}async function X(e){return(await s.post("/api/budgets/generate",e)).data}async function Z(e,a){return(await s.post(`/api/budgets/${e}/regenerate`,a)).data}async function ee(e){return(await s.get(`/api/budgets/${e}`)).data}async function U(e){return(await s.get("/api/budgets/tracking/current",{params:e?{month:e}:void 0})).data}async function te(){return(await s.get("/api/budgets/suggestions")).data}async function ae(e,a,i){return(await s.patch(`/api/budgets/${e}/allocations/${encodeURIComponent(a)}`,{amount:i})).data}async function re(e,a){return(await s.delete(`/api/budgets/${e}/allocations/${encodeURIComponent(a)}`)).data}async function se(e){return(await s.post("/api/budgets/copy",e)).data}async function ne(e,a){return(await s.get("/api/budgets/copy/preview",{params:{source_month:e,target_month:a}})).data}async function oe(e){return(await s.get(`/api/budgets/${e}/versions`)).data}async function ce(e){return(await s.post(`/api/budgets/${e}/restore`)).data}function ie({parentCategory:e,transactionAmount:a,isExpense:i}){var N;const{t:o}=S("common"),{currency:f}=E(),{isPrivacyMode:C}=F(),{data:x}=T(),n=j.useMemo(()=>{const u=new Date;return`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`},[]),{data:y}=q({queryKey:["budget","tracking",n],queryFn:()=>U(n),staleTime:2*60*1e3,retry:!1}),p=u=>L(u,f,(x==null?void 0:x.rates)||{},!0,C);if(!i)return null;const l=(N=y==null?void 0:y.categories)==null?void 0:N.find(u=>u.category===e);if(!l)return null;const{spent:d,budgeted:c}=l,b=c>0?d/c*100:0,m=d+a,g=c>0?m/c*100:0,k=m>c,B=()=>g>=100?"bg-red-500":g>=80?"bg-amber-500":"bg-green-500",v=()=>k?"text-red-600 dark:text-red-400":g>=80?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400";return t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 truncate",children:o("budget.insight.countsToward",{category:e})}),t.jsx("span",{className:h("text-xs font-semibold whitespace-nowrap",v()),children:k?o("budget.insight.over",{amount:p(m-c)}):o("budget.insight.left",{amount:p(c-m)})})]}),t.jsx("div",{className:"mt-1.5",children:t.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:t.jsxs("div",{className:"h-full rounded-full relative overflow-hidden",children:[t.jsx("div",{className:h("h-full rounded-full transition-all duration-300",B()),style:{width:`${Math.min(g,100)}%`}}),a>0&&t.jsx("div",{className:"absolute top-0 h-full opacity-50 rounded-r-full",style:{left:`${Math.min(b,100)}%`,width:`${Math.min(g-b,100-Math.min(b,100))}%`,background:"repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.4) 2px, rgba(255,255,255,0.4) 4px)"}})]})})}),t.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[o("budget.budgetContext.progress",{spent:p(d),budgeted:p(c)}),a>0&&t.jsxs("span",{className:h("ml-1",v()),children:["â†’ ",p(m)]})]}),k&&a>0&&t.jsx("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mt-1",children:o("budget.insight.willExceed")})]})}export{ie as B,Y as E,O as H,J as R,ce as a,ee as b,se as c,re as d,U as e,te as f,X as g,oe as h,G as i,W as j,ne as p,Z as r,Q as s,ae as u};
