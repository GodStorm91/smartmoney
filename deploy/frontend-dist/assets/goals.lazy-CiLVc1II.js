import{j as e,c as W,u as E,k as Z,m as oe}from"./vendor-tanstack-DOuiVnRb.js";import{r as m,a as ne}from"./vendor-react-B9eo89kj.js";import{c as G,I as K,u as le,O as ce,P as ie,B,Q as de,R as ue,T as me,L as I,U as ge,V as xe,W as ye,X as he}from"./index-COcbc7mT.js";import{B as be}from"./Badge-CMCbFjx_.js";import{u as k}from"./vendor-i18n-CtQU9zWU.js";import"./vendor-recharts-BfEtinVu.js";import"./vendor-icons-Boynwk5e.js";import"./vendor-date-fteVm545.js";function H({years:r,custom:c=!1,disabled:s=!1,onClick:a}){const{t:o}=k(),t=()=>c?o("goals.card.customPeriod"):o("goals.card.yearGoal",{years:r}),i=()=>o(c?"goals.card.customDescription":r===1?"goals.card.shortTerm":r===3?"goals.card.mediumTerm":r===5?"goals.card.mediumLongTerm":r===10?"goals.card.longTerm":"goals.card.createGoal"),u=()=>c?"âš™ï¸":"âž•";return e.jsxs("button",{onClick:a,disabled:s,className:G("relative w-full p-6 rounded-xl border-2 border-dashed","transition-all duration-200 ease-out","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",s?"border-gray-200 bg-gray-50 cursor-not-allowed opacity-60":"border-gray-300 bg-white hover:border-primary-500 hover:bg-primary-50 hover:shadow-md cursor-pointer"),"aria-label":s?o("goals.card.ariaDisabled",{label:t()}):o("goals.card.ariaCreate",{label:t()}),"aria-disabled":s,children:[s&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(be,{variant:"default",className:"text-xs",children:o("goals.card.alreadySet")})}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:G("text-5xl transition-transform duration-200",!s&&"group-hover:scale-110"),children:u()}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:G("text-lg font-semibold mb-1",s?"text-gray-400":"text-gray-900"),children:t()}),e.jsx("p",{className:G("text-sm",s?"text-gray-400":"text-gray-600"),children:i()})]})]})]})}const fe=[1,3,5,10];function X({onCreateClick:r,existingGoalYears:c,maxGoals:s}){const{t:a}=k("common"),o=i=>c.includes(i),t=s-c.length;return e.jsxs("div",{className:"w-full max-w-5xl mx-auto py-12 px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a("goals.createGoal")}),e.jsxs("p",{className:"text-gray-600",children:[a("goals.selectPeriod"),t>0&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["ï¼ˆ",a("goals.remainingSlots",{count:t}),"ï¼‰"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6",children:[fe.map(i=>e.jsx(H,{years:i,disabled:o(i),onClick:()=>r(i)},i)),e.jsx(H,{custom:!0,disabled:t<=0,onClick:()=>r()})]}),t<=0&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:a("goals.maxGoalsReached",{max:s})})})]})}function pe({selectedOption:r,customDate:c,customDateError:s,onOptionChange:a,onCustomDateChange:o}){const{t,i18n:i}=k(),u=new Date(new Date().getFullYear(),new Date().getMonth()+1,1),d=i.language==="ja"?"ja-JP":i.language==="vi"?"vi-VN":"en-US";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:t("goals.form.startDate")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"today",checked:r==="today",onChange:()=>a("today"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateTodayAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t("goals.form.startDateToday")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date().toLocaleDateString(d)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"month_start",checked:r==="month_start",onChange:()=>a("month_start"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateNextMonthAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t("goals.form.startDateNextMonth")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:u.toLocaleDateString(d)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"custom",checked:r==="custom",onChange:()=>a("custom"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateCustomAria")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:t("goals.form.startDateCustom")}),r==="custom"&&e.jsx(K,{type:"date",value:c,onChange:y=>o(y.target.value),error:s,className:"text-sm","aria-label":t("goals.form.startDateCustomAria")})]})]})]})]})}const ve={emergency_fund:{icon:"ðŸ›¡ï¸",color:"bg-red-50 border-red-200 hover:bg-red-100"},home_down_payment:{icon:"ðŸ ",color:"bg-blue-50 border-blue-200 hover:bg-blue-100"},vacation_travel:{icon:"âœˆï¸",color:"bg-cyan-50 border-cyan-200 hover:bg-cyan-100"},vehicle:{icon:"ðŸš—",color:"bg-green-50 border-green-200 hover:bg-green-100"},education:{icon:"ðŸ“š",color:"bg-purple-50 border-purple-200 hover:bg-purple-100"},wedding:{icon:"ðŸ’",color:"bg-pink-50 border-pink-200 hover:bg-pink-100"},large_purchase:{icon:"ðŸ›’",color:"bg-orange-50 border-orange-200 hover:bg-orange-100"},debt_payoff:{icon:"ðŸ’³",color:"bg-yellow-50 border-yellow-200 hover:bg-yellow-100"},retirement:{icon:"ðŸ–ï¸",color:"bg-teal-50 border-teal-200 hover:bg-teal-100"},investment:{icon:"ðŸ“ˆ",color:"bg-indigo-50 border-indigo-200 hover:bg-indigo-100"},custom:{icon:"ðŸŽ¯",color:"bg-gray-50 border-gray-200 hover:bg-gray-100"}},je=["emergency_fund","home_down_payment","vacation_travel","vehicle","education","wedding","large_purchase","debt_payoff","retirement","investment","custom"];function Ne({selectedType:r,onSelect:c,hasEmergencyFund:s}){const{t:a}=k();return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:a("goals.selectType")}),!s&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:a("goals.emergencyFundFirst")}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:je.map(o=>{const t=ve[o],i=r===o,u=!s&&o!=="emergency_fund";return e.jsxs("button",{onClick:()=>!u&&c(o),disabled:u,className:`
                p-4 rounded-lg border-2 text-center transition-all
                ${i?"ring-2 ring-blue-500 border-blue-500":t.color}
                ${u?"opacity-50 cursor-not-allowed":"cursor-pointer"}
              `,children:[e.jsx("span",{className:"text-2xl block mb-1",children:t.icon}),e.jsx("span",{className:"text-xs font-medium text-gray-700 block",children:a(`goals.types.${o}`)})]},o)})})]})}function Se(r,c,s,a,o){const t={};o||(r<1||r>10)&&(t.years="goals.errors.yearsRange");const i=parseInt(c.replace(/[,.\s]/g,""),10);return!c||isNaN(i)?t.targetAmount="goals.errors.amountRequired":i<1e4&&(t.targetAmount="goals.errors.amountMinimum"),s==="custom"&&!a&&(t.customDate="goals.errors.dateRequired"),t}function ke(r,c){if(r==="today")return new Date().toISOString().split("T")[0];if(r==="month_start"){const s=new Date;return new Date(s.getFullYear(),s.getMonth()+1,1).toISOString().split("T")[0]}else return c}function De(r,c="ja-JP"){const s=r.replace(/[,.\s]/g,"");return/^\d*$/.test(s)?s?parseInt(s,10).toLocaleString("en-US"):"":r}function Ce({isOpen:r,onClose:c,preselectedYears:s,editingGoalId:a}){const o=W(),{t,i18n:i}=k(),[u,d]=m.useState(1),[y,h]=m.useState(null),[p,v]=m.useState(""),[b,g]=m.useState(s||3),[j,D]=m.useState(""),[C,N]=m.useState("today"),[w,S]=m.useState(""),[_,P]=m.useState("JPY"),[L,l]=m.useState(null),[f,q]=m.useState({}),[$,O]=m.useState(""),{data:Q=[]}=le(),{data:ee=!0}=E({queryKey:["has-emergency-fund"],queryFn:de,enabled:r&&!a}),{data:x}=E({queryKey:["goal",a],queryFn:()=>ue(a),enabled:!!a&&r});m.useEffect(()=>{if(r){if(a&&x){d(2),h(x.goal_type||"custom"),v(x.name||""),g(x.years);const n=i.language==="ja"?"ja-JP":i.language==="vi"?"vi-VN":"en-US";D(x.target_amount.toLocaleString(n)),x.start_date&&(N("custom"),S(x.start_date)),l(x.account_id||null)}else d(1),h(null),v(""),g(s||3),D(""),N("today"),S(""),P("JPY"),l(null);q({}),O("")}},[r,s,a,x]);const A=Z({mutationFn:async n=>a?ce(a,n):ie(n),onSuccess:()=>{o.invalidateQueries({queryKey:["goals"]}),o.invalidateQueries({queryKey:["goals-progress-full"]}),o.invalidateQueries({queryKey:["has-emergency-fund"]}),o.invalidateQueries({queryKey:["accounts"]}),c()},onError:()=>{O(t(a?"goals.errors.updateFailed":"goals.errors.createFailed"))}}),te=n=>{h(n),p||v(t(`goals.types.${n}`)),d(2)},ae=()=>{switch(_){case"JPY":return`Â¥${1e4.toLocaleString()}`;case"USD":return`$${1e4.toLocaleString()}`;case"VND":return`${1e4.toLocaleString()}â‚«`;default:return 1e4.toLocaleString()}},J=n=>{n.preventDefault();const Y=Se(b,j,C,w,s),M={};for(const[z,F]of Object.entries(Y))F&&(F==="goals.errors.amountMinimum"?M[z]=t(F,{amount:ae()}):M[z]=t(F));if(Object.keys(M).length>0){q(M);return}const U=parseInt(j.replace(/[,.\s]/g,""),10),V=ke(C,w);a?A.mutate({name:p||void 0,target_amount:U,start_date:V||void 0,account_id:L||void 0}):A.mutate({goal_type:y||"custom",name:p||void 0,target_amount:U,currency:_,years:b,start_date:V||void 0})},re=n=>{const Y=i.language==="ja"?"ja-JP":i.language==="vi"?"vi-VN":"en-US";D(De(n.target.value,Y))};if(!r)return null;const se=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:c}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t(a?"goals.modal.editTitle":u===1?"goals.modal.createTitle":`goals.types.${y}`)}),!a&&u===2&&e.jsxs("button",{onClick:()=>d(1),className:"text-sm text-blue-600 hover:underline mt-1",children:["â† ",t("common.back")]})]}),e.jsx("div",{className:"p-6",children:u===1&&!a?e.jsx(Ne,{selectedType:y,onSelect:te,hasEmergencyFund:ee}):e.jsxs("form",{onSubmit:J,className:"space-y-5",children:[e.jsx(K,{label:t("goals.form.name"),type:"text",value:p,onChange:n=>v(n.target.value),placeholder:t("goals.form.namePlaceholder")}),!s&&!a&&e.jsx(K,{label:t("goals.form.years"),type:"number",min:1,max:10,value:b,onChange:n=>g(parseInt(n.target.value,10)||1),error:f.years,required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("goals.form.currency")}),e.jsxs("select",{value:_,onChange:n=>P(n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",disabled:!!a,children:[e.jsx("option",{value:"JPY",children:t("currency.JPY")}),e.jsx("option",{value:"USD",children:t("currency.USD")}),e.jsx("option",{value:"VND",children:t("currency.VND")})]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(K,{label:t("goals.form.targetAmount"),type:"text",value:j,onChange:re,error:f.targetAmount,placeholder:t("goals.form.targetAmountPlaceholder"),required:!0})})]}),e.jsx(pe,{selectedOption:C,customDate:w,customDateError:f.customDate,onOptionChange:N,onCustomDateChange:S}),(a||Q.length>0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("goals.form.linkedAccount")}),e.jsxs("select",{value:L||"",onChange:n=>l(n.target.value?parseInt(n.target.value,10):null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:t("goals.form.autoCreateAccount")}),Q.map(n=>e.jsxs("option",{value:n.id,children:[n.name," (",t(`account.type.${n.type}`),")"]},n.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t("goals.form.linkedAccountHint")})]}),$&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-800 dark:text-red-300",children:$})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-6 py-4 flex gap-3 justify-end",children:[e.jsx(B,{variant:"outline",onClick:c,disabled:A.isPending,children:t("common.cancel")}),u===2&&e.jsx(B,{variant:"primary",onClick:J,disabled:A.isPending||!j,children:A.isPending?t("goals.modal.creating"):t(a?"goals.modal.update":"goals.modal.create")})]})]})]});return typeof document>"u"?null:ne.createPortal(se,document.body)}const R=4,T=3;function we(){const{t:r}=k("common"),c=W(),[s,a]=m.useState(!1),[o,t]=m.useState(),[i,u]=m.useState(null),{data:d,isLoading:y}=E({queryKey:["goals"],queryFn:xe}),{data:h,isLoading:p}=E({queryKey:["goals-progress-full",d==null?void 0:d.map(l=>l.id),T],queryFn:async()=>!d||d.length===0?[]:Promise.all(d.map(l=>ye(l.id,!0,T))),enabled:!!d&&d.length>0}),v=new Date,b=new Date;b.setMonth(b.getMonth()-T);const{data:g}=E({queryKey:["category-breakdown-goals",T],queryFn:()=>he({start:b.toISOString().split("T")[0],end:v.toISOString().split("T")[0]}),enabled:!!d&&d.length>0}),j=m.useMemo(()=>{if(!(g!=null&&g.length))return;const l=[...g].filter(f=>f.category.toLowerCase()!=="transfer").sort((f,q)=>q.amount-f.amount);if(l[0])return{name:l[0].category,monthlyAmount:l[0].amount/T}},[g]),D=Z({mutationFn:me,onSuccess:()=>{c.invalidateQueries({queryKey:["goals"]}),c.invalidateQueries({queryKey:["goals-progress-full"]}),c.invalidateQueries({queryKey:["has-emergency-fund"]})}}),C=y||p,N=(d==null?void 0:d.map(l=>l.years))||[],w=N.length<R,S=l=>{t(l),u(null),a(!0)},_=l=>{u(l),t(void 0),a(!0)},P=l=>{D.mutate(l)},L=()=>{a(!1),t(void 0),u(null)};return e.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:r("goals.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:r("goals.subtitle")})]}),C?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{size:"lg"})}):h&&h.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6",children:h.map(l=>l.achievability&&e.jsx(ge,{goalId:l.goal_id,goalName:r("goals.yearGoal",{years:l.years}),achievability:l.achievability,targetAmount:l.target_amount,currentAmount:l.total_saved,onEdit:_,onDelete:P,topExpenseCategory:j},l.goal_id))}),w&&e.jsx("div",{className:"mt-12",children:e.jsx(X,{onCreateClick:S,existingGoalYears:N,maxGoals:R})})]}):d&&d.length>0?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{size:"lg"})}):e.jsx(X,{onCreateClick:S,existingGoalYears:[],maxGoals:R}),e.jsx(Ce,{isOpen:s,onClose:L,preselectedYears:o,editingGoalId:i})]})}const Fe=oe("/goals")({component:we});export{Fe as Route};
