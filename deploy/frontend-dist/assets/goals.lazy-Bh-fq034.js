import{u as q,$ as ae,N as re,M as se,r as f,j as e,l as j,g as oe,aA as ue,aE as E,T as xe,a8 as W,I as z,J as ne,a1 as he,z as $,a3 as le,aF as ye,aG as be,B as Z,v as de,aH as fe,aI as pe,aJ as ve,n as je,ay as Ne,az as ke,E as R,P as we,aK as Ce,aL as Se,aM as De,i as _e}from"./index-CqkF-9Du.js";import{C as Te}from"./chevron-up-CR4GJipl.js";import{C as Pe}from"./chevron-down-U6P-4oA9.js";import{P as Ae}from"./pencil-BObNW1Jj.js";import{u as Me}from"./useXPGain-DX6Gl6aa.js";function qe({goalId:s,goalName:i,achievability:r,targetAmount:a,currentAmount:g,onEdit:t,onDelete:l,topExpenseCategory:u}){const{t:o}=q("common"),{currency:b}=ae(),{data:m}=re(),{isPrivacyMode:c}=se(),[k,h]=f.useState(!1),[_,w]=f.useState(!1),N=a>0?Math.min(100,g/a*100):0,y=r.current_monthly_net>=r.required_monthly,v=N>=100,A=()=>{if(v)return o("goal.insight.achieved");if(y)return o("goal.insight.onTrackMonths",{months:r.months_remaining});const x=r.monthly_gap;if(x>0){const C=W(x,b,(m==null?void 0:m.rates)||{},!1,c);return o("goal.insight.saveMore",{amount:C})}return o("goal.insight.everyBitCounts")},T=v||y?"text-emerald-600 dark:text-emerald-400":"text-amber-600 dark:text-amber-400",P=v||y?"bg-emerald-50 dark:bg-emerald-900/20":"bg-amber-50 dark:bg-amber-900/20",M=v||y?"bg-emerald-500":"bg-amber-500";return e.jsxs("div",{className:j("rounded-xl border overflow-hidden transition-all","bg-white dark:bg-gray-800","border-gray-200 dark:border-gray-700","hover:shadow-md"),children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸŽ¯"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i})]}),e.jsxs("div",{className:j("flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",v||y?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400"),children:[v?"ðŸŽ‰":y?e.jsx(oe,{className:"w-3 h-3"}):e.jsx(ue,{className:"w-3 h-3"}),o(v?"goal.status.completed":y?"goal.status.onTrack":"goal.status.behind")]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-end mb-1.5",children:[e.jsxs("div",{children:[e.jsxs("span",{className:j("text-2xl font-bold",T),children:[Math.round(N),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[E(g,b,(m==null?void 0:m.rates)||{},!0,c)," / ",E(a,b,(m==null?void 0:m.rates)||{},!0,c)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.months_remaining," ",o("goal.months","months")]}),!v&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:y?o("goal.onTrack","On track"):o("goal.behind","Behind")})]})]}),e.jsx("div",{className:"w-full h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-all duration-500",M),style:{width:`${Math.min(100,N)}%`}})})]}),e.jsx("div",{className:j("rounded-lg p-2.5",P),children:e.jsxs("p",{className:j("text-xs",T),children:["ðŸ’¡ ",A()]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>h(!k),className:"flex-1 flex items-center justify-center gap-1 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:k?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),o("button.hideDetails","Hide Details")]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),o("button.showDetails","Show Details")]})}),t&&e.jsxs("button",{onClick:()=>t(s),className:"flex items-center gap-1 px-3 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(Ae,{className:"w-3.5 h-3.5"}),o("button.edit","Edit")]}),l&&!_&&e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-1 px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(xe,{className:"w-3.5 h-3.5"}),o("button.delete","Delete")]})]}),_&&l&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700 animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-xs text-center text-gray-600 dark:text-gray-400 mb-2",children:o("goal.deleteConfirm")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 py-1.5 text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:o("button.cancel","Cancel")}),e.jsx("button",{onClick:()=>{l(s),w(!1)},className:"flex-1 py-1.5 text-xs text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:o("button.delete","Delete")})]})]})]}),k&&e.jsxs("div",{className:"px-4 pb-4 pt-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0.5",children:o("goal.savingNow","Saving now")}),e.jsxs("p",{className:j("text-sm font-semibold",y?"text-emerald-600 dark:text-emerald-400":"text-amber-600 dark:text-amber-400"),children:[E(r.current_monthly_net,b,(m==null?void 0:m.rates)||{},!1,c),e.jsx("span",{className:"text-xs font-normal text-gray-400",children:"/mo"})]})]}),e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0.5",children:o("goal.needed","Needed")}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:[E(r.required_monthly,b,(m==null?void 0:m.rates)||{},!1,c),e.jsx("span",{className:"text-xs font-normal text-gray-400",children:"/mo"})]})]})]}),!y&&!v&&u&&u.monthlyAmount>0&&e.jsx("div",{className:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:["ðŸ’° ",o("goal.insight.topExpenseTip",{category:o(`categories.${u.name}`,{defaultValue:u.name}),amount:W(u.monthlyAmount,b,(m==null?void 0:m.rates)||{},!1,c)})]})})]})]})}function ee({years:s,custom:i=!1,disabled:r=!1,onClick:a,className:g}){const{t}=q(),l=()=>i?t("goals.card.customPeriod"):t("goals.card.yearGoal",{years:s}),u=()=>t(i?"goals.card.customDescription":s===1?"goals.card.shortTerm":s===3?"goals.card.mediumTerm":s===5?"goals.card.mediumLongTerm":s===10?"goals.card.longTerm":"goals.card.createGoal"),o=()=>i?"âš™ï¸":"ðŸ“Œ";return e.jsxs("button",{onClick:a,disabled:r,className:j("relative p-4 rounded-xl border-2 transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1",r?"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 cursor-not-allowed opacity-60":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:shadow-md active:scale-95 cursor-pointer",g),"aria-label":r?t("goals.card.ariaDisabled",{label:l()}):t("goals.card.ariaCreate",{label:l()}),"aria-disabled":r,children:[r&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx(oe,{className:"w-3 h-3 text-gray-500 dark:text-gray-400"})})}),e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"text-3xl",children:o()}),e.jsxs("div",{children:[e.jsx("h3",{className:j("text-sm font-semibold",r?"text-gray-400":"text-gray-900 dark:text-gray-100"),children:l()}),e.jsx("p",{className:j("text-xs mt-0.5",r?"text-gray-400":"text-gray-500 dark:text-gray-400"),children:u()})]})]})]})}const Ee=[1,3,5,10];function te({onCreateClick:s,existingGoalYears:i,maxGoals:r}){const{t:a}=q("common"),g=l=>i.includes(l),t=r-i.length;return e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:a("goals.createGoal")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t>0?a("goals.remainingSlots",{count:t}):a("goals.maxGoalsReached",{max:r})})]})}),t>0&&e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-hide",children:[Ee.map(l=>e.jsx(ee,{years:l,disabled:g(l),onClick:()=>s(l),className:"flex-shrink-0 w-28"},l)),e.jsx(ee,{custom:!0,disabled:t<=0,onClick:()=>s(),className:"flex-shrink-0 w-28"})]}),t===1&&i.length===r-1&&e.jsxs("button",{onClick:()=>s(),disabled:t<=0,className:"w-full py-4 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âœ¨"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a("goals.createGoal")})]})]})}function Le({selectedOption:s,customDate:i,customDateError:r,onOptionChange:a,onCustomDateChange:g}){const{t,i18n:l}=q(),u=new Date(new Date().getFullYear(),new Date().getMonth()+1,1),o=l.language==="ja"?"ja-JP":l.language==="vi"?"vi-VN":"en-US";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:t("goals.form.startDate")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"today",checked:s==="today",onChange:()=>a("today"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateTodayAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t("goals.form.startDateToday")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date().toLocaleDateString(o)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"month_start",checked:s==="month_start",onChange:()=>a("month_start"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateNextMonthAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t("goals.form.startDateNextMonth")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:u.toLocaleDateString(o)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"custom",checked:s==="custom",onChange:()=>a("custom"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateCustomAria")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:t("goals.form.startDateCustom")}),s==="custom"&&e.jsx(z,{type:"date",value:i,onChange:b=>g(b.target.value),error:r,className:"text-sm","aria-label":t("goals.form.startDateCustomAria")})]})]})]})]})}const Fe={emergency_fund:{icon:"ðŸ›¡ï¸",color:"bg-red-50 border-red-200 hover:bg-red-100"},home_down_payment:{icon:"ðŸ ",color:"bg-blue-50 border-blue-200 hover:bg-blue-100"},vacation_travel:{icon:"âœˆï¸",color:"bg-cyan-50 border-cyan-200 hover:bg-cyan-100"},vehicle:{icon:"ðŸš—",color:"bg-green-50 border-green-200 hover:bg-green-100"},education:{icon:"ðŸ“š",color:"bg-purple-50 border-purple-200 hover:bg-purple-100"},wedding:{icon:"ðŸ’",color:"bg-pink-50 border-pink-200 hover:bg-pink-100"},large_purchase:{icon:"ðŸ›’",color:"bg-orange-50 border-orange-200 hover:bg-orange-100"},debt_payoff:{icon:"ðŸ’³",color:"bg-yellow-50 border-yellow-200 hover:bg-yellow-100"},retirement:{icon:"ðŸ–ï¸",color:"bg-teal-50 border-teal-200 hover:bg-teal-100"},investment:{icon:"ðŸ“ˆ",color:"bg-indigo-50 border-indigo-200 hover:bg-indigo-100"},custom:{icon:"ðŸŽ¯",color:"bg-gray-50 border-gray-200 hover:bg-gray-100"}},Ge=["emergency_fund","home_down_payment","vacation_travel","vehicle","education","wedding","large_purchase","debt_payoff","retirement","investment","custom"];function $e({selectedType:s,onSelect:i,hasEmergencyFund:r}){const{t:a}=q();return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:a("goals.selectType")}),!r&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:a("goals.emergencyFundFirst")}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Ge.map(g=>{const t=Fe[g],l=s===g,u=!r&&g!=="emergency_fund";return e.jsxs("button",{onClick:()=>!u&&i(g),disabled:u,className:`
                p-4 rounded-lg border-2 text-center transition-all
                ${l?"ring-2 ring-blue-500 border-blue-500":t.color}
                ${u?"opacity-50 cursor-not-allowed":"cursor-pointer"}
              `,children:[e.jsx("span",{className:"text-2xl block mb-1",children:t.icon}),e.jsx("span",{className:"text-xs font-medium text-gray-700 block",children:a(`goals.types.${g}`)})]},g)})})]})}function Ke(s,i,r,a,g){const t={};g||(s<1||s>10)&&(t.years="goals.errors.yearsRange");const l=parseInt(i.replace(/[,.\s]/g,""),10);return!i||isNaN(l)?t.targetAmount="goals.errors.amountRequired":l<1e4&&(t.targetAmount="goals.errors.amountMinimum"),r==="custom"&&!a&&(t.customDate="goals.errors.dateRequired"),t}function Je(s,i){if(s==="today")return new Date().toISOString().split("T")[0];if(s==="month_start"){const r=new Date;return new Date(r.getFullYear(),r.getMonth()+1,1).toISOString().split("T")[0]}else return i}function Oe(s,i="ja-JP"){const r=s.replace(/[,.\s]/g,"");return/^\d*$/.test(r)?r?parseInt(r,10).toLocaleString("en-US"):"":s}function Ye({isOpen:s,onClose:i,preselectedYears:r,editingGoalId:a}){const g=ne(),{t,i18n:l}=q(),[u,o]=f.useState(1),[b,m]=f.useState(null),[c,k]=f.useState(""),[h,_]=f.useState(r||3),[w,N]=f.useState(""),[y,v]=f.useState("today"),[A,T]=f.useState(""),[P,M]=f.useState("JPY"),[x,C]=f.useState(null),[L,K]=f.useState({}),[J,n]=f.useState(""),{data:S=[]}=he(),{data:F=!0}=$({queryKey:["has-emergency-fund"],queryFn:fe,enabled:s&&!a}),{showGoalCreatedXP:Q}=Me(),{data:p}=$({queryKey:["goal",a],queryFn:()=>pe(a),enabled:!!a&&s});f.useEffect(()=>{if(s){if(a&&p){o(2),m(p.goal_type||"custom"),k(p.name||""),_(p.years);const d=l.language==="ja"?"ja-JP":l.language==="vi"?"vi-VN":"en-US";N(p.target_amount.toLocaleString(d)),p.start_date&&(v("custom"),T(p.start_date)),C(p.account_id||null)}else o(1),m(null),k(""),_(r||3),N(""),v("today"),T(""),M("JPY"),C(null);K({}),n("")}},[s,r,a,p]);const D=le({mutationFn:async d=>a?ye(a,d):be(d),onSuccess:()=>{g.invalidateQueries({queryKey:["goals"]}),g.invalidateQueries({queryKey:["goals-progress-full"]}),g.invalidateQueries({queryKey:["has-emergency-fund"]}),g.invalidateQueries({queryKey:["accounts"]}),Q(),i()},onError:()=>{n(t(a?"goals.errors.updateFailed":"goals.errors.createFailed"))}}),ie=d=>{m(d),c||k(t(`goals.types.${d}`)),o(2)},ce=()=>{switch(P){case"JPY":return`Â¥${1e4.toLocaleString()}`;case"USD":return`$${1e4.toLocaleString()}`;case"VND":return`${1e4.toLocaleString()}â‚«`;default:return 1e4.toLocaleString()}},B=d=>{d.preventDefault();const V=Ke(h,w,y,A,r),O={};for(const[X,Y]of Object.entries(V))Y&&(Y==="goals.errors.amountMinimum"?O[X]=t(Y,{amount:ce()}):O[X]=t(Y));if(Object.keys(O).length>0){K(O);return}const H=parseInt(w.replace(/[,.\s]/g,""),10),I=Je(y,A);a?D.mutate({name:c||void 0,target_amount:H,start_date:I||void 0,account_id:x||void 0}):D.mutate({goal_type:b||"custom",name:c||void 0,target_amount:H,currency:P,years:h,start_date:I||void 0})},me=d=>{const V=l.language==="ja"?"ja-JP":l.language==="vi"?"vi-VN":"en-US";N(Oe(d.target.value,V))};if(!s)return null;const ge=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:i}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t(a?"goals.modal.editTitle":u===1?"goals.modal.createTitle":`goals.types.${b}`)}),!a&&u===2&&e.jsxs("button",{onClick:()=>o(1),className:"text-sm text-blue-600 hover:underline mt-1",children:["â† ",t("back")]})]}),e.jsx("div",{className:"p-6",children:u===1&&!a?e.jsx($e,{selectedType:b,onSelect:ie,hasEmergencyFund:F}):e.jsxs("form",{onSubmit:B,className:"space-y-5",children:[e.jsx(z,{label:t("goals.form.name"),type:"text",value:c,onChange:d=>k(d.target.value),placeholder:t("goals.form.namePlaceholder")}),!r&&!a&&e.jsx(z,{label:t("goals.form.years"),type:"number",min:1,max:10,value:h,onChange:d=>_(parseInt(d.target.value,10)||1),error:L.years,required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("goals.form.currency")}),e.jsxs("select",{value:P,onChange:d=>M(d.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",disabled:!!a,children:[e.jsx("option",{value:"JPY",children:t("currency.JPY")}),e.jsx("option",{value:"USD",children:t("currency.USD")}),e.jsx("option",{value:"VND",children:t("currency.VND")})]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(z,{label:t("goals.form.targetAmount"),type:"text",value:w,onChange:me,error:L.targetAmount,placeholder:t("goals.form.targetAmountPlaceholder"),required:!0})})]}),e.jsx(Le,{selectedOption:y,customDate:A,customDateError:L.customDate,onOptionChange:v,onCustomDateChange:T}),(a||S.length>0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("goals.form.linkedAccount")}),e.jsxs("select",{value:x||"",onChange:d=>C(d.target.value?parseInt(d.target.value,10):null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:t("goals.form.autoCreateAccount")}),S.map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",t(`account.type.${d.type}`),")"]},d.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t("goals.form.linkedAccountHint")})]}),J&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-800 dark:text-red-300",children:J})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-6 py-4 flex gap-3 justify-end",children:[e.jsx(Z,{variant:"outline",onClick:i,disabled:D.isPending,children:t("cancel")}),u===2&&e.jsx(Z,{variant:"primary",onClick:B,disabled:D.isPending||!w,children:D.isPending?t("goals.modal.creating"):t(a?"goals.modal.update":"goals.modal.create")})]})]})]});return typeof document>"u"?null:de.createPortal(ge,document.body)}const U=4,G=3;function Ue(){const{t:s}=q("common"),i=ne(),[r,a]=f.useState(!1),[g,t]=f.useState(),[l,u]=f.useState(null),{currency:o}=ae(),{data:b}=re(),{isPrivacyMode:m}=se(),{data:c,isLoading:k}=$({queryKey:["goals"],queryFn:Ce}),{data:h,isLoading:_}=$({queryKey:["goals-progress-full",c==null?void 0:c.map(n=>n.id),G],queryFn:async()=>!c||c.length===0?[]:Promise.all(c.map(n=>Se(n.id,!0,G))),enabled:!!c&&c.length>0}),w=new Date,N=new Date;N.setMonth(N.getMonth()-G);const{data:y}=$({queryKey:["category-breakdown-goals",G],queryFn:()=>De({start:N.toISOString().split("T")[0],end:w.toISOString().split("T")[0]}),enabled:!!c&&c.length>0}),v=f.useMemo(()=>{if(!(y!=null&&y.length))return;const n=[...y].filter(S=>S.category.toLowerCase()!=="transfer").sort((S,F)=>F.amount-S.amount);if(n[0])return{name:n[0].category,monthlyAmount:n[0].amount/G}},[y]),A=le({mutationFn:ve,onSuccess:()=>{i.invalidateQueries({queryKey:["goals"]}),i.invalidateQueries({queryKey:["goals-progress-full"]}),i.invalidateQueries({queryKey:["has-emergency-fund"]})}}),T=k||_,P=(c==null?void 0:c.map(n=>n.years))||[],M=P.length<U,x=f.useMemo(()=>{if(!(h!=null&&h.length))return null;const n=h.reduce((p,D)=>p+D.target_amount,0),S=h.reduce((p,D)=>p+D.total_saved,0),F=n>0?S/n*100:0,Q=h.filter(p=>p.achievability&&p.achievability.current_monthly_net>=p.achievability.required_monthly).length;return{totalTarget:n,totalSaved:S,avgProgress:F,onTrackCount:Q,totalCount:h.length}},[h]),C=n=>{t(n),u(null),a(!0)},L=n=>{u(n),t(void 0),a(!0)},K=n=>{A.mutate(n)},J=()=>{a(!1),t(void 0),u(null)};return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary-600"}),s("goals.title")]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(h==null?void 0:h.length)||0,"/",U]})]}),x&&x.totalCount>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:E(x.totalSaved,o,(b==null?void 0:b.rates)||{},!0,m)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-500",children:E(x.totalTarget,o,(b==null?void 0:b.rates)||{},!0,m)})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-all duration-500",x.avgProgress>=100?"bg-emerald-500":x.avgProgress>=50?"bg-primary-500":"bg-amber-500"),style:{width:`${Math.min(100,x.avgProgress)}%`}})})]}),e.jsxs("div",{className:j("flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full",x.onTrackCount===x.totalCount?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":x.onTrackCount>0?"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400":"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-400"),children:[x.onTrackCount===x.totalCount?e.jsx(Ne,{className:"w-3.5 h-3.5"}):x.onTrackCount>0?e.jsx(ke,{className:"w-3.5 h-3.5"}):null,x.onTrackCount,"/",x.totalCount]})]})]})}),e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:T?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(R,{size:"lg"})}):h&&h.length>0?e.jsxs("div",{className:"space-y-4",children:[h.map(n=>n.achievability&&e.jsx(qe,{goalId:n.goal_id,goalName:s("goals.yearGoal",{years:n.years}),achievability:n.achievability,targetAmount:n.target_amount,currentAmount:n.total_saved,onEdit:L,onDelete:K,topExpenseCategory:v},n.goal_id)),M&&e.jsx("div",{className:"mt-6",children:e.jsx(te,{onCreateClick:C,existingGoalYears:P,maxGoals:U})})]}):c&&c.length>0?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(R,{size:"lg"})}):e.jsx(te,{onCreateClick:C,existingGoalYears:[],maxGoals:U})}),M&&typeof document<"u"&&de.createPortal(e.jsx("button",{onClick:()=>C(),className:"fixed bottom-20 right-4 z-50 w-14 h-14 rounded-full bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 text-white shadow-lg flex items-center justify-center active:scale-95 transition-all md:hidden","aria-label":s("goals.createGoal"),children:e.jsx(we,{size:28})}),document.body),e.jsx(Ye,{isOpen:r,onClose:J,preselectedYears:g,editingGoalId:l})]})}const Ie=_e("/goals")({component:Ue});export{Ie as Route};
