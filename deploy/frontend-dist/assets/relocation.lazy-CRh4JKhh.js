import{h as J}from"./vendor-router-CjTheb1B.js";import{r as c,j as e}from"./vendor-react-CezGY3Eh.js";import{u as k,c as Q}from"./vendor-query-Dt5Hl5qC.js";import{v as S,C as b,I as T,aj as V,B as Z,j as L,g as R,ak as I,al as $,l as W,am as X,an as ee,t as te,ao as ae}from"./index-BaDR0x1b.js";import{S as _}from"./Select-nmni1BR4.js";import{S as se}from"./Switch-lNmC0zCA.js";import{u as j}from"./vendor-i18n-DHVoooz2.js";import{M as re}from"./map-pin-xCLFDvDo.js";import{C as ne}from"./chevron-up-_fRdyvL-.js";import{C as ie}from"./chevron-down-9pup0Dd4.js";import{M as oe}from"./minus-DRutgZPK.js";import{L as le}from"./lightbulb-BkU5vmjP.js";import"./vendor-charts-Co6UKelL.js";async function ce(){return(await S.get("/api/relocation/cities")).data}async function de(a){return(await S.post("/api/relocation/compare",a)).data}async function me(a){return(await S.get(`/api/relocation/resolve-postal?code=${a}`)).data}function ue(a){const s=a.replace(/\D/g,"").slice(0,7);return s.length<=3?s:`${s.slice(0,3)}-${s.slice(3)}`}function D(a){const[s,t]=c.useState(""),[r,o]=c.useState(""),[l,i]=c.useState(!1),[u,x]=c.useState(!1),h=c.useRef(null),y=c.useCallback(m=>{const p=m.replace(/\D/g,"").slice(0,7);t(p),o(""),h.current&&clearTimeout(h.current),p.length===7&&(h.current=setTimeout(async()=>{i(!0);try{const f=await me(p);f.matched&&f.city_id!=null?(a(String(f.city_id)),x(!1)):(o("postalCodeNotFound"),x(!0))}catch{o("postalCodeNotFound"),x(!0)}finally{i(!1)}},500))},[a]),d=c.useCallback(()=>{x(m=>!m)},[]);return{postalCode:s,error:r,isResolving:l,showDropdown:u,handlePostalCodeChange:y,toggleDropdown:d,setShowDropdown:x}}const xe=["single","couple","couple_1","couple_2","couple_3"],he=["1K","1LDK","2LDK","3LDK"];function pe({onSubmit:a,isLoading:s}){const{t,i18n:r}=j("common"),o=r.language==="ja",[l,i]=c.useState(""),[u,x]=c.useState("single"),[h,y]=c.useState("1K"),[d,m]=c.useState(""),[p,f]=c.useState(""),[M,O]=c.useState(!1),z=D(c.useCallback(n=>m(n),[])),E=D(c.useCallback(n=>f(n),[])),{data:v,isLoading:K}=k({queryKey:["relocation-cities"],queryFn:ce,staleTime:1e3*60*30}),Y=[{value:"",label:t("relocation.selectCity")},...(v==null?void 0:v.map(n=>({value:String(n.id),label:o?`${n.prefecture_name} ${n.city_name}`:`${n.city_name_en}, ${n.prefecture_name_en}`})))??[]],q=xe.map(n=>({value:n,label:t(`relocation.familySize.${n}`)})),G=he.map(n=>({value:n,label:n})),A=n=>{n.preventDefault(),!(!l||!d||!p)&&a({nenshu:Number(l),family_size:u,room_type:h,current_city_id:Number(d),target_city_id:Number(p),has_young_children:M})},B=l&&Number(l)>0&&d&&p&&d!==p,P=(n,w,U,H,g)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{id:`${n}PostalCode`,label:t("relocation.postalCodeLabel"),type:"text",inputMode:"numeric",placeholder:t("relocation.postalCodePlaceholder"),value:ue(g.postalCode),onChange:C=>g.handlePostalCodeChange(C.target.value),error:g.error?t(`relocation.${g.error}`):void 0,disabled:g.isResolving}),e.jsxs("button",{type:"button",onClick:()=>{g.toggleDropdown()},className:"flex items-center gap-1 text-xs text-primary-600 dark:text-primary-400 hover:underline",children:[t("relocation.chooseManually"),g.showDropdown?e.jsx(ne,{className:"w-3 h-3"}):e.jsx(ie,{className:"w-3 h-3"})]}),g.showDropdown&&e.jsx(_,{id:n,label:w,options:Y,value:U,onChange:C=>{H(C.target.value),g.setShowDropdown(!1)},disabled:K})]});return e.jsx(b,{children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsx(T,{id:"nenshu",label:t("relocation.nenshu"),type:"text",inputMode:"numeric",placeholder:t("relocation.nenshuPlaceholder"),value:l?Number(l).toLocaleString():"",onChange:n=>{const w=n.target.value.replace(/[^\d]/g,"");i(w)}}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(_,{id:"familySize",label:t("relocation.familySizeLabel"),options:q,value:u,onChange:n=>x(n.target.value)}),e.jsx(_,{id:"roomType",label:t("relocation.roomTypeLabel"),options:G,value:h,onChange:n=>y(n.target.value)})]}),["couple_1","couple_2","couple_3"].includes(u)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"hasYoungChildren",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("relocation.hasYoungChildren")}),e.jsx(se,{checked:M,onChange:O})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx(re,{className:"w-4 h-4"}),t("relocation.citySelection")]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr] gap-3 items-start",children:[P("currentCity",t("relocation.currentCity"),d,m,z),e.jsx(V,{className:"hidden sm:block w-5 h-5 text-gray-400 mt-10"}),P("targetCity",t("relocation.targetCity"),p,f,E)]})]}),e.jsx(Z,{type:"submit",loading:s,disabled:!B,className:"w-full",children:t("relocation.compare")})]})})}const ge=["rent","estimated_food","estimated_utilities","estimated_transport","social_insurance","resident_tax","income_tax","estimated_childcare"];function N(a){return`Â¥${a.toLocaleString()}`}function F({breakdown:a,label:s}){const{t}=j("common");return e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1 truncate",children:s}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3 truncate",children:a.prefecture_name}),e.jsx("div",{className:"space-y-2",children:ge.map(r=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 truncate mr-2",children:t(`relocation.cost.${r}`)}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white whitespace-nowrap",children:r==="estimated_childcare"&&a[r]===0?t("relocation.childcareFree"):N(a[r])})]},r))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:t("relocation.totalMonthly")}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:N(a.total_monthly)})]})})]})}function ye({data:a}){const{t:s}=j("common"),t=a.monthly_difference,r=t<0,o=t>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{variant:"gradient",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s("relocation.monthlyDiff")}),e.jsxs("p",{className:L("text-2xl font-bold",r?"text-emerald-600 dark:text-emerald-400":o?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:[r?"":o?"+":"",N(t)]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s("relocation.annualDiff"),": ",r?"":o?"+":"",N(a.annual_difference)]})]}),e.jsx(R,{variant:r?"success":o?"error":"default",children:e.jsxs("span",{className:"flex items-center gap-1",children:[r?e.jsx(I,{className:"w-3 h-3"}):o?e.jsx($,{className:"w-3 h-3"}):e.jsx(oe,{className:"w-3 h-3"}),s(r?"relocation.saving":o?"relocation.moreExpensive":"relocation.same")]})})]})}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:s("relocation.breakdown")}),e.jsxs("div",{className:"flex gap-4 sm:gap-6",children:[e.jsx(F,{breakdown:a.current,label:a.current.city_name}),e.jsx("div",{className:"w-px bg-gray-200 dark:bg-gray-700 shrink-0"}),e.jsx(F,{breakdown:a.target,label:a.target.city_name})]})]})]})}function fe({monthlyDifference:a}){const{t:s}=j("common"),{data:t}=k({queryKey:["goals"],queryFn:X}),{data:r}=k({queryKey:["goals-progress-relocation",t==null?void 0:t.map(i=>i.id)],queryFn:async()=>t!=null&&t.length?Promise.all(t.map(i=>ee(i.id,!0,3))):[],enabled:!!(t!=null&&t.length)});if(!(r!=null&&r.length)||a===0)return null;const o=a<0,l=Math.abs(a);return e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(W,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s("relocation.goalImpact")})]}),e.jsx("div",{className:"space-y-3",children:r.map(i=>{if(!i.achievability)return null;const u=i.target_amount-i.total_saved;if(u<=0)return null;const x=i.achievability.current_monthly_net>0?Math.ceil(u/i.achievability.current_monthly_net):1/0,h=o?i.achievability.current_monthly_net+l:i.achievability.current_monthly_net-l,y=h>0?Math.ceil(u/h):1/0,d=x-y,m=d>0;return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:i.name||s("goals.yearGoal",{years:i.years})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d!==0&&isFinite(d)?e.jsx("span",{className:L(m?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:m?s("relocation.goalFaster",{months:Math.abs(d)}):s("relocation.goalSlower",{months:Math.abs(d)})}):s("relocation.goalNoChange")})]}),e.jsx(R,{variant:m?"success":d<0?"error":"default",children:e.jsxs("span",{className:"flex items-center gap-1",children:[m?e.jsx($,{className:"w-3 h-3"}):d<0?e.jsx(I,{className:"w-3 h-3"}):null,isFinite(y)?s("relocation.monthsRemaining",{months:y}):"-"]})})]},i.goal_id)})})]})}function je({advice:a}){const{t:s}=j("common");return e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(le,{className:"w-5 h-5 text-blue-500 dark:text-teal-400"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s("relocation.adviceTitle")})]}),e.jsx("ul",{className:"space-y-2",children:a.map((t,r)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"mt-1.5 w-1.5 h-1.5 rounded-full bg-blue-400 dark:bg-teal-400 shrink-0"}),e.jsx("span",{children:t})]},r))})]})}function be(){var o;const{t:a}=j("common"),[s,t]=c.useState(null),r=Q({mutationFn:l=>de(l),onSuccess:l=>{t(l)},onError:()=>{te.error(a("relocation.compareError"))}});return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-primary-600"}),a("relocation.title")]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a("relocation.subtitle")})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx(pe,{onSubmit:l=>r.mutate(l),isLoading:r.isPending}),s&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{data:s}),((o=s.advice)==null?void 0:o.length)>0&&e.jsx(je,{advice:s.advice}),e.jsx(fe,{monthlyDifference:s.monthly_difference})]})]})]})}const Re=J("/relocation")({component:be});export{Re as Route};
