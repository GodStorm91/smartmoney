import{k as ae,u as H,H as Y,a1 as se,r as l,a3 as Q,j as e,X as V,l as b,I as T,B as K,x as ne,A as le,C as oe,P as Z,R as ce,i as ie}from"./index-BdLNYqtB.js";import{R as ue}from"./RecurringTransactionsList-f30D7VhH.js";import{S as O}from"./Select-DZYwn299.js";import{R as de}from"./RecurringOptions-B4AIa0xi.js";import{d as ge}from"./useCategories-3gezeTcu.js";import{c as me,u as xe,d as ye,f as he}from"./recurring-service-CIztjdj2.js";import{L as fe}from"./lightbulb-cax-89Aq.js";import{C as pe}from"./chevron-up-NvVroXYN.js";import{C as be}from"./chevron-down-UfJDSWww.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],ve=ae("arrow-left-right",je);function ke({isOpen:d,onClose:o,editItem:s,initialSuggestion:n}){const{t:a}=H("common"),g=Y(),{data:u}=se(),{data:c}=ge(),y=(t=[])=>t.flatMap(x=>[{name:x.name},...x.children.map(re=>({name:re.name}))]),P=y(c==null?void 0:c.expense),L=y(c==null?void 0:c.income),[N,h]=l.useState(""),[r,m]=l.useState(""),[z,w]=l.useState(""),[j,S]=l.useState(null),[C,f]=l.useState(!1),[i,p]=l.useState(!1),[v,_]=l.useState(null),[E,D]=l.useState(""),[k,q]=l.useState("monthly"),[B,R]=l.useState(0),[J,M]=l.useState(1),[U,A]=l.useState(7),[W,F]=l.useState(new Date().toISOString().split("T")[0]);l.useEffect(()=>{var t;d&&s?(h(s.description),m(Math.abs(s.amount).toString()),w(s.category),S(s.account_id),f(s.is_income),p(s.is_transfer),_(s.to_account_id),D(((t=s.transfer_fee_amount)==null?void 0:t.toString())??""),q(s.frequency),R(s.day_of_week??0),M(s.day_of_month??1),A(s.interval_days??7),F(s.next_run_date)):d&&n?(h(n.description),m(n.amount.toString()),w(n.category),S(null),f(n.is_income),p(!1),_(null),D(""),q(n.frequency),R(n.day_of_week??0),M(n.day_of_month??new Date().getDate()),A(n.interval_days??14),F(new Date().toISOString().split("T")[0])):d&&(h(""),m(""),w(""),S(null),f(!1),p(!1),_(null),D(""),q("monthly"),R(0),M(new Date().getDate()),A(7),F(new Date().toISOString().split("T")[0]))},[d,s,n]);const X=Q({mutationFn:me,onSuccess:()=>{g.invalidateQueries({queryKey:["recurring-transactions"]}),o()}}),G=Q({mutationFn:({id:t,data:x})=>xe(t,x),onSuccess:()=>{g.invalidateQueries({queryKey:["recurring-transactions"]}),o()}}),$=t=>{t.preventDefault();const x={description:N,amount:parseInt(r,10),category:i?"Transfer":z,account_id:j,is_income:i?!1:C,is_transfer:i,to_account_id:i?v:null,transfer_fee_amount:i&&E?parseInt(E,10):null,frequency:k,day_of_week:k==="weekly"?B:null,day_of_month:k==="monthly"?J:null,interval_days:k==="custom"?U:null,start_date:W};s?G.mutate({id:s.id,data:x}):X.mutate(x)},ee=i?[]:C?L:P,I=X.isPending||G.isPending;if(!d)return null;const te=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:o}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-lg max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a(s?"recurring.edit":"recurring.add")}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:$,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("transaction.type")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),p(!1)},className:b("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",!C&&!i?"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:a("transaction.expense")}),e.jsx("button",{type:"button",onClick:()=>{f(!0),p(!1)},className:b("flex-1 py-2 px-4 rounded-lg font-medium transition-colors",C&&!i?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:a("transaction.income")}),e.jsxs("button",{type:"button",onClick:()=>{p(!0),f(!1)},className:b("flex-1 py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-1",i?"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:[e.jsx(ve,{className:"w-4 h-4"}),a("recurring.transfer","Transfer")]})]})]}),e.jsx(T,{label:a("transaction.description"),value:N,onChange:t=>h(t.target.value),placeholder:a("recurring.descriptionPlaceholder","e.g., Monthly rent"),required:!0}),e.jsx(T,{label:a("transaction.amount"),type:"number",value:r,onChange:t=>m(t.target.value),placeholder:"0",min:"1",required:!0}),!i&&e.jsx(O,{label:a("transaction.category"),value:z,onChange:t=>w(t.target.value),options:[{value:"",label:a("transaction.selectCategory")},...ee.map(t=>({value:t.name,label:t.name}))],required:!0}),e.jsx(O,{label:i?a("recurring.fromAccount","From Account"):a("transaction.account"),value:(j==null?void 0:j.toString())??"",onChange:t=>S(t.target.value?parseInt(t.target.value,10):null),options:[{value:"",label:a("transaction.selectAccount","Select account")},...(u==null?void 0:u.filter(t=>t.id!==v).map(t=>({value:t.id.toString(),label:t.name})))??[]],required:i}),i&&e.jsxs(e.Fragment,{children:[e.jsx(O,{label:a("recurring.toAccount","To Account"),value:(v==null?void 0:v.toString())??"",onChange:t=>_(t.target.value?parseInt(t.target.value,10):null),options:[{value:"",label:a("recurring.selectDestAccount","Select destination")},...(u==null?void 0:u.filter(t=>t.id!==j).map(t=>({value:t.id.toString(),label:t.name})))??[]],required:!0}),e.jsx(T,{label:a("recurring.transferFee","Transfer Fee (optional)"),type:"number",value:E,onChange:t=>D(t.target.value),placeholder:"0",min:"0"})]}),e.jsx(de,{frequency:k,setFrequency:q,dayOfWeek:B,setDayOfWeek:R,dayOfMonth:J,setDayOfMonth:M,intervalDays:U,setIntervalDays:A}),e.jsx(T,{label:a("recurring.startDate"),type:"date",value:W,onChange:t=>F(t.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(K,{type:"button",variant:"outline",onClick:o,className:"flex-1",children:a("button.cancel")}),e.jsx(K,{type:"submit",disabled:I,className:"flex-1",children:I?a("button.saving","Saving..."):a("button.save")})]})]})]})]});return typeof document>"u"?null:ne.createPortal(te,document.body)}const Ne={JPY:"Â¥"};function we({onCreateFromSuggestion:d}){const{t:o}=H("common"),s=Y(),[n,a]=l.useState(!0),[g,u]=l.useState(null),{data:c,isLoading:y}=le({queryKey:["recurring-suggestions"],queryFn:()=>he(3),staleTime:5*60*1e3}),P=Q({mutationFn:ye,onSuccess:()=>{s.invalidateQueries({queryKey:["recurring-suggestions"]}),u(null)},onError:()=>{u(null)}}),L=(r,m)=>{m.stopPropagation(),u(r),P.mutate(r)},N=r=>{switch(r.frequency){case"weekly":return o("recurring.weekly");case"monthly":return o("recurring.monthly");case"custom":return o("recurring.everyNDays",{n:r.interval_days??14});default:return r.frequency}},h=r=>r>=80?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":r>=60?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300";return y||!c||c.length===0?null:e.jsxs(oe,{className:"mb-6 border-l-4 border-l-amber-400 bg-amber-50/50 dark:bg-amber-950/20",children:[e.jsxs("button",{onClick:()=>a(!n),className:"w-full flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/50 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o("recurring.suggestions.title","Detected Patterns")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:o("recurring.suggestions.subtitle","{{count}} potential recurring transactions found",{count:c.length})})]})]}),n?e.jsx(pe,{className:"w-5 h-5 text-gray-400"}):e.jsx(be,{className:"w-5 h-5 text-gray-400"})]}),n&&e.jsx("div",{className:"mt-4 space-y-3",children:c.map(r=>e.jsx("div",{className:b("p-4 rounded-lg border bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700","transition-opacity",g===r.hash&&"opacity-50"),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:r.description}),e.jsxs("span",{className:b("px-2 py-0.5 text-xs font-medium rounded-full",h(r.confidence)),children:[r.confidence,"%"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:b("font-numbers",r.is_income?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[r.is_income?"+":"-",Ne.JPY,r.amount.toLocaleString()]}),e.jsx("span",{children:r.category}),e.jsx("span",{children:N(r)}),e.jsx("span",{className:"text-xs",children:o("recurring.suggestions.occurrences","{{count}} times",{count:r.occurrences})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(K,{size:"sm",variant:"primary",onClick:()=>d(r),className:"gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),o("button.create")]}),e.jsx("button",{onClick:m=>L(r.hash,m),disabled:g===r.hash,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:o("recurring.suggestions.dismiss","Dismiss"),children:e.jsx(V,{className:"w-4 h-4"})})]})]})},r.hash))})]})}function Se(){const{t:d}=H("common"),o=Y(),[s,n]=l.useState(!1),[a,g]=l.useState(null),u=y=>{g(y),n(!0)},c=()=>{n(!1),g(null),o.invalidateQueries({queryKey:["recurring-suggestions"]})};return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d("recurring.pageTitle","Recurring Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:d("recurring.pageSubtitle","Automate your regular income and expenses")})]})]}),e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Z,{className:"w-5 h-5"}),d("recurring.add","Add Recurring")]})]}),e.jsx(we,{onCreateFromSuggestion:u}),e.jsx(ue,{}),e.jsx(ke,{isOpen:s,onClose:c,initialSuggestion:a})]})}const Pe=ie("/recurring")({component:Se});export{Pe as Route};
