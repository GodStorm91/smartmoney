import{j as e,c as Se,k as ye,u as Qe,e as ut,n as mt,m as gt}from"./vendor-tanstack-DOuiVnRb.js";import{r as a,a as he}from"./vendor-react-B9eo89kj.js";import{c as E,a as We,I as je,B as F,u as Re,d as xt,e as He,t as ht,g as Ye,h as pt,i as yt,j as ze,k as Fe,l as De,m as _e,C as pe,n as Ue,o as qe,p as Xe,q as ft,r as bt,s as jt,v as Ie,S as vt,w as kt,x as Nt,E as wt,y as Ct,z as St}from"./index-C4UxDUME.js";import{S as ke}from"./Select-Dw2iz9Mk.js";import{B as Ze}from"./Badge-DnjqB4FN.js";import{u as V}from"./vendor-i18n-CtQU9zWU.js";import{u as Rt,a as Dt,c as Tt}from"./recurring-service-BNpQv5m2.js";import{$ as Et,P as Ge,R as $e,a0 as Pt,a1 as Mt,a2 as It,X as ve,F as Te,a3 as Lt,J as et,i as At,C as Ot,_ as zt,h as Ft,a4 as _t,a5 as Ut,j as qt,Q as $t}from"./vendor-icons-Boynwk5e.js";import{R as Kt}from"./RecurringOptions-DQLpLb-c.js";import"./vendor-recharts-BfEtinVu.js";import"./vendor-date-fteVm545.js";function Yt({startDate:t,endDate:o,onRangeChange:s}){const{t:r}=V("common"),i=l=>{const g=new Date,d=g.getFullYear(),m=g.getMonth();switch(l){case"thisMonth":{const f=new Date(d,m,1),p=new Date(d,m+1,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"lastMonth":{const f=new Date(d,m-1,1),p=new Date(d,m,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"last3Months":{const f=new Date(d,m-2,1),p=new Date(d,m+1,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"last6Months":{const f=new Date(d,m-5,1),p=new Date(d,m+1,0);return{start:f.toISOString().split("T")[0],end:p.toISOString().split("T")[0]}}case"thisYear":return{start:`${d}-01-01`,end:`${d}-12-31`};case"allTime":return{start:"2020-01-01",end:new Date().toISOString().split("T")[0]}}},n=[{key:"thisMonth",label:r("dateRange.thisMonth")},{key:"lastMonth",label:r("dateRange.lastMonth")},{key:"last3Months",label:r("dateRange.last3Months")},{key:"last6Months",label:r("dateRange.last6Months")},{key:"thisYear",label:r("dateRange.thisYear")},{key:"allTime",label:r("dateRange.allTime")}],u=l=>{const g=i(l);return t===g.start&&o===g.end};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(({key:l,label:g})=>e.jsx("button",{onClick:()=>{const d=i(l);s(d.start,d.end)},className:E("px-3 py-1.5 text-sm rounded-lg border transition-colors",u(l)?"bg-primary-500 text-white border-primary-500":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-primary-500 hover:text-primary-600 dark:hover:text-primary-400"),children:g},l))}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("input",{type:"date",value:t,onChange:l=>s(l.target.value,o),className:"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"~"}),e.jsx("input",{type:"date",value:o,onChange:l=>s(t,l.target.value),className:"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]})}function Bt({label:t,options:o,selected:s,onChange:r,placeholder:i}){const[n,u]=a.useState(!1),l=a.useRef(null);a.useEffect(()=>{function m(f){l.current&&!l.current.contains(f.target)&&u(!1)}return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const g=m=>{s.includes(m)?r(s.filter(f=>f!==m)):r([...s,m])},d=s.length>0?`${s.length} selected`:i||"Select...";return e.jsxs("div",{ref:l,className:"relative w-full",children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t}),e.jsxs("button",{type:"button",onClick:()=>u(!n),className:E("w-full px-4 py-2 border rounded-lg text-left flex justify-between items-center","bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"),children:[e.jsx("span",{className:s.length===0?"text-gray-500":"",children:d}),e.jsx("svg",{className:E("w-4 h-4 transition-transform",n&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:o.map(m=>e.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.includes(m.value),onChange:()=>g(m.value),className:"mr-3 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:m.label})]},m.value))})]})}async function Jt(t){return(await We.post("/api/receipts/scan",t)).data}async function tt(t){const o=new FormData;return o.append("file",t),(await We.post("/api/receipts/upload",o,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function at(t){return t||null}function rt({selected:t,onSelect:o,isIncome:s=!1}){const{t:r}=V("common"),{data:i,isLoading:n}=Rt(),u=Dt(),[l,g]=a.useState(null),[d,m]=a.useState(!1),[f,p]=a.useState(""),[w,C]=a.useState("ğŸ“");if(n||!i)return e.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const S=s?i.income:i.expense,D=v=>{for(const R of S)if(R.children.some(I=>I.name===v))return R;return null},b=v=>{g(v),m(!1)},j=v=>{l&&o(v.name,l.name)},T=()=>{g(null),m(!1)},N=async()=>{!l||!f.trim()||(await u.mutateAsync({name:f.trim(),icon:w,parent_id:l.id,type:s?"income":"expense"}),o(f.trim(),l.name),p(""),m(!1))};return l?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:T,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(Et,{className:"w-4 h-4"}),l.icon," ",l.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[l.children.map(v=>e.jsxs("button",{type:"button",onClick:()=>j(v),className:E("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",t===v.name?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:v.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:v.name})]},v.id)),e.jsxs("button",{type:"button",onClick:()=>m(!0),className:E("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(Ge,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("category.addCustom","Add")})]})]}),d&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{value:w,onChange:v=>C(v.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(je,{value:f,onChange:v=>p(v.target.value),placeholder:r("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>m(!1),children:r("common.cancel","Cancel")}),e.jsx(F,{size:"sm",onClick:N,disabled:!f.trim()||u.isPending,children:r("common.create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:S.map(v=>{var R;return e.jsxs("button",{type:"button",onClick:()=>b(v),className:E("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((R=D(t))==null?void 0:R.id)===v.id?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:v.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:v.name})]},v.id)})})}function Vt({receiptUrl:t,onClose:o}){const{t:s}=V(),[r,i]=a.useState(1),n=at(t);if(!n)return null;const u=()=>i(d=>Math.min(d+.25,3)),l=()=>i(d=>Math.max(d-.25,.5)),g=()=>{const d=document.createElement("a");d.href=n,d.download=`receipt-${Date.now()}.jpg`,d.click()};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:d=>{d.target===d.currentTarget&&o()},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsxs("h2",{className:"text-white font-medium flex items-center gap-2",children:[e.jsx($e,{size:20}),s("receipt.viewReceipt","View Receipt")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomOut","Zoom out"),children:e.jsx(Pt,{size:20})}),e.jsxs("span",{className:"text-white text-sm w-12 text-center",children:[Math.round(r*100),"%"]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white","aria-label":s("common.zoomIn","Zoom in"),children:e.jsx(Mt,{size:20})}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.download","Download"),children:e.jsx(It,{size:20})}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-white ml-2","aria-label":s("common.close","Close"),children:e.jsx(ve,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center p-4",children:e.jsx("img",{src:n,alt:"Receipt",className:"max-w-full max-h-full object-contain transition-transform duration-200",style:{transform:`scale(${r})`}})})]})}function Qt({isOpen:t,onClose:o,transaction:s}){const{t:r}=V("common"),i=Se(),{data:n=[]}=Re(),[u,l]=a.useState(""),[g,d]=a.useState(""),[m,f]=a.useState(""),[p,w]=a.useState(""),[C,S]=a.useState("JPY"),[D,b]=a.useState(""),[j,T]=a.useState(null),[N,v]=a.useState("expense"),[R,I]=a.useState(!1),[z,K]=a.useState(null),[Y,q]=a.useState(null),[_,te]=a.useState(null),[Q,O]=a.useState(!1),[W,J]=a.useState(!1),H=a.useRef(null),ae=[{value:"JPY",label:"Â¥ JPY"},{value:"USD",label:"$ USD"},{value:"VND",label:"â‚« VND"}],X=y=>{const L=y.replace(/[^\d]/g,"");return L?Number(L).toLocaleString():""},oe=y=>{const L=y.target.value.replace(/[^\d]/g,"");f(L),w(X(L))},G=ye({mutationFn:y=>xt(s.id,y),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),o()}}),U=ye({mutationFn:()=>He(s.id),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),o()}});a.useEffect(()=>{if(s&&t){l(s.date),d(s.description);const y=Math.abs(s.amount).toString();f(y),w(X(y)),S(s.currency||"JPY"),b(s.category),T(s.account_id??null),v(s.type),I(!1),K(s.receipt_url||null),q(null),te(null)}},[s==null?void 0:s.id,t]);const B=y=>{var Z;const L=(Z=y.target.files)==null?void 0:Z[0];!L||!L.type.startsWith("image/")||(q(L),te(URL.createObjectURL(L)))},$=()=>{q(null),_&&(URL.revokeObjectURL(_),te(null)),K(null),H.current&&(H.current.value="")};a.useEffect(()=>{if(j){const y=n.find(L=>L.id===j);y!=null&&y.currency&&S(y.currency)}},[j,n]);const de=async y=>{y.preventDefault();const L=parseFloat(m);if(isNaN(L))return;const Z=n.find(x=>x.id===j),fe=(Z==null?void 0:Z.name)||(s==null?void 0:s.source)||"";let ue=z;if(Y){J(!0);try{ue=await tt(Y)}finally{J(!1)}}G.mutate({date:u,description:g,amount:Math.round(N==="expense"?-Math.abs(L):Math.abs(L)),currency:C,category:D||"Other",source:fe,type:N,account_id:j,receipt_url:ue})},ce=()=>{U.mutate()};if(a.useEffect(()=>(t&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[t]),!t||!s)return null;const re=e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:o}),e.jsx("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md max-h-[90dvh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:r("transaction.editTitle")}),R?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:r("transaction.deleteConfirm")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.description}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(F,{variant:"outline",onClick:()=>I(!1),className:"flex-1",children:r("button.cancel")}),e.jsx(F,{variant:"secondary",onClick:ce,disabled:U.isPending,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:U.isPending?"...":r("button.delete")})]})]}):e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsx(je,{label:r("transaction.date"),type:"date",value:u,onChange:y=>l(y.target.value),required:!0}),e.jsx(je,{label:r("transaction.description"),value:g,onChange:y=>d(y.target.value),required:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(je,{label:r("transaction.amount"),type:"text",inputMode:"numeric",value:p,onChange:oe,required:!0})}),e.jsx("div",{className:"w-28",children:e.jsx(ke,{label:r("transaction.currency","Currency"),value:C,onChange:y=>S(y.target.value),options:ae})})]}),e.jsx(ke,{label:r("transaction.type"),value:N,onChange:y=>v(y.target.value),options:[{value:"income",label:r("transaction.typeIncome")},{value:"expense",label:r("transaction.typeExpense")}]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("transaction.category")}),e.jsx(rt,{selected:D,onSelect:y=>b(y),isIncome:N==="income"})]}),e.jsx(ke,{label:r("account.account"),value:(j==null?void 0:j.toString())||"",onChange:y=>T(y.target.value?Number(y.target.value):null),options:[{value:"",label:r("account.selectAccount")},...n.map(y=>({value:y.id.toString(),label:y.name}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("receipt.receipt","Receipt")}),e.jsx("input",{ref:H,type:"file",accept:"image/*",capture:"environment",onChange:B,className:"hidden"}),_||z?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:_||at(z)||"",alt:"Receipt",className:"w-full h-20 object-cover cursor-pointer",onClick:()=>!_&&O(!0)}),e.jsx("button",{type:"button",onClick:$,className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(ve,{size:14})})]}):e.jsxs("button",{type:"button",onClick:()=>{var y;return(y=H.current)==null?void 0:y.click()},className:"w-full h-10 flex items-center justify-center gap-2 border border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 text-gray-500 dark:text-gray-400 rounded-lg text-sm",children:[e.jsx(Te,{size:16}),r("receipt.attachReceipt","Attach Receipt")]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:o,className:"flex-1",children:r("button.cancel")}),e.jsx(F,{type:"submit",disabled:G.isPending||W,className:"flex-1",children:W?r("receipt.uploading","Uploading..."):G.isPending?"...":r("button.save")})]}),e.jsx("button",{type:"button",onClick:()=>I(!0),className:E("w-full text-center text-sm text-red-600 hover:text-red-700","py-2 transition-colors"),children:r("transaction.deleteTransaction")})]})]})}),Q&&z&&e.jsx(Vt,{receiptUrl:z,onClose:()=>O(!1)})]});return typeof document<"u"?he.createPortal(re,document.body):null}function Wt(t,o){const s=Se(),{entityType:r,operationType:i,getEntityId:n=()=>0,invalidateKeys:u=[],onSuccess:l,onError:g}=o;return ye({mutationFn:async d=>{if(!navigator.onLine){const m=n(d);return await Ye(i,r,m,d),null}try{const m=await t(d);for(const f of u)s.invalidateQueries({queryKey:f});return m}catch(m){if(m instanceof TypeError&&m.message.includes("fetch")){const f=n(d);return await Ye(i,r,f,d),null}throw m}},onSuccess:d=>{navigator.onLine&&ht(),l==null||l(d)},onError:d=>{g==null||g(d)}})}function Ke(t,o,s){return Wt(t,{entityType:o,operationType:"CREATE",invalidateKeys:s})}function Ht({value:t,onChange:o,onSuggestionSelect:s,placeholder:r,className:i,error:n}){const{t:u}=V("common"),[l,g]=a.useState(!1),[d,m]=a.useState(""),f=a.useRef(null),p=a.useRef(null);a.useEffect(()=>{const b=setTimeout(()=>{m(t)},300);return()=>clearTimeout(b)},[t]);const{data:w=[]}=Qe({queryKey:["transaction-suggestions",d],queryFn:()=>pt(d),enabled:d.length>=2,staleTime:3e4});a.useEffect(()=>{g(w.length>0&&t.length>=2)},[w,t]),a.useEffect(()=>{const b=j=>{p.current&&!p.current.contains(j.target)&&g(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const C=a.useCallback(b=>{var j;b.key==="Escape"&&(g(!1),(j=f.current)==null||j.blur())},[]),S=b=>{o(b.description),g(!1),s==null||s(b)},D=b=>Math.abs(b).toLocaleString();return e.jsxs("div",{ref:p,className:"relative",children:[e.jsx("input",{ref:f,type:"text",value:t,onChange:b=>o(b.target.value),onKeyDown:C,onFocus:()=>w.length>0&&g(!0),placeholder:r,className:E("w-full h-12 px-4 border rounded-lg text-base","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400",n?"border-red-500":"border-gray-300",i)}),l&&w.length>0&&e.jsx("div",{className:E("absolute top-full left-0 right-0 z-50 mt-1","bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700","max-h-60 overflow-y-auto"),children:w.map((b,j)=>e.jsxs("button",{type:"button",onClick:()=>S(b),className:E("w-full px-4 py-3 flex items-center justify-between text-left","hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors","border-b border-gray-100 dark:border-gray-700 last:border-0"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:b.description}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:b.category}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"â€¢"}),e.jsxs("span",{className:"text-gray-400",children:[b.count,"x ",u("autocomplete.used","used")]})]})]}),e.jsx("div",{className:"ml-4 text-right shrink-0",children:e.jsxs("div",{className:E("font-medium font-numbers",b.is_income?"text-green-600":"text-gray-900 dark:text-gray-100"),children:["Â¥",D(b.amount)]})})]},`${b.description}-${j}`))})]})}function Xt({onCapture:t,onCancel:o}){const{t:s}=V(),r=a.useRef(null),i=a.useRef(null),[n,u]=a.useState(null),[l,g]=a.useState(null),[d,m]=a.useState(null),[f,p]=a.useState(!0),w=a.useCallback(async()=>{p(!0),m(null);try{const j=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});r.current&&(r.current.srcObject=j,u(j))}catch(j){console.error("Camera error:",j),m(s("receipt.cameraError","Could not access camera"))}finally{p(!1)}},[s]),C=a.useCallback(()=>{n&&(n.getTracks().forEach(j=>j.stop()),u(null))},[n]),S=a.useCallback(()=>{if(!r.current||!i.current)return;const j=r.current,T=i.current,N=T.getContext("2d");if(!N)return;T.width=j.videoWidth,T.height=j.videoHeight,N.drawImage(j,0,0);const v=T.toDataURL("image/jpeg",.8);g(v),C()},[C]),D=a.useCallback(()=>{g(null),w()},[w]),b=a.useCallback(()=>{l&&t(l)},[l,t]);return a.useEffect(()=>(w(),()=>{n&&n.getTracks().forEach(j=>j.stop())}),[]),d?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Te,{size:48,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-red-400 mb-6",children:d}),e.jsx("button",{onClick:o,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:s("common.close","Close")})]}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/50 absolute top-0 left-0 right-0 z-10",children:[e.jsx("button",{onClick:o,className:"text-white p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":s("common.close","Close"),children:e.jsx(ve,{size:24})}),e.jsx("span",{className:"text-white font-medium",children:s("receipt.scanReceipt","Scan Receipt")}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-black",children:[f&&!l&&e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"}),e.jsx("p",{className:"text-white",children:s("receipt.startingCamera","Starting camera...")})]}),l?e.jsx("img",{src:l,alt:"Captured receipt",className:"max-w-full max-h-full object-contain"}):e.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",onLoadedMetadata:()=>p(!1)}),e.jsx("canvas",{ref:i,className:"hidden"})]}),e.jsx("div",{className:"p-6 bg-black/50 flex justify-center gap-8 absolute bottom-0 left-0 right-0 safe-area-bottom",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:D,className:"flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[e.jsx(Lt,{size:20}),s("receipt.retake","Retake")]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(et,{size:20}),s("receipt.usePhoto","Use Photo")]})]}):e.jsx("button",{onClick:S,disabled:f,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center disabled:opacity-50 transition-opacity","aria-label":s("receipt.takePhoto","Take Photo"),children:e.jsx("div",{className:"w-14 h-14 rounded-full border-4 border-black"})})})]})}async function Zt(t,o=1024,s=1024,r=.8){return new Promise((i,n)=>{const u=new Image,l=document.createElement("canvas"),g=l.getContext("2d");if(!g){n(new Error("Failed to get canvas context"));return}u.onload=()=>{let{width:d,height:m}=u;if(d>o||m>s){const p=Math.min(o/d,s/m);d=Math.round(d*p),m=Math.round(m*p)}l.width=d,l.height=m,g.drawImage(u,0,0,d,m);const f=l.toDataURL("image/jpeg",r);URL.revokeObjectURL(u.src),i(f)},u.onerror=()=>{URL.revokeObjectURL(u.src),n(new Error("Failed to load image"))},u.src=URL.createObjectURL(t)})}function Gt({onImageSelect:t,className:o}){const{t:s}=V(),[r,i]=a.useState(!1),[n,u]=a.useState(!1),l=a.useCallback(async p=>{if(!p.type.startsWith("image/")){alert(s("receipt.invalidFile","Please select an image file"));return}u(!0);try{const w=await Zt(p);t(w)}catch{alert(s("receipt.processError","Failed to process image"))}finally{u(!1)}},[t,s]),g=a.useCallback(p=>{p.preventDefault(),i(!1);const w=p.dataTransfer.files[0];w&&l(w)},[l]),d=a.useCallback(p=>{p.preventDefault(),i(!0)},[]),m=a.useCallback(()=>{i(!1)},[]),f=a.useCallback(p=>{var C;const w=(C=p.target.files)==null?void 0:C[0];w&&l(w)},[l]);return e.jsxs("div",{onDrop:g,onDragOver:d,onDragLeave:m,className:E("border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",r?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500",n&&"opacity-50 pointer-events-none",o),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:f,className:"hidden",id:"receipt-file-input"}),e.jsx("label",{htmlFor:"receipt-file-input",className:"cursor-pointer",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("receipt.processing","Processing...")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(At,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:s("receipt.dropOrClick","Drop image here or click to upload")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s("receipt.supportedFormats","JPG, PNG, HEIC supported")})]})]})})})]})}function st({isOpen:t,onClose:o,onScanComplete:s}){const{t:r}=V(),[i,n]=a.useState("select"),[u,l]=a.useState(null),g=ye({mutationFn:Jt,onSuccess:C=>{s(C.data),d()}}),d=a.useCallback(()=>{n("select"),l(null),g.reset(),o()},[o,g]),m=a.useCallback(C=>{l(C),n("preview")},[]),f=a.useCallback(()=>{u&&g.mutate({image:u})},[u,g]),p=a.useCallback(()=>{l(null),n("select")},[]);if(!t)return null;if(i==="camera"){const C=e.jsx(Xt,{onCapture:m,onCancel:()=>n("select")});return typeof document>"u"?null:he.createPortal(C,document.body)}const w=e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",onClick:C=>{C.target===C.currentTarget&&d()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:r("receipt.scanReceipt","Scan Receipt")}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":r("common.close","Close"),children:e.jsx(ve,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-4",children:[i==="select"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>n("camera"),className:"w-full h-14 flex items-center justify-center gap-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(Te,{size:24}),r("receipt.takePhoto","Take Photo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("common.or","or")}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx(Gt,{onImageSelect:m})]}),i==="preview"&&u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:e.jsx("img",{src:u,alt:"Receipt preview",className:"w-full max-h-64 object-contain"})}),g.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("receipt.analyzing","Analyzing receipt with AI...")})]}),g.isError&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:[e.jsx(Ot,{size:20}),e.jsx("span",{children:r("receipt.scanError","Failed to scan receipt. Please try again.")})]}),!g.isPending&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,className:"flex-1 h-12 flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:r("receipt.retake","Retake")}),e.jsxs("button",{onClick:f,disabled:g.isPending,className:"flex-1 h-12 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(et,{size:20}),r("receipt.scan","Scan")]})]})]})]})]})});return typeof document>"u"?null:he.createPortal(w,document.body)}const Be={JPY:"Â¥",USD:"$",VND:"â‚«"};function Le(t){const o=t.replace(/[^\d]/g,"");return o?parseInt(o).toLocaleString():""}function ea(t){return t.replace(/[^\d]/g,"")}function ta({isOpen:t,onClose:o}){const{t:s}=V("common"),{data:r}=Re(),i=Se(),n=yt(),[u,l]=a.useState(!1),[g,d]=a.useState(new Date().toISOString().split("T")[0]),[m,f]=a.useState(""),[p,w]=a.useState(""),[C,S]=a.useState(""),[D,b]=a.useState(""),[j,T]=a.useState(null),[N,v]=a.useState({}),[R,I]=a.useState(!1),[z,K]=a.useState(null),[Y,q]=a.useState(null),[_,te]=a.useState(!1),Q=a.useRef(null),[O,W]=a.useState(!1),[J,H]=a.useState("monthly"),[ae,X]=a.useState(0),[oe,G]=a.useState(25),[U,B]=a.useState(7),$=a.useMemo(()=>(r==null?void 0:r.find(h=>h.id===j))||null,[r,j]),de=$!=null&&$.currency?Be[$.currency]||$.currency:"Â¥";a.useEffect(()=>{var h;t&&(l(!1),d(new Date().toISOString().split("T")[0]),f(""),w(""),S(""),b(""),T(((h=r==null?void 0:r[0])==null?void 0:h.id)||null),v({}),K(null),q(null),W(!1),H("monthly"),X(0),G(25),B(7))},[t,r]),a.useEffect(()=>{b("")},[u]);const ce=Ke(Fe,"transaction",[["transactions"],["analytics"]]),re=ye({mutationFn:Tt,onSuccess:()=>{i.invalidateQueries({queryKey:["recurring-transactions"]})}}),y=h=>{const P=ea(h.target.value);f(P),w(Le(P))},L=h=>{const P=h.amount.toString();f(P),w(Le(P)),l(h.is_income),h.category&&b(h.category)},Z=h=>{if(h.amount!==null){const P=Math.abs(h.amount).toString();f(P),w(Le(P)),l(!1)}h.date&&d(h.date),h.merchant&&S(h.merchant),h.category&&b(h.category),I(!1)},fe=h=>{var le;const P=(le=h.target.files)==null?void 0:le[0];if(!P||!P.type.startsWith("image/"))return;K(P);const ge=URL.createObjectURL(P);q(ge)},ue=()=>{K(null),Y&&(URL.revokeObjectURL(Y),q(null)),Q.current&&(Q.current.value="")},x=()=>{const h={};return(!m||parseInt(m)<=0)&&(h.amount=s("transaction.errors.amountRequired","Amount is required")),C.trim()||(h.description=s("transaction.errors.descriptionRequired","Description is required")),D||(h.category=s("transaction.errors.categoryRequired","Category is required")),j||(h.source=s("transaction.errors.sourceRequired","Account is required")),v(h),Object.keys(h).length===0},A=async h=>{if(h.preventDefault(),!x())return;const P=D||"Other",ge=($==null?void 0:$.currency)||"JPY",le=ze(parseInt(m),ge);try{let ie;if(z){te(!0);try{ie=await tt(z)}finally{te(!1)}}await ce.mutateAsync({date:g,description:C.trim(),amount:u?le:-le,currency:ge,category:P,source:($==null?void 0:$.name)||"",type:u?"income":"expense",account_id:j,receipt_url:ie}),O&&await re.mutateAsync({description:C.trim(),amount:le,category:P,account_id:j,is_income:u,frequency:J,day_of_week:J==="weekly"?ae:null,day_of_month:J==="monthly"?oe:null,interval_days:J==="custom"?U:null,start_date:g}),o(),n.success(s("transaction.saved","Transaction saved!"))}catch{}},me=h=>{h.target===h.currentTarget&&o()};if(!t)return null;const se=e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/50 animate-modal-backdrop",onClick:me,children:[e.jsxs("div",{className:E("fixed inset-x-0 bottom-0 z-50","bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl","max-h-[90vh] overflow-y-auto","animate-modal-in"),children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 dark:text-gray-100",children:s("transaction.addTransaction","Add Transaction")})}),e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[e.jsxs("button",{type:"button",onClick:()=>I(!0),className:"w-full h-12 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium transition-all shadow-md hover:shadow-lg",children:[e.jsx($e,{size:20}),s("receipt.scanReceipt","Scan Receipt")]}),e.jsx("input",{ref:Q,type:"file",accept:"image/*",capture:"environment",onChange:fe,className:"hidden"}),Y?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:Y,alt:"Receipt preview",className:"w-full h-24 object-cover"}),e.jsx("button",{type:"button",onClick:ue,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(ve,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var h;return(h=Q.current)==null?void 0:h.click()},className:"w-full h-12 flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 text-gray-500 dark:text-gray-400 rounded-lg font-medium transition-colors",children:[e.jsx(Te,{size:20}),s("receipt.attachReceipt","Attach Receipt Photo")]})]}),e.jsxs("form",{onSubmit:A,className:"px-4 pb-8 space-y-4",children:[e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>l(!1),className:E("flex-1 py-3 rounded-md text-sm font-medium transition-colors",u?"text-gray-600 dark:text-gray-300":"bg-red-500 text-white"),children:s("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>l(!0),className:E("flex-1 py-3 rounded-md text-sm font-medium transition-colors",u?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:s("transaction.income","Income")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.date","Date")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:g,onChange:h=>d(h.target.value),className:"flex-1 h-12 px-4 border border-gray-300 rounded-lg text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"}),e.jsx("button",{type:"button",onClick:()=>d(new Date().toISOString().split("T")[0]),className:"px-4 h-12 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:s("common.today","Today")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.amount","Amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-lg font-medium text-gray-500 dark:text-gray-400",children:de}),e.jsx("input",{type:"text",inputMode:"numeric",value:p,onChange:y,placeholder:"0",className:E("w-full h-12 pl-10 pr-4 border rounded-lg text-base text-right font-numbers","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",N.amount?"border-red-500":"border-gray-300")})]}),N.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.description","Description")}),e.jsx(Ht,{value:C,onChange:S,onSuggestionSelect:L,placeholder:s("transaction.descriptionPlaceholder","What was this for?"),error:!!N.description}),N.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:s("transaction.category","Category")}),e.jsx(rt,{selected:D,onSelect:h=>b(h),isIncome:u}),N.category&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("transaction.source","Account")}),e.jsxs("select",{value:j||"",onChange:h=>T(h.target.value?parseInt(h.target.value):null),className:E("w-full h-12 px-4 border rounded-lg text-base","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",N.source?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:s("transaction.selectAccount","Select account")}),r==null?void 0:r.map(h=>e.jsxs("option",{value:h.id,children:[h.name," (",Be[h.currency]||h.currency,")"]},h.id))]}),N.source&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.source})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:h=>W(h.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx(zt,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:s("recurring.makeRecurring")})]}),O&&e.jsx(Kt,{frequency:J,setFrequency:H,dayOfWeek:ae,setDayOfWeek:X,dayOfMonth:oe,setDayOfMonth:G,intervalDays:U,setIntervalDays:B})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:o,className:"flex-1 h-12",children:s("common.cancel","Cancel")}),e.jsx(F,{type:"submit",loading:ce.isPending||re.isPending||_,className:E("flex-1 h-12",O?"bg-blue-500 hover:bg-blue-600":u?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:s("common.save","Save")})]}),(ce.isError||re.isError)&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:s("transaction.errors.createFailed","Failed to create transaction")})]})]}),e.jsx(st,{isOpen:R,onClose:()=>I(!1),onScanComplete:Z})]});return typeof document<"u"?he.createPortal(se,document.body):null}function aa(t={}){const{language:o="ja-JP",onResult:s,onError:r}=t,[i,n]=a.useState("idle"),[u,l]=a.useState(""),[g,d]=a.useState(null),[m,f]=a.useState(!1),p=a.useRef(null),w=a.useRef("idle"),C=a.useRef(s),S=a.useRef(r),D=a.useRef(!1),b=a.useRef(!1);a.useEffect(()=>{w.current=i},[i]),a.useEffect(()=>{C.current=s,S.current=r},[s,r]),a.useEffect(()=>{const v=window.SpeechRecognition||window.webkitSpeechRecognition;f(!!v)},[]),a.useEffect(()=>{const v=window.SpeechRecognition||window.webkitSpeechRecognition;if(!v)return;const R=new v;return R.continuous=!0,R.interimResults=!0,R.lang=o,R.onstart=()=>{D.current=!1,d(null)},R.onresult=I=>{const z=I.results,Y=z[z.length-1][0].transcript;l(Y)},R.onerror=I=>{var K;if(D.current=!1,I.error==="aborted")return;const z=I.error==="no-speech"?"No speech detected":I.error==="audio-capture"?"Microphone not found":I.error==="not-allowed"?"Microphone access denied":`Error: ${I.error}`;d(z),n("error"),(K=S.current)==null||K.call(S,z)},R.onend=()=>{D.current=!1,!b.current&&w.current==="listening"&&n("idle")},p.current=R,()=>{R.abort()}},[o]);const j=a.useCallback(()=>{if(p.current&&!(D.current||w.current==="listening")){D.current=!0,b.current=!0,l(""),d(null),n("listening");try{p.current.start()}catch(v){console.warn("Speech recognition start error:",v),D.current=!1}}},[]),T=a.useCallback(()=>{var v;if(b.current=!1,!!p.current&&w.current==="listening"){try{p.current.stop()}catch(R){console.warn("Speech recognition stop error:",R)}u?(n("processing"),(v=C.current)==null||v.call(C,u)):n("idle")}},[u]),N=a.useCallback(()=>{l(""),d(null),n("idle")},[]);return{status:i,transcript:u,isSupported:m,startListening:j,stopListening:T,resetTranscript:N,error:g}}const ra={food:["ã”é£¯","ã”ã¯ã‚“","ãƒ©ãƒ³ãƒ","ãƒ‡ã‚£ãƒŠãƒ¼","æ˜¼é£Ÿ","å¤•é£Ÿ","æœé£Ÿ","å¼å½“","ã‚³ãƒ¼ãƒ’ãƒ¼","ã‚«ãƒ•ã‚§","ã‚¹ã‚¿ãƒ","ãƒãƒƒã‚¯","ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰","ã™ãå®¶","å‰é‡å®¶","ãƒ©ãƒ¼ãƒ¡ãƒ³","å¯¿å¸","ã™ã—","ã†ã©ã‚“","ãã°","ã‚«ãƒ¬ãƒ¼","ãƒ‘ãƒ³","ã‚±ãƒ¼ã‚­","ã‚»ãƒ–ãƒ³","ãƒ•ã‚¡ãƒŸãƒ","ãƒ­ãƒ¼ã‚½ãƒ³","ã‚³ãƒ³ãƒ“ãƒ‹","ã‚¹ãƒ¼ãƒ‘ãƒ¼","coffee","cafe","lunch","dinner","breakfast","food","restaurant","starbucks","mcdonalds","ramen","sushi","curry","bread","cake","konbini","supermarket","gohan","ko-hi-","kohi"],transport:["é›»è»Š","ã§ã‚“ã—ã‚ƒ","ãƒã‚¹","ã‚¿ã‚¯ã‚·ãƒ¼","åœ°ä¸‹é‰„","JR","æ–°å¹¹ç·š","ã‚¬ã‚½ãƒªãƒ³","é§è»Šå ´","Suica","PASMO","ãƒ‘ã‚¹ãƒ¢","ã‚¹ã‚¤ã‚«","train","bus","taxi","subway","gas","parking","uber","lyft"],shopping:["è²·ã„ç‰©","ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°","æœ","ãµã","é´","ãã¤","ã‚¢ãƒã‚¾ãƒ³","æ¥½å¤©","é›‘è²¨","ãƒ¦ãƒ‹ã‚¯ãƒ­","GU","ç„¡å°","shopping","clothes","shoes","amazon","uniqlo","muji"],entertainment:["æ˜ ç”»","ãˆã„ãŒ","ã‚²ãƒ¼ãƒ ","ã‚«ãƒ©ã‚ªã‚±","ãƒœã‚¦ãƒªãƒ³ã‚°","æœ¬","ã»ã‚“","Netflix","ãƒãƒƒãƒˆãƒ•ãƒªãƒƒã‚¯ã‚¹","Spotify","ã‚¹ãƒãƒ†ã‚£ãƒ•ã‚¡ã‚¤","movie","game","karaoke","bowling","book","netflix","spotify"],utilities:["é›»æ°—","ã§ã‚“ã","ã‚¬ã‚¹","æ°´é“","ã™ã„ã©ã†","ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ","Wi-Fi","electric","electricity","water","internet","wifi"],communication:["æºå¸¯","ã‘ã„ãŸã„","ã‚¹ãƒãƒ›","é›»è©±","ã§ã‚“ã‚","phone","mobile","cell"],health:["ç—…é™¢","ã³ã‚‡ã†ã„ã‚“","è–¬","ãã™ã‚Š","åŒ»è€…","ã„ã—ã‚ƒ","æ­¯åŒ»è€…","ã‚¸ãƒ ","ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹","hospital","medicine","doctor","dentist","gym","fitness"],housing:["å®¶è³ƒ","ã‚„ã¡ã‚“","å…‰ç†±è²»","rent","mortgage"]};function sa(t){const o=t.toLowerCase();for(const[s,r]of Object.entries(ra))for(const i of r)if(o.includes(i.toLowerCase()))return s}function na(t){if(!t||t.trim().length===0)return null;const o=t.trim(),s=o.match(/[\d,]+/);if(!s)return null;const r=s[0].replace(/,/g,""),i=parseInt(r,10);if(isNaN(i)||i<=0)return null;let n="JPY";const u=o.toLowerCase();/dollar|dollars|usd|\$|ãƒ‰ãƒ«/.test(u)?n="USD":/dong|vnd|Ä‘á»“ng|ãƒ‰ãƒ³/.test(u)?n="VND":/yen|å††|Â¥|ãˆã‚“/.test(u)&&(n="JPY");let l=o.replace(/[\d,]+/,"").replace(/yen|å††|Â¥|dollar|dollars|usd|\$|dong|vnd|Ä‘á»“ng|ãƒ‰ãƒ«|ãƒ‰ãƒ³|ãˆã‚“/gi,"").trim();l||(l="Voice entry");const g=sa(o);return{amount:i,currency:n,description:l,suggestedCategoryId:g}}const Ae=[{id:"food",labelKey:"category.food",icon:"ğŸ½ï¸",value:"Food"},{id:"housing",labelKey:"category.housing",icon:"ğŸ ",value:"Housing"},{id:"transport",labelKey:"category.transport",icon:"ğŸš—",value:"Transportation"},{id:"utilities",labelKey:"category.utilities",icon:"ğŸ’¡",value:"Utilities"},{id:"communication",labelKey:"category.communication",icon:"ğŸ“±",value:"Communication"},{id:"entertainment",labelKey:"category.entertainment",icon:"ğŸ¬",value:"Entertainment"},{id:"shopping",labelKey:"category.shopping",icon:"ğŸ›ï¸",value:"Shopping"},{id:"health",labelKey:"category.health",icon:"ğŸ¥",value:"Health"},{id:"proxy_purchase",labelKey:"category.proxy_purchase",icon:"ğŸ›’",value:"Proxy Purchase"},{id:"other",labelKey:"category.other",icon:"ğŸ“¦",value:"Other"}],Ce={JPY:"Â¥",USD:"$",VND:"â‚«"},Oe=["JPY","USD","VND"],oa=["1","2","3","4","5","6","7","8","9","00","0","DEL"];function ca(){var ue;const{t}=V("common"),{data:o}=Re(),s=De(),[r,i]=a.useState("closed"),[n,u]=a.useState(""),[l,g]=a.useState(""),[d,m]=a.useState(null),[f,p]=a.useState("JPY"),[w,C]=a.useState(""),[S,D]=a.useState(""),b=a.useRef(null),j=a.useRef(!1),[T,N]=a.useState(!1),[v,R]=a.useState(0),{status:I,transcript:z,isSupported:K,startListening:Y,stopListening:q}=aa({language:"ja-JP",onResult:x=>{const A=na(x);A&&(u(A.amount.toString()),p(A.currency),C(A.description),A.suggestedCategoryId?(g(A.suggestedCategoryId),(o==null?void 0:o.length)===1?setTimeout(()=>{oe(A.suggestedCategoryId)},100):i("account")):i("category"))}}),_=o==null?void 0:o.find(x=>x.id===d),te=a.useMemo(()=>{if(!o)return[];if(!S.trim())return o;const x=S.toLowerCase();return o.filter(A=>A.name.toLowerCase().includes(x))},[o,S]);a.useEffect(()=>{if(o!=null&&o.length&&!d){m(o[0].id);const x=o[0].currency;Oe.includes(x)&&p(x)}},[o,d]),a.useEffect(()=>{if(_){const x=_.currency;Oe.includes(x)&&p(x)}},[_]);const Q=Ce[f]||f,O=a.useMemo(()=>{if(!n||!_)return null;const x=_.currency;if(f===x)return null;const A=parseInt(n);if(isNaN(A))return null;const me=s[f]||1,se=s[x]||1,h=A/me,P=Math.round(h*se);return{value:P,formatted:P.toLocaleString(),currency:x,symbol:Ce[x]||x}},[n,f,_,s]),W=Ke(Fe,"transaction",[["transactions"],["analytics"]]),J=n?parseInt(n).toLocaleString():"0",H=x=>{x==="DEL"?u(A=>A.slice(0,-1)):n.length<10&&u(A=>A+x)},ae=x=>{g(x),(o==null?void 0:o.length)===1?oe(x):i("account")},X=x=>{m(x),oe(l,x)},oe=async(x,A)=>{const me=x||l,se=A||d,h=Ae.find(xe=>xe.id===me),P=o==null?void 0:o.find(xe=>xe.id===se);if(!n||!h||!P)return;const ge=P.currency||"JPY",le=(O==null?void 0:O.value)??parseInt(n),ie=ze(le,ge);try{await W.mutateAsync({date:new Date().toISOString().split("T")[0],description:w||h.value,amount:-ie,currency:ge,category:h.value,source:P.name,type:"expense"}),G()}catch{}},G=()=>{i("closed"),u(""),g(""),C(""),D("")},U=()=>{i("amount"),u(""),g(""),D("")},B=()=>{G()},$=()=>{r==="amount"&&n&&i("category")},de=()=>{r==="category"?i("amount"):r==="account"&&i("category")},ce=600,re=()=>{j.current=!1,R(0);const x=Date.now();b.current=setTimeout(()=>{j.current=!0,N(!0),R(100)},ce);const A=setInterval(()=>{const me=Date.now()-x,se=Math.min(me/ce*100,100);R(se),se>=100&&clearInterval(A)},16)},y=()=>{b.current&&(clearTimeout(b.current),b.current=null),R(0),j.current||U()},L=()=>{b.current&&(clearTimeout(b.current),b.current=null),R(0),j.current=!1},Z=x=>{N(!1),j.current=!1,x==="transaction"?window.dispatchEvent(new CustomEvent("open-add-transaction-modal")):x==="receipt"&&window.dispatchEvent(new CustomEvent("open-receipt-scanner"))},fe=1+v/100*.15;return r==="closed"?he.createPortal(e.jsxs(e.Fragment,{children:[T&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>N(!1)}),T&&e.jsxs("div",{className:"fixed bottom-32 right-4 z-50 flex flex-col-reverse gap-2 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("button",{onClick:()=>Z("receipt"),className:"flex items-center gap-3 pl-4 pr-5 py-3 rounded-full bg-purple-500 hover:bg-purple-600 text-white shadow-lg",children:[e.jsx($e,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:t("receipt.scanReceipt","Scan Receipt")})]}),e.jsxs("button",{onClick:()=>Z("transaction"),className:"flex items-center gap-3 pl-4 pr-5 py-3 rounded-full bg-green-500 hover:bg-green-600 text-white shadow-lg",children:[e.jsx(Ft,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:t("transaction.addTransaction","Add Transaction")})]})]}),e.jsx("button",{onPointerDown:re,onPointerUp:y,onPointerLeave:L,onPointerCancel:L,className:E("fixed bottom-24 right-4 sm:bottom-6 sm:right-6 z-50","w-14 h-14 rounded-full","bg-gradient-to-r from-blue-500 to-purple-500","text-white shadow-lg","flex items-center justify-center","transition-transform duration-75",T&&"rotate-45"),style:{transform:`scale(${fe})`},"aria-label":t("quickEntry.add","Quick Add"),children:e.jsx(Ge,{size:28})})]}),document.body):he.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:B,children:e.jsxs("div",{className:E("fixed inset-x-0 bottom-0 z-50","bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl","transform transition-transform duration-300","max-h-[85vh] overflow-hidden"),onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:r==="amount"?B:de,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ve,{size:20,className:"text-gray-500"})}),e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[r==="amount"&&t("quickEntry.enterAmount","Enter Amount"),r==="category"&&t("quickEntry.selectCategory","Select Category"),r==="account"&&t("quickEntry.selectAccount","Select Account")]}),e.jsx("div",{className:"w-9"})," "]}),r==="amount"&&e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:Oe.map(x=>e.jsxs("button",{onClick:()=>p(x),className:E("px-4 py-2 rounded-full text-sm font-medium transition-all",f===x?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[Ce[x]," ",x]},x))}),e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("div",{className:"text-4xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[Q,J]}),O&&e.jsxs("div",{className:"text-lg text-blue-500 dark:text-blue-400 mt-2 font-numbers",children:["â‰ˆ ",O.symbol,O.formatted]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:t("quickEntry.expense","Expense")})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-w-xs mx-auto",children:oa.map(x=>e.jsx("button",{onClick:()=>H(x),className:E("h-14 rounded-xl text-xl font-medium transition-colors",x==="DEL"?"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-600"),children:x==="DEL"?e.jsx(_t,{size:20,className:"mx-auto"}):x},x))}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[K&&e.jsx("button",{onMouseDown:Y,onMouseUp:q,onMouseLeave:I==="listening"?q:void 0,onTouchStart:Y,onTouchEnd:q,onTouchCancel:q,className:E("h-14 w-14 rounded-xl flex items-center justify-center transition-all select-none touch-none",I==="listening"?"bg-red-500 text-white animate-pulse scale-110":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),title:t("voiceInput.holdToTalk","Hold to talk"),children:e.jsx(Ut,{size:24})}),e.jsx("button",{onClick:$,disabled:!n,className:E("flex-1 h-14 rounded-xl font-medium text-white transition-all",n?"bg-blue-500 hover:bg-blue-600":"bg-gray-300 dark:bg-gray-600 cursor-not-allowed"),children:t("common.next","Next")})]}),I==="listening"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/30 rounded-lg border-2 border-red-300 dark:border-red-700",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center font-medium",children:z||t("voiceInput.listening","Listening...")})})]}),r==="category"&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-center py-2 mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[Q,J]}),O&&e.jsxs("span",{className:"text-lg text-blue-500 dark:text-blue-400 ml-2 font-numbers",children:["â†’ ",O.symbol,O.formatted]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Ae.map(x=>e.jsxs("button",{onClick:()=>ae(x.id),className:E("flex flex-col items-center p-4 rounded-xl transition-all","bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600","active:scale-95"),children:[e.jsx("span",{className:"text-2xl mb-1",children:x.icon}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-300 text-center",children:t(x.labelKey,x.value)})]},x.id))})]}),r==="account"&&e.jsxs("div",{className:"p-4 overflow-x-hidden",children:[e.jsxs("div",{className:"text-center py-2 mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 font-numbers",children:[Q,J]}),O&&e.jsxs("span",{className:"text-lg text-blue-500 dark:text-blue-400 ml-2 font-numbers",children:["â†’ ",O.symbol,O.formatted]}),e.jsx("span",{className:"ml-2 text-gray-500",children:(ue=Ae.find(x=>x.id===l))==null?void 0:ue.icon})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:S,onChange:x=>D(x.target.value),placeholder:t("account.searchPlaceholder","Search accounts..."),className:E("w-full h-10 pl-9 pr-4 rounded-lg text-sm","bg-gray-100 dark:bg-gray-700 border-0","text-gray-900 dark:text-gray-100","placeholder:text-gray-400 dark:placeholder:text-gray-500","focus:outline-none focus:ring-2 focus:ring-blue-500"),autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto overflow-x-hidden",children:[te.map(x=>e.jsxs("button",{onClick:()=>X(x.id),className:E("w-full flex items-center justify-between p-4 rounded-xl transition-all","bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600","active:scale-[0.98]"),children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:x.name}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:Ce[x.currency]||x.currency})]},x.id)),te.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:t("account.noResults","No accounts found")})]}),W.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),e.jsx("span",{children:t("common.saving","Saving...")})]})]})]})}),document.body)}function Je({transaction:t,onEdit:o,onDelete:s}){const{isPrivacyMode:r}=_e(),i=De(),[n,u]=a.useState(0),[l,g]=a.useState(!1),[d,m]=a.useState(0),f=a.useRef(null),p=80,w=40,C=T=>{m(T.touches[0].clientX),g(!0)},S=T=>{if(!l)return;const N=T.touches[0].clientX,v=d-N;v>0?u(Math.min(v,p)):u(Math.max(v,-20))},D=()=>{g(!1),n>w?u(p):u(0)},b=()=>{n>0?u(0):o(t)},j=T=>{T.stopPropagation(),s(t)};return a.useEffect(()=>{const T=N=>{f.current&&!f.current.contains(N.target)&&u(0)};if(n>0)return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[n]),e.jsxs("div",{ref:f,className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center justify-center bg-red-600",style:{width:`${p}px`},children:e.jsxs("button",{onClick:j,className:"h-full w-full flex flex-col items-center justify-center text-white transition-opacity",style:{opacity:n>0?1:0},"aria-label":"Delete transaction",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 mb-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),e.jsx("span",{className:"text-xs font-medium",children:"å‰Šé™¤"})]})}),e.jsx("div",{className:"relative",style:{transform:`translateX(-${n}px)`,transition:l?"none":"transform 250ms ease-out"},onTouchStart:C,onTouchMove:S,onTouchEnd:D,onClick:b,children:e.jsxs(pe,{className:"cursor-pointer active:scale-[0.98] transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-50",children:t.description}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Ue(t.date)})]}),e.jsx("p",{className:`text-lg font-bold font-numbers ${t.is_transfer?"text-blue-500 dark:text-blue-400":t.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:qe(t.amount,t.type,t.currency||"JPY",i,!0,r)})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(Ze,{children:t.category}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.source})]})]})})]})}function la({isOpen:t,onClose:o,onConfirm:s,transaction:r,isDeleting:i=!1}){const{t:n}=V("common"),{currency:u}=Xe(),{isPrivacyMode:l}=_e(),g=De();if(!t||!r)return null;const d=e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:o}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-[calc(100%-2rem)] max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:n("transaction.deleteConfirm","å–å¼•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6 space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.description}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:Ue(r.date)}),e.jsx("span",{className:`font-bold font-numbers ${r.type==="income"?"text-green-600":"text-red-600"}`,children:qe(r.amount,r.type,u,g,!1,l)})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:r.category}),e.jsx("span",{children:"-"}),e.jsx("span",{children:r.source})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:n("transaction.deleteWarning","ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",onClick:o,disabled:i,className:"flex-1",children:n("button.cancel","ã‚­ãƒ£ãƒ³ã‚»ãƒ«")}),e.jsx(F,{onClick:s,disabled:i,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:i?"å‰Šé™¤ä¸­...":n("button.delete","å‰Šé™¤")})]})]})]});return typeof document<"u"?he.createPortal(d,document.body):null}function ia({isOpen:t,onClose:o,onConfirm:s,selectedCount:r,isLoading:i}){const{t:n}=V("common"),[u,l]=a.useState(""),g=[{value:"",label:n("transactions.selectCategory","Select category...")},{value:"é£Ÿè²»",label:n("category.food","Food")},{value:"ä½å®…",label:n("category.housing","Housing")},{value:"äº¤é€š",label:n("category.transport","Transport")},{value:"å¨¯æ¥½",label:n("category.entertainment","Entertainment")},{value:"é€šä¿¡",label:n("category.communication","Communication")},{value:"æ—¥ç”¨å“",label:n("category.daily","Daily Necessities")},{value:"åŒ»ç™‚",label:n("category.medical","Medical")},{value:"æ•™è‚²",label:n("category.education","Education")},{value:"ãã®ä»–",label:n("category.other","Other")}],d=()=>{u&&(s(u),l(""))};if(!t)return null;const m=e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:o}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("transactions.recategorizeTitle","Change Category")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:n("transactions.recategorizeDescription","Update category for {{count}} transactions",{count:r})}),e.jsx(ke,{label:n("transactions.newCategory","New Category"),value:u,onChange:f=>l(f.target.value),options:g}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(F,{variant:"outline",onClick:o,className:"flex-1",children:n("button.cancel","Cancel")}),e.jsx(F,{onClick:d,disabled:!u||i,className:"flex-1",children:i?n("button.saving","Saving..."):n("button.apply","Apply")})]})]})]});return typeof document<"u"?he.createPortal(m,document.body):null}function da({isOpen:t,onClose:o,onConfirm:s,selectedCount:r,isDeleting:i}){const{t:n}=V("common");if(!t)return null;const u=e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:o}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg p-6 w-[calc(100%-2rem)] max-w-md shadow-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:n("transactions.bulkDeleteTitle","Delete Transactions")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:n("transactions.bulkDeleteConfirm","Are you sure you want to delete {{count}} transactions? This cannot be undone.",{count:r})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",onClick:o,className:"flex-1",children:n("button.cancel","Cancel")}),e.jsx(F,{variant:"danger",onClick:s,disabled:i,className:"flex-1",children:i?n("button.deleting","Deleting..."):n("button.delete","Delete")})]})]})]});return typeof document<"u"?he.createPortal(u,document.body):null}function ua(t){const o=["Date","Description","Amount","Type","Category","Source"],s=t.map(r=>[r.date,`"${r.description.replace(/"/g,'""')}"`,r.amount.toString(),r.type,r.category,r.source]);return[o.join(","),...s.map(r=>r.join(","))].join(`
`)}function ma(t,o){const s=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}function ga(t,o,s){const r=ua(t),i=o&&s?`${o}_to_${s}`:new Date().toISOString().split("T")[0];ma(r,`smartmoney_transactions_${i}.csv`)}function xa(t,o){const[s,r]=a.useState(t);return a.useEffect(()=>{const i=setTimeout(()=>r(t),o);return()=>clearTimeout(i)},[t,o]),s}function Ve(t){const[o,s]=t.split("-").map(Number),r=`${o}-${String(s).padStart(2,"0")}-01`,i=new Date(o,s,0).getDate(),n=`${o}-${String(s).padStart(2,"0")}-${String(i).padStart(2,"0")}`;return{start:r,end:n}}function ha(){const{t}=V("common"),{currency:o}=Xe(),{isPrivacyMode:s}=_e(),r=De(),i=Se(),n=ut(),u=ft(),{data:l}=Re(),{categories:g,month:d,accountId:m,fromAccounts:f,type:p}=mt({from:"/transactions"}),w=g?g.split(",").filter(Boolean):[],C=d?Ve(d):u,[S,D]=a.useState({start_date:C.start,end_date:C.end,categories:w,source:"",type:p||"all"}),[b,j]=a.useState(""),T=xa(b,300),[N,v]=a.useState("date"),[R,I]=a.useState("desc"),[z,K]=a.useState(50),[Y,q]=a.useState(!1),_=c=>{q(!0),N===c?I(k=>k==="asc"?"desc":"asc"):(v(c),I("desc")),setTimeout(()=>q(!1),150)},te=c=>{q(!0);const[k,M]=c.split("-");v(k),I(M),setTimeout(()=>q(!1),150)};a.useEffect(()=>{D(c=>({...c,search:T||void 0}))},[T]),a.useEffect(()=>{if(g||d||p!==void 0){const c=d?Ve(d):u,k=g?g.split(",").filter(Boolean):[];D(M=>({...M,categories:k.length>0?k:M.categories,start_date:c.start,end_date:c.end,type:p||"all"}))}},[g,d,p]);const Q=c=>{const k=p===c?void 0:c;n({to:"/transactions",search:M=>({...M,type:k})})},[O,W]=a.useState(null),[J,H]=a.useState(!1),[ae,X]=a.useState(null),[oe,G]=a.useState(!1),[U,B]=a.useState(new Set),[$,de]=a.useState(!1),[ce,re]=a.useState(!1),{data:y,isLoading:L}=Qe({queryKey:["transactions",S],queryFn:()=>St(S)});a.useEffect(()=>{B(new Set)},[y]),a.useEffect(()=>{const c=()=>{H(!0)},k=()=>{G(!0)};return window.addEventListener("open-add-transaction-modal",c),window.addEventListener("open-receipt-scanner",k),()=>{window.removeEventListener("open-add-transaction-modal",c),window.removeEventListener("open-receipt-scanner",k)}},[]);const Z=Ke(Fe,"transaction",[["transactions"],["analytics"]]),fe=c=>{if(!c.amount||!c.category)return;const k=l==null?void 0:l[0],M=(k==null?void 0:k.currency)||"JPY",we=ze(Math.abs(c.amount),M);Z.mutate({date:c.date||new Date().toISOString().split("T")[0],description:c.merchant||"Receipt Scan",amount:-we,currency:M,category:c.category,source:(k==null?void 0:k.name)||"Unknown",type:"expense"})},ue=[{value:"é£Ÿè²»",label:t("category.food","Food")},{value:"ä½å®…",label:t("category.housing","Housing")},{value:"äº¤é€š",label:t("category.transport","Transport")},{value:"å¨¯æ¥½",label:t("category.entertainment","Entertainment")},{value:"é€šä¿¡",label:t("category.communication","Communication")},{value:"æ—¥ç”¨å“",label:t("category.daily","Daily Necessities")},{value:"åŒ»ç™‚",label:t("category.medical","Medical")},{value:"æ•™è‚²",label:t("category.education","Education")},{value:"ãã®ä»–",label:t("category.other","Other")}],x=y&&y.length>0&&y.every(c=>U.has(c.id)),A=()=>{B(x?new Set:new Set((y==null?void 0:y.map(c=>c.id))||[]))},me=c=>{const k=new Set(U);k.has(c)?k.delete(c):k.add(c),B(k)},se=ye({mutationFn:c=>He(c),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),X(null)}}),h=ye({mutationFn:()=>bt(Array.from(U)),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),i.invalidateQueries({queryKey:["dashboard"]}),i.invalidateQueries({queryKey:["analytics"]}),B(new Set),re(!1)}}),P=ye({mutationFn:c=>jt(Array.from(U),c),onSuccess:()=>{i.invalidateQueries({queryKey:["transactions"]}),B(new Set),de(!1)}}),ge=()=>{ae&&se.mutate(ae.id)},le=()=>{D({start_date:u.start,end_date:u.end,categories:[],source:"",type:"all"}),j(""),n({to:"/transactions",search:{}})},ie=a.useMemo(()=>{if(!y)return[];if(!m)return y;const c=Number(m);return y.filter(k=>k.account_id!=null&&Number(k.account_id)===c)},[y,m]),xe=a.useMemo(()=>!m||!l?null:l.find(c=>c.id===Number(m))||null,[m,l]),Ee=(xe==null?void 0:xe.currency)||o,nt={JPY:1,USD:.00667,VND:167},{income:ot,expense:ct,net:lt}=a.useMemo(()=>{const c=ie,k=(ee,ne)=>{if(xe)return ee;const dt=Ct[ne]??0,Pe=ee/Math.pow(10,dt);if(ne==="JPY")return Pe;const Me=r[ne]??nt[ne];return!Me||Me===0?(console.warn(`No exchange rate found for currency: ${ne}, treating as JPY`),Pe):Pe/Me},M=c.filter(ee=>ee.type==="income"&&!ee.is_transfer).reduce((ee,ne)=>ee+k(ne.amount,ne.currency||"JPY"),0),we=c.filter(ee=>ee.type==="expense"&&!ee.is_transfer).reduce((ee,ne)=>ee+k(Math.abs(ne.amount),ne.currency||"JPY"),0);return{income:M,expense:we,net:M-we}},[ie,xe,r]),Ne=a.useMemo(()=>ie.length?[...ie].sort((c,k)=>{let M=0;switch(N){case"date":M=c.date.localeCompare(k.date);break;case"description":M=c.description.localeCompare(k.description);break;case"category":M=c.category.localeCompare(k.category);break;case"source":M=c.source.localeCompare(k.source);break;case"amount":M=c.amount-k.amount;break}return R==="asc"?M:-M}):[],[ie,N,R]),be=a.useMemo(()=>z==="all"?Ne:Ne.slice(0,z),[Ne,z]),it=a.useMemo(()=>{if(!be.length)return[];const c=[];let k="";return be.forEach(M=>{M.date!==k?(k=M.date,c.push({date:M.date,transactions:[M]})):c[c.length-1].transactions.push(M)}),c},[be]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-24",children:[f&&e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>n({to:"/accounts"}),className:"mb-4 -ml-2",children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),t("common.backToAccounts")]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:t("transactions.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("transactions.subtitle")})]}),e.jsxs(pe,{className:"mb-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(je,{label:t("transactions.search","Search"),placeholder:t("transactions.searchPlaceholder","Search by description..."),value:b,onChange:c=>j(c.target.value)})}),e.jsx("div",{className:"mb-4",children:e.jsx(Yt,{startDate:S.start_date||"",endDate:S.end_date||"",onRangeChange:(c,k)=>D({...S,start_date:c,end_date:k})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Bt,{label:t("transactions.category","Category"),options:ue,selected:S.categories||[],onChange:c=>D({...S,categories:c}),placeholder:t("transactions.allCategories","All categories")}),e.jsx(ke,{label:t("transactions.source","Source"),value:S.source||"",onChange:c=>D({...S,source:c.target.value}),options:[{value:"",label:t("transactions.all","All")},{value:"æ¥½å¤©ã‚«ãƒ¼ãƒ‰",label:t("transactions.sourceRakuten","Rakuten Card")}]})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx(F,{variant:"outline",onClick:le,children:t("button.reset","Reset")}),e.jsx(F,{variant:"outline",onClick:()=>y&&ga(y,S.start_date,S.end_date),disabled:!y||y.length===0,children:t("transactions.export","Export")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs(pe,{onClick:()=>Q("income"),className:`cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] ${p==="income"?"ring-2 ring-green-500 dark:ring-green-400 bg-green-50/50 dark:bg-green-900/20":""}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.income")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-green-600 dark:text-green-400",children:Ie(ot,Ee,r,!0,s)})]}),e.jsxs(pe,{onClick:()=>Q("expense"),className:`cursor-pointer transition-all hover:shadow-md hover:scale-[1.01] ${p==="expense"?"ring-2 ring-red-500 dark:ring-red-400 bg-red-50/50 dark:bg-red-900/20":""}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.expense")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-red-600 dark:text-red-400",children:Ie(ct,Ee,r,!0,s)})]}),e.jsxs(pe,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t("transactions.difference")}),e.jsx("p",{className:"text-2xl font-bold font-numbers text-blue-600 dark:text-blue-400",children:Ie(lt,Ee,r,!0,s)})]})]}),!L&&y&&y.length>0&&e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("transactions.show","Show"),":"]}),e.jsx("div",{className:"hidden md:flex gap-1",children:[50,100,"all"].map(c=>e.jsx("button",{onClick:()=>K(c),className:`px-3 py-1 text-sm rounded-md transition-colors ${z===c?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:c==="all"?t("transactions.showAll","All"):c},c))}),e.jsxs("select",{value:z,onChange:c=>K(c.target.value==="all"?"all":Number(c.target.value)),className:"md:hidden px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"all",children:t("transactions.showAll","All")})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("transactions.sort","Sort"),":"]}),e.jsxs("select",{value:`${N}-${R}`,onChange:c=>te(c.target.value),className:"px-3 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"date-desc",children:t("transactions.sortDateDesc","Date â†“")}),e.jsx("option",{value:"date-asc",children:t("transactions.sortDateAsc","Date â†‘")}),e.jsx("option",{value:"amount-desc",children:t("transactions.sortAmountDesc","Amount â†“")}),e.jsx("option",{value:"amount-asc",children:t("transactions.sortAmountAsc","Amount â†‘")})]}),Y&&e.jsxs("svg",{className:"animate-spin h-4 w-4 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("transactions.showingCount","Showing {{shown}} of {{total}}",{shown:be.length,total:Ne.length})})]}),L?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.date")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.description")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.category")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.source")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:t("transactions.amount")}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:t("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:[...Array(5)].map((c,k)=>e.jsx(vt,{},k))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:[...Array(5)].map((c,k)=>e.jsx(kt,{},k))})]}):y&&y.length>0?e.jsxs("div",{className:`transition-opacity duration-150 ${Y?"opacity-50":"opacity-100"}`,children:[e.jsx(pe,{className:"hidden md:block overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-12",children:e.jsx("input",{type:"checkbox",checked:x,onChange:A,className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>_("date"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.date"),N==="date"&&e.jsx("span",{className:"text-blue-600",children:R==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>_("description"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.description"),N==="description"&&e.jsx("span",{className:"text-blue-600",children:R==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>_("category"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.category"),N==="category"&&e.jsx("span",{className:"text-blue-600",children:R==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>_("source"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("transactions.source"),N==="source"&&e.jsx("span",{className:"text-blue-600",children:R==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 select-none",onClick:()=>_("amount"),children:e.jsxs("span",{className:"flex items-center justify-end gap-1",children:[t("transactions.amount"),N==="amount"&&e.jsx("span",{className:"text-blue-600",children:R==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase w-24",children:t("transactions.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:be.map(c=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:U.has(c.id),onChange:()=>me(c.id),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:Ue(c.date)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-50",children:c.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Ze,{variant:c.type==="income"?"info":"default",children:c.category})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-300",children:c.source}),e.jsx("td",{className:`px-6 py-4 text-sm font-semibold font-numbers text-right ${c.is_transfer?"text-blue-500 dark:text-blue-400":c.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:qe(c.amount,c.type,c.currency||"JPY",r,!0,s)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>W(c),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors","aria-label":t("button.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})})}),e.jsx("button",{onClick:()=>X(c),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors","aria-label":t("button.delete"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-red-600 dark:text-red-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]})})]},c.id))})]})}),e.jsx("div",{className:"md:hidden space-y-6",children:N==="date"?it.map(c=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:Nt(c.date)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx("div",{className:"space-y-3",children:c.transactions.map(k=>e.jsx(Je,{transaction:k,onEdit:W,onDelete:X},k.id))})]},c.date)):e.jsx("div",{className:"space-y-3",children:be.map(c=>e.jsx(Je,{transaction:c,onEdit:W,onDelete:X},c.id))})})]}):e.jsx(pe,{children:e.jsx(wt,{icon:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),title:t("transactions.noData"),description:t("transactions.noDataDescription","Upload a CSV file or add transactions manually to get started."),action:e.jsx(F,{onClick:()=>H(!0),children:t("transaction.addTransaction")})})}),U.size>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg p-4 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("transactions.selectedCount","{{count}} selected",{count:U.size})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>B(new Set),children:t("button.clearSelection","Clear")}),e.jsx(F,{variant:"outline",size:"sm",onClick:()=>de(!0),children:t("transactions.recategorize","Recategorize")}),e.jsx(F,{variant:"danger",size:"sm",onClick:()=>re(!0),children:t("transactions.deleteSelected","Delete")})]})]})}),e.jsx(Qt,{isOpen:!!O,onClose:()=>W(null),transaction:O}),e.jsx(ta,{isOpen:J,onClose:()=>H(!1)}),e.jsx(la,{isOpen:!!ae,onClose:()=>X(null),onConfirm:ge,transaction:ae,isDeleting:se.isPending}),e.jsx(ia,{isOpen:$,onClose:()=>de(!1),onConfirm:c=>P.mutate(c),selectedCount:U.size,isLoading:P.isPending}),e.jsx(da,{isOpen:ce,onClose:()=>re(!1),onConfirm:()=>h.mutate(),selectedCount:U.size,isDeleting:h.isPending}),e.jsx(st,{isOpen:oe,onClose:()=>G(!1),onScanComplete:fe}),e.jsx(ca,{})]})}const Ra=gt("/transactions")({component:ha});export{Ra as Route};
