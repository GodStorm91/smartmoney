import{u as q,Y as ae,K as re,J as se,r as f,j as e,l as j,g as ne,ay as ue,aC as E,T as xe,a6 as W,I as Q,G as oe,$ as he,z as $,a1 as le,aD as ye,aE as be,B as Z,w as ie,aF as fe,aG as pe,aH as ve,n as je,aw as Ne,ax as ke,D as R,P as we,aI as Ce,aJ as Se,aK as De,i as _e}from"./index-pF_hEH6n.js";import{C as Te}from"./chevron-up-Db0AwSeg.js";import{C as Pe}from"./chevron-down-C_HbIZH_.js";import{P as Ae}from"./pencil-BDwZ1TCP.js";import{u as Me}from"./useXPGain-aAC_oB4k.js";function qe({goalId:s,goalName:d,achievability:r,targetAmount:a,currentAmount:g,onEdit:t,onDelete:l,topExpenseCategory:u}){const{t:n}=q("common"),{currency:b}=ae(),{data:m}=re(),{isPrivacyMode:c}=se(),[w,h]=f.useState(!1),[_,C]=f.useState(!1),N=a>0?Math.min(100,g/a*100):0,y=r.current_monthly_net>=r.required_monthly,v=N>=100,A=()=>{if(v)return n("goal.insight.achieved");if(y)return n("goal.insight.onTrackMonths",{months:r.months_remaining});const x=r.monthly_gap;if(x>0){const S=W(x,b,(m==null?void 0:m.rates)||{},!1,c);return n("goal.insight.saveMore",{amount:S})}return n("goal.insight.everyBitCounts")},T=v||y?"text-emerald-600 dark:text-emerald-400":"text-amber-600 dark:text-amber-400",P=v||y?"bg-emerald-50 dark:bg-emerald-900/20":"bg-amber-50 dark:bg-amber-900/20",M=v||y?"bg-emerald-500":"bg-amber-500";return e.jsxs("div",{className:j("rounded-xl border overflow-hidden transition-all","bg-white dark:bg-gray-800","border-gray-200 dark:border-gray-700","hover:shadow-md"),children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸŽ¯"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d})]}),e.jsxs("div",{className:j("flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",v||y?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400"),children:[v?"ðŸŽ‰":y?e.jsx(ne,{className:"w-3 h-3"}):e.jsx(ue,{className:"w-3 h-3"}),n(v?"goal.status.completed":y?"goal.status.onTrack":"goal.status.behind")]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-end mb-1.5",children:[e.jsxs("div",{children:[e.jsxs("span",{className:j("text-2xl font-bold",T),children:[Math.round(N),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[E(g,b,(m==null?void 0:m.rates)||{},!0,c)," / ",E(a,b,(m==null?void 0:m.rates)||{},!0,c)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.months_remaining," ",n("goal.months","months")]}),!v&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:y?n("goal.onTrack","On track"):n("goal.behind","Behind")})]})]}),e.jsx("div",{className:"w-full h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-all duration-500",M),style:{width:`${Math.min(100,N)}%`}})})]}),e.jsx("div",{className:j("rounded-lg p-2.5",P),children:e.jsxs("p",{className:j("text-xs",T),children:["ðŸ’¡ ",A()]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>h(!w),className:"flex-1 flex items-center justify-center gap-1 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:w?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),n("button.hideDetails","Hide Details")]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),n("button.showDetails","Show Details")]})}),t&&e.jsxs("button",{onClick:()=>t(s),className:"flex items-center gap-1 px-3 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(Ae,{className:"w-3.5 h-3.5"}),n("button.edit","Edit")]}),l&&!_&&e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-1 px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(xe,{className:"w-3.5 h-3.5"}),n("button.delete","Delete")]})]}),_&&l&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700 animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-xs text-center text-gray-600 dark:text-gray-400 mb-2",children:n("goal.deleteConfirm")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(!1),className:"flex-1 py-1.5 text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:n("button.cancel","Cancel")}),e.jsx("button",{onClick:()=>{l(s),C(!1)},className:"flex-1 py-1.5 text-xs text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:n("button.delete","Delete")})]})]})]}),w&&e.jsxs("div",{className:"px-4 pb-4 pt-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0.5",children:n("goal.savingNow","Saving now")}),e.jsxs("p",{className:j("text-sm font-semibold",y?"text-emerald-600 dark:text-emerald-400":"text-amber-600 dark:text-amber-400"),children:[E(r.current_monthly_net,b,(m==null?void 0:m.rates)||{},!1,c),e.jsx("span",{className:"text-xs font-normal text-gray-400",children:"/mo"})]})]}),e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0.5",children:n("goal.needed","Needed")}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:[E(r.required_monthly,b,(m==null?void 0:m.rates)||{},!1,c),e.jsx("span",{className:"text-xs font-normal text-gray-400",children:"/mo"})]})]})]}),!y&&!v&&u&&u.monthlyAmount>0&&e.jsx("div",{className:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:["ðŸ’° ",n("goal.insight.topExpenseTip",{category:n(`categories.${u.name}`,{defaultValue:u.name}),amount:W(u.monthlyAmount,b,(m==null?void 0:m.rates)||{},!1,c)})]})})]})]})}function ee({years:s,custom:d=!1,disabled:r=!1,onClick:a,className:g}){const{t}=q(),l=()=>d?t("goals.card.customPeriod"):t("goals.card.yearGoal",{years:s}),u=()=>t(d?"goals.card.customDescription":s===1?"goals.card.shortTerm":s===3?"goals.card.mediumTerm":s===5?"goals.card.mediumLongTerm":s===10?"goals.card.longTerm":"goals.card.createGoal"),n=()=>d?"âš™ï¸":"ðŸ“Œ";return e.jsxs("button",{onClick:a,disabled:r,className:j("relative p-4 rounded-xl border-2 transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1",r?"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 cursor-not-allowed opacity-60":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:shadow-md active:scale-95 cursor-pointer",g),"aria-label":r?t("goals.card.ariaDisabled",{label:l()}):t("goals.card.ariaCreate",{label:l()}),"aria-disabled":r,children:[r&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx(ne,{className:"w-3 h-3 text-gray-500 dark:text-gray-400"})})}),e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"text-3xl",children:n()}),e.jsxs("div",{children:[e.jsx("h3",{className:j("text-sm font-semibold",r?"text-gray-400":"text-gray-900 dark:text-gray-100"),children:l()}),e.jsx("p",{className:j("text-xs mt-0.5",r?"text-gray-400":"text-gray-500 dark:text-gray-400"),children:u()})]})]})]})}const Ee=[1,3,5,10];function te({onCreateClick:s,existingGoalYears:d,maxGoals:r}){const{t:a}=q("common"),g=l=>d.includes(l),t=r-d.length;return e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:a("goals.createGoal")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t>0?a("goals.remainingSlots",{count:t}):a("goals.maxGoalsReached",{max:r})})]})}),t>0&&e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-hide",children:[Ee.map(l=>e.jsx(ee,{years:l,disabled:g(l),onClick:()=>s(l),className:"flex-shrink-0 w-28"},l)),e.jsx(ee,{custom:!0,disabled:t<=0,onClick:()=>s(),className:"flex-shrink-0 w-28"})]}),t===1&&d.length===r-1&&e.jsxs("button",{onClick:()=>s(),disabled:t<=0,className:"w-full py-4 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âœ¨"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a("goals.createGoal")})]})]})}function Fe({selectedOption:s,customDate:d,customDateError:r,onOptionChange:a,onCustomDateChange:g}){const{t,i18n:l}=q(),u=new Date(new Date().getFullYear(),new Date().getMonth()+1,1),n=l.language==="ja"?"ja-JP":l.language==="vi"?"vi-VN":"en-US";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:t("goals.form.startDate")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"today",checked:s==="today",onChange:()=>a("today"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateTodayAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t("goals.form.startDateToday")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date().toLocaleDateString(n)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"month_start",checked:s==="month_start",onChange:()=>a("month_start"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateNextMonthAria")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t("goals.form.startDateNextMonth")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:u.toLocaleDateString(n)})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"startDate",value:"custom",checked:s==="custom",onChange:()=>a("custom"),className:"mt-1 w-4 h-4 text-primary-500 focus:ring-primary-500","aria-label":t("goals.form.startDateCustomAria")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:t("goals.form.startDateCustom")}),s==="custom"&&e.jsx(Q,{type:"date",value:d,onChange:b=>g(b.target.value),error:r,className:"text-sm","aria-label":t("goals.form.startDateCustomAria")})]})]})]})]})}const Le={emergency_fund:{icon:"ðŸ›¡ï¸",color:"bg-red-50 border-red-200 hover:bg-red-100"},home_down_payment:{icon:"ðŸ ",color:"bg-blue-50 border-blue-200 hover:bg-blue-100"},vacation_travel:{icon:"âœˆï¸",color:"bg-cyan-50 border-cyan-200 hover:bg-cyan-100"},vehicle:{icon:"ðŸš—",color:"bg-green-50 border-green-200 hover:bg-green-100"},education:{icon:"ðŸ“š",color:"bg-purple-50 border-purple-200 hover:bg-purple-100"},wedding:{icon:"ðŸ’",color:"bg-pink-50 border-pink-200 hover:bg-pink-100"},large_purchase:{icon:"ðŸ›’",color:"bg-orange-50 border-orange-200 hover:bg-orange-100"},debt_payoff:{icon:"ðŸ’³",color:"bg-yellow-50 border-yellow-200 hover:bg-yellow-100"},retirement:{icon:"ðŸ–ï¸",color:"bg-teal-50 border-teal-200 hover:bg-teal-100"},investment:{icon:"ðŸ“ˆ",color:"bg-indigo-50 border-indigo-200 hover:bg-indigo-100"},custom:{icon:"ðŸŽ¯",color:"bg-gray-50 border-gray-200 hover:bg-gray-100"}},Ge=["emergency_fund","home_down_payment","vacation_travel","vehicle","education","wedding","large_purchase","debt_payoff","retirement","investment","custom"];function $e({selectedType:s,onSelect:d,hasEmergencyFund:r}){const{t:a}=q();return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:a("goals.selectType")}),!r&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:a("goals.emergencyFundFirst")}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Ge.map(g=>{const t=Le[g],l=s===g,u=!r&&g!=="emergency_fund";return e.jsxs("button",{onClick:()=>!u&&d(g),disabled:u,className:`
                p-4 rounded-lg border-2 text-center transition-all
                ${l?"ring-2 ring-blue-500 border-blue-500":t.color}
                ${u?"opacity-50 cursor-not-allowed":"cursor-pointer"}
              `,children:[e.jsx("span",{className:"text-2xl block mb-1",children:t.icon}),e.jsx("span",{className:"text-xs font-medium text-gray-700 block",children:a(`goals.types.${g}`)})]},g)})})]})}function Ke(s,d,r,a,g){const t={};g||(s<1||s>10)&&(t.years="goals.errors.yearsRange");const l=parseInt(d.replace(/[,.\s]/g,""),10);return!d||isNaN(l)?t.targetAmount="goals.errors.amountRequired":l<1e4&&(t.targetAmount="goals.errors.amountMinimum"),r==="custom"&&!a&&(t.customDate="goals.errors.dateRequired"),t}function Ye(s,d){if(s==="today")return new Date().toISOString().split("T")[0];if(s==="month_start"){const r=new Date;return new Date(r.getFullYear(),r.getMonth()+1,1).toISOString().split("T")[0]}else return d}function Je(s,d="ja-JP"){const r=s.replace(/[,.\s]/g,"");return/^\d*$/.test(r)?r?parseInt(r,10).toLocaleString("en-US"):"":s}function Oe({isOpen:s,onClose:d,preselectedYears:r,editingGoalId:a}){const g=oe(),{t,i18n:l}=q(),[u,n]=f.useState(1),[b,m]=f.useState(null),[c,w]=f.useState(""),[h,_]=f.useState(r||3),[C,N]=f.useState(""),[y,v]=f.useState("today"),[A,T]=f.useState(""),[P,M]=f.useState("JPY"),[x,S]=f.useState(null),[F,K]=f.useState({}),[Y,o]=f.useState(""),{data:k=[]}=he(),{data:L=!0}=$({queryKey:["has-emergency-fund"],queryFn:fe,enabled:s&&!a}),{showGoalCreatedXP:z}=Me(),{data:p}=$({queryKey:["goal",a],queryFn:()=>pe(a),enabled:!!a&&s});f.useEffect(()=>{if(s){if(a&&p){n(2),m(p.goal_type||"custom"),w(p.name||""),_(p.years);const i=l.language==="ja"?"ja-JP":l.language==="vi"?"vi-VN":"en-US";N(p.target_amount.toLocaleString(i)),p.start_date&&(v("custom"),T(p.start_date)),S(p.account_id||null)}else n(1),m(null),w(""),_(r||3),N(""),v("today"),T(""),M("JPY"),S(null);K({}),o("")}},[s,r,a,p]);const D=le({mutationFn:async i=>a?ye(a,i):be(i),onSuccess:()=>{g.invalidateQueries({queryKey:["goals"]}),g.invalidateQueries({queryKey:["goals-progress-full"]}),g.invalidateQueries({queryKey:["has-emergency-fund"]}),g.invalidateQueries({queryKey:["accounts"]}),z(),d()},onError:()=>{o(t(a?"goals.errors.updateFailed":"goals.errors.createFailed"))}}),de=i=>{m(i),c||w(t(`goals.types.${i}`)),n(2)},ce=()=>{switch(P){case"JPY":return`Â¥${1e4.toLocaleString()}`;case"USD":return`$${1e4.toLocaleString()}`;case"VND":return`${1e4.toLocaleString()}â‚«`;default:return 1e4.toLocaleString()}},B=i=>{i.preventDefault();const V=Ke(h,C,y,A,r),J={};for(const[X,O]of Object.entries(V))O&&(O==="goals.errors.amountMinimum"?J[X]=t(O,{amount:ce()}):J[X]=t(O));if(Object.keys(J).length>0){K(J);return}const H=parseInt(C.replace(/[,.\s]/g,""),10),I=Ye(y,A);a?D.mutate({name:c||void 0,target_amount:H,start_date:I||void 0,account_id:x||void 0}):D.mutate({goal_type:b||"custom",name:c||void 0,target_amount:H,currency:P,years:h,start_date:I||void 0})},me=i=>{const V=l.language==="ja"?"ja-JP":l.language==="vi"?"vi-VN":"en-US";N(Je(i.target.value,V))};if(!s)return null;const ge=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:d}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t(a?"goals.modal.editTitle":u===1?"goals.modal.createTitle":`goals.types.${b}`)}),!a&&u===2&&e.jsxs("button",{onClick:()=>n(1),className:"text-sm text-blue-600 hover:underline mt-1",children:["â† ",t("back")]})]}),e.jsx("div",{className:"p-6",children:u===1&&!a?e.jsx($e,{selectedType:b,onSelect:de,hasEmergencyFund:L}):e.jsxs("form",{onSubmit:B,className:"space-y-5",children:[e.jsx(Q,{label:t("goals.form.name"),type:"text",value:c,onChange:i=>w(i.target.value),placeholder:t("goals.form.namePlaceholder")}),!r&&!a&&e.jsx(Q,{label:t("goals.form.years"),type:"number",min:1,max:10,value:h,onChange:i=>_(parseInt(i.target.value,10)||1),error:F.years,required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("goals.form.currency")}),e.jsxs("select",{value:P,onChange:i=>M(i.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",disabled:!!a,children:[e.jsx("option",{value:"JPY",children:t("currency.JPY")}),e.jsx("option",{value:"USD",children:t("currency.USD")}),e.jsx("option",{value:"VND",children:t("currency.VND")})]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(Q,{label:t("goals.form.targetAmount"),type:"text",value:C,onChange:me,error:F.targetAmount,placeholder:t("goals.form.targetAmountPlaceholder"),required:!0})})]}),e.jsx(Fe,{selectedOption:y,customDate:A,customDateError:F.customDate,onOptionChange:v,onCustomDateChange:T}),(a||k.length>0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("goals.form.linkedAccount")}),e.jsxs("select",{value:x||"",onChange:i=>S(i.target.value?parseInt(i.target.value,10):null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:t("goals.form.autoCreateAccount")}),k.map(i=>e.jsxs("option",{value:i.id,children:[i.name," (",t(`account.type.${i.type}`),")"]},i.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t("goals.form.linkedAccountHint")})]}),Y&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-800 dark:text-red-300",children:Y})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-6 py-4 flex gap-3 justify-end",children:[e.jsx(Z,{variant:"outline",onClick:d,disabled:D.isPending,children:t("cancel")}),u===2&&e.jsx(Z,{variant:"primary",onClick:B,disabled:D.isPending||!C,children:D.isPending?t("goals.modal.creating"):t(a?"goals.modal.update":"goals.modal.create")})]})]})]});return typeof document>"u"?null:ie.createPortal(ge,document.body)}const U=4,G=3;function Ue(){const{t:s}=q("common"),d=oe(),[r,a]=f.useState(!1),[g,t]=f.useState(),[l,u]=f.useState(null),{currency:n}=ae(),{data:b}=re(),{isPrivacyMode:m}=se(),{data:c,isLoading:w}=$({queryKey:["goals"],queryFn:Ce}),{data:h,isLoading:_}=$({queryKey:["goals-progress-full",c==null?void 0:c.map(o=>o.id),G],queryFn:async()=>!c||c.length===0?[]:Promise.all(c.map(o=>Se(o.id,!0,G))),enabled:!!c&&c.length>0}),C=new Date,N=new Date;N.setMonth(N.getMonth()-G);const{data:y}=$({queryKey:["category-breakdown-goals",G],queryFn:()=>De({start:N.toISOString().split("T")[0],end:C.toISOString().split("T")[0]}),enabled:!!c&&c.length>0}),v=f.useMemo(()=>{if(!(y!=null&&y.length))return;const o=[...y].filter(k=>k.category.toLowerCase()!=="transfer").sort((k,L)=>L.amount-k.amount);if(o[0])return{name:o[0].category,monthlyAmount:o[0].amount/G}},[y]),A=le({mutationFn:ve,onSuccess:()=>{d.invalidateQueries({queryKey:["goals"]}),d.invalidateQueries({queryKey:["goals-progress-full"]}),d.invalidateQueries({queryKey:["has-emergency-fund"]})}}),T=w||_,P=(c==null?void 0:c.map(o=>o.years))||[],M=P.length<U,x=f.useMemo(()=>{if(!(h!=null&&h.length))return null;const o=h.reduce((p,D)=>p+D.target_amount,0),k=h.reduce((p,D)=>p+D.total_saved,0),L=o>0?k/o*100:0,z=h.filter(p=>p.achievability&&p.achievability.current_monthly_net>=p.achievability.required_monthly).length;return{totalTarget:o,totalSaved:k,avgProgress:L,onTrackCount:z,totalCount:h.length}},[h]),S=o=>{t(o),u(null),a(!0)},F=o=>{u(o),t(void 0),a(!0)},K=o=>{A.mutate(o)},Y=()=>{a(!1),t(void 0),u(null)};return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary-600"}),s("goals.title")]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(h==null?void 0:h.length)||0,"/",U]})]}),x&&x.totalCount>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:E(x.totalSaved,n,(b==null?void 0:b.rates)||{},!0,m)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-500",children:E(x.totalTarget,n,(b==null?void 0:b.rates)||{},!0,m)})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:j("h-full rounded-full transition-all duration-500",x.avgProgress>=100?"bg-emerald-500":x.avgProgress>=50?"bg-primary-500":"bg-amber-500"),style:{width:`${Math.min(100,x.avgProgress)}%`}})})]}),e.jsxs("div",{className:j("flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full",x.onTrackCount===x.totalCount?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":x.onTrackCount>0?"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400":"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-400"),children:[x.onTrackCount===x.totalCount?e.jsx(Ne,{className:"w-3.5 h-3.5"}):x.onTrackCount>0?e.jsx(ke,{className:"w-3.5 h-3.5"}):null,x.onTrackCount,"/",x.totalCount]})]})]})}),e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:T?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(R,{size:"lg"})}):h&&h.length>0?e.jsxs("div",{className:"space-y-4",children:[h.map((o,k)=>o.achievability&&e.jsx("div",{className:"animate-stagger-in",style:{"--stagger-index":k},children:e.jsx(qe,{goalId:o.goal_id,goalName:s("goals.yearGoal",{years:o.years}),achievability:o.achievability,targetAmount:o.target_amount,currentAmount:o.total_saved,onEdit:F,onDelete:K,topExpenseCategory:v})},o.goal_id)),M&&e.jsx("div",{className:"mt-6",children:e.jsx(te,{onCreateClick:S,existingGoalYears:P,maxGoals:U})})]}):c&&c.length>0?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(R,{size:"lg"})}):e.jsx(te,{onCreateClick:S,existingGoalYears:[],maxGoals:U})}),M&&typeof document<"u"&&ie.createPortal(e.jsx("button",{onClick:()=>S(),className:"fixed bottom-20 right-4 z-50 w-14 h-14 rounded-full bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 text-white shadow-lg flex items-center justify-center active:scale-95 transition-all md:hidden","aria-label":s("goals.createGoal"),children:e.jsx(we,{size:28})}),document.body),e.jsx(Oe,{isOpen:r,onClose:Y,preselectedYears:g,editingGoalId:l})]})}const Ie=_e("/goals")({component:Ue});export{Ie as Route};
