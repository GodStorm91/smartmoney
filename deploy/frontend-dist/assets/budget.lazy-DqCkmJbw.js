import{j as e,c as t,g as a,u as s,k as r,m as n}from"./vendor-tanstack-DaKcK1QW.js";import{r as l}from"./vendor-react-Bx4JnVfy.js";import{q as d,C as i,B as c,I as o,R as x,j as m,k as g,s as u,D as h,n as b,d as p,a as y,L as j}from"./index-DX1XEPIO.js";import{u as f}from"./vendor-i18n-BrrOrGm_.js";import{d as N}from"./useCategories-D0wiQusU.js";import{X as v,P as k,o as w,a6 as S,ae as M,ai as _,ab as C,I as $,f as D,u as P,r as B,b as E,s as F,t as I,ak as L,a3 as T,W as J,al as R,g as q,w as A}from"./vendor-icons-ALW4ipAx.js";import{u as O}from"./useXPGain-DyT_xoUD.js";import"./vendor-recharts-CdX2WCa7.js";import"./vendor-date-Be-7Lppd.js";function U(e,t=0){if(!e&&0!==e)return"";const a="string"==typeof e?parseFloat(e):e;return isNaN(a)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:t,maximumFractionDigits:t}).format(a)}function z({onGenerate:t,isLoading:a,error:s,suggestions:r}){const{t:n}=f("common"),{currency:x}=d(),[m,g]=l.useState(""),[u,h]=l.useState(!1),b=function(e){return{JPY:"¥",USD:"$",VND:"₫",EUR:"€",GBP:"£"}[e]||e}(x),p=function(e){return["VND"].includes(e)?"suffix":"prefix"}(x),y=function(e){return{JPY:0,VND:0,KRW:0,USD:2,EUR:2,GBP:2}[e]??0}(x);l.useEffect(()=>{if((null==r?void 0:r.previous_income)&&!u&&!m){const e=r.previous_income/Math.pow(10,y);g(U(e,y)),h(!0)}},[r,u,m,y]);return e.jsxs("div",{className:"space-y-4",children:[(null==r?void 0:r.has_previous)&&r.previous_month&&e.jsx(i,{className:"p-6 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-800 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("budget.previousBudgetFound",{month:(e=>{const[t,a]=e.split("-");return new Date(parseInt(t),parseInt(a)-1).toLocaleDateString(void 0,{month:"long",year:"numeric"})})(r.previous_month)})}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:n("budget.cloneDescription")}),e.jsx(c,{onClick:()=>{(null==r?void 0:r.previous_income)&&t(r.previous_income)},loading:a,className:"w-full sm:w-auto",children:n("budget.clonePreviousMonth")})]})]})}),(null==r?void 0:r.has_previous)&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:n("budget.orCreateNew")})})]}),e.jsxs(i,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:n("budget.generateTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:n("budget.generateDescription")}),e.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=function(e){if(!e)return 0;const t=e.replace(/,/g,""),a=parseFloat(t);return isNaN(a)?0:a}(m),s=Math.round(a*Math.pow(10,y));s>0&&(t(s),g(""))},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("budget.monthlyIncome")}),e.jsxs("div",{className:"relative",children:["prefix"===p&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:b})}),e.jsx(o,{type:"text",inputMode:"decimal",value:m,onChange:e=>{const t=e.target.value.replace(/[^\d.]/g,"");if(t){const e=parseFloat(t);isNaN(e)||g(U(e,y))}else g("")},placeholder:U(5e5,y),required:!0,disabled:a,className:"prefix"===p?"pl-8":"pr-10"}),"suffix"===p&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm font-medium",children:b})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[n("budget.incomeHint"),(null==r?void 0:r.previous_income)&&e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400",children:["(",n("budget.previousIncome"),": ",b,U(r.previous_income/Math.pow(10,y),y),")"]})]})]}),e.jsx(c,{type:"submit",loading:a,disabled:!m,className:"w-full",children:n("budget.generateButton")}),s&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:n("budget.generateError")})]})]})]})}function Y({onSubmit:t,onCancel:a,isLoading:s}){const{t:r}=f("common"),[n,d]=l.useState("");return e.jsxs(i,{className:"p-6 border-blue-200 bg-blue-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:r("budget.feedbackTitle")}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),n.trim()&&(t(n.trim()),d(""))},className:"space-y-4",children:[e.jsx("textarea",{value:n,onChange:e=>d(e.target.value),placeholder:r("budget.feedbackPlaceholder"),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 min-h-[100px]",disabled:s,required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"submit",disabled:s||!n.trim(),children:r(s?"budget.regenerating":"budget.submitFeedback")}),e.jsx(c,{type:"button",variant:"outline",onClick:a,children:r("cancel")})]})]})]})}function V({budget:t,onClose:a,onAdd:s}){const{t:r}=f("common"),{data:n}=N(),[d,m]=l.useState(""),[g,u]=l.useState(""),[h,b]=l.useState(""),p=l.useMemo(()=>{if(!n)return[];const e=new Set(t.allocations.map(e=>e.category)),a=[];return n.expense.forEach(t=>{e.has(t.name)||a.push(t.name),t.children.forEach(t=>{e.has(t.name)||a.push(t.name)})}),a.sort()},[n,t.allocations]),y=l.useMemo(()=>{const e=t.allocations.reduce((e,t)=>e+t.amount,0);return t.monthly_income-(t.savings_target||0)-e},[t]),j="__custom__"===d,w=j?g:d,S=w.trim().length>0&&parseInt(h)>0,M=Math.floor(y/(p.length+1));return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(i,{className:"w-full max-w-md animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r("budget.addCategory")}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(v,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),S&&s(w,parseInt(h))},className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("budget.category")}),e.jsxs("select",{value:d,onChange:e=>{m(e.target.value),"__custom__"!==e.target.value&&u("")},className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("option",{value:"",children:r("budget.selectCategory")}),p.map(t=>e.jsx("option",{value:t,children:t},t)),e.jsx("option",{value:"__custom__",children:r("budget.customCategory")})]})]}),j&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("budget.categoryName")}),e.jsx(o,{value:g,onChange:e=>u(e.target.value),placeholder:r("budget.categoryPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("budget.amount")}),e.jsx(o,{type:"number",value:h,onChange:e=>b(e.target.value),placeholder:x(0),min:1}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[r("budget.remainingBudget"),": ",x(y)]})]}),M>0&&e.jsx("button",{type:"button",onClick:()=>b(String(M)),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:r("budget.suggestAmount",{amount:x(M)})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:r("cancel")}),e.jsxs(c,{type:"submit",disabled:!S,className:"flex-1",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),r("budget.add")]})]})]})]})})}function K(e,t,a){if("JPY"===t)return e;const s=a[t];return s&&0!==s?Math.round(e/s):e}function G({category:t,month:a,onViewAll:s,className:r}){const{t:n}=f("common"),{currency:i}=d(),{isPrivacyMode:o}=m(),{data:x}=g(),{data:p}=N(),[y,j]=l.useState([]),[v,k]=l.useState(!1),[M,_]=l.useState(null),C=l.useMemo(()=>{const e=new Map;return p?(p.expense.forEach(t=>{const a=t.children.map(e=>e.name);e.set(t.name,a)}),p.income.forEach(t=>{const a=t.children.map(e=>e.name);e.set(t.name,a)}),e):e},[p]),$=l.useMemo(()=>{const e=C.get(t)||[];return[t,...e]},[t,C]);l.useEffect(()=>{let e=!0;return async function(){k(!0),_(null);try{const[e,t]=a.split("-").map(Number),s=new Date(e,t,0).getDate(),r=`${e}-${String(t).padStart(2,"0")}-01`,n=`${e}-${String(t).padStart(2,"0")}-${String(s).padStart(2,"0")}`,l=(await h({categories:$,start_date:r,end_date:n,type:"expense"})).filter(e=>!e.is_transfer),d=(null==x?void 0:x.rates)||{},i=l.map(e=>({...e,amountJpy:K(Math.abs(e.amount),e.currency||"JPY",d)})).sort((e,t)=>t.amountJpy-e.amountJpy);j(i.slice(0,5).map(({amountJpy:e,...t})=>t))}catch(t){e&&_("Failed to load transactions")}finally{e&&k(!1)}}(),()=>{e=!1}},[t,a,$]);const D=e=>{const t=new Date(e),a=new Date,s=new Date(a);return s.setDate(s.getDate()-1),t.toDateString()===a.toDateString()?n("today"):t.toDateString()===s.toDateString()?n("previous"):b(e,"MMM d")};return v?e.jsx("div",{className:`py-4 px-4 ${r||""}`,children:e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(w,{className:"w-5 h-5 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:n("loading")})]})}):M?e.jsx("div",{className:`py-4 px-4 ${r||""}`,children:e.jsx("p",{className:"text-sm text-red-500 text-center",children:M})}):0===y.length?e.jsxs("div",{className:`py-4 px-4 ${r||""}`,children:[e.jsx("p",{className:"text-sm text-gray-500 text-center mb-2",children:n("transactions.noData")}),e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Category: ",t]}),e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Month: ",a]})]}):e.jsxs("div",{className:`py-4 px-4 space-y-2 ${r||""}`,children:[y.map(t=>{return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-16 flex-shrink-0",children:D(t.date)}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100 truncate flex-1",children:(s=t.description,s.length>20?s.substring(0,18)+"...":s)})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4 flex-shrink-0",children:(a=t.amount,u(a,i,(null==x?void 0:x.rates)||{},!0,o))})]},t.id);var a,s}),s&&y.length>0&&e.jsxs(c,{variant:"ghost",size:"sm",onClick:s,className:"w-full mt-3 flex items-center justify-center gap-1 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:[e.jsx("span",{children:n("dashboard.viewAllCategories")}),e.jsx(S,{className:"w-3 h-3"})]})]})}function H({allocation:t,trackingItem:a,totalBudget:s,month:r,isExpanded:n,onToggleExpand:l,onOpenDetail:c,className:o}){const{t:x}=f("common"),{currency:h}=d(),{isPrivacyMode:b}=m(),{data:y}=g(),j=e=>u(e,h,(null==y?void 0:y.rates)||{},!0,b),N=(null==a?void 0:a.spent)||0,v=(null==a?void 0:a.budgeted)||t.amount,k=v-N,w=s>0?t.amount/s*100:0,S=v>0?N/v*100:0,D=a&&("red"===a.status||"orange"===a.status);return e.jsxs(i,{className:p("overflow-hidden",n&&"border-blue-300 dark:border-blue-700",o),children:[e.jsxs("button",{onClick:()=>l(t.category),className:"w-full p-4 text-left hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.category}),D&&e.jsx(M,{className:"w-4 h-4 text-amber-500 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 whitespace-nowrap",children:j(t.amount)}),n?e.jsx(_,{className:"w-5 h-5 text-gray-400"}):e.jsx(C,{className:"w-5 h-5 text-gray-400"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:p("h-full rounded-full transition-all duration-500",w>100?"bg-red-500":w>90?"bg-amber-500":"bg-blue-500"),style:{width:`${Math.min(100,w)}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:[w.toFixed(0),"%"]})]})]}),a&&e.jsxs("div",{className:"px-4 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:x("budget.spentOfBudgeted",{budgeted:j(v)})}),e.jsx("span",{className:p("font-medium",k>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:k>=0?j(k):`-${j(Math.abs(k))}`})]}),e.jsx("div",{className:"mt-1.5 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:p("h-full rounded-full transition-all duration-500","red"===a.status?"bg-red-500":"orange"===a.status?"bg-orange-500":"yellow"===a.status?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,S)}%`}})})]}),e.jsx("div",{className:"hidden lg:flex px-4 pb-3",children:e.jsxs("button",{onClick:()=>c(t.category),className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:x("viewDetails")})]})}),e.jsx("div",{className:p("lg:hidden transition-all duration-300 ease-out",n?"max-h-[500px] opacity-100":"max-h-0 opacity-0 overflow-hidden"),children:e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700",children:e.jsx(G,{category:t.category,month:r,onViewAll:()=>c(t.category)})})})]})}function W(e,t,a){if("JPY"===t)return e;const s=a[t];return s&&0!==s?Math.round(e/s):e}function X({category:a,month:s,trackingItem:r,isOpen:n,onClose:i,className:o}){const{t:x}=f("common"),y=t(),{currency:j}=d(),{isPrivacyMode:_}=m(),{data:C}=g(),{data:$}=N(),[B,E]=l.useState([]),[F,I]=l.useState(!1),[L,T]=l.useState(null),[J,R]=l.useState(null),q=e=>u(e,j,(null==C?void 0:C.rates)||{},!0,_),A=l.useMemo(()=>{const e=new Map;return $?($.expense.forEach(t=>{const a=t.children.map(e=>e.name);e.set(t.name,a)}),$.income.forEach(t=>{const a=t.children.map(e=>e.name);e.set(t.name,a)}),e):e},[$]),O=l.useMemo(()=>{const e=A.get(a)||[];return[a,...e]},[a,A]);l.useEffect(()=>{if(!n)return;let e=!0;return async function(){I(!0),T(null);try{const[t,a]=s.split("-").map(Number),r=new Date(t,a,0).getDate(),n=`${t}-${String(a).padStart(2,"0")}-01`,l=`${t}-${String(a).padStart(2,"0")}-${String(r).padStart(2,"0")}`,d=await h({categories:O,start_date:n,end_date:l,type:"expense"});if(e){const e=(null==C?void 0:C.rates)||{},t=d.filter(e=>!e.is_transfer).map(t=>({...t,amountJpy:W(Math.abs(t.amount),t.currency||"JPY",e)})).sort((e,t)=>t.amountJpy-e.amountJpy);E(t.slice(0,10).map(({amountJpy:e,...t})=>t))}}catch(t){e&&T("Failed to load transactions")}finally{e&&I(!1)}}(),()=>{e=!1}},[a,s,n,O]),l.useEffect(()=>{if(!n)return;let e=!0;return async function(){try{const[t,a]=s.split("-").map(Number);let r=t,n=a-1;n<1&&(n=12,r-=1);const[l,d]=[r,n],i=new Date(l,d,0).getDate(),c=`${l}-${String(d).padStart(2,"0")}-01`,o=`${l}-${String(d).padStart(2,"0")}-${String(i).padStart(2,"0")}`,x=await h({categories:O,start_date:c,end_date:o,type:"expense"});if(e){const e=(null==C?void 0:C.rates)||{},t=x.filter(e=>!e.is_transfer).reduce((t,a)=>t+W(Math.abs(a.amount),a.currency||"JPY",e),0);R(t)}}catch{}}(),()=>{e=!1}},[a,s,n,O]);const U=()=>{i(),y({to:"/transactions",search:{categories:a,month:s}})},z=(null==r?void 0:r.spent)||0,Y=J?Math.round((z-J)/J*100):null;return n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 dark:bg-black/50 z-40 lg:hidden",onClick:i}),e.jsxs("div",{className:p("fixed right-0 top-0 h-full w-full sm:w-96 bg-white dark:bg-gray-900 shadow-xl z-50","flex flex-col transform transition-transform duration-300 ease-out",n?"translate-x-0":"translate-x-full",o),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(v,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:x("budget.savingsTarget")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:q((null==r?void 0:r.budgeted)||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:x("dashboard.expenses")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:q(z)})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:p("h-full rounded-full transition-all duration-500","red"===(null==r?void 0:r.status)?"bg-red-500":"orange"===(null==r?void 0:r.status)?"bg-orange-500":"yellow"===(null==r?void 0:r.status)?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,(null==r?void 0:r.percentage)||0)}%`}})}),null!==Y&&e.jsxs("div",{className:p("flex items-center gap-2 text-sm",Y>0?"text-red-600 dark:text-red-400":Y<0?"text-green-600 dark:text-green-400":"text-gray-500"),children:[Y>0?e.jsx(D,{className:"w-4 h-4"}):Y<0?e.jsx(P,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[Y>0?"+":"",Y,"% vs last month (",q(J||0),")"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:x("dashboard.recentTransactions")}),F?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(w,{className:"w-6 h-6 animate-spin text-gray-400"})}):L?e.jsxs("div",{className:"flex items-center gap-2 text-red-500 py-4",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{children:L})]}):0===B.length?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:x("transactions.noData")}):e.jsxs("div",{className:"space-y-3",children:[B.map(t=>{return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:t.description}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:(a=t.date,b(a,"MMM d"))})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 ml-4",children:q(t.amount)})]},t.id);var a}),B.length>=10&&e.jsxs(c,{variant:"ghost",size:"sm",onClick:U,className:"w-full flex items-center justify-center gap-1 mt-2",children:[e.jsx("span",{children:x("dashboard.viewAllCategories")}),e.jsx(S,{className:"w-3 h-3"})]})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs(c,{onClick:()=>{i()},className:"w-full flex items-center justify-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:x("transaction.addTransaction")})]}),e.jsx(c,{variant:"outline",onClick:U,className:"w-full",children:e.jsx("span",{children:x("transactions.viewAll")})})]})]})]}):null}function Q({spent:t,projected:a,budget:s,className:r}){const n=Math.min(100,t/s*100),l=Math.min(100,a/s*100),d=Math.max(0,l-n);return e.jsxs("div",{className:p("relative h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",r),children:[e.jsx("div",{className:"absolute left-0 top-0 h-full bg-blue-500 transition-all duration-500",style:{width:`${n}%`}}),d>0&&e.jsx("div",{className:p("absolute top-0 h-full border-l-2 border-white/50",l>100?"bg-red-500":l>90?"bg-amber-500":"bg-green-500","transition-all duration-500"),style:{width:`${d}%`}}),e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-gray-400 dark:bg-gray-500",style:{left:"100%"}})]})}function Z({totalBudget:t,totalSpent:a,month:s,className:r}){const{t:n}=f("common"),{currency:c}=d(),{isPrivacyMode:o}=m(),{data:x}=g(),h=e=>u(e,c,(null==x?void 0:x.rates)||{},!1,o),{daysRemaining:b,dailyRate:y,projectedTotal:j,projectedPercent:N,status:v}=l.useMemo(()=>{const[e,r]=s.split("-").map(Number),n=new Date(e,r,0).getDate(),l=(new Date).getDate(),d=Math.max(1,l),i=Math.max(0,n-l),c=a/d,o=a+c*i,x=t>0?o/t*100:0;let m;return m=x>100?"danger":x>90?"warning":"good",{daysRemaining:i,dailyRate:c,projectedTotal:o,projectedPercent:x,status:m}},[s,a,t]),k=(()=>{switch(v){case"danger":return{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-400",icon:M,label:n("budget.projection.status.overBudget"),message:n("budget.projection.overBy",{amount:h(j-t)})};case"warning":return{bg:"bg-amber-100 dark:bg-amber-900/30",text:"text-amber-700 dark:text-amber-400",icon:M,label:n("budget.projection.status.atRisk"),message:n("budget.projection.atPace",{amount:h(j)})};default:return{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-400",icon:E,label:n("budget.projection.status.onTrack"),message:n("budget.projection.underBy",{amount:h(t-j)})}}})(),w=k.icon;return t<=0?null:e.jsxs(i,{className:p("overflow-hidden",r),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("budget.projection.title")})]}),e.jsxs("div",{className:p("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",k.bg,k.text),children:[e.jsx(w,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:k.label})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:n("budget.projection.daysLeft",{count:b})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:n("budget.projection.spent")}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:h(a)})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:n("budget.projection.dailyRate")}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:[h(y),e.jsxs("span",{className:"text-xs font-normal text-gray-500",children:["/",n("day")]})]})]}),e.jsxs("div",{className:p("text-center p-3 rounded-lg","danger"===v?"bg-red-50 dark:bg-red-900/20":"warning"===v?"bg-amber-50 dark:bg-amber-900/20":"bg-green-50 dark:bg-green-900/20"),children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:n("budget.projection.projected")}),e.jsx("p",{className:p("text-lg font-bold","danger"===v?"text-red-700 dark:text-red-400":"warning"===v?"text-amber-700 dark:text-amber-400":"text-green-700 dark:text-green-400"),children:h(j)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:n("budget.projection.percentOfBudget",{percent:Math.round(N)})}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[h(t)," ",n("budget.projection.ofBudget")]})]}),e.jsx(Q,{spent:a,projected:j,budget:t}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 dark:text-gray-500 mt-1",children:[e.jsx("span",{children:h(a)}),e.jsx("span",{children:h(t)})]})]}),e.jsxs("div",{className:p("flex items-start gap-2 p-3 rounded-lg text-sm",k.bg),children:[e.jsx($,{className:p("w-4 h-4 mt-0.5 flex-shrink-0",k.text)}),e.jsx("p",{className:k.text,children:k.message})]})]})]})}async function ee(e){return(await y.get(`/api/budgets/${e}`)).data}async function te(){return(await y.get("/api/budgets/suggestions")).data}function ae({className:t}){return e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}const se=n("/budget")({component:function(){var t;const{t:n,i18n:o}=f("common"),x=a(),{currency:h}=d(),{isPrivacyMode:b}=m(),{data:N}=g(),[v,w]=l.useState(!1),[S,_]=l.useState(null),[C,$]=l.useState(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}),[P,B]=l.useState([]),[E,U]=l.useState(!1),[K,G]=l.useState(null),[W,Q]=l.useState(null),se=l.useCallback(e=>{G(t=>t===e?null:e)},[]),{showBudgetCreatedXP:re}=O(),ne=l.useCallback(e=>{Q(e)},[]),le=l.useCallback(()=>{Q(null)},[]),de=e=>u(e,h,(null==N?void 0:N.rates)||{},!0,b),ie=l.useCallback(e=>{$(t=>{const[a,s]=t.split("-").map(Number);let r=a,n=s;return"prev"===e?(n-=1,n<1&&(n=12,r-=1)):(n+=1,n>12&&(n=1,r+=1)),`${r}-${String(n).padStart(2,"0")}`})},[]),{data:ce,isLoading:oe,error:xe}=s({queryKey:["budget","month",C],queryFn:async()=>{var e;try{return await ee(C)}catch(t){if(404===(null==(e=null==t?void 0:t.response)?void 0:e.status))return null;throw t}},retry:!1}),{data:me}=s({queryKey:["budget","previous-month",C],queryFn:async()=>{const[e,t]=C.split("-").map(Number);let a=e,s=t-1;s<1&&(s=12,a-=1);const r=`${a}-${String(s).padStart(2,"0")}`;try{return await ee(r)}catch{return null}},enabled:!!ce,staleTime:3e5}),{data:ge}=s({queryKey:["budget","tracking",C],queryFn:async()=>{var e;try{return await async function(){return(await y.get("/api/budgets/tracking/current")).data}()}catch(t){if(404===(null==(e=null==t?void 0:t.response)?void 0:e.status))return null;throw t}},retry:!1,enabled:!!ce}),{data:ue}=s({queryKey:["budget","suggestions"],queryFn:te,enabled:!ce&&!oe}),he=r({mutationFn:e=>async function(e){return(await y.post("/api/budgets/generate",e)).data}({monthly_income:e,language:o.language}),onSuccess:e=>{_(e),pe("generate",e),re()}}),be=r({mutationFn:e=>async function(e,t){return(await y.post(`/api/budgets/${e}/regenerate`,t)).data}((S||ce).id,{feedback:e,language:o.language}),onSuccess:e=>{_(e),w(!1),pe("regenerate",e)}}),pe=l.useCallback((e,t)=>{B(a=>[...a.slice(-9),{action:e,data:t}])},[]),ye=l.useCallback(()=>{if(0===P.length)return;const e=P[P.length-1];_(e.data),B(e=>e.slice(0,-1))},[P]),je=S||ce,fe=!!S,Ne=(null==je?void 0:je.allocations.reduce((e,t)=>e+t.amount,0))||0,ve=((null==je?void 0:je.monthly_income)||0)-((null==je?void 0:je.savings_target)||0),ke=ve-Ne,we=(null==ge?void 0:ge.total_spent)||0,Se=Ne>0?we/Ne*100:0,Me=we>Ne?{status:"danger",label:n("budget.health.overBudgetStatus"),color:"text-red-600 dark:text-red-400",bg:"bg-red-100 dark:bg-red-900/30"}:Se>95?{status:"warning",label:n("budget.health.almostFull"),color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-100 dark:bg-amber-900/30"}:Se>85?{status:"caution",label:n("budget.health.warningNearLimit"),color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-100 dark:bg-yellow-900/30"}:{status:"good",label:n("budget.health.onTrack"),color:"text-green-600 dark:text-green-400",bg:"bg-green-100 dark:bg-green-900/30"},_e=l.useCallback(()=>{if(!je)return;const e=`${n("budget.title")} - ${je.month}\n${n("budget.monthlyIncome")}: ${de(je.monthly_income)}\n${n("budget.savingsTarget")}: ${de(je.savings_target||0)}\n\n${n("budget.allocations")}:\n${je.allocations.map(e=>`- ${e.category}: ${de(e.amount)}`).join("\n")}\n\n${n("budget.aiAdvice")}: ${je.advice||"-"}\n`,t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`budget-${je.month}.txt`,s.click(),URL.revokeObjectURL(a)},[je,n]);return oe?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(j,{})}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:()=>ie("prev"),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(e=>{const[t,a]=e.split("-");return new Date(parseInt(t),parseInt(a)-1).toLocaleDateString(o.language,{month:"long",year:"numeric"})})(C)}),e.jsx("button",{onClick:()=>ie("next"),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",disabled:C>=(new Date).toISOString().slice(0,7),children:e.jsx(I,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:n("budget.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("budget.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P.length>0&&e.jsx("button",{onClick:ye,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",title:n("undo"),children:e.jsx(L,{className:"w-5 h-5"})}),je&&e.jsx("button",{onClick:_e,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",title:n("export"),children:e.jsx(T,{className:"w-5 h-5"})})]})]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[!je&&!xe&&e.jsx(z,{onGenerate:e=>he.mutate(e),isLoading:he.isPending,error:he.isError,suggestions:ue}),je&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:p("p-4 rounded-xl border",Me.bg,Me.color,"border-current/20"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:p("w-10 h-10 rounded-full flex items-center justify-center","danger"===Me.status?"bg-red-500":"warning"===Me.status?"bg-amber-500":"caution"===Me.status?"bg-yellow-500":"bg-green-500"),children:"danger"===Me.status?e.jsx(M,{className:"w-5 h-5 text-white"}):e.jsx(D,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:Me.label}),e.jsx("p",{className:"text-sm opacity-80",children:n("budget.usedOfTotal",{used:de(we),total:de(Ne)})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(Se),"%"]}),e.jsx("p",{className:"text-xs opacity-70",children:n("budget.budgetUsed")})]})]})}),e.jsx(Z,{totalBudget:ve,totalSpent:we,month:C}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(i,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(J,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:n("budget.monthlyIncome")})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:de(je.monthly_income)}),me&&je.monthly_income-me.monthly_income!==0&&e.jsxs("p",{className:p("text-xs mt-1",je.monthly_income>me.monthly_income?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[je.monthly_income>me.monthly_income?"+":"",de(je.monthly_income-me.monthly_income)]})]}),e.jsxs(i,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-pink-100 dark:bg-pink-900/30 rounded-lg",children:e.jsx(R,{className:"w-4 h-4 text-pink-600 dark:text-pink-400"})}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:n("budget.savingsTarget")})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:de(je.savings_target||0)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("budget.percentOfIncome",{percent:Math.round((je.savings_target||0)/je.monthly_income*100)})})]}),e.jsxs(i,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(q,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:n("budget.remaining")})]}),e.jsxs("p",{className:p("text-xl font-bold",ke>=0?"text-blue-600 dark:text-blue-400":"text-red-600 dark:text-red-400"),children:[de(Math.abs(ke)),ke<0&&"!"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n(ke>=0?"budget.availableToSpend":"budget.overAllocated")})]})]}),ge&&e.jsxs(i,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("budget.spendingProgress")}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[de(we)," / ",de(Ne)]})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:p("h-full rounded-full transition-all duration-500",we>Ne?"bg-red-500":we>.9*Ne?"bg-amber-500":we>.8*Ne?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,we/Ne*100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[Math.round(we/Ne*100),"%"]}),e.jsxs("span",{children:[ge.days_remaining," ",n("budget.daysLeft")]})]})]}),ge&&ge.categories&&ge.categories.length>0&&e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3",children:n("budget.spendingByCategory")}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",children:ge.categories.slice(0,10).map((t,a)=>e.jsxs("div",{className:"flex-shrink-0 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg min-w-[120px]",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t.category}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:de(t.spent)}),e.jsx("div",{className:"mt-1 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:p("h-full rounded-full","red"===t.status?"bg-red-500":"orange"===t.status?"bg-orange-500":"yellow"===t.status?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(100,t.percentage)}%`}})})]},a))})]}),fe&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>w(!v),className:"flex-1",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),n("budget.regenerate")]}),e.jsxs(c,{onClick:async()=>{await x.refetchQueries({queryKey:["budget"]}),_(null)},className:"flex-1",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),n("budget.save")]})]}),v&&e.jsx(Y,{onSubmit:e=>be.mutate(e),onCancel:()=>w(!1),isLoading:be.isPending}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("budget.allocations")}),fe&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>U(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),n("budget.addCategory")]})]}),je.allocations.map(t=>{var a;const s=null==(a=null==ge?void 0:ge.categories)?void 0:a.find(e=>e.category===t.category);return e.jsx(H,{allocation:t,trackingItem:s,totalBudget:ve,month:C,isExpanded:K===t.category,onToggleExpand:se,onOpenDetail:ne,className:fe?"border-dashed border-blue-300 dark:border-blue-700":""},t.category)}),je.advice&&e.jsx(i,{className:"p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/50 rounded-lg",children:e.jsx(D,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200 mb-1",children:n("budget.aiAdvice")}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:je.advice})]})]})})]}),xe&&e.jsx(i,{className:"p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:xe instanceof Error?xe.message:n("budget.generateError")})}),E&&je&&e.jsx(V,{budget:je,onClose:()=>U(!1),onAdd:(e,t)=>{const a=[...je.allocations,{category:e,amount:t}],s=a.reduce((e,t)=>e+t.amount,0),r=Math.max(0,je.monthly_income-s);_({...je,allocations:a,savings_target:r}),U(!1),pe("add-category",je)}})]}),je&&fe&&e.jsx("div",{className:"fixed bottom-20 right-4 sm:hidden",children:e.jsx(c,{size:"lg",className:"rounded-full shadow-lg",onClick:()=>U(!0),children:e.jsx(k,{className:"w-6 h-6"})})}),e.jsx(X,{category:W||"",month:C,trackingItem:W?null==(t=null==ge?void 0:ge.categories)?void 0:t.find(e=>e.category===W):void 0,isOpen:!!W,onClose:le})]})}});export{se as Route};
