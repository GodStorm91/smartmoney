var Ve=t=>{throw TypeError(t)};var Pe=(t,s,r)=>s.has(t)||Ve("Cannot "+r);var $=(t,s,r)=>(Pe(t,s,"read from private field"),r?r.call(t):s.get(t)),Y=(t,s,r)=>s.has(t)?Ve("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,r),H=(t,s,r,a)=>(Pe(t,s,"write to private field"),a?a.call(t,r):s.set(t,r),r),G=(t,s,r)=>(Pe(t,s,"access private method"),r);import{bt as vt,bu as Te,bv as kt,bw as Nt,bx as it,J as re,by as wt,bz as _t,r as g,bA as Ct,bB as St,bC as Ft,bD as Rt,bE as We,bF as Je,bG as Mt,bH as At,l as ae,u as X,z as Dt,N as lt,M as Ce,j as e,C as ge,m as I,a9 as te,bI as Pt,bJ as qt,bK as Lt,Y as Se,y as Fe,a0 as ot,D as K,a4 as V,F as he,at as ke,p as dt,R as se,T as Tt,I as Ye,B as ye,P as Ke,am as Et,s as oe,g as pe,aB as Re,q as Qe,aU as Ee,L as Ne,X as de,H as Me,aF as ct,aI as $t,K as It,aX as Ot,aT as ve,aA as Bt,a2 as mt,az as zt,af as ce,ah as Kt,ad as Qt,k as Ht}from"./index-CMhZ0AeY.js";import{f as qe,p as Le,T as Ut,R as Vt}from"./TransactionFormModal-DTJCCQ4z.js";import{c as Wt,d as Jt,s as Yt,C as we,e as _e,f as xt,h as Gt,i as Xt,j as ut,k as gt,l as ht,m as yt,n as Zt,o as es,p as ts,q as ss,r as rs,t as as,u as pt,v as bt}from"./crypto-B5c4deJE.js";import{E as He}from"./BudgetInsightWidget-C2-BYjow.js";import{C as Ae}from"./chevron-down-W9Dg7Szt.js";import{R as ns,B as is}from"./generateCategoricalChart-hxoA5Skj.js";import{a as ls,C as os,L as ds}from"./LineChart-Pxm1q5nR.js";import{X as cs,Y as ms}from"./YAxis-DNljwm6V.js";import{C as ft}from"./chevron-up-DBzPWCGt.js";import{C as xs}from"./clock-CPD29x4z.js";import{T as us}from"./triangle-alert-BhocYSu_.js";import{a as Ge,S as Xe}from"./square-DENVSs1d.js";import"./recurring-service-Dw_yb7TG.js";import"./RecurringOptions-L-GRewfn.js";import"./useXPGain-DilDYHqH.js";import"./useCategories-DewlN4mD.js";function Ze(t,s){const r=new Set(s);return t.filter(a=>!r.has(a))}function gs(t,s,r){const a=t.slice(0);return a[s]=r,a}var ne,U,ie,le,J,ee,be,fe,je,z,$e,Ie,Oe,Be,ze,nt,hs=(nt=class extends vt{constructor(s,r,a){super();Y(this,z);Y(this,ne);Y(this,U);Y(this,ie);Y(this,le);Y(this,J);Y(this,ee);Y(this,be);Y(this,fe);Y(this,je,[]);H(this,ne,s),H(this,le,a),H(this,ie,[]),H(this,J,[]),H(this,U,[]),this.setQueries(r)}onSubscribe(){this.listeners.size===1&&$(this,J).forEach(s=>{s.subscribe(r=>{G(this,z,Be).call(this,s,r)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,$(this,J).forEach(s=>{s.destroy()})}setQueries(s,r){H(this,ie,s),H(this,le,r),Te.batch(()=>{const a=$(this,J),c=G(this,z,Oe).call(this,$(this,ie));H(this,je,c),c.forEach(b=>b.observer.setOptions(b.defaultedQueryOptions));const i=c.map(b=>b.observer),n=i.map(b=>b.getCurrentResult()),y=a.length!==i.length,j=i.some((b,N)=>b!==a[N]),k=y||j,S=k?!0:n.some((b,N)=>{const u=$(this,U)[N];return!u||!kt(b,u)});!k&&!S||(k&&H(this,J,i),H(this,U,n),this.hasListeners()&&(k&&(Ze(a,i).forEach(b=>{b.destroy()}),Ze(i,a).forEach(b=>{b.subscribe(N=>{G(this,z,Be).call(this,b,N)})})),G(this,z,ze).call(this)))})}getCurrentResult(){return $(this,U)}getQueries(){return $(this,J).map(s=>s.getCurrentQuery())}getObservers(){return $(this,J)}getOptimisticResult(s,r){const a=G(this,z,Oe).call(this,s),c=a.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[c,i=>G(this,z,Ie).call(this,i??c,r),()=>G(this,z,$e).call(this,c,a)]}},ne=new WeakMap,U=new WeakMap,ie=new WeakMap,le=new WeakMap,J=new WeakMap,ee=new WeakMap,be=new WeakMap,fe=new WeakMap,je=new WeakMap,z=new WeakSet,$e=function(s,r){return r.map((a,c)=>{const i=s[c];return a.defaultedQueryOptions.notifyOnChangeProps?i:a.observer.trackResult(i,n=>{r.forEach(y=>{y.observer.trackProp(n)})})})},Ie=function(s,r){return r?((!$(this,ee)||$(this,U)!==$(this,fe)||r!==$(this,be))&&(H(this,be,r),H(this,fe,$(this,U)),H(this,ee,Nt($(this,ee),r(s)))),$(this,ee)):s},Oe=function(s){const r=new Map;$(this,J).forEach(c=>{const i=c.options.queryHash;if(!i)return;const n=r.get(i);n?n.push(c):r.set(i,[c])});const a=[];return s.forEach(c=>{var j;const i=$(this,ne).defaultQueryOptions(c),y=((j=r.get(i.queryHash))==null?void 0:j.shift())??new it($(this,ne),i);a.push({defaultedQueryOptions:i,observer:y})}),a},Be=function(s,r){const a=$(this,J).indexOf(s);a!==-1&&(H(this,U,gs($(this,U),a,r)),G(this,z,ze).call(this))},ze=function(){var s;if(this.hasListeners()){const r=$(this,ee),a=G(this,z,$e).call(this,$(this,U),$(this,je)),c=G(this,z,Ie).call(this,a,(s=$(this,le))==null?void 0:s.combine);r!==c&&Te.batch(()=>{this.listeners.forEach(i=>{i($(this,U))})})}},nt);function et({queries:t,...s},r){const a=re(),c=wt(),i=_t(),n=g.useMemo(()=>t.map(C=>{const D=a.defaultQueryOptions(C);return D._optimisticResults=c?"isRestoring":"optimistic",D}),[t,a,c]);n.forEach(C=>{Ct(C),St(C,i)}),Ft(i);const[y]=g.useState(()=>new hs(a,n,s)),[j,k,S]=y.getOptimisticResult(n,s.combine),b=!c&&s.subscribed!==!1;g.useSyncExternalStore(g.useCallback(C=>b?y.subscribe(Te.batchCalls(C)):Rt,[y,b]),()=>y.getCurrentResult(),()=>y.getCurrentResult()),g.useEffect(()=>{y.setQueries(n,s)},[n,s,y]);const u=j.some((C,D)=>We(n[D],C))?j.flatMap((C,D)=>{const R=n[D];if(R){const h=new it(a,R);if(We(R,C))return Je(R,h,i);Mt(C,c)&&Je(R,h,i)}return[]}):[];if(u.length>0)throw Promise.all(u);const M=j.find((C,D)=>{const R=n[D];return R&&At({result:C,errorResetBoundary:i,throwOnError:R.throwOnError,query:a.getQueryCache().get(R.queryHash),suspense:R.suspense})});if(M!=null&&M.error)throw M.error;return k(S())}/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],ps=ae("archive",ys);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],fs=ae("arrow-down-right",bs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],vs=ae("arrow-right-left",js);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],Ns=ae("arrow-up-right",ks);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],Ue=ae("gift",ws);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Cs=ae("layers",_s);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Fs=ae("percent",Ss),Rs={bank:{icon:"ðŸ¦",color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/30"},cash:{icon:"ðŸ’µ",color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/30"},credit_card:{icon:"ðŸ’³",color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/30"},investment:{icon:"ðŸ“ˆ",color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/30"},receivable:{icon:"ðŸ’°",color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/30"},savings:{icon:"ðŸ·",color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/30"},crypto:{icon:"â‚¿",color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/30"},other:{icon:"ðŸ“",color:"text-gray-600",bgColor:"bg-gray-50 dark:bg-gray-700"}};function Ms({account:t,onEdit:s,onAddTransaction:r}){const{t:a}=X("common"),c=Dt(),{data:i}=lt(),{isPrivacyMode:n}=Ce(),y=Rs[t.type],j=t.current_balance>=0,k=()=>{const b=new Date,N=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;c({to:"/transactions",search:{accountId:t.id,month:N,fromAccounts:!0}})},S=b=>{b.stopPropagation(),r==null||r(t.id)};return e.jsxs(ge,{className:"relative hover:shadow-md transition-shadow cursor-pointer",onClick:k,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:I("p-3 rounded-lg",y.bgColor),children:e.jsx("span",{className:"text-2xl",children:y.icon})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:I("text-sm",y.color),children:a(`account.type.${t.type}`)})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("transaction.addTransaction"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-green-600 dark:text-green-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),s&&e.jsx("button",{onClick:b=>{b.stopPropagation(),s(t.id)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a("account.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),!t.is_active&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:a("account.inactive")})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:a("account.currentBalance")}),e.jsx("p",{className:I("text-3xl font-bold font-mono",j?"text-green-600":"text-red-600"),children:te(t.current_balance,t.currency,(i==null?void 0:i.rates)||{},!0,n)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("account.initialBalance")}),e.jsx("p",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:te(t.initial_balance,t.currency,(i==null?void 0:i.rates)||{},!0,n)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("account.transactions")}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:t.transaction_count})]})]}),t.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:a("account.notes")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.notes})]})]})}const me=t=>t==="USD"?100:1;function As({isOpen:t,onClose:s,editingAccountId:r}){const{t:a}=X("common"),c=Pt(),i=qt(),{data:n}=Lt(r||void 0),y=Se(),{isPrivacyMode:j}=Ce(),[k,S]=g.useState(""),[b,N]=g.useState("bank"),[u,M]=g.useState(""),[C,D]=g.useState(""),[R,h]=g.useState("JPY"),[w,p]=g.useState(""),[v,_]=g.useState({}),[q,L]=g.useState(""),[x,m]=g.useState(!1),d=["bank","cash","credit_card","investment","receivable","savings","other"],A=n&&n.transaction_count>0,T=(()=>{if(!n||!q)return null;const P=me(n.currency),f=parseFloat(q)*P,o=n.current_balance;return f-o})();g.useEffect(()=>{if(t){if(r&&n)if(S(n.name),N(n.type),p(n.notes||""),h(n.currency),A)L(""),m(!1);else{const P=me(n.currency);M((n.initial_balance/P).toString()),D(n.initial_balance_date)}else S(""),N("bank"),M("0"),D(new Date().toISOString().split("T")[0]),h("JPY"),p(""),L(""),m(!1);_({})}},[t,r,n,A]);const l=()=>{const P={};return k.trim()||(P.name=a("account.errors.nameRequired")),r?r&&!A&&(C||(P.initialBalanceDate=a("account.errors.dateRequired"))):C||(P.initialBalanceDate=a("account.errors.dateRequired")),_(P),Object.keys(P).length===0},F=async P=>{if(P.preventDefault(),!!l()){if(r&&A&&q&&!x){m(!0);return}try{if(r){const f={name:k.trim(),type:b,notes:w.trim()||void 0};if(!A&&n){const o=me(n.currency);f.initial_balance=Math.round(parseFloat(u||"0")*o),f.initial_balance_date=C}if(A&&q&&n){const o=me(n.currency);f.desired_current_balance=Math.round(parseFloat(q)*o)}await i.mutateAsync({id:r,data:f})}else{const f=me(R),o={name:k.trim(),type:b,initial_balance:Math.round(parseFloat(u||"0")*f),initial_balance_date:C,currency:R,notes:w.trim()||void 0};await c.mutateAsync(o)}s()}catch(f){_({submit:f.message||a("account.errors.submitFailed")})}}};if(!t)return null;const Z=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:a(r?"account.editAccount":"account.createAccount")}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.name")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",value:k,onChange:P=>S(P.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",v.name?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:a("account.namePlaceholder")}),v.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.accountType")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"type",value:b,onChange:P=>N(P.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:d.map(P=>e.jsx("option",{value:P,children:a(`account.type.${P}`)},P))})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:qe(u),onChange:P=>M(Le(P.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:C,onChange:P=>D(P.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",v.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),v.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.initialBalanceDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.currency")}),e.jsxs("select",{id:"currency",value:R,onChange:P=>h(P.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"VND",children:"VND (â‚«)"})]})]})]}),r&&!A&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:qe(u),onChange:P=>M(Le(P.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:C,onChange:P=>D(P.target.value),className:I("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",v.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),v.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.initialBalanceDate})]})]}),r&&A&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:a("account.currentBalance")}),e.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-200",children:te(n.current_balance,n.currency,y,!0,j)})]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:a("account.hasTransactionsInfo",{count:n.transaction_count})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"desiredBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.desiredCurrentBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"desiredBalance",value:qe(q),onChange:P=>{L(Le(P.target.value)),m(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:a("account.desiredBalancePlaceholder")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a("account.reconcileHint")})]}),T!==null&&T!==0&&e.jsx("div",{className:I("border rounded-lg p-4",T>0?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:I("text-sm font-medium",T>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:a("account.adjustmentAmount")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:I("text-lg font-bold",T>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:T>0?"â†‘":"â†“"}),e.jsx("span",{className:I("text-lg font-bold",T>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:te(Math.abs(T),n.currency,y,!0,j)})]})]})}),x&&T!==null&&T!==0&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-200",children:a("account.adjustmentConfirmTitle")}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:a("account.adjustmentConfirmMessage",{amount:te(Math.abs(T),n.currency,y,!0,j)})})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.notes")}),e.jsx("textarea",{id:"notes",value:w,onChange:P=>p(P.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:a("account.notesPlaceholder")})]}),v.submit&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:v.submit})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[x&&e.jsx("button",{type:"button",onClick:()=>{m(!1),L("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("account.cancelAdjustment")}),!x&&e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("cancel")}),e.jsx("button",{type:"submit",disabled:c.isPending||i.isPending,className:I("flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",x?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:c.isPending||i.isPending?a("saving"):a(x?"account.confirmAdjustment":r?"update":"create")})]})]})]})]});return typeof document>"u"?null:Fe.createPortal(Z,document.body)}const Ds=["eth","bsc","polygon"];function tt({token:t,isPrivacyMode:s}){return e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.logo_url?e.jsx("img",{src:t.logo_url,alt:t.symbol,className:"w-5 h-5 rounded-full",onError:r=>{r.target.style.display="none"}}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-[10px] font-medium",children:t.symbol.slice(0,2)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate",children:t.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:s?"***":Number(t.balance)<1e-4?"<0.0001":Number(t.balance).toFixed(4)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s?"$***":`$${Number(t.balance_usd).toFixed(2)}`})]})]})}function st(){const{t}=X("common"),s=re(),{currency:r}=ot(),{isPrivacyMode:a}=Ce(),c=Se(),[i,n]=g.useState(!1),[y,j]=g.useState(""),[k,S]=g.useState(""),[b,N]=g.useState(["eth","bsc","polygon"]),[u,M]=g.useState(null),[C,D]=g.useState(null),{data:R,isLoading:h}=K({queryKey:["crypto-wallets"],queryFn:xt}),{data:w}=K({queryKey:["crypto-wallets-balance",R==null?void 0:R.map(f=>f.id)],queryFn:async()=>!R||R.length===0?[]:Promise.all(R.map(f=>Gt(f.id))),enabled:!!R&&R.length>0}),{data:p,isLoading:v}=K({queryKey:["crypto-portfolio",C],queryFn:()=>Xt(C),enabled:!!C}),_=V({mutationFn:Wt,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),n(!1),j(""),S(""),N(["eth","bsc","polygon"])}}),q=V({mutationFn:Jt,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]})}}),L=V({mutationFn:Yt,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]}),s.invalidateQueries({queryKey:["dashboard-summary"]}),M(null)},onError:()=>{M(null)}}),x=()=>{y.trim()&&_.mutate({wallet_address:y.trim(),label:k.trim()||void 0,chains:b})},m=f=>{confirm(t("confirmDelete"))&&q.mutate(f)},d=f=>{M(f),L.mutate(f)},A=f=>{N(o=>o.includes(f)?o.filter(Q=>Q!==f):[...o,f])},O=f=>{D(o=>o===f?null:f)},T=f=>`${f.slice(0,6)}...${f.slice(-4)}`,l=(f,o)=>{const Q={eth:`https://etherscan.io/address/${f}`,bsc:`https://bscscan.com/address/${f}`,polygon:`https://polygonscan.com/address/${f}`,arbitrum:`https://arbiscan.io/address/${f}`,optimism:`https://optimistic.etherscan.io/address/${f}`};return Q[o]||Q.eth},F=(w==null?void 0:w.reduce((f,o)=>f+Number(o.total_balance_usd||0),0))||0,Z=1/((c==null?void 0:c.USD)||.00667),P=Math.round(F*Z);return h?e.jsx(we,{title:t("crypto.wallets"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(he,{size:"md"})})}):e.jsxs(we,{title:t("crypto.wallets"),badge:(R==null?void 0:R.length)||0,defaultOpen:R&&R.length>0,children:[w&&w.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalBalance")}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:te(P,r,c,!1,a)})]}),w&&w.length>0?e.jsx("div",{className:"space-y-3 mb-4",children:w.map(f=>{var o,Q;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(ke,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:f.label||T(f.wallet_address)}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("code",{className:"text-xs",children:T(f.wallet_address)}),e.jsx("a",{href:l(f.wallet_address,"eth"),target:"_blank",rel:"noopener noreferrer",className:"hover:text-purple-500",children:e.jsx(He,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a?"$***":`$${Number(f.total_balance_usd||0).toFixed(2)}`}),e.jsx("div",{className:"flex gap-1 mt-1",children:(o=f.chains)==null?void 0:o.map(E=>{var B;return e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",title:(B=_e[E])==null?void 0:B.name,children:E.toUpperCase()},E)})})]})]}),e.jsxs("button",{onClick:()=>O(f.id),className:"flex items-center gap-2 mt-3 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors",children:[C===f.id?e.jsx(Ae,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"}),t("crypto.tokens")]}),C===f.id&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:v?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(he,{size:"sm"})}):p!=null&&p.chains&&p.chains.length>0?e.jsx("div",{className:"space-y-4",children:p.chains.filter(E=>E.tokens.length>0||E.native_balance).sort((E,B)=>Number(B.total_usd)-Number(E.total_usd)).map(E=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:E.chain_name}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:a?"$***":`$${Number(E.total_usd).toFixed(2)}`})]}),e.jsxs("div",{className:"space-y-1",children:[E.native_balance&&Number(E.native_balance.balance)>0&&e.jsx(tt,{token:E.native_balance,isPrivacyMode:a}),E.tokens.filter(B=>Number(B.balance_usd)>=1).sort((B,De)=>Number(De.balance_usd)-Number(B.balance_usd)).map(B=>e.jsx(tt,{token:B,isPrivacyMode:a},B.token_address))]})]},E.chain_id))}):e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-2",children:t("crypto.noTokens")})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:(Q=f.sync_statuses)!=null&&Q.some(E=>E.last_sync_at)?t("crypto.lastSync",{time:new Date(Math.max(...f.sync_statuses.filter(E=>E.last_sync_at).map(E=>new Date(E.last_sync_at).getTime()))).toLocaleString()}):t("crypto.neverSynced")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(f.id),disabled:u===f.id,className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg transition-colors",title:t("crypto.sync"),children:u===f.id?e.jsx(he,{size:"sm"}):e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>m(f.id),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:t("delete"),children:e.jsx(Tt,{className:"w-4 h-4"})})]})]})]},f.id)})}):i?null:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ke,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:t("crypto.noWallets")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:t("crypto.addWalletDescription")})]}),i?e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(Ye,{label:t("crypto.walletAddress"),placeholder:"0x...",value:y,onChange:f=>j(f.target.value)}),e.jsx(Ye,{label:t("crypto.walletLabel"),placeholder:t("crypto.walletLabelPlaceholder"),value:k,onChange:f=>S(f.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.selectChains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ds.map(f=>{var o;return e.jsx("button",{type:"button",onClick:()=>A(f),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${b.includes(f)?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:((o=_e[f])==null?void 0:o.name)||f.toUpperCase()},f)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(ye,{variant:"outline",onClick:()=>n(!1),children:t("cancel")}),e.jsx(ye,{onClick:x,disabled:!y.trim()||b.length===0||_.isPending,children:_.isPending?t("saving"):t("crypto.addWallet")})]})]}):e.jsxs(ye,{variant:"outline",onClick:()=>n(!0),className:"w-full",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),t("crypto.addWallet")]})]})}function Ps({snapshots:t}){const{resolvedTheme:s}=Et(),r=s==="dark",a=r?"#374151":"#E5E7EB",c=r?"#9CA3AF":"#6B7280",i=r?"#1F2937":"#FFFFFF",n=r?"#374151":"#E5E7EB",y="#6366F1",j=g.useMemo(()=>[...t].sort((b,N)=>new Date(b.snapshot_date).getTime()-new Date(N.snapshot_date).getTime()).map(b=>({date:b.snapshot_date,value:Number(b.balance_usd),formattedDate:new Date(b.snapshot_date).toLocaleDateString(oe(),{month:"short",day:"numeric"})})),[t]),[k,S]=g.useMemo(()=>{const b=j.map(C=>C.value),N=Math.min(...b),u=Math.max(...b),M=(u-N)*.1||10;return[Math.max(0,N-M),u+M]},[j]);return j.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No historical data available"}):e.jsx(ns,{width:"100%",height:"100%",children:e.jsxs(ls,{data:j,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(os,{strokeDasharray:"3 3",stroke:a,vertical:!1}),e.jsx(cs,{dataKey:"formattedDate",tick:{fill:c,fontSize:11},tickLine:!1,axisLine:{stroke:a},interval:"preserveStartEnd"}),e.jsx(ms,{domain:[k,S],tick:{fill:c,fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:b=>`$${b.toFixed(0)}`,width:50}),e.jsx(is,{contentStyle:{backgroundColor:i,border:`1px solid ${n}`,borderRadius:"8px",fontSize:"12px"},labelStyle:{color:c,fontWeight:"bold"},formatter:b=>[`$${b.toFixed(2)}`,"Value"]}),e.jsx(ds,{type:"monotone",dataKey:"value",stroke:y,strokeWidth:2,dot:j.length<=10,activeDot:{r:6,fill:y}})]})})}function qs({positionId:t}){var O,T;const{t:s}=X(),r=re(),[a,c]=g.useState(null),[i,n]=g.useState(!1),[y,j]=g.useState(null),[k,S]=g.useState(null),[b,N]=g.useState(null),{data:u,isLoading:M}=K({queryKey:["position-roi",t],queryFn:()=>yt(t)}),{data:C=[]}=K({queryKey:["position-rewards-list",t],queryFn:()=>Zt(t)}),D=V({mutationFn:()=>ut(90),onSuccess:l=>{c({scanned:l.scanned_claims,new:l.new_claims}),r.invalidateQueries({queryKey:["position-roi"]}),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["unattributed-rewards"]}),setTimeout(()=>c(null),5e3)}}),R=V({mutationFn:l=>gt(l),onSuccess:l=>{S(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:l.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),j(null),setTimeout(()=>S(null),5e3)},onError:l=>{N(l.message||s("crypto.transactionCreateError","Failed to create transaction")),j(null),setTimeout(()=>N(null),5e3)}}),h=V({mutationFn:l=>ht(l),onSuccess:l=>{const F=s("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:l.created,total:l.total_usd.toFixed(2),skipped:l.skipped});S(F),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>S(null),8e3)},onError:l=>{N(l.message||s("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>N(null),5e3)}}),w=C.filter(l=>!l.transaction_id),p=1,v=((O=u==null?void 0:u.rewards_by_token)==null?void 0:O.filter(l=>Number(l.amount_usd)>=p))||[],_=((T=u==null?void 0:u.rewards_by_month)==null?void 0:T.filter(l=>Number(l.amount_usd)>=p))||[],q=C.filter(l=>Number(l.reward_usd||0)>=p),L=v.reduce((l,F)=>l+Number(F.amount_usd||0),0);if(M)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const x=l=>{if(l==null)return null;const F=Number(l);return isNaN(F)?null:`$${F.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},m=l=>{if(l===null)return"-";const F=Number(l);return`${F>=0?"+":""}${F.toFixed(2)}%`},d=l=>{const[F,Z]=l.split("-");return new Date(Number(F),Number(Z)-1).toLocaleDateString(oe(),{month:"short",year:"numeric"})},A=l=>Number(l).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanRewardsHint","Scan blockchain for claimed rewards")}),e.jsx("button",{onClick:()=>D.mutate(),disabled:D.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(pe,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),u&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),s("crypto.roiSummary","ROI Summary")]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),v.length>0?e.jsx("div",{className:"space-y-1",children:v.map(l=>{const F=x(l.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[A(l.amount)," ",l.symbol]}),F&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",F]})]},l.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:x(L)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[q.length," ",s("crypto.claims","claims")]})]}),u.cost_basis_usd!==null&&u.simple_roi_pct!==null&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-green-200 dark:border-green-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.costBasis","Cost Basis")}),e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:x(u.cost_basis_usd)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.roi","ROI")}),e.jsx("div",{className:`text-lg font-semibold ${u.simple_roi_pct>=0?"text-green-800 dark:text-green-200":"text-red-600 dark:text-red-400"}`,children:m(u.simple_roi_pct)}),u.days_held&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[u.days_held," ",s("crypto.daysHeld","days")]})]})]})]})]}),u&&_.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:_.map(l=>{const F=x(l.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:d(l.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[l.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[A(l.amount)," ",l.symbol]}),F&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",F]})]})]},`${l.month}-${l.symbol}`)})})]}),q.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>n(!i),className:"flex items-center gap-2 font-medium text-gray-900 dark:text-gray-100 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[e.jsx(Ee,{className:"h-4 w-4"}),s("crypto.allRewards","All Rewards")," (",q.length,")",i?e.jsx(ft,{className:"h-4 w-4"}):e.jsx(Ae,{className:"h-4 w-4"})]}),w.length>0&&e.jsxs("button",{type:"button",onClick:()=>h.mutate(w.map(l=>l.id)),disabled:h.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 rounded-lg transition-colors",children:[h.isPending?e.jsx(Ne,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(Ke,{className:"h-3.5 w-3.5"}),s("crypto.createAllTransactions","Create All Txns")," (",w.length,")"]})]}),i&&e.jsxs(e.Fragment,{children:[k&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(pe,{className:"h-4 w-4"}),k]}),b&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(de,{className:"h-4 w-4"}),b]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Number(l.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})," ",l.reward_token_symbol||"tokens"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[new Date(l.claimed_at).toLocaleDateString(oe())," via ",l.source,l.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(l.reward_usd).toFixed(2)]})]})]}),l.reward_usd&&Number(l.reward_usd)>0&&e.jsx("div",{className:"flex-shrink-0 ml-3",children:l.transaction_id?e.jsxs("a",{href:`/transactions?id=${l.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(He,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{j(l.id),R.mutate(l.id)},disabled:y===l.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[y===l.id?e.jsx(Ne,{className:"h-3 w-3 animate-spin"}):e.jsx(Ee,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},l.id))})]})]}),u&&q.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ue,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),L<p?s("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:p}):s("crypto.noRewards","No rewards claimed for this position yet.")]})]})}function Ls({source:t="symbiotic"}){var q,L;const{t:s}=X(),r=re(),[a,c]=g.useState(null),[i,n]=g.useState(null),[y,j]=g.useState(null),{data:k,isLoading:S}=K({queryKey:["staking-rewards",t],queryFn:()=>es(t)}),{data:b=[]}=K({queryKey:["all-rewards"],queryFn:ts}),N=b.filter(x=>!x.transaction_id&&x.reward_usd&&Number(x.reward_usd)>0),u=V({mutationFn:()=>ut(90),onSuccess:x=>{c({scanned:x.scanned_claims,new:x.new_claims}),r.invalidateQueries({queryKey:["staking-rewards"]}),r.invalidateQueries({queryKey:["all-rewards"]}),setTimeout(()=>c(null),5e3)}}),M=V({mutationFn:x=>ht(x),onSuccess:x=>{const m=s("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:x.created,total:x.total_usd.toFixed(2),skipped:x.skipped});n(m),r.invalidateQueries({queryKey:["all-rewards"]}),r.invalidateQueries({queryKey:["staking-rewards"]}),r.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>n(null),8e3)},onError:x=>{j(x.message||s("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>j(null),5e3)}});if(S)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const C=x=>{if(x==null)return null;const m=Number(x);return isNaN(m)?null:`$${m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},D=x=>{const[m,d]=x.split("-");return new Date(Number(m),Number(d)-1).toLocaleDateString(oe(),{month:"short",year:"numeric"})},R=x=>Number(x).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4}),h=t==="symbiotic"?"Symbiotic":t,w=1,p=((q=k==null?void 0:k.rewards_by_token)==null?void 0:q.filter(x=>Number(x.amount_usd)>=w))||[],v=((L=k==null?void 0:k.rewards_by_month)==null?void 0:L.filter(x=>Number(x.amount_usd)>=w))||[],_=p.reduce((x,m)=>x+Number(m.amount_usd||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanStakingRewardsHint","Scan blockchain for claimed staking rewards")}),e.jsx("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(pe,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(pe,{className:"h-4 w-4"}),i]}),y&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(de,{className:"h-4 w-4"}),y]}),N.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:s("crypto.unlinkedRewardsHint","{{count}} rewards ready to convert to transactions",{count:N.length})}),e.jsx("button",{onClick:()=>M.mutate(N.map(x=>x.id)),disabled:M.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-amber-600 hover:bg-amber-700 disabled:bg-amber-400 text-white text-sm font-medium rounded-lg transition-colors",children:M.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 animate-spin"}),s("crypto.creating","Creating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-4 w-4"}),s("crypto.createAllTransactions","Create All Txns")," (",N.length,")"]})})]}),k&&p.length>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),s("crypto.stakingRewardsSummary","{{source}} Rewards Summary",{source:h})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),p.length>0?e.jsx("div",{className:"space-y-1",children:p.map(x=>{const m=C(x.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[R(x.amount)," ",x.symbol]}),m&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",m]})]},x.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:C(_)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[v.reduce((x,m)=>x+m.count,0)," ",s("crypto.claims","claims")]})]})})]}),k&&v.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:v.map(x=>{const m=C(x.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:D(x.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[x.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[R(x.amount)," ",x.symbol]}),m&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",m]})]})]},`${x.month}-${x.symbol}`)})})]}),k&&p.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ue,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:_<w?s("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:w}):s("crypto.noStakingRewards","No staking rewards found")}),e.jsx("p",{className:"text-sm",children:s("crypto.noStakingRewardsHint",'Click "Scan Rewards" to search for claimed rewards on the blockchain.')})]})]})}async function Ts(t,s){return(await Me.post(`/api/crypto/positions/${encodeURIComponent(t)}/close`,s)).data}async function Es(){return(await Me.get("/api/crypto/positions/closed")).data}function $s({group:t,lastSnapshotValueUsd:s,costBasisUsd:r,totalRewardsUsd:a,onClose:c,onSuccess:i}){var l;const{t:n}=X("common"),{data:y}=lt(),j=((l=y==null?void 0:y.rates)==null?void 0:l.USD)||150,k=re(),[S,b]=g.useState(new Date().toISOString().slice(0,16)),[N,u]=g.useState(s),[M,C]=g.useState(Math.round(s*j)),[D,R]=g.useState(null),[h,w]=g.useState(`LP Exit: ${t.protocol} ${t.name}`),[p,v]=g.useState("");g.useEffect(()=>{C(Math.round(N*j))},[N,j]);const{data:_}=K({queryKey:["accounts"],queryFn:()=>It()}),q=(_==null?void 0:_.filter(F=>F.is_active&&(F.type==="bank"||F.type==="savings")))||[],L=r!==null?N-r+(a||0):null,x=r&&L!==null?L/r*100:null,m=t.tokens[0],d=(m==null?void 0:m.id)||"",A=(m==null?void 0:m.wallet_address)||"",O=V({mutationFn:()=>{if(!D)throw new Error(n("crypto.selectAccount","Select destination account"));const F={exit_date:new Date(S).toISOString(),exit_value_usd:N,exit_value_jpy:M,destination_account_id:D,note:h||void 0,tx_hash:p||void 0,wallet_address:A,chain_id:t.chain_id,protocol:t.protocol,symbol:t.name};return Ts(d,F)},onSuccess:()=>{k.invalidateQueries({queryKey:["closed-positions"]}),k.invalidateQueries({queryKey:["defi-positions"]}),k.invalidateQueries({queryKey:["accounts"]}),i(),c()}}),T=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-hidden",style:{touchAction:"pan-y"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:c}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:n("crypto.closePosition","Close Position")}),e.jsx("button",{onClick:c,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.protocol," - ",t.name]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.chain_id.toUpperCase()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Qe,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitDate","Exit Date")]}),e.jsx("input",{type:"datetime-local",value:S,onChange:F=>b(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ct,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitValue","Exit Value")," (USD)"]}),e.jsx("input",{type:"number",step:"0.01",value:N,onChange:F=>u(parseFloat(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("crypto.exitValue","Exit Value")," (JPY)"]}),e.jsx("input",{type:"number",value:M,onChange:F=>C(parseInt(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ke,{className:"w-4 h-4 inline mr-1"}),n("crypto.destinationAccount","Destination Account")]}),e.jsxs("select",{value:D||"",onChange:F=>R(parseInt(F.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:n("select","Select...")}),q.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("note","Note")}),e.jsx("input",{type:"text",value:h,onChange:F=>w(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["TX Hash (",n("optional","optional"),")"]}),e.jsx("input",{type:"text",value:p,onChange:F=>v(F.target.value),placeholder:"0x...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-sm"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("crypto.pnlPreview","P&L Preview")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.costBasis","Cost Basis")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r!==null?`$${r.toFixed(2)}`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.totalRewards","Total Rewards")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a?`$${a.toFixed(2)}`:"$0.00"})]}),e.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.realizedPnl","Realized P&L")}),e.jsx("p",{className:`text-lg font-bold ${L!==null?L>=0?"text-green-600":"text-red-600":"text-gray-400"}`,children:L!==null?`${L>=0?"+":""}$${L.toFixed(2)} (${x==null?void 0:x.toFixed(1)}%)`:"N/A"})]})]})]}),O.error&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx($t,{className:"w-4 h-4"}),O.error.message]})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",children:n("cancel","Cancel")}),e.jsx("button",{onClick:()=>O.mutate(),disabled:!D||O.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:O.isPending?n("loading","Loading..."):n("crypto.confirmClose","Confirm Close")})]})]})]});return typeof document>"u"?null:Fe.createPortal(T,document.body)}function Is({group:t,onClose:s}){const[r,a]=g.useState("overview"),[c,i]=g.useState(!1),n=t.tokens[0],y=et({queries:t.tokens.map(h=>({queryKey:["position-history",h.id],queryFn:()=>ss(h.id,30),retry:!1}))}),j=y.some(h=>h.isLoading),k=g.useMemo(()=>{const h=y.filter(v=>{var _;return(_=v.data)==null?void 0:_.snapshots}).flatMap(v=>v.data.snapshots);if(h.length===0)return null;const w=new Map;for(const v of h){const _=w.get(v.snapshot_date)||0;w.set(v.snapshot_date,_+Number(v.balance_usd))}return{snapshots:Array.from(w.entries()).map(([v,_])=>({snapshot_date:v,balance_usd:_}))}},[y]),S=et({queries:t.tokens.map(h=>({queryKey:["position-performance",h.id],queryFn:()=>rs(h.id),retry:!1}))}),b=S.some(h=>h.isLoading),N=S.every(h=>!h.isLoading),u=g.useMemo(()=>{if(!N)return null;const h=S.filter(T=>T.data);if(h.length===0)return null;const w=h[0].data;if(h.length===1)return w;let p=0,v=0,_=0,q=0,L=0,x=!1,m=0,d=0;for(const T of h){const l=T.data;p+=Number(l.start_value_usd),v+=Number(l.current_value_usd),_+=Number(l.total_return_usd),q=Math.max(q,l.days_held),L+=l.snapshot_count,l.il_usd!=null&&(x=!0,m+=Number(l.il_usd)),l.hodl_value_usd!=null&&(d+=Number(l.hodl_value_usd))}const A=p>0?_/p*100:0;let O=null;if(q>=7&&p>0){const T=((v/p)**(365/q)-1)*100;Math.abs(T)<=500&&(O=T)}return{position_id:w.position_id,protocol:w.protocol,symbol:t.name,days_held:q,start_value_usd:p,current_value_usd:v,total_return_usd:_,total_return_pct:A,annualized_return_pct:O,current_apy:w.current_apy,snapshot_count:L,il_percentage:x&&p>0?m/p*100:null,il_usd:x?m:null,hodl_value_usd:x?d:null,lp_vs_hodl_usd:x?v-d:null,lp_outperformed_hodl:x?v>d:void 0}},[S,t.name,N]),{data:M}=K({queryKey:["position-roi",n.id],queryFn:()=>yt(n.id),retry:!1}),C=j||b,D=h=>{const w=Number(h.balance);return w<1e-4?"<0.0001":w<1?w.toFixed(4):w.toFixed(2)},R=e.jsxs("div",{className:"fixed inset-0 z-[100001]",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsx("div",{className:"fixed inset-0 z-[100002] flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90dvh] my-auto overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 dark:from-gray-800 dark:to-gray-900 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex -space-x-2",children:t.tokens.slice(0,3).map((h,w)=>h.logo_url?e.jsx("img",{src:h.logo_url,alt:h.symbol,className:"w-10 h-10 rounded-full border-2 border-white/20",style:{zIndex:t.tokens.length-w}},h.id):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",style:{zIndex:t.tokens.length-w},children:h.symbol.slice(0,2)},h.id))}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:t.protocol}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.name})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Current Value"}),e.jsxs("p",{className:"text-4xl font-bold",children:["$",t.total_usd.toFixed(2)]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-2 text-sm",children:e.jsx("span",{className:"text-gray-400",children:t.tokens.map((h,w)=>e.jsxs("span",{children:[w>0&&" + ",D(h)," ",h.symbol]},h.id))})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>a("overview"),className:I("flex-1 px-4 py-3 text-sm font-medium transition-colors",r==="overview"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:"Gain/Loss"}),e.jsxs("button",{onClick:()=>a("rewards"),className:I("flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2",r==="rewards"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:[e.jsx(Ue,{className:"w-4 h-4"}),"Rewards"]})]}),e.jsx("div",{className:"p-4 space-y-4 max-h-[50vh] overflow-y-auto",children:C?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(he,{size:"lg"})}):e.jsxs(e.Fragment,{children:[r==="overview"&&e.jsxs(e.Fragment,{children:[u&&e.jsxs(ge,{className:"overflow-hidden",children:[e.jsxs("div",{className:I("p-4 text-center",Number(u.total_return_pct)>=0?"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20":"bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[Number(u.total_return_pct)>=0?e.jsx(Ns,{className:"w-5 h-5 text-green-600"}):e.jsx(fs,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:I("text-sm font-medium",Number(u.total_return_pct)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:"Total Return"})]}),e.jsxs("p",{className:I("text-3xl font-bold",Number(u.total_return_pct)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[Number(u.total_return_pct)>=0?"+":"",u.total_return_pct.toFixed(2),"%"]}),e.jsxs("p",{className:I("text-lg font-semibold mt-1",Number(u.total_return_usd)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:[Number(u.total_return_usd)>=0?"+":"","$",Math.abs(Number(u.total_return_usd)).toFixed(2)]})]}),e.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(ct,{className:"w-3.5 h-3.5"}),"Invested"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",Number(u.start_value_usd).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(xs,{className:"w-3.5 h-3.5"}),"Duration"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[u.days_held," days"]})]})]})]}),u&&u.annualized_return_pct!==null&&e.jsx(ge,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Annualized Return"})]}),e.jsxs("span",{className:I("font-bold text-lg",Number(u.annualized_return_pct)>=0?"text-green-600":"text-red-600"),children:[Number(u.annualized_return_pct)>=0?"+":"",u.annualized_return_pct.toFixed(2),"%"]})]})}),u&&u.current_apy!=null&&e.jsx(ge,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current APY"})]}),e.jsxs("span",{className:"font-bold text-lg text-purple-600 dark:text-purple-400",children:[Number(u.current_apy).toFixed(2),"%"]})]})}),k&&k.snapshots.length>0&&e.jsxs(ge,{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-3",children:"30-Day Performance"}),e.jsx("div",{className:"h-40",children:e.jsx(Ps,{snapshots:k.snapshots})})]}),e.jsx("button",{onClick:()=>i(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Close Position"})]}),r==="rewards"&&e.jsx(e.Fragment,{children:t.protocol_module==="staked"?e.jsx(Ls,{source:"symbiotic"}):e.jsx(qs,{positionId:n.id})})]})}),c&&e.jsx($s,{group:t,lastSnapshotValueUsd:t.total_usd,costBasisUsd:(M==null?void 0:M.cost_basis_usd)??null,totalRewardsUsd:(M==null?void 0:M.total_rewards_usd)??null,onClose:()=>i(!1),onSuccess:()=>{i(!1),s()}})]})})]});return typeof document>"u"?null:Fe.createPortal(R,document.body)}function Os({walletId:t}){const{t:s}=X(),r=re(),[a,c]=g.useState(new Set),[i,n]=g.useState(""),{data:y=[]}=K({queryKey:["unattributed-rewards"],queryFn:pt}),{data:j}=K({queryKey:["defi-positions",t],queryFn:()=>bt(t),enabled:!!t}),k=V({mutationFn:({rewardIds:d,positionId:A})=>as(d,A),onSuccess:()=>{r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["position-rewards"]}),c(new Set),n("")}}),[S,b]=g.useState(null),[N,u]=g.useState(null),[M,C]=g.useState(null),D=V({mutationFn:d=>gt(d),onSuccess:d=>{u(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:d.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["transactions"]}),b(null),setTimeout(()=>u(null),5e3)},onError:d=>{C(d.message||s("crypto.transactionCreateError","Failed to create transaction")),b(null),setTimeout(()=>C(null),5e3)}});if(y.length===0)return null;const R=1,h=y.filter(d=>Number(d.reward_usd||0)>=R);if(h.length===0)return null;const w=(j==null?void 0:j.positions)||[],p=d=>`${Number(d.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})} ${d.reward_token_symbol||"tokens"}`,v=d=>new Date(d).toLocaleDateString(oe(),{month:"short",day:"numeric",year:"numeric"}),_=d=>{const A=new Set(a);A.has(d)?A.delete(d):A.add(d),c(A)},q=()=>{a.size===h.length?c(new Set):c(new Set(h.map(d=>d.id)))},L=h.length>0&&a.size===h.length,x=a.size>0,m=()=>{a.size===0||!i||k.mutate({rewardIds:Array.from(a),positionId:i})};return e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(us,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),e.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:s("crypto.unattributedRewards",{count:h.length})})]}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:s("crypto.unattributedRewardsDesc","These rewards need to be assigned to a position for ROI tracking.")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-yellow-100 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:q,className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[L?e.jsx(Ge,{className:"h-4 w-4 text-primary-600"}):e.jsx(Xe,{className:"h-4 w-4"}),L?s("deselectAll","Deselect All"):s("selectAll","Select All")]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs("select",{value:i,onChange:d=>n(d.target.value),disabled:!x,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:s("crypto.selectPosition","Select position...")}),w.map(d=>e.jsxs("option",{value:d.id,children:[d.protocol," - ",d.symbol]},d.id))]}),e.jsxs("button",{type:"button",onClick:m,disabled:!x||!i||k.isPending,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-md transition-colors disabled:cursor-not-allowed",children:[e.jsx(Ot,{className:"h-4 w-4"}),k.isPending?s("assigning","Assigning..."):s("crypto.assignSelected","Assign {{count}} Selected",{count:a.size})]})]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(pe,{className:"h-4 w-4"}),N]}),M&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(de,{className:"h-4 w-4"}),M]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.map(d=>e.jsxs("div",{onClick:()=>_(d.id),className:`flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-colors ${a.has(d.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700":"bg-white dark:bg-gray-800 border-yellow-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:a.has(d.id)?e.jsx(Ge,{className:"h-5 w-5 text-primary-600"}):e.jsx(Xe,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:p(d)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[v(d.claimed_at)," via ",d.source,d.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(d.reward_usd).toFixed(2)]})]})]}),d.reward_usd&&d.reward_usd>0&&e.jsx("div",{className:"flex-shrink-0",onClick:A=>A.stopPropagation(),children:d.transaction_id?e.jsxs("a",{href:`/transactions?id=${d.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(He,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{b(d.id),D.mutate(d.id)},disabled:S===d.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[S===d.id?e.jsx(Ne,{className:"h-3 w-3 animate-spin"}):e.jsx(Ee,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},d.id))}),x&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200 dark:border-gray-700 text-sm text-yellow-700 dark:text-yellow-300",children:s("crypto.selectedRewards","{{count}} reward(s) selected",{count:a.size})})]})}const Bs={deposit:"ðŸ’°",stake:"ðŸ”’",borrow:"ðŸ’¸",reward:"ðŸŽ",liquidity:"ðŸ’§"},zs={liquidity_pool:"LP",staking:"Staking",lending:"Lending",farming:"Farming",vault:"Vault"};function Ks(t){const s={};for(const r of t){const a=`${r.protocol}-${r.chain_id}-${r.name||r.token_name}-${r.position_type}`;s[a]||(s[a]={key:a,name:r.name||r.token_name,protocol:r.protocol,protocol_module:r.protocol_module,position_type:r.position_type,chain_id:r.chain_id,tokens:[],total_usd:0}),s[a].tokens.push(r),s[a].total_usd+=Number(r.balance_usd)}return Object.values(s)}function Qs({group:t,onClick:s,isPrivacyMode:r}){const a=t.chain_id,c=_e[a],i=t.tokens[0],n=r?t.tokens.map(y=>`*** ${y.symbol}`).join(" + "):t.tokens.map(y=>{const j=Number(y.balance);return`${j<1e-4?"<0.0001":j<1?j.toFixed(4):j.toFixed(2)} ${y.symbol}`}).join(" + ");return e.jsxs("button",{onClick:()=>s(t),className:"w-full flex items-center justify-between py-3 px-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors text-left group",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:t.tokens.length>1?e.jsxs("div",{className:"flex -space-x-2",children:[t.tokens.slice(0,3).map((y,j)=>y.logo_url?e.jsx("img",{src:y.logo_url,alt:y.symbol,className:"w-7 h-7 rounded-full border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-j},onError:k=>{k.target.style.display="none"}},y.id):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-j},children:y.symbol.slice(0,2)},y.id)),t.tokens.length>3&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",t.tokens.length-3]})]}):i.logo_url?e.jsx("img",{src:i.logo_url,alt:i.symbol,className:"w-8 h-8 rounded-full",onError:y=>{y.target.style.display="none"}}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:Bs[t.position_type]||"ðŸ“ˆ"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.protocol}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:zs[t.protocol_module]||t.protocol_module})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"truncate",children:t.name}),c&&e.jsxs("span",{className:"text-xs px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:[c.icon," ",a.toUpperCase()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:r?"$***":`$${t.total_usd.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[180px] truncate",children:n})]}),e.jsx(dt,{className:"w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors"})]})]})}function rt(){const{t}=X("common"),{currency:s}=ot(),{isPrivacyMode:r}=Ce(),[a,c]=g.useState(null),i=Se(),{data:n,isLoading:y}=K({queryKey:["crypto-wallets"],queryFn:xt}),{data:j=[]}=K({queryKey:["unattributed-rewards"],queryFn:pt}),{data:k,isLoading:S,refetch:b}=K({queryKey:["crypto-defi-positions",n==null?void 0:n.map(p=>p.id)],queryFn:async()=>!n||n.length===0?[]:await Promise.all(n.map(v=>bt(v.id).catch(()=>({wallet_address:v.wallet_address,total_value_usd:0,positions:[],last_sync_at:null})))),enabled:!!n&&n.length>0}),N=(k==null?void 0:k.flatMap(p=>p.positions))||[],u=Ks(N),M=(k==null?void 0:k.reduce((p,v)=>p+Number(v.total_value_usd||0),0))||0,C=1/((i==null?void 0:i.USD)||.00667),D=Math.round(M*C),R=u.reduce((p,v)=>{const _=v.protocol;return p[_]||(p[_]=[]),p[_].push(v),p},{});if(y||S)return e.jsx(we,{title:t("crypto.defiPositions"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(he,{size:"md"})})});if(!n||n.length===0)return null;const w=j.length>0?`${u.length} Â· ${j.length} âš `:u.length;return e.jsxs(we,{title:t("crypto.defiPositions"),badge:w,defaultOpen:u.length>0,children:[N.length>0&&e.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalDefiValue")}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:te(D,s,i,!1,r)})]}),e.jsx("button",{onClick:()=>b(),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors",title:t("crypto.refresh"),children:e.jsx(se,{className:"w-5 h-5"})})]})}),n[0]&&e.jsx("div",{className:"mb-4",children:e.jsx(Os,{walletId:n[0].id})}),u.length>0?e.jsx("div",{className:"space-y-4",children:Object.entries(R).sort(([,p],[,v])=>{const _=p.reduce((L,x)=>L+x.total_usd,0);return v.reduce((L,x)=>L+x.total_usd,0)-_}).map(([p,v])=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:p}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r?"$***":`$${v.reduce((_,q)=>_+q.total_usd,0).toFixed(2)}`})]})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:v.sort((_,q)=>q.total_usd-_.total_usd).map(_=>e.jsx(Qs,{group:_,onClick:c,isPrivacyMode:r},_.key))})]},p))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Cs,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("crypto.noDefiPositions")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("crypto.noDefiPositionsDescription")})]}),a&&e.jsx(Is,{group:a,onClose:()=>c(null)})]})}function at(){const{t}=X("common"),[s,r]=g.useState(!1),{data:a,isLoading:c}=K({queryKey:["closed-positions"],queryFn:Es});return c||!a||a.total_closed===0?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!s),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ps,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t("crypto.closedPositions","Closed Positions")}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.total_closed," ",t("crypto.positions","positions")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[a.total_realized_pnl_jpy!==null&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:t("crypto.totalPnl","Total P&L")}),e.jsxs("p",{className:`font-medium ${a.total_realized_pnl_jpy>=0?"text-green-600":"text-red-600"}`,children:[a.total_realized_pnl_jpy>=0?"+":"",ve(a.total_realized_pnl_jpy,"JPY")]})]}),s?e.jsx(ft,{className:"w-5 h-5 text-gray-500"}):e.jsx(Ae,{className:"w-5 h-5 text-gray-500"})]})]}),s&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 space-y-3",children:a.positions.map(i=>{const n=_e[i.chain_id],y=i.realized_pnl_jpy!==null&&i.realized_pnl_jpy>=0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[i.protocol," - ",i.symbol]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[n&&e.jsx("span",{children:n.icon}),e.jsx("span",{children:new Date(i.exit_date).toLocaleDateString(oe())})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:ve(i.exit_value_jpy,"JPY")}),i.realized_pnl_jpy!==null&&e.jsxs("div",{className:`flex items-center justify-end gap-1 text-sm ${y?"text-green-600":"text-red-600"}`,children:[y?e.jsx(Re,{className:"w-3 h-3"}):e.jsx(Bt,{className:"w-3 h-3"}),y?"+":"",ve(i.realized_pnl_jpy,"JPY"),i.realized_pnl_pct!==null&&e.jsxs("span",{className:"text-xs",children:["(",i.realized_pnl_pct.toFixed(1),"%)"]})]})]})]},i.id)})})]})}async function Hs(t){return(await Me.post("/api/transfers/",t)).data}async function Us(t){return(await Me.post("/api/transfers/exchange",t)).data}const xe={JPY:"Â¥",USD:"$",VND:"â‚«"};function ue(t){const s=t.replace(/[^\d]/g,"");return s?parseInt(s).toLocaleString("en-US"):""}function W(t){return parseInt(t.replace(/[,.\s]/g,""),10)||0}function Vs({isOpen:t,onClose:s}){const{t:r}=X("common"),a=re(),{data:c}=mt(),i=Se(),[n,y]=g.useState(null),[j,k]=g.useState(null),[S,b]=g.useState(""),[N,u]=g.useState(""),[M,C]=g.useState(""),[D,R]=g.useState(new Date().toISOString().split("T")[0]),[h,w]=g.useState(""),[p,v]=g.useState({}),[_,q]=g.useState(!1),[L,x]=g.useState(null),m=g.useMemo(()=>c==null?void 0:c.find(o=>o.id===n),[c,n]),d=g.useMemo(()=>c==null?void 0:c.find(o=>o.id===j),[c,j]),A=g.useMemo(()=>(c==null?void 0:c.filter(o=>o.id!==n))||[],[c,n]),{data:O}=K({queryKey:["transactions","income",m==null?void 0:m.currency],queryFn:()=>Kt({type:"income"}),enabled:_&&!!m,select:o=>o.filter(Q=>Q.currency===(m==null?void 0:m.currency))});g.useEffect(()=>{if(!m||!d||!S||!i)return;const o=W(S);if(o<=0)return;if(m.currency===d.currency){u(ue(o.toString()));return}const Q=i[m.currency]||1,E=i[d.currency]||1,B=o/Q,De=Math.round(B*E);u(ue(De.toString()))},[m,d,S,i]),g.useEffect(()=>{var o;t&&(y(((o=c==null?void 0:c[0])==null?void 0:o.id)||null),k(null),b(""),u(""),C(""),R(new Date().toISOString().split("T")[0]),w(""),v({}),q(!1),x(null))},[t,c]);const T=V({mutationFn:Hs,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["transfers"]}),a.invalidateQueries({queryKey:["analytics"]}),s()}}),l=V({mutationFn:Us,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["transfers"]}),a.invalidateQueries({queryKey:["analytics"]}),s()}}),F=_?l:T,Z=()=>{const o={};return n||(o.fromAccount=r("transfer.errors.fromRequired")),j||(o.toAccount=r("transfer.errors.toRequired")),n&&j&&n===j&&(o.toAccount=r("transfer.errors.sameAccount")),(!S||W(S)<=0)&&(o.fromAmount=r("transfer.errors.amountRequired")),(!N||W(N)<=0)&&(o.toAmount=r("transfer.errors.amountRequired")),v(o),Object.keys(o).length===0},P=o=>{if(o.preventDefault(),!Z())return;const Q=(m==null?void 0:m.currency)||"JPY",E=(d==null?void 0:d.currency)||"JPY";if(_){const B={date:D,from_account_id:n,from_amount:ce(W(S),Q),to_account_id:j,to_amount:ce(W(N),E),link_to_transaction_id:L||void 0,notes:h.trim()||void 0};l.mutate(B)}else{const B={from_account_id:n,to_account_id:j,from_amount:ce(W(S),Q),to_amount:ce(W(N),E),fee_amount:ce(W(M)||0,Q),date:D,description:h.trim()||void 0};m&&d&&m.currency!==d.currency&&(B.exchange_rate=W(N)/W(S)),T.mutate(B)}};if(!t)return null;const f=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 animate-modal-backdrop",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:_?r("transfer.exchangeTitle","Currency Exchange"):r("transfer.title")}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:P,className:"p-6 space-y-5",children:[e.jsx("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:o=>q(o.target.checked),className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx(se,{className:"w-4 h-4"}),r("transfer.exchangeMode","Currency Exchange")]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.fromAccount")}),e.jsxs("select",{value:n||"",onChange:o=>y(o.target.value?parseInt(o.target.value):null),className:I("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.fromAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),c==null?void 0:c.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",xe[o.currency]||o.currency,")"]},o.id))]}),p.fromAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.fromAccount})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(zt,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.toAccount")}),e.jsxs("select",{value:j||"",onChange:o=>k(o.target.value?parseInt(o.target.value):null),className:I("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.toAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),A.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",xe[o.currency]||o.currency,")"]},o.id))]}),p.toAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.toAccount})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:m?xe[m.currency]||m.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:S,onChange:o=>b(ue(o.target.value)),className:I("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.fromAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),p.fromAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.fromAmount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.convertedAmount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:d?xe[d.currency]||d.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:N,onChange:o=>u(ue(o.target.value)),className:I("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",p.toAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),p.toAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.toAmount})]})]}),m&&d&&m.currency!==d.currency&&S&&N&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["1 ",m.currency," â‰ˆ ",(W(N)/W(S)).toFixed(4)," ",d.currency]}),_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.linkToIncome","Link to Income")," (",r("optional"),")"]}),e.jsxs("select",{value:L||"",onChange:o=>x(o.target.value?parseInt(o.target.value):null),className:"w-full h-12 px-4 border border-gray-300 rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",children:[e.jsx("option",{value:"",children:r("transfer.noLink","None")}),O==null?void 0:O.map(o=>e.jsxs("option",{value:o.id,children:[o.date," - ",o.description," (",ve(o.amount,o.currency),")"]},o.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:r("transfer.linkToIncomeHelp","Link this exchange to an income transaction for tracking")})]}),!_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.fee")," (",r("optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:m?xe[m.currency]||m.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:M,onChange:o=>C(ue(o.target.value)),className:"w-full h-12 pl-10 pr-4 border border-gray-300 rounded-lg text-right dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.date")}),e.jsx("input",{type:"date",value:D,onChange:o=>R(o.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.description")," (",r("optional"),")"]}),e.jsx("input",{type:"text",value:h,onChange:o=>w(o.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:r("transfer.descriptionPlaceholder")})]}),F.isError&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:r("transfer.error")}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(ye,{type:"button",variant:"outline",onClick:s,className:"flex-1 h-12",children:r("cancel")}),e.jsx(ye,{type:"submit",loading:F.isPending,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700",children:r("transfer.create")})]})]})]})]});return typeof document>"u"?null:Fe.createPortal(f,document.body)}const jt="accounts_collapsed_sections";function Ws(){try{const t=localStorage.getItem(jt);if(t)return new Set(JSON.parse(t))}catch{}return new Set}function Js(t){localStorage.setItem(jt,JSON.stringify([...t]))}function Ys(){const{t}=X("common"),[s,r]=g.useState(!1),[a,c]=g.useState(!1),[i,n]=g.useState(!1),[y,j]=g.useState(!1),[k,S]=g.useState(!1),[b,N]=g.useState(null),[u,M]=g.useState(null),[C,D]=g.useState(()=>Ws());g.useEffect(()=>{Js(C)},[C]),g.useEffect(()=>{const m=()=>{j(!0)},d=()=>{S(!0)};return window.addEventListener("open-add-transaction-modal",m),window.addEventListener("open-receipt-scanner",d),()=>{window.removeEventListener("open-add-transaction-modal",m),window.removeEventListener("open-receipt-scanner",d)}},[]);const R=g.useCallback(m=>{D(d=>{const A=new Set(d);return A.has(m)?A.delete(m):A.add(m),A})},[]),{data:h,isLoading:w,error:p}=mt(s),v=()=>{N(null),c(!0)},_=m=>{N(m),c(!0)},q=()=>{c(!1),N(null)},L=h==null?void 0:h.reduce((m,d)=>{const A=d.type;return m[A]||(m[A]=[]),m[A].push(d),m},{}),x=["bank","savings","cash","credit_card","investment","crypto","receivable","other"];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:t("account.accounts")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:t("account.subtitle")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx(vs,{className:"w-5 h-5"}),t("transfer.title")]}),e.jsxs("button",{onClick:v,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),t("account.createAccount")]})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:m=>r(m.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-primary-600 focus:ring-primary-500 dark:bg-gray-700"}),t("account.showInactive")]})})]}),w&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}),p&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 dark:text-red-400",children:t("account.errors.loadFailed")})}),!w&&!p&&(!h||h.length===0)&&e.jsx(Qt,{icon:e.jsx(ke,{}),title:t("emptyState.accounts.title","No accounts added yet"),description:t("emptyState.accounts.description","Add your bank accounts, credit cards, or cash to track balances"),action:e.jsx("button",{onClick:v,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:t("emptyState.accounts.cta","Add Account")})}),!w&&!p&&h&&h.length>0&&e.jsxs("div",{className:"space-y-8",children:[x.map(m=>{const d=L==null?void 0:L[m];if(!d||d.length===0)return null;const A=C.has(m);return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>R(m),className:"w-full flex items-center justify-between mb-4 group cursor-pointer",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[t(`account.type.${m}`),e.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",d.length,")"]})]}),e.jsx(Ae,{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform duration-200 ${A?"-rotate-90":""}`})]}),e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 transition-all duration-200 ease-in-out ${A?"max-h-0 opacity-0 overflow-hidden":"max-h-[2000px] opacity-100"}`,children:d.map((O,T)=>e.jsx("div",{className:"animate-stagger-in",style:{"--stagger-index":Math.min(T,9)},children:e.jsx(Ms,{account:O,onEdit:_,onAddTransaction:l=>{M(l),j(!0)}})},O.id))})]},m)}),e.jsx(st,{}),e.jsx(rt,{}),e.jsx(at,{})]}),!w&&!p&&(!h||h.length===0)&&e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx(st,{}),e.jsx(rt,{}),e.jsx(at,{})]}),e.jsx(As,{isOpen:a,onClose:q,editingAccountId:b}),e.jsx(Vs,{isOpen:i,onClose:()=>n(!1)}),e.jsx(Ut,{isOpen:y,onClose:()=>{j(!1),M(null)},defaultAccountId:u}),e.jsx(Vt,{isOpen:k,onClose:()=>S(!1),onScanComplete:()=>S(!1)})]})}const gr=Ht("/accounts")({component:Ys});export{gr as Route};
