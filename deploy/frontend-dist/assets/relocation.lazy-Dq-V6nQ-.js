import{k as J,G as S,r as c,u as j,A as k,j as e,C as b,I as T,av as Q,B as V,l as F,h as I,aw as R,ax as $,n as Z,ay as W,az as X,a3 as ee,t as te,aA as ae,i as se}from"./index-BdLNYqtB.js";import{S as C}from"./Select-DZYwn299.js";import{S as ne}from"./Switch-BJInJu34.js";import{C as re}from"./chevron-up-NvVroXYN.js";import{C as ie}from"./chevron-down-UfJDSWww.js";import{M as oe}from"./minus-BUwrv88N.js";import{L as le}from"./lightbulb-cax-89Aq.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],de=J("map-pin",ce);async function me(){return(await S.get("/api/relocation/cities")).data}async function xe(a){return(await S.post("/api/relocation/compare",a)).data}async function ue(a){return(await S.get(`/api/relocation/resolve-postal?code=${a}`)).data}function he(a){const s=a.replace(/\D/g,"").slice(0,7);return s.length<=3?s:`${s.slice(0,3)}-${s.slice(3)}`}function D(a){const[s,t]=c.useState(""),[n,o]=c.useState(""),[l,i]=c.useState(!1),[x,u]=c.useState(!1),h=c.useRef(null),y=c.useCallback(m=>{const g=m.replace(/\D/g,"").slice(0,7);t(g),o(""),h.current&&clearTimeout(h.current),g.length===7&&(h.current=setTimeout(async()=>{i(!0);try{const f=await ue(g);f.matched&&f.city_id!=null?(a(String(f.city_id)),u(!1)):(o("postalCodeNotFound"),u(!0))}catch{o("postalCodeNotFound"),u(!0)}finally{i(!1)}},500))},[a]),d=c.useCallback(()=>{u(m=>!m)},[]);return{postalCode:s,error:n,isResolving:l,showDropdown:x,handlePostalCodeChange:y,toggleDropdown:d,setShowDropdown:u}}const ge=["single","couple","couple_1","couple_2","couple_3"],pe=["1K","1LDK","2LDK","3LDK"];function ye({onSubmit:a,isLoading:s}){const{t,i18n:n}=j("common"),o=n.language==="ja",[l,i]=c.useState(""),[x,u]=c.useState("single"),[h,y]=c.useState("1K"),[d,m]=c.useState(""),[g,f]=c.useState(""),[M,z]=c.useState(!1),O=D(c.useCallback(r=>m(r),[])),E=D(c.useCallback(r=>f(r),[])),{data:v,isLoading:K}=k({queryKey:["relocation-cities"],queryFn:me,staleTime:1e3*60*30}),Y=[{value:"",label:t("relocation.selectCity")},...(v==null?void 0:v.map(r=>({value:String(r.id),label:o?`${r.prefecture_name} ${r.city_name}`:`${r.city_name_en}, ${r.prefecture_name_en}`})))??[]],q=ge.map(r=>({value:r,label:t(`relocation.familySize.${r}`)})),A=pe.map(r=>({value:r,label:r})),G=r=>{r.preventDefault(),!(!l||!d||!g)&&a({nenshu:Number(l),family_size:x,room_type:h,current_city_id:Number(d),target_city_id:Number(g),has_young_children:M})},B=l&&Number(l)>0&&d&&g&&d!==g,P=(r,w,U,H,p)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{id:`${r}PostalCode`,label:t("relocation.postalCodeLabel"),type:"text",inputMode:"numeric",placeholder:t("relocation.postalCodePlaceholder"),value:he(p.postalCode),onChange:_=>p.handlePostalCodeChange(_.target.value),error:p.error?t(`relocation.${p.error}`):void 0,disabled:p.isResolving}),e.jsxs("button",{type:"button",onClick:()=>{p.toggleDropdown()},className:"flex items-center gap-1 text-xs text-primary-600 dark:text-primary-400 hover:underline",children:[t("relocation.chooseManually"),p.showDropdown?e.jsx(re,{className:"w-3 h-3"}):e.jsx(ie,{className:"w-3 h-3"})]}),p.showDropdown&&e.jsx(C,{id:r,label:w,options:Y,value:U,onChange:_=>{H(_.target.value),p.setShowDropdown(!1)},disabled:K})]});return e.jsx(b,{children:e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsx(T,{id:"nenshu",label:t("relocation.nenshu"),type:"text",inputMode:"numeric",placeholder:t("relocation.nenshuPlaceholder"),value:l?Number(l).toLocaleString():"",onChange:r=>{const w=r.target.value.replace(/[^\d]/g,"");i(w)}}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(C,{id:"familySize",label:t("relocation.familySizeLabel"),options:q,value:x,onChange:r=>u(r.target.value)}),e.jsx(C,{id:"roomType",label:t("relocation.roomTypeLabel"),options:A,value:h,onChange:r=>y(r.target.value)})]}),["couple_1","couple_2","couple_3"].includes(x)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"hasYoungChildren",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("relocation.hasYoungChildren")}),e.jsx(ne,{checked:M,onChange:z})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx(de,{className:"w-4 h-4"}),t("relocation.citySelection")]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr] gap-3 items-start",children:[P("currentCity",t("relocation.currentCity"),d,m,O),e.jsx(Q,{className:"hidden sm:block w-5 h-5 text-gray-400 mt-10"}),P("targetCity",t("relocation.targetCity"),g,f,E)]})]}),e.jsx(V,{type:"submit",loading:s,disabled:!B,className:"w-full",children:t("relocation.compare")})]})})}const fe=["rent","estimated_food","estimated_utilities","estimated_transport","social_insurance","resident_tax","income_tax","estimated_childcare"];function N(a){return`Â¥${a.toLocaleString()}`}function L({breakdown:a,label:s}){const{t}=j("common");return e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1 truncate",children:s}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3 truncate",children:a.prefecture_name}),e.jsx("div",{className:"space-y-2",children:fe.map(n=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 truncate mr-2",children:t(`relocation.cost.${n}`)}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white whitespace-nowrap",children:n==="estimated_childcare"&&a[n]===0?t("relocation.childcareFree"):N(a[n])})]},n))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:t("relocation.totalMonthly")}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:N(a.total_monthly)})]})})]})}function je({data:a}){const{t:s}=j("common"),t=a.monthly_difference,n=t<0,o=t>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{variant:"gradient",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s("relocation.monthlyDiff")}),e.jsxs("p",{className:F("text-2xl font-bold",n?"text-emerald-600 dark:text-emerald-400":o?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:[n?"":o?"+":"",N(t)]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s("relocation.annualDiff"),": ",n?"":o?"+":"",N(a.annual_difference)]})]}),e.jsx(I,{variant:n?"success":o?"error":"default",children:e.jsxs("span",{className:"flex items-center gap-1",children:[n?e.jsx(R,{className:"w-3 h-3"}):o?e.jsx($,{className:"w-3 h-3"}):e.jsx(oe,{className:"w-3 h-3"}),s(n?"relocation.saving":o?"relocation.moreExpensive":"relocation.same")]})})]})}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:s("relocation.breakdown")}),e.jsxs("div",{className:"flex gap-4 sm:gap-6",children:[e.jsx(L,{breakdown:a.current,label:a.current.city_name}),e.jsx("div",{className:"w-px bg-gray-200 dark:bg-gray-700 shrink-0"}),e.jsx(L,{breakdown:a.target,label:a.target.city_name})]})]})]})}function be({monthlyDifference:a}){const{t:s}=j("common"),{data:t}=k({queryKey:["goals"],queryFn:W}),{data:n}=k({queryKey:["goals-progress-relocation",t==null?void 0:t.map(i=>i.id)],queryFn:async()=>t!=null&&t.length?Promise.all(t.map(i=>X(i.id,!0,3))):[],enabled:!!(t!=null&&t.length)});if(!(n!=null&&n.length)||a===0)return null;const o=a<0,l=Math.abs(a);return e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Z,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s("relocation.goalImpact")})]}),e.jsx("div",{className:"space-y-3",children:n.map(i=>{if(!i.achievability)return null;const x=i.target_amount-i.total_saved;if(x<=0)return null;const u=i.achievability.current_monthly_net>0?Math.ceil(x/i.achievability.current_monthly_net):1/0,h=o?i.achievability.current_monthly_net+l:i.achievability.current_monthly_net-l,y=h>0?Math.ceil(x/h):1/0,d=u-y,m=d>0;return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:i.name||s("goals.yearGoal",{years:i.years})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d!==0&&isFinite(d)?e.jsx("span",{className:F(m?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:m?s("relocation.goalFaster",{months:Math.abs(d)}):s("relocation.goalSlower",{months:Math.abs(d)})}):s("relocation.goalNoChange")})]}),e.jsx(I,{variant:m?"success":d<0?"error":"default",children:e.jsxs("span",{className:"flex items-center gap-1",children:[m?e.jsx($,{className:"w-3 h-3"}):d<0?e.jsx(R,{className:"w-3 h-3"}):null,isFinite(y)?s("relocation.monthsRemaining",{months:y}):"-"]})})]},i.goal_id)})})]})}function Ne({advice:a}){const{t:s}=j("common");return e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(le,{className:"w-5 h-5 text-blue-500 dark:text-teal-400"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s("relocation.adviceTitle")})]}),e.jsx("ul",{className:"space-y-2",children:a.map((t,n)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"mt-1.5 w-1.5 h-1.5 rounded-full bg-blue-400 dark:bg-teal-400 shrink-0"}),e.jsx("span",{children:t})]},n))})]})}function ve(){var o;const{t:a}=j("common"),[s,t]=c.useState(null),n=ee({mutationFn:l=>xe(l),onSuccess:l=>{t(l)},onError:()=>{te.error(a("relocation.compareError"))}});return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-primary-600"}),a("relocation.title")]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a("relocation.subtitle")})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[e.jsx(ye,{onSubmit:l=>n.mutate(l),isLoading:n.isPending}),s&&e.jsxs(e.Fragment,{children:[e.jsx(je,{data:s}),((o=s.advice)==null?void 0:o.length)>0&&e.jsx(Ne,{advice:s.advice}),e.jsx(be,{monthlyDifference:s.monthly_difference})]})]})]})}const Te=se("/relocation")({component:ve});export{Te as Route};
