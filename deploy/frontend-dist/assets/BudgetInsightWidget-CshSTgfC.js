import{i as S,v as B,aB as q,j as p,P as F,I as P,B as M,J as I,x as L,y as _,W as $,aQ as J}from"./index-BaDR0x1b.js";import{r as k,j as e}from"./vendor-react-CezGY3Eh.js";import{d as D,e as R}from"./useCategories-RmSVdELm.js";import{u as T}from"./vendor-i18n-DHVoooz2.js";import{u as H}from"./vendor-query-Dt5Hl5qC.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],G=S("external-link",Y);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],O=S("rotate-ccw",z);async function X(r){return(await B.post("/api/receipts/scan",r)).data}async function Z(r){const a=new FormData;return a.append("file",r),(await B.post("/api/receipts/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function ee(r){return r||null}function te({selected:r,onSelect:a,isIncome:l=!1}){const{t:c}=T("common"),{data:o,isLoading:C}=D(),j=R(),[s,y]=k.useState(null),[h,i]=k.useState(!1),[g,x]=k.useState(""),[d,f]=k.useState("ðŸ“");if(C||!o)return e.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const v=l?o.income:o.expense,u=t=>{for(const n of v)if(n.children.some(E=>E.name===t))return n;return null},m=t=>{y(t),i(!1)},b=t=>{s&&a(t.name,s.name)},w=()=>{y(null),i(!1)},N=async()=>{!s||!g.trim()||(await j.mutateAsync({name:g.trim(),icon:d,parent_id:s.id,type:l?"income":"expense"}),a(g.trim(),s.name),x(""),i(!1))};return s?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:w,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(q,{className:"w-4 h-4"}),s.icon," ",s.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.children.map(t=>e.jsxs("button",{type:"button",onClick:()=>b(t),className:p("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",r===t.name?"bg-primary-100 border-2 border-primary-500 dark:bg-primary-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:t.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:t.name})]},t.id)),e.jsxs("button",{type:"button",onClick:()=>i(!0),className:p("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(F,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:c("category.addCustom","Add")})]})]}),h&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{value:d,onChange:t=>f(t.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(P,{value:g,onChange:t=>x(t.target.value),placeholder:c("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>i(!1),children:c("cancel","Cancel")}),e.jsx(M,{size:"sm",onClick:N,disabled:!g.trim()||j.isPending,children:c("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.map(t=>{var n;return e.jsxs("button",{type:"button",onClick:()=>m(t),className:p("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",((n=u(r))==null?void 0:n.id)===t.id?"bg-primary-100 border-2 border-primary-500 dark:bg-primary-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:t.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:t.name})]},t.id)})})}function A(r,a,l){if(a==="JPY"||!l[a])return r;const c=l[a];if(c===0)return r;const o=a==="USD"?r/100:r;return Math.round(o/c)}function re({parentCategory:r,transactionAmount:a,isExpense:l,transactionCurrency:c="JPY"}){var t;const{t:o}=T("common"),{currency:C}=I(),{isPrivacyMode:j}=L(),{data:s}=_(),y=k.useMemo(()=>{const n=new Date;return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`},[]),{data:h}=H({queryKey:["budget","tracking",y],queryFn:()=>J(y),staleTime:2*60*1e3,retry:!1}),i=n=>$(n,C,(s==null?void 0:s.rates)||{},!0,j);if(!l)return null;const g=(t=h==null?void 0:h.categories)==null?void 0:t.find(n=>n.category===r);if(!g)return null;const{spent:x,budgeted:d}=g,f=d>0?x/d*100:0,v=A(a,c,(s==null?void 0:s.rates)||{}),u=x+v,m=d>0?u/d*100:0,b=u>d,w=()=>m>=100?"bg-red-500":m>=80?"bg-amber-500":"bg-green-500",N=()=>b?"text-red-600 dark:text-red-400":m>=80?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400";return e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 truncate",children:o("budget.insight.countsToward",{category:r})}),e.jsx("span",{className:p("text-xs font-semibold whitespace-nowrap",N()),children:b?o("budget.insight.over",{amount:i(u-d)}):o("budget.insight.left",{amount:i(d-u)})})]}),e.jsx("div",{className:"mt-1.5",children:e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsxs("div",{className:"h-full rounded-full relative overflow-hidden",children:[e.jsx("div",{className:p("h-full rounded-full transition-[width] duration-300",w()),style:{width:`${Math.min(m,100)}%`}}),a>0&&e.jsx("div",{className:"absolute top-0 h-full opacity-50 rounded-r-full",style:{left:`${Math.min(f,100)}%`,width:`${Math.min(m-f,100-Math.min(f,100))}%`,background:"repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.4) 2px, rgba(255,255,255,0.4) 4px)"}})]})})}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[o("budget.budgetContext.progress",{spent:i(x),budgeted:i(d)}),a>0&&e.jsxs("span",{className:p("ml-1",N()),children:["â†’ ",i(u)]})]}),b&&a>0&&e.jsx("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mt-1",children:o("budget.insight.willExceed")})]})}export{re as B,G as E,te as H,O as R,ee as g,X as s,Z as u};
