import{c as e,j as t,k as r,u as a,m as s,o as n,l}from"./vendor-tanstack-C97-WeYN.js";import{r as i,a as d}from"./vendor-react-Bx4JnVfy.js";import{a as o,b as c,c as x,u as m}from"./useAccounts-B9eRZZRP.js";import{g as u,e as g,C as y,c as h,n as p,j as b,l as j,L as v,I as f,B as N,N as k,a as w,b as _,M as S,t as C}from"./index-DRgdJ_AG.js";import{u as F}from"./vendor-i18n-BrrOrGm_.js";import{C as D,e as $,c as P,s as A,d as q,f as L,h as M,i as B,j as z,k as R,l as T,m as K,n as E,o as I,p as Q,q as O,r as U,t as V,u as Y}from"./crypto-yRFh2kn9.js";import{W,N as H,_ as J,r as X,y as G,Q as Z,P as ee,q as te,T as re,K as ae,R as se,a5 as ne,m as le,X as ie,aa as de,ab as oe,C as ce,ac as xe,ad as me,ae as ue,af as ge,a1 as ye,ag as he,ah as pe,ai as be,aj as je,ak as ve,w as fe,A as Ne,al as ke}from"./vendor-icons-DsCueGb8.js";import{R as we,g as _e,a as Se,X as Ce,Y as Fe,T as De,e as $e}from"./vendor-recharts-Wt1h5c6F.js";import{T as Pe,R as Ae}from"./TransactionFormModal-BL-FMJBJ.js";import"./vendor-date-BkGg5e1q.js";import"./recurring-service-Cwg9i2je.js";import"./useCategories-6Z3-TD_U.js";import"./RecurringOptions-Pm13i0DK.js";const qe={bank:{icon:"ðŸ¦",color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/30"},cash:{icon:"ðŸ’µ",color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/30"},credit_card:{icon:"ðŸ’³",color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/30"},investment:{icon:"ðŸ“ˆ",color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/30"},receivable:{icon:"ðŸ’°",color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/30"},savings:{icon:"ðŸ·",color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/30"},crypto:{icon:"â‚¿",color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/30"},other:{icon:"ðŸ“",color:"text-gray-600",bgColor:"bg-gray-50 dark:bg-gray-700"}};function Le({account:r,onEdit:a}){const{t:s}=F("common"),n=e(),{data:l}=u(),{isPrivacyMode:i}=g(),d=qe[r.type],o=r.current_balance>=0;return t.jsxs(y,{className:"relative hover:shadow-md transition-shadow cursor-pointer",onClick:()=>{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`;n({to:"/transactions",search:{accountId:r.id,month:t,fromAccounts:!0}})},children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:h("p-3 rounded-lg",d.bgColor),children:t.jsx("span",{className:"text-2xl",children:d.icon})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-gray-100",children:r.name}),t.jsx("p",{className:h("text-sm",d.color),children:s(`account.type.${r.type}`)})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[a&&t.jsx("button",{onClick:e=>{e.stopPropagation(),a(r.id)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":s("account.edit"),children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),!r.is_active&&t.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:s("account.inactive")})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:s("account.currentBalance")}),t.jsx("p",{className:h("text-3xl font-bold font-mono",o?"text-green-600":"text-red-600"),children:p(r.current_balance,r.currency,(null==l?void 0:l.rates)||{},!0,i)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("account.initialBalance")}),t.jsx("p",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:p(r.initial_balance,r.currency,(null==l?void 0:l.rates)||{},!0,i)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("account.transactions")}),t.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:r.transaction_count})]})]}),r.notes&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:s("account.notes")}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r.notes})]})]})}const Me=e=>{const t=e.startsWith("-"),r=e.replace(/[^\d.]/g,"").split(".");return r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),(t?"-":"")+r.join(".")},Be=e=>(e.startsWith("-")?"-":"")+e.replace(/[^\d.]/g,""),ze=e=>"USD"===e?100:1;function Re({isOpen:e,onClose:r,editingAccountId:a}){const{t:s}=F("common"),n=o(),l=c(),{data:m}=x(a||void 0),u=b(),{isPrivacyMode:y}=g(),[j,v]=i.useState(""),[f,N]=i.useState("bank"),[k,w]=i.useState(""),[_,S]=i.useState(""),[C,D]=i.useState("JPY"),[$,P]=i.useState(""),[A,q]=i.useState({}),[L,M]=i.useState(""),[B,z]=i.useState(!1),R=m&&m.transaction_count>0,T=(()=>{if(!m||!L)return null;const e=ze(m.currency);return parseFloat(L)*e-m.current_balance})();i.useEffect(()=>{if(e){if(a&&m)if(v(m.name),N(m.type),P(m.notes||""),D(m.currency),R)M(""),z(!1);else{const e=ze(m.currency);w((m.initial_balance/e).toString()),S(m.initial_balance_date)}else v(""),N("bank"),w("0"),S((new Date).toISOString().split("T")[0]),D("JPY"),P(""),M(""),z(!1);q({})}},[e,a,m,R]);if(!e)return null;const K=t.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[t.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:s(a?"account.editAccount":"account.createAccount")}),t.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return j.trim()||(e.name=s("account.errors.nameRequired")),a?a&&!R&&(_||(e.initialBalanceDate=s("account.errors.dateRequired"))):_||(e.initialBalanceDate=s("account.errors.dateRequired")),q(e),0===Object.keys(e).length})())if(a&&R&&L&&!B)z(!0);else try{if(a){const e={name:j.trim(),type:f,notes:$.trim()||void 0};if(!R&&m){const t=ze(m.currency);e.initial_balance=Math.round(parseFloat(k||"0")*t),e.initial_balance_date=_}if(R&&L&&m){const t=ze(m.currency);e.desired_current_balance=Math.round(parseFloat(L)*t)}await l.mutateAsync({id:a,data:e})}else{const e=ze(C),t={name:j.trim(),type:f,initial_balance:Math.round(parseFloat(k||"0")*e),initial_balance_date:_,currency:C,notes:$.trim()||void 0};await n.mutateAsync(t)}r()}catch(t){q({submit:t.message||s("account.errors.submitFailed")})}},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.name")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",id:"name",value:j,onChange:e=>v(e.target.value),className:h("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",A.name?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:s("account.namePlaceholder")}),A.name&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.name})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.accountType")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("select",{id:"type",value:f,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:["bank","cash","credit_card","investment","receivable","savings","other"].map(e=>t.jsx("option",{value:e,children:s(`account.type.${e}`)},e))})]}),!a&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.initialBalance")}),t.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:Me(k),onChange:e=>w(Be(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.initialBalanceDate")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"date",id:"initialBalanceDate",value:_,onChange:e=>S(e.target.value),className:h("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",A.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),A.initialBalanceDate&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.initialBalanceDate})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.currency")}),t.jsxs("select",{id:"currency",value:C,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[t.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),t.jsx("option",{value:"USD",children:"USD ($)"}),t.jsx("option",{value:"VND",children:"VND (â‚«)"})]})]})]}),a&&!R&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.initialBalance")}),t.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:Me(k),onChange:e=>w(Be(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.initialBalanceDate")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"date",id:"initialBalanceDate",value:_,onChange:e=>S(e.target.value),className:h("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",A.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),A.initialBalanceDate&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.initialBalanceDate})]})]}),a&&R&&m&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:"Current Balance"}),t.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-200",children:p(m.current_balance,m.currency,u,!0,y)})]}),t.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:[m.transaction_count," transactions"]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"desiredBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Desired Current Balance"}),t.jsx("input",{type:"text",inputMode:"decimal",id:"desiredBalance",value:Me(L),onChange:e=>{M(Be(e.target.value)),z(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"Enter the actual balance"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the actual balance from your bank/wallet to reconcile"})]}),null!==T&&0!==T&&t.jsx("div",{className:h("border rounded-lg p-4",T>0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:h("text-sm font-medium",T>0?"text-green-900":"text-red-900"),children:"Adjustment Amount"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:h("text-lg font-bold",T>0?"text-green-900":"text-red-900"),children:T>0?"â†‘":"â†“"}),t.jsx("span",{className:h("text-lg font-bold",T>0?"text-green-900":"text-red-900"),children:p(Math.abs(T),m.currency,u,!0,y)})]})]})}),B&&null!==T&&0!==T&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("svg",{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-medium text-yellow-900",children:"Confirm Balance Adjustment"}),t.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["This will create a balance adjustment transaction of"," ",t.jsx("span",{className:"font-semibold",children:p(Math.abs(T),m.currency,u,!0,y)})," ","to reconcile your account balance."]})]})]})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.notes")}),t.jsx("textarea",{id:"notes",value:$,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:s("account.notesPlaceholder")})]}),A.submit&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:t.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:A.submit})}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[B&&t.jsx("button",{type:"button",onClick:()=>{z(!1),M("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel Adjustment"}),!B&&t.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:s("common.cancel")}),t.jsx("button",{type:"submit",disabled:n.isPending||l.isPending,className:h("flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",B?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:n.isPending||l.isPending?s("common.saving"):B?"Confirm Adjustment":s(a?"common.update":"common.create")})]})]})]})]});return"undefined"==typeof document?null:d.createPortal(K,document.body)}const Te=["eth","bsc","polygon"];function Ke({token:e,isPrivacyMode:r}){return t.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.logo_url?t.jsx("img",{src:e.logo_url,alt:e.symbol,className:"w-5 h-5 rounded-full",onError:e=>{e.target.style.display="none"}}):t.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-[10px] font-medium",children:e.symbol.slice(0,2)}),t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate",children:e.symbol})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:r?"***":Number(e.balance)<1e-4?"<0.0001":Number(e.balance).toFixed(4)}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r?"$***":`$${Number(e.balance_usd).toFixed(2)}`})]})]})}function Ee(){const{t:e}=F("common"),n=r(),{currency:l}=j(),{isPrivacyMode:d}=g(),o=b(),[c,x]=i.useState(!1),[m,u]=i.useState(""),[y,h]=i.useState(""),[k,w]=i.useState(["eth","bsc","polygon"]),[_,S]=i.useState(null),[C,z]=i.useState(null),{data:R,isLoading:T}=a({queryKey:["crypto-wallets"],queryFn:L}),{data:K}=a({queryKey:["crypto-wallets-balance",null==R?void 0:R.map(e=>e.id)],queryFn:async()=>R&&0!==R.length?Promise.all(R.map(e=>M(e.id))):[],enabled:!!R&&R.length>0}),{data:E,isLoading:I}=a({queryKey:["crypto-portfolio",C],queryFn:()=>B(C),enabled:!!C}),Q=s({mutationFn:P,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),x(!1),u(""),h(""),w(["eth","bsc","polygon"])}}),O=s({mutationFn:q,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),n.invalidateQueries({queryKey:["crypto-wallets-balance"]})}}),U=s({mutationFn:A,onSuccess:()=>{n.invalidateQueries({queryKey:["crypto-wallets"]}),n.invalidateQueries({queryKey:["crypto-wallets-balance"]}),n.invalidateQueries({queryKey:["dashboard-summary"]}),S(null)},onError:()=>{S(null)}}),V=e=>`${e.slice(0,6)}...${e.slice(-4)}`,Y=(e,t)=>{const r={eth:`https://etherscan.io/address/${e}`,bsc:`https://bscscan.com/address/${e}`,polygon:`https://polygonscan.com/address/${e}`,arbitrum:`https://arbiscan.io/address/${e}`,optimism:`https://optimistic.etherscan.io/address/${e}`};return r[t]||r.eth},te=(null==K?void 0:K.reduce((e,t)=>e+Number(t.total_balance_usd||0),0))||0,re=1/((null==o?void 0:o.USD)||.00667),ae=Math.round(te*re);return T?t.jsx(D,{title:e("crypto.wallets"),badge:0,children:t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(v,{size:"md"})})}):t.jsxs(D,{title:e("crypto.wallets"),badge:(null==R?void 0:R.length)||0,defaultOpen:R&&R.length>0,children:[K&&K.length>0&&t.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg",children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e("crypto.totalBalance")}),t.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:p(ae,l,o,!1,d)})]}),K&&K.length>0?t.jsx("div",{className:"space-y-3 mb-4",children:K.map(r=>{var a,s;return t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:t.jsx(W,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:r.label||V(r.wallet_address)}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[t.jsx("code",{className:"text-xs",children:V(r.wallet_address)}),t.jsx("a",{href:Y(r.wallet_address,"eth"),target:"_blank",rel:"noopener noreferrer",className:"hover:text-purple-500",children:t.jsx(H,{className:"w-3 h-3"})})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:d?"$***":`$${Number(r.total_balance_usd||0).toFixed(2)}`}),t.jsx("div",{className:"flex gap-1 mt-1",children:null==(a=r.chains)?void 0:a.map(e=>{var r;return t.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",title:null==(r=$[e])?void 0:r.name,children:e.toUpperCase()},e)})})]})]}),t.jsxs("button",{onClick:()=>{return e=r.id,void z(t=>t===e?null:e);var e},className:"flex items-center gap-2 mt-3 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors",children:[C===r.id?t.jsx(J,{className:"w-4 h-4"}):t.jsx(X,{className:"w-4 h-4"}),e("crypto.tokens")]}),C===r.id&&t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:I?t.jsx("div",{className:"flex justify-center py-4",children:t.jsx(v,{size:"sm"})}):(null==E?void 0:E.chains)&&E.chains.length>0?t.jsx("div",{className:"space-y-4",children:E.chains.filter(e=>e.tokens.length>0||e.native_balance).sort((e,t)=>Number(t.total_usd)-Number(e.total_usd)).map(e=>t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:e.chain_name}),t.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:d?"$***":`$${Number(e.total_usd).toFixed(2)}`})]}),t.jsxs("div",{className:"space-y-1",children:[e.native_balance&&Number(e.native_balance.balance)>0&&t.jsx(Ke,{token:e.native_balance,isPrivacyMode:d}),e.tokens.filter(e=>Number(e.balance_usd)>=1).sort((e,t)=>Number(t.balance_usd)-Number(e.balance_usd)).map(e=>t.jsx(Ke,{token:e,isPrivacyMode:d},e.token_address))]})]},e.chain_id))}):t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-2",children:e("crypto.noTokens")})}),t.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:(null==(s=r.sync_statuses)?void 0:s.some(e=>e.last_sync_at))?e("crypto.lastSync",{time:new Date(Math.max(...r.sync_statuses.filter(e=>e.last_sync_at).map(e=>new Date(e.last_sync_at).getTime()))).toLocaleString()}):e("crypto.neverSynced")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{return e=r.id,S(e),void U.mutate(e);var e},disabled:_===r.id,className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg transition-colors",title:e("crypto.sync"),children:_===r.id?t.jsx(v,{size:"sm"}):t.jsx(G,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{return t=r.id,void(confirm(e("common.confirmDelete"))&&O.mutate(t));var t},className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:e("common.delete"),children:t.jsx(Z,{className:"w-4 h-4"})})]})]})]},r.id)})}):c?null:t.jsxs("div",{className:"text-center py-6",children:[t.jsx(W,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:e("crypto.noWallets")}),t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:e("crypto.addWalletDescription")})]}),c?t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[t.jsx(f,{label:e("crypto.walletAddress"),placeholder:"0x...",value:m,onChange:e=>u(e.target.value)}),t.jsx(f,{label:e("crypto.walletLabel"),placeholder:e("crypto.walletLabelPlaceholder"),value:y,onChange:e=>h(e.target.value)}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("crypto.selectChains")}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Te.map(e=>{var r;return t.jsx("button",{type:"button",onClick:()=>(e=>{w(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:"px-3 py-1.5 rounded-lg text-sm font-medium transition-colors "+(k.includes(e)?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:(null==(r=$[e])?void 0:r.name)||e.toUpperCase()},e)})})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[t.jsx(N,{variant:"outline",onClick:()=>x(!1),children:e("common.cancel")}),t.jsx(N,{onClick:()=>{m.trim()&&Q.mutate({wallet_address:m.trim(),label:y.trim()||void 0,chains:k})},disabled:!m.trim()||0===k.length||Q.isPending,children:Q.isPending?e("common.saving"):e("crypto.addWallet")})]})]}):t.jsxs(N,{variant:"outline",onClick:()=>x(!0),className:"w-full",children:[t.jsx(ee,{className:"w-4 h-4 mr-2"}),e("crypto.addWallet")]})]})}function Ie({snapshots:e}){const{resolvedTheme:r}=k(),a="dark"===r,s=a?"#374151":"#E5E7EB",n=a?"#9CA3AF":"#6B7280",l=a?"#1F2937":"#FFFFFF",d=a?"#374151":"#E5E7EB",o="#6366F1",c=i.useMemo(()=>[...e].sort((e,t)=>new Date(e.snapshot_date).getTime()-new Date(t.snapshot_date).getTime()).map(e=>({date:e.snapshot_date,value:Number(e.balance_usd),formattedDate:new Date(e.snapshot_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})),[e]),[x,m]=i.useMemo(()=>{const e=c.map(e=>e.value),t=Math.min(...e),r=Math.max(...e),a=.1*(r-t)||10;return[Math.max(0,t-a),r+a]},[c]);return 0===c.length?t.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No historical data available"}):t.jsx(we,{width:"100%",height:"100%",children:t.jsxs(_e,{data:c,margin:{top:5,right:10,left:0,bottom:5},children:[t.jsx(Se,{strokeDasharray:"3 3",stroke:s,vertical:!1}),t.jsx(Ce,{dataKey:"formattedDate",tick:{fill:n,fontSize:11},tickLine:!1,axisLine:{stroke:s},interval:"preserveStartEnd"}),t.jsx(Fe,{domain:[x,m],tick:{fill:n,fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:e=>`$${e.toFixed(0)}`,width:50}),t.jsx(De,{contentStyle:{backgroundColor:l,border:`1px solid ${d}`,borderRadius:"8px",fontSize:"12px"},labelStyle:{color:n,fontWeight:"bold"},formatter:e=>[`$${e.toFixed(2)}`,"Value"]}),t.jsx($e,{type:"monotone",dataKey:"value",stroke:o,strokeWidth:2,dot:c.length<=10,activeDot:{r:6,fill:o}})]})})}function Qe({positionId:e}){var n,l;const{t:d}=F(),o=r(),[c,x]=i.useState(null),[m,u]=i.useState(!1),[g,y]=i.useState(null),[h,p]=i.useState(null),[b,j]=i.useState(null),{data:v,isLoading:f}=a({queryKey:["position-roi",e],queryFn:()=>K(e)}),{data:N=[]}=a({queryKey:["position-rewards-list",e],queryFn:()=>E(e)}),k=s({mutationFn:()=>z(90),onSuccess:e=>{x({scanned:e.scanned_claims,new:e.new_claims}),o.invalidateQueries({queryKey:["position-roi"]}),o.invalidateQueries({queryKey:["position-rewards-list"]}),o.invalidateQueries({queryKey:["unattributed-rewards"]}),setTimeout(()=>x(null),5e3)}}),w=s({mutationFn:e=>R(e),onSuccess:e=>{p(d("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:e.amount_usd.toFixed(2)})),o.invalidateQueries({queryKey:["position-rewards-list"]}),o.invalidateQueries({queryKey:["transactions"]}),y(null),setTimeout(()=>p(null),5e3)},onError:e=>{j(e.message||d("crypto.transactionCreateError","Failed to create transaction")),y(null),setTimeout(()=>j(null),5e3)}}),_=s({mutationFn:e=>T(e),onSuccess:e=>{const t=d("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:e.created,total:e.total_usd.toFixed(2),skipped:e.skipped});p(t),o.invalidateQueries({queryKey:["position-rewards-list"]}),o.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>p(null),8e3)},onError:e=>{j(e.message||d("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>j(null),5e3)}}),S=N.filter(e=>!e.transaction_id),C=(null==(n=null==v?void 0:v.rewards_by_token)?void 0:n.filter(e=>Number(e.amount_usd)>=1))||[],D=(null==(l=null==v?void 0:v.rewards_by_month)?void 0:l.filter(e=>Number(e.amount_usd)>=1))||[],$=N.filter(e=>Number(e.reward_usd||0)>=1),P=C.reduce((e,t)=>e+Number(t.amount_usd||0),0);if(f)return t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const A=e=>{if(null==e)return null;const t=Number(e);return isNaN(t)?null:`$${t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},q=e=>{const[t,r]=e.split("-");return new Date(Number(t),Number(r)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},L=e=>Number(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[t.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:d("crypto.scanRewardsHint","Scan blockchain for claimed rewards")}),t.jsx("button",{onClick:()=>k.mutate(),disabled:k.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:k.isPending?t.jsxs(t.Fragment,{children:[t.jsx(G,{className:"h-4 w-4 animate-spin"}),d("crypto.scanning","Scanning...")]}):t.jsxs(t.Fragment,{children:[t.jsx(G,{className:"h-4 w-4"}),d("crypto.scanRewards","Scan Rewards")]})})]}),c&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(te,{className:"h-4 w-4"}),d("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",c)]}),v&&t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4"}),d("crypto.roiSummary","ROI Summary")]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:d("crypto.totalRewards","Total Rewards")}),C.length>0?t.jsx("div",{className:"space-y-1",children:C.map(e=>{const r=A(e.amount_usd);return t.jsxs("div",{children:[t.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[L(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",r]})]},e.symbol)})}):t.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:A(P)||"-"}),t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[$.length," ",d("crypto.claims","claims")]})]}),null!==v.cost_basis_usd&&null!==v.simple_roi_pct&&t.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-green-200 dark:border-green-800",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:d("crypto.costBasis","Cost Basis")}),t.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:A(v.cost_basis_usd)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:d("crypto.roi","ROI")}),t.jsx("div",{className:"text-lg font-semibold "+(v.simple_roi_pct>=0?"text-green-800 dark:text-green-200":"text-red-600 dark:text-red-400"),children:(e=>{if(null===e)return"-";const t=Number(e);return`${t>=0?"+":""}${t.toFixed(2)}%`})(v.simple_roi_pct)}),v.days_held&&t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[v.days_held," ",d("crypto.daysHeld","days")]})]})]})]})]}),v&&D.length>0&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[t.jsx(ae,{className:"h-4 w-4"}),d("crypto.monthlyBreakdown","Monthly Breakdown")]}),t.jsx("div",{className:"space-y-2",children:D.map(e=>{const r=A(e.amount_usd);return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:q(e.month)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.count," ",d("crypto.claims","claims")]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[L(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",r]})]})]},`${e.month}-${e.symbol}`)})})]}),$.length>0&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-2 font-medium text-gray-900 dark:text-gray-100 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[t.jsx(se,{className:"h-4 w-4"}),d("crypto.allRewards","All Rewards")," (",$.length,")",m?t.jsx(ne,{className:"h-4 w-4"}):t.jsx(J,{className:"h-4 w-4"})]}),S.length>0&&t.jsxs("button",{type:"button",onClick:()=>_.mutate(S.map(e=>e.id)),disabled:_.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 rounded-lg transition-colors",children:[_.isPending?t.jsx(le,{className:"h-3.5 w-3.5 animate-spin"}):t.jsx(ee,{className:"h-3.5 w-3.5"}),d("crypto.createAllTransactions","Create All Txns")," (",S.length,")"]})]}),m&&t.jsxs(t.Fragment,{children:[h&&t.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(te,{className:"h-4 w-4"}),h]}),b&&t.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[t.jsx(ie,{className:"h-4 w-4"}),b]}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:$.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Number(e.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})," ",e.reward_token_symbol||"tokens"]}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[new Date(e.claimed_at).toLocaleDateString()," via ",e.source,e.reward_usd&&t.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(e.reward_usd).toFixed(2)]})]})]}),e.reward_usd&&Number(e.reward_usd)>0&&t.jsx("div",{className:"flex-shrink-0 ml-3",children:e.transaction_id?t.jsxs("a",{href:`/transactions?id=${e.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[t.jsx(H,{className:"h-3 w-3"}),d("crypto.viewTransaction","View Txn")]}):t.jsxs("button",{type:"button",onClick:()=>{y(e.id),w.mutate(e.id)},disabled:g===e.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[g===e.id?t.jsx(le,{className:"h-3 w-3 animate-spin"}):t.jsx(se,{className:"h-3 w-3"}),d("crypto.createTransaction","Create Txn")]})})]},e.id))})]})]}),v&&0===$.length&&t.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[t.jsx(de,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),P<1?d("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:1}):d("crypto.noRewards","No rewards claimed for this position yet.")]})]})}function Oe({source:e="symbiotic"}){var n,l;const{t:d}=F(),o=r(),[c,x]=i.useState(null),{data:m,isLoading:u}=a({queryKey:["staking-rewards",e],queryFn:()=>I(e)}),g=s({mutationFn:()=>z(90),onSuccess:e=>{x({scanned:e.scanned_claims,new:e.new_claims}),o.invalidateQueries({queryKey:["staking-rewards"]}),setTimeout(()=>x(null),5e3)}});if(u)return t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const y=e=>{if(null==e)return null;const t=Number(e);return isNaN(t)?null:`$${t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},h=e=>{const[t,r]=e.split("-");return new Date(Number(t),Number(r)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},p=e=>Number(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4}),b="symbiotic"===e?"Symbiotic":e,j=(null==(n=null==m?void 0:m.rewards_by_token)?void 0:n.filter(e=>Number(e.amount_usd)>=1))||[],v=(null==(l=null==m?void 0:m.rewards_by_month)?void 0:l.filter(e=>Number(e.amount_usd)>=1))||[],f=j.reduce((e,t)=>e+Number(t.amount_usd||0),0);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[t.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:d("crypto.scanStakingRewardsHint","Scan blockchain for claimed staking rewards")}),t.jsx("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:g.isPending?t.jsxs(t.Fragment,{children:[t.jsx(G,{className:"h-4 w-4 animate-spin"}),d("crypto.scanning","Scanning...")]}):t.jsxs(t.Fragment,{children:[t.jsx(G,{className:"h-4 w-4"}),d("crypto.scanRewards","Scan Rewards")]})})]}),c&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(te,{className:"h-4 w-4"}),d("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",c)]}),m&&j.length>0&&t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4"}),d("crypto.stakingRewardsSummary","{{source}} Rewards Summary",{source:b})]}),t.jsx("div",{className:"space-y-3",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:d("crypto.totalRewards","Total Rewards")}),j.length>0?t.jsx("div",{className:"space-y-1",children:j.map(e=>{const r=y(e.amount_usd);return t.jsxs("div",{children:[t.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[p(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",r]})]},e.symbol)})}):t.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:y(f)||"-"}),t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[v.reduce((e,t)=>e+t.count,0)," ",d("crypto.claims","claims")]})]})})]}),m&&v.length>0&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[t.jsx(ae,{className:"h-4 w-4"}),d("crypto.monthlyBreakdown","Monthly Breakdown")]}),t.jsx("div",{className:"space-y-2",children:v.map(e=>{const r=y(e.amount_usd);return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:h(e.month)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.count," ",d("crypto.claims","claims")]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[p(e.amount)," ",e.symbol]}),r&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",r]})]})]},`${e.month}-${e.symbol}`)})})]}),m&&0===j.length&&t.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[t.jsx(de,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:f<1?d("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:1}):d("crypto.noStakingRewards","No staking rewards found")}),t.jsx("p",{className:"text-sm",children:d("crypto.noStakingRewardsHint",'Click "Scan Rewards" to search for claimed rewards on the blockchain.')})]})]})}async function Ue(){return(await w.get("/api/crypto/positions/closed")).data}function Ve({group:e,lastSnapshotValueUsd:n,costBasisUsd:l,totalRewardsUsd:o,onClose:c,onSuccess:x}){var m;const{t:g}=F("common"),{data:y}=u(),h=(null==(m=null==y?void 0:y.rates)?void 0:m.USD)||150,p=r(),[b,j]=i.useState((new Date).toISOString().slice(0,16)),[v,f]=i.useState(n),[N,k]=i.useState(Math.round(n*h)),[S,C]=i.useState(null),[D,$]=i.useState(`LP Exit: ${e.protocol} ${e.name}`),[P,A]=i.useState("");i.useEffect(()=>{k(Math.round(v*h))},[v,h]);const{data:q}=a({queryKey:["accounts"],queryFn:()=>_()}),L=(null==q?void 0:q.filter(e=>e.is_active&&("bank"===e.type||"savings"===e.type)))||[],M=null!==l?v-l+(o||0):null,B=l&&null!==M?M/l*100:null,z=e.tokens[0],R=(null==z?void 0:z.id)||"",T=(null==z?void 0:z.wallet_address)||"",K=s({mutationFn:()=>{if(!S)throw new Error(g("crypto.selectAccount","Select destination account"));const t={exit_date:new Date(b).toISOString(),exit_value_usd:v,exit_value_jpy:N,destination_account_id:S,note:D||void 0,tx_hash:P||void 0,wallet_address:T,chain_id:e.chain_id,protocol:e.protocol,symbol:e.name};return async function(e,t){return(await w.post(`/api/crypto/positions/${encodeURIComponent(e)}/close`,t)).data}(R,t)},onSuccess:()=>{p.invalidateQueries({queryKey:["closed-positions"]}),p.invalidateQueries({queryKey:["defi-positions"]}),p.invalidateQueries({queryKey:["accounts"]}),x(),c()}}),E=t.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-hidden",style:{touchAction:"pan-y"},children:[t.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:c}),t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:g("crypto.closePosition","Close Position")}),t.jsx("button",{onClick:c,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:t.jsx(ie,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[t.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.protocol," - ",e.name]}),t.jsx("p",{className:"text-xs text-gray-500",children:e.chain_id.toUpperCase()})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t.jsx(ae,{className:"w-4 h-4 inline mr-1"}),g("crypto.exitDate","Exit Date")]}),t.jsx("input",{type:"datetime-local",value:b,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t.jsx(oe,{className:"w-4 h-4 inline mr-1"}),g("crypto.exitValue","Exit Value")," (USD)"]}),t.jsx("input",{type:"number",step:"0.01",value:v,onChange:e=>f(parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[g("crypto.exitValue","Exit Value")," (JPY)"]}),t.jsx("input",{type:"number",value:N,onChange:e=>k(parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t.jsx(W,{className:"w-4 h-4 inline mr-1"}),g("crypto.destinationAccount","Destination Account")]}),t.jsxs("select",{value:S||"",onChange:e=>C(parseInt(e.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:g("common.select","Select...")}),L.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:g("common.note","Note")}),t.jsx("input",{type:"text",value:D,onChange:e=>$(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["TX Hash (",g("common.optional","optional"),")"]}),t.jsx("input",{type:"text",value:P,onChange:e=>A(e.target.value),placeholder:"0x...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-sm"})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:g("crypto.pnlPreview","P&L Preview")}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:g("crypto.costBasis","Cost Basis")}),t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:null!==l?`$${l.toFixed(2)}`:"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:g("crypto.totalRewards","Total Rewards")}),t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:o?`$${o.toFixed(2)}`:"$0.00"})]}),t.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("p",{className:"text-gray-500",children:g("crypto.realizedPnl","Realized P&L")}),t.jsx("p",{className:"text-lg font-bold "+(null!==M?M>=0?"text-green-600":"text-red-600":"text-gray-400"),children:null!==M?`${M>=0?"+":""}$${M.toFixed(2)} (${null==B?void 0:B.toFixed(1)}%)`:"N/A"})]})]})]}),K.error&&t.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[t.jsx(ce,{className:"w-4 h-4"}),K.error.message]})]}),t.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",children:g("common.cancel","Cancel")}),t.jsx("button",{onClick:()=>K.mutate(),disabled:!S||K.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:K.isPending?g("common.loading","Loading..."):g("crypto.confirmClose","Confirm Close")})]})]})]});return"undefined"==typeof document?null:d.createPortal(E,document.body)}function Ye({group:e,onClose:r}){const[s,l]=i.useState("overview"),[o,c]=i.useState(!1),x=e.tokens[0],m=n({queries:e.tokens.map(e=>({queryKey:["position-history",e.id],queryFn:()=>Q(e.id,30),retry:!1}))}),u=m.some(e=>e.isLoading),g=i.useMemo(()=>{const e=m.filter(e=>{var t;return null==(t=e.data)?void 0:t.snapshots}).flatMap(e=>e.data.snapshots);if(0===e.length)return null;const t=new Map;for(const r of e){const e=t.get(r.snapshot_date)||0;t.set(r.snapshot_date,e+Number(r.balance_usd))}return{snapshots:Array.from(t.entries()).map(([e,t])=>({snapshot_date:e,balance_usd:t}))}},[m]),p=n({queries:e.tokens.map(e=>({queryKey:["position-performance",e.id],queryFn:()=>O(e.id),retry:!1}))}),b=p.some(e=>e.isLoading),j=p.every(e=>!e.isLoading),f=i.useMemo(()=>{if(!j)return null;const t=p.filter(e=>e.data);if(0===t.length)return null;const r=t[0].data;if(1===t.length)return r;let a=0,s=0,n=0,l=0,i=0,d=!1,o=0,c=0;for(const e of t){const t=e.data;a+=Number(t.start_value_usd),s+=Number(t.current_value_usd),n+=Number(t.total_return_usd),l=Math.max(l,t.days_held),i+=t.snapshot_count,null!=t.il_usd&&(d=!0,o+=Number(t.il_usd)),null!=t.hodl_value_usd&&(c+=Number(t.hodl_value_usd))}const x=a>0?n/a*100:0;let m=null;if(l>=7&&a>0){const e=100*((s/a)**(365/l)-1);Math.abs(e)<=500&&(m=e)}return{position_id:r.position_id,protocol:r.protocol,symbol:e.name,days_held:l,start_value_usd:a,current_value_usd:s,total_return_usd:n,total_return_pct:x,annualized_return_pct:m,current_apy:r.current_apy,snapshot_count:i,il_percentage:d&&a>0?o/a*100:null,il_usd:d?o:null,hodl_value_usd:d?c:null,lp_vs_hodl_usd:d?s-c:null,lp_outperformed_hodl:d?s>c:void 0}},[p,e.name,j]),{data:N}=a({queryKey:["position-roi",x.id],queryFn:()=>K(x.id),retry:!1}),k=u||b,w=e=>{const t=Number(e.balance);return t<1e-4?"<0.0001":t<1?t.toFixed(4):t.toFixed(2)},_=t.jsxs("div",{className:"fixed inset-0 z-[100001]",children:[t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),t.jsx("div",{className:"fixed inset-0 z-[100002] flex items-center justify-center p-4 overflow-y-auto",children:t.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90dvh] my-auto overflow-hidden",children:[t.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 dark:from-gray-800 dark:to-gray-900 p-6 text-white",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"flex -space-x-2",children:e.tokens.slice(0,3).map((r,a)=>r.logo_url?t.jsx("img",{src:r.logo_url,alt:r.symbol,className:"w-10 h-10 rounded-full border-2 border-white/20",style:{zIndex:e.tokens.length-a}},r.id):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",style:{zIndex:e.tokens.length-a},children:r.symbol.slice(0,2)},r.id))}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold",children:e.protocol}),t.jsx("p",{className:"text-gray-400 text-sm",children:e.name})]})]}),t.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:t.jsx(ie,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"text-center py-4",children:[t.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Current Value"}),t.jsxs("p",{className:"text-4xl font-bold",children:["$",e.total_usd.toFixed(2)]}),t.jsx("div",{className:"flex items-center justify-center gap-2 mt-2 text-sm",children:t.jsx("span",{className:"text-gray-400",children:e.tokens.map((e,r)=>t.jsxs("span",{children:[r>0&&" + ",w(e)," ",e.symbol]},e.id))})})]})]}),t.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:()=>l("overview"),className:h("flex-1 px-4 py-3 text-sm font-medium transition-colors","overview"===s?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:"Gain/Loss"}),t.jsxs("button",{onClick:()=>l("rewards"),className:h("flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2","rewards"===s?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:[t.jsx(de,{className:"w-4 h-4"}),"Rewards"]})]}),t.jsx("div",{className:"p-4 space-y-4 max-h-[50vh] overflow-y-auto",children:k?t.jsx("div",{className:"flex justify-center py-12",children:t.jsx(v,{size:"lg"})}):t.jsxs(t.Fragment,{children:["overview"===s&&t.jsxs(t.Fragment,{children:[f&&t.jsxs(y,{className:"overflow-hidden",children:[t.jsxs("div",{className:h("p-4 text-center",Number(f.total_return_pct)>=0?"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20":"bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20"),children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[Number(f.total_return_pct)>=0?t.jsx(xe,{className:"w-5 h-5 text-green-600"}):t.jsx(me,{className:"w-5 h-5 text-red-600"}),t.jsx("span",{className:h("text-sm font-medium",Number(f.total_return_pct)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:"Total Return"})]}),t.jsxs("p",{className:h("text-3xl font-bold",Number(f.total_return_pct)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[Number(f.total_return_pct)>=0?"+":"",f.total_return_pct.toFixed(2),"%"]}),t.jsxs("p",{className:h("text-lg font-semibold mt-1",Number(f.total_return_usd)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:[Number(f.total_return_usd)>=0?"+":"","$",Math.abs(Number(f.total_return_usd)).toFixed(2)]})]}),t.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[t.jsx(oe,{className:"w-3.5 h-3.5"}),"Invested"]}),t.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",Number(f.start_value_usd).toFixed(2)]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[t.jsx(ue,{className:"w-3.5 h-3.5"}),"Duration"]}),t.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[f.days_held," days"]})]})]})]}),f&&null!==f.annualized_return_pct&&t.jsx(y,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ge,{className:"w-4 h-4 text-indigo-500"}),t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Annualized Return"})]}),t.jsxs("span",{className:h("font-bold text-lg",Number(f.annualized_return_pct)>=0?"text-green-600":"text-red-600"),children:[Number(f.annualized_return_pct)>=0?"+":"",f.annualized_return_pct.toFixed(2),"%"]})]})}),f&&null!=f.current_apy&&t.jsx(y,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"w-4 h-4 text-purple-500"}),t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current APY"})]}),t.jsxs("span",{className:"font-bold text-lg text-purple-600 dark:text-purple-400",children:[Number(f.current_apy).toFixed(2),"%"]})]})}),g&&g.snapshots.length>0&&t.jsxs(y,{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-3",children:"30-Day Performance"}),t.jsx("div",{className:"h-40",children:t.jsx(Ie,{snapshots:g.snapshots})})]}),t.jsx("button",{onClick:()=>c(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Close Position"})]}),"rewards"===s&&t.jsx(t.Fragment,{children:"staked"===e.protocol_module?t.jsx(Oe,{source:"symbiotic"}):t.jsx(Qe,{positionId:x.id})})]})}),o&&t.jsx(Ve,{group:e,lastSnapshotValueUsd:e.total_usd,costBasisUsd:(null==N?void 0:N.cost_basis_usd)??null,totalRewardsUsd:(null==N?void 0:N.total_rewards_usd)??null,onClose:()=>c(!1),onSuccess:()=>{c(!1),r()}})]})})]});return"undefined"==typeof document?null:d.createPortal(_,document.body)}function We({walletId:e}){const{t:n}=F(),l=r(),[d,o]=i.useState(new Set),[c,x]=i.useState(""),{data:m=[]}=a({queryKey:["unattributed-rewards"],queryFn:V}),{data:u}=a({queryKey:["defi-positions",e],queryFn:()=>Y(e),enabled:!!e}),g=s({mutationFn:({rewardIds:e,positionId:t})=>U(e,t),onSuccess:()=>{l.invalidateQueries({queryKey:["unattributed-rewards"]}),l.invalidateQueries({queryKey:["position-rewards"]}),o(new Set),x("")}}),[y,h]=i.useState(null),[p,b]=i.useState(null),[j,v]=i.useState(null),f=s({mutationFn:e=>R(e),onSuccess:e=>{b(n("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:e.amount_usd.toFixed(2)})),l.invalidateQueries({queryKey:["unattributed-rewards"]}),l.invalidateQueries({queryKey:["transactions"]}),h(null),setTimeout(()=>b(null),5e3)},onError:e=>{v(e.message||n("crypto.transactionCreateError","Failed to create transaction")),h(null),setTimeout(()=>v(null),5e3)}});if(0===m.length)return null;const N=m.filter(e=>Number(e.reward_usd||0)>=1);if(0===N.length)return null;const k=(null==u?void 0:u.positions)||[],w=e=>`${Number(e.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})} ${e.reward_token_symbol||"tokens"}`,_=N.length>0&&d.size===N.length,S=d.size>0;return t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(ye,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),t.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:n("crypto.unattributedRewards",{count:N.length})})]}),t.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:n("crypto.unattributedRewardsDesc","These rewards need to be assigned to a position for ROI tracking.")}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-yellow-100 dark:border-gray-700",children:[t.jsxs("button",{type:"button",onClick:()=>{d.size===N.length?o(new Set):o(new Set(N.map(e=>e.id)))},className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[_?t.jsx(he,{className:"h-4 w-4 text-primary-600"}):t.jsx(pe,{className:"h-4 w-4"}),_?n("common.deselectAll","Deselect All"):n("common.selectAll","Select All")]}),t.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[t.jsxs("select",{value:c,onChange:e=>x(e.target.value),disabled:!S,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx("option",{value:"",children:n("crypto.selectPosition","Select position...")}),k.map(e=>t.jsxs("option",{value:e.id,children:[e.protocol," - ",e.symbol]},e.id))]}),t.jsxs("button",{type:"button",onClick:()=>{0!==d.size&&c&&g.mutate({rewardIds:Array.from(d),positionId:c})},disabled:!S||!c||g.isPending,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-md transition-colors disabled:cursor-not-allowed",children:[t.jsx(be,{className:"h-4 w-4"}),g.isPending?n("common.assigning","Assigning..."):n("crypto.assignSelected","Assign {{count}} Selected",{count:d.size})]})]})]}),p&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[t.jsx(te,{className:"h-4 w-4"}),p]}),j&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[t.jsx(ie,{className:"h-4 w-4"}),j]}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.map(e=>{return t.jsxs("div",{onClick:()=>(e=>{const t=new Set(d);t.has(e)?t.delete(e):t.add(e),o(t)})(e.id),className:"flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-colors "+(d.has(e.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700":"bg-white dark:bg-gray-800 border-yellow-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"),children:[t.jsx("div",{className:"flex-shrink-0",children:d.has(e.id)?t.jsx(he,{className:"h-5 w-5 text-primary-600"}):t.jsx(pe,{className:"h-5 w-5 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:w(e)}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(r=e.claimed_at,new Date(r).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}))," via ",e.source,e.reward_usd&&t.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(e.reward_usd).toFixed(2)]})]})]}),e.reward_usd&&e.reward_usd>0&&t.jsx("div",{className:"flex-shrink-0",onClick:e=>e.stopPropagation(),children:e.transaction_id?t.jsxs("a",{href:`/transactions?id=${e.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[t.jsx(H,{className:"h-3 w-3"}),n("crypto.viewTransaction","View Txn")]}):t.jsxs("button",{type:"button",onClick:()=>{h(e.id),f.mutate(e.id)},disabled:y===e.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[y===e.id?t.jsx(le,{className:"h-3 w-3 animate-spin"}):t.jsx(se,{className:"h-3 w-3"}),n("crypto.createTransaction","Create Txn")]})})]},e.id);var r})}),S&&t.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200 dark:border-gray-700 text-sm text-yellow-700 dark:text-yellow-300",children:n("crypto.selectedRewards","{{count}} reward(s) selected",{count:d.size})})]})}const He={deposit:"ðŸ’°",stake:"ðŸ”’",borrow:"ðŸ’¸",reward:"ðŸŽ",liquidity:"ðŸ’§"},Je={liquidity_pool:"LP",staking:"Staking",lending:"Lending",farming:"Farming",vault:"Vault"};function Xe({group:e,onClick:r,isPrivacyMode:a}){const s=e.chain_id,n=$[s],l=e.tokens[0],i=a?e.tokens.map(e=>`*** ${e.symbol}`).join(" + "):e.tokens.map(e=>{const t=Number(e.balance);return`${t<1e-4?"<0.0001":t<1?t.toFixed(4):t.toFixed(2)} ${e.symbol}`}).join(" + ");return t.jsxs("button",{onClick:()=>r(e),className:"w-full flex items-center justify-between py-3 px-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors text-left group",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("div",{className:"relative flex-shrink-0",children:e.tokens.length>1?t.jsxs("div",{className:"flex -space-x-2",children:[e.tokens.slice(0,3).map((r,a)=>r.logo_url?t.jsx("img",{src:r.logo_url,alt:r.symbol,className:"w-7 h-7 rounded-full border-2 border-white dark:border-gray-800",style:{zIndex:e.tokens.length-a},onError:e=>{e.target.style.display="none"}},r.id):t.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border-2 border-white dark:border-gray-800",style:{zIndex:e.tokens.length-a},children:r.symbol.slice(0,2)},r.id)),e.tokens.length>3&&t.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",e.tokens.length-3]})]}):l.logo_url?t.jsx("img",{src:l.logo_url,alt:l.symbol,className:"w-8 h-8 rounded-full",onError:e=>{e.target.style.display="none"}}):t.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:He[e.position_type]||"ðŸ“ˆ"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.protocol}),t.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:Je[e.protocol_module]||e.protocol_module})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[t.jsx("span",{className:"truncate",children:e.name}),n&&t.jsxs("span",{className:"text-xs px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:[n.icon," ",s.toUpperCase()]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a?"$***":`$${e.total_usd.toFixed(2)}`}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[180px] truncate",children:i})]}),t.jsx(X,{className:"w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors"})]})]})}function Ge(){const{t:e}=F("common"),{currency:r}=j(),{isPrivacyMode:s}=g(),[n,l]=i.useState(null),d=b(),{data:o,isLoading:c}=a({queryKey:["crypto-wallets"],queryFn:L}),{data:x=[]}=a({queryKey:["unattributed-rewards"],queryFn:V}),{data:m,isLoading:u,refetch:y}=a({queryKey:["crypto-defi-positions",null==o?void 0:o.map(e=>e.id)],queryFn:async()=>{if(!o||0===o.length)return[];return await Promise.all(o.map(e=>Y(e.id).catch(()=>({wallet_address:e.wallet_address,total_value_usd:0,positions:[],last_sync_at:null}))))},enabled:!!o&&o.length>0}),h=(null==m?void 0:m.flatMap(e=>e.positions))||[],f=function(e){const t={};for(const r of e){const e=`${r.protocol}-${r.chain_id}-${r.name||r.token_name}-${r.position_type}`;t[e]||(t[e]={key:e,name:r.name||r.token_name,protocol:r.protocol,protocol_module:r.protocol_module,position_type:r.position_type,chain_id:r.chain_id,tokens:[],total_usd:0}),t[e].tokens.push(r),t[e].total_usd+=Number(r.balance_usd)}return Object.values(t)}(h),N=(null==m?void 0:m.reduce((e,t)=>e+Number(t.total_value_usd||0),0))||0,k=1/((null==d?void 0:d.USD)||.00667),w=Math.round(N*k),_=f.reduce((e,t)=>{const r=t.protocol;return e[r]||(e[r]=[]),e[r].push(t),e},{});if(c||u)return t.jsx(D,{title:e("crypto.defiPositions"),badge:0,children:t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(v,{size:"md"})})});if(!o||0===o.length)return null;const S=x.length>0?`${f.length} Â· ${x.length} âš `:f.length;return t.jsxs(D,{title:e("crypto.defiPositions"),badge:S,defaultOpen:f.length>0,children:[h.length>0&&t.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e("crypto.totalDefiValue")}),t.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:p(w,r,d,!1,s)})]}),t.jsx("button",{onClick:()=>y(),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors",title:e("crypto.refresh"),children:t.jsx(G,{className:"w-5 h-5"})})]})}),o[0]&&t.jsx("div",{className:"mb-4",children:t.jsx(We,{walletId:o[0].id})}),f.length>0?t.jsx("div",{className:"space-y-4",children:Object.entries(_).sort(([,e],[,t])=>{const r=e.reduce((e,t)=>e+t.total_usd,0);return t.reduce((e,t)=>e+t.total_usd,0)-r}).map(([e,r])=>t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[t.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:e}),t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:s?"$***":`$${r.reduce((e,t)=>e+t.total_usd,0).toFixed(2)}`})]})}),t.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:r.sort((e,t)=>t.total_usd-e.total_usd).map(e=>t.jsx(Xe,{group:e,onClick:l,isPrivacyMode:s},e.key))})]},e))}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(je,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e("crypto.noDefiPositions")}),t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:e("crypto.noDefiPositionsDescription")})]}),n&&t.jsx(Ye,{group:n,onClose:()=>l(null)})]})}function Ze(){const{t:e}=F("common"),[r,s]=i.useState(!1),{data:n,isLoading:l}=a({queryKey:["closed-positions"],queryFn:Ue});return l||!n||0===n.total_closed?null:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[t.jsxs("button",{onClick:()=>s(!r),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-xl",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ve,{className:"w-5 h-5 text-gray-500"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:e("crypto.closedPositions","Closed Positions")}),t.jsxs("p",{className:"text-sm text-gray-500",children:[n.total_closed," ",e("crypto.positions","positions")]})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[null!==n.total_realized_pnl_jpy&&t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-xs text-gray-500",children:e("crypto.totalPnl","Total P&L")}),t.jsxs("p",{className:"font-medium "+(n.total_realized_pnl_jpy>=0?"text-green-600":"text-red-600"),children:[n.total_realized_pnl_jpy>=0?"+":"",S(n.total_realized_pnl_jpy,"JPY")]})]}),r?t.jsx(ne,{className:"w-5 h-5 text-gray-500"}):t.jsx(J,{className:"w-5 h-5 text-gray-500"})]})]}),r&&t.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 space-y-3",children:n.positions.map(e=>{const r=$[e.chain_id],a=null!==e.realized_pnl_jpy&&e.realized_pnl_jpy>=0;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[e.protocol," - ",e.symbol]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[r&&t.jsx("span",{children:r.icon}),t.jsx("span",{children:new Date(e.exit_date).toLocaleDateString()})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:S(e.exit_value_jpy,"JPY")}),null!==e.realized_pnl_jpy&&t.jsxs("div",{className:"flex items-center justify-end gap-1 text-sm "+(a?"text-green-600":"text-red-600"),children:[a?t.jsx(re,{className:"w-3 h-3"}):t.jsx(fe,{className:"w-3 h-3"}),a?"+":"",S(e.realized_pnl_jpy,"JPY"),null!==e.realized_pnl_pct&&t.jsxs("span",{className:"text-xs",children:["(",e.realized_pnl_pct.toFixed(1),"%)"]})]})]})]},e.id)})})]})}async function et(e){return(await w.post("/api/transfers/",e)).data}const tt={JPY:"Â¥",USD:"$",VND:"â‚«"};function rt(e){const t=e.replace(/[^\d]/g,"");return t?parseInt(t).toLocaleString("en-US"):""}function at(e){return parseInt(e.replace(/[,.\s]/g,""),10)||0}function st({isOpen:e,onClose:a}){const{t:n}=F("common"),l=r(),{data:o}=m(),c=b(),[x,u]=i.useState(null),[g,y]=i.useState(null),[p,j]=i.useState(""),[v,f]=i.useState(""),[k,w]=i.useState(""),[_,S]=i.useState((new Date).toISOString().split("T")[0]),[D,$]=i.useState(""),[P,A]=i.useState({}),q=i.useMemo(()=>null==o?void 0:o.find(e=>e.id===x),[o,x]),L=i.useMemo(()=>null==o?void 0:o.find(e=>e.id===g),[o,g]),M=i.useMemo(()=>(null==o?void 0:o.filter(e=>e.id!==x))||[],[o,x]);i.useEffect(()=>{if(!(q&&L&&p&&c))return;const e=at(p);if(e<=0)return;if(q.currency===L.currency)return void f(rt(e.toString()));const t=c[q.currency]||1,r=c[L.currency]||1,a=e/t,s=Math.round(a*r);f(rt(s.toString()))},[q,L,p,c]),i.useEffect(()=>{var t;e&&(u((null==(t=null==o?void 0:o[0])?void 0:t.id)||null),y(null),j(""),f(""),w(""),S((new Date).toISOString().split("T")[0]),$(""),A({}))},[e,o]);const B=s({mutationFn:et,onSuccess:()=>{l.invalidateQueries({queryKey:["accounts"]}),l.invalidateQueries({queryKey:["transactions"]}),l.invalidateQueries({queryKey:["transfers"]}),l.invalidateQueries({queryKey:["analytics"]}),a()}});if(!e)return null;const z=t.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/50 animate-modal-backdrop",onClick:a}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:n("transfer.title")}),t.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:t.jsx(ie,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return x||(e.fromAccount=n("transfer.errors.fromRequired")),g||(e.toAccount=n("transfer.errors.toRequired")),x&&g&&x===g&&(e.toAccount=n("transfer.errors.sameAccount")),(!p||at(p)<=0)&&(e.fromAmount=n("transfer.errors.amountRequired")),(!v||at(v)<=0)&&(e.toAmount=n("transfer.errors.amountRequired")),A(e),0===Object.keys(e).length})())return;const t=(null==q?void 0:q.currency)||"JPY",r=(null==L?void 0:L.currency)||"JPY",a={from_account_id:x,to_account_id:g,from_amount:C(at(p),t),to_amount:C(at(v),r),fee_amount:C(at(k)||0,t),date:_,description:D.trim()||void 0};q&&L&&q.currency!==L.currency&&(a.exchange_rate=at(v)/at(p)),B.mutate(a)},className:"p-6 space-y-5",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.fromAccount")}),t.jsxs("select",{value:x||"",onChange:e=>u(e.target.value?parseInt(e.target.value):null),className:h("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",P.fromAccount?"border-red-500":"border-gray-300"),children:[t.jsx("option",{value:"",children:n("transfer.selectAccount")}),null==o?void 0:o.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",tt[e.currency]||e.currency,")"]},e.id))]}),P.fromAccount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:P.fromAccount})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(Ne,{className:"w-6 h-6 text-gray-400"})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.toAccount")}),t.jsxs("select",{value:g||"",onChange:e=>y(e.target.value?parseInt(e.target.value):null),className:h("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",P.toAccount?"border-red-500":"border-gray-300"),children:[t.jsx("option",{value:"",children:n("transfer.selectAccount")}),M.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",tt[e.currency]||e.currency,")"]},e.id))]}),P.toAccount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:P.toAccount})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.amount")}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:q?tt[q.currency]||q.currency:"Â¥"}),t.jsx("input",{type:"text",inputMode:"numeric",value:p,onChange:e=>j(rt(e.target.value)),className:h("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",P.fromAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),P.fromAmount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:P.fromAmount})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.convertedAmount")}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:L?tt[L.currency]||L.currency:"Â¥"}),t.jsx("input",{type:"text",inputMode:"numeric",value:v,onChange:e=>f(rt(e.target.value)),className:h("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",P.toAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),P.toAmount&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:P.toAmount})]})]}),q&&L&&q.currency!==L.currency&&p&&v&&t.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["1 ",q.currency," â‰ˆ ",(at(v)/at(p)).toFixed(4)," ",L.currency]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("transfer.fee")," (",n("common.optional"),")"]}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:q?tt[q.currency]||q.currency:"Â¥"}),t.jsx("input",{type:"text",inputMode:"numeric",value:k,onChange:e=>w(rt(e.target.value)),className:"w-full h-12 pl-10 pr-4 border border-gray-300 rounded-lg text-right dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:"0"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("transfer.date")}),t.jsx("input",{type:"date",value:_,onChange:e=>S(e.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("transfer.description")," (",n("common.optional"),")"]}),t.jsx("input",{type:"text",value:D,onChange:e=>$(e.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:n("transfer.descriptionPlaceholder")})]}),B.isError&&t.jsx("p",{className:"text-sm text-red-500 text-center",children:n("transfer.error")}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx(N,{type:"button",variant:"outline",onClick:a,className:"flex-1 h-12",children:n("common.cancel")}),t.jsx(N,{type:"submit",loading:B.isPending,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700",children:n("transfer.create")})]})]})]})]});return"undefined"==typeof document?null:d.createPortal(z,document.body)}const nt="accounts_collapsed_sections";const lt=l("/accounts")({component:function(){const{t:e}=F("common"),[r,a]=i.useState(!1),[s,n]=i.useState(!1),[l,d]=i.useState(!1),[o,c]=i.useState(!1),[x,u]=i.useState(!1),[g,y]=i.useState(null),[h,p]=i.useState(()=>function(){try{const e=localStorage.getItem(nt);if(e)return new Set(JSON.parse(e))}catch{}return new Set}());i.useEffect(()=>{var e;e=h,localStorage.setItem(nt,JSON.stringify([...e]))},[h]),i.useEffect(()=>{const e=()=>{c(!0)},t=()=>{u(!0)};return window.addEventListener("open-add-transaction-modal",e),window.addEventListener("open-receipt-scanner",t),()=>{window.removeEventListener("open-add-transaction-modal",e),window.removeEventListener("open-receipt-scanner",t)}},[]);const b=i.useCallback(e=>{p(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),{data:j,isLoading:v,error:f}=m(r),N=()=>{y(null),n(!0)},k=e=>{y(e),n(!0)},w=null==j?void 0:j.reduce((e,t)=>{const r=t.type;return e[r]||(e[r]=[]),e[r].push(t),e},{});return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:e("account.accounts")}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:e("account.manageYourAccounts")})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(ke,{className:"w-5 h-5"}),e("transfer.title")]}),t.jsxs("button",{onClick:N,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),e("account.createAccount")]})]})]}),t.jsx("div",{className:"mt-4 flex items-center gap-4",children:t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r,onChange:e=>a(e.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 dark:bg-gray-700"}),e("account.showInactive")]})})]}),v&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),f&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:t.jsxs("p",{className:"text-red-700 dark:text-red-400",children:[e("account.errors.loadFailed"),": ",f.message]})}),!v&&!f&&(!j||0===j.length)&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-700 mb-4",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-gray-400",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z"})})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:e("account.noAccounts")}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:e("account.createFirstAccount")}),t.jsxs("button",{onClick:N,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),e("account.createAccount")]})]}),!v&&!f&&j&&j.length>0&&t.jsxs("div",{className:"space-y-8",children:[["bank","savings","cash","credit_card","investment","crypto","receivable","other"].map(r=>{const a=null==w?void 0:w[r];if(!a||0===a.length)return null;const s=h.has(r);return t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:()=>b(r),className:"w-full flex items-center justify-between mb-4 group cursor-pointer",children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e(`account.type.${r}`),t.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",a.length,")"]})]}),t.jsx(J,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform duration-200 "+(s?"-rotate-90":"")})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 transition-all duration-200 ease-in-out "+(s?"max-h-0 opacity-0 overflow-hidden":"max-h-[2000px] opacity-100"),children:a.map(e=>t.jsx(Le,{account:e,onEdit:k},e.id))})]},r)}),t.jsx(Ee,{}),t.jsx(Ge,{}),t.jsx(Ze,{})]}),!v&&!f&&(!j||0===j.length)&&t.jsxs("div",{className:"mt-8 space-y-6",children:[t.jsx(Ee,{}),t.jsx(Ge,{}),t.jsx(Ze,{})]}),t.jsx(Re,{isOpen:s,onClose:()=>{n(!1),y(null)},editingAccountId:g}),t.jsx(st,{isOpen:l,onClose:()=>d(!1)}),t.jsx(Pe,{isOpen:o,onClose:()=>c(!1)}),t.jsx(Ae,{isOpen:x,onClose:()=>u(!1),onScanComplete:()=>u(!1)})]})}});export{lt as Route};
