import{e as Ye,j as e,c as Y,u as I,k as O,o as Ae,m as Ge}from"./vendor-tanstack-DOuiVnRb.js";import{r as p,a as oe}from"./vendor-react-B9eo89kj.js";import{a4 as Be,m as ce,C as Xe,c as K,v as U,a7 as Ze,a8 as et,a9 as tt,l as xe,p as fe,A as st,D as rt,F as at,L as H,I as De,B as te,J as Ee,aa as nt,ab as lt,ac as it,ad as dt,ae as Ie,af as ze,ag as ot,ah as Ke,ai as ct,aj as xt,a as Ne,b as mt,ak as ut,al as gt,am as yt,an as ht,ao as Ve,ap as Oe,Y as ue,u as We,j as ge}from"./index-Cyepc-vJ.js";import{u as z}from"./vendor-i18n-CtQU9zWU.js";import{C as ie,a as se}from"./crypto-Dbpx5UD4.js";import{W as pe,ab as ve,x as G,K as Qe,_ as J,t as pt,P as Ue,ac as bt,w as me,r as re,u as ke,J as de,A as we,R as be,L as je,X as ae,ad as _e,ae as jt,C as ft,z as Se,e as Pe,af as $e,ag as Le,ah as Nt,ai as vt,aj as kt,O as wt,ak as _t}from"./vendor-icons-Boynwk5e.js";import{R as St,L as Ct,C as Ft,X as At,Y as Dt,T as Pt,a as $t}from"./vendor-recharts-BfEtinVu.js";import"./vendor-date-fteVm545.js";const Lt={bank:{icon:"ðŸ¦",color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/30"},cash:{icon:"ðŸ’µ",color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/30"},credit_card:{icon:"ðŸ’³",color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/30"},investment:{icon:"ðŸ“ˆ",color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/30"},receivable:{icon:"ðŸ’°",color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/30"},savings:{icon:"ðŸ·",color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/30"},crypto:{icon:"â‚¿",color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/30"},other:{icon:"ðŸ“",color:"text-gray-600",bgColor:"bg-gray-50 dark:bg-gray-700"}};function Mt({account:t,onEdit:s}){const{t:r}=z("common"),a=Ye(),{data:d}=Be(),{isPrivacyMode:x}=ce(),n=Lt[t.type],b=t.current_balance>=0,u=()=>{const f=new Date,k=`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}`;a({to:"/transactions",search:{accountId:t.id,month:k,fromAccounts:!0}})};return e.jsxs(Xe,{className:"relative hover:shadow-md transition-shadow cursor-pointer",onClick:u,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:K("p-3 rounded-lg",n.bgColor),children:e.jsx("span",{className:"text-2xl",children:n.icon})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:K("text-sm",n.color),children:r(`account.type.${t.type}`)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx("button",{onClick:f=>{f.stopPropagation(),s(t.id)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":r("account.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),!t.is_active&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:r("account.inactive")})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:r("account.currentBalance")}),e.jsx("p",{className:K("text-3xl font-bold font-mono",b?"text-green-600":"text-red-600"),children:U(t.current_balance,t.currency,(d==null?void 0:d.rates)||{},!0,x)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("account.initialBalance")}),e.jsx("p",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:U(t.initial_balance,t.currency,(d==null?void 0:d.rates)||{},!0,x)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("account.transactions")}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:t.transaction_count})]})]}),t.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:r("account.notes")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.notes})]})]})}const ye=t=>{const s=t.startsWith("-"),a=t.replace(/[^\d.]/g,"").split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),(s?"-":"")+a.join(".")},he=t=>{const s=t.startsWith("-"),r=t.replace(/[^\d.]/g,"");return(s?"-":"")+r},X=t=>t==="USD"?100:1;function Rt({isOpen:t,onClose:s,editingAccountId:r}){const{t:a}=z("common"),d=Ze(),x=et(),{data:n}=tt(r||void 0),b=xe(),{isPrivacyMode:u}=ce(),[f,k]=p.useState(""),[v,m]=p.useState("bank"),[h,S]=p.useState(""),[A,q]=p.useState(""),[P,L]=p.useState("JPY"),[M,g]=p.useState(""),[N,j]=p.useState({}),[w,l]=p.useState(""),[o,i]=p.useState(!1),$=["bank","cash","credit_card","investment","receivable","savings","other"],R=n&&n.transaction_count>0,D=(()=>{if(!n||!w)return null;const C=X(n.currency),y=parseFloat(w)*C,B=n.current_balance;return y-B})();p.useEffect(()=>{if(t){if(r&&n)if(k(n.name),m(n.type),g(n.notes||""),L(n.currency),R)l(""),i(!1);else{const C=X(n.currency);S((n.initial_balance/C).toString()),q(n.initial_balance_date)}else k(""),m("bank"),S("0"),q(new Date().toISOString().split("T")[0]),L("JPY"),g(""),l(""),i(!1);j({})}},[t,r,n,R]);const E=()=>{const C={};return f.trim()||(C.name=a("account.errors.nameRequired")),r?r&&!R&&(A||(C.initialBalanceDate=a("account.errors.dateRequired"))):A||(C.initialBalanceDate=a("account.errors.dateRequired")),j(C),Object.keys(C).length===0},F=async C=>{if(C.preventDefault(),!!E()){if(r&&R&&w&&!o){i(!0);return}try{if(r){const y={name:f.trim(),type:v,notes:M.trim()||void 0};if(!R&&n){const B=X(n.currency);y.initial_balance=Math.round(parseFloat(h||"0")*B),y.initial_balance_date=A}if(R&&w&&n){const B=X(n.currency);y.desired_current_balance=Math.round(parseFloat(w)*B)}await x.mutateAsync({id:r,data:y})}else{const y=X(P),B={name:f.trim(),type:v,initial_balance:Math.round(parseFloat(h||"0")*y),initial_balance_date:A,currency:P,notes:M.trim()||void 0};await d.mutateAsync(B)}s()}catch(y){j({submit:y.message||a("account.errors.submitFailed")})}}};if(!t)return null;const V=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:a(r?"account.editAccount":"account.createAccount")}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.name")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",value:f,onChange:C=>k(C.target.value),className:K("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",N.name?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:a("account.namePlaceholder")}),N.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N.name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.accountType")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"type",value:v,onChange:C=>m(C.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:$.map(C=>e.jsx("option",{value:C,children:a(`account.type.${C}`)},C))})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:ye(h),onChange:C=>S(he(C.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:A,onChange:C=>q(C.target.value),className:K("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",N.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),N.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N.initialBalanceDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.currency")}),e.jsxs("select",{id:"currency",value:P,onChange:C=>L(C.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"VND",children:"VND (â‚«)"})]})]})]}),r&&!R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:ye(h),onChange:C=>S(he(C.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:A,onChange:C=>q(C.target.value),className:K("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",N.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),N.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N.initialBalanceDate})]})]}),r&&R&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:"Current Balance"}),e.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-200",children:U(n.current_balance,n.currency,b,!0,u)})]}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:[n.transaction_count," transactions"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"desiredBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Desired Current Balance"}),e.jsx("input",{type:"text",inputMode:"decimal",id:"desiredBalance",value:ye(w),onChange:C=>{l(he(C.target.value)),i(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"Enter the actual balance"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the actual balance from your bank/wallet to reconcile"})]}),D!==null&&D!==0&&e.jsx("div",{className:K("border rounded-lg p-4",D>0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:K("text-sm font-medium",D>0?"text-green-900":"text-red-900"),children:"Adjustment Amount"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:K("text-lg font-bold",D>0?"text-green-900":"text-red-900"),children:D>0?"â†‘":"â†“"}),e.jsx("span",{className:K("text-lg font-bold",D>0?"text-green-900":"text-red-900"),children:U(Math.abs(D),n.currency,b,!0,u)})]})]})}),o&&D!==null&&D!==0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-900",children:"Confirm Balance Adjustment"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["This will create a balance adjustment transaction of"," ",e.jsx("span",{className:"font-semibold",children:U(Math.abs(D),n.currency,b,!0,u)})," ","to reconcile your account balance."]})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("account.notes")}),e.jsx("textarea",{id:"notes",value:M,onChange:C=>g(C.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:a("account.notesPlaceholder")})]}),N.submit&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:N.submit})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[o&&e.jsx("button",{type:"button",onClick:()=>{i(!1),l("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel Adjustment"}),!o&&e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:a("common.cancel")}),e.jsx("button",{type:"submit",disabled:d.isPending||x.isPending,className:K("flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",o?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:d.isPending||x.isPending?a("common.saving"):o?"Confirm Adjustment":a(r?"common.update":"common.create")})]})]})]})]});return typeof document>"u"?null:oe.createPortal(V,document.body)}const qt=["eth","bsc","polygon"];function Me({token:t,isPrivacyMode:s}){return e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.logo_url?e.jsx("img",{src:t.logo_url,alt:t.symbol,className:"w-5 h-5 rounded-full",onError:r=>{r.target.style.display="none"}}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-[10px] font-medium",children:t.symbol.slice(0,2)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate",children:t.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:s?"***":Number(t.balance)<1e-4?"<0.0001":Number(t.balance).toFixed(4)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s?"$***":`$${Number(t.balance_usd).toFixed(2)}`})]})]})}function Re(){const{t}=z("common"),s=Y(),{currency:r}=fe(),{isPrivacyMode:a}=ce(),d=xe(),[x,n]=p.useState(!1),[b,u]=p.useState(""),[f,k]=p.useState(""),[v,m]=p.useState(["eth","bsc","polygon"]),[h,S]=p.useState(null),[A,q]=p.useState(null),{data:P,isLoading:L}=I({queryKey:["crypto-wallets"],queryFn:Ee}),{data:M}=I({queryKey:["crypto-wallets-balance",P==null?void 0:P.map(y=>y.id)],queryFn:async()=>!P||P.length===0?[]:Promise.all(P.map(y=>nt(y.id))),enabled:!!P&&P.length>0}),{data:g,isLoading:N}=I({queryKey:["crypto-portfolio",A],queryFn:()=>lt(A),enabled:!!A}),j=O({mutationFn:st,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),n(!1),u(""),k(""),m(["eth","bsc","polygon"])}}),w=O({mutationFn:rt,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]})}}),l=O({mutationFn:at,onSuccess:()=>{s.invalidateQueries({queryKey:["crypto-wallets"]}),s.invalidateQueries({queryKey:["crypto-wallets-balance"]}),s.invalidateQueries({queryKey:["dashboard-summary"]}),S(null)},onError:()=>{S(null)}}),o=()=>{b.trim()&&j.mutate({wallet_address:b.trim(),label:f.trim()||void 0,chains:v})},i=y=>{confirm(t("common.confirmDelete"))&&w.mutate(y)},$=y=>{S(y),l.mutate(y)},R=y=>{m(B=>B.includes(y)?B.filter(W=>W!==y):[...B,y])},c=y=>{q(B=>B===y?null:y)},D=y=>`${y.slice(0,6)}...${y.slice(-4)}`,E=(y,B)=>{const W={eth:`https://etherscan.io/address/${y}`,bsc:`https://bscscan.com/address/${y}`,polygon:`https://polygonscan.com/address/${y}`,arbitrum:`https://arbiscan.io/address/${y}`,optimism:`https://optimistic.etherscan.io/address/${y}`};return W[B]||W.eth},F=(M==null?void 0:M.reduce((y,B)=>y+Number(B.total_balance_usd||0),0))||0,V=1/((d==null?void 0:d.USD)||.00667),C=Math.round(F*V);return L?e.jsx(ie,{title:t("crypto.wallets"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(H,{size:"md"})})}):e.jsxs(ie,{title:t("crypto.wallets"),badge:(P==null?void 0:P.length)||0,defaultOpen:P&&P.length>0,children:[M&&M.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalBalance")}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:U(C,r,d,!1,a)})]}),M&&M.length>0?e.jsx("div",{className:"space-y-3 mb-4",children:M.map(y=>{var B,W;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(pe,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:y.label||D(y.wallet_address)}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("code",{className:"text-xs",children:D(y.wallet_address)}),e.jsx("a",{href:E(y.wallet_address,"eth"),target:"_blank",rel:"noopener noreferrer",className:"hover:text-purple-500",children:e.jsx(ve,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a?"$***":`$${Number(y.total_balance_usd||0).toFixed(2)}`}),e.jsx("div",{className:"flex gap-1 mt-1",children:(B=y.chains)==null?void 0:B.map(_=>{var T;return e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",title:(T=se[_])==null?void 0:T.name,children:_.toUpperCase()},_)})})]})]}),e.jsxs("button",{onClick:()=>c(y.id),className:"flex items-center gap-2 mt-3 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors",children:[A===y.id?e.jsx(G,{className:"w-4 h-4"}):e.jsx(Qe,{className:"w-4 h-4"}),t("crypto.tokens")]}),A===y.id&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:N?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(H,{size:"sm"})}):g!=null&&g.chains&&g.chains.length>0?e.jsx("div",{className:"space-y-4",children:g.chains.filter(_=>_.tokens.length>0||_.native_balance).sort((_,T)=>Number(T.total_usd)-Number(_.total_usd)).map(_=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:_.chain_name}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:a?"$***":`$${Number(_.total_usd).toFixed(2)}`})]}),e.jsxs("div",{className:"space-y-1",children:[_.native_balance&&Number(_.native_balance.balance)>0&&e.jsx(Me,{token:_.native_balance,isPrivacyMode:a}),_.tokens.filter(T=>Number(T.balance_usd)>=1).sort((T,ne)=>Number(ne.balance_usd)-Number(T.balance_usd)).map(T=>e.jsx(Me,{token:T,isPrivacyMode:a},T.token_address))]})]},_.chain_id))}):e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-2",children:t("crypto.noTokens")})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:(W=y.sync_statuses)!=null&&W.some(_=>_.last_sync_at)?t("crypto.lastSync",{time:new Date(Math.max(...y.sync_statuses.filter(_=>_.last_sync_at).map(_=>new Date(_.last_sync_at).getTime()))).toLocaleString()}):t("crypto.neverSynced")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$(y.id),disabled:h===y.id,className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg transition-colors",title:t("crypto.sync"),children:h===y.id?e.jsx(H,{size:"sm"}):e.jsx(J,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i(y.id),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:t("common.delete"),children:e.jsx(pt,{className:"w-4 h-4"})})]})]})]},y.id)})}):x?null:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:t("crypto.noWallets")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:t("crypto.addWalletDescription")})]}),x?e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(De,{label:t("crypto.walletAddress"),placeholder:"0x...",value:b,onChange:y=>u(y.target.value)}),e.jsx(De,{label:t("crypto.walletLabel"),placeholder:t("crypto.walletLabelPlaceholder"),value:f,onChange:y=>k(y.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.selectChains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:qt.map(y=>{var B;return e.jsx("button",{type:"button",onClick:()=>R(y),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${v.includes(y)?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:((B=se[y])==null?void 0:B.name)||y.toUpperCase()},y)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(te,{variant:"outline",onClick:()=>n(!1),children:t("common.cancel")}),e.jsx(te,{onClick:o,disabled:!b.trim()||v.length===0||j.isPending,children:j.isPending?t("common.saving"):t("crypto.addWallet")})]})]}):e.jsxs(te,{variant:"outline",onClick:()=>n(!0),className:"w-full",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),t("crypto.addWallet")]})]})}function Tt({snapshots:t}){const{resolvedTheme:s}=it(),r=s==="dark",a=r?"#374151":"#E5E7EB",d=r?"#9CA3AF":"#6B7280",x=r?"#1F2937":"#FFFFFF",n=r?"#374151":"#E5E7EB",b="#6366F1",u=p.useMemo(()=>[...t].sort((v,m)=>new Date(v.snapshot_date).getTime()-new Date(m.snapshot_date).getTime()).map(v=>({date:v.snapshot_date,value:Number(v.balance_usd),formattedDate:new Date(v.snapshot_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})),[t]),[f,k]=p.useMemo(()=>{const v=u.map(A=>A.value),m=Math.min(...v),h=Math.max(...v),S=(h-m)*.1||10;return[Math.max(0,m-S),h+S]},[u]);return u.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No historical data available"}):e.jsx(St,{width:"100%",height:"100%",children:e.jsxs(Ct,{data:u,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Ft,{strokeDasharray:"3 3",stroke:a,vertical:!1}),e.jsx(At,{dataKey:"formattedDate",tick:{fill:d,fontSize:11},tickLine:!1,axisLine:{stroke:a},interval:"preserveStartEnd"}),e.jsx(Dt,{domain:[f,k],tick:{fill:d,fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:v=>`$${v.toFixed(0)}`,width:50}),e.jsx(Pt,{contentStyle:{backgroundColor:x,border:`1px solid ${n}`,borderRadius:"8px",fontSize:"12px"},labelStyle:{color:d,fontWeight:"bold"},formatter:v=>[`$${v.toFixed(2)}`,"Value"]}),e.jsx($t,{type:"monotone",dataKey:"value",stroke:b,strokeWidth:2,dot:u.length<=10,activeDot:{r:6,fill:b}})]})})}function Bt(t){return t>0?"text-green-600 dark:text-green-400":t<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"}function Et(t,s){return s<=0?0:Math.min(100,t/s*100)}function He(t){return`${t>=0?"+":""}${t.toFixed(2)}%`}function It({positionIds:t}){const{t:s}=z("common"),[r,a]=p.useState(!1),{data:d,isLoading:x,error:n}=I({queryKey:["hodl-scenarios",t],queryFn:()=>dt(t),enabled:t.length>=2,staleTime:5*60*1e3});if(t.length<2)return null;if(x)return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(H,{size:"sm"})})});if(n||!d)return null;const b=d.scenarios.find(v=>v.type==="lp"),u=d.scenarios[0],f=Number(u==null?void 0:u.value_usd)||0,k=()=>{if(!u||!b)return"";if(u.type==="lp")return s("crypto.hodlScenarios.lpWinning",{pct:He(Number(u.return_pct))});const v=Number(u.value_usd)-Number(b.value_usd);return s("crypto.hodlScenarios.alternativeBetter",{name:u.name,diff:v.toFixed(2)})};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>a(!r),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-5 h-5 text-amber-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s("crypto.hodlScenarios.title")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:k()}),r?e.jsx(me,{className:"w-5 h-5 text-gray-400"}):e.jsx(G,{className:"w-5 h-5 text-gray-400"})]})]}),r&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[e.jsx("div",{className:"space-y-3",children:d.scenarios.map((v,m)=>e.jsx(zt,{scenario:v,maxValue:f,isWinner:m===0,isLp:v.type==="lp"},v.name))}),e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[s("crypto.hodlScenarios.initialValue"),": $",Number(d.initial_value_usd).toFixed(2)]}),e.jsxs("span",{children:[s("crypto.hodlScenarios.period"),": ",d.days_held," ",s("crypto.days")]})]}),u&&u.type!=="lp"&&b&&e.jsxs("p",{className:"mt-2 text-sm text-amber-600 dark:text-amber-400",children:["ðŸ’¡ ",s("crypto.hodlScenarios.insight",{name:u.name,diff:Math.abs(Number(d.winner_vs_lp_usd)).toFixed(2)})]}),u&&u.type==="lp"&&e.jsxs("p",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:["âœ“ ",s("crypto.hodlScenarios.lpOptimal")]})]})]})]})}function zt({scenario:t,maxValue:s,isWinner:r,isLp:a}){const d=Et(Number(t.value_usd),s),x=Bt(Number(t.return_pct)),n=()=>a?"bg-indigo-500":t.type==="hodl_balanced"?"bg-purple-500":"bg-blue-500";return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),r&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded",children:"Best"}),a&&!r&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:"LP"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["$",Number(t.value_usd).toFixed(2)]}),e.jsxs("span",{className:`flex items-center gap-0.5 text-sm ${x}`,children:[Number(t.return_pct)>=0?e.jsx(re,{className:"w-3 h-3"}):e.jsx(ke,{className:"w-3 h-3"}),He(Number(t.return_pct))]})]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-300 ${n()}`,style:{width:`${d}%`}})})]})}function Kt({positionId:t}){const{t:s}=z(),r=Y(),[a,d]=p.useState(null),[x,n]=p.useState(!1),[b,u]=p.useState(null),[f,k]=p.useState(null),[v,m]=p.useState(null),{data:h,isLoading:S}=I({queryKey:["position-roi",t],queryFn:()=>Ke(t)}),{data:A=[]}=I({queryKey:["position-rewards-list",t],queryFn:()=>ct(t)}),q=O({mutationFn:()=>Ie(90),onSuccess:l=>{d({scanned:l.scanned_claims,new:l.new_claims}),r.invalidateQueries({queryKey:["position-roi"]}),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["unattributed-rewards"]}),setTimeout(()=>d(null),5e3)}}),P=O({mutationFn:l=>ze(l),onSuccess:l=>{k(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:l.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),u(null),setTimeout(()=>k(null),5e3)},onError:l=>{m(l.message||s("crypto.transactionCreateError","Failed to create transaction")),u(null),setTimeout(()=>m(null),5e3)}}),L=O({mutationFn:l=>ot(l),onSuccess:l=>{const o=s("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:l.created,total:l.total_usd.toFixed(2),skipped:l.skipped});k(o),r.invalidateQueries({queryKey:["position-rewards-list"]}),r.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>k(null),8e3)},onError:l=>{m(l.message||s("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>m(null),5e3)}}),M=A.filter(l=>!l.transaction_id);if(S)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const g=l=>{if(l==null)return null;const o=Number(l);return isNaN(o)?null:`$${o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},N=l=>{if(l===null)return"-";const o=Number(l);return`${o>=0?"+":""}${o.toFixed(2)}%`},j=l=>{const[o,i]=l.split("-");return new Date(Number(o),Number(i)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},w=l=>Number(l).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanRewardsHint","Scan blockchain for claimed rewards")}),e.jsx("button",{onClick:()=>q.mutate(),disabled:q.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(de,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),h&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),s("crypto.roiSummary","ROI Summary")]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),h.rewards_by_token&&h.rewards_by_token.length>0?e.jsx("div",{className:"space-y-1",children:h.rewards_by_token.map(l=>{const o=g(l.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[w(l.amount)," ",l.symbol]}),o&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",o]})]},l.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:g(h.total_rewards_usd)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[h.rewards_count," ",s("crypto.claims","claims")]})]}),h.cost_basis_usd!==null&&h.simple_roi_pct!==null&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-green-200 dark:border-green-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.costBasis","Cost Basis")}),e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:g(h.cost_basis_usd)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.roi","ROI")}),e.jsx("div",{className:`text-lg font-semibold ${h.simple_roi_pct>=0?"text-green-800 dark:text-green-200":"text-red-600 dark:text-red-400"}`,children:N(h.simple_roi_pct)}),h.days_held&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[h.days_held," ",s("crypto.daysHeld","days")]})]})]})]})]}),h&&h.rewards_by_month&&h.rewards_by_month.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:h.rewards_by_month.map(l=>{const o=g(l.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:j(l.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[l.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[w(l.amount)," ",l.symbol]}),o&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",o]})]})]},`${l.month}-${l.symbol}`)})})]}),A.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>n(!x),className:"flex items-center gap-2 font-medium text-gray-900 dark:text-gray-100 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[e.jsx(be,{className:"h-4 w-4"}),s("crypto.allRewards","All Rewards")," (",A.length,")",x?e.jsx(me,{className:"h-4 w-4"}):e.jsx(G,{className:"h-4 w-4"})]}),M.length>0&&e.jsxs("button",{type:"button",onClick:()=>L.mutate(M.map(l=>l.id)),disabled:L.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 rounded-lg transition-colors",children:[L.isPending?e.jsx(je,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(Ue,{className:"h-3.5 w-3.5"}),s("crypto.createAllTransactions","Create All Txns")," (",M.length,")"]})]}),x&&e.jsxs(e.Fragment,{children:[f&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(de,{className:"h-4 w-4"}),f]}),v&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(ae,{className:"h-4 w-4"}),v]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:A.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Number(l.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})," ",l.reward_token_symbol||"tokens"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[new Date(l.claimed_at).toLocaleDateString()," via ",l.source,l.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(l.reward_usd).toFixed(2)]})]})]}),l.reward_usd&&Number(l.reward_usd)>0&&e.jsx("div",{className:"flex-shrink-0 ml-3",children:l.transaction_id?e.jsxs("a",{href:`/transactions?id=${l.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(ve,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{u(l.id),P.mutate(l.id)},disabled:b===l.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[b===l.id?e.jsx(je,{className:"h-3 w-3 animate-spin"}):e.jsx(be,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},l.id))})]})]}),h&&h.rewards_count===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(_e,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),s("crypto.noRewards","No rewards claimed for this position yet.")]})]})}function Vt({source:t="symbiotic"}){const{t:s}=z(),r=Y(),[a,d]=p.useState(null),{data:x,isLoading:n}=I({queryKey:["staking-rewards",t],queryFn:()=>xt(t)}),b=O({mutationFn:()=>Ie(90),onSuccess:m=>{d({scanned:m.scanned_claims,new:m.new_claims}),r.invalidateQueries({queryKey:["staking-rewards"]}),setTimeout(()=>d(null),5e3)}});if(n)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const u=m=>{if(m==null)return null;const h=Number(m);return isNaN(h)?null:`$${h.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},f=m=>{const[h,S]=m.split("-");return new Date(Number(h),Number(S)-1).toLocaleDateString(void 0,{month:"short",year:"numeric"})},k=m=>Number(m).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4}),v=t==="symbiotic"?"Symbiotic":t;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s("crypto.scanStakingRewardsHint","Scan blockchain for claimed staking rewards")}),e.jsx("button",{onClick:()=>b.mutate(),disabled:b.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 animate-spin"}),s("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4"}),s("crypto.scanRewards","Scan Rewards")]})})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(de,{className:"h-4 w-4"}),s("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",a)]}),x&&x.rewards_count>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),s("crypto.stakingRewardsSummary","{{source}} Rewards Summary",{source:v})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:s("crypto.totalRewards","Total Rewards")}),x.rewards_by_token&&x.rewards_by_token.length>0?e.jsx("div",{className:"space-y-1",children:x.rewards_by_token.map(m=>{const h=u(m.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[k(m.amount)," ",m.symbol]}),h&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",h]})]},m.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:u(x.total_rewards_usd)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[x.rewards_count," ",s("crypto.claims","claims")]})]})})]}),x&&x.rewards_by_month&&x.rewards_by_month.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),s("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:x.rewards_by_month.map(m=>{const h=u(m.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:f(m.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[m.count," ",s("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[k(m.amount)," ",m.symbol]}),h&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",h]})]})]},`${m.month}-${m.symbol}`)})})]}),x&&x.rewards_count===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(_e,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:s("crypto.noStakingRewards","No staking rewards found")}),e.jsx("p",{className:"text-sm",children:s("crypto.noStakingRewardsHint",'Click "Scan Rewards" to search for claimed rewards on the blockchain.')})]})]})}async function Ot(t,s){return(await Ne.post(`/api/crypto/positions/${encodeURIComponent(t)}/close`,s)).data}async function Wt(){return(await Ne.get("/api/crypto/positions/closed")).data}function Qt({group:t,lastSnapshotValueUsd:s,costBasisUsd:r,totalRewardsUsd:a,onClose:d,onSuccess:x}){var E;const{t:n}=z("common"),{data:b}=Be(),u=((E=b==null?void 0:b.rates)==null?void 0:E.USD)||150,f=Y(),[k,v]=p.useState(new Date().toISOString().slice(0,16)),[m,h]=p.useState(s),[S,A]=p.useState(Math.round(s*u)),[q,P]=p.useState(null),[L,M]=p.useState(`LP Exit: ${t.protocol} ${t.name}`),[g,N]=p.useState("");p.useEffect(()=>{A(Math.round(m*u))},[m,u]);const{data:j}=I({queryKey:["accounts"],queryFn:()=>mt()}),w=(j==null?void 0:j.filter(F=>F.is_active&&(F.type==="bank"||F.type==="savings")))||[],l=r!==null?m-r+(a||0):null,o=r&&l!==null?l/r*100:null,i=t.tokens[0],$=(i==null?void 0:i.id)||"",R=(i==null?void 0:i.wallet_address)||"",c=O({mutationFn:()=>{if(!q)throw new Error(n("crypto.selectAccount","Select destination account"));const F={exit_date:new Date(k).toISOString(),exit_value_usd:m,exit_value_jpy:S,destination_account_id:q,note:L||void 0,tx_hash:g||void 0,wallet_address:R,chain_id:t.chain_id,protocol:t.protocol,symbol:t.name};return Ot($,F)},onSuccess:()=>{f.invalidateQueries({queryKey:["closed-positions"]}),f.invalidateQueries({queryKey:["defi-positions"]}),f.invalidateQueries({queryKey:["accounts"]}),x(),d()}}),D=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-hidden",style:{touchAction:"pan-y"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:d}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:n("crypto.closePosition","Close Position")}),e.jsx("button",{onClick:d,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.protocol," - ",t.name]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.chain_id.toUpperCase()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(we,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitDate","Exit Date")]}),e.jsx("input",{type:"datetime-local",value:k,onChange:F=>v(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(jt,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitValue","Exit Value")," (USD)"]}),e.jsx("input",{type:"number",step:"0.01",value:m,onChange:F=>h(parseFloat(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("crypto.exitValue","Exit Value")," (JPY)"]}),e.jsx("input",{type:"number",value:S,onChange:F=>A(parseInt(F.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(pe,{className:"w-4 h-4 inline mr-1"}),n("crypto.destinationAccount","Destination Account")]}),e.jsxs("select",{value:q||"",onChange:F=>P(parseInt(F.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:n("common.select","Select...")}),w.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("common.note","Note")}),e.jsx("input",{type:"text",value:L,onChange:F=>M(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["TX Hash (",n("common.optional","optional"),")"]}),e.jsx("input",{type:"text",value:g,onChange:F=>N(F.target.value),placeholder:"0x...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-sm"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("crypto.pnlPreview","P&L Preview")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.costBasis","Cost Basis")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r!==null?`$${r.toFixed(2)}`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.totalRewards","Total Rewards")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a?`$${a.toFixed(2)}`:"$0.00"})]}),e.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.realizedPnl","Realized P&L")}),e.jsx("p",{className:`text-lg font-bold ${l!==null?l>=0?"text-green-600":"text-red-600":"text-gray-400"}`,children:l!==null?`${l>=0?"+":""}$${l.toFixed(2)} (${o==null?void 0:o.toFixed(1)}%)`:"N/A"})]})]})]}),c.error&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ft,{className:"w-4 h-4"}),c.error.message]})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:d,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",children:n("common.cancel","Cancel")}),e.jsx("button",{onClick:()=>c.mutate(),disabled:!q||c.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:c.isPending?n("common.loading","Loading..."):n("crypto.confirmClose","Confirm Close")})]})]})]});return typeof document>"u"?null:oe.createPortal(D,document.body)}function le(t,s=2){const r=Number(t);return`${r>=0?"+":""}${r.toFixed(s)}`}function Ut({level:t}){const s={low:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",medium:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",high:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"};return e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s[t]||s.medium}`,children:t.toUpperCase()})}function Ht({performance:t}){const{t:s}=z("common"),r=Number(t.total_return_pct)>=0;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:s("crypto.performance")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.totalReturn")}),e.jsxs("p",{className:`text-lg font-bold ${r?"text-green-600":"text-red-600"}`,children:[le(t.total_return_pct),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["$",le(t.total_return_usd)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.annualized")}),t.annualized_return_pct!==null?e.jsxs("p",{className:`text-lg font-bold ${Number(t.annualized_return_pct)>=0?"text-green-600":"text-red-600"}`,children:[le(t.annualized_return_pct),"%"]}):e.jsx("p",{className:"text-lg font-bold text-gray-400",children:"N/A"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.days_held," ",s("crypto.days")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.currentValue")}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["$",Number(t.current_value_usd).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s("crypto.from")," $",Number(t.start_value_usd).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.currentApy")}),e.jsx("p",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:t.current_apy!=null?`${Number(t.current_apy).toFixed(2)}%`:"N/A"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.snapshot_count," ",s("crypto.snapshots")]})]})]})]})}function Jt({performance:t}){const{t:s}=z("common");if(t.il_percentage==null)return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:s("crypto.impermanentLoss")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:s("crypto.ilNotAvailable")})]});const r=Number(t.il_percentage)<0;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:s("crypto.impermanentLoss")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.ilPercentage")}),e.jsxs("p",{className:`text-lg font-bold ${r?"text-red-600":"text-green-600"}`,children:[Number(t.il_percentage).toFixed(2),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["$",t.il_usd!=null?Number(t.il_usd).toFixed(2):"0.00"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.hodlValue")}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["$",t.hodl_value_usd!=null?Number(t.hodl_value_usd).toFixed(2):"N/A"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.lpVsHodl")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.lp_outperformed_hodl?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-green-600 font-medium",children:s("crypto.lpOutperformed")})]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-red-600 font-medium",children:s("crypto.hodlOutperformed")})]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["($",Math.abs(Number(t.lp_vs_hodl_usd)||0).toFixed(2),")"]})]})]}),t.estimated_yield_pct!=null&&e.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("crypto.estimatedYield")}),e.jsxs("p",{className:"text-green-600 font-bold",children:[le(t.estimated_yield_pct),"%",e.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["($",t.estimated_yield_usd!=null?Number(t.estimated_yield_usd).toFixed(2):"0.00",")"]})]})]})]})]})}function Yt({insights:t,isLoading:s}){const{t:r}=z("common"),[a,d]=p.useState(!1);return s?e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg border border-indigo-200 dark:border-indigo-800 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Pe,{className:"w-4 h-4 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-medium text-indigo-700 dark:text-indigo-300",children:r("crypto.aiInsights")})]}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(H,{size:"sm"})})]}):t?e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg border border-indigo-200 dark:border-indigo-800 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-indigo-600"}),e.jsx("h3",{className:"text-sm font-medium text-indigo-700 dark:text-indigo-300",children:r("crypto.aiInsights")})]}),e.jsx(Ut,{level:t.risk_level})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3",children:t.summary}),t.il_analysis&&e.jsxs("div",{className:"bg-white/50 dark:bg-gray-800/50 rounded p-2 mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:r("crypto.ilAnalysis")}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:t.il_analysis})]}),e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx(Se,{className:"w-4 h-4 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:t.observation})]}),(t.scenario_up||t.scenario_down)&&e.jsxs("button",{onClick:()=>d(!a),className:"flex items-center gap-1 text-indigo-600 dark:text-indigo-400 text-sm hover:underline",children:[a?e.jsx(me,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"}),r("crypto.viewScenarios")]}),a&&e.jsxs("div",{className:"mt-3 space-y-2",children:[t.scenario_up&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded p-2",children:[e.jsx("p",{className:"text-xs font-medium text-green-700 dark:text-green-400",children:r("crypto.priceUp20")}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:t.scenario_up})]}),t.scenario_down&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded p-2",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-400",children:r("crypto.priceDown20")}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:t.scenario_down})]})]}),t.recommendation&&e.jsx("div",{className:"mt-3 pt-3 border-t border-indigo-200 dark:border-indigo-700",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs italic",children:t.recommendation})}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-500",children:r("crypto.insightsDisclaimer")})]}):null}function Gt({group:t,onClose:s}){const{t:r,i18n:a}=z("common");fe();const d=se[t.chain_id],[x,n]=p.useState("overview"),[b,u]=p.useState(!1),f=t.tokens[0],k=Ae({queries:t.tokens.map(i=>({queryKey:["position-history",i.id],queryFn:()=>ut(i.id,30),retry:!1}))}),v=k.some(i=>i.isLoading),m=k.every(i=>i.isError),h=p.useMemo(()=>{const i=k.filter(c=>{var D;return(D=c.data)==null?void 0:D.snapshots}).flatMap(c=>c.data.snapshots);if(i.length===0)return null;const $=new Map;for(const c of i){const D=$.get(c.snapshot_date)||0;$.set(c.snapshot_date,D+Number(c.balance_usd))}return{snapshots:Array.from($.entries()).map(([c,D])=>({snapshot_date:c,balance_usd:D}))}},[k]),S=Ae({queries:t.tokens.map(i=>({queryKey:["position-performance",i.id],queryFn:()=>gt(i.id),retry:!1}))}),A=S.some(i=>i.isLoading),q=S.every(i=>i.isError),P=S.every(i=>!i.isLoading),L=p.useMemo(()=>{if(console.log("=== LP Performance Debug ==="),console.log("Total tokens in group:",t.tokens.length),console.log("Token IDs:",t.tokens.map(_=>({symbol:_.symbol,id:_.id.substring(0,50)}))),console.log("All queries settled:",P),console.log("Query states:",S.map((_,T)=>{var ne,Ce,Fe;return{index:T,symbol:(ne=t.tokens[T])==null?void 0:ne.symbol,isLoading:_.isLoading,isError:_.isError,hasData:!!_.data,dataValue:(Ce=_.data)==null?void 0:Ce.current_value_usd,error:(Fe=_.error)==null?void 0:Fe.message}})),!P)return console.log("Still loading, returning null"),null;const i=S.filter(_=>_.data);if(console.log("Successful queries count:",i.length),i.length===0)return console.log("No successful queries, returning null"),null;const $=i[0].data;if(i.length===1)return console.log("Only 1 query succeeded, returning:",$.current_value_usd),$;console.log("Aggregating",i.length,"queries"),console.log("Values to aggregate:",i.map(_=>{var T;return(T=_.data)==null?void 0:T.current_value_usd}));let R=0,c=0,D=0,E=0,F=0,V=!1,C=0,y=0;for(const _ of i){const T=_.data;R+=Number(T.start_value_usd),c+=Number(T.current_value_usd),D+=Number(T.total_return_usd),E=Math.max(E,T.days_held),F+=T.snapshot_count,T.il_usd!=null&&(V=!0,C+=Number(T.il_usd)),T.hodl_value_usd!=null&&(y+=Number(T.hodl_value_usd))}const B=R>0?D/R*100:0;let W=null;if(E>=7&&R>0){const _=((c/R)**(365/E)-1)*100;Math.abs(_)<=500&&(W=_)}return{position_id:$.position_id,protocol:$.protocol,symbol:t.name,days_held:E,start_value_usd:R,current_value_usd:c,total_return_usd:D,total_return_pct:B,annualized_return_pct:W,current_apy:$.current_apy,snapshot_count:F,il_percentage:V&&R>0?C/R*100:null,il_usd:V?C:null,hodl_value_usd:V?y:null,lp_vs_hodl_usd:V?c-y:null,lp_outperformed_hodl:V?c>y:void 0}},[S,t.name,P]),{data:M,isLoading:g}=I({queryKey:["position-insights",f.id,a.language],queryFn:()=>yt(f.id,a.language),enabled:!!L&&!q,retry:!1}),{data:N}=I({queryKey:["position-roi",f.id],queryFn:()=>Ke(f.id),retry:!1}),j=v||A,w=m||q,l=i=>{const $=Number(i.balance);return $<1e-4?"<0.0001":$<1?$.toFixed(4):$.toFixed(2)},o=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90dvh]",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"relative flex -space-x-2",children:t.tokens.slice(0,3).map((i,$)=>i.logo_url?e.jsx("img",{src:i.logo_url,alt:i.symbol,className:"w-10 h-10 rounded-full border-2 border-white dark:border-gray-900",style:{zIndex:t.tokens.length-$},onError:R=>{R.target.style.display="none"}},i.id):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs border-2 border-white dark:border-gray-900",style:{zIndex:t.tokens.length-$},children:i.symbol.slice(0,2)},i.id))}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white truncate",children:[t.protocol," - ",t.name]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[d&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded",children:[d.icon," ",t.chain_id.toUpperCase()]}),e.jsx("span",{children:t.position_type})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>u(!0),className:"px-3 py-1.5 text-sm bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50",children:r("crypto.closePosition","Close Position")}),e.jsx("button",{onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>n("overview"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${x==="overview"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:r("crypto.overview","Overview")}),e.jsxs("button",{onClick:()=>n("rewards"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2 ${x==="rewards"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(_e,{className:"w-4 h-4"}),r("crypto.rewards","Rewards")]})]}),e.jsx("div",{className:"p-4 space-y-4",children:j?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(H,{size:"lg"})}):e.jsxs(e.Fragment,{children:[x==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:r("crypto.currentValue")}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["$",t.total_usd.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:t.tokens.map((i,$)=>e.jsxs("span",{children:[$>0&&" + ",l(i)," ",i.symbol]},i.id))})]}),t.tokens.length>1&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:r("crypto.tokenBreakdown","Token Breakdown")}),e.jsx("div",{className:"space-y-2",children:t.tokens.map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i.logo_url?e.jsx("img",{src:i.logo_url,alt:i.symbol,className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold",children:i.symbol.slice(0,2)}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:i.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:l(i)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["$",Number(i.balance_usd).toFixed(2)]})]})]},i.id))})]}),w&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-300",children:r("crypto.noHistoricalDataTitle")}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-1",children:r("crypto.noHistoricalDataMessage")})]})]})}),h&&h.snapshots.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:[r("crypto.valueHistory")," (",r("crypto.combinedValue","Combined Value"),")"]}),e.jsx("div",{className:"h-48",children:e.jsx(Tt,{snapshots:h.snapshots})})]}),L&&(()=>{const i=t.total_usd,$=Number(L.start_value_usd),R=i-$,c=$>0?R/$*100:0,D=L.days_held||1;let E=null;if(D>=7&&$>0){const F=((i/$)**(365/D)-1)*100;E=Math.abs(F)<=500?F:null}return e.jsx(Ht,{performance:{...L,current_value_usd:i,total_return_usd:R,total_return_pct:c,annualized_return_pct:E}})})(),L&&e.jsx(Jt,{performance:L}),t.tokens.length>=2&&e.jsx(It,{positionIds:t.tokens.map(i=>i.id)}),!w&&e.jsx(Yt,{insights:M,isLoading:g})]}),x==="rewards"&&(t.protocol_module==="staked"?e.jsx(Vt,{source:"symbiotic"}):e.jsx(Kt,{positionId:f.id}))]})})]}),b&&e.jsx(Qt,{group:t,lastSnapshotValueUsd:t.total_usd,costBasisUsd:(N==null?void 0:N.cost_basis_usd)??null,totalRewardsUsd:(N==null?void 0:N.total_rewards_usd)??null,onClose:()=>u(!1),onSuccess:()=>{u(!1),s()}})]});return typeof document>"u"?null:oe.createPortal(o,document.body)}function Xt({walletId:t}){const{t:s}=z(),r=Y(),[a,d]=p.useState(new Set),[x,n]=p.useState(""),{data:b=[]}=I({queryKey:["unattributed-rewards"],queryFn:Ve}),{data:u}=I({queryKey:["defi-positions",t],queryFn:()=>Oe(t),enabled:!!t}),f=O({mutationFn:({rewardIds:o,positionId:i})=>ht(o,i),onSuccess:()=>{r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["position-rewards"]}),d(new Set),n("")}}),[k,v]=p.useState(null),[m,h]=p.useState(null),[S,A]=p.useState(null),q=O({mutationFn:o=>ze(o),onSuccess:o=>{h(s("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:o.amount_usd.toFixed(2)})),r.invalidateQueries({queryKey:["unattributed-rewards"]}),r.invalidateQueries({queryKey:["transactions"]}),v(null),setTimeout(()=>h(null),5e3)},onError:o=>{A(o.message||s("crypto.transactionCreateError","Failed to create transaction")),v(null),setTimeout(()=>A(null),5e3)}});if(b.length===0)return null;const P=(u==null?void 0:u.positions)||[],L=o=>`${Number(o.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})} ${o.reward_token_symbol||"tokens"}`,M=o=>new Date(o).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),g=o=>{const i=new Set(a);i.has(o)?i.delete(o):i.add(o),d(i)},N=()=>{a.size===b.length?d(new Set):d(new Set(b.map(o=>o.id)))},j=()=>{a.size===0||!x||f.mutate({rewardIds:Array.from(a),positionId:x})},w=b.length>0&&a.size===b.length,l=a.size>0;return e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Se,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),e.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:s("crypto.unattributedRewards",{count:b.length})})]}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:s("crypto.unattributedRewardsDesc","These rewards need to be assigned to a position for ROI tracking.")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-yellow-100 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:N,className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[w?e.jsx($e,{className:"h-4 w-4 text-primary-600"}):e.jsx(Le,{className:"h-4 w-4"}),w?s("common.deselectAll","Deselect All"):s("common.selectAll","Select All")]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs("select",{value:x,onChange:o=>n(o.target.value),disabled:!l,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:s("crypto.selectPosition","Select position...")}),P.map(o=>e.jsxs("option",{value:o.id,children:[o.protocol," - ",o.symbol]},o.id))]}),e.jsxs("button",{type:"button",onClick:j,disabled:!l||!x||f.isPending,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-md transition-colors disabled:cursor-not-allowed",children:[e.jsx(Nt,{className:"h-4 w-4"}),f.isPending?s("common.assigning","Assigning..."):s("crypto.assignSelected","Assign {{count}} Selected",{count:a.size})]})]})]}),m&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(de,{className:"h-4 w-4"}),m]}),S&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(ae,{className:"h-4 w-4"}),S]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:b.map(o=>e.jsxs("div",{onClick:()=>g(o.id),className:`flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-colors ${a.has(o.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700":"bg-white dark:bg-gray-800 border-yellow-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:a.has(o.id)?e.jsx($e,{className:"h-5 w-5 text-primary-600"}):e.jsx(Le,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:L(o)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[M(o.claimed_at)," via ",o.source,o.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(o.reward_usd).toFixed(2)]})]})]}),o.reward_usd&&o.reward_usd>0&&e.jsx("div",{className:"flex-shrink-0",onClick:i=>i.stopPropagation(),children:o.transaction_id?e.jsxs("a",{href:`/transactions?id=${o.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(ve,{className:"h-3 w-3"}),s("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{v(o.id),q.mutate(o.id)},disabled:k===o.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[k===o.id?e.jsx(je,{className:"h-3 w-3 animate-spin"}):e.jsx(be,{className:"h-3 w-3"}),s("crypto.createTransaction","Create Txn")]})})]},o.id))}),l&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200 dark:border-gray-700 text-sm text-yellow-700 dark:text-yellow-300",children:s("crypto.selectedRewards","{{count}} reward(s) selected",{count:a.size})})]})}const Zt={deposit:"ðŸ’°",stake:"ðŸ”’",borrow:"ðŸ’¸",reward:"ðŸŽ",liquidity:"ðŸ’§"},es={liquidity_pool:"LP",staking:"Staking",lending:"Lending",farming:"Farming",vault:"Vault"};function ts(t){const s={};for(const r of t){const a=`${r.protocol}-${r.chain_id}-${r.name||r.token_name}-${r.position_type}`;s[a]||(s[a]={key:a,name:r.name||r.token_name,protocol:r.protocol,protocol_module:r.protocol_module,position_type:r.position_type,chain_id:r.chain_id,tokens:[],total_usd:0}),s[a].tokens.push(r),s[a].total_usd+=Number(r.balance_usd)}return Object.values(s)}function ss({group:t,onClick:s,isPrivacyMode:r}){const a=t.chain_id,d=se[a],x=t.tokens[0],n=r?t.tokens.map(b=>`*** ${b.symbol}`).join(" + "):t.tokens.map(b=>{const u=Number(b.balance);return`${u<1e-4?"<0.0001":u<1?u.toFixed(4):u.toFixed(2)} ${b.symbol}`}).join(" + ");return e.jsxs("button",{onClick:()=>s(t),className:"w-full flex items-center justify-between py-3 px-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors text-left group",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:t.tokens.length>1?e.jsxs("div",{className:"flex -space-x-2",children:[t.tokens.slice(0,3).map((b,u)=>b.logo_url?e.jsx("img",{src:b.logo_url,alt:b.symbol,className:"w-7 h-7 rounded-full border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-u},onError:f=>{f.target.style.display="none"}},b.id):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-u},children:b.symbol.slice(0,2)},b.id)),t.tokens.length>3&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",t.tokens.length-3]})]}):x.logo_url?e.jsx("img",{src:x.logo_url,alt:x.symbol,className:"w-8 h-8 rounded-full",onError:b=>{b.target.style.display="none"}}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:Zt[t.position_type]||"ðŸ“ˆ"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.protocol}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:es[t.protocol_module]||t.protocol_module})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"truncate",children:t.name}),d&&e.jsxs("span",{className:"text-xs px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:[d.icon," ",a.toUpperCase()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:r?"$***":`$${t.total_usd.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[180px] truncate",children:n})]}),e.jsx(Qe,{className:"w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors"})]})]})}function qe(){const{t}=z("common"),{currency:s}=fe(),{isPrivacyMode:r}=ce(),[a,d]=p.useState(null),x=xe(),{data:n,isLoading:b}=I({queryKey:["crypto-wallets"],queryFn:Ee}),{data:u=[]}=I({queryKey:["unattributed-rewards"],queryFn:Ve}),{data:f,isLoading:k,refetch:v}=I({queryKey:["crypto-defi-positions",n==null?void 0:n.map(g=>g.id)],queryFn:async()=>!n||n.length===0?[]:await Promise.all(n.map(N=>Oe(N.id).catch(()=>({wallet_address:N.wallet_address,total_value_usd:0,positions:[],last_sync_at:null})))),enabled:!!n&&n.length>0}),m=(f==null?void 0:f.flatMap(g=>g.positions))||[],h=ts(m),S=(f==null?void 0:f.reduce((g,N)=>g+Number(N.total_value_usd||0),0))||0,A=1/((x==null?void 0:x.USD)||.00667),q=Math.round(S*A),P=h.reduce((g,N)=>{const j=N.protocol;return g[j]||(g[j]=[]),g[j].push(N),g},{});if(b||k)return e.jsx(ie,{title:t("crypto.defiPositions"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(H,{size:"md"})})});if(!n||n.length===0)return null;const M=u.length>0?`${h.length} Â· ${u.length} âš `:h.length;return e.jsxs(ie,{title:t("crypto.defiPositions"),badge:M,defaultOpen:h.length>0,children:[m.length>0&&e.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalDefiValue")}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:U(q,s,x,!1,r)})]}),e.jsx("button",{onClick:()=>v(),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors",title:t("crypto.refresh"),children:e.jsx(J,{className:"w-5 h-5"})})]})}),n[0]&&e.jsx("div",{className:"mb-4",children:e.jsx(Xt,{walletId:n[0].id})}),h.length>0?e.jsx("div",{className:"space-y-4",children:Object.entries(P).sort(([,g],[,N])=>{const j=g.reduce((l,o)=>l+o.total_usd,0);return N.reduce((l,o)=>l+o.total_usd,0)-j}).map(([g,N])=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:g}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r?"$***":`$${N.reduce((j,w)=>j+w.total_usd,0).toFixed(2)}`})]})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:N.sort((j,w)=>w.total_usd-j.total_usd).map(j=>e.jsx(ss,{group:j,onClick:d,isPrivacyMode:r},j.key))})]},g))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(vt,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("crypto.noDefiPositions")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("crypto.noDefiPositionsDescription")})]}),a&&e.jsx(Gt,{group:a,onClose:()=>d(null)})]})}function Te(){const{t}=z("common"),[s,r]=p.useState(!1),{data:a,isLoading:d}=I({queryKey:["closed-positions"],queryFn:Wt});return d||!a||a.total_closed===0?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!s),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(kt,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t("crypto.closedPositions","Closed Positions")}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.total_closed," ",t("crypto.positions","positions")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[a.total_realized_pnl_jpy!==null&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:t("crypto.totalPnl","Total P&L")}),e.jsxs("p",{className:`font-medium ${a.total_realized_pnl_jpy>=0?"text-green-600":"text-red-600"}`,children:[a.total_realized_pnl_jpy>=0?"+":"",ue(a.total_realized_pnl_jpy,"JPY")]})]}),s?e.jsx(me,{className:"w-5 h-5 text-gray-500"}):e.jsx(G,{className:"w-5 h-5 text-gray-500"})]})]}),s&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 space-y-3",children:a.positions.map(x=>{const n=se[x.chain_id],b=x.realized_pnl_jpy!==null&&x.realized_pnl_jpy>=0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[x.protocol," - ",x.symbol]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[n&&e.jsx("span",{children:n.icon}),e.jsx("span",{children:new Date(x.exit_date).toLocaleDateString()})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:ue(x.exit_value_jpy,"JPY")}),x.realized_pnl_jpy!==null&&e.jsxs("div",{className:`flex items-center justify-end gap-1 text-sm ${b?"text-green-600":"text-red-600"}`,children:[b?e.jsx(re,{className:"w-3 h-3"}):e.jsx(ke,{className:"w-3 h-3"}),b?"+":"",ue(x.realized_pnl_jpy,"JPY"),x.realized_pnl_pct!==null&&e.jsxs("span",{className:"text-xs",children:["(",x.realized_pnl_pct.toFixed(1),"%)"]})]})]})]},x.id)})})]})}async function rs(t){return(await Ne.post("/api/transfers/",t)).data}const Z={JPY:"Â¥",USD:"$",VND:"â‚«"};function ee(t){const s=t.replace(/[^\d]/g,"");return s?parseInt(s).toLocaleString("en-US"):""}function Q(t){return parseInt(t.replace(/[,.\s]/g,""),10)||0}function as({isOpen:t,onClose:s}){const{t:r}=z("common"),a=Y(),{data:d}=We(),x=xe(),[n,b]=p.useState(null),[u,f]=p.useState(null),[k,v]=p.useState(""),[m,h]=p.useState(""),[S,A]=p.useState(""),[q,P]=p.useState(new Date().toISOString().split("T")[0]),[L,M]=p.useState(""),[g,N]=p.useState({}),j=p.useMemo(()=>d==null?void 0:d.find(c=>c.id===n),[d,n]),w=p.useMemo(()=>d==null?void 0:d.find(c=>c.id===u),[d,u]),l=p.useMemo(()=>(d==null?void 0:d.filter(c=>c.id!==n))||[],[d,n]);p.useEffect(()=>{if(!j||!w||!k||!x)return;const c=Q(k);if(c<=0)return;if(j.currency===w.currency){h(ee(c.toString()));return}const D=x[j.currency]||1,E=x[w.currency]||1,F=c/D,V=Math.round(F*E);h(ee(V.toString()))},[j,w,k,x]),p.useEffect(()=>{var c;t&&(b(((c=d==null?void 0:d[0])==null?void 0:c.id)||null),f(null),v(""),h(""),A(""),P(new Date().toISOString().split("T")[0]),M(""),N({}))},[t,d]);const o=O({mutationFn:rs,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["transfers"]}),a.invalidateQueries({queryKey:["analytics"]}),s()}}),i=()=>{const c={};return n||(c.fromAccount=r("transfer.errors.fromRequired")),u||(c.toAccount=r("transfer.errors.toRequired")),n&&u&&n===u&&(c.toAccount=r("transfer.errors.sameAccount")),(!k||Q(k)<=0)&&(c.fromAmount=r("transfer.errors.amountRequired")),(!m||Q(m)<=0)&&(c.toAmount=r("transfer.errors.amountRequired")),N(c),Object.keys(c).length===0},$=c=>{if(c.preventDefault(),!i())return;const D=(j==null?void 0:j.currency)||"JPY",E=(w==null?void 0:w.currency)||"JPY",F={from_account_id:n,to_account_id:u,from_amount:ge(Q(k),D),to_amount:ge(Q(m),E),fee_amount:ge(Q(S)||0,D),date:q,description:L.trim()||void 0};j&&w&&j.currency!==w.currency&&(F.exchange_rate=Q(m)/Q(k)),o.mutate(F)};if(!t)return null;const R=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 animate-modal-backdrop",onClick:s}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:r("transfer.title")}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:$,className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.fromAccount")}),e.jsxs("select",{value:n||"",onChange:c=>b(c.target.value?parseInt(c.target.value):null),className:K("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",g.fromAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),d==null?void 0:d.map(c=>e.jsxs("option",{value:c.id,children:[c.name," (",Z[c.currency]||c.currency,")"]},c.id))]}),g.fromAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:g.fromAccount})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(wt,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.toAccount")}),e.jsxs("select",{value:u||"",onChange:c=>f(c.target.value?parseInt(c.target.value):null),className:K("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",g.toAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:r("transfer.selectAccount")}),l.map(c=>e.jsxs("option",{value:c.id,children:[c.name," (",Z[c.currency]||c.currency,")"]},c.id))]}),g.toAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:g.toAccount})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:j?Z[j.currency]||j.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:k,onChange:c=>v(ee(c.target.value)),className:K("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",g.fromAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),g.fromAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:g.fromAmount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.convertedAmount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:w?Z[w.currency]||w.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:m,onChange:c=>h(ee(c.target.value)),className:K("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",g.toAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),g.toAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:g.toAmount})]})]}),j&&w&&j.currency!==w.currency&&k&&m&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["1 ",j.currency," â‰ˆ ",(Q(m)/Q(k)).toFixed(4)," ",w.currency]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.fee")," (",r("common.optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:j?Z[j.currency]||j.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:S,onChange:c=>A(ee(c.target.value)),className:"w-full h-12 pl-10 pr-4 border border-gray-300 rounded-lg text-right dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("transfer.date")}),e.jsx("input",{type:"date",value:q,onChange:c=>P(c.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("transfer.description")," (",r("common.optional"),")"]}),e.jsx("input",{type:"text",value:L,onChange:c=>M(c.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:r("transfer.descriptionPlaceholder")})]}),o.isError&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:r("transfer.error")}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(te,{type:"button",variant:"outline",onClick:s,className:"flex-1 h-12",children:r("common.cancel")}),e.jsx(te,{type:"submit",loading:o.isPending,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700",children:r("transfer.create")})]})]})]})]});return typeof document>"u"?null:oe.createPortal(R,document.body)}const Je="accounts_collapsed_sections";function ns(){try{const t=localStorage.getItem(Je);if(t)return new Set(JSON.parse(t))}catch{}return new Set}function ls(t){localStorage.setItem(Je,JSON.stringify([...t]))}function is(){const{t}=z("common"),[s,r]=p.useState(!1),[a,d]=p.useState(!1),[x,n]=p.useState(!1),[b,u]=p.useState(null),[f,k]=p.useState(()=>ns());p.useEffect(()=>{ls(f)},[f]);const v=p.useCallback(g=>{k(N=>{const j=new Set(N);return j.has(g)?j.delete(g):j.add(g),j})},[]),{data:m,isLoading:h,error:S}=We(s),A=()=>{u(null),d(!0)},q=g=>{u(g),d(!0)},P=()=>{d(!1),u(null)},L=m==null?void 0:m.reduce((g,N)=>{const j=N.type;return g[j]||(g[j]=[]),g[j].push(N),g},{}),M=["bank","savings","cash","credit_card","investment","crypto","receivable","other"];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:t("account.accounts")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:t("account.manageYourAccounts")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(_t,{className:"w-5 h-5"}),t("transfer.title")]}),e.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),t("account.createAccount")]})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:g=>r(g.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 dark:bg-gray-700"}),t("account.showInactive")]})})]}),h&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),S&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-red-700 dark:text-red-400",children:[t("account.errors.loadFailed"),": ",S.message]})}),!h&&!S&&(!m||m.length===0)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-700 mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:t("account.noAccounts")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:t("account.createFirstAccount")}),e.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),t("account.createAccount")]})]}),!h&&!S&&m&&m.length>0&&e.jsxs("div",{className:"space-y-8",children:[M.map(g=>{const N=L==null?void 0:L[g];if(!N||N.length===0)return null;const j=f.has(g);return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>v(g),className:"w-full flex items-center justify-between mb-4 group cursor-pointer",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[t(`account.type.${g}`),e.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",N.length,")"]})]}),e.jsx(G,{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform duration-200 ${j?"-rotate-90":""}`})]}),e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 transition-all duration-200 ease-in-out ${j?"max-h-0 opacity-0 overflow-hidden":"max-h-[2000px] opacity-100"}`,children:N.map(w=>e.jsx(Mt,{account:w,onEdit:q},w.id))})]},g)}),e.jsx(Re,{}),e.jsx(qe,{}),e.jsx(Te,{})]}),!h&&!S&&(!m||m.length===0)&&e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx(Re,{}),e.jsx(qe,{}),e.jsx(Te,{})]}),e.jsx(Rt,{isOpen:a,onClose:P,editingAccountId:b}),e.jsx(as,{isOpen:x,onClose:()=>n(!1)})]})}const hs=Ge("/accounts")({component:is});export{hs as Route};
