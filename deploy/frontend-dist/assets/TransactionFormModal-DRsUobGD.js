import{j as e,g as t,k as a,u as r}from"./vendor-tanstack-DaKcK1QW.js";import{r as s,a as n}from"./vendor-react-Bx4JnVfy.js";import{a as l,d as c,I as i,B as o,Z as d,$ as u,a0 as g,e as m,a1 as x,z as b,A as h}from"./index-DX1XEPIO.js";import{c as p}from"./recurring-service-DPFqCjNp.js";import{d as y,e as f}from"./useCategories-D0wiQusU.js";import{u as j}from"./vendor-i18n-BrrOrGm_.js";import{s as v,P as k,x as N,X as w,ay as C,w as S,U as R,C as P,R as E,J as T}from"./vendor-icons-ALW4ipAx.js";import{R as z}from"./RecurringOptions-vWMPKTA5.js";import{u as D}from"./useXPGain-DyT_xoUD.js";async function L(e){return(await l.post("/api/receipts/scan",e)).data}async function I(e){const t=new FormData;t.append("file",e);return(await l.post("/api/receipts/upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data.receipt_url}function O(e){return e||null}function F({selected:t,onSelect:a,isIncome:r=!1}){const{t:n}=j("common"),{data:l,isLoading:d}=y(),u=f(),[g,m]=s.useState(null),[x,b]=s.useState(!1),[h,p]=s.useState(""),[N,w]=s.useState("ðŸ“");if(d||!l)return e.jsx("div",{className:"animate-pulse h-48 bg-gray-100 dark:bg-gray-700 rounded-lg"});const C=r?l.income:l.expense,S=e=>{for(const t of C)if(t.children.some(t=>t.name===e))return t;return null},R=()=>{m(null),b(!1)},P=async()=>{g&&h.trim()&&(await u.mutateAsync({name:h.trim(),icon:N,parent_id:g.id,type:r?"income":"expense"}),a(h.trim(),g.name),p(""),b(!1))};return g?e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:R,className:"flex items-center gap-2 text-sm text-gray-600 mb-3 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(v,{className:"w-4 h-4"}),g.icon," ",g.name]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[g.children.map(r=>e.jsxs("button",{type:"button",onClick:()=>(e=>{g&&a(e.name,g.name)})(r),className:c("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",t===r.name?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:r.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:r.name})]},r.id)),e.jsxs("button",{type:"button",onClick:()=>b(!0),className:c("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors","bg-gray-50 border-2 border-dashed border-gray-300 hover:bg-gray-100","dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:[e.jsx(k,{className:"w-6 h-6 mb-1 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:n("category.addCustom","Add")})]})]}),x&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{value:N,onChange:e=>w(e.target.value),className:"w-16 text-center text-xl",maxLength:2}),e.jsx(i,{value:h,onChange:e=>p(e.target.value),placeholder:n("category.namePlaceholder","Category name"),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>b(!1),children:n("cancel","Cancel")}),e.jsx(o,{size:"sm",onClick:P,disabled:!h.trim()||u.isPending,children:n("create","Create")})]})]})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:C.map(a=>{var r;return e.jsxs("button",{type:"button",onClick:()=>(e=>{m(e),b(!1)})(a),className:c("flex flex-col items-center justify-center p-3 rounded-lg","min-h-[64px] transition-colors",(null==(r=S(t))?void 0:r.id)===a.id?"bg-blue-100 border-2 border-blue-500 dark:bg-blue-900":"bg-gray-50 border-2 border-transparent hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600"),children:[e.jsx("span",{className:"text-2xl mb-1",children:a.icon}),e.jsx("span",{className:"text-xs text-center truncate w-full dark:text-gray-200",children:a.name})]},a.id)})})}function U(e,r,s){return function(e,r){const s=t(),{entityType:n,operationType:l,getEntityId:c=()=>0,invalidateKeys:i=[],onSuccess:o,onError:g}=r;return a({mutationFn:async t=>{if(!navigator.onLine){const e=c(t);return await u(l,n,e,t),null}try{const a=await e(t);for(const e of i)s.invalidateQueries({queryKey:e});return a}catch(a){if(a instanceof TypeError&&a.message.includes("fetch")){const e=c(t);return await u(l,n,e,t),null}throw a}},onSuccess:e=>{navigator.onLine&&d(),null==o||o(e)},onError:e=>{null==g||g(e)}})}(e,{entityType:r,operationType:"CREATE",invalidateKeys:s})}function q({value:t,onChange:a,onSuggestionSelect:n,placeholder:l,className:i,error:o}){const{t:d}=j("common"),[u,m]=s.useState(!1),[x,b]=s.useState(""),h=s.useRef(null),p=s.useRef(null);s.useEffect(()=>{const e=setTimeout(()=>{b(t)},300);return()=>clearTimeout(e)},[t]);const{data:y=[]}=r({queryKey:["transaction-suggestions",x],queryFn:()=>g(x),enabled:x.length>=2,staleTime:3e4});s.useEffect(()=>{m(y.length>0&&t.length>=2)},[y,t]),s.useEffect(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const f=s.useCallback(e=>{var t;"Escape"===e.key&&(m(!1),null==(t=h.current)||t.blur())},[]);return e.jsxs("div",{ref:p,className:"relative",children:[e.jsx("input",{ref:h,type:"text",value:t,onChange:e=>a(e.target.value),onKeyDown:f,onFocus:()=>y.length>0&&m(!0),placeholder:l,className:c("w-full h-12 px-4 border rounded-lg text-base","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400",o?"border-red-500":"border-gray-300",i)}),u&&y.length>0&&e.jsx("div",{className:c("absolute top-full left-0 right-0 z-50 mt-1","bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700","max-h-60 overflow-y-auto"),children:y.map((t,r)=>{return e.jsxs("button",{type:"button",onClick:()=>(e=>{a(e.description),m(!1),null==n||n(e)})(t),className:c("w-full px-4 py-3 flex items-center justify-between text-left","hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors","border-b border-gray-100 dark:border-gray-700 last:border-0"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.description}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.category}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"â€¢"}),e.jsxs("span",{className:"text-gray-400",children:[t.count,"x ",d("autocomplete.used","used")]})]})]}),e.jsx("div",{className:"ml-4 text-right shrink-0",children:e.jsxs("div",{className:c("font-medium font-numbers",t.is_income?"text-green-600":"text-gray-900 dark:text-gray-100"),children:["Â¥",(s=t.amount,Math.abs(s).toLocaleString())]})})]},`${t.description}-${r}`);var s})})]})}function A({onCapture:t,onCancel:a}){const{t:r}=j(),n=s.useRef(null),l=s.useRef(null),[c,i]=s.useState(null),[o,d]=s.useState(null),[u,g]=s.useState(null),[m,x]=s.useState(!0),b=s.useCallback(async()=>{x(!0),g(null);try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});n.current&&(n.current.srcObject=e,i(e))}catch(e){g(r("receipt.cameraError","Could not access camera"))}finally{x(!1)}},[r]),h=s.useCallback(()=>{c&&(c.getTracks().forEach(e=>e.stop()),i(null))},[c]),p=s.useCallback(()=>{if(!n.current||!l.current)return;const e=n.current,t=l.current,a=t.getContext("2d");if(!a)return;t.width=e.videoWidth,t.height=e.videoHeight,a.drawImage(e,0,0);const r=t.toDataURL("image/jpeg",.8);d(r),h()},[h]),y=s.useCallback(()=>{d(null),b()},[b]),f=s.useCallback(()=>{o&&t(o)},[o,t]);return s.useEffect(()=>(b(),()=>{c&&c.getTracks().forEach(e=>e.stop())}),[]),u?e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(N,{size:48,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-red-400 mb-6",children:u}),e.jsx("button",{onClick:a,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:r("close","Close")})]}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/50 absolute top-0 left-0 right-0 z-10",children:[e.jsx("button",{onClick:a,className:"text-white p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":r("close","Close"),children:e.jsx(w,{size:24})}),e.jsx("span",{className:"text-white font-medium",children:r("receipt.scanReceipt","Scan Receipt")}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-black",children:[m&&!o&&e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"}),e.jsx("p",{className:"text-white",children:r("receipt.startingCamera","Starting camera...")})]}),o?e.jsx("img",{src:o,alt:"Captured receipt",className:"max-w-full max-h-full object-contain"}):e.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",onLoadedMetadata:()=>x(!1)}),e.jsx("canvas",{ref:l,className:"hidden"})]}),e.jsx("div",{className:"p-6 bg-black/50 flex justify-center gap-8 absolute bottom-0 left-0 right-0 safe-area-bottom",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[e.jsx(C,{size:20}),r("receipt.retake","Retake")]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(S,{size:20}),r("receipt.usePhoto","Use Photo")]})]}):e.jsx("button",{onClick:p,disabled:m,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center disabled:opacity-50 transition-opacity","aria-label":r("receipt.takePhoto","Take Photo"),children:e.jsx("div",{className:"w-14 h-14 rounded-full border-4 border-black"})})})]})}function _({onImageSelect:t,className:a}){const{t:r}=j(),[n,l]=s.useState(!1),[i,o]=s.useState(!1),d=s.useCallback(async e=>{if(e.type.startsWith("image/")){o(!0);try{const a=await async function(e,t=1024,a=1024,r=.8){return new Promise((s,n)=>{const l=new Image,c=document.createElement("canvas"),i=c.getContext("2d");i?(l.onload=()=>{let{width:e,height:n}=l;if(e>t||n>a){const r=Math.min(t/e,a/n);e=Math.round(e*r),n=Math.round(n*r)}c.width=e,c.height=n,i.drawImage(l,0,0,e,n);const o=c.toDataURL("image/jpeg",r);URL.revokeObjectURL(l.src),s(o)},l.onerror=()=>{URL.revokeObjectURL(l.src),n(new Error("Failed to load image"))},l.src=URL.createObjectURL(e)):n(new Error("Failed to get canvas context"))})}(e);t(a)}catch{alert(r("receipt.processError","Failed to process image"))}finally{o(!1)}}else alert(r("receipt.invalidFile","Please select an image file"))},[t,r]),u=s.useCallback(e=>{e.preventDefault(),l(!1);const t=e.dataTransfer.files[0];t&&d(t)},[d]),g=s.useCallback(e=>{e.preventDefault(),l(!0)},[]),m=s.useCallback(()=>{l(!1)},[]),x=s.useCallback(e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];a&&d(a)},[d]);return e.jsxs("div",{onDrop:u,onDragOver:g,onDragLeave:m,className:c("border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",n?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500",i&&"opacity-50 pointer-events-none",a),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:x,className:"hidden",id:"receipt-file-input"}),e.jsx("label",{htmlFor:"receipt-file-input",className:"cursor-pointer",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:r("receipt.processing","Processing...")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(R,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:r("receipt.dropOrClick","Drop image here or click to upload")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:r("receipt.supportedFormats","JPG, PNG, HEIC supported")})]})]})})})]})}function M({isOpen:t,onClose:r,onScanComplete:l}){const{t:c}=j(),[i,o]=s.useState("select"),[d,u]=s.useState(null),g=a({mutationFn:L,onSuccess:e=>{l(e.data),m()}}),m=s.useCallback(()=>{o("select"),u(null),g.reset(),r()},[r,g]),x=s.useCallback(e=>{u(e),o("preview")},[]),b=s.useCallback(()=>{d&&g.mutate({image:d})},[d,g]),h=s.useCallback(()=>{u(null),o("select")},[]);if(!t)return null;if("camera"===i){const t=e.jsx(A,{onCapture:x,onCancel:()=>o("select")});return"undefined"==typeof document?null:n.createPortal(t,document.body)}const p=e.jsx("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",onClick:e=>{e.target===e.currentTarget&&m()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:c("receipt.scanReceipt","Scan Receipt")}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":c("close","Close"),children:e.jsx(w,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-4",children:["select"===i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>o("camera"),className:"w-full h-14 flex items-center justify-center gap-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(N,{size:24}),c("receipt.takePhoto","Take Photo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("or","or")}),e.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),e.jsx(_,{onImageSelect:x})]}),"preview"===i&&d&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:e.jsx("img",{src:d,alt:"Receipt preview",className:"w-full max-h-64 object-contain"})}),g.isPending&&e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:c("receipt.analyzing","Analyzing receipt with AI...")})]}),g.isError&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:[e.jsx(P,{size:20}),e.jsx("span",{children:c("receipt.scanError","Failed to scan receipt. Please try again.")})]}),!g.isPending&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,className:"flex-1 h-12 flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:c("receipt.retake","Retake")}),e.jsxs("button",{onClick:b,disabled:g.isPending,className:"flex-1 h-12 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(S,{size:20}),c("receipt.scan","Scan")]})]})]})]})]})});return"undefined"==typeof document?null:n.createPortal(p,document.body)}const K={JPY:"Â¥",USD:"$",VND:"â‚«"};function W(e){const t=e.replace(/[^\d]/g,"");return t?parseInt(t).toLocaleString():""}function J({isOpen:r,onClose:l}){const{t:i}=j("common"),{data:d}=m(),u=t(),g=x(),[y,f]=s.useState(!1),[v,k]=s.useState((new Date).toISOString().split("T")[0]),[C,S]=s.useState(""),[R,P]=s.useState(""),[L,O]=s.useState(""),[A,_]=s.useState(""),[J,$]=s.useState(null),[G,H]=s.useState({}),[Q,X]=s.useState(!1),[Y,B]=s.useState(null),[V,Z]=s.useState(null),[ee,te]=s.useState(!1),ae=s.useRef(null),[re,se]=s.useState(!1),[ne,le]=s.useState("monthly"),[ce,ie]=s.useState(0),[oe,de]=s.useState(25),[ue,ge]=s.useState(7),me=s.useMemo(()=>(null==d?void 0:d.find(e=>e.id===J))||null,[d,J]),xe=(null==me?void 0:me.currency)?K[me.currency]||me.currency:"Â¥",{showTransactionXP:be}=D();s.useEffect(()=>{var e;r&&(f(!1),k((new Date).toISOString().split("T")[0]),S(""),P(""),O(""),_(""),$((null==(e=null==d?void 0:d[0])?void 0:e.id)||null),H({}),B(null),Z(null),se(!1),le("monthly"),ie(0),de(25),ge(7))},[r,d]),s.useEffect(()=>{_("")},[y]);const he=U(h,"transaction",[["transactions"],["analytics"]]),pe=a({mutationFn:p,onSuccess:()=>{u.invalidateQueries({queryKey:["recurring-transactions"]})}});if(!r)return null;const ye=e.jsxs("div",{className:"fixed inset-0 z-[100002] bg-black/50 animate-modal-backdrop",onClick:e=>{e.target===e.currentTarget&&l()},children:[e.jsxs("div",{className:c("fixed inset-x-0 bottom-0 z-[100002]","bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl","max-h-[90vh] overflow-y-auto","animate-modal-in"),children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 dark:text-gray-100",children:i("transaction.addTransaction","Add Transaction")})}),e.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[e.jsxs("button",{type:"button",onClick:()=>X(!0),className:"w-full h-12 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium transition-all shadow-md hover:shadow-lg",children:[e.jsx(E,{size:20}),i("receipt.scanReceipt","Scan Receipt")]}),e.jsx("input",{ref:ae,type:"file",accept:"image/*",capture:"environment",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;if(!a.type.startsWith("image/"))return;B(a);const r=URL.createObjectURL(a);Z(r)},className:"hidden"}),V?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:V,alt:"Receipt preview",className:"w-full h-24 object-cover"}),e.jsx("button",{type:"button",onClick:()=>{B(null),V&&(URL.revokeObjectURL(V),Z(null)),ae.current&&(ae.current.value="")},className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(w,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=ae.current)?void 0:e.click()},className:"w-full h-12 flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 text-gray-500 dark:text-gray-400 rounded-lg font-medium transition-colors",children:[e.jsx(N,{size:20}),i("receipt.attachReceipt","Attach Receipt Photo")]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};return(!C||parseInt(C)<=0)&&(e.amount=i("transaction.errors.amountRequired","Amount is required")),L.trim()||(e.description=i("transaction.errors.descriptionRequired","Description is required")),A||(e.category=i("transaction.errors.categoryRequired","Category is required")),J||(e.source=i("transaction.errors.sourceRequired","Account is required")),H(e),0===Object.keys(e).length})())return;const t=A||"Other",a=(null==me?void 0:me.currency)||"JPY",r=b(parseInt(C),a);try{let e;if(Y){te(!0);try{e=await I(Y)}finally{te(!1)}}await he.mutateAsync({date:v,description:L.trim(),amount:y?r:-r,currency:a,category:t,source:(null==me?void 0:me.name)||"",type:y?"income":"expense",account_id:J,receipt_url:e}),re&&await pe.mutateAsync({description:L.trim(),amount:r,category:t,account_id:J,is_income:y,frequency:ne,day_of_week:"weekly"===ne?ce:null,day_of_month:"monthly"===ne?oe:null,interval_days:"custom"===ne?ue:null,start_date:v}),be(),l(),g.success(i("transaction.saved","Transaction saved!"))}catch{}},className:"px-4 pb-8 space-y-4",children:[e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:c("flex-1 py-3 rounded-md text-sm font-medium transition-colors",y?"text-gray-600 dark:text-gray-300":"bg-red-500 text-white"),children:i("transaction.expense","Expense")}),e.jsx("button",{type:"button",onClick:()=>f(!0),className:c("flex-1 py-3 rounded-md text-sm font-medium transition-colors",y?"bg-green-500 text-white":"text-gray-600 dark:text-gray-300"),children:i("transaction.income","Income")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("transaction.date","Date")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:v,onChange:e=>k(e.target.value),className:"flex-1 h-12 px-4 border border-gray-300 rounded-lg text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"}),e.jsx("button",{type:"button",onClick:()=>k((new Date).toISOString().split("T")[0]),className:"px-4 h-12 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium",children:i("today","Today")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("transaction.amount","Amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-lg font-medium text-gray-500 dark:text-gray-400",children:xe}),e.jsx("input",{type:"text",inputMode:"numeric",value:R,onChange:e=>{const t=e.target.value.replace(/[^\d]/g,"");S(t),P(W(t))},placeholder:"0",className:c("w-full h-12 pl-10 pr-4 border rounded-lg text-base text-right font-numbers","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",G.amount?"border-red-500":"border-gray-300")})]}),G.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:G.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("transaction.description","Description")}),e.jsx(q,{value:L,onChange:O,onSuggestionSelect:e=>{const t=e.amount.toString();S(t),P(W(t)),f(e.is_income),e.category&&_(e.category)},placeholder:i("transaction.descriptionPlaceholder","What was this for?"),error:!!G.description}),G.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:G.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("transaction.category","Category")}),e.jsx(F,{selected:A,onSelect:e=>_(e),isIncome:y}),G.category&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:G.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("transaction.source","Account")}),e.jsxs("select",{value:J||"",onChange:e=>$(e.target.value?parseInt(e.target.value):null),className:c("w-full h-12 px-4 border rounded-lg text-base","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",G.source?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:i("transaction.selectAccount","Select account")}),null==d?void 0:d.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",K[t.currency]||t.currency,")"]},t.id))]}),G.source&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:G.source})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re,onChange:e=>se(e.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx(T,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("recurring.makeRecurring")})]}),re&&e.jsx(z,{frequency:ne,setFrequency:le,dayOfWeek:ce,setDayOfWeek:ie,dayOfMonth:oe,setDayOfMonth:de,intervalDays:ue,setIntervalDays:ge})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:l,className:"flex-1 h-12",children:i("cancel","Cancel")}),e.jsx(o,{type:"submit",loading:he.isPending||pe.isPending||ee,className:c("flex-1 h-12",re?"bg-blue-500 hover:bg-blue-600":y?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:i("save","Save")})]}),(he.isError||pe.isError)&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:i("transaction.errors.createFailed","Failed to create transaction")})]})]}),e.jsx(M,{isOpen:Q,onClose:()=>X(!1),onScanComplete:e=>{if(null!==e.amount){const t=Math.abs(e.amount).toString();S(t),P(W(t)),f(!1)}e.date&&k(e.date),e.merchant&&O(e.merchant),e.category&&_(e.category),X(!1)}})]});return"undefined"!=typeof document?n.createPortal(ye,document.body):null}export{F as H,M as R,J as T,U as a,O as g,I as u};
