import{u as Ee,j as r,c as wt,k as We,e as Et,m as Ct}from"./vendor-tanstack-DOuiVnRb.js";import{r as _}from"./vendor-react-B9eo89kj.js";import{C as Q,L as Ie,p as ct,a4 as lt,Y as ie,a5 as ut,a as dt,B as Y,c as R,q as It,a6 as Tt,V as Mt}from"./index-C4UxDUME.js";import{IncomeExpenseBarChart as At}from"./IncomeExpenseBarChart-Bg7jQYQj.js";import{CategoryBarChart as Lt}from"./CategoryBarChart-CIIP3Td1.js";import{TrendLineChart as _t}from"./TrendLineChart-7DdrEhCF.js";import{CashFlowSummary as Pt}from"./CashFlowSummary-Da6jTWVz.js";import{ZoomableChart as Oe}from"./ZoomableChart-CODyVQ9c.js";import{u as U}from"./vendor-i18n-CtQU9zWU.js";import{e as et,s as Ce,f as se,g as Dt,h as Ne}from"./vendor-date-fteVm545.js";import"./vendor-recharts-BfEtinVu.js";import"./vendor-icons-Boynwk5e.js";const Ot={spike:"ðŸ“ˆ",trend:"ðŸ“Š",unusual:"ðŸ”",budget:"ðŸ’°",saving:"âœ¨"},Ft={info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"},zt={info:"text-blue-700 dark:text-blue-300",warning:"text-amber-700 dark:text-amber-300",success:"text-green-700 dark:text-green-300"};function Bt({insight:e}){const{currency:t}=ct(),{data:s}=lt();return r.jsx("div",{className:`p-4 rounded-lg border ${Ft[e.severity]} transition-all hover:shadow-sm`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:Ot[e.type]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:`font-medium ${zt[e.severity]}`,children:e.title}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&r.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-2",children:ie(e.amount,t,(s==null?void 0:s.rates)||{},!1)})]}),e.percentage_change!==void 0&&r.jsxs("span",{className:`text-sm font-medium px-2 py-1 rounded ${e.percentage_change>0?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400":"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"}`,children:[e.percentage_change>0?"+":"",e.percentage_change.toFixed(0),"%"]})]})})}function Rt(){const{t:e}=U("common"),{data:t,isLoading:s,error:a}=Ee({queryKey:["spending-insights"],queryFn:ut,staleTime:5*60*1e3});if(s)return r.jsxs(Q,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),r.jsx("div",{className:"flex justify-center py-8",children:r.jsx(Ie,{size:"md"})})]});if(a)return r.jsxs(Q,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:e("common.error","Failed to load insights")})]});const i=(t==null?void 0:t.insights)||[];return r.jsxs(Q,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.spendingInsights","Spending Insights")}),i.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("span",{className:"text-4xl mb-3 block",children:"ðŸŽ‰"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:e("analytics.noInsights","No notable spending patterns detected")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:e("analytics.insightsHint","Keep tracking to see personalized insights")})]}):r.jsx("div",{className:"space-y-3",children:i.map((o,n)=>r.jsx(Bt,{insight:o},`${o.type}-${o.category}-${n}`))})]})}async function tt(e=50,t="ja"){return(await dt.post("/api/ai/categorize/suggestions",{limit:e,language:t})).data}async function nt(e){return(await dt.post("/api/ai/categorize/apply",e)).data}const Se=50,Vt=.5;function $t({suggestion:e,isSelected:t,onToggle:s}){const{currency:a}=ct(),{data:i}=lt(),{t:o}=U("common"),n=e.confidence>=.8?"text-green-600 dark:text-green-400":e.confidence>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return r.jsxs("div",{className:`p-3 rounded-lg border transition-colors cursor-pointer ${t?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>s(e.transaction_id,e.suggested_category),children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:e.description}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:ie(e.amount,a,(i==null?void 0:i.rates)||{},!1)})]}),r.jsxs("div",{className:"text-right flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[e.is_new_category&&r.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:o("ai.newCategory")}),r.jsx("span",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:e.suggested_category})]}),r.jsxs("p",{className:`text-xs mt-1 ${n}`,children:[Math.round(e.confidence*100),"% ",o("ai.confidence")]})]})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 italic",children:e.reason})]})}function qt(){const{t:e,i18n:t}=U("common"),s=wt(),[a,i]=_.useState(null),[o,n]=_.useState(new Map),[u,l]=_.useState(!0),[c,x]=_.useState(0),[d,g]=_.useState(null),j=_.useRef(!1),m=We({mutationFn:()=>tt(Se,t.language),onSuccess:y=>{i(y),x(y.total_other_count);const N=new Map;y.suggestions.forEach(S=>{S.confidence>=.7&&N.set(S.transaction_id,S.suggested_category)}),n(N)}}),p=We({mutationFn:()=>nt({approved:Array.from(o.entries()).map(([y,N])=>({transaction_id:y,category:N})),create_rules:u}),onSuccess:()=>{s.invalidateQueries({queryKey:["analytics"]}),s.invalidateQueries({queryKey:["transactions"]});const y=c-o.size;y>0?(x(y),i(null),n(new Map),setTimeout(()=>m.mutate(),500)):(i(null),n(new Map),x(0))}}),h=_.useCallback(async()=>{j.current=!1;const y=Math.ceil(c/Se);let N=0;g({isRunning:!0,processed:0,total:c,currentBatch:0,totalBatches:y});for(let S=0;S<y&&!j.current;S++){g(C=>C?{...C,currentBatch:S+1}:null);try{const C=await tt(Se,t.language);if(C.suggestions.length===0||j.current)break;const I=C.suggestions.filter(A=>A.confidence>=.7).map(A=>({transaction_id:A.transaction_id,category:A.suggested_category}));I.length>0&&(await nt({approved:I,create_rules:u}),N+=I.length),g(A=>A?{...A,processed:N}:null),await new Promise(A=>setTimeout(A,300))}catch{break}}g(null),s.invalidateQueries({queryKey:["analytics"]}),s.invalidateQueries({queryKey:["transactions"]}),i(null),x(0)},[c,t.language,u,s]),f=()=>{j.current=!0,g(null)},b=(y,N)=>{n(S=>{const C=new Map(S);return C.has(y)?C.delete(y):C.set(y,N),C})},k=()=>{if(!a)return;const y=new Map;a.suggestions.forEach(N=>{y.set(N.transaction_id,N.suggested_category)}),n(y)},w=()=>{n(new Map)};if(d!=null&&d.isRunning){const y=d.total>0?Math.round(d.processed/d.total*100):0;return r.jsx(Q,{children:r.jsxs("div",{className:"py-8",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 text-center mb-4",children:e("ai.processingAll")}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2",children:r.jsx("div",{className:"bg-primary-500 h-4 rounded-full transition-all duration-300",style:{width:`${y}%`}})}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-4",children:e("ai.processProgress",{processed:d.processed,total:d.total,batch:d.currentBatch,totalBatches:d.totalBatches})}),r.jsx("div",{className:"text-center",children:r.jsx(Y,{variant:"outline",onClick:f,children:e("common.cancel")})})]})})}if(!a){const y=c,N=y>250,S=Math.ceil(y/Se)*Vt;return r.jsxs(Q,{children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.categoryCleanupDesc")}),y>0&&r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:e("ai.remainingOther",{count:y})})]}),r.jsxs("div",{className:"flex gap-2 flex-wrap",children:[r.jsx(Y,{onClick:()=>m.mutate(),disabled:m.isPending,children:m.isPending?r.jsxs(r.Fragment,{children:[r.jsx(Ie,{size:"sm",className:"mr-2"}),e("ai.analyzing")]}):e("ai.analyzeOther")}),N&&r.jsx(Y,{variant:"outline",onClick:h,disabled:m.isPending,title:e("ai.analyzeAllCredits",{credits:S.toFixed(1)}),children:e("ai.analyzeAll",{count:y})})]})]}),m.isError&&r.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:e("ai.analyzeError")})]})}if(a.suggestions.length===0)return r.jsx(Q,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e("ai.noSuggestions")}),r.jsx(Y,{variant:"outline",onClick:()=>i(null),className:"mt-4",children:e("common.close")})]})});const T=c-a.suggestions.length,E=T>250;return r.jsxs(Q,{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e("ai.categoryCleanup")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("ai.foundSuggestions",{count:a.suggestions.length,total:c})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Y,{variant:"outline",size:"sm",onClick:k,children:e("ai.selectAll")}),r.jsx(Y,{variant:"outline",size:"sm",onClick:w,children:e("ai.deselectAll")})]})]}),a.new_categories_suggested.length>0&&r.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:r.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e("ai.newCategoriesSuggested"),": ",a.new_categories_suggested.join(", ")]})}),r.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.suggestions.map(y=>r.jsx($t,{suggestion:y,isSelected:o.has(y.transaction_id),onToggle:b},y.transaction_id))}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[r.jsx("input",{type:"checkbox",checked:u,onChange:y=>l(y.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),e("ai.createRulesAuto")]}),r.jsxs("div",{className:"flex gap-2 flex-wrap",children:[r.jsx(Y,{variant:"outline",onClick:()=>i(null),children:e("common.cancel")}),E&&r.jsx(Y,{variant:"outline",onClick:h,disabled:p.isPending,children:e("ai.analyzeAll",{count:T})}),r.jsx(Y,{onClick:()=>p.mutate(),disabled:o.size===0||p.isPending,children:p.isPending?r.jsxs(r.Fragment,{children:[r.jsx(Ie,{size:"sm",className:"mr-2"}),e("ai.applying")]}):e("ai.applySelected",{count:o.size})})]})]}),p.isError&&r.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:e("ai.applyError")})]})]})}function we({label:e,value:t,change:s,trend:a="neutral",subtitle:i,className:o}){const{t:n}=U("common"),u=()=>a==="positive"?"text-green-600 dark:text-green-400":a==="negative"?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",l=()=>s==null?null:s>0?"â†‘":s<0?"â†“":"â†’";return r.jsxs("div",{className:R("bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm","border border-gray-100 dark:border-gray-700",o),children:[r.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:e}),r.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 truncate",children:t}),s!=null&&r.jsxs("div",{className:R("flex items-center gap-1 mt-1",u()),children:[r.jsxs("span",{className:"text-sm font-medium",children:[l()," ",Math.abs(s).toFixed(1),"%"]}),r.jsx("span",{className:"text-xs text-gray-400",children:n("analytics.vsLastPeriod")})]}),i&&r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1 truncate",children:i})]})}function Ht({analytics:e,displayCurrency:t="JPY"}){const{t:s}=U("common"),{total_income:a,total_expense:i,net_cashflow:o,comparison:n,top_category:u}=e,l=()=>n!=null&&n.income_change?n.income_change>0?"positive":"negative":"neutral",c=()=>n!=null&&n.expense_change?n.expense_change<0?"positive":"negative":"neutral",x=()=>n!=null&&n.net_change?n.net_change>0?"positive":"negative":"neutral";return r.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[r.jsx(we,{label:s("analytics.heroIncome"),value:ie(a,t),change:n==null?void 0:n.income_change,trend:l()}),r.jsx(we,{label:s("analytics.heroExpense"),value:ie(i,t),change:n==null?void 0:n.expense_change,trend:c()}),r.jsx(we,{label:s("analytics.heroNet"),value:ie(o,t),change:n==null?void 0:n.net_change,trend:x()}),r.jsx(we,{label:s("analytics.heroTopCategory"),value:(u==null?void 0:u.name)||"-",subtitle:u?`${ie(u.amount,t)} (${u.percentage}%)`:void 0})]})}function Kt(e){return Object.prototype.toString.call(e)==="[object Object]"}function st(e){return Kt(e)||Array.isArray(e)}function Gt(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Be(e,t){const s=Object.keys(e),a=Object.keys(t);if(s.length!==a.length)return!1;const i=JSON.stringify(Object.keys(e.breakpoints||{})),o=JSON.stringify(Object.keys(t.breakpoints||{}));return i!==o?!1:s.every(n=>{const u=e[n],l=t[n];return typeof u=="function"?`${u}`==`${l}`:!st(u)||!st(l)?u===l:Be(u,l)})}function rt(e){return e.concat().sort((t,s)=>t.name>s.name?1:-1).map(t=>t.options)}function Yt(e,t){if(e.length!==t.length)return!1;const s=rt(e),a=rt(t);return s.every((i,o)=>{const n=a[o];return Be(i,n)})}function Re(e){return typeof e=="number"}function Fe(e){return typeof e=="string"}function Me(e){return typeof e=="boolean"}function at(e){return Object.prototype.toString.call(e)==="[object Object]"}function P(e){return Math.abs(e)}function Ve(e){return Math.sign(e)}function he(e,t){return P(e-t)}function Qt(e,t){if(e===0||t===0||P(e)<=P(t))return 0;const s=he(P(e),P(t));return P(s/e)}function Ut(e){return Math.round(e*100)/100}function ye(e){return be(e).map(Number)}function V(e){return e[ve(e)]}function ve(e){return Math.max(0,e.length-1)}function $e(e,t){return t===ve(e)}function ot(e,t=0){return Array.from(Array(e),(s,a)=>t+a)}function be(e){return Object.keys(e)}function ft(e,t){return[e,t].reduce((s,a)=>(be(a).forEach(i=>{const o=s[i],n=a[i],u=at(o)&&at(n);s[i]=u?ft(o,n):n}),s),{})}function ze(e,t){return typeof t.MouseEvent<"u"&&e instanceof t.MouseEvent}function Jt(e,t){const s={start:a,center:i,end:o};function a(){return 0}function i(l){return o(l)/2}function o(l){return t-l}function n(l,c){return Fe(e)?s[e](l):e(t,l,c)}return{measure:n}}function je(){let e=[];function t(i,o,n,u={passive:!0}){let l;if("addEventListener"in i)i.addEventListener(o,n,u),l=()=>i.removeEventListener(o,n,u);else{const c=i;c.addListener(n),l=()=>c.removeListener(n)}return e.push(l),a}function s(){e=e.filter(i=>i())}const a={add:t,clear:s};return a}function Xt(e,t,s,a){const i=je(),o=1e3/60;let n=null,u=0,l=0;function c(){i.add(e,"visibilitychange",()=>{e.hidden&&m()})}function x(){j(),i.clear()}function d(h){if(!l)return;n||(n=h,s(),s());const f=h-n;for(n=h,u+=f;u>=o;)s(),u-=o;const b=u/o;a(b),l&&(l=t.requestAnimationFrame(d))}function g(){l||(l=t.requestAnimationFrame(d))}function j(){t.cancelAnimationFrame(l),n=null,u=0,l=0}function m(){n=null,u=0}return{init:c,destroy:x,start:g,stop:j,update:s,render:a}}function Zt(e,t){const s=t==="rtl",a=e==="y",i=a?"y":"x",o=a?"x":"y",n=!a&&s?-1:1,u=x(),l=d();function c(m){const{height:p,width:h}=m;return a?p:h}function x(){return a?"top":s?"right":"left"}function d(){return a?"bottom":s?"left":"right"}function g(m){return m*n}return{scroll:i,cross:o,startEdge:u,endEdge:l,measureSize:c,direction:g}}function ce(e=0,t=0){const s=P(e-t);function a(c){return c<e}function i(c){return c>t}function o(c){return a(c)||i(c)}function n(c){return o(c)?a(c)?e:t:c}function u(c){return s?c-s*Math.ceil((c-t)/s):c}return{length:s,max:t,min:e,constrain:n,reachedAny:o,reachedMax:i,reachedMin:a,removeOffset:u}}function mt(e,t,s){const{constrain:a}=ce(0,e),i=e+1;let o=n(t);function n(g){return s?P((i+g)%i):a(g)}function u(){return o}function l(g){return o=n(g),d}function c(g){return x().set(u()+g)}function x(){return mt(e,u(),s)}const d={get:u,set:l,add:c,clone:x};return d}function Wt(e,t,s,a,i,o,n,u,l,c,x,d,g,j,m,p,h,f,b){const{cross:k,direction:w}=e,T=["INPUT","SELECT","TEXTAREA"],E={passive:!1},y=je(),N=je(),S=ce(50,225).constrain(j.measure(20)),C={mouse:300,touch:400},I={mouse:500,touch:600},A=m?43:25;let $=!1,q=0,H=0,re=!1,te=!1,J=!1,X=!1;function fe(v){if(!b)return;function M(F){(Me(b)||b(v,F))&&ge(F)}const D=t;y.add(D,"dragstart",F=>F.preventDefault(),E).add(D,"touchmove",()=>{},E).add(D,"touchend",()=>{}).add(D,"touchstart",M).add(D,"mousedown",M).add(D,"touchcancel",O).add(D,"contextmenu",O).add(D,"click",W,!0)}function K(){y.clear(),N.clear()}function le(){const v=X?s:t;N.add(v,"touchmove",z,E).add(v,"touchend",O).add(v,"mousemove",z,E).add(v,"mouseup",O)}function ue(v){const M=v.nodeName||"";return T.includes(M)}function Z(){return(m?I:C)[X?"mouse":"touch"]}function me(v,M){const D=d.add(Ve(v)*-1),F=x.byDistance(v,!m).distance;return m||P(v)<S?F:h&&M?F*.5:x.byIndex(D.get(),0).distance}function ge(v){const M=ze(v,a);X=M,J=m&&M&&!v.buttons&&$,$=he(i.get(),n.get())>=2,!(M&&v.button!==0)&&(ue(v.target)||(re=!0,o.pointerDown(v),c.useFriction(0).useDuration(0),i.set(n),le(),q=o.readPoint(v),H=o.readPoint(v,k),g.emit("pointerDown")))}function z(v){if(!ze(v,a)&&v.touches.length>=2)return O(v);const D=o.readPoint(v),F=o.readPoint(v,k),G=he(D,q),ee=he(F,H);if(!te&&!X&&(!v.cancelable||(te=G>ee,!te)))return O(v);const ae=o.pointerMove(v);G>p&&(J=!0),c.useFriction(.3).useDuration(.75),u.start(),i.add(w(ae)),v.preventDefault()}function O(v){const D=x.byDistance(0,!1).index!==d.get(),F=o.pointerUp(v)*Z(),G=me(w(F),D),ee=Qt(F,G),ae=A-10*ee,ne=f+ee/50;te=!1,re=!1,N.clear(),c.useDuration(ae).useFriction(ne),l.distance(G,!m),X=!1,g.emit("pointerUp")}function W(v){J&&(v.stopPropagation(),v.preventDefault(),J=!1)}function B(){return re}return{init:fe,destroy:K,pointerDown:B}}function en(e,t){let a,i;function o(d){return d.timeStamp}function n(d,g){const m=`client${(g||e.scroll)==="x"?"X":"Y"}`;return(ze(d,t)?d:d.touches[0])[m]}function u(d){return a=d,i=d,n(d)}function l(d){const g=n(d)-n(i),j=o(d)-o(a)>170;return i=d,j&&(a=d),g}function c(d){if(!a||!i)return 0;const g=n(i)-n(a),j=o(d)-o(a),m=o(d)-o(i)>170,p=g/j;return j&&!m&&P(p)>.1?p:0}return{pointerDown:u,pointerMove:l,pointerUp:c,readPoint:n}}function tn(){function e(s){const{offsetTop:a,offsetLeft:i,offsetWidth:o,offsetHeight:n}=s;return{top:a,right:i+o,bottom:a+n,left:i,width:o,height:n}}return{measure:e}}function nn(e){function t(a){return e*(a/100)}return{measure:t}}function sn(e,t,s,a,i,o,n){const u=[e].concat(a);let l,c,x=[],d=!1;function g(h){return i.measureSize(n.measure(h))}function j(h){if(!o)return;c=g(e),x=a.map(g);function f(b){for(const k of b){if(d)return;const w=k.target===e,T=a.indexOf(k.target),E=w?c:x[T],y=g(w?e:a[T]);if(P(y-E)>=.5){h.reInit(),t.emit("resize");break}}}l=new ResizeObserver(b=>{(Me(o)||o(h,b))&&f(b)}),s.requestAnimationFrame(()=>{u.forEach(b=>l.observe(b))})}function m(){d=!0,l&&l.disconnect()}return{init:j,destroy:m}}function rn(e,t,s,a,i,o){let n=0,u=0,l=i,c=o,x=e.get(),d=0;function g(){const E=a.get()-e.get(),y=!l;let N=0;return y?(n=0,s.set(a),e.set(a),N=E):(s.set(e),n+=E/l,n*=c,x+=n,e.add(n),N=x-d),u=Ve(N),d=x,T}function j(){const E=a.get()-t.get();return P(E)<.001}function m(){return l}function p(){return u}function h(){return n}function f(){return k(i)}function b(){return w(o)}function k(E){return l=E,T}function w(E){return c=E,T}const T={direction:p,duration:m,velocity:h,seek:g,settled:j,useBaseFriction:b,useBaseDuration:f,useFriction:w,useDuration:k};return T}function an(e,t,s,a,i){const o=i.measure(10),n=i.measure(50),u=ce(.1,.99);let l=!1;function c(){return!(l||!e.reachedAny(s.get())||!e.reachedAny(t.get()))}function x(j){if(!c())return;const m=e.reachedMin(t.get())?"min":"max",p=P(e[m]-t.get()),h=s.get()-t.get(),f=u.constrain(p/n);s.subtract(h*f),!j&&P(h)<o&&(s.set(e.constrain(s.get())),a.useDuration(25).useBaseFriction())}function d(j){l=!j}return{shouldConstrain:c,constrain:x,toggleActive:d}}function on(e,t,s,a,i){const o=ce(-t+e,0),n=d(),u=x(),l=g();function c(m,p){return he(m,p)<=1}function x(){const m=n[0],p=V(n),h=n.lastIndexOf(m),f=n.indexOf(p)+1;return ce(h,f)}function d(){return s.map((m,p)=>{const{min:h,max:f}=o,b=o.constrain(m),k=!p,w=$e(s,p);return k?f:w||c(h,b)?h:c(f,b)?f:b}).map(m=>parseFloat(m.toFixed(3)))}function g(){if(t<=e+i)return[o.max];if(a==="keepSnaps")return n;const{min:m,max:p}=u;return n.slice(m,p)}return{snapsContained:l,scrollContainLimit:u}}function cn(e,t,s){const a=t[0],i=s?a-e:V(t);return{limit:ce(i,a)}}function ln(e,t,s,a){const o=t.min+.1,n=t.max+.1,{reachedMin:u,reachedMax:l}=ce(o,n);function c(g){return g===1?l(s.get()):g===-1?u(s.get()):!1}function x(g){if(!c(g))return;const j=e*(g*-1);a.forEach(m=>m.add(j))}return{loop:x}}function un(e){const{max:t,length:s}=e;function a(o){const n=o-t;return s?n/-s:0}return{get:a}}function dn(e,t,s,a,i){const{startEdge:o,endEdge:n}=e,{groupSlides:u}=i,l=d().map(t.measure),c=g(),x=j();function d(){return u(a).map(p=>V(p)[n]-p[0][o]).map(P)}function g(){return a.map(p=>s[o]-p[o]).map(p=>-P(p))}function j(){return u(c).map(p=>p[0]).map((p,h)=>p+l[h])}return{snaps:c,snapsAligned:x}}function fn(e,t,s,a,i,o){const{groupSlides:n}=i,{min:u,max:l}=a,c=x();function x(){const g=n(o),j=!e||t==="keepSnaps";return s.length===1?[o]:j?g:g.slice(u,l).map((m,p,h)=>{const f=!p,b=$e(h,p);if(f){const k=V(h[0])+1;return ot(k)}if(b){const k=ve(o)-V(h)[0]+1;return ot(k,V(h)[0])}return m})}return{slideRegistry:c}}function mn(e,t,s,a,i){const{reachedAny:o,removeOffset:n,constrain:u}=a;function l(m){return m.concat().sort((p,h)=>P(p)-P(h))[0]}function c(m){const p=e?n(m):u(m),h=t.map((b,k)=>({diff:x(b-p,0),index:k})).sort((b,k)=>P(b.diff)-P(k.diff)),{index:f}=h[0];return{index:f,distance:p}}function x(m,p){const h=[m,m+s,m-s];if(!e)return m;if(!p)return l(h);const f=h.filter(b=>Ve(b)===p);return f.length?l(f):V(h)-s}function d(m,p){const h=t[m]-i.get(),f=x(h,p);return{index:m,distance:f}}function g(m,p){const h=i.get()+m,{index:f,distance:b}=c(h),k=!e&&o(h);if(!p||k)return{index:f,distance:m};const w=t[f]-b,T=m+x(w,0);return{index:f,distance:T}}return{byDistance:g,byIndex:d,shortcut:x}}function gn(e,t,s,a,i,o,n){function u(d){const g=d.distance,j=d.index!==t.get();o.add(g),g&&(a.duration()?e.start():(e.update(),e.render(1),e.update())),j&&(s.set(t.get()),t.set(d.index),n.emit("select"))}function l(d,g){const j=i.byDistance(d,g);u(j)}function c(d,g){const j=t.clone().set(d),m=i.byIndex(j.get(),g);u(m)}return{distance:l,index:c}}function xn(e,t,s,a,i,o,n,u){const l={passive:!0,capture:!0};let c=0;function x(j){if(!u)return;function m(p){if(new Date().getTime()-c>10)return;n.emit("slideFocusStart"),e.scrollLeft=0;const b=s.findIndex(k=>k.includes(p));Re(b)&&(i.useDuration(0),a.index(b,0),n.emit("slideFocus"))}o.add(document,"keydown",d,!1),t.forEach((p,h)=>{o.add(p,"focus",f=>{(Me(u)||u(j,f))&&m(h)},l)})}function d(j){j.code==="Tab"&&(c=new Date().getTime())}return{init:x}}function pe(e){let t=e;function s(){return t}function a(l){t=n(l)}function i(l){t+=n(l)}function o(l){t-=n(l)}function n(l){return Re(l)?l:l.get()}return{get:s,set:a,add:i,subtract:o}}function gt(e,t){const s=e.scroll==="x"?n:u,a=t.style;let i=null,o=!1;function n(g){return`translate3d(${g}px,0px,0px)`}function u(g){return`translate3d(0px,${g}px,0px)`}function l(g){if(o)return;const j=Ut(e.direction(g));j!==i&&(a.transform=s(j),i=j)}function c(g){o=!g}function x(){o||(a.transform="",t.getAttribute("style")||t.removeAttribute("style"))}return{clear:x,to:l,toggleActive:c}}function pn(e,t,s,a,i,o,n,u,l){const x=ye(i),d=ye(i).reverse(),g=f().concat(b());function j(y,N){return y.reduce((S,C)=>S-i[C],N)}function m(y,N){return y.reduce((S,C)=>j(S,N)>0?S.concat([C]):S,[])}function p(y){return o.map((N,S)=>({start:N-a[S]+.5+y,end:N+t-.5+y}))}function h(y,N,S){const C=p(N);return y.map(I=>{const A=S?0:-s,$=S?s:0,q=S?"end":"start",H=C[I][q];return{index:I,loopPoint:H,slideLocation:pe(-1),translate:gt(e,l[I]),target:()=>u.get()>H?A:$}})}function f(){const y=n[0],N=m(d,y);return h(N,s,!1)}function b(){const y=t-n[0]-1,N=m(x,y);return h(N,-s,!0)}function k(){return g.every(({index:y})=>{const N=x.filter(S=>S!==y);return j(N,t)<=.1})}function w(){g.forEach(y=>{const{target:N,translate:S,slideLocation:C}=y,I=N();I!==C.get()&&(S.to(I),C.set(I))})}function T(){g.forEach(y=>y.translate.clear())}return{canLoop:k,clear:T,loop:w,loopPoints:g}}function hn(e,t,s){let a,i=!1;function o(l){if(!s)return;function c(x){for(const d of x)if(d.type==="childList"){l.reInit(),t.emit("slidesChanged");break}}a=new MutationObserver(x=>{i||(Me(s)||s(l,x))&&c(x)}),a.observe(e,{childList:!0})}function n(){a&&a.disconnect(),i=!0}return{init:o,destroy:n}}function yn(e,t,s,a){const i={};let o=null,n=null,u,l=!1;function c(){u=new IntersectionObserver(m=>{l||(m.forEach(p=>{const h=t.indexOf(p.target);i[h]=p}),o=null,n=null,s.emit("slidesInView"))},{root:e.parentElement,threshold:a}),t.forEach(m=>u.observe(m))}function x(){u&&u.disconnect(),l=!0}function d(m){return be(i).reduce((p,h)=>{const f=parseInt(h),{isIntersecting:b}=i[f];return(m&&b||!m&&!b)&&p.push(f),p},[])}function g(m=!0){if(m&&o)return o;if(!m&&n)return n;const p=d(m);return m&&(o=p),m||(n=p),p}return{init:c,destroy:x,get:g}}function bn(e,t,s,a,i,o){const{measureSize:n,startEdge:u,endEdge:l}=e,c=s[0]&&i,x=m(),d=p(),g=s.map(n),j=h();function m(){if(!c)return 0;const b=s[0];return P(t[u]-b[u])}function p(){if(!c)return 0;const b=o.getComputedStyle(V(a));return parseFloat(b.getPropertyValue(`margin-${l}`))}function h(){return s.map((b,k,w)=>{const T=!k,E=$e(w,k);return T?g[k]+x:E?g[k]+d:w[k+1][u]-b[u]}).map(P)}return{slideSizes:g,slideSizesWithGaps:j,startGap:x,endGap:d}}function jn(e,t,s,a,i,o,n,u,l){const{startEdge:c,endEdge:x,direction:d}=e,g=Re(s);function j(f,b){return ye(f).filter(k=>k%b===0).map(k=>f.slice(k,k+b))}function m(f){return f.length?ye(f).reduce((b,k,w)=>{const T=V(b)||0,E=T===0,y=k===ve(f),N=i[c]-o[T][c],S=i[c]-o[k][x],C=!a&&E?d(n):0,I=!a&&y?d(u):0,A=P(S-I-(N+C));return w&&A>t+l&&b.push(k),y&&b.push(f.length),b},[]).map((b,k,w)=>{const T=Math.max(w[k-1]||0);return f.slice(T,b)}):[]}function p(f){return g?j(f,s):m(f)}return{groupSlides:p}}function vn(e,t,s,a,i,o,n){const{align:u,axis:l,direction:c,startIndex:x,loop:d,duration:g,dragFree:j,dragThreshold:m,inViewThreshold:p,slidesToScroll:h,skipSnaps:f,containScroll:b,watchResize:k,watchSlides:w,watchDrag:T,watchFocus:E}=o,y=2,N=tn(),S=N.measure(t),C=s.map(N.measure),I=Zt(l,c),A=I.measureSize(S),$=nn(A),q=Jt(u,A),H=!d&&!!b,re=d||!!b,{slideSizes:te,slideSizesWithGaps:J,startGap:X,endGap:fe}=bn(I,S,C,s,re,i),K=jn(I,A,h,d,S,C,X,fe,y),{snaps:le,snapsAligned:ue}=dn(I,q,S,C,K),Z=-V(le)+V(J),{snapsContained:me,scrollContainLimit:ge}=on(A,Z,ue,b,y),z=H?me:ue,{limit:O}=cn(Z,z,d),W=mt(ve(z),x,d),B=W.clone(),L=ye(s),v=({dragHandler:de,scrollBody:Pe,scrollBounds:De,options:{loop:ke}})=>{ke||De.constrain(de.pointerDown()),Pe.seek()},M=({scrollBody:de,translate:Pe,location:De,offsetLocation:ke,previousLocation:ht,scrollLooper:yt,slideLooper:bt,dragHandler:jt,animation:vt,eventHandler:Ye,scrollBounds:kt,options:{loop:Qe}},Ue)=>{const Je=de.settled(),Nt=!kt.shouldConstrain(),Xe=Qe?Je:Je&&Nt,Ze=Xe&&!jt.pointerDown();Ze&&vt.stop();const St=De.get()*Ue+ht.get()*(1-Ue);ke.set(St),Qe&&(yt.loop(de.direction()),bt.loop()),Pe.to(ke.get()),Ze&&Ye.emit("settle"),Xe||Ye.emit("scroll")},D=Xt(a,i,()=>v(_e),de=>M(_e,de)),F=.68,G=z[W.get()],ee=pe(G),ae=pe(G),ne=pe(G),oe=pe(G),xe=rn(ee,ne,ae,oe,g,F),Ae=mn(d,z,Z,O,oe),Le=gn(D,W,B,xe,Ae,oe,n),He=un(O),Ke=je(),xt=yn(t,s,n,p),{slideRegistry:Ge}=fn(H,b,z,ge,K,L),pt=xn(e,s,Ge,Le,xe,Ke,n,E),_e={ownerDocument:a,ownerWindow:i,eventHandler:n,containerRect:S,slideRects:C,animation:D,axis:I,dragHandler:Wt(I,e,a,i,oe,en(I,i),ee,D,Le,xe,Ae,W,n,$,j,m,f,F,T),eventStore:Ke,percentOfView:$,index:W,indexPrevious:B,limit:O,location:ee,offsetLocation:ne,previousLocation:ae,options:o,resizeHandler:sn(t,n,i,s,I,k,N),scrollBody:xe,scrollBounds:an(O,ne,oe,xe,$),scrollLooper:ln(Z,O,ne,[ee,ne,ae,oe]),scrollProgress:He,scrollSnapList:z.map(He.get),scrollSnaps:z,scrollTarget:Ae,scrollTo:Le,slideLooper:pn(I,A,Z,te,J,le,z,ne,s),slideFocus:pt,slidesHandler:hn(t,n,w),slidesInView:xt,slideIndexes:L,slideRegistry:Ge,slidesToScroll:K,target:oe,translate:gt(I,t)};return _e}function kn(){let e={},t;function s(c){t=c}function a(c){return e[c]||[]}function i(c){return a(c).forEach(x=>x(t,c)),l}function o(c,x){return e[c]=a(c).concat([x]),l}function n(c,x){return e[c]=a(c).filter(d=>d!==x),l}function u(){e={}}const l={init:s,emit:i,off:n,on:o,clear:u};return l}const Nn={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Sn(e){function t(o,n){return ft(o,n||{})}function s(o){const n=o.breakpoints||{},u=be(n).filter(l=>e.matchMedia(l).matches).map(l=>n[l]).reduce((l,c)=>t(l,c),{});return t(o,u)}function a(o){return o.map(n=>be(n.breakpoints||{})).reduce((n,u)=>n.concat(u),[]).map(e.matchMedia)}return{mergeOptions:t,optionsAtMedia:s,optionsMediaQueries:a}}function wn(e){let t=[];function s(o,n){return t=n.filter(({options:u})=>e.optionsAtMedia(u).active!==!1),t.forEach(u=>u.init(o,e)),n.reduce((u,l)=>Object.assign(u,{[l.name]:l}),{})}function a(){t=t.filter(o=>o.destroy())}return{init:s,destroy:a}}function Te(e,t,s){const a=e.ownerDocument,i=a.defaultView,o=Sn(i),n=wn(o),u=je(),l=kn(),{mergeOptions:c,optionsAtMedia:x,optionsMediaQueries:d}=o,{on:g,off:j,emit:m}=l,p=I;let h=!1,f,b=c(Nn,Te.globalOptions),k=c(b),w=[],T,E,y;function N(){const{container:L,slides:v}=k;E=(Fe(L)?e.querySelector(L):L)||e.children[0];const D=Fe(v)?E.querySelectorAll(v):v;y=[].slice.call(D||E.children)}function S(L){const v=vn(e,E,y,a,i,L,l);if(L.loop&&!v.slideLooper.canLoop()){const M=Object.assign({},L,{loop:!1});return S(M)}return v}function C(L,v){h||(b=c(b,L),k=x(b),w=v||w,N(),f=S(k),d([b,...w.map(({options:M})=>M)]).forEach(M=>u.add(M,"change",I)),k.active&&(f.translate.to(f.location.get()),f.animation.init(),f.slidesInView.init(),f.slideFocus.init(B),f.eventHandler.init(B),f.resizeHandler.init(B),f.slidesHandler.init(B),f.options.loop&&f.slideLooper.loop(),E.offsetParent&&y.length&&f.dragHandler.init(B),T=n.init(B,w)))}function I(L,v){const M=K();A(),C(c({startIndex:M},L),v),l.emit("reInit")}function A(){f.dragHandler.destroy(),f.eventStore.clear(),f.translate.clear(),f.slideLooper.clear(),f.resizeHandler.destroy(),f.slidesHandler.destroy(),f.slidesInView.destroy(),f.animation.destroy(),n.destroy(),u.clear()}function $(){h||(h=!0,u.clear(),A(),l.emit("destroy"),l.clear())}function q(L,v,M){!k.active||h||(f.scrollBody.useBaseFriction().useDuration(v===!0?0:k.duration),f.scrollTo.index(L,M||0))}function H(L){const v=f.index.add(1).get();q(v,L,-1)}function re(L){const v=f.index.add(-1).get();q(v,L,1)}function te(){return f.index.add(1).get()!==K()}function J(){return f.index.add(-1).get()!==K()}function X(){return f.scrollSnapList}function fe(){return f.scrollProgress.get(f.offsetLocation.get())}function K(){return f.index.get()}function le(){return f.indexPrevious.get()}function ue(){return f.slidesInView.get()}function Z(){return f.slidesInView.get(!1)}function me(){return T}function ge(){return f}function z(){return e}function O(){return E}function W(){return y}const B={canScrollNext:te,canScrollPrev:J,containerNode:O,internalEngine:ge,destroy:$,off:j,on:g,emit:m,plugins:me,previousScrollSnap:le,reInit:p,rootNode:z,scrollNext:H,scrollPrev:re,scrollProgress:fe,scrollSnapList:X,scrollTo:q,selectedScrollSnap:K,slideNodes:W,slidesInView:ue,slidesNotInView:Z};return C(t,s),setTimeout(()=>l.emit("init"),0),B}Te.globalOptions=void 0;function qe(e={},t=[]){const s=_.useRef(e),a=_.useRef(t),[i,o]=_.useState(),[n,u]=_.useState(),l=_.useCallback(()=>{i&&i.reInit(s.current,a.current)},[i]);return _.useEffect(()=>{Be(s.current,e)||(s.current=e,l())},[e,l]),_.useEffect(()=>{Yt(a.current,t)||(a.current=t,l())},[t,l]),_.useEffect(()=>{if(Gt()&&n){Te.globalOptions=qe.globalOptions;const c=Te(n,s.current,a.current);return o(c),()=>c.destroy()}else o(void 0)},[n,o]),[u,i]}qe.globalOptions=void 0;const En={spike:"âš ï¸",trend:"ðŸ“ˆ",unusual:"ðŸ“Š",budget:"ðŸ’°",saving:"ðŸŽ‰"},it={warning:"border-l-amber-500 bg-amber-50 dark:bg-amber-900/20",success:"border-l-green-500 bg-green-50 dark:bg-green-900/20",info:"border-l-blue-500 bg-blue-50 dark:bg-blue-900/20"};function Cn({insight:e,displayCurrency:t="JPY",onScrollToChart:s}){const{t:a}=U("common"),i=Et(),o=()=>{e.category?i({to:"/transactions",search:{categories:e.category}}):(e.type==="trend"||e.type==="unusual")&&(s==null||s())},n=()=>e.category?a("analytics.viewTransactions",{category:e.category}):e.type==="trend"||e.type==="unusual"?a("analytics.viewBreakdown"):a("analytics.learnMore");return r.jsx("div",{className:R("rounded-xl p-4 border-l-4 min-w-0","bg-white dark:bg-gray-800","shadow-sm",it[e.severity]||it.info),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl flex-shrink-0",children:En[e.type]||"ðŸ’¡"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.title}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.amount&&r.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-1",children:[ie(e.amount,t),e.percentage_change&&r.jsxs("span",{className:R("ml-2",e.percentage_change>0?"text-red-600":"text-green-600"),children:[e.percentage_change>0?"+":"",e.percentage_change,"%"]})]}),r.jsxs(Y,{variant:"ghost",className:"mt-2 p-0 h-auto text-sm text-primary-600 hover:text-primary-700",onClick:o,children:[n()," â†’"]})]})]})})}function In({insights:e,displayCurrency:t="JPY",onScrollToChart:s}){const{t:a}=U("common"),[i,o]=_.useState(0),[n,u]=qe({loop:!1,align:"start",containScroll:"trimSnaps"}),l=_.useCallback(()=>{u&&o(u.selectedScrollSnap())},[u]);return _.useEffect(()=>{if(u)return l(),u.on("select",l),()=>{u.off("select",l)}},[u,l]),!e||e.length===0?null:r.jsxs("div",{className:"relative",children:[e.length>1&&r.jsx("p",{className:"text-xs text-gray-400 text-center mb-2",children:a("analytics.swipeHint")}),r.jsx("div",{className:"overflow-hidden",ref:n,children:r.jsx("div",{className:"flex gap-3",children:e.map((c,x)=>r.jsx("div",{className:"flex-shrink-0 w-full min-w-0",children:r.jsx(Cn,{insight:c,displayCurrency:t,onScrollToChart:s})},`${c.type}-${c.category||x}`))})}),e.length>1&&r.jsx("div",{className:"flex justify-center gap-1.5 mt-3",children:e.map((c,x)=>r.jsx("button",{"aria-label":`Go to insight ${x+1}`,className:R("w-2 h-2 rounded-full transition-all",x===i?"bg-primary-600 w-4":"bg-gray-300 dark:bg-gray-600"),onClick:()=>u==null?void 0:u.scrollTo(x)},x))})]})}function Tn({selectedMonth:e,onChange:t,className:s}){const{i18n:a}=U(),i=l=>{const c=a.language;return c==="ja"?se(l,"yyyyå¹´Mæœˆ"):c==="vi"?`ThÃ¡ng ${se(l,"M/yyyy")}`:se(l,"MMMM yyyy")},o=()=>{t(Ce(e,1))},n=()=>{const l=et(e,1);l<=new Date&&t(l)},u=et(e,1)>new Date;return r.jsxs("div",{className:R("flex items-center gap-2",s),children:[r.jsx("button",{onClick:o,className:R("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors"),"aria-label":"Previous month",children:"â†"}),r.jsx("span",{className:"min-w-[140px] text-center font-medium text-gray-900 dark:text-gray-100",children:i(e)}),r.jsx("button",{onClick:n,disabled:u,className:R("p-2 rounded-lg text-gray-600 dark:text-gray-400","hover:bg-gray-100 dark:hover:bg-gray-700","transition-colors",u&&"opacity-50 cursor-not-allowed"),"aria-label":"Next month",children:"â†’"})]})}const Mn=[{value:"current-month",labelKey:"analytics.currentMonth"},{value:"3-months",labelKey:"analytics.3months"},{value:"6-months",labelKey:"analytics.6months"},{value:"1-year",labelKey:"analytics.1year"}];function An({selected:e,onChange:t,className:s}){const{t:a}=U("common");return r.jsx("div",{className:R("inline-flex rounded-lg bg-gray-100 dark:bg-gray-800 p-1",s),children:Mn.map(({value:i,labelKey:o})=>r.jsx("button",{onClick:()=>t(i),className:R("px-3 py-1.5 text-sm font-medium rounded-md transition-all",i===e?"bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:a(o)},i))})}function Ln(e,t){const s=Dt(t),a=se(s>new Date?new Date:s,"yyyy-MM-dd");switch(e){case"current-month":return{start:se(Ne(t),"yyyy-MM-dd"),end:a};case"3-months":return{start:se(Ce(Ne(t),2),"yyyy-MM-dd"),end:a};case"6-months":return{start:se(Ce(Ne(t),5),"yyyy-MM-dd"),end:a};case"1-year":return{start:se(Ce(Ne(t),11),"yyyy-MM-dd"),end:a};default:return It()}}function _n(){const{t:e}=U("common"),t=_.useRef(null),[s,a]=_.useState(new Date),[i,o]=_.useState("current-month"),[n,u]=_.useState(!1),l=Ln(i,s),{data:c,isLoading:x}=Ee({queryKey:["analytics",l],queryFn:()=>Tt(l)}),{data:d}=Ee({queryKey:["insights"],queryFn:ut}),{data:g}=Ee({queryKey:["goals"],queryFn:Mt}),j=g&&g.length>0?Math.round(g[0].target_amount/(g[0].years*12)):null,m=f=>{o(f)},p=f=>{a(f)},h=_.useCallback(()=>{var f;(f=t.current)==null||f.scrollIntoView({behavior:"smooth"})},[]);return r.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100",children:e("analytics.title")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:e("analytics.subtitle")})]}),r.jsxs("div",{className:"mb-6 space-y-3",children:[r.jsx(Tn,{selectedMonth:s,onChange:p,className:"justify-center"}),r.jsx("div",{className:"flex justify-center",children:r.jsx(An,{selected:i,onChange:m})})]}),x?r.jsx("div",{className:"flex justify-center py-12",children:r.jsx(Ie,{size:"lg"})}):r.jsxs("div",{className:"space-y-6",children:[c&&r.jsx(Ht,{analytics:c}),(d==null?void 0:d.insights)&&d.insights.length>0&&r.jsx(In,{insights:d.insights,onScrollToChart:h}),r.jsxs("div",{ref:t,className:"space-y-6",children:[r.jsxs(Q,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.incomeVsExpense")}),r.jsx(Oe,{className:"h-64 sm:h-80",children:c!=null&&c.monthly_trends&&c.monthly_trends.length>0?r.jsx(At,{data:c.monthly_trends}):r.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]}),r.jsxs(Q,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.categoryBreakdown")}),r.jsx(Oe,{className:"h-64 sm:h-80",children:c!=null&&c.category_breakdown&&c.category_breakdown.length>0?r.jsx(Lt,{data:c.category_breakdown}):r.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]}),r.jsxs(Q,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:e("analytics.monthlyCashFlow")}),r.jsx("div",{className:"h-64 sm:h-80",children:c!=null&&c.monthly_trends&&c.monthly_trends.length>0?c.monthly_trends.length<3?r.jsx(Pt,{data:c.monthly_trends,savingsGoal:j}):r.jsx(Oe,{className:"h-full",children:r.jsx(_t,{data:c.monthly_trends,dataKey:"net"})}):r.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e("analytics.noData")})})]})]}),r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[r.jsxs("button",{onClick:()=>u(!n),className:R("w-full px-4 py-3 flex items-center justify-between","bg-gray-50 dark:bg-gray-800","text-left font-medium text-gray-900 dark:text-gray-100"),children:[r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx("span",{children:"ðŸ¤–"}),e("analytics.aiTools")]}),r.jsx("span",{className:R("transform transition-transform",n?"rotate-180":""),children:"â–¼"})]}),n&&r.jsxs("div",{className:"p-4 space-y-4 bg-white dark:bg-gray-900",children:[r.jsx(qt,{}),r.jsx(Rt,{})]})]})]})]})}const Gn=Ct("/analytics")({component:_n});export{Gn as Route};
