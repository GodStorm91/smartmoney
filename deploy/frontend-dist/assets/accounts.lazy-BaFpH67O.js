import{a as it,j as e,e as ot}from"./vendor-router-DONIM_LE.js";import{r as o,a as Ne}from"./vendor-react-Cwh1aMWO.js";import{i as te,A as De,z as ue,C as re,j as K,Z as X,bi as dt,bj as ct,bk as xt,H as ve,M as Qe,v as de,aj as be,n as we,m as Ve,R as ee,T as mt,I as Te,B as ce,P as xe,ac as ut,p as se,f as me,aq as _e,o as Ae,aO as Me,ao as Ue,L as fe,X as ae,x as Se,aC as gt,y as yt,a7 as ht,aQ as pt,aN as pe,ap as bt,O as He,au as ft,an as jt,a4 as Z,a6 as kt,aU as qe,aV as Nt,bl as vt,a2 as wt}from"./index-8QQOl6s4.js";import{f as Ce,p as Fe,u as _t,T as St,R as Ct}from"./useDebouncedValue-CnS9xxHm.js";import{u as W}from"./vendor-i18n-CNDlYvyf.js";import{b as ne,u as Q,c as U,e as Le}from"./vendor-query-B0NEAgzV.js";import{c as Ft,d as Mt,s as Dt,C as je,e as ke,f as We,h as At,i as Rt,j as Je,k as Ye,l as Ge,m as Xe,n as Pt,o as Tt,p as qt,q as Lt,r as $t,t as Et,u as Ze,v as et,R as It}from"./crypto-DmJ5gCGB.js";import{E as Re}from"./BudgetInsightWidget-DWu6Mges.js";import{R as Bt,f as Kt,C as zt,X as Ot,Y as Qt,T as Vt,g as Ut}from"./vendor-charts-BwEA5mzu.js";import{D as tt}from"./dollar-sign-BI0-NnZZ.js";import{C as Ht}from"./clock-Dmlr2YUd.js";import{a as $e,S as Ee}from"./square-Caf2__BF.js";import{R as Wt}from"./RecurringOptions-B90hBlcx.js";import"./useXPGain-CWScU3DM.js";import"./useCategories-CcWulFHo.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Yt=te("archive",Jt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],Xt=te("arrow-down-right",Gt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ea=te("arrow-right-left",Zt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],aa=te("arrow-up-right",ta);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],Pe=te("gift",ra);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],na=te("layers",sa);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],ia=te("percent",la),oa={bank:{icon:"ðŸ¦",color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/30"},cash:{icon:"ðŸ’µ",color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/30"},credit_card:{icon:"ðŸ’³",color:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/30"},investment:{icon:"ðŸ“ˆ",color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/30"},receivable:{icon:"ðŸ’°",color:"text-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/30"},savings:{icon:"ðŸ·",color:"text-pink-600",bgColor:"bg-pink-50 dark:bg-pink-900/30"},crypto:{icon:"â‚¿",color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/30"},other:{icon:"ðŸ“",color:"text-gray-600",bgColor:"bg-gray-50 dark:bg-gray-700"}};function da({account:t,onEdit:r,onAddTransaction:a}){const{t:s}=W("common"),y=it(),{data:g}=De(),{isPrivacyMode:n}=ue(),b=oa[t.type],N=t.current_balance>=0,v=()=>{const F=new Date,C=`${F.getFullYear()}-${String(F.getMonth()+1).padStart(2,"0")}`;y({to:"/transactions",search:{accountId:t.id,month:C,fromAccounts:!0}})},M=F=>{F.stopPropagation(),a==null||a(t.id)};return e.jsxs(re,{className:"relative hover:shadow-md transition-shadow cursor-pointer",onClick:v,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:K("p-3 rounded-lg",b.bgColor),children:e.jsx("span",{className:"text-2xl",children:b.icon})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:K("text-sm",b.color),children:s(`account.type.${t.type}`)})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a&&e.jsx("button",{onClick:M,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":s("transaction.addTransaction"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-green-600 dark:text-green-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),r&&e.jsx("button",{onClick:F=>{F.stopPropagation(),r(t.id)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":s("account.edit"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-600 dark:text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),!t.is_active&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:s("account.inactive")})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:s("account.currentBalance")}),e.jsx("p",{className:K("text-3xl font-bold font-mono",N?"text-green-600":"text-red-600"),children:X(t.current_balance,t.currency,(g==null?void 0:g.rates)||{},!0,n)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("account.initialBalance")}),e.jsx("p",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:X(t.initial_balance,t.currency,(g==null?void 0:g.rates)||{},!0,n)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("account.transactions")}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:t.transaction_count})]})]}),t.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:s("account.notes")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.notes})]})]})}const le=t=>t==="USD"?100:1;function ca({isOpen:t,onClose:r,editingAccountId:a}){const{t:s}=W("common"),y=dt(),g=ct(),{data:n}=xt(a||void 0),b=ve(),{isPrivacyMode:N}=ue(),[v,M]=o.useState(""),[F,C]=o.useState("bank"),[c,P]=o.useState(""),[T,I]=o.useState(""),[q,h]=o.useState("JPY"),[w,x]=o.useState(""),[f,j]=o.useState({}),[L,$]=o.useState(""),[l,_]=o.useState(!1),m=["bank","cash","credit_card","investment","receivable","savings","other"],D=n&&n.transaction_count>0,E=(()=>{if(!n||!L)return null;const R=le(n.currency),d=parseFloat(L)*R,k=n.current_balance;return d-k})();o.useEffect(()=>{if(t){if(a&&n)if(M(n.name),C(n.type),x(n.notes||""),h(n.currency),D)$(""),_(!1);else{const R=le(n.currency);P((n.initial_balance/R).toString()),I(n.initial_balance_date)}else M(""),C("bank"),P("0"),I(new Date().toISOString().split("T")[0]),h("JPY"),x(""),$(""),_(!1);j({})}},[t,a,n,D]);const i=()=>{const R={};return v.trim()||(R.name=s("account.errors.nameRequired")),a?a&&!D&&(T||(R.initialBalanceDate=s("account.errors.dateRequired"))):T||(R.initialBalanceDate=s("account.errors.dateRequired")),j(R),Object.keys(R).length===0},S=async R=>{if(R.preventDefault(),!!i()){if(a&&D&&L&&!l){_(!0);return}try{if(a){const d={name:v.trim(),type:F,notes:w.trim()||void 0};if(!D&&n){const k=le(n.currency);d.initial_balance=Math.round(parseFloat(c||"0")*k),d.initial_balance_date=T}if(D&&L&&n){const k=le(n.currency);d.desired_current_balance=Math.round(parseFloat(L)*k)}await g.mutateAsync({id:a,data:d})}else{const d=le(q),k={name:v.trim(),type:F,initial_balance:Math.round(parseFloat(c||"0")*d),initial_balance_date:T,currency:q,notes:w.trim()||void 0};await y.mutateAsync(k)}r()}catch(d){j({submit:d.message||s("account.errors.submitFailed")})}}};if(!t)return null;const H=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:s(a?"account.editAccount":"account.createAccount")}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:S,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.name")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",value:v,onChange:R=>M(R.target.value),className:K("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",f.name?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:s("account.namePlaceholder")}),f.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.accountType")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"type",value:F,onChange:R=>C(R.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:m.map(R=>e.jsx("option",{value:R,children:s(`account.type.${R}`)},R))})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:Ce(c),onChange:R=>P(Fe(R.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:T,onChange:R=>I(R.target.value),className:K("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",f.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),f.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.initialBalanceDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.currency")}),e.jsxs("select",{id:"currency",value:q,onChange:R=>h(R.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"VND",children:"VND (â‚«)"})]})]})]}),a&&!D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.initialBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"initialBalance",value:Ce(c),onChange:R=>P(Fe(R.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"initialBalanceDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("account.initialBalanceDate")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"initialBalanceDate",value:T,onChange:R=>I(R.target.value),className:K("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500","bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",f.initialBalanceDate?"border-red-500":"border-gray-300 dark:border-gray-600")}),f.initialBalanceDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.initialBalanceDate})]})]}),a&&D&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:s("account.currentBalance")}),e.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-200",children:X(n.current_balance,n.currency,b,!0,N)})]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:s("account.hasTransactionsInfo",{count:n.transaction_count})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"desiredBalance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.desiredCurrentBalance")}),e.jsx("input",{type:"text",inputMode:"decimal",id:"desiredBalance",value:Ce(L),onChange:R=>{$(Fe(R.target.value)),_(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-numbers",placeholder:s("account.desiredBalancePlaceholder")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s("account.reconcileHint")})]}),E!==null&&E!==0&&e.jsx("div",{className:K("border rounded-lg p-4",E>0?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:K("text-sm font-medium",E>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:s("account.adjustmentAmount")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:K("text-lg font-bold",E>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:E>0?"â†‘":"â†“"}),e.jsx("span",{className:K("text-lg font-bold",E>0?"text-green-900 dark:text-green-200":"text-red-900 dark:text-red-200"),children:X(Math.abs(E),n.currency,b,!0,N)})]})]})}),l&&E!==null&&E!==0&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-200",children:s("account.adjustmentConfirmTitle")}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:s("account.adjustmentConfirmMessage",{amount:X(Math.abs(E),n.currency,b,!0,N)})})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("account.notes")}),e.jsx("textarea",{id:"notes",value:w,onChange:R=>x(R.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:s("account.notesPlaceholder")})]}),f.submit&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:f.submit})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[l&&e.jsx("button",{type:"button",onClick:()=>{_(!1),$("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:s("account.cancelAdjustment")}),!l&&e.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:s("cancel")}),e.jsx("button",{type:"submit",disabled:y.isPending||g.isPending,className:K("flex-1 px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",l?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:y.isPending||g.isPending?s("saving"):s(l?"account.confirmAdjustment":a?"update":"create")})]})]})]})]});return typeof document>"u"?null:Ne.createPortal(H,document.body)}const xa=["eth","bsc","polygon"];function Ie({token:t,isPrivacyMode:r}){return e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.logo_url?e.jsx("img",{src:t.logo_url,alt:t.symbol,className:"w-5 h-5 rounded-full",onError:a=>{a.target.style.display="none"}}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-[10px] font-medium",children:t.symbol.slice(0,2)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate",children:t.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:r?"***":Number(t.balance)<1e-4?"<0.0001":Number(t.balance).toFixed(4)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r?"$***":`$${Number(t.balance_usd).toFixed(2)}`})]})]})}function Be(){const{t}=W("common"),r=ne(),{currency:a}=Qe(),{isPrivacyMode:s}=ue(),y=ve(),[g,n]=o.useState(!1),[b,N]=o.useState(""),[v,M]=o.useState(""),[F,C]=o.useState(["eth","bsc","polygon"]),[c,P]=o.useState(null),[T,I]=o.useState(null),{data:q,isLoading:h}=Q({queryKey:["crypto-wallets"],queryFn:We}),{data:w}=Q({queryKey:["crypto-wallets-balance",q==null?void 0:q.map(d=>d.id)],queryFn:async()=>!q||q.length===0?[]:Promise.all(q.map(d=>At(d.id))),enabled:!!q&&q.length>0}),{data:x,isLoading:f}=Q({queryKey:["crypto-portfolio",T],queryFn:()=>Rt(T),enabled:!!T}),j=U({mutationFn:Ft,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),n(!1),N(""),M(""),C(["eth","bsc","polygon"])}}),L=U({mutationFn:Mt,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),r.invalidateQueries({queryKey:["crypto-wallets-balance"]})}}),$=U({mutationFn:Dt,onSuccess:()=>{r.invalidateQueries({queryKey:["crypto-wallets"]}),r.invalidateQueries({queryKey:["crypto-wallets-balance"]}),r.invalidateQueries({queryKey:["dashboard-summary"]}),P(null)},onError:()=>{P(null)}}),l=()=>{b.trim()&&j.mutate({wallet_address:b.trim(),label:v.trim()||void 0,chains:F})},_=d=>{confirm(t("confirmDelete"))&&L.mutate(d)},m=d=>{P(d),$.mutate(d)},D=d=>{C(k=>k.includes(d)?k.filter(B=>B!==d):[...k,d])},O=d=>{I(k=>k===d?null:d)},E=d=>`${d.slice(0,6)}...${d.slice(-4)}`,i=(d,k)=>{const B={eth:`https://etherscan.io/address/${d}`,bsc:`https://bscscan.com/address/${d}`,polygon:`https://polygonscan.com/address/${d}`,arbitrum:`https://arbiscan.io/address/${d}`,optimism:`https://optimistic.etherscan.io/address/${d}`};return B[k]||B.eth},S=(w==null?void 0:w.reduce((d,k)=>d+Number(k.total_balance_usd||0),0))||0,H=1/((y==null?void 0:y.USD)||.00667),R=Math.round(S*H);return h?e.jsx(je,{title:t("crypto.wallets"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(de,{size:"md"})})}):e.jsxs(je,{title:t("crypto.wallets"),badge:(q==null?void 0:q.length)||0,defaultOpen:q&&q.length>0,children:[w&&w.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalBalance")}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:X(R,a,y,!1,s)})]}),w&&w.length>0?e.jsx("div",{className:"space-y-3 mb-4",children:w.map(d=>{var k,B;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:d.label||E(d.wallet_address)}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("code",{className:"text-xs",children:E(d.wallet_address)}),e.jsx("a",{href:i(d.wallet_address,"eth"),target:"_blank",rel:"noopener noreferrer",className:"hover:text-purple-500",children:e.jsx(Re,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:s?"$***":`$${Number(d.total_balance_usd||0).toFixed(2)}`}),e.jsx("div",{className:"flex gap-1 mt-1",children:(k=d.chains)==null?void 0:k.map(p=>{var A;return e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",title:(A=ke[p])==null?void 0:A.name,children:p.toUpperCase()},p)})})]})]}),e.jsxs("button",{onClick:()=>O(d.id),className:"flex items-center gap-2 mt-3 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors",children:[T===d.id?e.jsx(we,{className:"w-4 h-4"}):e.jsx(Ve,{className:"w-4 h-4"}),t("crypto.tokens")]}),T===d.id&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:f?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(de,{size:"sm"})}):x!=null&&x.chains&&x.chains.length>0?e.jsx("div",{className:"space-y-4",children:x.chains.filter(p=>p.tokens.length>0||p.native_balance).sort((p,A)=>Number(A.total_usd)-Number(p.total_usd)).map(p=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:p.chain_name}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:s?"$***":`$${Number(p.total_usd).toFixed(2)}`})]}),e.jsxs("div",{className:"space-y-1",children:[p.native_balance&&Number(p.native_balance.balance)>0&&e.jsx(Ie,{token:p.native_balance,isPrivacyMode:s}),p.tokens.filter(A=>Number(A.balance_usd)>=1).sort((A,z)=>Number(z.balance_usd)-Number(A.balance_usd)).map(A=>e.jsx(Ie,{token:A,isPrivacyMode:s},A.token_address))]})]},p.chain_id))}):e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-2",children:t("crypto.noTokens")})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:(B=d.sync_statuses)!=null&&B.some(p=>p.last_sync_at)?t("crypto.lastSync",{time:new Date(Math.max(...d.sync_statuses.filter(p=>p.last_sync_at).map(p=>new Date(p.last_sync_at).getTime()))).toLocaleString()}):t("crypto.neverSynced")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(d.id),disabled:c===d.id,className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg transition-colors",title:t("crypto.sync"),children:c===d.id?e.jsx(de,{size:"sm"}):e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(d.id),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:t("delete"),children:e.jsx(mt,{className:"w-4 h-4"})})]})]})]},d.id)})}):g?null:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(be,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:t("crypto.noWallets")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:t("crypto.addWalletDescription")})]}),g?e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-4",children:[e.jsx(Te,{label:t("crypto.walletAddress"),placeholder:"0x...",value:b,onChange:d=>N(d.target.value)}),e.jsx(Te,{label:t("crypto.walletLabel"),placeholder:t("crypto.walletLabelPlaceholder"),value:v,onChange:d=>M(d.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("crypto.selectChains")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:xa.map(d=>{var k;return e.jsx("button",{type:"button",onClick:()=>D(d),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${F.includes(d)?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:((k=ke[d])==null?void 0:k.name)||d.toUpperCase()},d)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(ce,{variant:"outline",onClick:()=>n(!1),children:t("cancel")}),e.jsx(ce,{onClick:l,disabled:!b.trim()||F.length===0||j.isPending,children:j.isPending?t("saving"):t("crypto.addWallet")})]})]}):e.jsxs(ce,{variant:"outline",onClick:()=>n(!0),className:"w-full",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),t("crypto.addWallet")]})]})}function ma({snapshots:t}){const{resolvedTheme:r}=ut(),a=r==="dark",s=a?"#374151":"#E5E7EB",y=a?"#9CA3AF":"#6B7280",g=a?"#1F2937":"#FFFFFF",n=a?"#374151":"#E5E7EB",b="#6366F1",N=o.useMemo(()=>[...t].sort((F,C)=>new Date(F.snapshot_date).getTime()-new Date(C.snapshot_date).getTime()).map(F=>({date:F.snapshot_date,value:Number(F.balance_usd),formattedDate:new Date(F.snapshot_date).toLocaleDateString(se(),{month:"short",day:"numeric"})})),[t]),[v,M]=o.useMemo(()=>{const F=N.map(T=>T.value),C=Math.min(...F),c=Math.max(...F),P=(c-C)*.1||10;return[Math.max(0,C-P),c+P]},[N]);return N.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No historical data available"}):e.jsx(Bt,{width:"100%",height:"100%",children:e.jsxs(Kt,{data:N,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(zt,{strokeDasharray:"3 3",stroke:s,vertical:!1}),e.jsx(Ot,{dataKey:"formattedDate",tick:{fill:y,fontSize:11},tickLine:!1,axisLine:{stroke:s},interval:"preserveStartEnd"}),e.jsx(Qt,{domain:[v,M],tick:{fill:y,fontSize:11},tickLine:!1,axisLine:!1,tickFormatter:F=>`$${F.toFixed(0)}`,width:50}),e.jsx(Vt,{contentStyle:{backgroundColor:g,border:`1px solid ${n}`,borderRadius:"8px",fontSize:"12px"},labelStyle:{color:y,fontWeight:"bold"},formatter:F=>[`$${F.toFixed(2)}`,"Value"]}),e.jsx(Ut,{type:"monotone",dataKey:"value",stroke:b,strokeWidth:2,dot:N.length<=10,activeDot:{r:6,fill:b}})]})})}function ua({positionId:t}){var O,E;const{t:r}=W(),a=ne(),[s,y]=o.useState(null),[g,n]=o.useState(!1),[b,N]=o.useState(null),[v,M]=o.useState(null),[F,C]=o.useState(null),{data:c,isLoading:P}=Q({queryKey:["position-roi",t],queryFn:()=>Xe(t)}),{data:T=[]}=Q({queryKey:["position-rewards-list",t],queryFn:()=>Pt(t)}),I=U({mutationFn:()=>Je(90),onSuccess:i=>{y({scanned:i.scanned_claims,new:i.new_claims}),a.invalidateQueries({queryKey:["position-roi"]}),a.invalidateQueries({queryKey:["position-rewards-list"]}),a.invalidateQueries({queryKey:["unattributed-rewards"]}),setTimeout(()=>y(null),5e3)}}),q=U({mutationFn:i=>Ye(i),onSuccess:i=>{M(r("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:i.amount_usd.toFixed(2)})),a.invalidateQueries({queryKey:["position-rewards-list"]}),a.invalidateQueries({queryKey:["transactions"]}),N(null),setTimeout(()=>M(null),5e3)},onError:i=>{C(i.message||r("crypto.transactionCreateError","Failed to create transaction")),N(null),setTimeout(()=>C(null),5e3)}}),h=U({mutationFn:i=>Ge(i),onSuccess:i=>{const S=r("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:i.created,total:i.total_usd.toFixed(2),skipped:i.skipped});M(S),a.invalidateQueries({queryKey:["position-rewards-list"]}),a.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>M(null),8e3)},onError:i=>{C(i.message||r("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>C(null),5e3)}}),w=T.filter(i=>!i.transaction_id),x=1,f=((O=c==null?void 0:c.rewards_by_token)==null?void 0:O.filter(i=>Number(i.amount_usd)>=x))||[],j=((E=c==null?void 0:c.rewards_by_month)==null?void 0:E.filter(i=>Number(i.amount_usd)>=x))||[],L=T.filter(i=>Number(i.reward_usd||0)>=x),$=f.reduce((i,S)=>i+Number(S.amount_usd||0),0);if(P)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const l=i=>{if(i==null)return null;const S=Number(i);return isNaN(S)?null:`$${S.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},_=i=>{if(i===null)return"-";const S=Number(i);return`${S>=0?"+":""}${S.toFixed(2)}%`},m=i=>{const[S,H]=i.split("-");return new Date(Number(S),Number(H)-1).toLocaleDateString(se(),{month:"short",year:"numeric"})},D=i=>Number(i).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:r("crypto.scanRewardsHint","Scan blockchain for claimed rewards")}),e.jsx("button",{onClick:()=>I.mutate(),disabled:I.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:I.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 animate-spin"}),r("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4"}),r("crypto.scanRewards","Scan Rewards")]})})]}),s&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(me,{className:"h-4 w-4"}),r("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",s)]}),c&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),r("crypto.roiSummary","ROI Summary")]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:r("crypto.totalRewards","Total Rewards")}),f.length>0?e.jsx("div",{className:"space-y-1",children:f.map(i=>{const S=l(i.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[D(i.amount)," ",i.symbol]}),S&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",S]})]},i.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:l($)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[L.length," ",r("crypto.claims","claims")]})]}),c.cost_basis_usd!==null&&c.simple_roi_pct!==null&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-green-200 dark:border-green-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:r("crypto.costBasis","Cost Basis")}),e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:l(c.cost_basis_usd)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:r("crypto.roi","ROI")}),e.jsx("div",{className:`text-lg font-semibold ${c.simple_roi_pct>=0?"text-green-800 dark:text-green-200":"text-red-600 dark:text-red-400"}`,children:_(c.simple_roi_pct)}),c.days_held&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:[c.days_held," ",r("crypto.daysHeld","days")]})]})]})]})]}),c&&j.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),r("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:j.map(i=>{const S=l(i.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:m(i.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i.count," ",r("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[D(i.amount)," ",i.symbol]}),S&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",S]})]})]},`${i.month}-${i.symbol}`)})})]}),L.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>n(!g),className:"flex items-center gap-2 font-medium text-gray-900 dark:text-gray-100 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[e.jsx(Me,{className:"h-4 w-4"}),r("crypto.allRewards","All Rewards")," (",L.length,")",g?e.jsx(Ue,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"})]}),w.length>0&&e.jsxs("button",{type:"button",onClick:()=>h.mutate(w.map(i=>i.id)),disabled:h.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 rounded-lg transition-colors",children:[h.isPending?e.jsx(fe,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(xe,{className:"h-3.5 w-3.5"}),r("crypto.createAllTransactions","Create All Txns")," (",w.length,")"]})]}),g&&e.jsxs(e.Fragment,{children:[v&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(me,{className:"h-4 w-4"}),v]}),F&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(ae,{className:"h-4 w-4"}),F]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:L.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Number(i.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})," ",i.reward_token_symbol||"tokens"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[new Date(i.claimed_at).toLocaleDateString(se())," via ",i.source,i.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(i.reward_usd).toFixed(2)]})]})]}),i.reward_usd&&Number(i.reward_usd)>0&&e.jsx("div",{className:"flex-shrink-0 ml-3",children:i.transaction_id?e.jsxs("a",{href:`/transactions?id=${i.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(Re,{className:"h-3 w-3"}),r("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{N(i.id),q.mutate(i.id)},disabled:b===i.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[b===i.id?e.jsx(fe,{className:"h-3 w-3 animate-spin"}):e.jsx(Me,{className:"h-3 w-3"}),r("crypto.createTransaction","Create Txn")]})})]},i.id))})]})]}),c&&L.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Pe,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),$<x?r("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:x}):r("crypto.noRewards","No rewards claimed for this position yet.")]})]})}function ga({source:t="symbiotic"}){var L,$;const{t:r}=W(),a=ne(),[s,y]=o.useState(null),[g,n]=o.useState(null),[b,N]=o.useState(null),{data:v,isLoading:M}=Q({queryKey:["staking-rewards",t],queryFn:()=>Tt(t)}),{data:F=[]}=Q({queryKey:["all-rewards"],queryFn:qt}),C=F.filter(l=>!l.transaction_id&&l.reward_usd&&Number(l.reward_usd)>0),c=U({mutationFn:()=>Je(90),onSuccess:l=>{y({scanned:l.scanned_claims,new:l.new_claims}),a.invalidateQueries({queryKey:["staking-rewards"]}),a.invalidateQueries({queryKey:["all-rewards"]}),setTimeout(()=>y(null),5e3)}}),P=U({mutationFn:l=>Ge(l),onSuccess:l=>{const _=r("crypto.batchTransactionsCreated","Created {{created}} transactions (${{total}}). Skipped: {{skipped}}",{created:l.created,total:l.total_usd.toFixed(2),skipped:l.skipped});n(_),a.invalidateQueries({queryKey:["all-rewards"]}),a.invalidateQueries({queryKey:["staking-rewards"]}),a.invalidateQueries({queryKey:["transactions"]}),setTimeout(()=>n(null),8e3)},onError:l=>{N(l.message||r("crypto.batchTransactionError","Failed to create transactions")),setTimeout(()=>N(null),5e3)}});if(M)return e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"})]});const T=l=>{if(l==null)return null;const _=Number(l);return isNaN(_)?null:`$${_.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},I=l=>{const[_,m]=l.split("-");return new Date(Number(_),Number(m)-1).toLocaleDateString(se(),{month:"short",year:"numeric"})},q=l=>Number(l).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4}),h=t==="symbiotic"?"Symbiotic":t,w=1,x=((L=v==null?void 0:v.rewards_by_token)==null?void 0:L.filter(l=>Number(l.amount_usd)>=w))||[],f=(($=v==null?void 0:v.rewards_by_month)==null?void 0:$.filter(l=>Number(l.amount_usd)>=w))||[],j=x.reduce((l,_)=>l+Number(_.amount_usd||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:r("crypto.scanStakingRewardsHint","Scan blockchain for claimed staking rewards")}),e.jsx("button",{onClick:()=>c.mutate(),disabled:c.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm font-medium rounded-lg transition-colors",children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 animate-spin"}),r("crypto.scanning","Scanning...")]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4"}),r("crypto.scanRewards","Scan Rewards")]})})]}),s&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(me,{className:"h-4 w-4"}),r("crypto.scanComplete","Scanned {{scanned}} claims, found {{new}} new",s)]}),g&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(me,{className:"h-4 w-4"}),g]}),b&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(ae,{className:"h-4 w-4"}),b]}),C.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:r("crypto.unlinkedRewardsHint","{{count}} rewards ready to convert to transactions",{count:C.length})}),e.jsx("button",{onClick:()=>P.mutate(C.map(l=>l.id)),disabled:P.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-amber-600 hover:bg-amber-700 disabled:bg-amber-400 text-white text-sm font-medium rounded-lg transition-colors",children:P.isPending?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4 animate-spin"}),r("crypto.creating","Creating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4"}),r("crypto.createAllTransactions","Create All Txns")," (",C.length,")"]})})]}),v&&x.length>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-3 flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),r("crypto.stakingRewardsSummary","{{source}} Rewards Summary",{source:h})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:r("crypto.totalRewards","Total Rewards")}),x.length>0?e.jsx("div",{className:"space-y-1",children:x.map(l=>{const _=T(l.amount_usd);return e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:[q(l.amount)," ",l.symbol]}),_&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["â‰ˆ ",_]})]},l.symbol)})}):e.jsx("div",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:T(j)||"-"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[f.reduce((l,_)=>l+_.count,0)," ",r("crypto.claims","claims")]})]})})]}),v&&f.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),r("crypto.monthlyBreakdown","Monthly Breakdown")]}),e.jsx("div",{className:"space-y-2",children:f.map(l=>{const _=T(l.amount_usd);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:I(l.month)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[l.count," ",r("crypto.claims","claims")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[q(l.amount)," ",l.symbol]}),_&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["â‰ˆ ",_]})]})]},`${l.month}-${l.symbol}`)})})]}),v&&x.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Pe,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:j<w?r("crypto.rewardsBelowThreshold","No rewards above ${{threshold}} to display",{threshold:w}):r("crypto.noStakingRewards","No staking rewards found")}),e.jsx("p",{className:"text-sm",children:r("crypto.noStakingRewardsHint",'Click "Scan Rewards" to search for claimed rewards on the blockchain.')})]})]})}async function ya(t,r){return(await Se.post(`/api/crypto/positions/${encodeURIComponent(t)}/close`,r)).data}async function ha(){return(await Se.get("/api/crypto/positions/closed")).data}function pa({group:t,lastSnapshotValueUsd:r,costBasisUsd:a,totalRewardsUsd:s,onClose:y,onSuccess:g}){var i;const{t:n}=W("common"),{data:b}=De(),N=((i=b==null?void 0:b.rates)==null?void 0:i.USD)||150,v=ne(),[M,F]=o.useState(new Date().toISOString().slice(0,16)),[C,c]=o.useState(r),[P,T]=o.useState(Math.round(r*N)),[I,q]=o.useState(null),[h,w]=o.useState(`LP Exit: ${t.protocol} ${t.name}`),[x,f]=o.useState("");o.useEffect(()=>{T(Math.round(C*N))},[C,N]);const{data:j}=Q({queryKey:["accounts"],queryFn:()=>yt()}),L=(j==null?void 0:j.filter(S=>S.is_active&&(S.type==="bank"||S.type==="savings")))||[],$=a!==null?C-a+(s||0):null,l=a&&$!==null?$/a*100:null,_=t.tokens[0],m=(_==null?void 0:_.id)||"",D=(_==null?void 0:_.wallet_address)||"",O=U({mutationFn:()=>{if(!I)throw new Error(n("crypto.selectAccount","Select destination account"));const S={exit_date:new Date(M).toISOString(),exit_value_usd:C,exit_value_jpy:P,destination_account_id:I,note:h||void 0,tx_hash:x||void 0,wallet_address:D,chain_id:t.chain_id,protocol:t.protocol,symbol:t.name};return ya(m,S)},onSuccess:()=>{v.invalidateQueries({queryKey:["closed-positions"]}),v.invalidateQueries({queryKey:["defi-positions"]}),v.invalidateQueries({queryKey:["accounts"]}),g(),y()}}),E=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4 overflow-hidden",style:{touchAction:"pan-y"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:y}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:n("crypto.closePosition","Close Position")}),e.jsx("button",{onClick:y,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.protocol," - ",t.name]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.chain_id.toUpperCase()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Ae,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitDate","Exit Date")]}),e.jsx("input",{type:"datetime-local",value:M,onChange:S=>F(S.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(tt,{className:"w-4 h-4 inline mr-1"}),n("crypto.exitValue","Exit Value")," (USD)"]}),e.jsx("input",{type:"number",step:"0.01",value:C,onChange:S=>c(parseFloat(S.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("crypto.exitValue","Exit Value")," (JPY)"]}),e.jsx("input",{type:"number",value:P,onChange:S=>T(parseInt(S.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(be,{className:"w-4 h-4 inline mr-1"}),n("crypto.destinationAccount","Destination Account")]}),e.jsxs("select",{value:I||"",onChange:S=>q(parseInt(S.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:n("select","Select...")}),L.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("note","Note")}),e.jsx("input",{type:"text",value:h,onChange:S=>w(S.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["TX Hash (",n("optional","optional"),")"]}),e.jsx("input",{type:"text",value:x,onChange:S=>f(S.target.value),placeholder:"0x...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-sm"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("crypto.pnlPreview","P&L Preview")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.costBasis","Cost Basis")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a!==null?`$${a.toFixed(2)}`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.totalRewards","Total Rewards")}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s?`$${s.toFixed(2)}`:"$0.00"})]}),e.jsxs("div",{className:"col-span-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-500",children:n("crypto.realizedPnl","Realized P&L")}),e.jsx("p",{className:`text-lg font-bold ${$!==null?$>=0?"text-green-600":"text-red-600":"text-gray-400"}`,children:$!==null?`${$>=0?"+":""}$${$.toFixed(2)} (${l==null?void 0:l.toFixed(1)}%)`:"N/A"})]})]})]}),O.error&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(gt,{className:"w-4 h-4"}),O.error.message]})]}),e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",children:n("cancel","Cancel")}),e.jsx("button",{onClick:()=>O.mutate(),disabled:!I||O.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:O.isPending?n("loading","Loading..."):n("crypto.confirmClose","Confirm Close")})]})]})]});return typeof document>"u"?null:Ne.createPortal(E,document.body)}function ba({group:t,onClose:r}){const[a,s]=o.useState("overview"),[y,g]=o.useState(!1),n=t.tokens[0],b=Le({queries:t.tokens.map(h=>({queryKey:["position-history",h.id],queryFn:()=>Lt(h.id,30),retry:!1}))}),N=b.some(h=>h.isLoading),v=o.useMemo(()=>{const h=b.filter(f=>{var j;return(j=f.data)==null?void 0:j.snapshots}).flatMap(f=>f.data.snapshots);if(h.length===0)return null;const w=new Map;for(const f of h){const j=w.get(f.snapshot_date)||0;w.set(f.snapshot_date,j+Number(f.balance_usd))}return{snapshots:Array.from(w.entries()).map(([f,j])=>({snapshot_date:f,balance_usd:j}))}},[b]),M=Le({queries:t.tokens.map(h=>({queryKey:["position-performance",h.id],queryFn:()=>$t(h.id),retry:!1}))}),F=M.some(h=>h.isLoading),C=M.every(h=>!h.isLoading),c=o.useMemo(()=>{if(!C)return null;const h=M.filter(E=>E.data);if(h.length===0)return null;const w=h[0].data;if(h.length===1)return w;let x=0,f=0,j=0,L=0,$=0,l=!1,_=0,m=0;for(const E of h){const i=E.data;x+=Number(i.start_value_usd),f+=Number(i.current_value_usd),j+=Number(i.total_return_usd),L=Math.max(L,i.days_held),$+=i.snapshot_count,i.il_usd!=null&&(l=!0,_+=Number(i.il_usd)),i.hodl_value_usd!=null&&(m+=Number(i.hodl_value_usd))}const D=x>0?j/x*100:0;let O=null;if(L>=7&&x>0){const E=((f/x)**(365/L)-1)*100;Math.abs(E)<=500&&(O=E)}return{position_id:w.position_id,protocol:w.protocol,symbol:t.name,days_held:L,start_value_usd:x,current_value_usd:f,total_return_usd:j,total_return_pct:D,annualized_return_pct:O,current_apy:w.current_apy,snapshot_count:$,il_percentage:l&&x>0?_/x*100:null,il_usd:l?_:null,hodl_value_usd:l?m:null,lp_vs_hodl_usd:l?f-m:null,lp_outperformed_hodl:l?f>m:void 0}},[M,t.name,C]),{data:P}=Q({queryKey:["position-roi",n.id],queryFn:()=>Xe(n.id),retry:!1}),T=N||F,I=h=>{const w=Number(h.balance);return w<1e-4?"<0.0001":w<1?w.toFixed(4):w.toFixed(2)},q=e.jsxs("div",{className:"fixed inset-0 z-[100001]",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),e.jsx("div",{className:"fixed inset-0 z-[100002] flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90dvh] my-auto overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 dark:from-gray-800 dark:to-gray-900 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex -space-x-2",children:t.tokens.slice(0,3).map((h,w)=>h.logo_url?e.jsx("img",{src:h.logo_url,alt:h.symbol,className:"w-10 h-10 rounded-full border-2 border-white/20",style:{zIndex:t.tokens.length-w}},h.id):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",style:{zIndex:t.tokens.length-w},children:h.symbol.slice(0,2)},h.id))}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:t.protocol}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.name})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Current Value"}),e.jsxs("p",{className:"text-4xl font-bold",children:["$",t.total_usd.toFixed(2)]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-2 text-sm",children:e.jsx("span",{className:"text-gray-400",children:t.tokens.map((h,w)=>e.jsxs("span",{children:[w>0&&" + ",I(h)," ",h.symbol]},h.id))})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>s("overview"),className:K("flex-1 px-4 py-3 text-sm font-medium transition-colors",a==="overview"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:"Gain/Loss"}),e.jsxs("button",{onClick:()=>s("rewards"),className:K("flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2",a==="rewards"?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 hover:text-gray-700"),children:[e.jsx(Pe,{className:"w-4 h-4"}),"Rewards"]})]}),e.jsx("div",{className:"p-4 space-y-4 max-h-[50vh] overflow-y-auto",children:T?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(de,{size:"lg"})}):e.jsxs(e.Fragment,{children:[a==="overview"&&e.jsxs(e.Fragment,{children:[c&&e.jsxs(re,{className:"overflow-hidden",children:[e.jsxs("div",{className:K("p-4 text-center",Number(c.total_return_pct)>=0?"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20":"bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[Number(c.total_return_pct)>=0?e.jsx(aa,{className:"w-5 h-5 text-green-600"}):e.jsx(Xt,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:K("text-sm font-medium",Number(c.total_return_pct)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:"Total Return"})]}),e.jsxs("p",{className:K("text-3xl font-bold",Number(c.total_return_pct)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[Number(c.total_return_pct)>=0?"+":"",c.total_return_pct.toFixed(2),"%"]}),e.jsxs("p",{className:K("text-lg font-semibold mt-1",Number(c.total_return_usd)>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:[Number(c.total_return_usd)>=0?"+":"","$",Math.abs(Number(c.total_return_usd)).toFixed(2)]})]}),e.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(tt,{className:"w-3.5 h-3.5"}),"Invested"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",Number(c.start_value_usd).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 dark:text-gray-400 text-xs mb-1",children:[e.jsx(Ht,{className:"w-3.5 h-3.5"}),"Duration"]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[c.days_held," days"]})]})]})]}),c&&c.annualized_return_pct!==null&&e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ia,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Annualized Return"})]}),e.jsxs("span",{className:K("font-bold text-lg",Number(c.annualized_return_pct)>=0?"text-green-600":"text-red-600"),children:[Number(c.annualized_return_pct)>=0?"+":"",c.annualized_return_pct.toFixed(2),"%"]})]})}),c&&c.current_apy!=null&&e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current APY"})]}),e.jsxs("span",{className:"font-bold text-lg text-purple-600 dark:text-purple-400",children:[Number(c.current_apy).toFixed(2),"%"]})]})}),v&&v.snapshots.length>0&&e.jsxs(re,{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-3",children:"30-Day Performance"}),e.jsx("div",{className:"h-40",children:e.jsx(ma,{snapshots:v.snapshots})})]}),e.jsx("button",{onClick:()=>g(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Close Position"})]}),a==="rewards"&&e.jsx(e.Fragment,{children:t.protocol_module==="staked"?e.jsx(ga,{source:"symbiotic"}):e.jsx(ua,{positionId:n.id})})]})}),y&&e.jsx(pa,{group:t,lastSnapshotValueUsd:t.total_usd,costBasisUsd:(P==null?void 0:P.cost_basis_usd)??null,totalRewardsUsd:(P==null?void 0:P.total_rewards_usd)??null,onClose:()=>g(!1),onSuccess:()=>{g(!1),r()}})]})})]});return typeof document>"u"?null:Ne.createPortal(q,document.body)}function fa({walletId:t}){const{t:r}=W(),a=ne(),[s,y]=o.useState(new Set),[g,n]=o.useState(""),{data:b=[]}=Q({queryKey:["unattributed-rewards"],queryFn:Ze}),{data:N}=Q({queryKey:["defi-positions",t],queryFn:()=>et(t),enabled:!!t}),v=U({mutationFn:({rewardIds:m,positionId:D})=>Et(m,D),onSuccess:()=>{a.invalidateQueries({queryKey:["unattributed-rewards"]}),a.invalidateQueries({queryKey:["position-rewards"]}),y(new Set),n("")}}),[M,F]=o.useState(null),[C,c]=o.useState(null),[P,T]=o.useState(null),I=U({mutationFn:m=>Ye(m),onSuccess:m=>{c(r("crypto.transactionCreated","Transaction created: ${{amount}}",{amount:m.amount_usd.toFixed(2)})),a.invalidateQueries({queryKey:["unattributed-rewards"]}),a.invalidateQueries({queryKey:["transactions"]}),F(null),setTimeout(()=>c(null),5e3)},onError:m=>{T(m.message||r("crypto.transactionCreateError","Failed to create transaction")),F(null),setTimeout(()=>T(null),5e3)}});if(b.length===0)return null;const q=1,h=b.filter(m=>Number(m.reward_usd||0)>=q);if(h.length===0)return null;const w=(N==null?void 0:N.positions)||[],x=m=>`${Number(m.reward_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})} ${m.reward_token_symbol||"tokens"}`,f=m=>new Date(m).toLocaleDateString(se(),{month:"short",day:"numeric",year:"numeric"}),j=m=>{const D=new Set(s);D.has(m)?D.delete(m):D.add(m),y(D)},L=()=>{s.size===h.length?y(new Set):y(new Set(h.map(m=>m.id)))},$=h.length>0&&s.size===h.length,l=s.size>0,_=()=>{s.size===0||!g||v.mutate({rewardIds:Array.from(s),positionId:g})};return e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ht,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),e.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:r("crypto.unattributedRewards",{count:h.length})})]}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:r("crypto.unattributedRewardsDesc","These rewards need to be assigned to a position for ROI tracking.")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-yellow-100 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:L,className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:[$?e.jsx($e,{className:"h-4 w-4 text-primary-600"}):e.jsx(Ee,{className:"h-4 w-4"}),$?r("deselectAll","Deselect All"):r("selectAll","Select All")]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs("select",{value:g,onChange:m=>n(m.target.value),disabled:!l,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:r("crypto.selectPosition","Select position...")}),w.map(m=>e.jsxs("option",{value:m.id,children:[m.protocol," - ",m.symbol]},m.id))]}),e.jsxs("button",{type:"button",onClick:_,disabled:!l||!g||v.isPending,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-md transition-colors disabled:cursor-not-allowed",children:[e.jsx(pt,{className:"h-4 w-4"}),v.isPending?r("assigning","Assigning..."):r("crypto.assignSelected","Assign {{count}} Selected",{count:s.size})]})]})]}),C&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(me,{className:"h-4 w-4"}),C]}),P&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[e.jsx(ae,{className:"h-4 w-4"}),P]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.map(m=>e.jsxs("div",{onClick:()=>j(m.id),className:`flex items-center gap-3 p-3 rounded-md border cursor-pointer transition-colors ${s.has(m.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700":"bg-white dark:bg-gray-800 border-yellow-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:s.has(m.id)?e.jsx($e,{className:"h-5 w-5 text-primary-600"}):e.jsx(Ee,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:x(m)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[f(m.claimed_at)," via ",m.source,m.reward_usd&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400",children:["â‰ˆ $",Number(m.reward_usd).toFixed(2)]})]})]}),m.reward_usd&&m.reward_usd>0&&e.jsx("div",{className:"flex-shrink-0",onClick:D=>D.stopPropagation(),children:m.transaction_id?e.jsxs("a",{href:`/transactions?id=${m.transaction_id}`,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx(Re,{className:"h-3 w-3"}),r("crypto.viewTransaction","View Txn")]}):e.jsxs("button",{type:"button",onClick:()=>{F(m.id),I.mutate(m.id)},disabled:M===m.id,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded hover:bg-primary-200 dark:hover:bg-primary-900/50 disabled:opacity-50 transition-colors",children:[M===m.id?e.jsx(fe,{className:"h-3 w-3 animate-spin"}):e.jsx(Me,{className:"h-3 w-3"}),r("crypto.createTransaction","Create Txn")]})})]},m.id))}),l&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200 dark:border-gray-700 text-sm text-yellow-700 dark:text-yellow-300",children:r("crypto.selectedRewards","{{count}} reward(s) selected",{count:s.size})})]})}const ja={deposit:"ðŸ’°",stake:"ðŸ”’",borrow:"ðŸ’¸",reward:"ðŸŽ",liquidity:"ðŸ’§"},ka={liquidity_pool:"LP",staking:"Staking",lending:"Lending",farming:"Farming",vault:"Vault"};function Na(t){const r={};for(const a of t){const s=`${a.protocol}-${a.chain_id}-${a.name||a.token_name}-${a.position_type}`;r[s]||(r[s]={key:s,name:a.name||a.token_name,protocol:a.protocol,protocol_module:a.protocol_module,position_type:a.position_type,chain_id:a.chain_id,tokens:[],total_usd:0}),r[s].tokens.push(a),r[s].total_usd+=Number(a.balance_usd)}return Object.values(r)}function va({group:t,onClick:r,isPrivacyMode:a}){const s=t.chain_id,y=ke[s],g=t.tokens[0],n=a?t.tokens.map(b=>`*** ${b.symbol}`).join(" + "):t.tokens.map(b=>{const N=Number(b.balance);return`${N<1e-4?"<0.0001":N<1?N.toFixed(4):N.toFixed(2)} ${b.symbol}`}).join(" + ");return e.jsxs("button",{onClick:()=>r(t),className:"w-full flex items-center justify-between py-3 px-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors text-left group",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:t.tokens.length>1?e.jsxs("div",{className:"flex -space-x-2",children:[t.tokens.slice(0,3).map((b,N)=>b.logo_url?e.jsx("img",{src:b.logo_url,alt:b.symbol,className:"w-7 h-7 rounded-full border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-N},onError:v=>{v.target.style.display="none"}},b.id):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border-2 border-white dark:border-gray-800",style:{zIndex:t.tokens.length-N},children:b.symbol.slice(0,2)},b.id)),t.tokens.length>3&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",t.tokens.length-3]})]}):g.logo_url?e.jsx("img",{src:g.logo_url,alt:g.symbol,className:"w-8 h-8 rounded-full",onError:b=>{b.target.style.display="none"}}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:ja[t.position_type]||"ðŸ“ˆ"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.protocol}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded",children:ka[t.protocol_module]||t.protocol_module})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"truncate",children:t.name}),y&&e.jsxs("span",{className:"text-xs px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:[y.icon," ",s.toUpperCase()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a?"$***":`$${t.total_usd.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[180px] truncate",children:n})]}),e.jsx(Ve,{className:"w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-colors"})]})]})}function Ke(){const{t}=W("common"),{currency:r}=Qe(),{isPrivacyMode:a}=ue(),[s,y]=o.useState(null),g=ve(),{data:n,isLoading:b}=Q({queryKey:["crypto-wallets"],queryFn:We}),{data:N=[]}=Q({queryKey:["unattributed-rewards"],queryFn:Ze}),{data:v,isLoading:M,refetch:F}=Q({queryKey:["crypto-defi-positions",n==null?void 0:n.map(x=>x.id)],queryFn:async()=>!n||n.length===0?[]:await Promise.all(n.map(f=>et(f.id).catch(()=>({wallet_address:f.wallet_address,total_value_usd:0,positions:[],last_sync_at:null})))),enabled:!!n&&n.length>0}),C=(v==null?void 0:v.flatMap(x=>x.positions))||[],c=Na(C),P=(v==null?void 0:v.reduce((x,f)=>x+Number(f.total_value_usd||0),0))||0,T=1/((g==null?void 0:g.USD)||.00667),I=Math.round(P*T),q=c.reduce((x,f)=>{const j=f.protocol;return x[j]||(x[j]=[]),x[j].push(f),x},{});if(b||M)return e.jsx(je,{title:t("crypto.defiPositions"),badge:0,children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(de,{size:"md"})})});if(!n||n.length===0)return null;const w=N.length>0?`${c.length} Â· ${N.length} âš `:c.length;return e.jsxs(je,{title:t("crypto.defiPositions"),badge:w,defaultOpen:c.length>0,children:[C.length>0&&e.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("crypto.totalDefiValue")}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:X(I,r,g,!1,a)})]}),e.jsx("button",{onClick:()=>F(),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors",title:t("crypto.refresh"),children:e.jsx(ee,{className:"w-5 h-5"})})]})}),n[0]&&e.jsx("div",{className:"mb-4",children:e.jsx(fa,{walletId:n[0].id})}),c.length>0?e.jsx("div",{className:"space-y-4",children:Object.entries(q).sort(([,x],[,f])=>{const j=x.reduce(($,l)=>$+l.total_usd,0);return f.reduce(($,l)=>$+l.total_usd,0)-j}).map(([x,f])=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:x}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:a?"$***":`$${f.reduce((j,L)=>j+L.total_usd,0).toFixed(2)}`})]})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:f.sort((j,L)=>L.total_usd-j.total_usd).map(j=>e.jsx(va,{group:j,onClick:y,isPrivacyMode:a},j.key))})]},x))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(na,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("crypto.noDefiPositions")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:t("crypto.noDefiPositionsDescription")})]}),s&&e.jsx(ba,{group:s,onClose:()=>y(null)})]})}function ze(){const{t}=W("common"),[r,a]=o.useState(!1),{data:s,isLoading:y}=Q({queryKey:["closed-positions"],queryFn:ha});return y||!s||s.total_closed===0?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>a(!r),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t("crypto.closedPositions","Closed Positions")}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.total_closed," ",t("crypto.positions","positions")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[s.total_realized_pnl_jpy!==null&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:t("crypto.totalPnl","Total P&L")}),e.jsxs("p",{className:`font-medium ${s.total_realized_pnl_jpy>=0?"text-green-600":"text-red-600"}`,children:[s.total_realized_pnl_jpy>=0?"+":"",pe(s.total_realized_pnl_jpy,"JPY")]})]}),r?e.jsx(Ue,{className:"w-5 h-5 text-gray-500"}):e.jsx(we,{className:"w-5 h-5 text-gray-500"})]})]}),r&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 space-y-3",children:s.positions.map(g=>{const n=ke[g.chain_id],b=g.realized_pnl_jpy!==null&&g.realized_pnl_jpy>=0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[g.protocol," - ",g.symbol]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[n&&e.jsx("span",{children:n.icon}),e.jsx("span",{children:new Date(g.exit_date).toLocaleDateString(se())})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:pe(g.exit_value_jpy,"JPY")}),g.realized_pnl_jpy!==null&&e.jsxs("div",{className:`flex items-center justify-end gap-1 text-sm ${b?"text-green-600":"text-red-600"}`,children:[b?e.jsx(_e,{className:"w-3 h-3"}):e.jsx(bt,{className:"w-3 h-3"}),b?"+":"",pe(g.realized_pnl_jpy,"JPY"),g.realized_pnl_pct!==null&&e.jsxs("span",{className:"text-xs",children:["(",g.realized_pnl_pct.toFixed(1),"%)"]})]})]})]},g.id)})})]})}async function wa(t){return(await Se.post("/api/transfers/",t)).data}async function _a(t){return(await Se.post("/api/transfers/exchange",t)).data}const ie={JPY:"Â¥",USD:"$",VND:"â‚«"};function oe(t){const r=t.replace(/[^\d]/g,"");return r?parseInt(r).toLocaleString("en-US"):""}function V(t){return parseInt(t.replace(/[,.\s]/g,""),10)||0}function Sa({isOpen:t,onClose:r}){const{t:a}=W("common"),s=ne(),{data:y}=He(),g=ve(),[n,b]=o.useState(null),[N,v]=o.useState(null),[M,F]=o.useState(""),[C,c]=o.useState(""),[P,T]=o.useState(""),[I,q]=o.useState(new Date().toISOString().split("T")[0]),[h,w]=o.useState(""),[x,f]=o.useState({}),[j,L]=o.useState(!1),[$,l]=o.useState(null),[_,m]=o.useState(!1),[D,O]=o.useState("monthly"),[E,i]=o.useState(0),[S,H]=o.useState(new Date().getDate()),[R,d]=o.useState(7),k=o.useMemo(()=>y==null?void 0:y.find(u=>u.id===n),[y,n]),B=o.useMemo(()=>y==null?void 0:y.find(u=>u.id===N),[y,N]),p=o.useMemo(()=>(y==null?void 0:y.filter(u=>u.id!==n))||[],[y,n]),{data:A}=Q({queryKey:["transactions","income",k==null?void 0:k.currency],queryFn:()=>kt({type:"income"}),enabled:j&&!!k,select:u=>u.filter(J=>J.currency===(k==null?void 0:k.currency))});o.useEffect(()=>{if(!k||!B||!M||!g)return;const u=V(M);if(u<=0)return;if(k.currency===B.currency){c(oe(u.toString()));return}const J=g[k.currency]||1,he=g[B.currency]||1,G=u/J,lt=Math.round(G*he);c(oe(lt.toString()))},[k,B,M,g]),o.useEffect(()=>{var u;t&&(b(((u=y==null?void 0:y[0])==null?void 0:u.id)||null),v(null),F(""),c(""),T(""),q(new Date().toISOString().split("T")[0]),w(""),f({}),L(!1),l(null),m(!1),O("monthly"),i(0),H(new Date().getDate()),d(7))},[t,y]);const z=U({mutationFn:wa,onSuccess:()=>{s.invalidateQueries({queryKey:["accounts"]}),s.invalidateQueries({queryKey:["transactions"]}),s.invalidateQueries({queryKey:["transfers"]}),s.invalidateQueries({queryKey:["analytics"]}),r()}}),Y=U({mutationFn:_a,onSuccess:()=>{s.invalidateQueries({queryKey:["accounts"]}),s.invalidateQueries({queryKey:["transactions"]}),s.invalidateQueries({queryKey:["transfers"]}),s.invalidateQueries({queryKey:["analytics"]}),r()}}),ge=U({mutationFn:ft,onSuccess:()=>{s.invalidateQueries({queryKey:["recurring-transactions"]}),s.invalidateQueries({queryKey:["accounts"]}),r()}}),ye=_?ge:j?Y:z,rt=()=>{const u={};return n||(u.fromAccount=a("transfer.errors.fromRequired")),N||(u.toAccount=a("transfer.errors.toRequired")),n&&N&&n===N&&(u.toAccount=a("transfer.errors.sameAccount")),(!M||V(M)<=0)&&(u.fromAmount=a("transfer.errors.amountRequired")),(!C||V(C)<=0)&&(u.toAmount=a("transfer.errors.amountRequired")),f(u),Object.keys(u).length===0},st=u=>{if(u.preventDefault(),!rt())return;const J=(k==null?void 0:k.currency)||"JPY",he=(B==null?void 0:B.currency)||"JPY";if(_){const G={description:h.trim()||`${k==null?void 0:k.name} â†’ ${B==null?void 0:B.name}`,amount:Z(V(M),J),category:"Transfer",account_id:n,is_income:!1,is_transfer:!0,to_account_id:N,transfer_fee_amount:!j&&P?Z(V(P),J):null,currency:J,frequency:D,day_of_week:D==="weekly"?E:null,day_of_month:D==="monthly"?S:null,interval_days:D==="custom"?R:null,start_date:I};ge.mutate(G);return}if(j){const G={date:I,from_account_id:n,from_amount:Z(V(M),J),to_account_id:N,to_amount:Z(V(C),he),link_to_transaction_id:$||void 0,notes:h.trim()||void 0};Y.mutate(G)}else{const G={from_account_id:n,to_account_id:N,from_amount:Z(V(M),J),to_amount:Z(V(C),he),fee_amount:Z(V(P)||0,J),date:I,description:h.trim()||void 0};k&&B&&k.currency!==B.currency&&(G.exchange_rate=V(C)/V(M)),z.mutate(G)}};if(!t)return null;const nt=e.jsxs("div",{className:"fixed inset-0 z-[100001] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 animate-modal-backdrop",onClick:r}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto overflow-x-hidden",style:{touchAction:"pan-y"},onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:j?a("transfer.exchangeTitle","Currency Exchange"):a("transfer.title")}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:st,className:"p-6 space-y-5",children:[e.jsx("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:u=>L(u.target.checked),className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx(ee,{className:"w-4 h-4"}),a("transfer.exchangeMode","Currency Exchange")]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transfer.fromAccount")}),e.jsxs("select",{value:n||"",onChange:u=>b(u.target.value?parseInt(u.target.value):null),className:K("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",x.fromAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:a("transfer.selectAccount")}),y==null?void 0:y.map(u=>e.jsxs("option",{value:u.id,children:[u.name," (",ie[u.currency]||u.currency,")"]},u.id))]}),x.fromAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:x.fromAccount})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(jt,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transfer.toAccount")}),e.jsxs("select",{value:N||"",onChange:u=>v(u.target.value?parseInt(u.target.value):null),className:K("w-full h-12 px-4 border rounded-lg","bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",x.toAccount?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:a("transfer.selectAccount")}),p.map(u=>e.jsxs("option",{value:u.id,children:[u.name," (",ie[u.currency]||u.currency,")"]},u.id))]}),x.toAccount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:x.toAccount})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transfer.amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:k?ie[k.currency]||k.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:M,onChange:u=>F(oe(u.target.value)),className:K("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",x.fromAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),x.fromAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:x.fromAmount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("transfer.convertedAmount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:B?ie[B.currency]||B.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:C,onChange:u=>c(oe(u.target.value)),className:K("w-full h-12 pl-10 pr-4 border rounded-lg text-right","dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",x.toAmount?"border-red-500":"border-gray-300"),placeholder:"0"})]}),x.toAmount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:x.toAmount})]})]}),k&&B&&k.currency!==B.currency&&M&&C&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["1 ",k.currency," â‰ˆ ",(V(C)/V(M)).toFixed(4)," ",B.currency]}),j&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("transfer.linkToIncome","Link to Income")," (",a("optional"),")"]}),e.jsxs("select",{value:$||"",onChange:u=>l(u.target.value?parseInt(u.target.value):null),className:"w-full h-12 px-4 border border-gray-300 rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",children:[e.jsx("option",{value:"",children:a("transfer.noLink","None")}),A==null?void 0:A.map(u=>e.jsxs("option",{value:u.id,children:[u.date," - ",u.description," (",pe(u.amount,u.currency),")"]},u.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:a("transfer.linkToIncomeHelp","Link this exchange to an income transaction for tracking")})]}),!j&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("transfer.fee")," (",a("optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:k?ie[k.currency]||k.currency:"Â¥"}),e.jsx("input",{type:"text",inputMode:"numeric",value:P,onChange:u=>T(oe(u.target.value)),className:"w-full h-12 pl-10 pr-4 border border-gray-300 rounded-lg text-right dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a(_?"recurring.startDate":"transfer.date")}),e.jsx("input",{type:"date",value:I,onChange:u=>q(u.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),e.jsx("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:u=>m(u.target.checked),className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx(It,{className:"w-4 h-4"}),a("recurring.makeRecurring")]})}),_&&e.jsx(Wt,{frequency:D,setFrequency:O,dayOfWeek:E,setDayOfWeek:i,dayOfMonth:S,setDayOfMonth:H,intervalDays:R,setIntervalDays:d}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("transfer.description")," (",a("optional"),")"]}),e.jsx("input",{type:"text",value:h,onChange:u=>w(u.target.value),className:"w-full h-12 px-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",placeholder:a("transfer.descriptionPlaceholder")})]}),ye.isError&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:a("transfer.error")}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(ce,{type:"button",variant:"outline",onClick:r,className:"flex-1 h-12",children:a("cancel")}),e.jsx(ce,{type:"submit",loading:ye.isPending,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700",children:_?a("transfer.createRecurring","Create Recurring"):a("transfer.create")})]})]})]})]});return typeof document>"u"?null:Ne.createPortal(nt,document.body)}const at="accounts_collapsed_sections";function Ca(){try{const t=localStorage.getItem(at);if(t)return new Set(JSON.parse(t))}catch{}return new Set}function Fa(t){localStorage.setItem(at,JSON.stringify([...t]))}const Oe=["bank","savings","cash","credit_card","investment","crypto","receivable","other"];function Ma(){const{t}=W("common"),[r,a]=o.useState(!1),[s,y]=o.useState(""),g=_t(s,200),[n,b]=o.useState(null),[N,v]=o.useState(!1),[M,F]=o.useState(!1),[C,c]=o.useState(!1),[P,T]=o.useState(!1),[I,q]=o.useState(null),[h,w]=o.useState(null),[x,f]=o.useState(()=>Ca()),{data:j}=De(),{isPrivacyMode:L}=ue();o.useEffect(()=>{Fa(x)},[x]),o.useEffect(()=>{const p=()=>c(!0),A=()=>T(!0);return window.addEventListener("open-add-transaction-modal",p),window.addEventListener("open-receipt-scanner",A),()=>{window.removeEventListener("open-add-transaction-modal",p),window.removeEventListener("open-receipt-scanner",A)}},[]);const $=o.useCallback(p=>{f(A=>{const z=new Set(A);return z.has(p)?z.delete(p):z.add(p),z})},[]),{data:l,isLoading:_,error:m}=He(r),D=o.useMemo(()=>{if(!l)return[];let p=l;if(g.trim()){const A=g.toLowerCase();p=p.filter(z=>{var Y;return z.name.toLowerCase().includes(A)||t(`account.type.${z.type}`).toLowerCase().includes(A)||((Y=z.notes)==null?void 0:Y.toLowerCase().includes(A))})}return n&&(p=p.filter(A=>A.type===n)),p},[l,g,n,t]),O=o.useMemo(()=>D.reduce((p,A)=>{const z=A.type;return p[z]||(p[z]=[]),p[z].push(A),p},{}),[D]),E=o.useMemo(()=>{if(!l)return[];const p=new Set(l.map(A=>A.type));return Oe.filter(A=>p.has(A))},[l]),i=o.useMemo(()=>D.length?D.reduce((p,A)=>p+A.current_balance,0):0,[D]),S=()=>{q(null),v(!0)},H=p=>{q(p),v(!0)},R=()=>{v(!1),q(null)},d=l&&l.length>0,k=D.length>0,B=g.trim()!==""||n!==null;return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 pb-32",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("account.accounts")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:t("account.subtitle")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>F(!0),className:"inline-flex items-center gap-2 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx(ea,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("transfer.title")})]}),e.jsxs("button",{onClick:S,className:"inline-flex items-center gap-2 px-3 py-2 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4"}),t("account.createAccount")]})]})]})}),d&&e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:s,onChange:p=>y(p.target.value),placeholder:t("account.searchPlaceholder","Search accounts..."),className:"w-full pl-10 pr-10 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all text-sm"}),s&&e.jsx("button",{onClick:()=>y(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(ae,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide pb-1",children:[e.jsxs("button",{onClick:()=>b(null),className:K("px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",n?"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800":"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400"),children:[t("account.allTypes","All")," (",(l==null?void 0:l.length)||0,")"]}),E.map(p=>{const A=(l==null?void 0:l.filter(z=>z.type===p).length)||0;return e.jsxs("button",{onClick:()=>b(n===p?null:p),className:K("px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",n===p?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[t(`account.type.${p}`)," (",A,")"]},p)}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>a(!r),className:K("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",r?"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300":"text-gray-500 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[r?e.jsx(Nt,{className:"w-3.5 h-3.5"}):e.jsx(vt,{className:"w-3.5 h-3.5"}),t("account.showInactive")]})]})]}),d&&k&&e.jsx("div",{className:"mb-6",children:e.jsx(re,{variant:"glass",className:"!p-5 bg-hero-gradient",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-widest",children:B?t("account.filteredBalance","Filtered Balance"):t("account.totalBalance","Total Balance")}),e.jsx("p",{className:K("text-3xl sm:text-4xl font-extrabold font-numbers mt-1.5 tracking-tighter",i>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:X(i,"JPY",(j==null?void 0:j.rates)||{},!0,L)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[D.length," ",t("account.accountCount","accounts")]})})]})})}),_&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}),m&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 dark:text-red-400 text-sm",children:t("account.errors.loadFailed")})}),!_&&!m&&!d&&e.jsx(wt,{icon:e.jsx(be,{}),title:t("emptyState.accounts.title"),description:t("emptyState.accounts.description"),action:e.jsxs("button",{onClick:S,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm",children:[e.jsx(xe,{className:"w-4 h-4"}),t("emptyState.accounts.cta")]})}),!_&&!m&&d&&!k&&B&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(qe,{className:"w-10 h-10 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:t("account.noSearchResults","No accounts match your search")}),e.jsx("button",{onClick:()=>{y(""),b(null)},className:"mt-2 text-sm text-primary-600 dark:text-primary-400 hover:underline",children:t("account.clearFilters","Clear filters")})]}),!_&&!m&&k&&e.jsxs("div",{className:"space-y-6",children:[Oe.map(p=>{const A=O[p];if(!A||A.length===0)return null;const z=x.has(p);return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>$(p),className:"w-full flex items-center justify-between mb-3 group cursor-pointer",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[t(`account.type.${p}`),e.jsx("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full",children:A.length})]}),e.jsx(we,{className:K("w-4 h-4 text-gray-400 transition-transform duration-200",z&&"-rotate-90")})]}),e.jsx("div",{className:K("grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 transition-all duration-200 ease-in-out",z?"max-h-0 opacity-0 overflow-hidden":"max-h-[2000px] opacity-100"),children:A.map((Y,ge)=>e.jsx("div",{className:"animate-stagger-in",style:{"--stagger-index":Math.min(ge,9)},children:e.jsx(da,{account:Y,onEdit:H,onAddTransaction:ye=>{w(ye),c(!0)}})},Y.id))})]},p)}),e.jsx(Be,{}),e.jsx(Ke,{}),e.jsx(ze,{})]}),!_&&!m&&!d&&e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx(Be,{}),e.jsx(Ke,{}),e.jsx(ze,{})]}),e.jsx(ca,{isOpen:N,onClose:R,editingAccountId:I}),e.jsx(Sa,{isOpen:M,onClose:()=>F(!1)}),e.jsx(St,{isOpen:C,onClose:()=>{c(!1),w(null)},defaultAccountId:h}),e.jsx(Ct,{isOpen:P,onClose:()=>T(!1),onScanComplete:()=>T(!1)})]})}const Va=ot("/accounts")({component:Ma});export{Va as Route};
