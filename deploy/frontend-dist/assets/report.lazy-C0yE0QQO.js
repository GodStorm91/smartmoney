import{H as p,u as d,ar as j,j as e,ai as b,as as l,l as v,h,r as N,z as f,E as _,C as c,i as k}from"./index-CqkF-9Du.js";import{M as w,a as o,C as M,I as C}from"./IncomeExpenseBarChart-DZjl5WT4.js";import{D as R}from"./download-beknnTe5.js";import{M as B}from"./mail-iE3NRm7D.js";import"./generateCategoricalChart-B0OhJUud.js";import"./YAxis-CMN-KoFi.js";async function D(t,a){return(await p.get(`/api/reports/monthly-usage/${t}/${a}`)).data}function E({year:t,month:a}){const{t:r}=d("common"),n=j(new Date(t,a-1),"MMMM yyyy");return e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:r("report.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:n})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:!0,className:"p-2 rounded-lg text-gray-400 dark:text-gray-600 cursor-not-allowed","aria-label":r("report.downloadPDF"),title:r("report.comingSoon"),children:e.jsx(R,{size:18})}),e.jsx("button",{disabled:!0,className:"p-2 rounded-lg text-gray-400 dark:text-gray-600 cursor-not-allowed","aria-label":r("report.sendEmail"),title:r("report.comingSoon"),children:e.jsx(B,{size:18})})]})]})}const x=({value:t,max:a=100,className:r})=>{const n=Math.min(100,Math.max(0,t/a*100));return e.jsx("div",{className:b("h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",r),children:e.jsx("div",{className:"h-full transition-all duration-300 ease-in-out bg-blue-600",style:{width:`${n}%`}})})};function F(t){switch(t){case"over_budget":return"error";case"threshold_80":return"warning";case"threshold_50":return"info";default:return"success"}}function P(t,a){switch(t){case"over_budget":return a("report.overBudget");case"threshold_80":return a("report.warning");case"threshold_50":return a("report.caution");default:return a("report.onTrack")}}function S({data:t}){const{t:a}=d("common");return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[l(Math.abs(t.total_spent))," / ",l(t.total_budget)]}),e.jsxs("span",{className:v("font-medium",t.is_over_budget?"text-red-500":"text-gray-700 dark:text-gray-300"),children:[t.percentage_used.toFixed(1),"%"]})]}),e.jsx(x,{value:Math.min(t.percentage_used,100)})]}),e.jsx("div",{className:"space-y-3",children:t.category_status.map(r=>e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium truncate text-gray-900 dark:text-gray-100",children:r.category}),e.jsx(h,{variant:F(r.status),className:"ml-2 text-[10px]",children:P(r.status,a)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{value:Math.min(r.percentage,100),className:"flex-1"}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-16 text-right",children:[l(Math.abs(r.spent))," / ",l(r.budget_amount)]})]})]})},r.category))})]})}function T(t){switch(t){case"ahead":return"success";case"on_track":return"info";default:return"warning"}}function z({goal:t}){const{t:a}=d("common"),r={ahead:a("report.ahead"),on_track:a("report.onTrack"),behind:a("report.behind")}[t.status]||t.status;return e.jsxs("div",{className:"p-4 border rounded-lg border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:a("report.goalYears",{years:t.years})}),e.jsx(h,{variant:T(t.status),children:r})]}),e.jsx(x,{value:Math.min(t.progress_percentage,100),className:"mb-2"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:[l(t.total_saved)," / ",l(t.target_amount)]}),e.jsxs("span",{children:[t.progress_percentage.toFixed(1),"%"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:a("report.neededPerMonth",{amount:l(t.needed_per_month)})})]})}function L({accounts:t,totalNetWorth:a}){const{t:r}=d("common");return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:r("report.totalNetWorth")}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(a)})]}),e.jsx("div",{className:"space-y-2",children:t.map(n=>e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:n.account_name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.account_type})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:l(n.balance,n.currency,void 0,!0)}),n.currency!=="JPY"&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.currency})]})]},n.account_id))})]})}function $(){const{t}=d("common"),[a,r]=N.useState(new Date),n=a.getFullYear(),m=a.getMonth()+1,{data:s,isLoading:g,error:u}=f({queryKey:["monthly-report",n,m],queryFn:()=>D(n,m),staleTime:1e3*60*5});return e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 sm:py-8",children:[e.jsx(E,{year:n,month:m}),e.jsx(w,{selectedMonth:a,onChange:r,className:"mb-6"}),g&&e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(_,{size:"lg"})}),u&&e.jsx(c,{className:"text-center py-10",children:e.jsx("p",{className:"text-red-500",children:t("report.loadError")})}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(o,{label:t("analytics.heroIncome"),value:l(s.summary.total_income),change:s.summary.income_change,trend:s.summary.income_change>0?"positive":s.summary.income_change<0?"negative":"neutral"}),e.jsx(o,{label:t("analytics.heroExpense"),value:l(s.summary.total_expense),change:s.summary.expense_change,trend:s.summary.expense_change<0?"positive":s.summary.expense_change>0?"negative":"neutral"}),e.jsx(o,{label:t("analytics.heroNet"),value:l(s.summary.net_cashflow),change:s.summary.net_change,trend:s.summary.net_change>0?"positive":s.summary.net_change<0?"negative":"neutral"}),e.jsx(o,{label:t("report.savingsRate"),value:`${s.summary.savings_rate.toFixed(1)}%`,subtitle:t("report.savingsRateDesc")})]}),s.budget_adherence&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.budgetAdherence")}),e.jsx(S,{data:s.budget_adherence})]}),s.category_breakdown.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.categoryBreakdown")}),e.jsx(M,{data:s.category_breakdown})]}),s.spending_trends.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.spendingTrends")}),e.jsx(C,{data:s.spending_trends})]}),s.goal_progress.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.goalProgress")}),e.jsx("div",{className:"space-y-4",children:s.goal_progress.map(i=>e.jsx(z,{goal:i},i.goal_id))})]}),s.account_summary.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.accountSummary")}),e.jsx(L,{accounts:s.account_summary,totalNetWorth:s.total_net_worth})]}),s.insights.length>0&&e.jsxs(c,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:t("report.insights")}),e.jsx("div",{className:"space-y-3",children:s.insights.map((i,y)=>e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:i.title})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.message})]},y))})]}),s.summary.total_income===0&&s.summary.total_expense===0&&e.jsx(c,{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("report.noData")})})]})]})}const W=k("/report")({component:$});export{W as Route};
